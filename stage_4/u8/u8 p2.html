<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-color: #00D26A;
            --wrong-color: #FF4757;
            --bg-color: #F0F4F8;
            --text-color: #2D3436;
            --card-bg: #FFFFFF;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e0f7fa;
            background-image: radial-gradient(#00C9A7 15%, transparent 16%), radial-gradient(#8854C0 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 30px;
            position: relative;
            border: 4px solid var(--primary-pink);
            overflow: hidden;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px dashed #ddd;
            padding-bottom: 15px;
        }

        h1 {
            color: var(--primary-pink);
            font-family: 'Quicksand', sans-serif;
            font-size: 24px;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .subtitle {
            color: var(--primary-teal);
            font-weight: 700;
            font-size: 16px;
        }

        /* Progress Bar */
        .progress-container {
            background: #eee;
            border-radius: 20px;
            height: 15px;
            width: 100%;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid #ccc;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary-teal), var(--primary-pink));
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 20px;
        }

        /* Question Box */
        .question-box {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 3px solid var(--primary-teal);
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            color: #333;
            box-shadow: 0 5px 0 #009e82;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 15px;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #bbb;
            color: #555;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-pink);
            color: var(--primary-pink);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #bbb;
        }

        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: #00a352;
            box-shadow: 0 5px 0 #00a352;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: #d63030;
            box-shadow: 0 5px 0 #d63030;
            animation: shake 0.5s;
        }

        /* Explanation Section */
        #explanation-area {
            margin-top: 30px;
            background: #fff9f0;
            border: 2px solid #ffcc80;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden initially */
        }

        .exp-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .exp-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-pink);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }

        .exp-content h3 {
            margin: 10px 0;
            font-size: 18px;
            color: var(--primary-pink);
        }

        .exp-content ul {
            list-style: none;
            padding: 0;
        }

        .exp-content li {
            margin-bottom: 5px;
            padding: 5px 10px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        .exp-tag {
            font-size: 12px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            text-transform: uppercase;
        }
        
        .tag-verb { background: #e3f2fd; color: #1565c0; }
        .tag-adj { background: #fff3e0; color: #ef6c00; }
        .tag-adv { background: #e8f5e9; color: #2e7d32; }
        .tag-noun { background: #f3e5f5; color: #7b1fa2; }

        .why-correct {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            border-left: 5px solid var(--correct-color);
            margin-top: 10px;
        }

        .why-wrong {
            background: #ffebee;
            padding: 10px;
            border-radius: 10px;
            border-left: 5px solid var(--wrong-color);
            margin-top: 10px;
        }

        /* Next Button */
        #next-btn {
            display: none;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #5e3a85;
            transition: all 0.2s;
        }

        #next-btn:hover {
            filter: brightness(1.1);
        }
        
        #next-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #5e3a85;
        }

        /* Result Modal */
        #result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary-teal);
        }

        .score-display {
            font-size: 60px;
            font-weight: 800;
            color: var(--primary-pink);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 20px;
            color: #555;
            margin-bottom: 30px;
        }

        .restart-btn {
            background: var(--primary-teal);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #00876f;
        }
        
        .restart-btn:active {
             transform: translateY(4px);
             box-shadow: 0 1px 0 #00876f;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .question-box {
                font-size: 18px;
            }
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h1>
            <div class="subtitle">Super Grammar Challenge (Grade 3-4-5)</div>
        </header>

        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; color: #666;">
            <span id="question-count">C√¢u: 1/30</span>
            <span id="score-count">ƒêi·ªÉm: 0</span>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="question-box" id="question-text">
            Loading question...
        </div>

        <div class="options-grid" id="options-container">
            </div>

        <div id="explanation-area">
            <div class="exp-header">
                <div class="exp-avatar">M</div>
                <div style="font-weight: bold; color: var(--primary-pink);">C√¥ Mai An gi·∫£i th√≠ch:</div>
            </div>
            <div class="exp-content" id="exp-content">
                </div>
        </div>

        <button id="next-btn" onclick="nextQuestion()">C√¢u Ti·∫øp Theo <i class="fas fa-arrow-right"></i></button>
    </div>

    <div id="result-modal">
        <div class="result-card">
            <h2 style="color: var(--primary-teal);">HO√ÄN TH√ÄNH! üéâ</h2>
            <div class="score-display" id="final-score">0/30</div>
            <div class="feedback-text" id="final-feedback">B·∫°n l√†m r·∫•t t·ªët!</div>
            <button class="restart-btn" onclick="location.reload()">L√†m L·∫°i B√†i <i class="fas fa-redo"></i></button>
        </div>
    </div>

    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <script>
        // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 C√¢u - Mix c√°c th√¨ c∆° b·∫£n) ---
        // Format: Question, Options, Correct Index, Explanation Object
        const rawQuestions = [
            {
                q: "Look! The bus _______ .",
                options: ["come", "comes", "is coming", "came"],
                correct: 2,
                exp: {
                    translation: "Nh√¨n k√¨a! Xe bu√Ωt ƒëang t·ªõi.",
                    analysis: [
                        {w: "come", t: "v", m: "ƒë·∫øn (nguy√™n th·ªÉ)"},
                        {w: "comes", t: "v", m: "ƒë·∫øn (hi·ªán t·∫°i ƒë∆°n - s·ªë √≠t)"},
                        {w: "is coming", t: "v", m: "ƒëang ƒë·∫øn (hi·ªán t·∫°i ti·∫øp di·ªÖn)"},
                        {w: "came", t: "v", m: "ƒë√£ ƒë·∫øn (qu√° kh·ª© ƒë∆°n)"}
                    ],
                    correctReason: "D·∫•u hi·ªáu 'Look!' (Nh√¨n k√¨a!) ƒë·ª©ng ƒë·∫ßu c√¢u k√®m d·∫•u ch·∫•m than -> Di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang x·∫£y ra ngay l√∫c n√≥i -> D√πng th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn** (S + am/is/are + Ving).",
                    wrongReason: "C√°c ƒë√°p √°n A, B l√† hi·ªán t·∫°i ƒë∆°n (ch·ªâ th√≥i quen); D l√† qu√° kh·ª© ƒë∆°n (ƒë√£ x·∫£y ra). ƒê·ªÅu kh√¥ng ph√π h·ª£p v·ªõi m·ªánh l·ªánh t·ª´ 'Look!'."
                }
            },
            {
                q: "She always _______ her homework after dinner.",
                options: ["do", "does", "doing", "did"],
                correct: 1,
                exp: {
                    translation: "C√¥ ·∫•y lu√¥n l√†m b√†i t·∫≠p v·ªÅ nh√† sau b·ªØa t·ªëi.",
                    analysis: [
                        {w: "do", t: "v", m: "l√†m (s·ªë nhi·ªÅu/nguy√™n th·ªÉ)"},
                        {w: "does", t: "v", m: "l√†m (s·ªë √≠t)"},
                        {w: "doing", t: "v", m: "ƒëang l√†m"},
                        {w: "did", t: "v", m: "ƒë√£ l√†m"}
                    ],
                    correctReason: "C√≥ tr·∫°ng t·ª´ ch·ªâ t·∫ßn su·∫•t '**always**' (lu√¥n lu√¥n) -> D√πng th√¨ **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ l√† 'She' (ng√¥i th·ª© 3 s·ªë √≠t) n√™n ƒë·ªông t·ª´ 'do' ph·∫£i th√™m 'es' th√†nh 'does'.",
                    wrongReason: "A sai v√¨ thi·∫øu 'es'. C sai v√¨ thi·∫øu tobe. D sai v√¨ l√† qu√° kh·ª©."
                }
            },
            {
                q: "I _______ my grandparents yesterday.",
                options: ["visit", "visited", "visiting", "visits"],
                correct: 1,
                exp: {
                    translation: "T√¥i ƒë√£ thƒÉm √¥ng b√† v√†o h√¥m qua.",
                    analysis: [
                        {w: "visit", t: "v", m: "thƒÉm (hi·ªán t·∫°i)"},
                        {w: "visited", t: "v", m: "ƒë√£ thƒÉm (qu√° kh·ª©)"},
                        {w: "visiting", t: "v", m: "ƒëang thƒÉm"},
                        {w: "visits", t: "v", m: "thƒÉm (s·ªë √≠t)"}
                    ],
                    correctReason: "C√≥ t·ª´ '**yesterday**' (h√¥m qua) -> D·∫•u hi·ªáu c·ªßa th√¨ **Qu√° kh·ª© ƒë∆°n**. ƒê·ªông t·ª´ 'visit' l√† ƒë·ªông t·ª´ c√≥ quy t·∫Øc, th√™m ƒëu√¥i '-ed'.",
                    wrongReason: "A, C, D ƒë·ªÅu l√† c√°c d·∫°ng chia ·ªü hi·ªán t·∫°i, kh√¥ng d√πng cho qu√° kh·ª©."
                }
            },
            {
                q: "_______ you go to school by bus every day?",
                options: ["Do", "Does", "Are", "Is"],
                correct: 0,
                exp: {
                    translation: "B·∫°n c√≥ ƒëi h·ªçc b·∫±ng xe bu√Ωt m·ªói ng√†y kh√¥ng?",
                    analysis: [
                        {w: "Do", t: "tr·ª£ t·ª´", m: "d√πng cho I/You/We/They"},
                        {w: "Does", t: "tr·ª£ t·ª´", m: "d√πng cho He/She/It"},
                        {w: "Are", t: "tobe", m: "th√¨/l√†/·ªü"},
                        {w: "Is", t: "tobe", m: "th√¨/l√†/·ªü"}
                    ],
                    correctReason: "C√¢u h·ªèi th√¨ **Hi·ªán t·∫°i ƒë∆°n** v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'go'. Ch·ªß ng·ªØ l√† '**you**' -> D√πng tr·ª£ ƒë·ªông t·ª´ '**Do**' ƒë·∫£o l√™n ƒë·∫ßu c√¢u.",
                    wrongReason: "B d√πng cho s·ªë √≠t (She/He). C, D l√† ƒë·ªông t·ª´ Tobe, kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'go' ·ªü d·∫°ng nguy√™n th·ªÉ."
                }
            },
            {
                q: "They _______ play football next Sunday.",
                options: ["will", "did", "are", "do"],
                correct: 0,
                exp: {
                    translation: "H·ªç s·∫Ω ch∆°i b√≥ng ƒë√° v√†o Ch·ªß nh·∫≠t t·ªõi.",
                    analysis: [
                        {w: "will", t: "modal v", m: "s·∫Ω (t∆∞∆°ng lai)"},
                        {w: "did", t: "tr·ª£ t·ª´", m: "ƒë√£ (qu√° kh·ª©)"},
                        {w: "are", t: "tobe", m: "th√¨/l√†/·ªü"},
                        {w: "do", t: "tr·ª£ t·ª´", m: "l√†m"}
                    ],
                    correctReason: "C√≥ t·ª´ '**next Sunday**' (Ch·ªß nh·∫≠t t·ªõi) -> D·∫•u hi·ªáu c·ªßa th√¨ **T∆∞∆°ng lai ƒë∆°n**. C·∫•u tr√∫c: S + will + V(nguy√™n th·ªÉ).",
                    wrongReason: "B l√† qu√° kh·ª©. C sai v√¨ 'are play' sai ng·ªØ ph√°p (ph·∫£i l√† are playing). D l√† hi·ªán t·∫°i."
                }
            },
            {
                q: "He _______ never _______ to London.",
                options: ["have / been", "has / been", "has / be", "have / be"],
                correct: 1,
                exp: {
                    translation: "Anh ·∫•y ch∆∞a bao gi·ªù ƒë·∫øn London.",
                    analysis: [
                        {w: "have/has", t: "tr·ª£ t·ª´", m: "c·ªßa th√¨ HTHT"},
                        {w: "been", t: "V3/ed", m: "ƒë√£ ·ªü/ƒë·∫øn (ph√¢n t·ª´ 2 c·ªßa be)"}
                    ],
                    correctReason: "C√¢u d√πng th√¨ **Hi·ªán t·∫°i ho√†n th√†nh** ƒë·ªÉ di·ªÖn t·∫£ tr·∫£i nghi·ªám. Ch·ªß ng·ªØ 'He' d√πng tr·ª£ t·ª´ '**has**'. C√¥ng th·ª©c: S + has + V3/ed (been).",
                    wrongReason: "A sai v√¨ 'He' kh√¥ng ƒëi v·ªõi 'have'. C, D sai v√¨ sau have/has ph·∫£i l√† V3 (been) ch·ª© kh√¥ng ph·∫£i nguy√™n th·ªÉ (be)."
                }
            },
            {
                q: "Where _______ you last summer?",
                options: ["were", "was", "are", "do"],
                correct: 0,
                exp: {
                    translation: "B·∫°n ƒë√£ ·ªü ƒë√¢u m√πa h√® tr∆∞·ªõc?",
                    analysis: [
                        {w: "were", t: "tobe", m: "ƒë√£ l√†/·ªü (s·ªë nhi·ªÅu/you)"},
                        {w: "was", t: "tobe", m: "ƒë√£ l√†/·ªü (s·ªë √≠t)"},
                        {w: "are", t: "tobe", m: "l√†/·ªü (hi·ªán t·∫°i)"},
                        {w: "do", t: "tr·ª£ t·ª´", m: "l√†m"}
                    ],
                    correctReason: "C√≥ '**last summer**' -> Qu√° kh·ª© ƒë∆°n. ƒê·ªông t·ª´ trong c√¢u l√† tobe (h·ªèi v·ªÅ ƒë·ªãa ƒëi·ªÉm). Ch·ªß ng·ªØ 'you' ƒëi v·ªõi tobe qu√° kh·ª© l√† '**were**'.",
                    wrongReason: "B d√πng cho I/He/She/It. C l√† hi·ªán t·∫°i. D sai v√¨ kh√¥ng c√≥ ƒë·ªông t·ª´ th∆∞·ªùng trong c√¢u."
                }
            },
            {
                q: "Please be quiet! The baby _______ .",
                options: ["sleeps", "slept", "is sleeping", "are sleeping"],
                correct: 2,
                exp: {
                    translation: "L√†m ∆°n tr·∫≠t t·ª± ƒëi! Em b√© ƒëang ng·ªß.",
                    analysis: [
                        {w: "sleeps", t: "v", m: "ng·ªß (th∆∞·ªùng xuy√™n)"},
                        {w: "slept", t: "v", m: "ƒë√£ ng·ªß"},
                        {w: "is sleeping", t: "v", m: "ƒëang ng·ªß"},
                        {w: "are sleeping", t: "v", m: "ƒëang ng·ªß (s·ªë nhi·ªÅu)"}
                    ],
                    correctReason: "C√¢u m·ªánh l·ªánh 'Please be quiet!' cho bi·∫øt h√†nh ƒë·ªông ƒëang di·ªÖn ra -> Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn**. Ch·ªß ng·ªØ 'The baby' (s·ªë √≠t) -> d√πng '**is sleeping**'.",
                    wrongReason: "A l√† th√≥i quen. B l√† qu√° kh·ª©. D sai tobe 'are' (v√¨ baby l√† s·ªë √≠t)."
                }
            },
            {
                q: "_______ she _______ a new car two days ago?",
                options: ["Did / buy", "Do / buy", "Did / bought", "Does / buy"],
                correct: 0,
                exp: {
                    translation: "C√¥ ·∫•y ƒë√£ mua m·ªôt chi·∫øc xe m·ªõi c√°ch ƒë√¢y 2 ng√†y ph·∫£i kh√¥ng?",
                    analysis: [
                        {w: "Did", t: "tr·ª£ t·ª´", m: "ƒë√£ (qu√° kh·ª©)"},
                        {w: "buy", t: "v", m: "mua (nguy√™n th·ªÉ)"},
                        {w: "bought", t: "v", m: "ƒë√£ mua (V-ed/c·ªôt 2)"}
                    ],
                    correctReason: "C√≥ '**ago**' -> Qu√° kh·ª© ƒë∆°n. C√¢u h·ªèi d·∫°ng Yes/No ·ªü qu√° kh·ª©: **Did** + S + **V(nguy√™n th·ªÉ)**. V·∫≠y ch·ªçn 'Did' v√† 'buy'.",
                    wrongReason: "C sai v√¨ sau Did ƒë·ªông t·ª´ ph·∫£i v·ªÅ nguy√™n th·ªÉ (kh√¥ng d√πng bought). B, D l√† hi·ªán t·∫°i ƒë∆°n."
                }
            },
            {
                q: "I _______ hungry right now.",
                options: ["am", "is", "are", "be"],
                correct: 0,
                exp: {
                    translation: "B√¢y gi·ªù t·ªõ ƒëang ƒë√≥i.",
                    analysis: [
                        {w: "am", t: "tobe", m: "ƒëi v·ªõi I"},
                        {w: "is", t: "tobe", m: "ƒëi v·ªõi He/She/It"},
                        {w: "are", t: "tobe", m: "ƒëi v·ªõi You/We/They"},
                        {w: "be", t: "v", m: "nguy√™n th·ªÉ"}
                    ],
                    correctReason: "M√¥ t·∫£ tr·∫°ng th√°i ·ªü hi·ªán t·∫°i ('now'). Ch·ªß ng·ªØ l√† 'I' lu√¥n ƒëi v·ªõi tobe '**am**'.",
                    wrongReason: "B, C sai ng√¥i. D sai d·∫°ng (ph·∫£i chia ƒë·ªông t·ª´)."
                }
            },
             {
                q: "He usually _______ to school by bike, but today he _______ by bus.",
                options: ["goes / goes", "go / is going", "goes / is going", "is going / goes"],
                correct: 2,
                exp: {
                    translation: "C·∫≠u ·∫•y th∆∞·ªùng ƒëi h·ªçc b·∫±ng xe ƒë·∫°p, nh∆∞ng h√¥m nay c·∫≠u ·∫•y ƒëi b·∫±ng xe bu√Ωt.",
                    analysis: [
                        {w: "usually", t: "adv", m: "th∆∞·ªùng xuy√™n (HTƒê)"},
                        {w: "today", t: "adv", m: "h√¥m nay (d√πng HTTD ƒë·ªÉ ch·ªâ s·ª± thay ƒë·ªïi t·∫°m th·ªùi)"}
                    ],
                    correctReason: "V·∫ø 1: 'usually' -> Hi·ªán t·∫°i ƒë∆°n (He **goes**). V·∫ø 2: 'but today' (s·ª± vi·ªác t·∫°m th·ªùi kh√°c th∆∞·ªùng l·ªá) -> Hi·ªán t·∫°i ti·∫øp di·ªÖn (he **is going**).",
                    wrongReason: "A sai v·∫ø 2 (kh√¥ng d√πng hi·ªán t·∫°i ƒë∆°n cho h√†nh ƒë·ªông t·∫°m th·ªùi). B sai v·∫ø 1 (He ph·∫£i th√™m es). D ng∆∞·ª£c th·ª© t·ª± th√¨."
                }
            },
            {
                q: "We _______ a comic book at the moment.",
                options: ["reading", "are reading", "read", "is reading"],
                correct: 1,
                exp: {
                    translation: "Ch√∫ng t√¥i ƒëang ƒë·ªçc truy·ªán tranh ngay l√∫c n√†y.",
                    analysis: [
                        {w: "reading", t: "V-ing", m: "ƒëang ƒë·ªçc (thi·∫øu tobe)"},
                        {w: "are reading", t: "v", m: "ƒëang ƒë·ªçc (s·ªë nhi·ªÅu)"},
                        {w: "read", t: "v", m: "ƒë·ªçc (hi·ªán t·∫°i ƒë∆°n)"},
                        {w: "is reading", t: "v", m: "ƒëang ƒë·ªçc (s·ªë √≠t)"}
                    ],
                    correctReason: "C√≥ '**at the moment**' -> Hi·ªán t·∫°i ti·∫øp di·ªÖn. Ch·ªß ng·ªØ 'We' (s·ªë nhi·ªÅu) ƒëi v·ªõi '**are reading**'.",
                    wrongReason: "A thi·∫øu tobe. C sai th√¨. D sai tobe (is d√πng cho s·ªë √≠t)."
                }
            },
            {
                q: "Tom _______ not _______ his homework yet.",
                options: ["has / finished", "have / finished", "did / finish", "is / finishing"],
                correct: 0,
                exp: {
                    translation: "Tom v·∫´n ch∆∞a l√†m xong b√†i t·∫≠p v·ªÅ nh√†.",
                    analysis: [
                        {w: "yet", t: "adv", m: "ch∆∞a (d·∫•u hi·ªáu HTHT)"},
                        {w: "finish", t: "v", m: "ho√†n th√†nh"}
                    ],
                    correctReason: "T·ª´ '**yet**' cu·ªëi c√¢u ph·ªß ƒë·ªãnh -> D·∫•u hi·ªáu th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**. Tom (s·ªë √≠t) -> **Has** + not + **V3/ed** (finished).",
                    wrongReason: "B sai v√¨ Tom s·ªë √≠t kh√¥ng d√πng Have. C l√† qu√° kh·ª© ƒë∆°n (yet kh√¥ng d√πng cho QKƒê trong tr∆∞·ªùng h·ª£p n√†y). D l√† ti·∫øp di·ªÖn."
                }
            },
            {
                q: "_______ you _______ to the party tomorrow?",
                options: ["Do / come", "Did / come", "Will / come", "Are / come"],
                correct: 2,
                exp: {
                    translation: "B·∫°n s·∫Ω ƒë·∫øn b·ªØa ti·ªác ng√†y mai ch·ª©?",
                    analysis: [
                        {w: "tomorrow", t: "adv", m: "ng√†y mai (T∆∞∆°ng lai)"}
                    ],
                    correctReason: "C√≥ '**tomorrow**' -> T∆∞∆°ng lai ƒë∆°n. C·∫•u tr√∫c c√¢u h·ªèi: **Will** + S + **V(nguy√™n th·ªÉ)**. -> Ch·ªçn 'Will / come'.",
                    wrongReason: "A l√† hi·ªán t·∫°i. B l√† qu√° kh·ª©. D sai ng·ªØ ph√°p (Are kh√¥ng ƒëi v·ªõi come nguy√™n th·ªÉ)."
                }
            },
            {
                q: "My father _______ TV in the living room now.",
                options: ["watch", "watches", "is watching", "watched"],
                correct: 2,
                exp: {
                    translation: "B·ªë t√¥i ƒëang xem TV ·ªü ph√≤ng kh√°ch b√¢y gi·ªù.",
                    analysis: [
                        {w: "watch", t: "v", m: "xem"},
                        {w: "now", t: "adv", m: "b√¢y gi·ªù"}
                    ],
                    correctReason: "C√≥ '**now**' -> Hi·ªán t·∫°i ti·∫øp di·ªÖn. My father (s·ªë √≠t) -> **is watching**.",
                    wrongReason: "A, B l√† hi·ªán t·∫°i ƒë∆°n (ch·ªâ th√≥i quen). D l√† qu√° kh·ª©."
                }
            },
            {
                q: "When I was a child, I _______ in Hanoi.",
                options: ["live", "lived", "living", "lives"],
                correct: 1,
                exp: {
                    translation: "Khi t√¥i c√≤n l√† m·ªôt ƒë·ª©a tr·∫ª, t√¥i ƒë√£ s·ªëng ·ªü H√† N·ªôi.",
                    analysis: [
                        {w: "When I was...", t: "phrase", m: "Khi t√¥i ƒë√£ l√†... (m·ªëc qu√° kh·ª©)"}
                    ],
                    correctReason: "M·ªánh ƒë·ªÅ 'When I was a child' x√°c ƒë·ªãnh th·ªùi gian trong qu√° kh·ª© -> ƒê·ªông t·ª´ ch√≠nh chia **Qu√° kh·ª© ƒë∆°n**. Live -> **Lived**.",
                    wrongReason: "A, C, D ƒë·ªÅu l√† d·∫°ng hi·ªán t·∫°i ho·∫∑c V-ing, kh√¥ng di·ªÖn t·∫£ qu√° kh·ª©."
                }
            },
            {
                q: "They _______ this movie 3 times.",
                options: ["see", "saw", "have seen", "has seen"],
                correct: 2,
                exp: {
                    translation: "H·ªç ƒë√£ xem b·ªô phim n√†y 3 l·∫ßn r·ªìi.",
                    analysis: [
                        {w: "3 times", t: "phrase", m: "3 l·∫ßn (ch·ªâ s·ª± l·∫∑p l·∫°i/tr·∫£i nghi·ªám)"}
                    ],
                    correctReason: "Ch·ªâ s·ªë l·∫ßn th·ª±c hi·ªán h√†nh ƒë·ªông (3 times) -> D√πng th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**. Ch·ªß ng·ªØ 'They' (s·ªë nhi·ªÅu) -> **Have seen**.",
                    wrongReason: "A hi·ªán t·∫°i. B qu√° kh·ª© ƒë∆°n (ch·ªâ d√πng khi c√≥ m·ªëc th·ªùi gian c·ª• th·ªÉ nh∆∞ yesterday). D sai tr·ª£ ƒë·ªông t·ª´ (Has d√πng cho s·ªë √≠t)."
                }
            },
            {
                q: "The sun _______ in the East.",
                options: ["rise", "rises", "rose", "is rising"],
                correct: 1,
                exp: {
                    translation: "M·∫∑t tr·ªùi m·ªçc ·ªü ƒë·∫±ng ƒê√¥ng.",
                    analysis: [
                        {w: "rise", t: "v", m: "m·ªçc"}
                    ],
                    correctReason: "ƒê√¢y l√† m·ªôt s·ª± th·∫≠t hi·ªÉn nhi√™n -> D√πng th√¨ **Hi·ªán t·∫°i ƒë∆°n**. 'The sun' (s·ªë √≠t) -> ƒê·ªông t·ª´ th√™m 's' -> **rises**.",
                    wrongReason: "A thi·∫øu 's'. C l√† qu√° kh·ª©. D l√† ti·∫øp di·ªÖn (kh√¥ng d√πng cho s·ª± th·∫≠t hi·ªÉn nhi√™n m√£i m√£i ƒë√∫ng)."
                }
            },
            {
                q: "What _______ you _______ last Sunday?",
                options: ["do / do", "did / did", "did / do", "do / did"],
                correct: 2,
                exp: {
                    translation: "B·∫°n ƒë√£ l√†m g√¨ v√†o Ch·ªß nh·∫≠t tr∆∞·ªõc?",
                    analysis: [
                        {w: "last Sunday", t: "adv", m: "Ch·ªß nh·∫≠t tr∆∞·ªõc (Qu√° kh·ª©)"}
                    ],
                    correctReason: "C√¢u h·ªèi Qu√° kh·ª© ƒë∆°n: T·ª´ ƒë·ªÉ h·ªèi + **Did** (tr·ª£ t·ª´) + S + **V(nguy√™n th·ªÉ)**. -> Ch·ªçn **did / do**.",
                    wrongReason: "A l√† hi·ªán t·∫°i. B sai ƒë·ªông t·ª´ ch√≠nh (ph·∫£i v·ªÅ nguy√™n th·ªÉ). D sai tr·ª£ ƒë·ªông t·ª´."
                }
            },
            {
                q: "I promise I _______ late again.",
                options: ["won't be", "don't be", "am not", "wasn't"],
                correct: 0,
                exp: {
                    translation: "T·ªõ h·ª©a t·ªõ s·∫Ω kh√¥ng ƒëi mu·ªôn n·ªØa ƒë√¢u.",
                    analysis: [
                        {w: "promise", t: "v", m: "h·ª©a (th∆∞·ªùng ƒëi v·ªõi T∆∞∆°ng lai ƒë∆°n)"},
                        {w: "won't", t: "modal", m: "s·∫Ω kh√¥ng (=will not)"}
                    ],
                    correctReason: "ƒê·ªông t·ª´ 'promise' (h·ª©a) th∆∞·ªùng ƒëi k√®m v·ªõi th√¨ **T∆∞∆°ng lai ƒë∆°n** (will/won't). -> **won't be**.",
                    wrongReason: "B, C l√† hi·ªán t·∫°i. D l√† qu√° kh·ª©."
                }
            },
            {
                q: "Look at the clouds! It _______ rain.",
                options: ["will", "is going to", "is", "did"],
                correct: 1,
                exp: {
                    translation: "Nh√¨n ƒë√°m m√¢y k√¨a! Tr·ªùi s·∫Øp m∆∞a r·ªìi.",
                    analysis: [
                        {w: "be going to", t: "str", m: "s·∫Øp x·∫£y ra (c√≥ d·∫´n ch·ª©ng c·ª• th·ªÉ)"}
                    ],
                    correctReason: "D·ª± ƒëo√°n t∆∞∆°ng lai d·ª±a tr√™n b·∫±ng ch·ª©ng hi·ªán t·∫°i (ƒë√°m m√¢y ƒëen) -> D√πng c·∫•u tr√∫c **be going to**. -> **is going to**.",
                    wrongReason: "A (will) d√πng cho ph·ªèng ƒëo√°n kh√¥ng cƒÉn c·ª© ho·∫∑c quy·∫øt ƒë·ªãnh ngay l√∫c n√≥i. C thi·∫øu 'going to'. D l√† qu√° kh·ª©."
                }
            },
            {
                q: "My mom usually _______ up at 6 o'clock.",
                options: ["get", "gets", "getting", "got"],
                correct: 1,
                exp: {
                    translation: "M·∫π t·ªõ th∆∞·ªùng th·ª©c d·∫≠y l√∫c 6 gi·ªù.",
                    analysis: [
                        {w: "usually", t: "adv", m: "th∆∞·ªùng xuy√™n (HTƒê)"}
                    ],
                    correctReason: "Th√≥i quen h√†ng ng√†y -> Hi·ªán t·∫°i ƒë∆°n. 'My mom' (s·ªë √≠t) -> **gets**.",
                    wrongReason: "A thi·∫øu 's'. C thi·∫øu tobe. D l√† qu√° kh·ª©."
                }
            },
            {
                q: "_______ your brother like pizza?",
                options: ["Do", "Does", "Is", "Are"],
                correct: 1,
                exp: {
                    translation: "Anh trai b·∫°n c√≥ th√≠ch pizza kh√¥ng?",
                    analysis: [
                        {w: "like", t: "v", m: "th√≠ch (ƒë·ªông t·ª´ th∆∞·ªùng)"}
                    ],
                    correctReason: "C√¢u h·ªèi hi·ªán t·∫°i ƒë∆°n v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'like'. Ch·ªß ng·ªØ 'your brother' (s·ªë √≠t ~ he) -> D√πng tr·ª£ t·ª´ **Does**.",
                    wrongReason: "A d√πng cho s·ªë nhi·ªÅu. C, D l√† tobe, kh√¥ng ƒëi v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'like' (tr·ª´ khi like l√† gi·ªõi t·ª´)."
                }
            },
            {
                q: "We _______ in the park yesterday afternoon.",
                options: ["don't walk", "didn't walk", "won't walk", "aren't walking"],
                correct: 1,
                exp: {
                    translation: "Ch√∫ng t·ªõ ƒë√£ kh√¥ng ƒëi d·∫°o trong c√¥ng vi√™n chi·ªÅu h√¥m qua.",
                    analysis: [
                        {w: "yesterday afternoon", t: "adv", m: "chi·ªÅu qua (Qu√° kh·ª©)"}
                    ],
                    correctReason: "C√¢u ph·ªß ƒë·ªãnh ·ªü th√¨ Qu√° kh·ª© ƒë∆°n: S + **didn't** + V(nguy√™n th·ªÉ). -> **didn't walk**.",
                    wrongReason: "A hi·ªán t·∫°i. C t∆∞∆°ng lai. D ti·∫øp di·ªÖn."
                }
            },
             {
                q: "Where is Nam? - He _______ books in the library.",
                options: ["reads", "read", "is reading", "has read"],
                correct: 2,
                exp: {
                    translation: "Nam ƒë√¢u r·ªìi? - C·∫≠u ·∫•y ƒëang ƒë·ªçc s√°ch trong th∆∞ vi·ªán.",
                    analysis: [
                        {w: "Where is Nam?", t: "q", m: "H·ªèi v·ªã tr√≠ hi·ªán t·∫°i -> C√¢u tr·∫£ l·ªùi ti·∫øp di·ªÖn"}
                    ],
                    correctReason: "C√¢u h·ªèi √°m ch·ªâ h√†nh ƒë·ªông ƒëang x·∫£y ra l√∫c n√†y -> Hi·ªán t·∫°i ti·∫øp di·ªÖn. -> **is reading**.",
                    wrongReason: "A ch·ªâ th√≥i quen. B sai ng·ªØ ph√°p (Nam s·ªë √≠t). D l√† ho√†n th√†nh."
                }
            },
            {
                q: "I _______ to Ho Chi Minh City next week.",
                options: ["fly", "flew", "will fly", "flying"],
                correct: 2,
                exp: {
                    translation: "T·ªõ s·∫Ω bay v√†o TP. H·ªì Ch√≠ Minh tu·∫ßn t·ªõi.",
                    analysis: [
                        {w: "next week", t: "adv", m: "tu·∫ßn t·ªõi (T∆∞∆°ng lai)"}
                    ],
                    correctReason: "D·∫•u hi·ªáu t∆∞∆°ng lai -> D√πng **will fly** (T∆∞∆°ng lai ƒë∆°n).",
                    wrongReason: "A hi·ªán t·∫°i. B qu√° kh·ª©. D thi·∫øu tobe/will."
                }
            },
            {
                q: "How long _______ you _______ English?",
                options: ["do / learn", "have / learned", "did / learn", "are / learning"],
                correct: 1,
                exp: {
                    translation: "B·∫°n ƒë√£ h·ªçc Ti·∫øng Anh ƒë∆∞·ª£c bao l√¢u r·ªìi?",
                    analysis: [
                        {w: "How long", t: "q", m: "Bao l√¢u (th∆∞·ªùng h·ªèi cho HTHT)"}
                    ],
                    correctReason: "H·ªèi v·ªÅ kho·∫£ng th·ªùi gian k√©o d√†i t·ª´ qu√° kh·ª© ƒë·∫øn hi·ªán t·∫°i -> **Hi·ªán t·∫°i ho√†n th√†nh**. -> **have / learned**.",
                    wrongReason: "A h·ªèi th√≥i quen. C h·ªèi vi·ªác ƒë√£ ch·∫•m d·ª©t trong qu√° kh·ª©. D h·ªèi vi·ªác ƒëang di·ªÖn ra (nh∆∞ng √≠t d√πng v·ªõi How long ƒë·ªÉ h·ªèi v·ªÅ t·ªïng th·ªùi gian)."
                }
            },
            {
                q: "Listen! Someone _______ at the door.",
                options: ["knock", "knocks", "is knocking", "knocked"],
                correct: 2,
                exp: {
                    translation: "Nghe k√¨a! Ai ƒë√≥ ƒëang g√µ c·ª≠a.",
                    analysis: [
                        {w: "Listen!", t: "imp", m: "Nghe k√¨a! (D·∫•u hi·ªáu HTTD)"}
                    ],
                    correctReason: "M·ªánh l·ªánh t·ª´ 'Listen!' -> H√†nh ƒë·ªông ƒëang x·∫£y ra -> **Hi·ªán t·∫°i ti·∫øp di·ªÖn**. 'Someone' (ƒë·∫°i t·ª´ b·∫•t ƒë·ªãnh coi l√† s·ªë √≠t) -> **is knocking**.",
                    wrongReason: "A, B hi·ªán t·∫°i ƒë∆°n. D qu√° kh·ª©."
                }
            },
            {
                q: "We often _______ our grandparents on Sundays.",
                options: ["visits", "visit", "visiting", "visited"],
                correct: 1,
                exp: {
                    translation: "Ch√∫ng t√¥i th∆∞·ªùng thƒÉm √¥ng b√† v√†o c√°c ng√†y Ch·ªß nh·∫≠t.",
                    analysis: [
                        {w: "often", t: "adv", m: "th∆∞·ªùng (HTƒê)"},
                        {w: "on Sundays", t: "adv", m: "l·∫∑p l·∫°i v√†o Ch·ªß nh·∫≠t"}
                    ],
                    correctReason: "Th√≥i quen l·∫∑p l·∫°i -> Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'We' (s·ªë nhi·ªÅu) -> ƒê·ªông t·ª´ nguy√™n th·ªÉ **visit**.",
                    wrongReason: "A d√πng cho s·ªë √≠t. C thi·∫øu tobe. D qu√° kh·ª©."
                }
            },
            {
                q: "_______ you go out last night?",
                options: ["Do", "Did", "Are", "Will"],
                correct: 1,
                exp: {
                    translation: "T·ªëi qua b·∫°n c√≥ ƒëi ch∆°i kh√¥ng?",
                    analysis: [
                        {w: "last night", t: "adv", m: "t·ªëi qua (Qu√° kh·ª©)"}
                    ],
                    correctReason: "C√¢u h·ªèi Yes/No th√¨ Qu√° kh·ª© ƒë∆°n -> D√πng tr·ª£ t·ª´ **Did**. -> **Did** you go...?",
                    wrongReason: "A hi·ªán t·∫°i. C tobe kh√¥ng ƒëi v·ªõi go nguy√™n th·ªÉ. D t∆∞∆°ng lai."
                }
            }
        ];

        // --- GAME LOGIC ---
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false;

        // Shuffle Function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initGame() {
            // Clone and Shuffle questions
            questions = JSON.parse(JSON.stringify(rawQuestions));
            shuffleArray(questions);
            
            // Reset state
            currentQuestionIndex = 0;
            score = 0;
            isAnswered = false;
            
            // UI Reset
            document.getElementById('result-modal').style.display = 'none';
            document.getElementById('score-count').innerText = `ƒêi·ªÉm: 0`;
            loadQuestion();
        }

        function loadQuestion() {
            isAnswered = false;
            const qData = questions[currentQuestionIndex];
            
            // Update Progress
            document.getElementById('question-count').innerText = `C√¢u: ${currentQuestionIndex + 1}/${questions.length}`;
            const percent = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;

            // Display Question
            document.getElementById('question-text').innerText = qData.q;

            // Display Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            // Hide Explanation & Next Btn
            document.getElementById('explanation-area').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';

            qData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<strong>${String.fromCharCode(65 + index)}.</strong> ${opt}`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (isAnswered) return;
            isAnswered = true;

            const qData = questions[currentQuestionIndex];
            const correctIndex = qData.correct;
            const allBtns = document.querySelectorAll('.option-btn');

            // Disable all buttons
            allBtns.forEach(btn => btn.disabled = true);

            // Logic Check
            if (selectedIndex === correctIndex) {
                // Correct
                btnElement.classList.add('correct');
                score++;
                document.getElementById('score-count').innerText = `ƒêi·ªÉm: ${score}`;
                document.getElementById('sound-correct').play();
                triggerConfetti();
            } else {
                // Wrong
                btnElement.classList.add('wrong');
                // Highlight correct one
                allBtns[correctIndex].classList.add('correct');
                document.getElementById('sound-wrong').play();
            }

            // Show Explanation
            renderExplanation(qData);
            document.getElementById('next-btn').style.display = 'block';
            
            // Scroll to explanation on mobile
            setTimeout(() => {
                document.getElementById('explanation-area').scrollIntoView({behavior: "smooth", block: "start"});
            }, 300);
        }

        function renderExplanation(qData) {
            const expDiv = document.getElementById('explanation-area');
            const expContent = document.getElementById('exp-content');
            
            // Generate Analysis HTML
            let analysisHTML = '';
            qData.exp.analysis.forEach((item, idx) => {
                let tagClass = 'tag-noun';
                if(item.t.includes('v') || item.t.includes('ƒë·ªông')) tagClass = 'tag-verb';
                if(item.t.includes('adj') || item.t.includes('t√≠nh')) tagClass = 'tag-adj';
                if(item.t.includes('adv') || item.t.includes('tr·∫°ng')) tagClass = 'tag-adv';

                analysisHTML += `<li><span class="exp-tag ${tagClass}">${item.t}</span> <strong>${item.w}:</strong> ${item.m}</li>`;
            });

            expContent.innerHTML = `
                <div style="font-style: italic; margin-bottom: 10px; color: #555;">"${qData.exp.translation}"</div>
                <h4>üîé Ph√¢n t√≠ch ƒë√°p √°n:</h4>
                <ul>${analysisHTML}</ul>
                <div class="why-correct">
                    <strong>‚úÖ T·∫°i sao ƒê√öNG:</strong><br>
                    ${qData.exp.correctReason}
                </div>
                <div class="why-wrong">
                    <strong>‚ùå T·∫°i sao SAI:</strong><br>
                    ${qData.exp.wrongReason}
                </div>
            `;
            
            expDiv.style.display = 'block';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
                document.body.scrollIntoView({behavior: "smooth", block: "start"});
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('progress-bar').style.width = '100%';
            const modal = document.getElementById('result-modal');
            const scoreDisplay = document.getElementById('final-score');
            const feedback = document.getElementById('final-feedback');
            
            scoreDisplay.innerText = `${score}/${questions.length}`;
            
            let msg = "";
            const percent = (score / questions.length) * 100;
            if(percent === 100) msg = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng·ªØ ph√°p! üåü";
            else if(percent >= 80) msg = "Gi·ªèi l·∫Øm! Ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i! üí™";
            else if(percent >= 50) msg = "Kh√° t·ªët! C·∫ßn √¥n l·∫°i v√†i th√¨ nh√©! üìö";
            else msg = "C·ªë l√™n! H√£y l√†m l·∫°i ƒë·ªÉ nh·ªõ ki·∫øn th·ª©c h∆°n nh√©! üî•";

            feedback.innerText = msg;
            modal.style.display = 'flex';
            document.getElementById('sound-finish').play();
            triggerConfetti();
        }

        function triggerConfetti() {
            var duration = 1500;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            function random(min, max) {
              return Math.random() * (max - min) + min;
            }

            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();

              if (timeLeft <= 0) {
                return clearInterval(interval);
              }

              var particleCount = 50 * (timeLeft / duration);
              // since particles fall down, start a bit higher than random
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        // Start Game
        window.onload = initGame;

    </script>
</body>
</html>