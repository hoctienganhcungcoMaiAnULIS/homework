<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh 9 - Unit 4 | Ms Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8854C0; /* T√≠m Pastel */
            --secondary-color: #00C9A7; /* Xanh Ng·ªçc */
            --correct-color: #00D26A; /* Xanh L√° */
            --wrong-color: #FF4757; /* ƒê·ªè Cam */
            --bg-color: #F0F3F8;
            --card-bg: #FFFFFF;
            --text-color: #2F3542;
            --shadow-color: rgba(0, 0, 0, 0.15);
            --btn-shadow: 0px 5px 0px 0px;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dbedf7 15%, transparent 16%), radial-gradient(#dbedf7 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 20px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.3);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            font-size: 2rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        header p {
            margin: 10px 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: white;
            padding: 15px 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px var(--shadow-color);
            font-weight: 700;
            font-size: 1.1rem;
            position: sticky;
            top: 10px;
            z-index: 100;
        }

        .score-box { color: var(--secondary-color); }
        .progress-box { color: var(--primary-color); }

        /* Question Card */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0px rgba(0,0,0,0.05), 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            position: relative;
            border: 2px solid #eee;
        }

        .question-number {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 800;
            display: inline-block;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #333;
        }

        .question-text u {
            text-decoration-color: var(--primary-color);
            text-decoration-thickness: 3px;
            text-underline-offset: 4px;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #dcdcdc;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #dcdcdc;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-color);
            border-color: #00B85C;
            color: white;
            box-shadow: 0 4px 0 #009E4F;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            border-color: #E63B4B;
            color: white;
            box-shadow: 0 4px 0 #C92D3C;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            cursor: default;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background-color: #F8F9FA;
            border-left: 5px solid var(--primary-color);
            padding: 20px;
            border-radius: 10px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .teacher-badge {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-weight: 800;
            font-size: 1.1rem;
        }

        .teacher-badge span { margin-right: 10px; font-size: 1.5rem; }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
            white-space: pre-wrap; /* Preserve line breaks */
        }
        
        .explanation-content strong {
            color: var(--primary-color);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Footer */
        .footer-controls {
            text-align: center;
            margin-top: 40px;
            padding-bottom: 40px;
        }

        .submit-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #009e83;
            transition: all 0.2s;
        }

        .submit-btn:hover { transform: scale(1.05); }
        .submit-btn:active { transform: scale(0.95) translateY(4px); box-shadow: 0 2px 0 #009e83; }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>B√†i Ki·ªÉm Tra Ti·∫øng Anh 9 - Unit 4</h1>
            <p>Gi√°o vi√™n h∆∞·ªõng d·∫´n: <strong>Ms. Mai An (ULIS)</strong></p>
        </header>

        <div class="stats-bar">
            <div class="score-box">ƒêi·ªÉm s·ªë: <span id="score">0</span></div>
            <div class="progress-box">C√¢u: <span id="current-progress">0</span>/30</div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be injected here via JavaScript -->
        </div>

        <div class="footer-controls">
            <button class="submit-btn" onclick="finishQuiz()">N·ªôp B√†i & Xem T·ªïng K·∫øt</button>
        </div>
    </div>

    <script>
        // --- 1. DATA SOURCE ---
        const quizData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "Can you ______ the definition of that word in the dictionary?",
              "answerOptions": [
                { "text": "look up", "isCorrect": true },
                { "text": "look over", "isCorrect": false },
                { "text": "look through", "isCorrect": false },
                { "text": "look at", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. look up (phrasal verb): tra c·ª©u (t·ª´ ƒëi·ªÉn, th√¥ng tin).\nB. look over (phrasal verb): xem qua, ki·ªÉm tra nhanh.\nC. look through (phrasal verb): ƒë·ªçc l∆∞·ªõt, xem l∆∞·ªõt qua.\nD. look at (phrasal verb): nh√¨n v√†o.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"B·∫°n c√≥ th·ªÉ tra c·ª©u ƒë·ªãnh nghƒ©a c·ªßa t·ª´ ƒë√≥ trong t·ª´ ƒëi·ªÉn ƒë∆∞·ª£c kh√¥ng?\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C·ª•m t·ª´ \"in the dictionary\" (trong t·ª´ ƒëi·ªÉn) l√† d·∫•u hi·ªáu cho h√†nh ƒë·ªông \"tra c·ª©u\". \"Look up\" l√† thu·∫≠t ng·ªØ chuy√™n d√πng cho vi·ªác t√¨m ki·∫øm t·ª´ v·ª±ng.\n\n4. T·∫°i sao SAI:\n- C√°c t·ª´ c√≤n l·∫°i kh√¥ng ƒëi v·ªõi ng·ªØ c·∫£nh tra t·ª´ ƒëi·ªÉn."
            },
            {
              "questionNumber": 2,
              "question": "India is a country with a rich linguistic heritage. The Indian Constitution recognizes 22 ______ languages.",
              "answerOptions": [
                { "text": "bilingual", "isCorrect": false },
                { "text": "official", "isCorrect": true },
                { "text": "first", "isCorrect": false },
                { "text": "second", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. bilingual (adj): song ng·ªØ.\nB. official (adj): ch√≠nh th·ª©c.\nC. first (adj): ƒë·∫ßu ti√™n (ti·∫øng m·∫π ƒë·∫ª).\nD. second (adj): th·ª© hai.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"·∫§n ƒê·ªô l√† m·ªôt qu·ªëc gia c√≥ di s·∫£n ng√¥n ng·ªØ phong ph√∫. Hi·∫øn ph√°p ·∫§n ƒê·ªô c√¥ng nh·∫≠n 22 ng√¥n ng·ªØ ch√≠nh th·ª©c.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Recognizes\" (c√¥ng nh·∫≠n) trong b·ªëi c·∫£nh Hi·∫øn ph√°p (Constitution) ƒëi v·ªõi \"official languages\" (ng√¥n ng·ªØ ch√≠nh th·ª©c).\n\n4. T·∫°i sao SAI:\n- Bilingual l√† ng∆∞·ªùi n√≥i 2 th·ª© ti·∫øng. First/Second kh√¥ng d√πng cho danh s√°ch ng√¥n ng·ªØ qu·ªëc gia trong hi·∫øn ph√°p."
            },
            {
              "questionNumber": 3,
              "question": "If you‚Äôre interested in visiting a historic castle in the UK, you could travel to ______, the capital of Wales.",
              "answerOptions": [
                { "text": "Cardiff", "isCorrect": true },
                { "text": "Edinburgh", "isCorrect": false },
                { "text": "Oxford", "isCorrect": false },
                { "text": "Belfast", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. Cardiff (noun): Th·ªß ƒë√¥ c·ªßa x·ª© Wales.\nB. Edinburgh (noun): Th·ªß ƒë√¥ c·ªßa Scotland.\nC. Oxford (noun): Th√†nh ph·ªë ƒë·∫°i h·ªçc ·ªü Anh.\nD. Belfast (noun): Th·ªß ƒë√¥ c·ªßa B·∫Øc Ireland.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"N·∫øu b·∫°n h·ª©ng th√∫ tham quan l√¢u ƒë√†i l·ªãch s·ª≠ ·ªü Anh, b·∫°n c√≥ th·ªÉ ƒë·∫øn Cardiff, th·ªß ƒë√¥ c·ªßa x·ª© Wales.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Cardiff l√† th·ªß ƒë√¥ c·ªßa Wales (ki·∫øn th·ª©c ƒë·ªãa l√Ω)."
            },
            {
              "questionNumber": 4,
              "question": "In China, Japan and Vietnam, English is spoken as a(n) ______ language.",
              "answerOptions": [
                { "text": "official", "isCorrect": false },
                { "text": "second", "isCorrect": false },
                { "text": "primary", "isCorrect": false },
                { "text": "foreign", "isCorrect": true }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. official (adj): ch√≠nh th·ª©c.\nB. second (adj): th·ª© hai.\nC. primary (adj): ch√≠nh/ch·ªß y·∫øu.\nD. foreign (adj): n∆∞·ªõc ngo√†i.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"·ªû Trung Qu·ªëc, Nh·∫≠t B·∫£n v√† Vi·ªát Nam, ti·∫øng Anh ƒë∆∞·ª£c n√≥i nh∆∞ m·ªôt ngo·∫°i ng·ªØ.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- ·ªû 3 n∆∞·ªõc n√†y (thu·ªôc Expanding Circle), ti·∫øng Anh l√† m√¥n h·ªçc ngo·∫°i ng·ªØ (English as a Foreign Language - EFL), kh√¥ng ph·∫£i ng√¥n ng·ªØ h√†nh ch√≠nh hay giao ti·∫øp x√£ h·ªôi ph·ªï bi·∫øn."
            },
            {
              "questionNumber": 5,
              "question": "English borrows words from many languages. ‚ÄúKaraoke‚Äù is a fun example of a word borrowed from ______.",
              "answerOptions": [
                { "text": "Spanish", "isCorrect": false },
                { "text": "French", "isCorrect": false },
                { "text": "Italian", "isCorrect": false },
                { "text": "Japanese", "isCorrect": true }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. Spanish: T√¢y Ban Nha.\nB. French: Ph√°p.\nC. Italian: √ù.\nD. Japanese: Nh·∫≠t B·∫£n.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh vay m∆∞·ª£n t·ª´ nhi·ªÅu ng√¥n ng·ªØ. 'Karaoke' l√† v√≠ d·ª• th√∫ v·ªã v·ªÅ t·ª´ m∆∞·ª£n t·ª´ ti·∫øng Nh·∫≠t.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Karaoke xu·∫•t ph√°t t·ª´ Nh·∫≠t B·∫£n (Kara = Kh√¥ng, Oke = D√†n nh·∫°c)."
            },
            {
              "questionNumber": 6,
              "question": "The teacher ______ over some mistakes that students made in their essays.",
              "answerOptions": [
                { "text": "went", "isCorrect": true },
                { "text": "caused", "isCorrect": false },
                { "text": "took", "isCorrect": false },
                { "text": "made", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. caused (verb): g√¢y ra.\nB. took (verb): l·∫•y.\nC. went (verb - qu√° kh·ª© go): ƒëi.\nD. made (verb): l√†m.\n*Phrasal verb:* go over: xem x√©t k·ªπ/ch·ªØa b√†i.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Gi√°o vi√™n ƒë√£ xem x√©t k·ªπ m·ªôt s·ªë l·ªói sai m√† h·ªçc sinh m·∫Øc ph·∫£i trong b√†i lu·∫≠n.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Go over\" (qu√° kh·ª© l√† \"went over\") nghƒ©a l√† examine/check details, r·∫•t h·ª£p v·ªõi vi·ªác s·ª≠a l·ªói b√†i t·∫≠p."
            },
            {
              "questionNumber": 7,
              "question": "English has borrowed words for many delicious dishes, like pizza from Italian and ______ from Vietnamese.",
              "answerOptions": [
                { "text": "taco", "isCorrect": false },
                { "text": "ramen", "isCorrect": false },
                { "text": "banh mi", "isCorrect": true },
                { "text": "kimchi", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. taco (noun): b√°nh Taco (Mexico).\nB. ramen (noun): m√¨ Ramen (Nh·∫≠t).\nC. banh mi (noun): b√°nh m√¨ (Vi·ªát Nam).\nD. kimchi (noun): kim chi (H√†n Qu·ªëc).\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh ƒë√£ vay m∆∞·ª£n t·ª´ v·ª±ng cho nhi·ªÅu m√≥n ƒÉn ngon, nh∆∞ pizza t·ª´ ti·∫øng √ù v√† b√°nh m√¨ t·ª´ ti·∫øng Vi·ªát.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Banh mi\" l√† t·ª´ ti·∫øng Vi·ªát ƒë√£ ƒë∆∞·ª£c Oxford c√¥ng nh·∫≠n."
            },
            {
              "questionNumber": 8,
              "question": "They invited some famous ______ to be the judges for an English debating contest.",
              "answerOptions": [
                { "text": "linguists", "isCorrect": true },
                { "text": "doctors", "isCorrect": false },
                { "text": "coaches", "isCorrect": false },
                { "text": "accountants", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. doctors (noun): b√°c sƒ©.\nB. linguists (noun): nh√† ng√¥n ng·ªØ h·ªçc.\nC. coaches (noun): hu·∫•n luy·ªán vi√™n.\nD. accountants (noun): k·∫ø to√°n.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"H·ªç ƒë√£ m·ªùi m·ªôt s·ªë nh√† ng√¥n ng·ªØ h·ªçc n·ªïi ti·∫øng l√†m gi√°m kh·∫£o cho cu·ªôc thi tranh bi·ªán ti·∫øng Anh.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Gi√°m kh·∫£o cu·ªôc thi ng√¥n ng·ªØ c·∫ßn ng∆∞·ªùi c√≥ chuy√™n m√¥n ng√¥n ng·ªØ -> Linguists."
            },
            {
              "questionNumber": 9,
              "question": "Knowing a wide range of English words helps you understand more complex ______.",
              "answerOptions": [
                { "text": "vocabulary", "isCorrect": true },
                { "text": "fluency", "isCorrect": false },
                { "text": "accent", "isCorrect": false },
                { "text": "pronunciation", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. fluency (noun): s·ª± tr√¥i ch·∫£y.\nB. accent (noun): gi·ªçng ƒëi·ªáu.\nC. vocabulary (noun): t·ª´ v·ª±ng.\nD. pronunciation (noun): ph√°t √¢m.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Bi·∫øt nhi·ªÅu t·ª´ ti·∫øng Anh gi√∫p b·∫°n hi·ªÉu ƒë∆∞·ª£c c√°c t·ª´ v·ª±ng ph·ª©c t·∫°p h∆°n.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Bi·∫øt nhi·ªÅu t·ª´ (range of words) t∆∞∆°ng ·ª©ng v·ªõi v·ªën t·ª´ v·ª±ng (vocabulary). Pronunciation, accent, fluency l√† k·ªπ nƒÉng n√≥i."
            },
            {
              "questionNumber": 10,
              "question": "English was the ______ that the three tribes spoke after they settled in Britain.",
              "answerOptions": [
                { "text": "language", "isCorrect": true },
                { "text": "voice", "isCorrect": false },
                { "text": "speech", "isCorrect": false },
                { "text": "statement", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. voice (noun): gi·ªçng n√≥i.\nB. speech (noun): l·ªùi n√≥i.\nC. statement (noun): tuy√™n b·ªë.\nD. language (noun): ng√¥n ng·ªØ.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh l√† ng√¥n ng·ªØ m√† ba b·ªô t·ªôc ƒë√£ n√≥i sau khi h·ªç ƒë·ªãnh c∆∞ ·ªü Anh.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ti·∫øng Anh l√† m·ªôt h·ªá th·ªëng giao ti·∫øp chung -> Language."
            },
            {
              "questionNumber": 11,
              "question": "The English language today has progressed through several ______ throughout history.",
              "answerOptions": [
                { "text": "forms", "isCorrect": true },
                { "text": "versions", "isCorrect": false },
                { "text": "generations", "isCorrect": false },
                { "text": "drafts", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. versions: phi√™n b·∫£n (ph·∫ßn m·ªÅm/s√°ch).\nB. generations: th·∫ø h·ªá (ng∆∞·ªùi).\nC. drafts: b·∫£n nh√°p.\nD. forms: h√¨nh th·ª©c/d·∫°ng.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ng√¥n ng·ªØ ti·∫øng Anh ng√†y nay ƒë√£ ph√°t tri·ªÉn qua nhi·ªÅu h√¨nh th·ª©c trong su·ªët l·ªãch s·ª≠.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ti·∫øng Anh c√≥ c√°c \"forms\" (d·∫°ng) nh∆∞ Old, Middle, Modern English. \"Forms\" l√† t·ª´ ch√≠nh x√°c nh·∫•t v·ªÅ m·∫∑t ng√¥n ng·ªØ h·ªçc l·ªãch s·ª≠."
            },
            {
              "questionNumber": 12,
              "question": "Many people believe that the Angles, Saxons, and Jutes ______ English.",
              "answerOptions": [
                { "text": "invented", "isCorrect": true },
                { "text": "made", "isCorrect": false },
                { "text": "discovered", "isCorrect": false },
                { "text": "found", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. invented (verb): ph√°t minh/s√°ng t·∫°o ra.\nB. made (verb): l√†m ra.\nC. discovered (verb): kh√°m ph√° ra.\nD. found (verb): t√¨m th·∫•y.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Nhi·ªÅu ng∆∞·ªùi tin r·∫±ng ng∆∞·ªùi Angles, Saxons v√† Jutes ƒë√£ s√°ng t·∫°o ra ti·∫øng Anh.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Trong b·ªëi c·∫£nh ngu·ªìn g·ªëc, \"invented\" ƒë∆∞·ª£c d√πng ƒë·ªÉ ch·ªâ vi·ªác c√°c b·ªô t·ªôc n√†y t·∫°o ra n·ªÅn t·∫£ng ng√¥n ng·ªØ m·ªõi (t·ª´ con s·ªë 0 ho·∫∑c k·∫øt h·ª£p c√°c ph∆∞∆°ng ng·ªØ)."
            },
            {
              "questionNumber": 13,
              "question": "Another way of conceptualizing learning in English is to view it through the lens of the various ______ of the subject.",
              "answerOptions": [
                { "text": "varieties", "isCorrect": true },
                { "text": "rules", "isCorrect": false },
                { "text": "standards", "isCorrect": false },
                { "text": "models", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. varieties (noun): c√°c bi·∫øn th·ªÉ.\nB. rules (noun): quy t·∫Øc.\nC. standards (noun): ti√™u chu·∫©n.\nD. models (noun): m√¥ h√¨nh.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"M·ªôt c√°ch kh√°c ƒë·ªÉ h√¨nh dung vi·ªác h·ªçc ti·∫øng Anh l√† nh√¨n n√≥ qua lƒÉng k√≠nh c·ªßa c√°c bi·∫øn th·ªÉ kh√°c nhau c·ªßa m√¥n h·ªçc n√†y.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Varieties of English\" (Anh-Anh, Anh-M·ªπ, Anh-√öc...) l√† thu·∫≠t ng·ªØ chuy√™n ng√†nh."
            },
            {
              "questionNumber": 14,
              "question": "I can ______ the document into multiple languages to cater to a global audience.",
              "answerOptions": [
                { "text": "translate", "isCorrect": true },
                { "text": "copy", "isCorrect": false },
                { "text": "get", "isCorrect": false },
                { "text": "look", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. copy (verb): sao ch√©p.\nB. translate (verb): d·ªãch.\nC. get (verb): l·∫•y.\nD. look (verb): nh√¨n.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"T√¥i c√≥ th·ªÉ d·ªãch t√†i li·ªáu sang nhi·ªÅu ng√¥n ng·ªØ ƒë·ªÉ ph·ª•c v·ª• kh√°n gi·∫£ to√†n c·∫ßu.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C·∫•u tr√∫c \"translate ... into\" (d·ªãch sang) l√† ch√≠nh x√°c."
            },
            {
              "questionNumber": 15,
              "question": "When I was in France, I ______ some French words.",
              "answerOptions": [
                { "text": "picked up", "isCorrect": true },
                { "text": "held up", "isCorrect": false },
                { "text": "copied up", "isCorrect": false },
                { "text": "got up", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. held up: tr√¨ ho√£n.\nB. copied up: ch√©p l·∫°i.\nC. got up: th·ª©c d·∫≠y.\nD. picked up: h·ªçc l·ªèm/h·ªçc nhanh.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Khi t√¥i ·ªü Ph√°p, t√¥i ƒë√£ h·ªçc ƒë∆∞·ª£c (b·ªè t√∫i) m·ªôt v√†i t·ª´ ti·∫øng Ph√°p.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Pick up a language\" nghƒ©a l√† h·ªçc m·ªôt c√°ch t·ª± nhi√™n qua m√¥i tr∆∞·ªùng s·ªëng, kh√¥ng qua tr∆∞·ªùng l·ªõp ch√≠nh quy."
            },
            {
              "questionNumber": 16,
              "question": "Chinese and English are both ______ languages of Hong Kong under the Hong Kong Basic Law.",
              "answerOptions": [
                { "text": "official", "isCorrect": true },
                { "text": "first", "isCorrect": false },
                { "text": "original", "isCorrect": false },
                { "text": "foreign", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. first (adj): th·ª© nh·∫•t.\nB. original (adj): g·ªëc.\nC. foreign (adj): n∆∞·ªõc ngo√†i.\nD. official (adj): ch√≠nh th·ª©c.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Trung v√† Ti·∫øng Anh ƒë·ªÅu l√† ng√¥n ng·ªØ ch√≠nh th·ª©c c·ªßa H·ªìng K√¥ng theo Lu·∫≠t C∆° b·∫£n.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ng√¥n ng·ªØ d√πng trong lu·∫≠t ph√°p/h√†nh ch√≠nh l√† \"official languages\"."
            },
            {
              "questionNumber": 17,
              "question": "English belongs to the Germanic language ______.",
              "answerOptions": [
                { "text": "family", "isCorrect": true },
                { "text": "tree", "isCorrect": false },
                { "text": "origin", "isCorrect": false },
                { "text": "root", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. tree (noun): c√¢y.\nB. family (noun): gia ƒë√¨nh (h·ªç ng√¥n ng·ªØ).\nC. origin (noun): ngu·ªìn g·ªëc.\nD. root (noun): r·ªÖ.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh thu·ªôc v·ªÅ h·ªá (gia ƒë√¨nh) ng√¥n ng·ªØ Germanic.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Language family\" l√† thu·∫≠t ng·ªØ ch·ªâ h·ªá/h·ªç ng√¥n ng·ªØ."
            },
            {
              "questionNumber": 18,
              "question": "You can always translate English documents ______ your own languages for better understanding.",
              "answerOptions": [
                { "text": "into", "isCorrect": true },
                { "text": "onto", "isCorrect": false },
                { "text": "to", "isCorrect": false },
                { "text": "in", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. onto: l√™n tr√™n.\nB. into: v√†o trong/th√†nh (chuy·ªÉn ƒë·ªïi).\nC. to: t·ªõi.\nD. in: trong.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"B·∫°n lu√¥n c√≥ th·ªÉ d·ªãch t√†i li·ªáu ti·∫øng Anh sang ng√¥n ng·ªØ c·ªßa m√¨nh ƒë·ªÉ hi·ªÉu r√µ h∆°n.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C·∫•u tr√∫c: \"Translate A into B\" (D·ªãch A sang B)."
            },
            {
              "questionNumber": 19,
              "question": "Australian English is spoken as the ______ language by most people in Australia.",
              "answerOptions": [
                { "text": "first", "isCorrect": true },
                { "text": "second", "isCorrect": false },
                { "text": "foreign", "isCorrect": false },
                { "text": "international", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. first (adj): th·ª© nh·∫•t (m·∫π ƒë·∫ª).\nB. second (adj): th·ª© hai.\nC. foreign (adj): n∆∞·ªõc ngo√†i.\nD. international (adj): qu·ªëc t·∫ø.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh √öc ƒë∆∞·ª£c h·∫ßu h·∫øt ng∆∞·ªùi d√¢n √öc n√≥i nh∆∞ ng√¥n ng·ªØ m·∫π ƒë·∫ª.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- √öc l√† n∆∞·ªõc thu·ªôc Inner Circle (n√≥i ti·∫øng Anh b·∫£n ng·ªØ) -> First language."
            },
            {
              "questionNumber": 20,
              "question": "A ______ dictionary is a specialized dictionary used to translate words or phrases from one language to another.",
              "answerOptions": [
                { "text": "bilingual", "isCorrect": true },
                { "text": "multilingual", "isCorrect": false },
                { "text": "monolingual", "isCorrect": false },
                { "text": "trilingual", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. bilingual (adj): song ng·ªØ.\nB. multilingual (adj): ƒëa ng·ªØ.\nC. monolingual (adj): ƒë∆°n ng·ªØ.\nD. trilingual (adj): tam ng·ªØ.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"T·ª´ ƒëi·ªÉn song ng·ªØ l√† lo·∫°i t·ª´ ƒëi·ªÉn chuy√™n d·ª•ng d√πng ƒë·ªÉ d·ªãch t·ª´ t·ª´ ng√¥n ng·ªØ n√†y sang ng√¥n ng·ªØ kh√°c.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"From one language to another\" nghƒ©a l√† t·ª´ 1 sang 1 (t·ªïng 2 ng√¥n ng·ªØ) -> Bilingual."
            },
            {
              "questionNumber": 21,
              "question": "Many English speakers around the world are surprised to learn that the most popular sport played with a ground ball is called ‚Äú______‚Äù in the US.",
              "answerOptions": [
                { "text": "soccer", "isCorrect": true },
                { "text": "baseball", "isCorrect": false },
                { "text": "football", "isCorrect": false },
                { "text": "basketball", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. soccer (noun): b√≥ng ƒë√° (M·ªπ).\nB. baseball (noun): b√≥ng ch√†y.\nC. football (noun): b√≥ng b·∫ßu d·ª•c M·ªπ.\nD. basketball (noun): b√≥ng r·ªï.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Nhi·ªÅu ng∆∞·ªùi ng·∫°c nhi√™n khi bi·∫øt m√¥n th·ªÉ thao ch∆°i b√≥ng tr√™n s√¢n c·ªè ph·ªï bi·∫øn nh·∫•t g·ªçi l√† 'soccer' ·ªü M·ªπ.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- ·ªû M·ªπ, \"football\" l√† b√≥ng b·∫ßu d·ª•c, c√≤n b√≥ng ƒë√° (ƒë√° b·∫±ng ch√¢n) ƒë∆∞·ª£c g·ªçi l√† \"soccer\"."
            },
            {
              "questionNumber": 22,
              "question": "Let's ______ the details of the project during our meeting tomorrow.",
              "answerOptions": [
                { "text": "go over", "isCorrect": true },
                { "text": "go up", "isCorrect": false },
                { "text": "go down", "isCorrect": false },
                { "text": "go on", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. go up: tƒÉng.\nB. go over: xem x√©t k·ªπ.\nC. go down: gi·∫£m.\nD. go on: ti·∫øp t·ª•c.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"H√£y c√πng xem x√©t k·ªπ c√°c chi ti·∫øt c·ªßa d·ª± √°n trong cu·ªôc h·ªçp ng√†y mai.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Go over = examine/discuss details (xem x√©t k·ªπ)."
            },
            {
              "questionNumber": 23,
              "question": "The United Kingdom is made up of four countries: England, ______, Wales and Northern Ireland.",
              "answerOptions": [
                { "text": "Scotland", "isCorrect": true },
                { "text": "Canada", "isCorrect": false },
                { "text": "Ireland", "isCorrect": false },
                { "text": "New Zealand", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. Canada: Ca-na-ƒëa.\nB. Scotland: Xc·ªët-len.\nC. Ireland: C·ªông h√≤a Ai-len.\nD. New Zealand: Niu Di-l√¢n.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"V∆∞∆°ng qu·ªëc Anh ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ b·ªën qu·ªëc gia: Anh, Scotland, x·ª© Wales v√† B·∫Øc Ireland.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Scotland l√† th√†nh ph·∫ßn c·ªßa UK (United Kingdom). Ireland l√† qu·ªëc gia ƒë·ªôc l·∫≠p."
            },
            {
              "questionNumber": 24,
              "question": "Learning the English parts of speech is a must if you want to learn ______.",
              "answerOptions": [
                { "text": "grammar", "isCorrect": true },
                { "text": "pronunciation", "isCorrect": false },
                { "text": "vocabulary", "isCorrect": false },
                { "text": "speaking", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. pronunciation: ph√°t √¢m.\nB. vocabulary: t·ª´ v·ª±ng.\nC. speaking: n√≥i.\nD. grammar: ng·ªØ ph√°p.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"H·ªçc v·ªÅ c√°c t·ª´ lo·∫°i (danh, ƒë·ªông, t√≠nh, tr·∫°ng...) l√† ƒëi·ªÅu b·∫Øt bu·ªôc n·∫øu b·∫°n mu·ªën h·ªçc ng·ªØ ph√°p.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Parts of speech (t·ª´ lo·∫°i) l√† c·∫•u tr√∫c c·ªët l√µi ƒë·ªÉ h√¨nh th√†nh c√¢u ƒë√∫ng ng·ªØ ph√°p."
            },
            {
              "questionNumber": 25,
              "question": "Besides Spanish, her ______ tongue, she can also speak Portuguese and English.",
              "answerOptions": [
                { "text": "mother", "isCorrect": true },
                { "text": "foreign", "isCorrect": false },
                { "text": "accent", "isCorrect": false },
                { "text": "first", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. foreign: n∆∞·ªõc ngo√†i.\nB. accent: gi·ªçng.\nC. first: th·ª© nh·∫•t.\nD. mother: m·∫π.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ngo√†i ti·∫øng T√¢y Ban Nha, ti·∫øng m·∫π ƒë·∫ª c·ªßa c√¥ ·∫•y, c√¥ ·∫•y c√≤n c√≥ th·ªÉ n√≥i ti·∫øng B·ªì ƒê√†o Nha v√† ti·∫øng Anh.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Idiom: \"Mother tongue\" = Ti·∫øng m·∫π ƒë·∫ª. D√π \"First language\" ƒë√∫ng nghƒ©a nh∆∞ng kh√¥ng ƒëi v·ªõi \"tongue\"."
            },
            {
              "questionNumber": 26,
              "question": "People started ______ English around 650 C.E.",
              "answerOptions": [
                { "text": "speaking", "isCorrect": true },
                { "text": "using", "isCorrect": false },
                { "text": "talking", "isCorrect": false },
                { "text": "communicating", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. using: d√πng.\nB. talking: n√≥i chuy·ªán.\nC. speaking: n√≥i (ng√¥n ng·ªØ).\nD. communicating: giao ti·∫øp.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"M·ªçi ng∆∞·ªùi b·∫Øt ƒë·∫ßu n√≥i ti·∫øng Anh v√†o kho·∫£ng nƒÉm 650 sau C√¥ng nguy√™n.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Collocation: Speak + Language (Speak English) l√† chu·∫©n nh·∫•t. Talking/Communicating th∆∞·ªùng c·∫ßn gi·ªõi t·ª´ (in English)."
            },
            {
              "questionNumber": 27,
              "question": "One example of ______ words is the word ‚Äúballet‚Äù, which comes from French.",
              "answerOptions": [
                { "text": "borrowed", "isCorrect": true },
                { "text": "lent", "isCorrect": false },
                { "text": "foreign", "isCorrect": false },
                { "text": "compound", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. lent: cho m∆∞·ª£n.\nB. foreign: n∆∞·ªõc ngo√†i.\nC. borrowed: vay m∆∞·ª£n.\nD. compound: gh√©p.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"M·ªôt v√≠ d·ª• v·ªÅ t·ª´ m∆∞·ª£n l√† t·ª´ 'ballet', t·ª´ n√†y xu·∫•t ph√°t t·ª´ ti·∫øng Ph√°p.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Borrowed words = Loan words = T·ª´ m∆∞·ª£n."
            },
            {
              "questionNumber": 28,
              "question": "The English language is descended ______ the Proto-Indo-European language.",
              "answerOptions": [
                { "text": "from", "isCorrect": true },
                { "text": "to", "isCorrect": false },
                { "text": "back", "isCorrect": false },
                { "text": "down", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. to: t·ªõi.\nB. back: quay l·∫°i.\nC. down: xu·ªëng.\nD. from: t·ª´.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Ti·∫øng Anh c√≥ ngu·ªìn g·ªëc t·ª´ ng√¥n ng·ªØ Ti·ªÅn-·∫§n-√Çu.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C·∫•u tr√∫c: \"Descended from\" = C√≥ ngu·ªìn g·ªëc t·ª´, b·∫Øt ngu·ªìn t·ª´."
            },
            {
              "questionNumber": 29,
              "question": "______ to the United States have to pass a test of competence in English.",
              "answerOptions": [
                { "text": "Immigrants", "isCorrect": true },
                { "text": "Migration", "isCorrect": false },
                { "text": "Migrants", "isCorrect": false },
                { "text": "Immigration", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. Immigrants (noun): Ng∆∞·ªùi nh·∫≠p c∆∞ (ƒë·∫øn ·ªü h·∫≥n).\nB. Migration (noun): S·ª± di c∆∞.\nC. Migrants (noun): Ng∆∞·ªùi di c∆∞ (chung chung/t·∫°m th·ªùi).\nD. Immigration (noun): S·ª± nh·∫≠p c∆∞.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"Nh·ªØng ng∆∞·ªùi nh·∫≠p c∆∞ v√†o Hoa K·ª≥ ph·∫£i v∆∞·ª£t qua m·ªôt b√†i ki·ªÉm tra nƒÉng l·ª±c ti·∫øng Anh.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C·∫ßn danh t·ª´ ch·ªâ ng∆∞·ªùi l√†m ch·ªß ng·ªØ. \"Immigrants to the US\" l√† c·ª•m t·ª´ ch√≠nh x√°c ch·ªâ nh·ªØng ng∆∞·ªùi chuy·ªÉn ƒë·∫øn M·ªπ ƒë·ªãnh c∆∞."
            },
            {
              "questionNumber": 30,
              "question": "With so many online resources available, it‚Äôs easier than ever to ______ basic English on your own.",
              "answerOptions": [
                { "text": "pick up", "isCorrect": true },
                { "text": "look up", "isCorrect": false },
                { "text": "go over", "isCorrect": false },
                { "text": "copy", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\nA. look up: tra c·ª©u.\nB. go over: xem l·∫°i.\nC. pick up: h·ªçc ƒë∆∞·ª£c/n·∫Øm b·∫Øt ƒë∆∞·ª£c nhanh.\nD. copy: sao ch√©p.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"V·ªõi qu√° nhi·ªÅu t√†i nguy√™n tr·ª±c tuy·∫øn, vi·ªác t·ª± h·ªçc (n·∫Øm b·∫Øt) ti·∫øng Anh c∆° b·∫£n d·ªÖ d√†ng h∆°n bao gi·ªù h·∫øt.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Pick up = Learn naturally/easily without formal instruction. Ph√π h·ª£p ng·ªØ c·∫£nh \"on your own\" (t·ª± h·ªçc)."
            }
          ]
        };

        // --- 2. LOGIC ---
        let score = 0;
        let answeredCount = 0;
        const totalQuestions = quizData.questions.length;
        
        // Audio Objects (Using Base64 for single file portability)
        // Short beep for correct
        const correctSound = new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbqWEzM2CfutmuYDY0YJ+62a5gNjRgn7rZrmA2NGCfutmuYDY0YJ+62a5gNjRgn7rZrmA2NGCfutmuYDY0YJ+62a5gNjRgAAAAAA=="); 
        // We will just use a visual cue mainly, but here is a simple function for synthetic sound
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Shuffle function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initQuiz() {
            const container = document.getElementById('quiz-container');
            // Shuffle questions
            const shuffledQuestions = [...quizData.questions];
            shuffleArray(shuffledQuestions);

            shuffledQuestions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-${index}`;

                // Parse Rationale to HTML (convert \n to <br>)
                const rationaleHtml = q.rationale.replace(/\n/g, '<br>');

                // Format Question Text (Handle blanks)
                // If question has '______', we keep it as is.
                
                card.innerHTML = `
                    <div class="question-number">C√¢u ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid" id="opt-grid-${index}">
                        <!-- Options injected here -->
                    </div>
                    <div class="explanation-box" id="exp-${index}">
                        <div class="teacher-badge"><span>üë©‚Äçüè´</span> C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="explanation-content">${rationaleHtml}</div>
                    </div>
                `;

                container.appendChild(card);
                
                // --- NEW SHUFFLE LOGIC FOR OPTIONS ---
                // Clone the options array so we don't mess up the original order permanently (optional but good practice)
                const shuffledOptions = [...q.answerOptions];
                shuffleArray(shuffledOptions);

                // Render Options
                const optGrid = document.getElementById(`opt-grid-${index}`);
                shuffledOptions.forEach((opt, optIndex) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt.text;
                    // Note: We still pass shuffledOptions to checkAnswer so the loop inside checkAnswer works correctly
                    btn.onclick = () => checkAnswer(btn, opt.isCorrect, index, shuffledOptions);
                    optGrid.appendChild(btn);
                });
            });
        }

        function checkAnswer(selectedBtn, isCorrect, questionIndex, allOptions) {
            const optGrid = document.getElementById(`opt-grid-${questionIndex}`);
            const buttons = optGrid.getElementsByClassName('option-btn');
            const expBox = document.getElementById(`exp-${questionIndex}`);

            // Prevent re-answering
            if (selectedBtn.classList.contains('disabled')) return;

            // Disable all buttons in this card
            for (let btn of buttons) {
                btn.classList.add('disabled');
                // Highlight the correct answer anyway if user chose wrong
                const optText = btn.innerText;
                const optData = allOptions.find(o => o.text === optText);
                if (optData.isCorrect) {
                    btn.classList.add('correct');
                }
            }

            if (isCorrect) {
                // selectedBtn.classList.add('correct'); // Already handled above loop logic slightly
                playSound('correct');
                fireConfetti(selectedBtn);
                score++;
                document.getElementById('score').innerText = score;
            } else {
                selectedBtn.classList.add('wrong');
                playSound('wrong');
            }

            answeredCount++;
            document.getElementById('current-progress').innerText = answeredCount;

            // Show explanation
            expBox.style.display = 'block';
        }

        // --- 3. CONFETTI EFFECT ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let confetti = [];

        function fireConfetti(element) {
            const rect = element.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;

            for (let i = 0; i < 30; i++) {
                confetti.push({
                    x: x,
                    y: y,
                    dx: (Math.random() - 0.5) * 10,
                    dy: (Math.random() - 1) * 10,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 5 + 3,
                    life: 100
                });
            }
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < confetti.length; i++) {
                const p = confetti[i];
                p.x += p.dx;
                p.y += p.dy;
                p.dy += 0.2; // Gravity
                p.life--;
                p.size *= 0.96;

                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) {
                    confetti.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(updateConfetti);
        }
        updateConfetti();

        // --- 4. FINISH QUIZ ---
        function finishQuiz() {
            const percentage = Math.round((score / totalQuestions) * 100);
            let message = "";
            if (percentage === 100) message = "Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng√¥n ng·ªØ! üåü";
            else if (percentage >= 80) message = "L√†m t·ªët l·∫Øm! Em r·∫•t chƒÉm ch·ªâ! üí™";
            else if (percentage >= 50) message = "C·ªë g·∫Øng l√™n! Em ƒëang ti·∫øn b·ªô t·ª´ng ng√†y! üå±";
            else message = "ƒê·ª´ng n·∫£n ch√≠! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch nh√©! üìö";

            alert(`T·ªîNG K·∫æT\n\nS·ªë c√¢u ƒë√∫ng: ${score}/${totalQuestions}\n${message}`);
        }

        // Resize canvas on window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Start
        window.onload = initQuiz;

    </script>
</body>
</html>
