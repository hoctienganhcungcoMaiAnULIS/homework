<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIT 7. TRAFFIC - TEST 02</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: linear-gradient(135deg, #8854C0, #FFD700, #00C9A7);
            --card-bg: rgba(255, 255, 255, 0.95);
            --correct-color: #00D26A;
            --incorrect-color: #FF4757;
            --text-main: #2d3436;
            --shadow: 0 6px 0 rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--primary-bg);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Nền chấm bi mờ vui nhộn */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(rgba(255,255,255,0.2) 2px, transparent 2px);
            background-size: 30px 30px;
            z-index: -1;
        }

        .header-title {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .header-title h1 { font-size: 2.5rem; margin: 0; font-weight: 900; }
        .header-title h3 { font-size: 1.2rem; margin: 5px 0 20px 0; background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 20px; display: inline-block; }

        .quiz-container {
            width: 100%;
            max-width: 800px;
        }

        .question-card, .passage-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            background-color: #f1f2f6;
            color: #2f3640;
            border: 2px solid #dfe4ea;
            border-radius: 15px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 6px 0 #ced6e0;
            text-align: left;
        }

        .option-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 0 #ced6e0;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #ced6e0;
        }

        .option-btn.correct {
            background-color: var(--correct-color) !important;
            color: white !important;
            border-color: #00b85c !important;
            box-shadow: 0 6px 0 #009e50 !important;
        }

        .option-btn.incorrect {
            background-color: var(--incorrect-color) !important;
            color: white !important;
            border-color: #ff3b4a !important;
            box-shadow: 0 6px 0 #d63031 !important;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }

        /* Gap Fill Styles */
        .passage-text {
            font-size: 1.2rem;
            line-height: 1.8;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed #a29bfe;
        }

        .gap-fill {
            display: inline-block;
            background: #ffeaa7;
            padding: 2px 15px;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 4px 0 #fdcb6e;
            transition: all 0.2s;
            color: #d63031;
        }
        
        .gap-fill:hover { transform: scale(1.1); }
        .gap-fill.correct { background: var(--correct-color); color: white; box-shadow: 0 4px 0 #009e50; pointer-events: none;}
        .gap-fill.incorrect { background: var(--incorrect-color); color: white; box-shadow: 0 4px 0 #d63031; animation: shake 0.4s;}

        /* Popup Modal */
        #gapModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        /* Explanation Box */
        .explanation-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-left: 6px solid #a29bfe;
            border-radius: 10px;
            font-size: 1.05rem;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
        }

        .explanation-box h4 { margin-top: 0; color: #6c5ce7; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;}
        .explanation-box b { color: #2d3436; }
        .explanation-box p { margin: 8px 0; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CSS Art - Q29 Speed Limit */
        .sign-speed-limit {
            width: 150px;
            height: 200px;
            background-color: #FFA500;
            border: 6px solid #000;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            color: #000;
            font-family: Arial, sans-serif;
            font-weight: 900;
            text-align: center;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
        }
        .sign-speed-limit .text1 { font-size: 28px; line-height: 1.1; margin-bottom: 10px; }
        .sign-speed-limit .number { font-size: 60px; line-height: 1; }

        /* CSS Art - Q30 Restricted Area */
        .sign-restricted {
            width: 260px;
            height: 160px;
            background-color: #fff;
            border: 4px solid #cc0000;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            margin: 0 auto 20px auto;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        .sign-restricted .top {
            background-color: #cc0000;
            color: #fff;
            font-size: 24px;
            font-weight: 900;
            text-align: center;
            padding: 10px 0;
            line-height: 1.1;
        }
        .sign-restricted .bottom {
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 10px;
            height: 100%;
        }
        .sign-restricted .icon-circle {
            width: 60px;
            height: 60px;
            border: 6px solid #cc0000;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
        }
        .sign-restricted .icon-circle::after {
            content: "";
            position: absolute;
            width: 80px;
            height: 6px;
            background-color: #cc0000;
            transform: rotate(-45deg);
        }
        .sign-restricted .keep-out {
            font-size: 32px;
            font-weight: 900;
            color: #000;
            text-align: center;
            line-height: 1.1;
        }

        /* Submit Button */
        .submit-btn {
            background-color: #fdcb6e;
            color: #2d3436;
            font-size: 1.5rem;
            font-weight: 900;
            padding: 20px 40px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 0 #e1b12c;
            margin: 20px 0 50px 0;
            transition: all 0.2s;
        }
        .submit-btn:hover { transform: scale(1.05); box-shadow: 0 10px 0 #e1b12c; }
        .submit-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #e1b12c; }

        /* Score Popup */
        #scoreModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .score-content {
            background: linear-gradient(135deg, #fff, #f1f2f6);
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            font-size: 1.5rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .score-content h1 { color: #6c5ce7; font-size: 3rem; margin-bottom: 10px; }
        .score-content p { font-weight: 700; color: #2d3436; }
        
        /* Confetti Container */
        #confetti-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .confetti-piece {
            position: absolute;
            width: 10px; height: 20px;
            background: #ffd300;
            opacity: 0;
        }

        @media (max-width: 600px) {
            .options-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="header-title">
        <h1>UNIT 7. TRAFFIC</h1>
        <h2>TEST 02</h2>
        <h3>Giáo viên tạo: Ms Mai An ULIS</h3>
    </div>

    <div class="quiz-container" id="quiz-container">
        <div class="question-card" data-q="1">
            <div class="question-text">Mark the letter A, B, C or D on your answer sheet to indicate the word whose underlined part differs from the other three in pronunciation.<br><br>Question 1.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. b<u>a</u>nd</button>
                <button class="option-btn" data-val="B">B. f<u>a</u>n</button>
                <button class="option-btn" data-val="C">C. c<u>a</u>ptain</button>
                <button class="option-btn" data-val="D" data-correct="true">D. d<u>a</u>te</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch:</b> Chọn từ có phần gạch chân phát âm khác với các từ còn lại.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. b<u>a</u>nd (n): ban nhạc (phát âm là /æ/)<br>
                B. f<u>a</u>n (n): người hâm mộ (phát âm là /æ/)<br>
                C. c<u>a</u>ptain (n): đội trưởng (phát âm là /æ/)<br>
                D. d<u>a</u>te (n): ngày tháng (phát âm là /eɪ/)</p>
                <p><b>3. Tại sao chọn D:</b> Phần gạch chân ở đáp án D được phát âm là nguyên âm đôi /eɪ/.</p>
                <p><b>4. Tại sao 3 đáp án kia sai:</b> Các đáp án A, B, C đều có phần gạch chân phát âm là âm /æ/ bẹt.</p>
            </div>
        </div>

        <div class="question-card" data-q="2">
            <div class="question-text">Question 2.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. na<u>tion</u></button>
                <button class="option-btn" data-val="B">B. man<u>sion</u></button>
                <button class="option-btn" data-val="C" data-correct="true">C. inva<u>sion</u></button>
                <button class="option-btn" data-val="D">D. transla<u>tion</u></button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch:</b> Chọn từ có phần gạch chân phát âm khác với các từ còn lại.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. na<u>tion</u> (n): quốc gia (phát âm /ʃ/)<br>
                B. man<u>sion</u> (n): biệt thự (phát âm /ʃ/)<br>
                C. inva<u>sion</u> (n): sự xâm lược (phát âm /ʒ/)<br>
                D. transla<u>tion</u> (n): bản dịch (phát âm /ʃ/)</p>
                <p><b>3. Tại sao chọn C:</b> Đuôi "-sion" trong từ invasion phát âm là âm hữu thanh /ʒ/.</p>
                <p><b>4. Tại sao 3 đáp án kia sai:</b> A, B, D đều có đuôi phát âm là âm vô thanh /ʃ/ (sờ nặng).</p>
            </div>
        </div>

        <div class="question-card" data-q="3">
            <div class="question-text">Mark the letter A, B, C or D on your answer sheet to indicate the word that differs from the other three in the position of primary stress.<br><br>Question 3:</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. obey</button>
                <button class="option-btn" data-val="B" data-correct="true">B. suffer</button>
                <button class="option-btn" data-val="C">C. allow</button>
                <button class="option-btn" data-val="D">D. promote</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch:</b> Chọn từ có vị trí trọng âm khác với các từ còn lại.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. obey /əˈbeɪ/ (v): vâng lời (Trọng âm 2)<br>
                B. suffer /ˈsʌf.ər/ (v): chịu đựng (Trọng âm 1)<br>
                C. allow /əˈlaʊ/ (v): cho phép (Trọng âm 2)<br>
                D. promote /prəˈməʊt/ (v): thúc đẩy (Trọng âm 2)</p>
                <p><b>3. Tại sao chọn B:</b> Từ "suffer" có trọng âm rơi vào âm tiết thứ nhất.</p>
                <p><b>4. Tại sao 3 đáp án kia sai:</b> A, C, D đều là động từ 2 âm tiết và theo quy tắc, trọng âm thường rơi vào âm tiết thứ 2.</p>
            </div>
        </div>

        <div class="question-card" data-q="4">
            <div class="question-text">Question 4.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. limit</button>
                <button class="option-btn" data-val="B">B. protect</button>
                <button class="option-btn" data-val="C">C. reverse</button>
                <button class="option-btn" data-val="D">D. allow</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch:</b> Chọn từ có vị trí trọng âm khác.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. limit /ˈlɪm.ɪt/ (v/n): giới hạn (Trọng âm 1)<br>
                B. protect /prəˈtekt/ (v): bảo vệ (Trọng âm 2)<br>
                C. reverse /rɪˈvɜːs/ (v/n): đảo ngược (Trọng âm 2)<br>
                D. allow /əˈlaʊ/ (v): cho phép (Trọng âm 2)</p>
                <p><b>3. Tại sao chọn A:</b> "Limit" có trọng âm rơi vào âm tiết đầu tiên.</p>
                <p><b>4. Tại sao sai:</b> B, C, D đều có trọng âm rơi vào âm tiết thứ hai.</p>
            </div>
        </div>

        <div class="question-card" data-q="5">
            <div class="question-text">Mark the letter A, B, C or D on your answer sheet to indicate the correct answer.<br><br>Question 5. A person who is driving a motorbike on the road is called ____________.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. Architect</button>
                <button class="option-btn" data-val="B">B. cyclist</button>
                <button class="option-btn" data-val="C" data-correct="true">C. motorist</button>
                <button class="option-btn" data-val="D">D. pedestrian</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Người đang lái xe máy trên đường được gọi là ____________.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Architect (n): Kiến trúc sư.<br>
                B. cyclist (n): Người đi xe đạp.<br>
                C. motorist (n): Người đi xe có động cơ (ô tô, xe máy).<br>
                D. pedestrian (n): Người đi bộ.</p>
                <p><b>3. Tại sao chọn C:</b> Dựa vào ngữ cảnh "driving a motorbike" (lái xe máy - loại xe có động cơ), từ phù hợp nhất là motorist.</p>
                <p><b>4. Tại sao sai:</b> A, B, D sai hoàn toàn về nghĩa. Đi xe máy không thể gọi là người đi xe đạp hay người đi bộ.</p>
            </div>
        </div>

        <div class="question-card" data-q="6">
            <div class="question-text">Question 6. He was injured because he didn’t ________the seat belt.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. Give</button>
                <button class="option-btn" data-val="B" data-correct="true">B. fasten</button>
                <button class="option-btn" data-val="C">C. drive</button>
                <button class="option-btn" data-val="D">D. sail</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Anh ấy bị thương vì anh ấy đã không ________ dây an toàn.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Give (v): Cho, tặng.<br>
                B. fasten (v): Thắt, buộc chặt.<br>
                C. drive (v): Lái xe.<br>
                D. sail (v): Chèo thuyền.</p>
                <p><b>3. Tại sao chọn B:</b> Ta có cụm từ cố định (collocation): "fasten the seat belt" nghĩa là thắt dây an toàn.</p>
                <p><b>4. Tại sao sai:</b> Các động từ ở A, C, D không kết hợp được với "seat belt" (dây an toàn).</p>
            </div>
        </div>

        <div class="question-card" data-q="7">
            <div class="question-text">Question 7. He forgot to give a _________before he turned left and got a ticket.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. Signal</button>
                <button class="option-btn" data-val="B">B. sign</button>
                <button class="option-btn" data-val="C">C. light</button>
                <button class="option-btn" data-val="D">D. hand</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Anh ấy đã quên đưa ra _________ trước khi rẽ trái và đã bị phạt cớ (nhận vé phạt).</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Signal (n): Tín hiệu (xi-nhan).<br>
                B. sign (n): Biển báo.<br>
                C. light (n): Đèn, ánh sáng.<br>
                D. hand (n): Bàn tay.</p>
                <p><b>3. Tại sao chọn A:</b> Cụm từ "give a signal" mang nghĩa là ra tín hiệu (như bật đèn xi-nhan) trước khi chuyển hướng.</p>
                <p><b>4. Tại sao sai:</b> B sai vì biển báo là vật cố định trên đường. C và D không tạo thành cụm từ hợp lý với ngữ cảnh rẽ trái.</p>
            </div>
        </div>

        <div class="question-card" data-q="8">
            <div class="question-text">Question 8. Lilly often goes to school _______with his friends.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. With bicycle</button>
                <button class="option-btn" data-val="B">B. by foot</button>
                <button class="option-btn" data-val="C">C. in car</button>
                <button class="option-btn" data-val="D" data-correct="true">D. by bus</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Lilly thường đến trường _______ cùng với bạn bè của cậu ấy.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. With bicycle (Sai ngữ pháp: Thiếu mạo từ, phải là by bicycle hoặc on a bicycle).<br>
                B. by foot (Sai ngữ pháp: Đi bộ phải dùng giới từ "on" -> on foot).<br>
                C. in car (Sai ngữ pháp: Phải là by car hoặc in a car).<br>
                D. by bus: Bằng xe buýt.</p>
                <p><b>3. Tại sao chọn D:</b> "by + phương tiện giao thông" (không có mạo từ ở giữa) là cấu trúc chuẩn để chỉ cách thức di chuyển.</p>
                <p><b>4. Tại sao sai:</b> A, B, C đều mắc lỗi sai về giới từ hoặc mạo từ cơ bản trong tiếng Anh.</p>
            </div>
        </div>

        <div class="question-card" data-q="9">
            <div class="question-text">Question 9. ________is it from the bus station to the hospital?</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. How much</button>
                <button class="option-btn" data-val="B">B. How long</button>
                <button class="option-btn" data-val="C" data-correct="true">C. How far</button>
                <button class="option-btn" data-val="D">D. How many</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Từ trạm xe buýt đến bệnh viện là ________?</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. How much: Bao nhiêu (Hỏi giá cả hoặc số lượng không đếm được).<br>
                B. How long: Bao lâu (Hỏi thời gian) hoặc Bao dài (Hỏi chiều dài).<br>
                C. How far: Bao xa (Hỏi khoảng cách).<br>
                D. How many: Bao nhiêu (Hỏi số lượng đếm được).</p>
                <p><b>3. Tại sao chọn C:</b> Cấu trúc "How far is it from A to B?" là cấu trúc cố định dùng để hỏi khoảng cách địa lý.</p>
                <p><b>4. Tại sao sai:</b> Ngữ cảnh câu hỏi đang muốn biết khoảng cách từ điểm A (bến xe) đến điểm B (bệnh viện), nên dùng How much/long/many đều sai ý nghĩa.</p>
            </div>
        </div>

        <div class="question-card" data-q="10">
            <div class="question-text">Question 10. _____does you mother often go to work? – By bus.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. How</button>
                <button class="option-btn" data-val="B">B. When</button>
                <button class="option-btn" data-val="C">C. What</button>
                <button class="option-btn" data-val="D">D. Why</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Mẹ bạn thường đi làm bằng _______? – Bằng xe buýt.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. How: Như thế nào / Bằng phương tiện gì.<br>
                B. When: Khi nào.<br>
                C. What: Cái gì.<br>
                D. Why: Tại sao.</p>
                <p><b>3. Tại sao chọn A:</b> Câu trả lời là "By bus" (bằng xe buýt) chỉ phương tiện di chuyển, nên từ để hỏi phải là "How" (bằng cách nào).</p>
                <p><b>4. Tại sao sai:</b> B, C, D không khớp với câu trả lời chỉ phương tiện.</p>
            </div>
        </div>

        <div class="question-card" data-q="11">
            <div class="question-text">Question 11. We should ______the street at the zebra crossing.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. Walk</button>
                <button class="option-btn" data-val="B">B. walk on</button>
                <button class="option-btn" data-val="C">C. walk through</button>
                <button class="option-btn" data-val="D" data-correct="true">D. walk across</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Chúng ta nên ______ đường tại vạch kẻ qua đường (vạch ngựa vằn).</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Walk (v): Đi bộ (Nói chung).<br>
                B. walk on: Đi bộ trên...<br>
                C. walk through: Đi xuyên qua (thường dùng cho hầm, rừng...).<br>
                D. walk across: Đi ngang qua, đi sang đường.</p>
                <p><b>3. Tại sao chọn D:</b> "Walk across the street" là cụm từ chính xác chỉ hành động đi từ bên này sang bên kia của con đường.</p>
                <p><b>4. Tại sao sai:</b> Nếu chỉ dùng "walk" (A) thì chưa rõ nghĩa đi sang đường. "Walk on/through" (B, C) sai về mặt giới từ khi đi kèm với "the street" trong ngữ cảnh băng qua đường.</p>
            </div>
        </div>

        <div class="question-card" data-q="12">
            <div class="question-text">Question 12. Tom: “How do you go to school, Mai?”<br>Mai: “_________”</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. I catch the Number 32 bus</button>
                <button class="option-btn" data-val="B">B. Thank you</button>
                <button class="option-btn" data-val="C">C. I agree with you</button>
                <button class="option-btn" data-val="D">D. You are welcome</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Tom: "Bạn đi đến trường bằng phương tiện gì vậy Mai?" - Mai: "________"</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Mình bắt chuyến xe buýt số 32.<br>
                B. Cảm ơn bạn.<br>
                C. Mình đồng ý với bạn.<br>
                D. Không có chi (Dùng để đáp lại lời cảm ơn).</p>
                <p><b>3. Tại sao chọn A:</b> Câu hỏi dùng "How" để hỏi về phương tiện đi lại, đáp án A đưa ra phương tiện (xe buýt) là hợp lý nhất về mặt giao tiếp.</p>
                <p><b>4. Tại sao sai:</b> B, C, D là các câu trả lời cho các tình huống khác (cảm ơn, đồng tình), hoàn toàn không liên quan đến phương tiện.</p>
            </div>
        </div>

        <div class="passage-card">
            <div class="question-text">Read the following announcement and mark the correct option that best fits each of the numbered blanks from 13 to 16.</div>
            <div class="passage-text">
                <b>TRAFFIC SUPPORT STAFF WANTED</b><br><br>
                The city’s Department of Transportation is looking for <span class="gap-fill" data-id="q13">(13) ____</span> traffic support staff, only 3 hours per day.<br>
                Responsibilities include:<br>
                - Assisting pedestrians at <span class="gap-fill" data-id="q14">(14) ____</span> busy intersections.<br>
                - Giving <span class="gap-fill" data-id="q15">(15) ____</span> to drivers during peak hours.<br>
                - Reporting <span class="gap-fill" data-id="q16">(16) ____</span> traffic issues to the management team.
            </div>
            
            <div id="exp-q13" class="explanation-box">
                <h4>✨ Giải thích câu 13:</h4>
                <p><b>1. Dịch câu:</b> Sở giao thông thành phố đang tìm kiếm nhân viên hỗ trợ giao thông ________, chỉ 3 giờ mỗi ngày.</p>
                <p><b>2. Phân tích:</b> A. full-time (Toàn thời gian) | B. part-time (Bán thời gian) | C. seasonal (Theo mùa) | D. timing (Sự tính toán thời gian).</p>
                <p><b>3. Chọn B:</b> Vì có thông tin "only 3 hours per day" (chỉ 3 tiếng/ngày) -> Đây là công việc làm thêm/bán thời gian.</p>
            </div>
            <div id="exp-q14" class="explanation-box">
                <h4>✨ Giải thích câu 14:</h4>
                <p><b>1. Dịch câu:</b> Hỗ trợ người đi bộ tại ________ ngã tư đông đúc.</p>
                <p><b>2. Phân tích:</b> A. some (một vài) | B. much (nhiều - ko đếm được) | C. a little (một chút) | D. little (rất ít).</p>
                <p><b>3. Chọn A:</b> "intersections" là danh từ đếm được số nhiều. Chỉ có "some" đi được với danh từ đếm được số nhiều mang nghĩa "một vài". Much/little đi với danh từ KHÔNG đếm được.</p>
            </div>
            <div id="exp-q15" class="explanation-box">
                <h4>✨ Giải thích câu 15:</h4>
                <p><b>1. Dịch câu:</b> Đưa ra ________ cho tài xế trong giờ cao điểm.</p>
                <p><b>2. Phân tích:</b> A. directions (Chỉ dẫn/Phương hướng) | B. information (Thông tin) | C. questions (Câu hỏi) | D. askings (Không dùng).</p>
                <p><b>3. Chọn A:</b> Collocation "give directions" nghĩa là chỉ đường/hướng dẫn lưu thông. Rất hợp lý cho công việc hỗ trợ giao thông.</p>
            </div>
            <div id="exp-q16" class="explanation-box">
                <h4>✨ Giải thích câu 16:</h4>
                <p><b>1. Dịch câu:</b> Báo cáo các vấn đề giao thông ________ cho ban quản lý.</p>
                <p><b>2. Phân tích:</b> A. all (Tất cả) | B. quick (Nhanh - adj) | C. to (Tới) | D. urgent (Khẩn cấp - adj).</p>
                <p><b>3. Chọn D:</b> Cần 1 tính từ bổ nghĩa cho danh từ "traffic issues". "Urgent traffic issues" mang nghĩa "các vấn đề giao thông khẩn cấp" rất hợp với ngữ cảnh làm việc tại ngã tư.</p>
            </div>
        </div>

        <div class="question-card" data-q="17">
            <div class="question-text">Question 17. Our town had a cultural festival last month. Everything was good until ______.<br>
                a. The festival had music, food, and shows from different cultures.<br>
                b. We had some problems with organizing the event and setting up the booths.<br>
                c. Many people came to enjoy the festival and see different activities.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. b-c-a</button>
                <button class="option-btn" data-val="B">B. c-b-a</button>
                <button class="option-btn" data-val="C" data-correct="true">C. a-c-b</button>
                <button class="option-btn" data-val="D">D. b-a-c</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Sắp xếp các câu thành đoạn văn hợp lý. "Thị trấn của chúng tôi đã tổ chức lễ hội văn hóa tháng trước. Mọi thứ đều tốt đẹp cho tới khi..."</p>
                <p><b>2. Phân tích:</b> Lời dẫn đã nêu ra chủ đề Lễ hội. <br>a. Lễ hội có âm nhạc... (Mô tả chi tiết lễ hội)<br>c. Nhiều người đã tới thưởng thức... (Kết quả của việc có nhiều đồ ăn, âm nhạc)<br>b. Chúng tôi gặp vài vấn đề... (Sự kiện làm gián đoạn sự "tốt đẹp" được nhắc đến ở câu dẫn).</p>
                <p><b>3. Tại sao chọn C (a-c-b):</b> (Lưu ý: Options gốc bị lỗi in ấn, đáp án chuẩn logic mạch văn phải là a-c-b). Câu (a) mô tả lễ hội, câu (c) kể về phản ứng tích cực của mọi người, rồi mới chốt lại bằng câu (b) chỉ ra vấn đề phát sinh tương ứng với cụm từ "cho tới khi..." ở đầu.</p>
                <p><b>4. Tại sao các thứ tự khác sai:</b> Đặt (b) lên đầu tiên sẽ làm hỏng mạch kể chuyện đang từ tốt (Everything was good) chuyển đột ngột, chưa kịp mô tả cái tốt là gì.</p>
            </div>
        </div>

        <div class="question-card" data-q="18">
            <div class="question-text">Question 18. Choose the sentence that can end the text in question 17.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. The festival was a success and brought the community together.</button>
                <button class="option-btn" data-val="B">B. Some of the food stalls ran out of food because many people came</button>
                <button class="option-btn" data-val="C">C. We want to have this festival every year from now on</button>
                <button class="option-btn" data-val="D" data-correct="true">D. There were some small problems that we fixed quickly.</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu:</b> Chọn câu có thể dùng để kết thúc đoạn văn ở câu 17.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Lễ hội là một thành công và đã gắn kết cộng đồng lại với nhau.<br>
                B. Một vài quầy thức ăn đã hết sạch đồ vì quá nhiều người tới.<br>
                C. Chúng tôi muốn tổ chức lễ hội này hàng năm từ bây giờ.<br>
                D. Đã có một vài vấn đề nhỏ nhưng chúng tôi đã khắc phục nhanh chóng.</p>
                <p><b>3. Tại sao chọn D:</b> Đoạn văn ở câu 17 kết thúc bằng việc "gặp một số vấn đề trong khâu tổ chức" (câu b). Do đó, câu D nối tiếp cực kỳ logic khi nói rằng "dù có vấn đề nhưng đã được khắc phục nhanh chóng".</p>
                <p><b>4. Tại sao sai:</b> Các câu A, B, C không giải quyết trực tiếp thông tin về "problems" vừa được nêu ra ở câu liền trước nó.</p>
            </div>
        </div>

        <div class="passage-card">
            <div class="question-text">Read the following passage and mark the correct option that best fits each numbered blank from 19 to 24.</div>
            <div class="passage-text">
                <b>SAFETY TIPS FOR BUS PASSENGERS</b><br><br>
                Always maintain a queue while waiting for a bus. Never stand in a queue in the middle <span class="gap-fill" data-id="q19">(19) ____</span> the road. At the time of boarding a bus do not try <span class="gap-fill" data-id="q20">(20) ____</span> or chasing the bus. Once you are inside the bus <span class="gap-fill" data-id="q21">(21) _____</span> a seat and hold firmly on the handrail if you are standing.<br>
                Never try to board an overcrowded bus. Avoid <span class="gap-fill" data-id="q22">(22) ____</span> inside of a bus <span class="gap-fill" data-id="q23">(23) ______</span> your high-pitch noise may distract the attention of the driver and it could <span class="gap-fill" data-id="q24">(24) ______</span> to a major accident.
            </div>
            
            <div id="exp-q19" class="explanation-box">
                <h4>✨ Giải thích câu 19:</h4>
                <p><b>1. Phân tích:</b> A. of | B. to | C. on | D. about</p>
                <p><b>2. Chọn A:</b> Cụm từ cố định (Collocation) "in the middle of..." nghĩa là "ở giữa của cái gì đó". Ở đây là "in the middle of the road" (ở giữa đường).</p>
            </div>
            <div id="exp-q20" class="explanation-box">
                <h4>✨ Giải thích câu 20:</h4>
                <p><b>1. Phân tích:</b> A. run | B. to run | C. running | D. runned</p>
                <p><b>2. Chọn C:</b> Cấu trúc song song với liên từ "or". Phía sau có V-ing "chasing" nên phía trước cũng phải dùng V-ing là "running". (Không cố gắng chạy hoặc đuổi theo xe buýt).</p>
            </div>
            <div id="exp-q21" class="explanation-box">
                <h4>✨ Giải thích câu 21:</h4>
                <p><b>1. Phân tích:</b> A. hold | B. sit | C. take | D. find</p>
                <p><b>2. Chọn C:</b> Cụm từ "take a seat" là một collocation chuẩn xác trong tiếng Anh mang nghĩa "tìm một chỗ ngồi/ngồi xuống". (Một khi đã lên xe, hãy tìm một chỗ ngồi...).</p>
            </div>
            <div id="exp-q22" class="explanation-box">
                <h4>✨ Giải thích câu 22:</h4>
                <p><b>1. Phân tích:</b> A. shout | B. shouting | C. to shout | D. shouts</p>
                <p><b>2. Chọn B:</b> Cấu trúc ngữ pháp: Động từ "Avoid" (Tránh làm gì) luôn đi kèm với một động từ đuôi -ing (V-ing). Vì vậy, "shouting" là đáp án đúng.</p>
            </div>
            <div id="exp-q23" class="explanation-box">
                <h4>✨ Giải thích câu 23:</h4>
                <p><b>1. Phân tích:</b> A. as | B. although | C. so | D. because</p>
                <p><b>2. Chọn D (hoặc A đều có nghĩa tương đương):</b> Câu ghép có quan hệ nguyên nhân - kết quả. "Tránh la hét BỞI VÌ tiếng ồn có thể làm tài xế phân tâm". Dùng "because" (hoặc "as") mang nghĩa bởi vì.</p>
            </div>
            <div id="exp-q24" class="explanation-box">
                <h4>✨ Giải thích câu 24:</h4>
                <p><b>1. Phân tích:</b> A. lead | B. cause | C. make | D. do</p>
                <p><b>2. Chọn A:</b> Cụm động từ "lead to" mang nghĩa là "dẫn tới (hậu quả gì)". Cause không đi với giới từ "to". (Dẫn tới một tai nạn nghiêm trọng).</p>
            </div>
        </div>

        <div class="question-card" data-q="25">
            <div class="question-text">Question 25. Because of their carelessness, a lot of road accidents happen each year.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. Although they are careless, a lot of road accidents happen every year</button>
                <button class="option-btn" data-val="B">B. Even though they are careless, a lot of road accidents happen every year</button>
                <button class="option-btn" data-val="C" data-correct="true">C. Because they are careless, a lot of road accidents happen every year</button>
                <button class="option-btn" data-val="D">D. A lot of road accidents happen every year so their carelessness</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu gốc:</b> Bởi vì sự bất cẩn của họ, rất nhiều tai nạn đường bộ xảy ra mỗi năm.</p>
                <p><b>2. Phân tích & Dịch 4 đáp án:</b><br>
                A. Mặc dù họ bất cẩn, nhiều tai nạn...<br>
                B. Mặc dù họ bất cẩn, nhiều tai nạn...<br>
                C. Bởi vì họ bất cẩn, rất nhiều tai nạn đường bộ xảy ra mỗi năm.<br>
                D. (Sai ngữ pháp: So không đi liền với Noun phrase).</p>
                <p><b>3. Tại sao chọn C:</b> Cấu trúc chuyển đổi tương đương nguyên nhân: "Because of + Cụm danh từ (their carelessness)" = "Because + Mệnh đề (they are careless)". Ý nghĩa hoàn toàn được giữ nguyên.</p>
                <p><b>4. Tại sao sai:</b> A và B dùng although/even though (mặc dù) làm sai lệch ý nghĩa nguyên nhân của câu gốc.</p>
            </div>
        </div>

        <div class="question-card" data-q="26">
            <div class="question-text">Question 26. How far is it from your house to the school?</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. What is the distance between your house and the school?</button>
                <button class="option-btn" data-val="B">B. How long does it take to go from your house to the school?</button>
                <button class="option-btn" data-val="C">C. How often do you go from your house to the school?</button>
                <button class="option-btn" data-val="D">D. Is the school near your house?</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu gốc:</b> Khoảng cách từ nhà bạn đến trường là bao xa?</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Khoảng cách giữa nhà bạn và trường học là bao nhiêu?<br>
                B. Mất bao lâu để đi từ nhà bạn đến trường?<br>
                C. Bạn có thường xuyên đi từ nhà đến trường không?<br>
                D. Trường học có gần nhà bạn không?</p>
                <p><b>3. Tại sao chọn A:</b> Câu hỏi "How far" (bao xa) dùng để hỏi khoảng cách, hoàn toàn đồng nghĩa với cấu trúc "What is the distance" (Khoảng cách là bao nhiêu).</p>
                <p><b>4. Tại sao sai:</b> B hỏi về thời gian (How long). C hỏi về tần suất (How often). D là câu hỏi Yes/No (gần hay xa).</p>
            </div>
        </div>

        <div class="question-card" data-q="27">
            <div class="question-text">Question 27. You/ go/ to/ see/ doctor/ regularly.</div>
            <div class="options-container">
                <button class="option-btn" data-val="A">A. You should go to see the doctor</button>
                <button class="option-btn" data-val="B">B. You must go to see doctor regularly</button>
                <button class="option-btn" data-val="C" data-correct="true">C. You should go to see the doctor regularly</button>
                <button class="option-btn" data-val="D">D. You went to see the doctor regularly</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu hỏi:</b> Chọn câu hoàn chỉnh được tạo từ các từ gợi ý: Bạn/ đi/ gặp/ bác sĩ/ thường xuyên.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Thiếu trạng từ "regularly" ở cuối.<br>
                B. Thiếu mạo từ "the" trước "doctor".<br>
                C. Bạn nên đi gặp bác sĩ thường xuyên.<br>
                D. Bạn đã đi (quá khứ) gặp bác sĩ thường xuyên.</p>
                <p><b>3. Tại sao chọn C:</b> Đây là lời khuyên hợp lý, sử dụng động từ khuyết thiếu "should" (nên) và có đầy đủ thành phần của câu gốc ghép lại, ngữ pháp chuẩn xác.</p>
                <p><b>4. Tại sao sai:</b> A thiếu từ. B thiếu mạo từ. D dùng thì quá khứ (went) không hợp lý với trạng từ chỉ thói quen chung chung (regularly) ở hiện tại trong ngữ cảnh đưa ra lời khuyên.</p>
            </div>
        </div>

        <div class="question-card" data-q="28">
            <div class="question-text">Question 28. How long/ take/ you / cycle/ the club/?</div>
            <div class="options-container">
                <button class="option-btn" data-val="A" data-correct="true">A. How long does it take you to cycle to the club?</button>
                <button class="option-btn" data-val="B">B. How long taking you to cycle to the club?</button>
                <button class="option-btn" data-val="C">C. How long do you take cycling to the club?</button>
                <button class="option-btn" data-val="D">D. How long of taking do you cycle to the club?</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu hỏi:</b> Tạo thành câu hỏi thời gian mất bao lâu để đạp xe đến câu lạc bộ.</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Bạn mất bao lâu để đạp xe tới câu lạc bộ?<br>
                B. (Sai cấu trúc ngữ pháp cơ bản).<br>
                C. (Sai cấu trúc. Take không đi trực tiếp với chủ ngữ người kiểu này để hỏi thời gian đi đường).<br>
                D. (Sai cấu trúc hoàn toàn).</p>
                <p><b>3. Tại sao chọn A:</b> Dựa vào cấu trúc chuẩn: "How long + does it take + sb + TO + V + ...?" dùng để hỏi ai đó mất bao lâu để làm việc gì. Ở đây dùng "does it take you to cycle".</p>
                <p><b>4. Tại sao sai:</b> B, C, D đều vi phạm nghiêm trọng cấu trúc ngữ pháp cơ bản của câu hỏi thời gian với động từ "take".</p>
            </div>
        </div>

        <div class="question-card" data-q="29">
            <div class="question-text">Question 29: What does the sign say?</div>
            
            <div class="sign-speed-limit">
                <div class="text1">SPEED<br>LIMIT</div>
                <div class="number">40</div>
            </div>

            <div class="options-container">
                <button class="option-btn" data-val="A">A. You can drive 40 miles per hour or more</button>
                <button class="option-btn" data-val="B">B. You must drive at 40 miles per hour</button>
                <button class="option-btn" data-val="C" data-correct="true">C. You cannot drive faster than 40 miles per hour</button>
                <button class="option-btn" data-val="D">D. The minimum speed is 40 miles per hour</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu hỏi:</b> Biển báo này nói gì?</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Bạn có thể lái 40 dặm/giờ hoặc HƠN.<br>
                B. Bạn BẮT BUỘC phải lái đúng tốc độ 40 dặm/giờ (không hơn không kém).<br>
                C. Bạn KHÔNG THỂ lái xe nhanh hơn 40 dặm/giờ.<br>
                D. Tốc độ TỐI THIỂU là 40 dặm/giờ.</p>
                <p><b>3. Tại sao chọn C:</b> Biển báo "SPEED LIMIT 40" nghĩa là tốc độ tối đa cho phép là 40. Nghĩa là bạn không được phép đi nhanh hơn mức này.</p>
                <p><b>4. Tại sao sai:</b> A và D sai vì đây là giới hạn trên, không phải giới hạn dưới. B sai vì không ai bắt buộc phải đi đúng y xì một mức tốc độ cả.</p>
            </div>
        </div>

        <div class="question-card" data-q="30">
            <div class="question-text">Question 30: What does the notice say?</div>

            <div class="sign-restricted">
                <div class="top">RESTRICTED<br>AREA</div>
                <div class="bottom">
                    <div class="icon-circle">🚶</div>
                    <div class="keep-out">KEEP<br>OUT</div>
                </div>
            </div>

            <div class="options-container">
                <button class="option-btn" data-val="A">A. We should keep this area out</button>
                <button class="option-btn" data-val="B" data-correct="true">B. People aren’t allowed to enter this area</button>
                <button class="option-btn" data-val="C">C. This area is kept open</button>
                <button class="option-btn" data-val="D">D. This area is open to everyone.</button>
            </div>
            <div class="explanation-box">
                <h4>✨ Giải thích chi tiết:</h4>
                <p><b>1. Dịch câu hỏi:</b> Biển thông báo này nói gì?</p>
                <p><b>2. Phân tích 4 đáp án:</b><br>
                A. Chúng ta nên giữ khu vực này ở ngoài (Dịch tối nghĩa).<br>
                B. Mọi người KHÔNG được phép đi vào khu vực này.<br>
                C. Khu vực này được giữ mở cửa.<br>
                D. Khu vực này mở cửa cho tất cả mọi người.</p>
                <p><b>3. Tại sao chọn B:</b> Biển báo "Restricted Area - Keep Out" (Khu vực cấm - Miễn vào) và hình người gạch chéo thể hiện sự cấm đoán không cho phép xâm nhập.</p>
                <p><b>4. Tại sao sai:</b> C và D mang nghĩa trái ngược (cho phép vào). A dùng sai ngữ pháp và ngữ cảnh của cụm "keep out" (keep out nghĩa là không được vào, chứ không phải keep something out).</p>
            </div>
        </div>

        <div style="text-align: center;">
            <button class="submit-btn" onclick="showScore()">NỘP BÀI THI</button>
        </div>
    </div>

    <div id="gapModal">
        <div class="modal-content">
            <h3 style="color:#6c5ce7; font-weight:800;">Chọn đáp án đúng</h3>
            <div class="modal-options" id="modalOptionsContainer">
                </div>
            <button onclick="closeModal()" style="margin-top:20px; background:#dfe6e9; border:none; padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:bold;">Đóng</button>
        </div>
    </div>

    <div id="scoreModal">
        <div class="score-content">
            <h1>🎉 HOÀN THÀNH 🎉</h1>
            <p>Điểm của bạn: <span id="finalScore" style="color:#00D26A; font-size: 2.5rem;"></span> / 30</p>
            <p id="complimentText" style="color:#e17055; font-size: 1.2rem; margin-top: 15px;"></p>
            <button onclick="location.reload()" class="submit-btn" style="font-size: 1.2rem; padding: 15px 30px; margin-bottom:0;">Làm lại bài thi</button>
        </div>
    </div>

    <div id="confetti-container"></div>

    <script>
        // --- 1. Audio System (Sử dụng Web Audio API để không cần file ngoài) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playDing() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function playBuzz() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // --- 2. Confetti System ---
        function shootConfetti() {
            const container = document.getElementById('confetti-container');
            const colors = ['#ff4757', '#2ed573', '#1e90ff', '#ffa502', '#ff6b81'];
            
            for(let i=0; i<40; i++) {
                const conf = document.createElement('div');
                conf.classList.add('confetti-piece');
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                container.appendChild(conf);

                let top = -20;
                const speed = Math.random() * 3 + 2;
                const interval = setInterval(() => {
                    top += speed;
                    conf.style.top = top + 'px';
                    if(top > window.innerHeight) {
                        clearInterval(interval);
                        conf.remove();
                    }
                }, 20);
            }
        }

        // --- 3. Shuffle Options Logic ---
        function shuffleArray(container) {
            const buttons = Array.from(container.children);
            for (let i = buttons.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                container.appendChild(buttons[j]); 
            }
        }

        // Khởi tạo Shuffle cho các câu trắc nghiệm khi load trang
        document.querySelectorAll('.options-container').forEach(container => {
            shuffleArray(container);
        });

        // --- 4. Trắc nghiệm cơ bản (ABCD) Logic ---
        let correctCount = 0;
        document.querySelectorAll('.question-card').forEach(card => {
            const btns = card.querySelectorAll('.option-btn');
            const exp = card.querySelector('.explanation-box');
            
            btns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Nếu đã chọn rồi thì khoá
                    if(card.dataset.answered === 'true') return;
                    card.dataset.answered = 'true';
                    
                    const isCorrect = btn.dataset.correct === 'true';
                    
                    if(isCorrect) {
                        btn.classList.add('correct');
                        playDing();
                        shootConfetti();
                        correctCount++;
                    } else {
                        btn.classList.add('incorrect');
                        playBuzz();
                        // Đánh dấu nút đúng để học sinh biết
                        btns.forEach(b => { if(b.dataset.correct === 'true') b.style.border = "3px solid #00D26A"; });
                    }
                    
                    // Hiển thị giải thích
                    exp.style.display = 'block';
                });
            });
        });

        // --- 5. Gap Fill (Điền từ) Logic ---
        const gapData = {
            'q13': { opts: ['A. full-time', 'B. part-time', 'C. seasonal', 'D. timing'], correct: 1 },
            'q14': { opts: ['A. some', 'B. much', 'C. a little', 'D. little'], correct: 0 },
            'q15': { opts: ['A. directions', 'B. information', 'C. questions', 'D. askings'], correct: 0 },
            'q16': { opts: ['A. all', 'B. quick', 'C. to', 'D. urgent'], correct: 3 },
            'q19': { opts: ['A. of', 'B. to', 'C. on', 'D. about'], correct: 0 },
            'q20': { opts: ['A. run', 'B. to run', 'C. running', 'D. runned'], correct: 2 },
            'q21': { opts: ['A. hold', 'B. sit', 'C. take', 'D. find'], correct: 2 },
            'q22': { opts: ['A. shout', 'B. shouting', 'C. to shout', 'D. shouts'], correct: 1 },
            'q23': { opts: ['A. as', 'B. although', 'C. so', 'D. because'], correct: 3 }, // Note: Both A & D are ok, setting D as strictly correct for popup
            'q24': { opts: ['A. lead', 'B. cause', 'C. make', 'D. do'], correct: 0 },
        };

        const gapModal = document.getElementById('gapModal');
        const modalOptsContainer = document.getElementById('modalOptionsContainer');
        let currentTargetGap = null;

        document.querySelectorAll('.gap-fill').forEach(gap => {
            gap.addEventListener('click', () => {
                const id = gap.dataset.id;
                currentTargetGap = gap;
                const data = gapData[id];
                
                // Render popup options
                modalOptsContainer.innerHTML = '';
                data.opts.forEach((optText, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = optText;
                    btn.onclick = () => handleGapSelection(index, data.correct, optText, id);
                    modalOptsContainer.appendChild(btn);
                });
                
                gapModal.style.display = 'flex';
            });
        });

        function handleGapSelection(selectedIndex, correctIndex, textVal, qId) {
            gapModal.style.display = 'none';
            // Cắt lấy chữ (bỏ A,B,C,D)
            const cleanText = textVal.substring(3); 
            currentTargetGap.innerText = cleanText;

            if(selectedIndex === correctIndex) {
                currentTargetGap.classList.add('correct');
                playDing();
                shootConfetti();
                correctCount++;
            } else {
                currentTargetGap.classList.add('incorrect');
                playBuzz();
            }
            // Mở hộp giải thích tương ứng
            document.getElementById('exp-' + qId).style.display = 'block';
        }

        function closeModal() { gapModal.style.display = 'none'; }

        // --- 6. Nộp bài Logic ---
        function showScore() {
            const modal = document.getElementById('scoreModal');
            const scoreText = document.getElementById('finalScore');
            const compliment = document.getElementById('complimentText');
            
            scoreText.innerText = correctCount;
            modal.style.display = 'flex';
            
            const quotes = [
                "Tuyệt đỉnh! Trí tuệ chói lóa như ánh sao! 🌟",
                "Quá xuất sắc! Bạn là thiên tài tiếng Anh! 🚀",
                "Cố gắng một xíu nữa là đạt đỉnh cao rồi! 💪",
                "Tuyệt vời! Ms Mai An rất tự hào về bạn! 💖"
            ];
            
            if(correctCount >= 25) compliment.innerText = quotes[0];
            else if(correctCount >= 20) compliment.innerText = quotes[1];
            else if(correctCount >= 10) compliment.innerText = quotes[2];
            else compliment.innerText = quotes[3];
        }
    </script>
</body>
</html>