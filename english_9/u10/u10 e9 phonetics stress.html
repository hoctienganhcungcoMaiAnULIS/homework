<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Ti·∫øng Anh 9 - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f3f8;
            --card-bg: #ffffff;
            --text-main: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(#ced6e0 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: transparent;
        }

        /* HEADER */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid #e1e1e1;
        }

        .header h1 {
            color: var(--primary);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
        }

        .header p {
            color: #747d8c;
            font-weight: 600;
            margin: 5px 0 0;
        }

        /* QUESTION CARD */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.1);
            border: 2px solid #f1f2f6;
            position: relative;
            transition: transform 0.3s ease;
        }

        .question-title {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .question-badge {
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2f3542;
        }

        .question-text u {
            text-decoration: none;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 2px;
        }

        /* OPTIONS GRID */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e1e1e1;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: #57606f;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #e1e1e1;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary);
            color: var(--primary);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #e1e1e1;
        }

        .option-btn.correct {
            background: var(--correct);
            border-color: var(--correct);
            box-shadow: 0 4px 0 #00b85c;
            color: white;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .option-btn.wrong {
            background: var(--wrong);
            border-color: var(--wrong);
            box-shadow: 0 4px 0 #d63031;
            color: white;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
        }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background: #f0fff4;
            border: 2px solid var(--correct);
            border-radius: 15px;
            padding: 20px;
            animation: slideDown 0.4s ease-out;
        }
        
        .explanation-box.wrong-state {
            background: #fff0f1;
            border-color: var(--wrong);
        }

        .exp-header {
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-teacher-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .exp-content p {
            margin: 5px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .exp-label {
            font-weight: 700;
            color: var(--primary);
            display: block;
            margin-top: 10px;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .vocab-table th, .vocab-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        
        .vocab-table th {
            background-color: var(--primary);
            color: white;
        }

        /* SUBMIT BUTTON */
        .submit-section {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2rem;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 6px 0 #009e82;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:active {
            transform: scale(0.95) translateY(4px);
            box-shadow: 0 2px 0 #009e82;
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @keyframes pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Popup Score */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            border: 4px solid var(--primary);
            animation: pop 0.5s;
        }
        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--secondary);
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <div class="header">
            <h1>Test Unit 8 - English 9</h1>
            <p>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">üåü Ho√†n th√†nh b√†i ƒë·ªÉ nh·∫≠n l·ªùi khen t·ª´ c√¥ nh√©! üåü</p>
        </div>

        <div id="quiz-container">
            </div>

        <div class="submit-section">
            <button class="submit-btn" onclick="submitQuiz()">N·ªôp B√†i & Xem ƒêi·ªÉm</button>
        </div>
    </div>

    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary);">K·∫æT QU·∫¢ C·ª¶A EM</h2>
            <div class="score-display" id="finalScore">0/20</div>
            <p id="feedbackText" style="font-size: 1.1rem; font-weight: 600; color: #57606f;">...</p>
            <button class="submit-btn" style="margin-top: 20px; font-size: 1rem; padding: 10px 30px;" onclick="closeModal()">L√†m l·∫°i b√†i n√†y</button>
        </div>
    </div>

    <script>
        // === D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI (ƒê√£ x·ª≠ l√Ω logic & gi·∫£i th√≠ch chi ti·∫øt) ===
        const quizData = [
            // Exercise 1: Pronunciation
            {
                id: 1,
                type: "Pronunciation",
                question: "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation.",
                word: "1. A. <u>a</u>ffect B. <u>a</u>ppreciate C. ch<u>a</u>nge D. b<u>a</u>lance",
                options: ["A", "B", "C", "D"],
                correct: 2, // Index 0-3 (C)
                explanation: {
                    meaning: {
                        A: "·∫¢nh h∆∞·ªüng (/…ô/)",
                        B: "Tr√¢n tr·ªçng, c·∫£m k√≠ch (/…ô/)",
                        C: "Thay ƒë·ªïi (/e…™/)",
                        D: "S·ª± c√¢n b·∫±ng (/√¶/)"
                    },
                    whyCorrect: "ƒê√°p √°n C ph√°t √¢m l√† /e…™/ (nguy√™n √¢m ƒë√¥i).",
                    whyWrong: "C√°c ƒë√°p √°n c√≤n l·∫°i: A, B l√† √¢m /…ô/ (schwa - √¢m y·∫øu), D th∆∞·ªùng ph√°t √¢m l√† /√¶/."
                }
            },
            {
                id: 2,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "2. A. clim<u>a</u>te B. h<u>a</u>bitat C. l<u>a</u>ndform D. f<u>a</u>scinating",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: {
                        A: "Kh√≠ h·∫≠u (/a…™/ - √¢m ƒë·∫ßu, ho·∫∑c /…ôt/ √¢m cu·ªëi - nh∆∞ng th∆∞·ªùng b√†i n√†y check √¢m 'a' ƒë·∫ßu ti√™n l√† /a…™/)",
                        B: "M√¥i tr∆∞·ªùng s·ªëng (/√¶/)",
                        C: "ƒê·ªãa h√¨nh (/√¶/)",
                        D: "H·∫•p d·∫´n, l√¥i cu·ªën (/√¶/)"
                    },
                    whyCorrect: "ƒê√°p √°n A (Climate) ch·ªØ 'a' th·ª© nh·∫•t ph√°t √¢m l√† /a…™/.",
                    whyWrong: "C√°c ƒë√°p √°n B, C, D ch·ªØ 'a' ƒë·ªÅu ph√°t √¢m l√† /√¶/."
                }
            },
            {
                id: 3,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "3. A. <u>a</u>ncient B. t<u>a</u>keaway C. b<u>a</u>sic D. c<u>a</u>stle",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: {
                    meaning: {
                        A: "C·ªï ƒë·∫°i (/e…™/)",
                        B: "ƒê·ªì mang ƒëi (/e…™/)",
                        C: "C∆° b·∫£n (/e…™/)",
                        D: "L√¢u ƒë√†i (/…ëÀê/ - Anh Anh ho·∫∑c /√¶/ - Anh M·ªπ)"
                    },
                    whyCorrect: "ƒê√°p √°n D (Castle) ph√°t √¢m l√† /…ëÀê/ ho·∫∑c /√¶/.",
                    whyWrong: "C√°c ƒë√°p √°n A, B, C ƒë·ªÅu ph√°t √¢m l√† /e…™/."
                }
            },
            {
                id: 4,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "4. A. ec<u>o</u>logical B. landf<u>o</u>rm C. <u>o</u>rbit D. fl<u>o</u>ra",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: {
                        A: "Thu·ªôc v·ªÅ sinh th√°i (/…í/)",
                        B: "ƒê·ªãa h√¨nh (/…îÀê/)",
                        C: "Qu·ªπ ƒë·∫°o (/…îÀê/)",
                        D: "H·ªá th·ª±c v·∫≠t (/…îÀê/)"
                    },
                    whyCorrect: "ƒê√°p √°n A (Ecological) ch·ªØ 'o' ph√°t √¢m l√† /…í/ (ng·∫Øn).",
                    whyWrong: "C√°c ƒë√°p √°n B, C, D ƒë·ªÅu ph√°t √¢m l√† /…îÀê/ (d√†i)."
                }
            },
            {
                id: 5,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "5. A. f<u>e</u>rtilizer B. pr<u>e</u>serve C. r<u>e</u>cognize D. obs<u>e</u>rve",
                options: ["A", "B", "C", "D"],
                correct: 2, // C
                explanation: {
                    meaning: {
                        A: "Ph√¢n b√≥n (/…úÀê/)",
                        B: "B·∫£o t·ªìn (/…úÀê/)",
                        C: "C√¥ng nh·∫≠n (/e/)",
                        D: "Quan s√°t (/…úÀê/)"
                    },
                    whyCorrect: "ƒê√°p √°n C (Recognize) ch·ªØ 'e' ph√°t √¢m l√† /e/.",
                    whyWrong: "C√°c ƒë√°p √°n A, B, D ch·ªØ 'e' n·∫±m trong √¢m ti·∫øt ƒë∆∞·ª£c nh·∫•n ho·∫∑c k√©o d√†i th√†nh /…úÀê/."
                }
            },
            {
                id: 6,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "6. A. h<u>a</u>bitat B. gr<u>a</u>ssland C. clim<u>a</u>te D. st<u>a</u>ndard",
                options: ["A", "B", "C", "D"],
                correct: 2, // C
                explanation: {
                    meaning: {
                        A: "M√¥i tr∆∞·ªùng s·ªëng (/√¶/ - √¢m ƒë·∫ßu)",
                        B: "ƒê·ªìng c·ªè (/…ëÀê/ ho·∫∑c /√¶/)",
                        C: "Kh√≠ h·∫≠u (/a…™/ - √¢m ƒë·∫ßu, ho·∫∑c ƒëu√¥i /…ôt/ kh√°c bi·ªát v·ªõi ƒëu√¥i c·ªßa t·ª´ kh√°c)",
                        D: "Ti√™u chu·∫©n (/√¶/)"
                    },
                    whyCorrect: "ƒê√°p √°n C (Climate). N·∫øu x√©t √¢m 'a' ƒë·∫ßu ti√™n: Climate l√† /a…™/ c√≤n l·∫°i l√† /√¶/. N·∫øu x√©t √¢m 'a' th·ª© hai: Climate l√† /…ôt/ (schwa) nh∆∞ng Habitat/Standard c≈©ng c√≥ th·ªÉ l√† schwa. S·ª± kh√°c bi·ªát r√µ nh·∫•t n·∫±m ·ªü √¢m 'a' ch√≠nh: Climate /a…™/.",
                    whyWrong: "A, B, D c√≥ √¢m ch√≠nh l√† /√¶/ ho·∫∑c /…ëÀê/."
                }
            },
            {
                id: 7,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "7. A. out<u>er</u> B. obs<u>er</u>ve C. pres<u>er</u>ve D. res<u>er</u>ve",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: {
                        A: "B√™n ngo√†i (/…ô/)",
                        B: "Quan s√°t (/…úÀê/)",
                        C: "B·∫£o t·ªìn (/…úÀê/)",
                        D: "D·ª± tr·ªØ (/…úÀê/)"
                    },
                    whyCorrect: "ƒê√°p √°n A (Outer) ƒëu√¥i 'er' l√† √¢m y·∫øu /…ô/.",
                    whyWrong: "B, C, D ph·∫ßn 'er' nh·∫≠n tr·ªçng √¢m n√™n ph√°t √¢m d√†i l√† /…úÀê/."
                }
            },
            {
                id: 8,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "8. A. aff<u>e</u>ct B. ess<u>e</u>ntial C. p<u>e</u>sticide D. appr<u>e</u>ciate",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: {
                    meaning: {
                        A: "·∫¢nh h∆∞·ªüng (/e/ - √¢m nh·∫•n)",
                        B: "Thi·∫øt y·∫øu (/e/ - √¢m nh·∫•n)",
                        C: "Thu·ªëc tr·ª´ s√¢u (/e/ - √¢m nh·∫•n)",
                        D: "C·∫£m k√≠ch (/iÀê/ - √¢m nh·∫•n)"
                    },
                    whyCorrect: "ƒê√°p √°n D (Appreciate) ph·∫ßn ƒë∆∞·ª£c nh·∫•n √¢m ph√°t √¢m l√† /iÀê/.",
                    whyWrong: "A, B, C ph·∫ßn ƒë∆∞·ª£c nh·∫•n √¢m ƒë·ªÅu l√† /e/."
                }
            },
            {
                id: 9,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "9. A. cons<u>i</u>st B. v<u>i</u>tal C. orb<u>i</u>t D. m<u>i</u>rror",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: {
                    meaning: {
                        A: "Bao g·ªìm (/…™/)",
                        B: "Quan tr·ªçng s·ªëng c√≤n (/a…™/)",
                        C: "Qu·ªπ ƒë·∫°o (/…™/)",
                        D: "C√°i g∆∞∆°ng (/…™/)"
                    },
                    whyCorrect: "ƒê√°p √°n B (Vital) ch·ªØ 'i' ph√°t √¢m l√† /a…™/.",
                    whyWrong: "A, C, D ch·ªØ 'i' ph√°t √¢m l√† /…™/."
                }
            },
            {
                id: 10,
                type: "Pronunciation",
                question: "Choose the word whose underlined part is pronounced differently.",
                word: "10. A. s<u>au</u>na B. b<u>a</u>lance C. n<u>a</u>ture D. fl<u>o</u>ra",
                options: ["A", "B", "C", "D"],
                correct: 2, // C
                explanation: {
                    meaning: {
                        A: "T·∫Øm h∆°i (/…îÀê/)",
                        B: "C√¢n b·∫±ng (/√¶/)",
                        C: "Thi√™n nhi√™n (/e…™/)",
                        D: "H·ªá th·ª±c v·∫≠t (/…îÀê/)"
                    },
                    whyCorrect: "ƒê√°p √°n C (Nature) c√≥ nguy√™n √¢m ƒë√¥i /e…™/.",
                    whyWrong: "A v√† D l√† /…îÀê/, B l√† /√¶/. Nature l√† t·ª´ kh√°c bi·ªát nh·∫•t v·ªÅ c·∫•u t·∫°o nguy√™n √¢m ƒë√¥i ·ªü v·ªã tr√≠ tr·ªçng √¢m."
                }
            },
            // Exercise 2: Stress
            {
                id: 11,
                type: "Stress",
                question: "Exercise 2: Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.",
                word: "1. A. reserve B. flora C. nature D. fauna",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: { A: "D·ª± tr·ªØ", B: "H·ªá th·ª±c v·∫≠t", C: "Thi√™n nhi√™n", D: "H·ªá ƒë·ªông v·∫≠t" },
                    whyCorrect: "A. reserve nh·∫•n √¢m 2 (re'serve).",
                    whyWrong: "B, C, D nh·∫•n √¢m 1 ('flora, 'nature, 'fauna)."
                }
            },
            {
                id: 12,
                type: "Stress",
                question: "Primary Stress",
                word: "2. A. liquid B. water C. aware D. grassland",
                options: ["A", "B", "C", "D"],
                correct: 2, // C
                explanation: {
                    meaning: { A: "Ch·∫•t l·ªèng", B: "N∆∞·ªõc", C: "Nh·∫≠n th·ª©c", D: "ƒê·ªìng c·ªè" },
                    whyCorrect: "C. aware nh·∫•n √¢m 2 (a'ware).",
                    whyWrong: "A, B, D nh·∫•n √¢m 1 ('liquid, 'water, 'grassland)."
                }
            },
            {
                id: 13,
                type: "Stress",
                question: "Primary Stress",
                word: "3. A. system B. giraffe C. ocean D. body",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: {
                    meaning: { A: "H·ªá th·ªëng", B: "H∆∞∆°u cao c·ªï", C: "ƒê·∫°i d∆∞∆°ng", D: "C∆° th·ªÉ" },
                    whyCorrect: "B. giraffe nh·∫•n √¢m 2 (gi'raffe).",
                    whyWrong: "A, C, D nh·∫•n √¢m 1 ('system, 'ocean, 'body)."
                }
            },
            {
                id: 14,
                type: "Stress",
                question: "Primary Stress",
                word: "4. A. outer B. earthquake C. solar D. protect",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: {
                    meaning: { A: "B√™n ngo√†i", B: "ƒê·ªông ƒë·∫•t", C: "Thu·ªôc m·∫∑t tr·ªùi", D: "B·∫£o v·ªá" },
                    whyCorrect: "D. protect nh·∫•n √¢m 2 (pro'tect).",
                    whyWrong: "A, B, C nh·∫•n √¢m 1 ('outer, 'earthquake, 'solar)."
                }
            },
            {
                id: 15,
                type: "Stress",
                question: "Primary Stress",
                word: "5. A. pollute B. climate C. region D. livestock",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: { A: "G√¢y √¥ nhi·ªÖm", B: "Kh√≠ h·∫≠u", C: "V√πng mi·ªÅn", D: "V·∫≠t nu√¥i" },
                    whyCorrect: "A. pollute nh·∫•n √¢m 2 (pol'lute).",
                    whyWrong: "B, C, D nh·∫•n √¢m 1 ('climate, 'region, 'livestock)."
                }
            },
            {
                id: 16,
                type: "Stress",
                question: "Primary Stress",
                word: "6. A. advice B. nature C. system D. planet",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: {
                    meaning: { A: "L·ªùi khuy√™n", B: "Thi√™n nhi√™n", C: "H·ªá th·ªëng", D: "H√†nh tinh" },
                    whyCorrect: "A. advice nh·∫•n √¢m 2 (ad'vice).",
                    whyWrong: "B, C, D nh·∫•n √¢m 1 ('nature, 'system, 'planet)."
                }
            },
            {
                id: 17,
                type: "Stress",
                question: "Primary Stress",
                word: "7. A. existence B. reference C. pollution D. appliance",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: {
                    meaning: { A: "S·ª± t·ªìn t·∫°i", B: "T√†i li·ªáu tham kh·∫£o", C: "S·ª± √¥ nhi·ªÖm", D: "Thi·∫øt b·ªã" },
                    whyCorrect: "B. reference nh·∫•n √¢m 1 ('reference).",
                    whyWrong: "A, C, D nh·∫•n √¢m 2 (ex'istence, pol'lution, ap'pliance)."
                }
            },
            {
                id: 18,
                type: "Stress",
                question: "Primary Stress",
                word: "8. A. animal B. accident C. habitat D. dependence",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: {
                    meaning: { A: "ƒê·ªông v·∫≠t", B: "Tai n·∫°n", C: "M√¥i tr∆∞·ªùng s·ªëng", D: "S·ª± ph·ª• thu·ªôc" },
                    whyCorrect: "D. dependence nh·∫•n √¢m 2 (de'pendence).",
                    whyWrong: "A, B, C nh·∫•n √¢m 1 ('animal, 'accident, 'habitat)."
                }
            },
            {
                id: 19,
                type: "Stress",
                question: "Primary Stress",
                word: "9. A. amusement B. afternoon C. importance D. example",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: {
                    meaning: { A: "S·ª± gi·∫£i tr√≠", B: "Bu·ªïi chi·ªÅu", C: "T·∫ßm quan tr·ªçng", D: "V√≠ d·ª•" },
                    whyCorrect: "B. afternoon nh·∫•n √¢m 3 (after'noon).",
                    whyWrong: "A, C, D nh·∫•n √¢m 2 (a'musement, im'portance, ex'ample)."
                }
            },
            {
                id: 20,
                type: "Stress",
                question: "Primary Stress",
                word: "10. A. balance B. practice C. percent D. desert",
                options: ["A", "B", "C", "D"],
                correct: 2, // C
                explanation: {
                    meaning: { A: "C√¢n b·∫±ng", B: "Th·ª±c h√†nh", C: "Ph·∫ßn trƒÉm", D: "Sa m·∫°c (Danh t·ª´)" },
                    whyCorrect: "C. percent th∆∞·ªùng nh·∫•n √¢m 2 (per'cent).",
                    whyWrong: "A, B nh·∫•n √¢m 1. D (desert - sa m·∫°c) nh·∫•n √¢m 1. (L∆∞u √Ω: desert ƒë·ªông t·ª´ 'b·ªè r∆°i' m·ªõi nh·∫•n √¢m 2, nh∆∞ng ·ªü ƒë√¢y nh√≥m chung v·ªõi danh t·ª´)."
                }
            }
        ];

        let userAnswers = {};
        let score = 0;

        // === RENDER B√ÄI THI ===
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            
            quizData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-card-${index}`;

                let html = `
                    <div class="question-title">
                        <span class="question-badge">${item.type}</span>
                        <span>Question ${index + 1}</span>
                    </div>
                    <div class="question-text">${item.question}</div>
                    <div class="question-text" style="font-size: 1.4rem; color: var(--primary);">${item.word}</div>
                    
                    <div class="options-grid">
                        ${item.options.map((opt, i) => `
                            <button class="option-btn" id="btn-${index}-${i}" onclick="checkAnswer(${index}, ${i})">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>

                    <div class="explanation-box" id="exp-${index}">
                        <div class="exp-header">
                            <div class="exp-teacher-avatar">Ms.An</div>
                            <span id="exp-status-${index}">Gi·∫£i th√≠ch chi ti·∫øt:</span>
                        </div>
                        <div class="exp-content">
                            <span class="exp-label">üìñ T·ª´ v·ª±ng & Nghƒ©a:</span>
                            <table class="vocab-table">
                                <tr><th>Option</th><th>Meaning</th></tr>
                                ${Object.entries(item.explanation.meaning).map(([key, val]) => `<tr><td><b>${key}</b></td><td>${val}</td></tr>`).join('')}
                            </table>
                            
                            <span class="exp-label" style="color: var(--correct);">‚úÖ T·∫°i sao ƒë√∫ng:</span>
                            <p>${item.explanation.whyCorrect}</p>
                            
                            <span class="exp-label" style="color: var(--wrong);">‚ùå T·∫°i sao sai:</span>
                            <p>${item.explanation.whyWrong}</p>
                        </div>
                    </div>
                `;
                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        // === X·ª¨ L√ù CHECK ƒê√ÅP √ÅN ===
        function checkAnswer(questionIndex, selectedOptionIndex) {
            // Prevent re-answering
            if (userAnswers[questionIndex] !== undefined) return;
            
            userAnswers[questionIndex] = selectedOptionIndex;
            const question = quizData[questionIndex];
            const isCorrect = selectedOptionIndex === question.correct;
            
            // UI Update
            const btn = document.getElementById(`btn-${questionIndex}-${selectedOptionIndex}`);
            const correctBtn = document.getElementById(`btn-${questionIndex}-${question.correct}`);
            const expBox = document.getElementById(`exp-${questionIndex}`);
            const statusText = document.getElementById(`exp-status-${questionIndex}`);

            // Disable all buttons for this question
            for (let i = 0; i < 4; i++) {
                document.getElementById(`btn-${questionIndex}-${i}`).disabled = true;
            }

            if (isCorrect) {
                btn.classList.add('correct');
                score++;
                playSound('correct');
                triggerConfetti(btn);
                statusText.innerText = "Ch√≠nh x√°c! Em gi·ªèi l·∫Øm!";
                statusText.style.color = "var(--correct)";
            } else {
                btn.classList.add('wrong');
                correctBtn.classList.add('correct'); // Show correct answer
                playSound('wrong');
                expBox.classList.add('wrong-state');
                statusText.innerText = "√îi ti·∫øc qu√°! Xem gi·∫£i th√≠ch nh√©:";
                statusText.style.color = "var(--wrong)";
            }

            // Show Explanation immediately
            expBox.style.display = 'block';
        }

        // === SUBMIT & SCORE ===
        function submitQuiz() {
            const answeredCount = Object.keys(userAnswers).length;
            const total = quizData.length;
            
            // Random praise
            const praises = [
                "Em l√† si√™u nh√¢n Ti·∫øng Anh! ü¶∏‚Äç‚ôÄÔ∏è",
                "C·ªë g·∫Øng h∆°n ch√∫t n·ªØa l√† tuy·ªát v·ªùi! üí™",
                "Ms Mai An r·∫•t t·ª± h√†o v·ªÅ s·ª± chƒÉm ch·ªâ c·ªßa em! ‚ù§Ô∏è",
                "Ki·∫øn th·ª©c c·ªßa em r·∫•t v·ªØng! üåü"
            ];
            const randomPraise = praises[Math.floor(Math.random() * praises.length)];

            document.getElementById('finalScore').innerText = `${score}/${total}`;
            document.getElementById('feedbackText').innerText = randomPraise;
            document.getElementById('scoreModal').style.display = "flex";
            
            if (score === total) {
                playSound('correct');
                triggerConfetti(document.body);
            }
        }

        function closeModal() {
            document.getElementById('scoreModal').style.display = "none";
            location.reload(); // Reload to retry
        }

        // === AUDIO & EFFECTS ===
        // Using Web Audio API for simple sounds without external files
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // High pitch 'Ding'
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else {
                // Low pitch 'Buzz'
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Simple Confetti Logic
        function triggerConfetti(element) {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const colors = ['#8854C0', '#00C9A7', '#FF4757', '#FFD700', '#70a1ff'];

            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: element === document.body ? window.innerWidth / 2 : element.getBoundingClientRect().left + 50,
                    y: element === document.body ? window.innerHeight / 2 : element.getBoundingClientRect().top,
                    r: Math.random() * 6 + 2,
                    d: Math.random() * 5 + 2, // density
                    color: colors[Math.floor(Math.random() * colors.length)],
                    tilt: Math.floor(Math.random() * 10) - 10,
                    tiltAngleIncremental: (Math.random() * 0.07) + 0.05,
                    tiltAngle: 0
                });
            }

            let animationId;
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let results = [];
                particles.forEach((p, index) => {
                    p.tiltAngle += p.tiltAngleIncremental;
                    p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
                    p.tilt = Math.sin(p.tiltAngle - index / 3) * 15;

                    ctx.beginPath();
                    ctx.lineWidth = p.r;
                    ctx.strokeStyle = p.color;
                    ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
                    ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
                    ctx.stroke();

                    if (p.y > canvas.height) results.push(index);
                });

                results.forEach(index => particles.splice(index, 1));

                if (particles.length > 0) {
                    animationId = requestAnimationFrame(draw);
                }
            }
            draw();
        }

        // Initialize
        renderQuiz();
    </script>
</body>
</html>