<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i t·∫≠p: M·ªánh ƒë·ªÅ T∆∞∆°ng ph·∫£n - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m Pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --text-dark: #2f3542;
            --text-light: #ffffff;
            --bg-pattern: #f0f4f8;
            --card-shadow: 0 8px 0 rgba(0,0,0,0.15);
            --btn-shadow: 0 5px 0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(#dfe4ea 15%, transparent 16%), radial-gradient(#dfe4ea 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.2);
            border-bottom: 5px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            color: var(--primary);
            font-weight: 800;
            margin: 0;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header p {
            color: #747d8c;
            font-weight: 600;
            margin-top: 10px;
        }

        .teacher-badge {
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Question Card */
        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border: 2px solid #f1f2f6;
            position: relative;
            transition: transform 0.3s;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 800;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .hint-text {
            background: #fff4e6;
            color: #d35400;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.95rem;
            margin-bottom: 20px;
            border-left: 4px solid #e67e22;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e1e1e1;
            border-bottom: 4px solid #e1e1e1; /* 3D effect */
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #57606f;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            border-color: var(--primary);
            color: var(--primary);
            background: #f8f0ff;
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(2px);
            border-bottom-width: 0;
            margin-top: 4px;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background: var(--correct) !important;
            color: white !important;
            border-color: #00b85c !important;
            border-bottom-color: #008f47 !important;
        }

        .option-btn.wrong {
            background: var(--wrong) !important;
            color: white !important;
            border-color: #ff2e40 !important;
            border-bottom-color: #d61c2d !important;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            cursor: default;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background: #f0fdf4;
            border: 2px solid var(--correct);
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }
        
        .explanation-box.show {
            display: block;
        }

        .teacher-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid var(--correct);
            float: left;
            margin-right: 15px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .explanation-title {
            color: #009432;
            font-weight: 800;
            margin-bottom: 10px;
            display: block;
            text-transform: uppercase;
        }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #2f3542;
        }

        .explanation-detail-item {
            margin-bottom: 8px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 8px;
        }
        .explanation-detail-item:last-child {
            border-bottom: none;
        }
        .explanation-label {
            font-weight: 700;
            color: var(--primary);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer */
        .footer-submit {
            text-align: center;
            margin-top: 50px;
            padding-bottom: 50px;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #6c429c, 0 15px 20px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            font-family: 'Nunito', sans-serif;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            background: #9b59d6;
        }

        .submit-btn:active {
            transform: translateY(3px);
            box-shadow: 0 0 0 #6c429c;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: zoomIn 0.4s;
            position: relative;
            overflow: hidden;
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 1.2rem;
            margin-bottom: 30px;
            font-weight: 600;
        }

        /* Canvas for confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <div class="header">
        <span class="teacher-badge">Gi√°o vi√™n: Ms. Mai An ULIS</span>
        <h1>B√†i t·∫≠p: M·ªánh ƒë·ªÅ T∆∞∆°ng ph·∫£n</h1>
        <p>Th·ª≠ th√°ch ki·∫øn th·ª©c: Concessive Clauses</p>
    </div>

    <div class="container" id="quiz-container">
        <!-- Questions will be rendered here via JS -->
    </div>

    <div class="footer-submit">
        <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI <i class="fas fa-paper-plane"></i></button>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay" id="resultModal">
        <div class="result-card">
            <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
            <div class="score-display">
                <span id="final-score">0</span>/30
            </div>
            <p class="feedback-text" id="feedback-msg">B·∫°n l√†m r·∫•t t·ªët!</p>
            <button class="submit-btn" style="font-size: 1.2rem; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

<script>
    // DATA T·ª™ FILE G·ªêC (30 C√ÇU H·ªéI)
    const quizData = [
    {
      "questionNumber": 1,
      "question": "______ he is rich, he is not happy.",
      "hint": "Ph√≠a sau ch·ªó tr·ªëng l√† 'he is rich' (S + V).",
      "answerOptions": [
        { "text": "Because", "rationale": "D·ªãch: B·ªüi v√¨ (conj). \nGi·∫£i th√≠ch: Sai nghƒ©a. (Gi√†u c√≥ th∆∞·ªùng ƒëi ƒë√¥i v·ªõi sung s∆∞·ªõng, n·∫øu d√πng 'b·ªüi v√¨' th√¨ m√¢u thu·∫´n v·ªõi v·∫ø sau 'kh√¥ng h·∫°nh ph√∫c').", "isCorrect": false },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: ƒê√∫ng. 'Although' + M·ªánh ƒë·ªÅ (S + V) d√πng ƒë·ªÉ ch·ªâ s·ª± t∆∞∆°ng ph·∫£n. \nD·ªãch c√¢u: M·∫∑c d√π √¥ng ·∫•y gi√†u, √¥ng ·∫•y kh√¥ng h·∫°nh ph√∫c.", "isCorrect": true },
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π (prep). \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. 'Despite' ƒëi v·ªõi danh t·ª´, kh√¥ng ƒëi v·ªõi m·ªánh ƒë·ªÅ.", "isCorrect": false },
        { "text": "In spite", "rationale": "D·ªãch: M·∫∑c d√π (prep phrase). \nGi·∫£i th√≠ch: Sai. Thi·∫øu gi·ªõi t·ª´ 'of'.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 2,
      "question": "______ the rain, we went to the beach.",
      "hint": "'the rain' l√† m·ªôt c·ª•m danh t·ª´ (noun phrase).",
      "answerOptions": [
        { "text": "Even though", "rationale": "D·ªãch: Th·∫≠m ch√≠ m·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai. C·∫ßn m·ªánh ƒë·ªÅ (S + V).", "isCorrect": false },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai. C·∫ßn m·ªánh ƒë·ªÅ (S + V).", "isCorrect": false },
        { "text": "In spite of", "rationale": "D·ªãch: M·∫∑c d√π (prep phrase). \nGi·∫£i th√≠ch: ƒê√∫ng. 'In spite of' + Noun Phrase (the rain). \nD·ªãch c√¢u: B·∫•t ch·∫•p tr·ªùi m∆∞a, ch√∫ng t√¥i v·∫´n ƒëi bi·ªÉn.", "isCorrect": true },
        { "text": "Because of", "rationale": "D·ªãch: B·ªüi v√¨ (prep phrase). \nGi·∫£i th√≠ch: Sai nghƒ©a. (Kh√¥ng ai ƒëi bi·ªÉn 'b·ªüi v√¨' tr·ªùi m∆∞a).", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 3,
      "question": "She went to work ______ she was ill.",
      "hint": "'she was ill' l√† m·ªôt m·ªánh ƒë·ªÅ (S + V).",
      "answerOptions": [
        { "text": "despite", "rationale": "D·ªãch: m·∫∑c d√π (prep). \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "in spite of", "rationale": "D·ªãch: m·∫∑c d√π (prep). \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "even though", "rationale": "D·ªãch: m·∫∑c d√π/th·∫≠m ch√≠ l√† (conj). \nGi·∫£i th√≠ch: ƒê√∫ng. Even though + S + V. \nD·ªãch c√¢u: C√¥ ·∫•y v·∫´n ƒëi l√†m m·∫∑c d√π c√¥ ·∫•y b·ªã ·ªëm.", "isCorrect": true },
        { "text": "because", "rationale": "D·ªãch: b·ªüi v√¨ (conj). \nGi·∫£i th√≠ch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 4,
      "question": "______ having a headache, I enjoyed the movie.",
      "hint": "'having a headache' l√† c·ª•m V-ing (Gerund phrase).",
      "answerOptions": [
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai. Although kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi V-ing trong ng·ªØ c·∫£nh n√†y.", "isCorrect": false },
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π (prep). \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + V-ing. \nD·ªãch c√¢u: M·∫∑c d√π b·ªã ƒëau ƒë·∫ßu, t√¥i v·∫´n th√≠ch b·ªô phim.", "isCorrect": true },
        { "text": "Though", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai.", "isCorrect": false },
        { "text": "Because", "rationale": "D·ªãch: B·ªüi v√¨ (conj). \nGi·∫£i th√≠ch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 5,
      "question": "We plan to go camping ______ the bad weather forecast.",
      "hint": "'the bad weather forecast' l√† c·ª•m danh t·ª´.",
      "answerOptions": [
        { "text": "although", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai (c·∫ßn m·ªánh ƒë·ªÅ).", "isCorrect": false },
        { "text": "despite of", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. 'Despite' kh√¥ng bao gi·ªù ƒëi v·ªõi 'of'.", "isCorrect": false },
        { "text": "in spite of", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. In spite of + Noun phrase. \nD·ªãch c√¢u: Ch√∫ng t√¥i d·ª± ƒë·ªãnh ƒëi c·∫Øm tr·∫°i b·∫•t ch·∫•p d·ª± b√°o th·ªùi ti·∫øt x·∫•u.", "isCorrect": true },
        { "text": "even though", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai (c·∫ßn m·ªánh ƒë·ªÅ).", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 6,
      "question": "______ he studied hard, he failed the exam.",
      "hint": "Hai v·∫ø t∆∞∆°ng ph·∫£n (h·ªçc chƒÉm - tr∆∞·ª£t).",
      "answerOptions": [
        { "text": "Because", "rationale": "D·ªãch: B·ªüi v√¨. \nGi·∫£i th√≠ch: Sai nghƒ©a.", "isCorrect": false },
        { "text": "Though", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: ƒê√∫ng. Though + S + V. \nD·ªãch c√¢u: D√π anh ·∫•y h·ªçc chƒÉm, anh ·∫•y v·∫´n tr∆∞·ª£t.", "isCorrect": true },
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "In spite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai (thi·∫øu 'of').", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 7,
      "question": "Which sentence is correct?",
      "hint": "Ki·ªÉm tra l·ªói d√πng 'Despite of' ho·∫∑c k·∫øt h·ª£p 'Although' v√† 'But'.",
      "answerOptions": [
        { "text": "Although he is tired, but he keeps working.", "rationale": "D·ªãch: M·∫∑c d√π... nh∆∞ng... \nGi·∫£i th√≠ch: Sai. Kh√¥ng d√πng 'Although' v√† 'But' c√πng l√∫c.", "isCorrect": false },
        { "text": "Despite of being tired, he keeps working.", "rationale": "D·ªãch: M·∫∑c d√π m·ªát... \nGi·∫£i th√≠ch: Sai. Th·ª´a 'of' sau Despite.", "isCorrect": false },
        { "text": "In spite he is tired, he keeps working.", "rationale": "D·ªãch: Sai ng·ªØ ph√°p. \nGi·∫£i th√≠ch: Thi·∫øu 'of' v√† sau ƒë√≥ ph·∫£i l√† N/V-ing.", "isCorrect": false },
        { "text": "Though he is tired, he keeps working.", "rationale": "D·ªãch: M·∫∑c d√π anh ·∫•y m·ªát, anh ·∫•y v·∫´n ti·∫øp t·ª•c l√†m vi·ªác. \nGi·∫£i th√≠ch: ƒê√∫ng ng·ªØ ph√°p.", "isCorrect": true }
      ]
    },
    {
      "questionNumber": 8,
      "question": "______ the fact that I was hungry, I didn't eat anything.",
      "hint": "C·∫•u tr√∫c 'The fact that' bi·∫øn m·ªánh ƒë·ªÅ th√†nh c·ª•m danh t·ª´ ƒë·ªÉ ƒëi v·ªõi gi·ªõi t·ª´.",
      "answerOptions": [
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π (prep). \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + Noun Phrase (the fact that...). \nD·ªãch c√¢u: M·∫∑c d√π th·ª±c t·∫ø l√† t√¥i ƒë√≥i, t√¥i ƒë√£ kh√¥ng ƒÉn g√¨.", "isCorrect": true },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai. Although + S + V tr·ª±c ti·∫øp.", "isCorrect": false },
        { "text": "Though", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai t∆∞∆°ng t·ª± Although.", "isCorrect": false },
        { "text": "Even though", "rationale": "D·ªãch: M·∫∑c d√π (conj). \nGi·∫£i th√≠ch: Sai t∆∞∆°ng t·ª± Although.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 9,
      "question": "______ beautiful she is, nobody likes her.",
      "hint": "C·∫•u tr√∫c ƒë·∫£o ng·ªØ nh·∫•n m·∫°nh t√≠nh t·ª´: Adj + as/though + S + V.",
      "answerOptions": [
        { "text": "However", "rationale": "D·ªãch: Tuy nhi√™n. \nGi·∫£i th√≠ch: ƒê√∫ng. However + adj + S + V (No matter how beautiful she is). \nD·ªãch: D√π c√¥ ·∫•y ƒë·∫πp ƒë·∫øn th·∫ø n√†o, kh√¥ng ai th√≠ch c√¥ ·∫•y.", "isCorrect": true },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai c·∫•u tr√∫c. Ph·∫£i l√† 'Although she is beautiful'.", "isCorrect": false },
        { "text": "Much as", "rationale": "D·ªãch: M·∫∑c d√π nhi·ªÅu... \nGi·∫£i th√≠ch: 'Much as' th∆∞·ªùng ƒëi v·ªõi ƒë·ªông t·ª´ (Much as I like you...).", "isCorrect": false },
        { "text": "Beautiful as", "rationale": "D·ªãch: D√π ƒë·∫πp... \nGi·∫£i th√≠ch: Sai v·ªã tr√≠. Ph·∫£i l√† 'Beautiful as she is'.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 10,
      "question": "Safe ______ it was, we didn't want to stay there.",
      "hint": "C·∫•u tr√∫c ƒë·∫£o: Adj + AS/THOUGH + S + be.",
      "answerOptions": [
        { "text": "although", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai v·ªã tr√≠.", "isCorrect": false },
        { "text": "as", "rationale": "D·ªãch: m·∫∑c d√π (trong c·∫•u tr√∫c ƒë·∫£o). \nGi·∫£i th√≠ch: ƒê√∫ng. Safe (adj) + as + it (S) + was (V). \nD·ªãch c√¢u: M·∫∑c d√π n√≥ an to√†n, ch√∫ng t√¥i kh√¥ng mu·ªën ·ªü l·∫°i ƒë√≥.", "isCorrect": true },
        { "text": "even though", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai v·ªã tr√≠.", "isCorrect": false },
        { "text": "despite", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 11,
      "question": "Rewrite: 'Although he is strong, he can't lift the box.' -> 'Despite ______'",
      "hint": "Strong (adj) -> Strength (noun). D√πng t√≠nh t·ª´ s·ªü h·ªØu 'his'.",
      "answerOptions": [
        { "text": "his strong", "rationale": "D·ªãch: Sai lo·∫°i t·ª´ (strong l√† adj).", "isCorrect": false },
        { "text": "his strength", "rationale": "D·ªãch: s·ª©c m·∫°nh c·ªßa anh ·∫•y. \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + his strength (Noun). \nD·ªãch: M·∫∑c d√π c√≥ s·ª©c m·∫°nh, anh ·∫•y kh√¥ng nh·∫•c n·ªïi c√°i h·ªôp.", "isCorrect": true },
        { "text": "he is strong", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (m·ªánh ƒë·ªÅ).", "isCorrect": false },
        { "text": "being strength", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (strength l√† N, sau being ph·∫£i l√† adj ho·∫∑c N ch·ªâ th√¢n ph·∫≠n).", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 12,
      "question": "______ I explained it to him, he didn't understand.",
      "hint": "S + V ('I explained...').",
      "answerOptions": [
        { "text": "In spite of", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "Even though", "rationale": "D·ªãch: Th·∫≠m ch√≠ m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Even though + S + V. \nD·ªãch c√¢u: D√π t√¥i ƒë√£ gi·∫£i th√≠ch cho anh ·∫•y, anh ·∫•y v·∫´n kh√¥ng hi·ªÉu.", "isCorrect": true },
        { "text": "Because of", "rationale": "D·ªãch: B·ªüi v√¨. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p v√† nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 13,
      "question": "Rewrite: 'In spite of the cold weather, we went swimming.' -> 'Although ______'",
      "hint": "Chuy·ªÉn c·ª•m danh t·ª´ 'the cold weather' th√†nh m·ªánh ƒë·ªÅ 'the weather + be + adj'.",
      "answerOptions": [
        { "text": "the weather was cold", "rationale": "D·ªãch: th·ªùi ti·∫øt th√¨ l·∫°nh. \nGi·∫£i th√≠ch: ƒê√∫ng. Although + S (the weather) + V (was) + Adj (cold).", "isCorrect": true },
        { "text": "the cold weather", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (thi·∫øu ƒë·ªông t·ª´).", "isCorrect": false },
        { "text": "weather cold", "rationale": "D·ªãch: Sai tr·∫≠t t·ª± v√† ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "it was weather cold", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 14,
      "question": "______ of his age, he runs very fast.",
      "hint": "Ch·ªâ c√≥ m·ªôt t·ª´ ƒëi k√®m v·ªõi 'of' ƒë·ªÉ t·∫°o th√†nh c·ª•m t·ª´ ch·ªâ t∆∞∆°ng ph·∫£n.",
      "answerOptions": [
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai. Despite kh√¥ng ƒëi v·ªõi Of.", "isCorrect": false },
        { "text": "In spite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. 'In spite of'. \nD·ªãch c√¢u: B·∫•t ch·∫•p tu·ªïi t√°c, √¥ng ·∫•y ch·∫°y r·∫•t nhanh.", "isCorrect": true },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai. Although kh√¥ng ƒëi v·ªõi Of.", "isCorrect": false },
        { "text": "Even though", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: Sai.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 15,
      "question": "I couldn't sleep ______ being very tired.",
      "hint": "Being very tired (V-ing phrase).",
      "answerOptions": [
        { "text": "although", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai.", "isCorrect": false },
        { "text": "despite", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + V-ing. \nD·ªãch c√¢u: T√¥i kh√¥ng ng·ªß ƒë∆∞·ª£c d√π r·∫•t m·ªát.", "isCorrect": true },
        { "text": "though", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai.", "isCorrect": false },
        { "text": "despite of", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai (th·ª´a of).", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 16,
      "question": "Rewrite: 'Although she has a lot of money, she lives simply.' -> 'Despite ______'",
      "hint": "Has a lot of money -> Having a lot of money.",
      "answerOptions": [
        { "text": "having a lot of money", "rationale": "D·ªãch: vi·ªác c√≥ nhi·ªÅu ti·ªÅn. \nGi·∫£i th√≠ch: ƒê√∫ng. R√∫t g·ªçn hai ch·ªß ng·ªØ gi·ªëng nhau (She) -> V-ing (Having).", "isCorrect": true },
        { "text": "she has a lot of money", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (m·ªánh ƒë·ªÅ).", "isCorrect": false },
        { "text": "have a lot of money", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (V nguy√™n th·ªÉ).", "isCorrect": false },
        { "text": "money a lot", "rationale": "D·ªãch: Sai c·∫•u tr√∫c.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 17,
      "question": "______ his physical handicap, he has become a successful businessman.",
      "hint": "'his physical handicap' (noun phrase).",
      "answerOptions": [
        { "text": "In spite", "rationale": "D·ªãch: Sai (thi·∫øu of).", "isCorrect": false },
        { "text": "Although", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "Despite", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + Noun phrase. \nD·ªãch c√¢u: M·∫∑c d√π b·ªã khuy·∫øt t·∫≠t c∆° th·ªÉ, anh ·∫•y ƒë√£ tr·ªü th√†nh doanh nh√¢n th√†nh ƒë·∫°t.", "isCorrect": true },
        { "text": "Because", "rationale": "D·ªãch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 18,
      "question": "Rewrite: 'Although the traffic was bad, I arrived on time.' -> 'In spite of ______'",
      "hint": "The traffic was bad -> The bad traffic.",
      "answerOptions": [
        { "text": "the bad traffic", "rationale": "D·ªãch: giao th√¥ng t·ªá h·∫°i. \nGi·∫£i th√≠ch: ƒê√∫ng. Chuy·ªÉn m·ªánh ƒë·ªÅ th√†nh c·ª•m danh t·ª´ (The + adj + noun).", "isCorrect": true },
        { "text": "the traffic bad", "rationale": "D·ªãch: Sai tr·∫≠t t·ª±.", "isCorrect": false },
        { "text": "bad traffic", "rationale": "D·ªãch: Thi·∫øu m·∫°o t·ª´ 'the'. \nGi·∫£i th√≠ch: Giao th√¥ng ƒë√£ x√°c ƒë·ªãnh trong c√¢u g·ªëc.", "isCorrect": false },
        { "text": "the traffic was bad", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (m·ªánh ƒë·ªÅ).", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 19,
      "question": "She didn't get the job ______ she had all the necessary qualifications.",
      "hint": "S + V ('she had...').",
      "answerOptions": [
        { "text": "despite", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai.", "isCorrect": false },
        { "text": "in spite of", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: Sai.", "isCorrect": false },
        { "text": "although", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Although + S + V. \nD·ªãch c√¢u: C√¥ ·∫•y kh√¥ng nh·∫≠n ƒë∆∞·ª£c vi·ªác m·∫∑c d√π c√≥ ƒë·ªß b·∫±ng c·∫•p c·∫ßn thi·∫øt.", "isCorrect": true },
        { "text": "because of", "rationale": "D·ªãch: b·ªüi v√¨. \nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p v√† nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 20,
      "question": "______ I love music, I can't play any instrument.",
      "hint": "Much + as + S + V (C·∫•u tr√∫c nh·∫•n m·∫°nh).",
      "answerOptions": [
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng ng·ªØ ph√°p. Tuy nhi√™n, 'Much as' th∆∞·ªùng ƒë∆∞·ª£c ∆∞u ti√™n n·∫øu mu·ªën nh·∫•n m·∫°nh.", "isCorrect": false },
        { "text": "Much as", "rationale": "D·ªãch: D√π t√¥i y√™u √¢m nh·∫°c r·∫•t nhi·ªÅu... \nGi·∫£i th√≠ch: ƒê√∫ng. C·∫•u tr√∫c 'Much as + S + V' nh·∫•n m·∫°nh c·∫£m x√∫c. Trong c√¢u h·ªèi n√†y 'Much as' l√† ƒë√°p √°n t·ªëi ∆∞u h∆°n.", "isCorrect": true },
        { "text": "Despite", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "In spite", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 21,
      "question": "Rewrite: 'Even though he is talented, he is not famous.' -> 'Despite ______'",
      "hint": "Talented (adj) -> Talent (noun).",
      "answerOptions": [
        { "text": "his talented", "rationale": "D·ªãch: Sai lo·∫°i t·ª´.", "isCorrect": false },
        { "text": "his talent", "rationale": "D·ªãch: t√†i nƒÉng c·ªßa anh ·∫•y. \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + his (possessive) + talent (noun).", "isCorrect": true },
        { "text": "he is talented", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "being talented", "rationale": "D·ªãch: vi·ªác t√†i nƒÉng. \nGi·∫£i th√≠ch: ƒê√∫ng ng·ªØ ph√°p nh∆∞ng k√©m trang tr·ªçng h∆°n 'his talent'.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 22,
      "question": "We went out ______ the snow.",
      "hint": "Noun phrase 'the snow'.",
      "answerOptions": [
        { "text": "although", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "despite", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Despite + Noun. \nD·ªãch c√¢u: Ch√∫ng t√¥i ra ngo√†i b·∫•t ch·∫•p tuy·∫øt r∆°i.", "isCorrect": true },
        { "text": "even though", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "because", "rationale": "D·ªãch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 23,
      "question": "______ hard he tried, he couldn't open the door.",
      "hint": "C·∫•u tr√∫c: However + adj/adv + S + V.",
      "answerOptions": [
        { "text": "Although", "rationale": "D·ªãch: Sai c·∫•u tr√∫c.", "isCorrect": false },
        { "text": "However", "rationale": "D·ªãch: D√π... th·∫ø n√†o ƒëi n·ªØa. \nGi·∫£i th√≠ch: ƒê√∫ng. However hard he tried = No matter how hard he tried. \nD·ªãch c√¢u: D√π anh ·∫•y c·ªë g·∫Øng th·∫ø n√†o, anh ·∫•y c≈©ng kh√¥ng m·ªü ƒë∆∞·ª£c c·ª≠a.", "isCorrect": true },
        { "text": "Even though", "rationale": "D·ªãch: Sai c·∫•u tr√∫c.", "isCorrect": false },
        { "text": "Despite", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 24,
      "question": "Rewrite: 'Although I was late, I didn't miss the bus.' -> 'In spite of ______'",
      "hint": "I was late -> Being late.",
      "answerOptions": [
        { "text": "being late", "rationale": "D·ªãch: vi·ªác b·ªã mu·ªôn. \nGi·∫£i th√≠ch: ƒê√∫ng. R√∫t g·ªçn ch·ªß ng·ªØ 'I', chuy·ªÉn 'was' th√†nh 'being'.", "isCorrect": true },
        { "text": "I was late", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "my late", "rationale": "D·ªãch: Sai lo·∫°i t·ª´ (Late l√† adj).", "isCorrect": false },
        { "text": "the late", "rationale": "D·ªãch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 25,
      "question": "______ John is very busy, he helps me with my homework.",
      "hint": "S + V.",
      "answerOptions": [
        { "text": "Despite", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "In spite of", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "Although", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. Although + S + V. \nD·ªãch c√¢u: M·∫∑c d√π John r·∫•t b·∫≠n, c·∫≠u ·∫•y v·∫´n gi√∫p t√¥i l√†m b√†i.", "isCorrect": true },
        { "text": "Because of", "rationale": "D·ªãch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 26,
      "question": "Rich ______ he is, he lives in a small house.",
      "hint": "Adj + AS + S + V.",
      "answerOptions": [
        { "text": "although", "rationale": "D·ªãch: Sai v·ªã tr√≠.", "isCorrect": false },
        { "text": "as", "rationale": "D·ªãch: m·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. C·∫•u tr√∫c ƒë·∫£o ng·ªØ v·ªõi 'As'. \nD·ªãch c√¢u: M·∫∑c d√π gi√†u c√≥, √¥ng ·∫•y s·ªëng trong cƒÉn nh√† nh·ªè.", "isCorrect": true },
        { "text": "but", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "despite", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 27,
      "question": "Rewrite: 'Despite the noise, the baby slept soundly.' -> 'Although ______'",
      "hint": "The noise -> It was noisy / The room was noisy.",
      "answerOptions": [
        { "text": "it was noisy", "rationale": "D·ªãch: tr·ªùi/kh√¥ng gian ·ªìn √†o. \nGi·∫£i th√≠ch: ƒê√∫ng. Chuy·ªÉn danh t·ª´ Noise th√†nh t√≠nh t·ª´ Noisy trong m·ªánh ƒë·ªÅ.", "isCorrect": true },
        { "text": "the noise", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "noisy", "rationale": "D·ªãch: Sai ng·ªØ ph√°p (thi·∫øu S + V).", "isCorrect": false },
        { "text": "there was noise", "rationale": "D·ªãch: c√≥ ti·∫øng ·ªìn. \nGi·∫£i th√≠ch: C≈©ng ƒë√∫ng ng·ªØ ph√°p, nh∆∞ng 'it was noisy' ph·ªï bi·∫øn h∆°n trong vi·ªác chuy·ªÉn ƒë·ªïi.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 28,
      "question": "______ not having a ticket, he tried to enter the concert.",
      "hint": "Not having... (V-ing phrase).",
      "answerOptions": [
        { "text": "Although", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "Even though", "rationale": "D·ªãch: Sai.", "isCorrect": false },
        { "text": "In spite of", "rationale": "D·ªãch: M·∫∑c d√π. \nGi·∫£i th√≠ch: ƒê√∫ng. In spite of + V-ing (ph·ªß ƒë·ªãnh: not V-ing). \nD·ªãch c√¢u: D√π kh√¥ng c√≥ v√©, anh ta v·∫´n c·ªë v√†o xem h√≤a nh·∫°c.", "isCorrect": true },
        { "text": "Unless", "rationale": "D·ªãch: Tr·ª´ khi. \nGi·∫£i th√≠ch: Sai nghƒ©a.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 29,
      "question": "Rewrite: 'Although I felt tired, I couldn't sleep.' -> 'Despite ______'",
      "hint": "Felt tired -> Feeling tired (Same subject).",
      "answerOptions": [
        { "text": "feeling tired", "rationale": "D·ªãch: c·∫£m th·∫•y m·ªát. \nGi·∫£i th√≠ch: ƒê√∫ng. R√∫t g·ªçn ch·ªß ng·ªØ -> V-ing.", "isCorrect": true },
        { "text": "felt tired", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false },
        { "text": "the tiredness", "rationale": "D·ªãch: s·ª± m·ªát m·ªèi. \nGi·∫£i th√≠ch: ƒê√∫ng ng·ªØ ph√°p nh∆∞ng 'feeling tired' tr·ª±c quan h∆°n v·ªõi ƒë·ªông t·ª´ 'felt'.", "isCorrect": false },
        { "text": "I felt tired", "rationale": "D·ªãch: Sai ng·ªØ ph√°p.", "isCorrect": false }
      ]
    },
    {
      "questionNumber": 30,
      "question": "______ difficult the problem is, we must solve it.",
      "hint": "T∆∞∆°ng t·ª± c√¢u 9 v√† 23. C·∫•u tr√∫c No matter how / However.",
      "answerOptions": [
        { "text": "Whatever", "rationale": "D·ªãch: B·∫•t c·ª© c√°i g√¨. \nGi·∫£i th√≠ch: Sai. Whatever + Noun.", "isCorrect": false },
        { "text": "Although", "rationale": "D·ªãch: Sai c·∫•u tr√∫c.", "isCorrect": false },
        { "text": "However", "rationale": "D·ªãch: D√π... th·∫ø n√†o. \nGi·∫£i th√≠ch: ƒê√∫ng. However + Adj + S + V. \nD·ªãch c√¢u: D√π v·∫•n ƒë·ªÅ kh√≥ khƒÉn th·∫ø n√†o, ch√∫ng ta ph·∫£i gi·∫£i quy·∫øt n√≥.", "isCorrect": true },
        { "text": "As", "rationale": "D·ªãch: Sai v·ªã tr√≠ (As ph·∫£i ƒë·ª©ng sau difficult).", "isCorrect": false }
      ]
    }
  ];

    let currentScore = 0;
    const answeredState = new Array(quizData.length).fill(false);

    // RENDER QUESTIONS
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        
        quizData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            
            // Build Options HTML
            let optionsHtml = '';
            item.answerOptions.forEach((opt, optIndex) => {
                optionsHtml += `<button class="option-btn" id="q${index}_opt${optIndex}" onclick="checkAnswer(${index}, ${optIndex})">${String.fromCharCode(65 + optIndex)}. ${opt.text}</button>`;
            });

            // Build Explanation Content (Aggregated)
            let explanationDetails = '';
            item.answerOptions.forEach((opt, optIndex) => {
                const label = String.fromCharCode(65 + optIndex);
                // Clean up rationale for display (bolding text)
                const formattedRationale = opt.rationale.replace(/\n/g, '<br>').replace(/D·ªãch:/g, '<b>D·ªãch:</b>').replace(/Gi·∫£i th√≠ch:/g, '<b>Gi·∫£i th√≠ch:</b>');
                const colorStyle = opt.isCorrect ? 'color:#009432' : 'color:#57606f';
                explanationDetails += `
                    <div class="explanation-detail-item" style="${colorStyle}">
                        <span class="explanation-label">${label}. ${opt.text}</span><br>
                        ${formattedRationale}
                    </div>
                `;
            });

            card.innerHTML = `
                <div class="question-header">
                    <div class="question-number">${item.questionNumber}</div>
                    <div style="color: #a4b0be; font-weight: 600;">Question ${index + 1}/30</div>
                </div>
                <div class="question-text">${item.question}</div>
                ${item.hint ? `<div class="hint-text"><i class="far fa-lightbulb"></i> G·ª£i √Ω: ${item.hint}</div>` : ''}
                <div class="options-grid">
                    ${optionsHtml}
                </div>
                <div class="explanation-box" id="explain_${index}">
                    <div class="teacher-avatar">üë©‚Äçüè´</div>
                    <span class="explanation-title">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <div class="explanation-content">
                       ${explanationDetails}
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // CHECK ANSWER LOGIC
    function checkAnswer(qIndex, optIndex) {
        if (answeredState[qIndex]) return; // Prevent changing answer
        answeredState[qIndex] = true;

        const question = quizData[qIndex];
        const selectedOpt = question.answerOptions[optIndex];
        const correctOptIndex = question.answerOptions.findIndex(o => o.isCorrect);

        const btnSelected = document.getElementById(`q${qIndex}_opt${optIndex}`);
        const btnCorrect = document.getElementById(`q${qIndex}_opt${correctOptIndex}`);

        // Disable all buttons in this question
        for(let i=0; i<4; i++) {
            const btn = document.getElementById(`q${qIndex}_opt${i}`);
            if(btn) btn.classList.add('disabled');
        }

        if (selectedOpt.isCorrect) {
            btnSelected.classList.add('correct');
            currentScore++;
            playSound('correct');
            triggerConfetti(btnSelected);
        } else {
            btnSelected.classList.add('wrong');
            btnCorrect.classList.add('correct');
            playSound('wrong');
        }

        // Show Explanation
        const explainBox = document.getElementById(`explain_${qIndex}`);
        explainBox.classList.add('show');
    }

    // FINISH QUIZ
    function finishQuiz() {
        const notAnswered = answeredState.filter(x => x === false).length;
        if (notAnswered > 0) {
            if(!confirm(`B·∫°n c√≤n ${notAnswered} c√¢u ch∆∞a l√†m. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`)) return;
        }
        
        document.getElementById('final-score').innerText = currentScore;
        const msg = document.getElementById('feedback-msg');
        
        if(currentScore === 30) msg.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng·ªØ ph√°p! üèÜ";
        else if(currentScore >= 20) msg.innerText = "Gi·ªèi l·∫Øm! B·∫°n n·∫Øm kh√° ch·∫Øc ki·∫øn th·ª©c r·ªìi! üåü";
        else if(currentScore >= 10) msg.innerText = "Kh√° t·ªët! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu r√µ h∆°n nh√©! üí™";
        else msg.innerText = "C·ªë l√™n! H√£y √¥n l·∫°i b√†i v√† th·ª≠ l·∫°i l·∫ßn n·ªØa nh√©! üìö";

        document.getElementById('resultModal').style.display = 'flex';
        playSound('finish');
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
    }

    // SOUNDS (Base64 for Single File Portability)
    // Short Ding
    const soundCorrect = new Audio("data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="); 
    // We will use a real simple beep synthesis instead of heavy base64 strings to ensure it works
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else if (type === 'wrong') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        } else if (type === 'finish') {
             // Simple melody
             const now = audioCtx.currentTime;
             [500, 600, 800].forEach((freq, i) => {
                 const o = audioCtx.createOscillator();
                 const g = audioCtx.createGain();
                 o.connect(g);
                 g.connect(audioCtx.destination);
                 o.frequency.value = freq;
                 g.gain.setValueAtTime(0.2, now + i*0.15);
                 g.gain.exponentialRampToValueAtTime(0.001, now + i*0.15 + 0.3);
                 o.start(now + i*0.15);
                 o.stop(now + i*0.15 + 0.3);
             });
        }
    }

    // CONFETTI LOGIC
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particles = [];

    function triggerConfetti(element) {
        const rect = element.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;

        for (let i = 0; i < 30; i++) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10 - 5,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                life: 100
            });
        }
        requestAnimationFrame(updateConfetti);
    }

    function updateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.2; // gravity
            p.life--;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 6, 6);
        }
        particles = particles.filter(p => p.life > 0);
        if (particles.length > 0) requestAnimationFrame(updateConfetti);
    }

    // Initialize
    renderQuiz();

</script>
</body>
</html>
