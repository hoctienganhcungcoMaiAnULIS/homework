<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i t·∫≠p Ng·ªØ ph√°p: Hi·ªán t·∫°i ti·∫øp di·ªÖn, C√°c th√¨ & Gi·ªõi t·ª´ - Ms Mai An ULIS</title>
    <!-- Import Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f4f8;
            background-image: radial-gradient(#d1d5db 1px, transparent 1px), radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            /* Zigzag pattern overlay opacity */
            position: relative;
            overflow-x: hidden;
        }

        /* Custom Colors */
        :root {
            --primary: #8854C0; /* Purple */
            --secondary: #00C9A7; /* Teal */
            --success: #00D26A; /* Green */
            --error: #FF4757; /* Red/Orange */
            --warning: #FFC048; /* Yellow */
            --text-main: #2f3542;
        }

        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
            background: 
                linear-gradient(135deg, #8854c022 25%, transparent 25%) -10px 0/ 20px 20px,
                linear-gradient(225deg, #00c9a722 25%, transparent 25%) -10px 0/ 20px 20px,
                linear-gradient(315deg, #8854c022 25%, transparent 25%) 0px 0/ 20px 20px,
                linear-gradient(45deg, #00c9a722 25%, transparent 25%) 0px 0/ 20px 20px;
        }

        /* 3D Button Styles */
        .btn-3d {
            transition: all 0.1s;
            border-bottom: 5px solid rgba(0,0,0,0.2);
            transform: translateY(0);
        }

        .btn-3d:active {
            transform: translateY(4px);
            border-bottom: 1px solid rgba(0,0,0,0.2);
        }

        .option-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 0 #cbd5e1;
        }

        .option-card:hover:not(.disabled) {
            transform: translateY(-2px);
            border-color: var(--primary);
            background-color: #f3e8ff;
        }

        .option-card:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #cbd5e1;
        }

        .option-card.correct {
            background-color: var(--success);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #008f47;
        }

        .option-card.wrong {
            background-color: var(--error);
            color: white;
            border-color: #ff2e40;
            box-shadow: 0 4px 0 #d61c2d;
            animation: shake 0.5s;
        }

        .option-card.disabled {
            cursor: default;
            pointer-events: none;
            opacity: 0.7;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scrollbar custom */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }

        .explanation-box {
            border-left: 5px solid var(--warning);
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col items-center">

    <div class="bg-pattern"></div>

    <!-- Header -->
    <header class="w-full bg-white shadow-md py-4 px-6 flex justify-between items-center sticky top-0 z-50 border-b-4 border-purple-200">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-purple-600 text-white flex items-center justify-center font-bold text-xl shadow-lg">M</div>
            <div>
                <h1 class="font-extrabold text-xl text-purple-700 leading-tight">Ms. Mai An ULIS</h1>
                <p class="text-xs text-gray-500 font-semibold">Master of TESOL</p>
            </div>
        </div>
        <div class="bg-purple-100 px-4 py-2 rounded-full font-bold text-purple-700 shadow-sm border-2 border-purple-200">
            ƒêi·ªÉm: <span id="score">0</span>
        </div>
    </header>

    <!-- Main Game Container -->
    <main class="w-full max-w-3xl mt-6 mb-12 px-4 flex-grow flex flex-col items-center">
        
        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 rounded-full h-4 mb-6 border-2 border-gray-300 relative overflow-hidden">
            <div id="progress-bar" class="bg-teal-400 h-full rounded-full transition-all duration-500 ease-out border-r-4 border-teal-500" style="width: 0%"></div>
        </div>

        <!-- Question Card -->
        <div id="quiz-container" class="w-full bg-white rounded-3xl shadow-xl border-b-8 border-gray-200 p-6 md:p-8 relative transition-all duration-300">
            
            <!-- Question Header -->
            <div class="flex justify-between items-center mb-4">
                <span class="bg-teal-100 text-teal-700 font-bold px-3 py-1 rounded-lg text-sm uppercase tracking-wide">C√¢u h·ªèi <span id="current-q-num">1</span>/<span id="total-q-num">28</span></span>
            </div>

            <!-- Question Content -->
            <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-snug">
                <!-- Question goes here -->
            </h2>

            <!-- Options Grid -->
            <div id="options-container" class="grid grid-cols-1 gap-4 mb-6">
                <!-- Options generated by JS -->
            </div>

            <!-- Feedback & Explanation (Hidden by default) -->
            <div id="feedback-area" class="hidden mt-6 bg-blue-50 rounded-2xl p-6 border-2 border-blue-100 fade-in explanation-box">
                <div class="flex items-start gap-3 mb-4">
                    <div id="feedback-icon" class="text-3xl">üí°</div>
                    <div>
                        <h3 class="font-bold text-lg text-blue-800 mb-1">Gi·∫£i th√≠ch chi ti·∫øt c·ªßa c√¥ Mai An:</h3>
                        <div id="explanation-content" class="text-gray-700 text-sm md:text-base leading-relaxed whitespace-pre-line">
                            <!-- Explanation text -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Next Button -->
            <div class="mt-6 flex justify-end">
                <button id="next-btn" class="hidden btn-3d bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-8 rounded-2xl text-lg shadow-lg" onclick="nextQuestion()">
                    C√¢u ti·∫øp theo ‚ûú
                </button>
                <button id="finish-btn" class="hidden btn-3d bg-green-500 hover:bg-green-400 text-white font-bold py-3 px-8 rounded-2xl text-lg shadow-lg" onclick="showResults()">
                    Xem k·∫øt qu·∫£ üèÜ
                </button>
            </div>
        </div>

    </main>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center border-4 border-purple-200 transform scale-100 animate-bounce-in">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-3xl font-extrabold text-purple-700 mb-2">Ho√†n th√†nh!</h2>
            <p class="text-gray-600 mb-6">B·∫°n ƒë√£ l√†m r·∫•t t·ªët b√†i ki·ªÉm tra n√†y.</p>
            
            <div class="bg-purple-50 rounded-xl p-6 mb-8 border-2 border-purple-100">
                <p class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-1">T·ªïng ƒëi·ªÉm</p>
                <p class="text-5xl font-black text-purple-600" id="final-score">0</p>
                <p class="text-sm text-gray-500 mt-2">tr√™n t·ªïng s·ªë <span id="final-total">28</span> c√¢u</p>
            </div>

            <button onclick="location.reload()" class="btn-3d w-full bg-teal-500 hover:bg-teal-400 text-white font-bold py-4 rounded-xl text-xl shadow-lg">
                L√†m l·∫°i b√†i thi üîÑ
            </button>
        </div>
    </div>

    <!-- Data & Script -->
    <script>
        // --- DATA SOURCE ---
        const quizData = [
            {
                "questionNumber": 1,
                "question": "Write a present continuous sentence using the prompts: <b>A number of workers/ exploit/ an open coalmine.</b>",
                "answerOptions": [
                    { "text": "A number of workers are exploiting an open coalmine.", "isCorrect": true },
                    { "text": "A number of workers is exploiting an open coalmine.", "isCorrect": false },
                    { "text": "A number of workers exploiting an open coalmine.", "isCorrect": false },
                    { "text": "A number of workers are exploit an open coalmine.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng 4 ƒë√°p √°n:</b>\n- exploit (v): khai th√°c.\n- open coalmine (n): m·ªè than l·ªô thi√™n.\n- A number of + Noun (plural) -> Verb (plural).\n\n2. <b>D·ªãch nghƒ©a to√†n c√¢u:</b> \"M·ªôt s·ªë l∆∞·ª£ng c√¥ng nh√¢n ƒëang khai th√°c m·ªôt m·ªè than l·ªô thi√™n.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- ƒê·ªÅ b√†i y√™u c·∫ßu vi·∫øt c√¢u ·ªü th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn (Present Continuous).\n- C·∫•u tr√∫c: S + am/is/are + Ving.\n- Ch·ªß ng·ªØ 'A number of workers' (m·ªôt s·ªë c√¥ng nh√¢n) ƒëi v·ªõi ƒë·ªông t·ª´ s·ªë nhi·ªÅu 'are'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> A number of workers are exploiting an open coalmine."
            },
            {
                "questionNumber": 2,
                "question": "Write a present continuous sentence using the prompts: <b>The government/ bring/ electricity to remote and rural areas/ these days.</b>",
                "answerOptions": [
                    { "text": "The government is bringing electricity to remote and rural areas these days.", "isCorrect": true },
                    { "text": "The government bring electricity to remote and rural areas these days.", "isCorrect": false },
                    { "text": "The government are bringing electricity to remote and rural areas these days.", "isCorrect": false },
                    { "text": "The government is bring electricity to remote and rural areas these days.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- government (n): ch√≠nh ph·ªß.\n- bring (v): mang l·∫°i, ƒëem t·ªõi.\n- remote and rural areas (n): v√πng s√¢u v√πng xa v√† n√¥ng th√¥n.\n- these days (adv): d·∫°o g·∫ßn ƒë√¢y (d·∫•u hi·ªáu th√¨ hi·ªán t·∫°i/ti·∫øp di·ªÖn).\n\n2. <b>D·ªãch nghƒ©a:</b> \"Ch√≠nh ph·ªß ƒëang ƒë∆∞a ƒëi·ªán l∆∞·ªõi v·ªÅ c√°c v√πng s√¢u v√πng xa v√† n√¥ng th√¥n trong nh·ªØng ng√†y n√†y.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- Th√¨ hi·ªán t·∫°i ti·∫øp di·ªÖn di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang di·ªÖn ra xung quanh th·ªùi ƒëi·ªÉm n√≥i (these days).\n- Ch·ªß ng·ªØ 'The government' l√† danh t·ª´ t·∫≠p h·ª£p (coi l√† s·ªë √≠t trong ng·ªØ c·∫£nh n√†y) -> d√πng 'is'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> The government is bringing electricity to remote and rural areas these days."
            },
            {
                "questionNumber": 3,
                "question": "Write a present continuous sentence using the prompts: <b>About 62,500 power plants/ operate/ around the world.</b>",
                "answerOptions": [
                    { "text": "About 62,500 power plants are operating around the world.", "isCorrect": true },
                    { "text": "About 62,500 power plants is operating around the world.", "isCorrect": false },
                    { "text": "About 62,500 power plants operate around the world.", "isCorrect": false },
                    { "text": "About 62,500 power plants operating around the world.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- power plant (n): nh√† m√°y ƒëi·ªán.\n- operate (v): v·∫≠n h√†nh, ho·∫°t ƒë·ªông.\n- around the world: tr√™n kh·∫Øp th·∫ø gi·ªõi.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Kho·∫£ng 62.500 nh√† m√°y ƒëi·ªán ƒëang ho·∫°t ƒë·ªông tr√™n kh·∫Øp th·∫ø gi·ªõi.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- ƒê·ªÅ b√†i y√™u c·∫ßu th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- Ch·ªß ng·ªØ 'About 62,500 power plants' l√† s·ªë nhi·ªÅu -> d√πng 'are'.\n- Operate -> Operating.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> ...are operating..."
            },
            {
                "questionNumber": 4,
                "question": "Write a present continuous sentence using the prompts: <b>They/ not work/ under extreme pressure/ at the moment.</b>",
                "answerOptions": [
                    { "text": "They are not working under extreme pressure at the moment.", "isCorrect": true },
                    { "text": "They do not working under extreme pressure at the moment.", "isCorrect": false },
                    { "text": "They is not working under extreme pressure at the moment.", "isCorrect": false },
                    { "text": "They not working under extreme pressure at the moment.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- work (v): l√†m vi·ªác.\n- extreme pressure (n): √°p l·ª±c c·ª±c l·ªõn.\n- at the moment: ngay l√∫c n√†y (d·∫•u hi·ªáu nh·∫≠n bi·∫øt).\n\n2. <b>D·ªãch nghƒ©a:</b> \"H·ªç ƒëang kh√¥ng ph·∫£i l√†m vi·ªác d∆∞·ªõi √°p l·ª±c c·ª±c l·ªõn v√†o l√∫c n√†y.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- 'At the moment' -> Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- C√¢u ph·ªß ƒë·ªãnh v·ªõi 'They' -> They are not + Ving.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> They are not working..."
            },
            {
                "questionNumber": 5,
                "question": "Write a present continuous sentence using the prompts: <b>Mr. Handerson/ ride/ a monocycle in the parking lot?</b>",
                "answerOptions": [
                    { "text": "Is Mr. Handerson riding a monocycle in the parking lot?", "isCorrect": true },
                    { "text": "Does Mr. Handerson riding a monocycle in the parking lot?", "isCorrect": false },
                    { "text": "Are Mr. Handerson riding a monocycle in the parking lot?", "isCorrect": false },
                    { "text": "Mr. Handerson is riding a monocycle in the parking lot?", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- ride (v): l√°i, ƒë·∫°p (xe).\n- monocycle (n): xe ƒë·∫°p m·ªôt b√°nh.\n- parking lot (n): b√£i ƒë·∫≠u xe.\n\n2. <b>D·ªãch nghƒ©a:</b> \"√îng Handerson ƒëang l√°i chi·∫øc xe ƒë·∫°p m·ªôt b√°nh trong b√£i ƒë·∫≠u xe ph·∫£i kh√¥ng?\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- C√¢u h·ªèi (nghi v·∫•n) th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn -> ƒê·∫£o to be l√™n ƒë·∫ßu.\n- Mr. Handerson (s·ªë √≠t) -> d√πng 'Is'.\n- Ride -> Riding (b·ªè 'e' th√™m 'ing').\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> Is Mr. Handerson riding..."
            },
            {
                "questionNumber": 6,
                "question": "Write a present continuous sentence using the prompts: <b>The technicians/ place/ solar panels on the roofs of the house.</b>",
                "answerOptions": [
                    { "text": "The technicians are placing solar panels on the roofs of the house.", "isCorrect": true },
                    { "text": "The technicians is placing solar panels on the roofs of the house.", "isCorrect": false },
                    { "text": "The technicians placing solar panels on the roofs of the house.", "isCorrect": false },
                    { "text": "The technicians are place solar panels on the roofs of the house.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- technician (n): k·ªπ thu·∫≠t vi√™n.\n- place (v): ƒë·∫∑t, l·∫Øp ƒë·∫∑t.\n- solar panel (n): t·∫•m pin nƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi.\n- roof (n): m√°i nh√†.\n\n2. <b>D·ªãch nghƒ©a:</b> \"C√°c k·ªπ thu·∫≠t vi√™n ƒëang l·∫Øp ƒë·∫∑t c√°c t·∫•m pin m·∫∑t tr·ªùi tr√™n m√°i nh√†.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- Ch·ªß ng·ªØ 'The technicians' (s·ªë nhi·ªÅu) -> d√πng 'are'.\n- Place -> Placing (b·ªè 'e' th√™m 'ing').\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> The technicians are placing..."
            },
            {
                "questionNumber": 7,
                "question": "Write a present continuous sentence using the prompts: <b>you/ do/ research on biomass production in the country?</b>",
                "answerOptions": [
                    { "text": "Are you doing research on biomass production in the country?", "isCorrect": true },
                    { "text": "Do you doing research on biomass production in the country?", "isCorrect": false },
                    { "text": "You are doing research on biomass production in the country?", "isCorrect": false },
                    { "text": "Is you doing research on biomass production in the country?", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- do research (v phrase): l√†m nghi√™n c·ª©u.\n- biomass production (n phrase): s·∫£n xu·∫•t sinh kh·ªëi.\n\n2. <b>D·ªãch nghƒ©a:</b> \"B·∫°n ƒëang l√†m nghi√™n c·ª©u v·ªÅ s·∫£n xu·∫•t nƒÉng l∆∞·ª£ng sinh kh·ªëi trong n∆∞·ªõc ph·∫£i kh√¥ng?\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- C√¢u h·ªèi v·ªõi ch·ªß ng·ªØ 'you' -> d√πng 'Are'.\n- C·∫•u tr√∫c: Are + S + Ving...?\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> Are you doing..."
            },
            {
                "questionNumber": 8,
                "question": "Write a present continuous sentence using the prompts: <b>Countries around the world/ reduce/ their dependencies on coal.</b>",
                "answerOptions": [
                    { "text": "Countries around the world are reducing their dependencies on coal.", "isCorrect": true },
                    { "text": "Countries around the world is reducing their dependencies on coal.", "isCorrect": false },
                    { "text": "Countries around the world reducing their dependencies on coal.", "isCorrect": false },
                    { "text": "Countries around the world are reduce their dependencies on coal.", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- reduce (v): gi·∫£m thi·ªÉu.\n- dependency (n): s·ª± ph·ª• thu·ªôc.\n- coal (n): than ƒë√°.\n\n2. <b>D·ªãch nghƒ©a:</b> \"C√°c qu·ªëc gia tr√™n th·∫ø gi·ªõi ƒëang gi·∫£m b·ªõt s·ª± ph·ª• thu·ªôc v√†o than ƒë√°.\"\n\n3. <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b>\n- Ch·ªß ng·ªØ ch√≠nh 'Countries' (s·ªë nhi·ªÅu) -> d√πng 'are'.\n- Reduce -> Reducing.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> ...are reducing..."
            },
            {
                "questionNumber": 9,
                "question": "At the moment they ____________ on two wind energy projects.",
                "answerOptions": [
                    { "text": "are working", "isCorrect": true },
                    { "text": "work", "isCorrect": false },
                    { "text": "will work", "isCorrect": false },
                    { "text": "works", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- work (v): l√†m vi·ªác.\n- At the moment (adv): ngay l√∫c n√†y.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Ngay l√∫c n√†y h·ªç ƒëang l√†m vi·ªác tr√™n hai d·ª± √°n nƒÉng l∆∞·ª£ng gi√≥.\"\n\n3. <b>T·∫°i sao ch·ªçn B?</b>\n- D·∫•u hi·ªáu 'At the moment' -> d√πng th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- Ch·ªß ng·ªØ 'they' -> 'are working'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> are working"
            },
            {
                "questionNumber": 10,
                "question": "Humans ____________ wind power for transportation thousands of years ago.",
                "answerOptions": [
                    { "text": "used", "isCorrect": true },
                    { "text": "will use", "isCorrect": false },
                    { "text": "use", "isCorrect": false },
                    { "text": "are using", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- use (v): s·ª≠ d·ª•ng.\n- thousands of years ago (adv): h√†ng ng√†n nƒÉm tr∆∞·ªõc.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Con ng∆∞·ªùi ƒë√£ s·ª≠ d·ª•ng nƒÉng l∆∞·ª£ng gi√≥ ƒë·ªÉ v·∫≠n chuy·ªÉn t·ª´ h√†ng ng√†n nƒÉm tr∆∞·ªõc.\"\n\n3. <b>T·∫°i sao ch·ªçn D?</b>\n- D·∫•u hi·ªáu 'thousands of years ago' -> h√†nh ƒë·ªông ƒë√£ x·∫£y ra v√† k·∫øt th√∫c trong qu√° kh·ª© -> Qu√° kh·ª© ƒë∆°n.\n- V2/ed c·ªßa use l√† used.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> used"
            },
            {
                "questionNumber": 11,
                "question": "Right now many companies ____________ in \"green\" energy.",
                "answerOptions": [
                    { "text": "are investing", "isCorrect": true },
                    { "text": "invest", "isCorrect": false },
                    { "text": "is investing", "isCorrect": false },
                    { "text": "will invest", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- invest (v): ƒë·∫ßu t∆∞.\n- Right now (adv): ngay b√¢y gi·ªù.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Ngay b√¢y gi·ªù nhi·ªÅu c√¥ng ty ƒëang ƒë·∫ßu t∆∞ v√†o nƒÉng l∆∞·ª£ng xanh.\"\n\n3. <b>T·∫°i sao ch·ªçn C?</b>\n- D·∫•u hi·ªáu 'Right now' -> Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- Ch·ªß ng·ªØ 'many companies' (s·ªë nhi·ªÅu) -> are investing.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> are investing"
            },
            {
                "questionNumber": 12,
                "question": "In the future, cars ____________ petrol or diesel, but other fuels like electricity, and natural gas.",
                "answerOptions": [
                    { "text": "won't use", "isCorrect": true },
                    { "text": "don't use", "isCorrect": false },
                    { "text": "aren't using", "isCorrect": false },
                    { "text": "didn't use", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- use (v): d√πng.\n- petrol/diesel: xƒÉng/d·∫ßu.\n- In the future (adv): trong t∆∞∆°ng lai.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Trong t∆∞∆°ng lai, √¥ t√¥ s·∫Ω kh√¥ng d√πng xƒÉng hay d·∫ßu diesel n·ªØa, m√† d√πng c√°c nhi√™n li·ªáu kh√°c nh∆∞ ƒëi·ªán v√† kh√≠ t·ª± nhi√™n.\"\n\n3. <b>T·∫°i sao ch·ªçn A?</b>\n- D·∫•u hi·ªáu 'In the future' -> T∆∞∆°ng lai ƒë∆°n.\n- Ng·ªØ c·∫£nh: S·ª± thay ƒë·ªïi so v·ªõi hi·ªán t·∫°i -> ph·ªß ƒë·ªãnh (won't use).\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> won't use"
            },
            {
                "questionNumber": 13,
                "question": "Now wind power capacity ____________ rapidly around the world.",
                "answerOptions": [
                    { "text": "is growing", "isCorrect": true },
                    { "text": "grows", "isCorrect": false },
                    { "text": "grow", "isCorrect": false },
                    { "text": "are growing", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- capacity (n): c√¥ng su·∫•t, nƒÉng l·ª±c.\n- grow (v): tƒÉng tr∆∞·ªüng.\n- rapidly (adv): nhanh ch√≥ng.\n- Now (adv): b√¢y gi·ªù.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Hi·ªán nay c√¥ng su·∫•t ƒëi·ªán gi√≥ ƒëang tƒÉng tr∆∞·ªüng nhanh ch√≥ng tr√™n to√†n th·∫ø gi·ªõi.\"\n\n3. <b>T·∫°i sao ch·ªçn D?</b>\n- D·∫•u hi·ªáu 'Now' v√† t·ª´ 'rapidly' (di·ªÖn t·∫£ xu h∆∞·ªõng thay ƒë·ªïi) -> Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- Ch·ªß ng·ªØ 'wind power capacity' (danh t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c/s·ªë √≠t) -> is growing.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> is growing"
            },
            {
                "questionNumber": 14,
                "question": "A tidal power station ____________ electricity from the rise and fall of tides.",
                "answerOptions": [
                    { "text": "generates", "isCorrect": true },
                    { "text": "is generating", "isCorrect": false },
                    { "text": "are generating", "isCorrect": false },
                    { "text": "generate", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- tidal power station (n): tr·∫°m nƒÉng l∆∞·ª£ng th·ªßy tri·ªÅu.\n- generate (v): t·∫°o ra (ƒëi·ªán).\n- tide (n): th·ªßy tri·ªÅu.\n\n2. <b>D·ªãch nghƒ©a:</b> \"M·ªôt tr·∫°m nƒÉng l∆∞·ª£ng th·ªßy tri·ªÅu t·∫°o ra ƒëi·ªán t·ª´ s·ª± l√™n xu·ªëng c·ªßa th·ªßy tri·ªÅu.\"\n\n3. <b>T·∫°i sao ch·ªçn B?</b>\n- ƒê√¢y l√† m·ªôt s·ª± th·∫≠t hi·ªÉn nhi√™n, ch·ª©c nƒÉng c·ªßa m√°y m√≥c -> Th√¨ hi·ªán t·∫°i ƒë∆°n.\n- Ch·ªß ng·ªØ 'A tidal power station' (s·ªë √≠t) -> generates.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> generates"
            },
            {
                "questionNumber": 15,
                "question": "What ____________ if non-renewable resources run out?",
                "answerOptions": [
                    { "text": "will happen", "isCorrect": true },
                    { "text": "is happening", "isCorrect": false },
                    { "text": "happened", "isCorrect": false },
                    { "text": "happen", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- happen (v): x·∫£y ra.\n- run out (v): c·∫°n ki·ªát.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Chuy·ªán g√¨ s·∫Ω x·∫£y ra n·∫øu c√°c ngu·ªìn t√†i nguy√™n kh√¥ng t√°i t·∫°o b·ªã c·∫°n ki·ªát?\"\n\n3. <b>T·∫°i sao ch·ªçn C?</b>\n- ƒê√¢y l√† C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1 (gi·∫£ ƒë·ªãnh c√≥ th·ªÉ x·∫£y ra ·ªü t∆∞∆°ng lai).\n- M·ªánh ƒë·ªÅ If d√πng hi·ªán t·∫°i ƒë∆°n (run out) -> M·ªánh ƒë·ªÅ ch√≠nh d√πng T∆∞∆°ng lai ƒë∆°n (will + V).\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> will happen"
            },
            {
                "questionNumber": 16,
                "question": "One of the world's largest wind companies ____________ AI to capture more energy now.",
                "answerOptions": [
                    { "text": "is using", "isCorrect": true },
                    { "text": "uses", "isCorrect": false },
                    { "text": "are using", "isCorrect": false },
                    { "text": "has used", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- use (v): s·ª≠ d·ª•ng.\n- AI (Artificial Intelligence): tr√≠ tu·ªá nh√¢n t·∫°o.\n- now (adv): b√¢y gi·ªù.\n\n2. <b>D·ªãch nghƒ©a:</b> \"M·ªôt trong nh·ªØng c√¥ng ty ƒëi·ªán gi√≥ l·ªõn nh·∫•t th·∫ø gi·ªõi hi·ªán ƒëang s·ª≠ d·ª•ng AI ƒë·ªÉ thu ƒë∆∞·ª£c nhi·ªÅu nƒÉng l∆∞·ª£ng h∆°n.\"\n\n3. <b>T·∫°i sao ch·ªçn A?</b>\n- D·∫•u hi·ªáu 'now' -> Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n- Ch·ªß ng·ªØ l√† 'One' (trong c·ª•m One of...) -> S·ªë √≠t -> d√πng 'is using'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> is using"
            },
            {
                "questionNumber": 17,
                "question": "We ____________ able to create a future that's free of carbon pollution soon.",
                "answerOptions": [
                    { "text": "will be", "isCorrect": true },
                    { "text": "are", "isCorrect": false },
                    { "text": "were", "isCorrect": false },
                    { "text": "was", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- be able to (adj phrase): c√≥ th·ªÉ, c√≥ kh·∫£ nƒÉng.\n- soon (adv): s·ªõm th√¥i.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Ch√∫ng ta s·∫Ω s·ªõm c√≥ th·ªÉ t·∫°o ra m·ªôt t∆∞∆°ng lai kh√¥ng c√≥ √¥ nhi·ªÖm carbon.\"\n\n3. <b>T·∫°i sao ch·ªçn A?</b>\n- D·∫•u hi·ªáu 'soon' (s·ªõm th√¥i) -> T∆∞∆°ng lai ƒë∆°n.\n- C·∫•u tr√∫c: will be able to.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> will be"
            },
            {
                "questionNumber": 18,
                "question": "To save energy, I always ____________ the lights when I don't need them.",
                "answerOptions": [
                    { "text": "turn off", "isCorrect": true },
                    { "text": "turned off", "isCorrect": false },
                    { "text": "am turning off", "isCorrect": false },
                    { "text": "will turn off", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- turn off (phrasal verb): t·∫Øt.\n- always (adv): lu√¥n lu√¥n.\n\n2. <b>D·ªãch nghƒ©a:</b> \"ƒê·ªÉ ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng, t√¥i lu√¥n t·∫Øt ƒë√®n khi kh√¥ng c·∫ßn d√πng.\"\n\n3. <b>T·∫°i sao ch·ªçn C?</b>\n- 'Always' ch·ªâ th√≥i quen l·∫∑p ƒëi l·∫∑p l·∫°i -> Th√¨ hi·ªán t·∫°i ƒë∆°n.\n- Ch·ªß ng·ªØ 'I' ƒëi v·ªõi ƒë·ªông t·ª´ nguy√™n th·ªÉ 'turn off'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> turn off"
            },
            {
                "questionNumber": 19,
                "question": "I'm doing a project ____________ saving energy at school. Can you give me some tips?",
                "answerOptions": [
                    { "text": "on", "isCorrect": true },
                    { "text": "in", "isCorrect": false },
                    { "text": "at", "isCorrect": false },
                    { "text": "to", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- project on/about sth: d·ª± √°n v·ªÅ ch·ªß ƒë·ªÅ g√¨.\n\n2. <b>D·ªãch nghƒ©a:</b> \"M√¨nh ƒëang l√†m m·ªôt d·ª± √°n v·ªÅ ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng ·ªü tr∆∞·ªùng. C·∫≠u cho m√¨nh v√†i m·∫πo ƒë∆∞·ª£c kh√¥ng?\"\n\n3. <b>T·∫°i sao ch·ªçn 'on'?</b>\n- C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'do a project on something' (l√†m d·ª± √°n v·ªÅ c√°i g√¨).\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> on"
            },
            {
                "questionNumber": 20,
                "question": "Fossil fuels, including oil, coal and natural gas, are harmful ____________ the environment.",
                "answerOptions": [
                    { "text": "to", "isCorrect": true },
                    { "text": "with", "isCorrect": false },
                    { "text": "for", "isCorrect": false },
                    { "text": "on", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- harmful (adj): c√≥ h·∫°i.\n- harmful to sb/sth: c√≥ h·∫°i cho ai/c√°i g√¨.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Nhi√™n li·ªáu h√≥a th·∫°ch, bao g·ªìm d·∫ßu, than v√† kh√≠ ƒë·ªët, th√¨ c√≥ h·∫°i cho m√¥i tr∆∞·ªùng.\"\n\n3. <b>T·∫°i sao ch·ªçn 'to'?</b>\n- C·∫•u tr√∫c t√≠nh t·ª´: harmful + to.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> to"
            },
            {
                "questionNumber": 21,
                "question": "Once non-renewable resources are used ____________, they are gone forever.",
                "answerOptions": [
                    { "text": "up", "isCorrect": true },
                    { "text": "in", "isCorrect": false },
                    { "text": "for", "isCorrect": false },
                    { "text": "off", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- use up (phrasal verb): d√πng h·∫øt, d√πng c·∫°n ki·ªát.\n\n2. <b>D·ªãch nghƒ©a:</b> \"M·ªôt khi c√°c ngu·ªìn t√†i nguy√™n kh√¥ng t√°i t·∫°o b·ªã d√πng h·∫øt, ch√∫ng s·∫Ω bi·∫øn m·∫•t m√£i m√£i.\"\n\n3. <b>T·∫°i sao ch·ªçn 'up'?</b>\n- C·ª•m ƒë·ªông t·ª´ 'use up' mang nghƒ©a ti√™u th·ª• h·∫øt s·∫°ch.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> up"
            },
            {
                "questionNumber": 22,
                "question": "What will happen if non-renewable resources run ____________?",
                "answerOptions": [
                    { "text": "out", "isCorrect": true },
                    { "text": "away", "isCorrect": false },
                    { "text": "off", "isCorrect": false },
                    { "text": "on", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- run out (phrasal verb): c·∫°n ki·ªát, h·∫øt s·∫°ch.\n\n2. <b>D·ªãch nghƒ©a:</b> \"ƒêi·ªÅu g√¨ s·∫Ω x·∫£y ra n·∫øu c√°c ngu·ªìn t√†i nguy√™n kh√¥ng t√°i t·∫°o b·ªã c·∫°n ki·ªát?\"\n\n3. <b>T·∫°i sao ch·ªçn 'out'?</b>\n- C·ª•m 'run out' nghƒ©a l√† kh√¥ng c√≤n g√¨ n·ªØa.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> out"
            },
            {
                "questionNumber": 23,
                "question": "Sulphur dioxide has a direct effect ____________ health and the environment.",
                "answerOptions": [
                    { "text": "on", "isCorrect": true },
                    { "text": "to", "isCorrect": false },
                    { "text": "in", "isCorrect": false },
                    { "text": "at", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- effect (n): ·∫£nh h∆∞·ªüng, t√°c ƒë·ªông.\n- have an effect on sb/sth: c√≥ ·∫£nh h∆∞·ªüng l√™n ai/c√°i g√¨.\n\n2. <b>D·ªãch nghƒ©a:</b> \"L∆∞u hu·ª≥nh ƒëioxit c√≥ ·∫£nh h∆∞·ªüng tr·ª±c ti·∫øp l√™n s·ª©c kh·ªèe v√† m√¥i tr∆∞·ªùng.\"\n\n3. <b>T·∫°i sao ch·ªçn 'on'?</b>\n- Danh t·ª´ 'effect/impact/influence' th∆∞·ªùng ƒëi v·ªõi gi·ªõi t·ª´ 'on'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> on"
            },
            {
                "questionNumber": 24,
                "question": "We are looking ____________ cheap, clean, and effective sources of energy.",
                "answerOptions": [
                    { "text": "for", "isCorrect": true },
                    { "text": "at", "isCorrect": false },
                    { "text": "after", "isCorrect": false },
                    { "text": "up", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- look for (phrasal verb): t√¨m ki·∫øm.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Ch√∫ng t√¥i ƒëang t√¨m ki·∫øm c√°c ngu·ªìn nƒÉng l∆∞·ª£ng r·∫ª, s·∫°ch v√† hi·ªáu qu·∫£.\"\n\n3. <b>T·∫°i sao ch·ªçn 'for'?</b>\n- Ng·ªØ c·∫£nh l√† ƒëang 't√¨m ki·∫øm' gi·∫£i ph√°p -> look for.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> for"
            },
            {
                "questionNumber": 25,
                "question": "Viet Nam still relies mostly ____________ non-renewable energy sources.",
                "answerOptions": [
                    { "text": "on", "isCorrect": true },
                    { "text": "in", "isCorrect": false },
                    { "text": "at", "isCorrect": false },
                    { "text": "of", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- rely on (phrasal verb): d·ª±a v√†o, ph·ª• thu·ªôc v√†o.\n\n2. <b>D·ªãch nghƒ©a:</b> \"Vi·ªát Nam v·∫´n d·ª±a ch·ªß y·∫øu v√†o c√°c ngu·ªìn nƒÉng l∆∞·ª£ng kh√¥ng t√°i t·∫°o.\"\n\n3. <b>T·∫°i sao ch·ªçn 'on'?</b>\n- C·ª•m c·ªë ƒë·ªãnh: rely on / depend on.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> on"
            },
            {
                "questionNumber": 26,
                "question": "Sunlight is converted ____________ electricity by each solar cell in the panels.",
                "answerOptions": [
                    { "text": "into", "isCorrect": true },
                    { "text": "to", "isCorrect": false },
                    { "text": "from", "isCorrect": false },
                    { "text": "off", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- convert (v): chuy·ªÉn ƒë·ªïi.\n- convert A into B: chuy·ªÉn ƒë·ªïi A th√†nh B.\n\n2. <b>D·ªãch nghƒ©a:</b> \"√Ånh s√°ng m·∫∑t tr·ªùi ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi th√†nh ƒëi·ªán nƒÉng b·ªüi m·ªói t·∫ø b√†o quang ƒëi·ªán trong t·∫•m pin.\"\n\n3. <b>T·∫°i sao ch·ªçn 'into'?</b>\n- Khi n√≥i v·ªÅ s·ª± bi·∫øn ƒë·ªïi tr·∫°ng th√°i/ch·∫•t, d√πng 'into'.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> into"
            },
            {
                "questionNumber": 27,
                "question": "Turning ____________ lights saves energy and it also saves money.",
                "answerOptions": [
                    { "text": "off", "isCorrect": true },
                    { "text": "on", "isCorrect": false },
                    { "text": "up", "isCorrect": false },
                    { "text": "in", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- turn off (phrasal verb): t·∫Øt.\n\n2. <b>D·ªãch nghƒ©a:</b> \"T·∫Øt ƒë√®n gi√∫p ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng v√† c≈©ng ti·∫øt ki·ªám ti·ªÅn b·∫°c.\"\n\n3. <b>T·∫°i sao ch·ªçn 'off'?</b>\n- H√†nh ƒë·ªông 'ti·∫øt ki·ªám ƒëi·ªán' li√™n quan ƒë·∫øn vi·ªác 't·∫Øt' thi·∫øt b·ªã -> turn off.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> off"
            },
            {
                "questionNumber": 28,
                "question": "In developing countries, biogas is mostly used ____________ cooking, heating and lighting.",
                "answerOptions": [
                    { "text": "for", "isCorrect": true },
                    { "text": "in", "isCorrect": false },
                    { "text": "to", "isCorrect": false },
                    { "text": "by", "isCorrect": false }
                ],
                "rationale": "1. <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b>\n- used for + Ving/Noun: ƒë∆∞·ª£c d√πng cho m·ª•c ƒë√≠ch g√¨.\n\n2. <b>D·ªãch nghƒ©a:</b> \"·ªû c√°c n∆∞·ªõc ƒëang ph√°t tri·ªÉn, kh√≠ sinh h·ªçc ch·ªß y·∫øu ƒë∆∞·ª£c d√πng cho vi·ªác n·∫•u n∆∞·ªõng, s∆∞·ªüi ·∫•m v√† th·∫Øp s√°ng.\"\n\n3. <b>T·∫°i sao ch·ªçn 'for'?</b>\n- Ch·ªâ m·ª•c ƒë√≠ch c·ªßa vi·ªác s·ª≠ d·ª•ng -> use for.\n\n<b>ƒê√°p √°n ƒë√∫ng:</b> for"
            }
        ];

        // --- STATE & LOGIC ---
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;

        // Sound Effects (Base64 for reliability)
        const soundCorrect = new Audio("data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="); // Placeholder, using AudioContext for better sounds below
        const soundWrong = new Audio("data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="); 

        // Simple Synth Sounds
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, type, duration) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playCorrectSound() {
            playTone(600, 'sine', 0.1);
            setTimeout(() => playTone(800, 'sine', 0.2), 100);
        }

        function playWrongSound() {
            playTone(150, 'sawtooth', 0.3);
            setTimeout(() => playTone(100, 'sawtooth', 0.3), 200);
        }

        // DOM Elements
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackIcon = document.getElementById('feedback-icon');
        const explanationContent = document.getElementById('explanation-content');
        const nextBtn = document.getElementById('next-btn');
        const finishBtn = document.getElementById('finish-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQNum = document.getElementById('current-q-num');
        const totalQNum = document.getElementById('total-q-num');
        const scoreDisplay = document.getElementById('score');

        // Init
        document.getElementById('total-q-num').innerText = quizData.length;
        renderQuestion();

        function renderQuestion() {
            const q = quizData[currentQuestionIndex];
            
            // Update UI Text
            currentQNum.innerText = currentQuestionIndex + 1;
            questionText.innerHTML = q.question;
            
            // Clear previous state
            optionsContainer.innerHTML = '';
            feedbackArea.classList.add('hidden');
            nextBtn.classList.add('hidden');
            finishBtn.classList.add('hidden');
            answered = false;

            // Update Progress
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Render Options
            q.answerOptions.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = `option-card bg-white p-4 rounded-2xl mb-3 flex items-center font-semibold text-lg text-gray-700 select-none`;
                btn.innerHTML = `<span class="bg-purple-100 text-purple-700 rounded-full w-8 h-8 flex items-center justify-center mr-4 font-bold border-2 border-purple-200">${String.fromCharCode(65 + index)}</span> ${opt.text}`;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (answered) return;
            answered = true;

            const q = quizData[currentQuestionIndex];
            const isCorrect = q.answerOptions[selectedIndex].isCorrect;

            // Highlight chosen answer
            if (isCorrect) {
                btnElement.classList.add('correct');
                playCorrectSound();
                confettiEffect();
                score++;
                scoreDisplay.innerText = score;
                scoreDisplay.parentElement.classList.add('scale-110'); // Pulse score
                setTimeout(() => scoreDisplay.parentElement.classList.remove('scale-110'), 200);
                feedbackIcon.innerText = "üéâ";
            } else {
                btnElement.classList.add('wrong');
                playWrongSound();
                feedbackIcon.innerText = "üòÖ";
                
                // Show correct one
                const correctIndex = q.answerOptions.findIndex(o => o.isCorrect);
                optionsContainer.children[correctIndex].classList.add('correct');
            }

            // Disable all buttons
            Array.from(optionsContainer.children).forEach(child => child.classList.add('disabled'));

            // Show Explanation
            explanationContent.innerHTML = q.rationale;
            feedbackArea.classList.remove('hidden');

            // Show Next/Finish Button
            if (currentQuestionIndex < quizData.length - 1) {
                nextBtn.classList.remove('hidden');
            } else {
                finishBtn.classList.remove('hidden');
                progressBar.style.width = '100%';
            }

            // Scroll to feedback (mobile friendly)
            setTimeout(() => {
                feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            renderQuestion();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showResults() {
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-total').innerText = quizData.length;
            document.getElementById('result-modal').classList.remove('hidden');
            
            // Massive confetti
            const duration = 3000;
            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#8854C0', '#00C9A7']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#8854C0', '#00C9A7']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }

        function confettiEffect() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#8854C0', '#00C9A7', '#FFC048'],
                disableForReducedMotion: true
            });
        }
    </script>
</body>
</html>
