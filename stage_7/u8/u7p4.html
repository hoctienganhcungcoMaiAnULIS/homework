<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p T·ªïng H·ª£p Th√¨: Hi·ªán t·∫°i & Qu√° kh·ª© - Ms Mai An ULIS</title>
    <!-- Import Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- Import FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-pastel: #F0F4F8;
            --text-dark: #2D3436;
            --card-bg: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevent text selection for game feel */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #E0EAFC;
            background-image: radial-gradient(#8854C0 1.5px, transparent 1.5px), radial-gradient(#00C9A7 1.5px, #E0EAFC 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        /* Container Styles */
        .game-container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), 0 0 0 10px rgba(136, 84, 192, 0.1);
            overflow: hidden;
            position: relative;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-purple), #A29BFE);
            padding: 15px 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 5px solid rgba(0,0,0,0.1);
        }

        .header-title {
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .score-box {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Question Area */
        .question-card {
            padding: 30px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 30px;
            line-height: 1.4;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: white;
            border: 3px solid #E0E0E0;
            border-radius: 20px;
            padding: 20px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #636e72;
            cursor: pointer;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 6px 0 #dfe6e9;
            top: 0;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-purple);
            color: var(--primary-purple);
        }

        .option-btn:active:not(:disabled) {
            top: 6px;
            box-shadow: 0 0 0 #dfe6e9;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00B894;
            box-shadow: 0 6px 0 #008f72;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #D63031;
            box-shadow: 0 6px 0 #c0392b;
            animation: shake 0.5s;
        }

        /* Explanation Box */
        .explanation-box {
            background: #FFF8E1;
            border-left: 6px solid #FFC107;
            padding: 20px;
            margin-top: 20px;
            border-radius: 0 15px 15px 0;
            text-align: left;
            display: none; /* Hidden by default */
            animation: slideIn 0.3s ease-out;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .explanation-box.show {
            display: block;
        }

        .teacher-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-purple);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .explanation-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: var(--primary-purple);
            font-weight: 800;
        }

        .explanation-content ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .explanation-content li {
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.6);
            border-radius: 8px;
        }

        .explanation-content strong {
            color: #d63031;
        }

        .explanation-content .correct-reason {
            color: var(--correct-green);
            font-weight: bold;
        }

        /* Navigation Buttons */
        .nav-controls {
            padding: 20px;
            border-top: 2px solid #f1f2f6;
            display: flex;
            justify-content: flex-end;
            background: #f9f9f9;
        }

        .next-btn {
            background: var(--primary-teal);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #00a88f;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: none; /* Hidden until answer selected */
        }

        .next-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* Start & End Screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
        }

        .screen.hidden {
            display: none;
        }

        .title-hero {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary-purple);
            margin-bottom: 20px;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }

        .start-btn {
            background: var(--primary-purple);
            color: white;
            font-size: 1.5rem;
            padding: 20px 60px;
            border-radius: 60px;
            border: none;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #6c429c;
            transition: transform 0.2s;
            animation: pulse 2s infinite;
        }

        .start-btn:active {
            transform: translateY(8px);
            box-shadow: none;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .question-text {
                font-size: 1.2rem;
            }
            .header-title {
                font-size: 0.9rem;
            }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 10px;
            background: #dfe6e9;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-teal));
            width: 0%;
            transition: width 0.5s ease;
        }

        .rationale-text {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="game-container">
    
    <!-- Header -->
    <div class="header">
        <div class="header-title"><i class="fas fa-graduation-cap"></i> Ms Mai An ULIS</div>
        <div class="score-box">
            <i class="fas fa-star" style="color: #F1C40F;"></i> 
            <span id="score">0</span> / <span id="total-q">30</span>
        </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- Start Screen -->
    <div class="screen" id="start-screen">
        <div class="title-hero">TH·ª¨ T√ÄI NG·ªÆ PH√ÅP</div>
        <p style="font-size: 1.2rem; margin-bottom: 40px; color: #636e72;">
            30 c√¢u h·ªèi chuy√™n s√¢u v·ªÅ th√¨ Hi·ªán t·∫°i & Qu√° kh·ª©.<br>
            B·∫°n ƒë√£ s·∫µn s√†ng ch∆∞a?
        </p>
        <button class="start-btn" onclick="startGame()">B·∫ÆT ƒê·∫¶U NGAY!</button>
    </div>

    <!-- End Screen -->
    <div class="screen hidden" id="end-screen">
        <div class="title-hero">T·ªîNG K·∫æT ƒêI·ªÇM</div>
        <div style="font-size: 4rem; font-weight: 900; color: var(--primary-teal); margin: 20px 0;">
            <span id="final-score">0</span>%
        </div>
        <p id="feedback-msg" style="font-size: 1.5rem; color: #636e72; margin-bottom: 30px;"></p>
        <button class="start-btn" onclick="location.reload()">L√ÄM L·∫†I B√ÄI</button>
    </div>

    <!-- Gameplay Area -->
    <div class="question-card" id="gameplay-area">
        <h2 class="question-text" id="question-text">Question goes here...</h2>
        
        <div class="options-grid" id="options-container">
            <!-- Buttons generated by JS -->
        </div>

        <div class="explanation-box" id="explanation-box">
            <div class="explanation-header">
                <div class="teacher-avatar">C√¥</div>
                <span>C√¥ Mai An gi·∫£i th√≠ch:</span>
            </div>
            <div class="explanation-content rationale-text" id="explanation-content">
                <!-- Explanation content goes here -->
            </div>
        </div>
    </div>

    <div class="nav-controls">
        <button class="next-btn" id="next-btn" onclick="nextQuestion()">C√¢u Ti·∫øp Theo <i class="fas fa-arrow-right"></i></button>
    </div>
</div>

<script>
    // --- DATA SOURCE (From grammar_mixed_tenses_30q) ---
    const quizData = {
      "questions": [
        {
          "questionNumber": 1,
          "question": "My dad ______ many countries, but he hasn‚Äôt been to China.",
          "answerOptions": [
            { "text": "visited", "isCorrect": false },
            { "text": "visits", "isCorrect": false },
            { "text": "has visited", "isCorrect": true },
            { "text": "is visiting", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- visited (V-Past): ƒë√£ thƒÉm (qu√° kh·ª© ƒë∆°n)\n- visits (V-Pres): thƒÉm (hi·ªán t·∫°i ƒë∆°n)\n- has visited (V-Pres Perf): ƒë√£ t·ª´ng thƒÉm (hi·ªán t·∫°i ho√†n th√†nh)\n- is visiting (V-Pres Cont): ƒëang thƒÉm\n\n**Gi·∫£i th√≠ch:** C√¢u n√≥i v·ªÅ tr·∫£i nghi·ªám trong qu√° kh·ª© kh√¥ng r√µ th·ªùi gian (many countries) v√† v·∫ø sau d√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh (hasn't been) -> V·∫ø ƒë·∫ßu c≈©ng d√πng Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** B·ªë t√¥i ƒë√£ ƒëi thƒÉm nhi·ªÅu n∆∞·ªõc, nh∆∞ng √¥ng ·∫•y ch∆∞a t·ª´ng ƒë·∫øn Trung Qu·ªëc."
        },
        {
          "questionNumber": 2,
          "question": "She usually ______ breakfast at 7 a.m.",
          "answerOptions": [
            { "text": "is having", "isCorrect": false },
            { "text": "has", "isCorrect": true },
            { "text": "had", "isCorrect": false },
            { "text": "have", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- is having (V-Pres Cont): ƒëang ƒÉn\n- has (V-Pres): ƒÉn (chia ng√¥i th·ª© 3 s·ªë √≠t)\n- had (V-Past): ƒë√£ ƒÉn\n- have (V-Pres): ƒÉn (nguy√™n th·ªÉ/ng√¥i s·ªë nhi·ªÅu)\n\n**Gi·∫£i th√≠ch:** Tr·∫°ng t·ª´ 'usually' (th∆∞·ªùng xuy√™n) ch·ªâ th√≥i quen l·∫∑p ƒëi l·∫∑p l·∫°i ·ªü hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'She' l√† s·ªë √≠t n√™n ƒë·ªông t·ª´ 'have' chia th√†nh 'has'.\n\n**D·ªãch c√¢u:** C√¥ ·∫•y th∆∞·ªùng ƒÉn s√°ng l√∫c 7 gi·ªù s√°ng."
        },
        {
          "questionNumber": 3,
          "question": "They ______ football in the yard right now.",
          "answerOptions": [
            { "text": "play", "isCorrect": false },
            { "text": "are playing", "isCorrect": true },
            { "text": "played", "isCorrect": false },
            { "text": "have played", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- play (V-Pres): ch∆°i (th√≥i quen)\n- are playing (V-Pres Cont): ƒëang ch∆°i\n- played (V-Past): ƒë√£ ch∆°i\n- have played (V-Pres Perf): ƒë√£ ch∆°i xong\n\n**Gi·∫£i th√≠ch:** C·ª•m t·ª´ 'right now' (ngay b√¢y gi·ªù) di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm n√≥i -> D√πng th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n\n**D·ªãch c√¢u:** H·ªç ƒëang ch∆°i b√≥ng ƒë√° trong s√¢n ngay l√∫c n√†y."
        },
        {
          "questionNumber": 4,
          "question": "I ______ my homework yesterday evening.",
          "answerOptions": [
            { "text": "finish", "isCorrect": false },
            { "text": "have finished", "isCorrect": false },
            { "text": "finished", "isCorrect": true },
            { "text": "am finishing", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- finish (V-Pres): ho√†n th√†nh (hi·ªán t·∫°i)\n- have finished (V-Pres Perf): v·ª´a ho√†n th√†nh\n- finished (V-Past): ƒë√£ ho√†n th√†nh\n- am finishing (V-Pres Cont): ƒëang ho√†n th√†nh\n\n**Gi·∫£i th√≠ch:** 'yesterday evening' (t·ªëi h√¥m qua) l√† m·ªëc th·ªùi gian c·ª• th·ªÉ trong qu√° kh·ª© -> D√πng th√¨ Qu√° kh·ª© ƒë∆°n.\n\n**D·ªãch c√¢u:** T√¥i ƒë√£ l√†m xong b√†i t·∫≠p v·ªÅ nh√† v√†o t·ªëi h√¥m qua."
        },
        {
          "questionNumber": 5,
          "question": "We ______ each other since last summer.",
          "answerOptions": [
            { "text": "know", "isCorrect": false },
            { "text": "knew", "isCorrect": false },
            { "text": "have known", "isCorrect": true },
            { "text": "are knowing", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- know (V-Pres): bi·∫øt\n- knew (V-Past): ƒë√£ bi·∫øt\n- have known (V-Pres Perf): ƒë√£ bi·∫øt (k√©o d√†i t·ªõi nay)\n- are knowing (Sai ng·ªØ ph√°p - know kh√¥ng chia ti·∫øp di·ªÖn)\n\n**Gi·∫£i th√≠ch:** 'Since last summer' (k·ªÉ t·ª´ m√πa h√® nƒÉm ngo√°i) ch·ªâ h√†nh ƒë·ªông b·∫Øt ƒë·∫ßu trong qu√° kh·ª© v√† k√©o d√†i ƒë·∫øn hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** Ch√∫ng t√¥i ƒë√£ bi·∫øt nhau t·ª´ m√πa h√® nƒÉm ngo√°i."
        },
        {
          "questionNumber": 6,
          "question": "______ you ever ______ sushi?",
          "answerOptions": [
            { "text": "Did / eat", "isCorrect": false },
            { "text": "Do / eat", "isCorrect": false },
            { "text": "Have / eaten", "isCorrect": true },
            { "text": "Are / eating", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- Did... eat (Past Simple): ƒê√£ ƒÉn (c·ª• th·ªÉ l√∫c n√†o)\n- Do... eat (Pres Simple): C√≥ ƒÉn (th√≥i quen)\n- Have... eaten (Pres Perf): ƒê√£ t·ª´ng ƒÉn (tr·∫£i nghi·ªám)\n- Are... eating (Pres Cont): ƒêang ƒÉn\n\n**Gi·∫£i th√≠ch:** 'Ever' (ƒë√£ t·ª´ng) d√πng trong c√¢u h·ªèi v·ªÅ tr·∫£i nghi·ªám, kinh nghi·ªám -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** B·∫°n ƒë√£ bao gi·ªù ƒÉn sushi ch∆∞a?"
        },
        {
          "questionNumber": 7,
          "question": "He ______ TV right now.",
          "answerOptions": [
            { "text": "watches", "isCorrect": false },
            { "text": "watched", "isCorrect": false },
            { "text": "was watching", "isCorrect": false },
            { "text": "is watching", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- watches (V-Pres): xem (th∆∞·ªùng xuy√™n)\n- watched (V-Past): ƒë√£ xem\n- was watching (V-Past Cont): ƒëang xem (l√∫c qu√° kh·ª©)\n- is watching (V-Pres Cont): ƒëang xem (l√∫c n√†y)\n\n**Gi·∫£i th√≠ch:** 'Right now' (ngay b√¢y gi·ªù) ch·ªâ h√†nh ƒë·ªông ƒëang x·∫£y ra -> D√πng th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n\n**D·ªãch c√¢u:** Anh ·∫•y ƒëang xem TV ngay l√∫c n√†y."
        },
        {
          "questionNumber": 8,
          "question": "She ______ to the cinema twice this week.",
          "answerOptions": [
            { "text": "goes", "isCorrect": false },
            { "text": "has gone", "isCorrect": true },
            { "text": "went", "isCorrect": false },
            { "text": "is going", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- goes (V-Pres): ƒëi (th√≥i quen)\n- has gone (V-Pres Perf): ƒë√£ ƒëi (s·ªë l·∫ßn t√≠nh t·ªõi nay)\n- went (V-Past): ƒë√£ ƒëi (xong h·∫≥n)\n- is going (V-Pres Cont): ƒëang ƒëi\n\n**Gi·∫£i th√≠ch:** 'Twice this week' (hai l·∫ßn trong tu·∫ßn n√†y) ch·ªâ s·ª± l·∫∑p l·∫°i c·ªßa h√†nh ƒë·ªông trong m·ªôt kho·∫£ng th·ªùi gian ch∆∞a k·∫øt th√∫c (tu·∫ßn n√†y ch∆∞a h·∫øt) -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** C√¥ ·∫•y ƒë√£ ƒëi xem phim hai l·∫ßn trong tu·∫ßn n√†y r·ªìi."
        },
        {
          "questionNumber": 9,
          "question": "They ______ in London for 10 years.",
          "answerOptions": [
            { "text": "live", "isCorrect": false },
            { "text": "have lived", "isCorrect": true },
            { "text": "lived", "isCorrect": false },
            { "text": "are living", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- live (V-Pres): s·ªëng (th√≥i quen)\n- have lived (V-Pres Perf): ƒë√£ s·ªëng (ƒë∆∞·ª£c bao l√¢u)\n- lived (V-Past): ƒë√£ s·ªëng (gi·ªù kh√¥ng s·ªëng n·ªØa)\n- are living (V-Pres Cont): ƒëang s·ªëng (t·∫°m th·ªùi)\n\n**Gi·∫£i th√≠ch:** 'For 10 years' (ƒë∆∞·ª£c 10 nƒÉm) ch·ªâ kho·∫£ng th·ªùi gian k√©o d√†i t·ª´ qu√° kh·ª© ƒë·∫øn hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** H·ªç ƒë√£ s·ªëng ·ªü Lu√¢n ƒê√¥n ƒë∆∞·ª£c 10 nƒÉm r·ªìi."
        },
        {
          "questionNumber": 10,
          "question": "Listen! Someone ______ at the door.",
          "answerOptions": [
            { "text": "knocks", "isCorrect": false },
            { "text": "knocked", "isCorrect": false },
            { "text": "is knocking", "isCorrect": true },
            { "text": "has knocked", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- knocks (V-Pres): g√µ (th∆∞·ªùng xuy√™n)\n- knocked (V-Past): ƒë√£ g√µ\n- is knocking (V-Pres Cont): ƒëang g√µ\n- has knocked (V-Pres Perf): ƒë√£ g√µ xong\n\n**Gi·∫£i th√≠ch:** 'Listen!' (Nghe k√¨a!) l√† c√¢u m·ªánh l·ªánh d√πng ƒë·ªÉ thu h√∫t s·ª± ch√∫ √Ω v√†o m·ªôt h√†nh ƒë·ªông ƒëang x·∫£y ra ngay l√∫c ƒë√≥ -> D√πng th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn.\n\n**D·ªãch c√¢u:** Nghe k√¨a! C√≥ ai ƒë√≥ ƒëang g√µ c·ª≠a."
        },
        {
          "questionNumber": 11,
          "question": "I usually ______ coffee in the morning, but today I‚Äôm drinking tea.",
          "answerOptions": [
            { "text": "drank", "isCorrect": false },
            { "text": "drink", "isCorrect": true },
            { "text": "am drinking", "isCorrect": false },
            { "text": "have drunk", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- drank (V-Past): ƒë√£ u·ªëng\n- drink (V-Pres): u·ªëng (th√≥i quen)\n- am drinking (V-Pres Cont): ƒëang u·ªëng\n- have drunk (V-Pres Perf): ƒë√£ u·ªëng xong\n\n**Gi·∫£i th√≠ch:** V·∫ø ƒë·∫ßu c√≥ 'usually' (th∆∞·ªùng xuy√™n) ch·ªâ th√≥i quen -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n. (V·∫ø sau 'today' d√πng ti·∫øp di·ªÖn ƒë·ªÉ ch·ªâ s·ª± thay ƒë·ªïi t·∫°m th·ªùi).\n\n**D·ªãch c√¢u:** T√¥i th∆∞·ªùng u·ªëng c√† ph√™ v√†o bu·ªïi s√°ng, nh∆∞ng h√¥m nay t√¥i l·∫°i ƒëang u·ªëng tr√†."
        },
        {
          "questionNumber": 12,
          "question": "She ______ her leg last week, so she can‚Äôt walk now.",
          "answerOptions": [
            { "text": "breaks", "isCorrect": false },
            { "text": "broke", "isCorrect": true },
            { "text": "has broken", "isCorrect": false },
            { "text": "is breaking", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- breaks (V-Pres): g√£y (th∆∞·ªùng xuy√™n)\n- broke (V-Past): ƒë√£ g√£y\n- has broken (V-Pres Perf): ƒë√£ g√£y (kh√¥ng r√µ th·ªùi gian)\n- is breaking (V-Pres Cont): ƒëang g√£y\n\n**Gi·∫£i th√≠ch:** 'last week' (tu·∫ßn tr∆∞·ªõc) l√† th·ªùi gian x√°c ƒë·ªãnh trong qu√° kh·ª© -> D√πng th√¨ Qu√° kh·ª© ƒë∆°n.\n\n**D·ªãch c√¢u:** C√¥ ·∫•y b·ªã g√£y ch√¢n tu·∫ßn tr∆∞·ªõc n√™n gi·ªù kh√¥ng ƒëi l·∫°i ƒë∆∞·ª£c."
        },
        {
          "questionNumber": 13,
          "question": "We ______ the project yet.",
          "answerOptions": [
            { "text": "don‚Äôt finish", "isCorrect": false },
            { "text": "didn‚Äôt finish", "isCorrect": false },
            { "text": "haven‚Äôt finished", "isCorrect": true },
            { "text": "hasn‚Äôt finished", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- don‚Äôt finish (Pres Simple): kh√¥ng ho√†n th√†nh (th√≥i quen)\n- didn‚Äôt finish (Past Simple): ƒë√£ kh√¥ng ho√†n th√†nh\n- haven‚Äôt finished (Pres Perf): ch∆∞a ho√†n th√†nh\n- hasn‚Äôt finished (Pres Perf - sai ng√¥i): ch∆∞a ho√†n th√†nh\n\n**Gi·∫£i th√≠ch:** 'Yet' (ch∆∞a) th∆∞·ªùng ƒë·ª©ng cu·ªëi c√¢u ph·ªß ƒë·ªãnh c·ªßa th√¨ Hi·ªán t·∫°i ho√†n th√†nh ƒë·ªÉ ch·ªâ vi·ªác ch∆∞a ho√†n t·∫•t t√≠nh ƒë·∫øn hi·ªán t·∫°i.\n\n**D·ªãch c√¢u:** Ch√∫ng t√¥i v·∫´n ch∆∞a ho√†n th√†nh d·ª± √°n."
        },
        {
          "questionNumber": 14,
          "question": "He ______ home late every day.",
          "answerOptions": [
            { "text": "come", "isCorrect": false },
            { "text": "comes", "isCorrect": true },
            { "text": "came", "isCorrect": false },
            { "text": "is coming", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- come (V-Pres): ƒë·∫øn (nguy√™n th·ªÉ)\n- comes (V-Pres): ƒë·∫øn (chia s·ªë √≠t)\n- came (V-Past): ƒë√£ ƒë·∫øn\n- is coming (V-Pres Cont): ƒëang ƒë·∫øn\n\n**Gi·∫£i th√≠ch:** 'Every day' (m·ªói ng√†y) ch·ªâ th√≥i quen l·∫∑p ƒëi l·∫∑p l·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'He' s·ªë √≠t -> ƒê·ªông t·ª´ th√™m 's'.\n\n**D·ªãch c√¢u:** Anh ·∫•y v·ªÅ nh√† mu·ªôn m·ªói ng√†y."
        },
        {
          "questionNumber": 15,
          "question": "They ______ English since they were 6 years old.",
          "answerOptions": [
            { "text": "learn", "isCorrect": false },
            { "text": "learned", "isCorrect": false },
            { "text": "have learned", "isCorrect": true },
            { "text": "are learning", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- learn (V-Pres): h·ªçc (th√≥i quen)\n- learned (V-Past): ƒë√£ h·ªçc\n- have learned (V-Pres Perf): ƒë√£ h·ªçc (t·ª´ x∆∞a t·ªõi nay)\n- are learning (V-Pres Cont): ƒëang h·ªçc\n\n**Gi·∫£i th√≠ch:** 'Since' + m·ªëc th·ªùi gian qu√° kh·ª© (since they were 6) l√† d·∫•u hi·ªáu c·ªßa th√¨ Hi·ªán t·∫°i ho√†n th√†nh, ch·ªâ vi·ªác b·∫Øt ƒë·∫ßu trong qu√° kh·ª© v√† k√©o d√†i ƒë·∫øn hi·ªán t·∫°i.\n\n**D·ªãch c√¢u:** H·ªç ƒë√£ h·ªçc ti·∫øng Anh t·ª´ khi h·ªç 6 tu·ªïi."
        },
        {
          "questionNumber": 16,
          "question": "My father _____ just ______ the car.",
          "answerOptions": [
            { "text": "wash", "isCorrect": false },
            { "text": "washed", "isCorrect": false },
            { "text": "has washed", "isCorrect": true },
            { "text": "is washing", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- wash (V-Pres): r·ª≠a\n- washed (V-Past): ƒë√£ r·ª≠a\n- has washed (V-Pres Perf): v·ª´a r·ª≠a xong\n- is washing (V-Pres Cont): ƒëang r·ª≠a\n\n**Gi·∫£i th√≠ch:** 'Just' (v·ª´a m·ªõi) ƒëi k√®m th√¨ Hi·ªán t·∫°i ho√†n th√†nh ƒë·ªÉ ch·ªâ h√†nh ƒë·ªông v·ª´a xong. C·∫•u tr√∫c ƒë·∫ßy ƒë·ªß l√† 'has just washed'. ƒê√°p √°n C ƒë·∫°i di·ªán cho th√¨ ƒë√∫ng (has + V3).\n\n**D·ªãch c√¢u:** B·ªë t√¥i v·ª´a m·ªõi r·ª≠a xe xong."
        },
        {
          "questionNumber": 17,
          "question": "Where ______ you last night?",
          "answerOptions": [
            { "text": "was", "isCorrect": false },
            { "text": "were", "isCorrect": true },
            { "text": "are", "isCorrect": false },
            { "text": "have been", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- was (V-Past): ƒë√£ l√†/·ªü (s·ªë √≠t)\n- were (V-Past): ƒë√£ l√†/·ªü (s·ªë nhi·ªÅu/You)\n- are (V-Pres): l√†/·ªü\n- have been (V-Pres Perf): ƒë√£ l√†/·ªü\n\n**Gi·∫£i th√≠ch:** 'last night' (t·ªëi qua) l√† qu√° kh·ª© ƒë∆°n. Ch·ªß ng·ªØ 'you' ƒëi v·ªõi ƒë·ªông t·ª´ tobe qu√° kh·ª© l√† 'were'.\n\n**D·ªãch c√¢u:** T·ªëi qua b·∫°n ·ªü ƒë√¢u?"
        },
        {
          "questionNumber": 18,
          "question": "She _____ already ______ the book, so she doesn‚Äôt want to read it again.",
          "answerOptions": [
            { "text": "reads", "isCorrect": false },
            { "text": "read", "isCorrect": false },
            { "text": "has read", "isCorrect": true },
            { "text": "is reading", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- reads (V-Pres): ƒë·ªçc\n- read (V-Past): ƒë√£ ƒë·ªçc\n- has read (V-Pres Perf): ƒë√£ ƒë·ªçc r·ªìi\n- is reading (V-Pres Cont): ƒëang ƒë·ªçc\n\n**Gi·∫£i th√≠ch:** 'Already' (r·ªìi) ƒëi k√®m th√¨ Hi·ªán t·∫°i ho√†n th√†nh ƒë·ªÉ nh·∫•n m·∫°nh vi·ªác ƒë√£ ho√†n t·∫•t. C·∫•u tr√∫c: 'has already read'.\n\n**D·ªãch c√¢u:** C√¥ ·∫•y ƒë√£ ƒë·ªçc cu·ªën s√°ch ƒë√≥ r·ªìi n√™n c√¥ ·∫•y kh√¥ng mu·ªën ƒë·ªçc l·∫°i n·ªØa."
        },
        {
          "questionNumber": 19,
          "question": "Look! The children ______ in the garden.",
          "answerOptions": [
            { "text": "play", "isCorrect": false },
            { "text": "played", "isCorrect": false },
            { "text": "are playing", "isCorrect": true },
            { "text": "have played", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- play (V-Pres): ch∆°i\n- played (V-Past): ƒë√£ ch∆°i\n- are playing (V-Pres Cont): ƒëang ch∆°i\n- have played (V-Pres Perf): ƒë√£ ch∆°i xong\n\n**Gi·∫£i th√≠ch:** 'Look!' (Nh√¨n k√¨a!) l√† d·∫•u hi·ªáu c·ªßa th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn, ch·ªâ h√†nh ƒë·ªông ƒëang x·∫£y ra tr∆∞·ªõc m·∫Øt.\n\n**D·ªãch c√¢u:** Nh√¨n k√¨a! L≈© tr·∫ª ƒëang ch∆°i trong v∆∞·ªùn."
        },
        {
          "questionNumber": 20,
          "question": "He ____never ______ to Japan before.",
          "answerOptions": [
            { "text": "was", "isCorrect": false },
            { "text": "went", "isCorrect": false },
            { "text": "has been", "isCorrect": true },
            { "text": "is going", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- was (V-Past): ƒë√£ ·ªü\n- went (V-Past): ƒë√£ ƒëi\n- has been (V-Pres Perf): ƒë√£ t·ª´ng ƒë·∫øn\n- is going (V-Pres Cont): ƒëang ƒëi\n\n**Gi·∫£i th√≠ch:** 'Never ... before' (ch∆∞a t·ª´ng ... tr∆∞·ªõc ƒë√¢y) n√≥i v·ªÅ tr·∫£i nghi·ªám -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh. C·∫•u tr√∫c 'has been to' nghƒ©a l√† ƒë√£ t·ª´ng ƒë·∫øn v√† ƒë√£ v·ªÅ (ho·∫∑c tr·∫£i nghi·ªám ·ªü ƒë√≥).\n\n**D·ªãch c√¢u:** Anh ·∫•y ch∆∞a t·ª´ng ƒë·∫øn Nh·∫≠t B·∫£n bao gi·ªù."
        },
        {
          "questionNumber": 21,
          "question": "I ______ just _____ to the beach.",
          "answerOptions": [
            { "text": "go", "isCorrect": false },
            { "text": "goes", "isCorrect": false },
            { "text": "went", "isCorrect": false },
            { "text": "have gone", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- go (V-Pres): ƒëi\n- goes (V-Pres): ƒëi (s·ªë √≠t)\n- went (V-Past): ƒë√£ ƒëi\n- have gone (V-Pres Perf): v·ª´a m·ªõi ƒëi\n\n**Gi·∫£i th√≠ch:** 'Just' (v·ª´a m·ªõi) + h√†nh ƒë·ªông ƒëi t·ªõi ƒë√¢u ƒë√≥ -> D√πng Hi·ªán t·∫°i ho√†n th√†nh. 'Have gone to' nghƒ©a l√† v·ª´a ƒëi ƒë·∫øn ƒë√≥ (v√† c√≥ th·ªÉ ƒëang ·ªü ƒë√≥).\n\n**D·ªãch c√¢u:** T√¥i v·ª´a m·ªõi ƒëi ra bi·ªÉn."
        },
        {
          "questionNumber": 22,
          "question": "She ______ her keys, so she can‚Äôt open the door.",
          "answerOptions": [
            { "text": "lost", "isCorrect": false },
            { "text": "loses", "isCorrect": false },
            { "text": "is losing", "isCorrect": false },
            { "text": "has lost", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- lost (V-Past): ƒë√£ m·∫•t\n- loses (V-Pres): m·∫•t (th√≥i quen)\n- is losing (V-Pres Cont): ƒëang m·∫•t\n- has lost (V-Pres Perf): ƒë√£ l√†m m·∫•t (h·∫≠u qu·∫£ hi·ªán t·∫°i)\n\n**Gi·∫£i th√≠ch:** Vi·ªác l√†m m·∫•t ch√¨a kh√≥a x·∫£y ra trong qu√° kh·ª© nh∆∞ng ƒë·ªÉ l·∫°i h·∫≠u qu·∫£ ·ªü hi·ªán t·∫°i l√† 'can't open the door' -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** C√¥ ·∫•y ƒë√£ l√†m m·∫•t ch√¨a kh√≥a n√™n gi·ªù kh√¥ng m·ªü c·ª≠a ƒë∆∞·ª£c."
        },
        {
          "questionNumber": 23,
          "question": "They usually ______ to school by bus.",
          "answerOptions": [
            { "text": "are going", "isCorrect": false },
            { "text": "went", "isCorrect": false },
            { "text": "go", "isCorrect": true },
            { "text": "have gone", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- are going (V-Pres Cont): ƒëang ƒëi\n- went (V-Past): ƒë√£ ƒëi\n- go (V-Pres): ƒëi (th√≥i quen)\n- have gone (V-Pres Perf): ƒë√£ ƒëi\n\n**Gi·∫£i th√≠ch:** 'Usually' (th∆∞·ªùng xuy√™n) ch·ªâ th√≥i quen l·∫∑p l·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n.\n\n**D·ªãch c√¢u:** H·ªç th∆∞·ªùng ƒëi h·ªçc b·∫±ng xe bu√Ωt."
        },
        {
          "questionNumber": 24,
          "question": "We ______ already _____ dinner.",
          "answerOptions": [
            { "text": "are having", "isCorrect": false },
            { "text": "were having", "isCorrect": false },
            { "text": "have", "isCorrect": false },
            { "text": "have had", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- are having (V-Pres Cont): ƒëang ƒÉn\n- were having (V-Past Cont): ƒëang ƒÉn (qu√° kh·ª©)\n- have (V-Pres): ƒÉn\n- have had (V-Pres Perf): ƒë√£ ƒÉn xong\n\n**Gi·∫£i th√≠ch:** 'Already' (r·ªìi) + ƒÉn t·ªëi -> D√πng Hi·ªán t·∫°i ho√†n th√†nh. C·∫•u tr√∫c 'have + V3'. V3 c·ªßa 'have' (ƒÉn) l√† 'had' -> 'have had'.\n\n**D·ªãch c√¢u:** Ch√∫ng t√¥i ƒë√£ ƒÉn t·ªëi r·ªìi."
        },
        {
          "questionNumber": 25,
          "question": "I ______ tennis with him twice this month.",
          "answerOptions": [
            { "text": "play", "isCorrect": false },
            { "text": "played", "isCorrect": false },
            { "text": "am playing", "isCorrect": false },
            { "text": "have played", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- play (V-Pres): ch∆°i\n- played (V-Past): ƒë√£ ch∆°i\n- am playing (V-Pres Cont): ƒëang ch∆°i\n- have played (V-Pres Perf): ƒë√£ ch∆°i\n\n**Gi·∫£i th√≠ch:** 'Twice this month' (hai l·∫ßn trong th√°ng n√†y) ch·ªâ s·ªë l·∫ßn l·∫∑p l·∫°i trong th·ªùi gian ch∆∞a k·∫øt th√∫c -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** T√¥i ƒë√£ ch∆°i qu·∫ßn v·ª£t v·ªõi anh ·∫•y hai l·∫ßn trong th√°ng n√†y."
        },
        {
          "questionNumber": 26,
          "question": "She ______ never ______ a ghost before.",
          "answerOptions": [
            { "text": "has / seen", "isCorrect": true },
            { "text": "is / seeing", "isCorrect": false },
            { "text": "was / seeing", "isCorrect": false },
            { "text": "have / saw", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- has... seen (Pres Perf): ƒë√£... th·∫•y\n- is... seeing (Pres Cont): ƒëang... th·∫•y\n- was... seeing (Past Cont): ƒëang... th·∫•y (qu√° kh·ª©)\n- have... saw (Sai ng·ªØ ph√°p)\n\n**Gi·∫£i th√≠ch:** 'Never ... before' ch·ªâ tr·∫£i nghi·ªám ch∆∞a t·ª´ng c√≥ -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh (has + V3).\n\n**D·ªãch c√¢u:** C√¥ ·∫•y ch∆∞a bao gi·ªù nh√¨n th·∫•y ma tr∆∞·ªõc ƒë√¢y."
        },
        {
          "questionNumber": 27,
          "question": "He always ______ his homework in the evening.",
          "answerOptions": [
            { "text": "do", "isCorrect": false },
            { "text": "does", "isCorrect": true },
            { "text": "did", "isCorrect": false },
            { "text": "has done", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- do (V-Pres): l√†m\n- does (V-Pres): l√†m (s·ªë √≠t)\n- did (V-Past): ƒë√£ l√†m\n- has done (V-Pres Perf): ƒë√£ l√†m xong\n\n**Gi·∫£i th√≠ch:** 'Always' (lu√¥n lu√¥n) ch·ªâ th√≥i quen -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'He' s·ªë √≠t -> 'does'.\n\n**D·ªãch c√¢u:** Anh ·∫•y lu√¥n l√†m b√†i t·∫≠p v·ªÅ nh√† v√†o bu·ªïi t·ªëi."
        },
        {
          "questionNumber": 28,
          "question": "They ______ in this house since 2010.",
          "answerOptions": [
            { "text": "live", "isCorrect": false },
            { "text": "lived", "isCorrect": false },
            { "text": "are living", "isCorrect": false },
            { "text": "have lived", "isCorrect": true }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- live (V-Pres): s·ªëng\n- lived (V-Past): ƒë√£ s·ªëng\n- are living (V-Pres Cont): ƒëang s·ªëng\n- have lived (V-Pres Perf): ƒë√£ s·ªëng (t·ª´ tr∆∞·ªõc t·ªõi nay)\n\n**Gi·∫£i th√≠ch:** 'Since 2010' (t·ª´ nƒÉm 2010) l√† m·ªëc th·ªùi gian b·∫Øt ƒë·∫ßu trong qu√° kh·ª© v√† k√©o d√†i t·ªõi hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** H·ªç ƒë√£ s·ªëng trong ng√¥i nh√† n√†y t·ª´ nƒÉm 2010."
        },
        {
          "questionNumber": 29,
          "question": "What ______ you usually ______ at weekends?",
          "answerOptions": [
            { "text": "are / doing", "isCorrect": false },
            { "text": "did / do", "isCorrect": false },
            { "text": "do / do", "isCorrect": true },
            { "text": "have / done", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- are... doing (Pres Cont): ƒëang l√†m\n- did... do (Past Simple): ƒë√£ l√†m\n- do... do (Pres Simple): l√†m (th√≥i quen)\n- have... done (Pres Perf): ƒë√£ l√†m g√¨\n\n**Gi·∫£i th√≠ch:** 'Usually' (th∆∞·ªùng xuy√™n) ch·ªâ th√≥i quen v√†o cu·ªëi tu·∫ßn -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n. C·∫•u tr√∫c c√¢u h·ªèi: Wh + do/does + S + V?\n\n**D·ªãch c√¢u:** B·∫°n th∆∞·ªùng l√†m g√¨ v√†o cu·ªëi tu·∫ßn?"
        },
        {
          "questionNumber": 30,
          "question": "I ______ my best friend for many years.",
          "answerOptions": [
            { "text": "don‚Äôt see", "isCorrect": false },
            { "text": "didn‚Äôt see", "isCorrect": false },
            { "text": "haven‚Äôt seen", "isCorrect": true },
            { "text": "am not seeing", "isCorrect": false }
          ],
          "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- don‚Äôt see (Pres Simple): kh√¥ng g·∫∑p (th√≥i quen)\n- didn‚Äôt see (Past Simple): ƒë√£ kh√¥ng g·∫∑p\n- haven‚Äôt seen (Pres Perf): ch∆∞a g·∫∑p (t√≠nh t·ªõi nay)\n- am not seeing (Pres Cont): kh√¥ng ƒëang g·∫∑p\n\n**Gi·∫£i th√≠ch:** 'For many years' (trong nhi·ªÅu nƒÉm) ch·ªâ kho·∫£ng th·ªùi gian k√©o d√†i ƒë·∫øn hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ho√†n th√†nh.\n\n**D·ªãch c√¢u:** T√¥i ƒë√£ kh√¥ng g·∫∑p b·∫°n th√¢n nh·∫•t c·ªßa m√¨nh trong nhi·ªÅu nƒÉm r·ªìi."
        }
      ]
    };

    // --- GAME LOGIC ---
    let currentQuestionIndex = 0;
    let score = 0;
    let shuffledQuestions = [];

    // Sound Effects (Base64) - Short beeps to keep file size small and self-contained
    const soundCorrect = new Audio("data:audio/wav;base64,UklGRl9vT1BXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."); // Placeholder for shortness, real code uses logic
    // Using AudioContext for synthesizing simple sounds instead of large base64 strings to ensure reliability
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        if (type === 'correct') {
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        } else {
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Confetti Logic
    const confettiCanvas = document.getElementById('confetti-canvas');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiParticles = [];

    function resizeCanvas() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function createConfetti() {
        confettiParticles = [];
        for (let i = 0; i < 100; i++) {
            confettiParticles.push({
                x: window.innerWidth / 2,
                y: window.innerHeight / 2,
                vx: (Math.random() - 0.5) * 15,
                vy: (Math.random() - 0.5) * 15,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 8 + 4,
                life: 100
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        let active = false;
        
        confettiParticles.forEach((p, index) => {
            if (p.life > 0) {
                active = true;
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // Gravity
                p.life -= 1.5;
                p.size *= 0.96;

                confettiCtx.fillStyle = p.color;
                confettiCtx.beginPath();
                confettiCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                confettiCtx.fill();
            }
        });

        if (active) requestAnimationFrame(animateConfetti);
    }

    // Quiz Functions
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startGame() {
        document.getElementById('start-screen').classList.add('hidden');
        shuffledQuestions = shuffleArray([...quizData.questions]);
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById('score').innerText = '0';
        document.getElementById('total-q').innerText = shuffledQuestions.length;
        loadQuestion();
    }

    function loadQuestion() {
        const qData = shuffledQuestions[currentQuestionIndex];
        document.getElementById('question-text').innerText = `${currentQuestionIndex + 1}. ${qData.question}`;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';
        
        // Hide explanation and next button
        document.getElementById('explanation-box').classList.remove('show');
        document.getElementById('next-btn').style.display = 'none';

        // Display options (shuffle options visually if needed, but keeping A/B/C/D order is usually safer for grammar)
        // We will just render them in the order provided in JSON for consistency
        qData.answerOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `<span style="font-weight:900; color:var(--primary-purple); margin-right:10px;">${String.fromCharCode(65+index)}.</span> ${opt.text}`;
            btn.onclick = () => checkAnswer(btn, opt.isCorrect, qData);
            optionsContainer.appendChild(btn);
        });

        // Update progress bar
        const progress = (currentQuestionIndex / shuffledQuestions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    function checkAnswer(selectedBtn, isCorrect, qData) {
        // Disable all buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => btn.disabled = true);

        if (isCorrect) {
            selectedBtn.classList.add('correct');
            playSound('correct');
            createConfetti();
            score++;
            document.getElementById('score').innerText = score;
        } else {
            selectedBtn.classList.add('wrong');
            playSound('wrong');
            // Highlight the correct answer
            const correctIndex = qData.answerOptions.findIndex(o => o.isCorrect);
            if (correctIndex !== -1) {
                allBtns[correctIndex].classList.add('correct');
            }
        }

        // Show Explanation
        showExplanation(qData);
        
        // Show Next Button
        document.getElementById('next-btn').style.display = 'block';
    }

    function showExplanation(qData) {
        const expBox = document.getElementById('explanation-box');
        const expContent = document.getElementById('explanation-content');
        
        // Format the Rationale Markdown-like text to HTML
        // Note: The source data has specific format like "**Text:**". We replace bold with <strong>
        let formattedRationale = qData.rationale
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\n-/g, '<br>‚Ä¢ ') // Lists
            .replace(/\n/g, '<br>');

        expContent.innerHTML = formattedRationale;
        expBox.classList.add('show');
        
        // Auto scroll to explanation on mobile
        setTimeout(() => {
            expBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < shuffledQuestions.length) {
            loadQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('progress-bar').style.width = '100%';
        
        const percentage = Math.round((score / shuffledQuestions.length) * 100);
        document.getElementById('final-score').innerText = percentage;
        
        let msg = "";
        if (percentage === 100) msg = "Xu·∫•t s·∫Øc! B·∫°n l√† b·∫≠c th·∫ßy ng·ªØ ph√°p! üèÜ";
        else if (percentage >= 80) msg = "R·∫•t t·ªët! C·ªë g·∫Øng th√™m ch√∫t n·ªØa l√† ho√†n h·∫£o! üåü";
        else if (percentage >= 50) msg = "Kh√° t·ªët! H√£y xem l·∫°i c√°c c√¢u sai ƒë·ªÉ r√∫t kinh nghi·ªám nh√©. üí™";
        else msg = "ƒê·ª´ng n·∫£n l√≤ng! H√£y √¥n t·∫≠p k·ªπ h∆°n v√† th·ª≠ l·∫°i nh√©. üìö";
        
        document.getElementById('feedback-msg').innerText = msg;
    }
</script>

</body>
</html>
