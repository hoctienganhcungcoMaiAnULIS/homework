<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - English Quiz Grade 6 Unit 8</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8854C0; /* T√≠m Pastel */
            --secondary-color: #00C9A7; /* Xanh ng·ªçc */
            --correct-color: #00D26A; /* Xanh l√° */
            --wrong-color: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e5e5f7;
            background-image:  radial-gradient(#8854C0 0.5px, transparent 0.5px), radial-gradient(#8854C0 0.5px, #e5e5f7 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 2px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 2rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            color: #777;
            font-size: 1.1rem;
            margin-top: 5px;
            font-weight: 600;
        }

        /* STICKY SCORE BAR */
        .score-bar {
            position: sticky;
            top: 10px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
            border: 2px solid var(--secondary-color);
        }

        .score-text {
            font-weight: 800;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        /* QUESTION CARD */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.15);
            border-bottom: 6px solid #e0e0e0;
            transition: transform 0.3s ease;
            position: relative;
        }

        .question-number {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.5;
            color: #2c3e50;
        }

        /* OPTIONS GRID */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe6e9;
            border-bottom: 5px solid #dfe6e9; /* 3D effect */
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            position: relative;
            outline: none;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--secondary-color);
            background-color: #f0fffc;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        /* CORRECT / WRONG STATES */
        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: #00b85c;
            border-bottom-color: #008f47;
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: #ff2e40;
            border-bottom-color: #d61c2e;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
        }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background: #fff8e1; /* Light yellow for readability */
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            font-size: 1rem;
            line-height: 1.6;
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: #d35400;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expl-content strong {
            color: var(--primary-color);
        }

        .expl-section {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ccc;
        }
        .expl-section:last-child {
            border-bottom: none;
        }

        /* SUBMIT BUTTON */
        .submit-container {
            text-align: center;
            margin: 40px 0;
        }

        .finish-btn {
            background: linear-gradient(45deg, #FF4757, #FF6B81);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(255, 71, 87, 0.4);
            transition: transform 0.2s;
            border-bottom: 6px solid #c41e3a;
        }

        .finish-btn:hover {
            transform: scale(1.05);
        }
        
        .finish-btn:active {
            transform: scale(0.95);
            border-bottom-width: 2px;
        }

        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary-color);
        }

        .score-circle {
            width: 120px;
            height: 120px;
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--secondary-color);
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>Ms Mai An ULIS</h1>
            <p>B√†i ki·ªÉm tra Ng·ªØ ph√°p: Past Simple vs Past Continuous</p>
        </header>

        <div class="score-bar">
            <span class="score-text">Unit 8 - Grade 6</span>
            <span class="score-text">ƒêi·ªÉm: <span id="current-score">0</span>/<span id="total-questions">0</span></span>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JS -->
        </div>

        <div class="submit-container">
            <button class="finish-btn" onclick="finishQuiz()">N·ªòP B√ÄI</button>
        </div>
    </div>

    <!-- Modal Result -->
    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-color); margin-bottom: 20px;">K·∫æT QU·∫¢ C·ª¶A CON</h2>
            <div class="score-circle" id="final-score-display">0/0</div>
            <p id="feedback-text" style="font-size: 1.2rem; font-weight: 600; color: #555;">B·∫°n l√†m r·∫•t t·ªët!</p>
            <button class="finish-btn" style="font-size: 1rem; padding: 10px 30px; margin-top: 20px;" onclick="location.reload()">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <script>
        // DATA
        const quizData = [
            {
                "questionNumber": 27,
                "question": "I _________ a documentary on TV when suddenly we _________ all the power.",
                "options": [
                    { "text": "A. was watching ‚Äì lost", "isCorrect": true },
                    { "text": "B. watched ‚Äì lost", "isCorrect": false },
                    { "text": "C. was watching - were losing", "isCorrect": false },
                    { "text": "D. watched - were losing", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. was watching (V-ing: ƒëang xem) - lost (V2: ƒë√£ m·∫•t)\nB. watched (V2) - lost (V2)\nC. was watching (V-ing) - were losing (V-ing)\nD. watched (V2) - were losing (V-ing)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông ƒëang x·∫£y ra (xem TV) d√πng Qu√° kh·ª© ti·∫øp di·ªÖn (was watching). H√†nh ƒë·ªông xen v√†o (m·∫•t ƒëi·ªán) d√πng Qu√° kh·ª© ƒë∆°n (lost). D·∫•u hi·ªáu: 'when suddenly'.\n\nD·ªãch c√¢u: T√¥i ƒëang xem m·ªôt b·ªô phim t√†i li·ªáu tr√™n TV th√¨ ƒë·ªôt nhi√™n ch√∫ng t√¥i b·ªã m·∫•t ƒëi·ªán."
            },
            {
                "questionNumber": 28,
                "question": "When he _________ a suitcase, he dropped it on his foot.",
                "options": [
                    { "text": "A. was carrying", "isCorrect": true },
                    { "text": "B. carried", "isCorrect": false },
                    { "text": "C. had carried", "isCorrect": false },
                    { "text": "D. is carrying", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. was carrying (V-ing: ƒëang mang/x√°ch)\nB. carried (V2: ƒë√£ mang)\nC. had carried (V3: ƒë√£ mang xong - QK ho√†n th√†nh)\nD. is carrying (V-ing: ƒëang mang - hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông 'mang vali' l√† h√†nh ƒë·ªông d√†i ƒëang di·ªÖn ra trong qu√° kh·ª© -> D√πng Qu√° kh·ª© ti·∫øp di·ªÖn. H√†nh ƒë·ªông 'l√†m r∆°i' (dropped) l√† h√†nh ƒë·ªông ng·∫Øn xen v√†o.\n\nD·ªãch c√¢u: Khi anh ·∫•y ƒëang x√°ch m·ªôt chi·∫øc vali, anh ·∫•y ƒë√£ ƒë√°nh r∆°i n√≥ v√†o ch√¢n m√¨nh."
            },
            {
                "questionNumber": 29,
                "question": "What _________ at this time yesterday? - I was asleep.",
                "options": [
                    { "text": "A. were you doing", "isCorrect": true },
                    { "text": "B. did you do", "isCorrect": false },
                    { "text": "C. do you do", "isCorrect": false },
                    { "text": "D. would you do", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. were you doing (QK ti·∫øp di·ªÖn)\nB. did you do (QK ƒë∆°n)\nC. do you do (HT ƒë∆°n)\nD. would you do (Would + V)\n\nGi·∫£i th√≠ch: D·∫•u hi·ªáu 'at this time yesterday' (v√†o gi·ªù n√†y h√¥m qua) ch·ªâ m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ ƒëang di·ªÖn ra trong qu√° kh·ª© -> D√πng th√¨ Qu√° kh·ª© ti·∫øp di·ªÖn.\n\nD·ªãch c√¢u: B·∫°n ƒëang l√†m g√¨ v√†o gi·ªù n√†y h√¥m qua? - T√¥i ƒëang ng·ªß."
            },
            {
                "questionNumber": 30,
                "question": "How fast _________ when the accident happened?",
                "options": [
                    { "text": "A. were you driving", "isCorrect": true },
                    { "text": "B. did you drive", "isCorrect": false },
                    { "text": "C. would you drive", "isCorrect": false },
                    { "text": "D. were you driven", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. were you driving (ƒëang l√°i xe)\nB. did you drive (ƒë√£ l√°i xe)\nC. would you drive (s·∫Ω l√°i xe)\nD. were you driven (b·ªã ƒë·ªông: b·ªã l√°i xe)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông l√°i xe l√† h√†nh ƒë·ªông n·ªÅn ƒëang di·ªÖn ra (Past Continuous) th√¨ tai n·∫°n x·∫£y ra (Past Simple). C√¢u h·ªèi v·ªÅ t·ªëc ƒë·ªô ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥.\n\nD·ªãch c√¢u: B·∫°n ƒëang l√°i xe nhanh th·∫ø n√†o khi tai n·∫°n x·∫£y ra?"
            },
            {
                "questionNumber": 31,
                "question": "They __________ on the lake when it started to rain so they went home.",
                "options": [
                    { "text": "A. fished", "isCorrect": false },
                    { "text": "B. fishing", "isCorrect": false },
                    { "text": "C. were fishing", "isCorrect": true },
                    { "text": "D. are fishing", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. fished (V2: ƒë√£ c√¢u c√°)\nB. fishing (V-ing: vi·ªác c√¢u c√°)\nC. were fishing (QK ti·∫øp di·ªÖn: ƒëang c√¢u c√°)\nD. are fishing (HT ti·∫øp di·ªÖn: ƒëang c√¢u c√°)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông c√¢u c√° ƒëang di·ªÖn ra (long action) th√¨ tr·ªùi m∆∞a (short action). 'They' ƒëi v·ªõi 'were'.\n\nD·ªãch c√¢u: H·ªç ƒëang c√¢u c√° tr√™n h·ªì th√¨ tr·ªùi b·∫Øt ƒë·∫ßu m∆∞a n√™n h·ªç ƒëi v·ªÅ nh√†."
            },
            {
                "questionNumber": 32,
                "question": "Her dad found some money while he __________ her suitcase.",
                "options": [
                    { "text": "A. packing", "isCorrect": false },
                    { "text": "B. package", "isCorrect": false },
                    { "text": "C. are packing", "isCorrect": false },
                    { "text": "D. was packing", "isCorrect": true }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. packing (V-ing thi·∫øu tobe)\nB. package (noun: g√≥i h√†ng)\nC. are packing (HT ti·∫øp di·ªÖn)\nD. was packing (QK ti·∫øp di·ªÖn)\n\nGi·∫£i th√≠ch: Sau 'while' th∆∞·ªùng l√† th√¨ Qu√° kh·ª© ti·∫øp di·ªÖn ƒë·ªÉ di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang x·∫£y ra song song ho·∫∑c l√†m n·ªÅn. Ch·ªß ng·ªØ 'he' ƒëi v·ªõi 'was'.\n\nD·ªãch c√¢u: B·ªë c√¥ ·∫•y t√¨m th·∫•y m·ªôt √≠t ti·ªÅn trong khi √¥ng ƒëang ƒë√≥ng g√≥i vali cho c√¥ ·∫•y."
            },
            {
                "questionNumber": 33,
                "question": "Your brother __________ in Myanma when he met his girlfriend.",
                "options": [
                    { "text": "A. study", "isCorrect": false },
                    { "text": "B. was studying", "isCorrect": true },
                    { "text": "C. were study", "isCorrect": false },
                    { "text": "D. was study", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. study (V nguy√™n th·ªÉ)\nB. was studying (ƒëang h·ªçc)\nC. were study (sai ng·ªØ ph√°p)\nD. was study (sai ng·ªØ ph√°p)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông 'h·ªçc' ƒëang di·ªÖn ra trong qu√° kh·ª© (was studying) th√¨ h√†nh ƒë·ªông 'g·∫∑p b·∫°n g√°i' xen v√†o. Ch·ªß ng·ªØ 'Your brother' (s·ªë √≠t) d√πng 'was'.\n\nD·ªãch c√¢u: Anh trai b·∫°n ƒëang h·ªçc ·ªü Myanmar khi anh ·∫•y g·∫∑p b·∫°n g√°i c·ªßa m√¨nh."
            },
            {
                "questionNumber": 34,
                "question": "His grandma tried cake for the first time while she ___________ in China.",
                "options": [
                    { "text": "A. staying", "isCorrect": false },
                    { "text": "B. is staying", "isCorrect": false },
                    { "text": "C. is stayed", "isCorrect": false },
                    { "text": "D. was staying", "isCorrect": true }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. staying (thi·∫øu tobe)\nB. is staying (HT ti·∫øp di·ªÖn)\nC. is stayed (B·ªã ƒë·ªông hi·ªán t·∫°i - sai nghƒ©a)\nD. was staying (QK ti·∫øp di·ªÖn)\n\nGi·∫£i th√≠ch: M·ªánh ƒë·ªÅ sau 'while' di·ªÖn t·∫£ kho·∫£ng th·ªùi gian ƒëang ·ªü Trung Qu·ªëc trong qu√° kh·ª© -> D√πng Qu√° kh·ª© ti·∫øp di·ªÖn.\n\nD·ªãch c√¢u: B√† c·ªßa anh ·∫•y ƒë√£ th·ª≠ m√≥n b√°nh l·∫ßn ƒë·∫ßu ti√™n trong khi b√† ƒëang ·ªü Trung Qu·ªëc."
            },
            {
                "questionNumber": 35,
                "question": "Her mom __________ in the park when she saw a tree.",
                "options": [
                    { "text": "A. was going", "isCorrect": true },
                    { "text": "B. was going", "isCorrect": false }, /* Logic A and B duplicate in source, but code handles logic fine */
                    { "text": "C. were going", "isCorrect": false },
                    { "text": "D. were going", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. was going (ƒëang ƒëi)\nB. was going (tr√πng v·ªõi A)\nC. were going (sai ng√¥i)\nD. were going (tr√πng v·ªõi C)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông ƒëi d·∫°o/ƒëi l·∫°i trong c√¥ng vi√™n ƒëang di·ªÖn ra th√¨ nh√¨n th·∫•y c√°i c√¢y. Ch·ªß ng·ªØ 'Her mom' (s·ªë √≠t) d√πng 'was'.\n\nD·ªãch c√¢u: M·∫π c√¥ ·∫•y ƒëang ƒëi d·∫°o trong c√¥ng vi√™n th√¨ b√† nh√¨n th·∫•y m·ªôt c√°i c√¢y."
            },
            {
                "questionNumber": 36,
                "question": "_______ it _______ when I woke up this morning?",
                "options": [
                    { "text": "A. Is ... raining", "isCorrect": false },
                    { "text": "B. Was ... raining", "isCorrect": true },
                    { "text": "C. Is ... rain", "isCorrect": false },
                    { "text": "D. Were ... raining", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. Is ... raining (HT ti·∫øp di·ªÖn)\nB. Was ... raining (QK ti·∫øp di·ªÖn)\nC. Is ... rain (Sai ng·ªØ ph√°p)\nD. Were ... raining (Sai ng√¥i - It ƒëi v·ªõi Was)\n\nGi·∫£i th√≠ch: 'Woke up' l√† qu√° kh·ª© ƒë∆°n, h·ªèi v·ªÅ h√†nh ƒë·ªông ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥ -> Past Continuous. Ch·ªß ng·ªØ 'It' d√πng 'Was'.\n\nD·ªãch c√¢u: Tr·ªùi c√≥ ƒëang m∆∞a khi t√¥i th·ª©c d·∫≠y s√°ng nay kh√¥ng?"
            },
            {
                "questionNumber": 37,
                "question": "What __________ when his mother came?",
                "options": [
                    { "text": "A. were you doing", "isCorrect": true },
                    { "text": "B. was you doing", "isCorrect": false },
                    { "text": "C. are you doing", "isCorrect": false },
                    { "text": "D. are you doing", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. were you doing (B·∫°n ƒëang l√†m g√¨)\nB. was you doing (Sai ng√¥i - You ƒëi v·ªõi Were)\nC. are you doing (HT ti·∫øp di·ªÖn)\nD. are you doing (tr√πng C)\n\nGi·∫£i th√≠ch: C√¢u h·ªèi v·ªÅ h√†nh ƒë·ªông ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm m·∫π ƒë·∫øn (qu√° kh·ª©). You -> Were.\n\nD·ªãch c√¢u: B·∫°n ƒëang l√†m g√¨ khi m·∫π anh ·∫•y ƒë·∫øn?"
            },
            {
                "questionNumber": 38,
                "question": "What did you watch on TV while you __________ dinner last night?",
                "options": [
                    { "text": "A. were having", "isCorrect": true },
                    { "text": "B. was having", "isCorrect": false },
                    { "text": "C. were having", "isCorrect": false },
                    { "text": "D. was having", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. were having (ƒëang ƒÉn)\nB. was having (sai ng√¥i)\nC. were having (tr√πng A)\nD. was having (sai ng√¥i)\n\nGi·∫£i th√≠ch: M·ªánh ƒë·ªÅ sau 'while' chia Qu√° kh·ª© ti·∫øp di·ªÖn. Ch·ªß ng·ªØ 'you' ƒëi v·ªõi 'were'.\n\nD·ªãch c√¢u: B·∫°n ƒë√£ xem g√¨ tr√™n TV trong khi b·∫°n ƒëang ƒÉn t·ªëi t·ªëi qua?"
            },
            {
                "questionNumber": 39,
                "question": "The policeman __________ his letter in the post office at that time.",
                "options": [
                    { "text": "A. is sending", "isCorrect": false },
                    { "text": "B. was sending", "isCorrect": true },
                    { "text": "C. sending", "isCorrect": false },
                    { "text": "D. was sending", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. is sending (HT ti·∫øp di·ªÖn)\nB. was sending (QK ti·∫øp di·ªÖn)\nC. sending (V-ing thi·∫øu tobe)\nD. was sending (tr√πng B)\n\nGi·∫£i th√≠ch: D·∫•u hi·ªáu 'at that time' (v√†o l√∫c ƒë√≥ - trong qu√° kh·ª©) -> D√πng Qu√° kh·ª© ti·∫øp di·ªÖn. Ch·ªß ng·ªØ 'The policeman' (s·ªë √≠t) d√πng 'was'.\n\nD·ªãch c√¢u: Ng∆∞·ªùi c·∫£nh s√°t ƒëang g·ª≠i th∆∞ t·∫°i b∆∞u ƒëi·ªán v√†o l√∫c ƒë√≥."
            },
            {
                "questionNumber": 40,
                "question": "It __________ and cloudy when I left Ireland.",
                "options": [
                    { "text": "A. was rain", "isCorrect": false },
                    { "text": "B. was raining", "isCorrect": true },
                    { "text": "C. is raining", "isCorrect": false },
                    { "text": "D. raining", "isCorrect": false }
                ],
                "rawRationale": "D·ªãch ƒë√°p √°n:\nA. was rain (Sai ng·ªØ ph√°p: tobe + V nguy√™n th·ªÉ)\nB. was raining (ƒëang m∆∞a)\nC. is raining (HT ti·∫øp di·ªÖn)\nD. raining (thi·∫øu tobe)\n\nGi·∫£i th√≠ch: M√¥ t·∫£ th·ªùi ti·∫øt/b·ªëi c·∫£nh trong qu√° kh·ª© ('when I left Ireland') -> D√πng Qu√° kh·ª© ti·∫øp di·ªÖn.\n\nD·ªãch c√¢u: Tr·ªùi ƒëang m∆∞a v√† nhi·ªÅu m√¢y khi t√¥i r·ªùi Ireland."
            }
        ];

        let score = 0;
        let answeredCount = 0;
        const totalQuestions = quizData.length;

        // Sounds
        const audioCorrect = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
        const audioWrong = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-cartoon-toy-whistle-down-2843.mp3');

        // Render Quiz
        function initQuiz() {
            document.getElementById('total-questions').innerText = totalQuestions;
            const container = document.getElementById('quiz-container');

            quizData.forEach((q, index) => {
                // Format rationale for HTML
                const formattedRationale = formatRationale(q.rawRationale);

                const card = document.createElement('div');
                card.classList.add('quiz-card');
                card.id = `q-card-${index}`;

                let optionsHtml = '';
                q.options.forEach((opt, optIndex) => {
                    optionsHtml += `<button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, ${opt.isCorrect}, this)">${opt.text}</button>`;
                });

                card.innerHTML = `
                    <div class="question-number">C√¢u ${q.questionNumber}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid" id="opt-grid-${index}">
                        ${optionsHtml}
                    </div>
                    <div class="explanation-box" id="expl-${index}">
                        <div class="explanation-header">üì¢ C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="expl-content">${formattedRationale}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function formatRationale(text) {
            // Split text by new lines and wrap in semantic formatting
            const lines = text.split('\n').filter(line => line.trim() !== '');
            let html = '';
            
            lines.forEach(line => {
                if (line.includes('D·ªãch ƒë√°p √°n:')) {
                    html += `<div class="expl-section"><strong>1. Ph√¢n t√≠ch ƒë√°p √°n:</strong></div>`;
                } else if (line.includes('Gi·∫£i th√≠ch:')) {
                     html += `<div class="expl-section"><strong>3. T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</strong><br>${line.replace('Gi·∫£i th√≠ch:', '').trim()}</div>`;
                } else if (line.includes('D·ªãch c√¢u:')) {
                     html += `<div class="expl-section"><strong>2. D·ªãch nghƒ©a to√†n c√¢u:</strong><br><em>"${line.replace('D·ªãch c√¢u:', '').trim()}"</em></div>`;
                } else if (line.startsWith('A.') || line.startsWith('B.') || line.startsWith('C.') || line.startsWith('D.')) {
                    // Make option parts bold
                    html += `<div>${line}</div>`;
                } else {
                    html += `<div>${line}</div>`;
                }
            });
            return html;
        }

        function checkAnswer(qIndex, optIndex, isCorrect, btnElement) {
            // Prevent re-answering
            const grid = document.getElementById(`opt-grid-${qIndex}`);
            const buttons = grid.getElementsByClassName('option-btn');
            if (grid.getAttribute('data-answered') === 'true') return;

            grid.setAttribute('data-answered', 'true');
            answeredCount++;

            // Visual feedback
            if (isCorrect) {
                btnElement.classList.add('correct');
                score++;
                document.getElementById('current-score').innerText = score;
                playCorrectSound();
                fireConfetti();
            } else {
                btnElement.classList.add('wrong');
                playWrongSound();
                // Find and highlight correct answer
                const q = quizData[qIndex];
                for (let i = 0; i < buttons.length; i++) {
                    if (q.options[i].isCorrect) {
                        buttons[i].classList.add('correct');
                        break;
                    }
                }
            }

            // Disable all buttons
            for (let btn of buttons) {
                btn.disabled = true;
            }

            // Show explanation
            const expl = document.getElementById(`expl-${qIndex}`);
            expl.style.display = 'block';
        }

        function playCorrectSound() {
            audioCorrect.currentTime = 0;
            audioCorrect.play().catch(e => console.log('Audio play failed', e));
        }

        function playWrongSound() {
            audioWrong.currentTime = 0;
            audioWrong.play().catch(e => console.log('Audio play failed', e));
        }

        function finishQuiz() {
            if (answeredCount < totalQuestions) {
                if(!confirm(`Con m·ªõi l√†m ƒë∆∞·ª£c ${answeredCount}/${totalQuestions} c√¢u. Con c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`)) {
                    return;
                }
            }

            const modal = document.getElementById('result-modal');
            const finalScoreDisplay = document.getElementById('final-score-display');
            const feedbackText = document.getElementById('feedback-text');

            finalScoreDisplay.innerText = `${score}/${totalQuestions}`;
            
            const percentage = (score / totalQuestions) * 100;
            if (percentage === 100) {
                feedbackText.innerText = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i ti·∫øng Anh! üåüüèÜ";
                fireConfetti();
                fireConfetti();
            } else if (percentage >= 80) {
                feedbackText.innerText = "R·∫•t t·ªët! Con l√†m b√†i r·∫•t ch·∫Øc ch·∫Øn! üéâ";
            } else if (percentage >= 50) {
                feedbackText.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng √¥n th√™m ch√∫t n·ªØa nh√©! üí™";
            } else {
                feedbackText.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y xem k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ ti·∫øn b·ªô h∆°n! üå±";
            }

            modal.style.display = 'flex';
        }

        // CONFETTI LOGIC (Simple version)
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const particleCount = 100;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 2 - 1
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let activeParticles = false;

                particles.forEach(p => {
                    p.y += p.speedY;
                    p.x += p.speedX;
                    if (p.y < canvas.height) {
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, p.size, p.size);
                        activeParticles = true;
                    }
                });

                if (activeParticles) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            animate();
        }

        // Initialize
        window.onload = initQuiz;

    </script>
</body>
</html>
