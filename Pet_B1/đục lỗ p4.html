<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Practice - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00D26A; /* M·∫∑c ƒë·ªãnh */
            --secondary-color: #eaffe8;
            --accent-color: #FFC312;
            --wrong-color: #FF4757;
            --text-color: #2f3542;
            --bg-gradient: radial-gradient(circle, #ffffff 0%, #f1f2f6 100%);
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Nunito', sans-serif;
            height: 100vh;
            overflow: hidden;
            background: var(--bg-gradient);
            background-size: cover;
            transition: background 0.5s ease;
        }

        /* --- UI COMPONENTS --- */
        /* Header & Timer */
        header {
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            position: relative;
        }

        .brand {
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-box {
            background: #2f3542;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            background: #f1f2f6;
            color: #57606f;
            transition: all 0.2s;
        }
        .nav-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* Main Split Screen */
        main {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Left Panel: Reading */
        .reading-panel {
            width: 50%;
            padding: 30px;
            overflow-y: auto;
            border-right: 2px solid rgba(0,0,0,0.05);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }

        .reading-title {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .paragraph {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            position: relative;
        }

        .gap-marker {
            display: inline-block;
            min-width: 40px;
            text-align: center;
            border-bottom: 2px dashed var(--primary-color);
            font-weight: bold;
            color: var(--primary-color);
        }

        .translate-btn {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #747d8c;
            cursor: pointer;
            font-weight: 700;
            text-decoration: underline;
        }
        
        .translation-text {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #f1f2f6;
            border-radius: 8px;
            font-size: 1rem;
            color: #2f3542;
            font-style: italic;
            border-left: 4px solid var(--primary-color);
        }

        /* Glossary Table */
        .glossary-box {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .glossary-title {
            font-weight: 800;
            color: var(--text-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
        }
        .glossary-table th, .glossary-table td {
            text-align: left;
            padding: 10px;
            border-bottom: 1px solid #f1f2f6;
        }
        .glossary-table th { color: var(--primary-color); }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            background: #f1f2f6;
            color: #57606f;
            font-weight: bold;
        }

        /* Right Panel: Exercises */
        .exercise-panel {
            width: 50%;
            padding: 30px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.4);
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border: 2px solid transparent;
        }
        .question-card:hover {
            transform: translateY(-5px);
        }

        .q-header {
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe4ea;
            padding: 15px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: #57606f;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #dfe4ea;
            position: relative;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .option-btn:hover:not([disabled]) {
            border-color: var(--primary-color);
            background: var(--secondary-color);
            transform: scale(1.02);
        }

        /* States for answers */
        .option-btn.correct {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 0 #00944a;
        }
        .option-btn.wrong {
            background: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
            box-shadow: 0 4px 0 #c23616;
            animation: shake 0.5s;
        }

        /* Explanation Box */
        .explanation-box {
            display: none; /* Hidden initially */
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid var(--primary-color);
            font-size: 0.95rem;
        }
        .exp-title { font-weight: 800; color: #2f3542; margin-bottom: 10px; }
        .exp-detail { margin-bottom: 8px; }
        .exp-highlight { color: var(--primary-color); font-weight: bold; }
        .exp-wrong { color: var(--wrong-color); text-decoration: line-through; opacity: 0.7; }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Control Button */
        .control-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .control-btn:active { transform: translateY(4px); box-shadow: none; }

        /* Modal Results */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: popUp 0.4s ease-out;
        }
        @keyframes popUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .score-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary-color);
            margin: 20px 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ced6e0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a4b0be; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            main { flex-direction: column; height: auto; overflow: auto; }
            .reading-panel, .exercise-panel { width: 100%; height: auto; border: none; }
            header { flex-direction: column; height: auto; padding: 10px; gap: 10px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <span>üéì Ms Mai An ULIS</span>
        </div>
        <div class="timer-box">
            <span>‚è≥</span>
            <span id="timer">10:00</span>
            <button class="control-btn" id="timerBtn" style="padding: 5px 15px; font-size: 0.8rem; margin-left:10px;">START</button>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn active" onclick="switchTopic(0)">üçé Apples</button>
            <button class="nav-btn" onclick="switchTopic(1)">üèÑ Surfing</button>
            <button class="control-btn" onclick="showResults()" style="background: #FFC312; color: #2f3542;">N·ªòP B√ÄI</button>
        </div>
    </header>

    <main>
        <div class="reading-panel" id="readingContainer">
            </div>

        <div class="exercise-panel" id="exerciseContainer">
            </div>
    </main>

    <div class="modal-overlay" id="resultModal">
        <div class="modal-content">
            <h2 style="font-family: 'Quicksand'; margin:0;">T·ªîNG K·∫æT B√ÄI L√ÄM</h2>
            <div class="score-display" id="finalScore">0/12</div>
            <p id="feedbackMsg" style="font-size: 1.2rem; color: #57606f;">H√£y b·∫Øt ƒë·∫ßu l√†m b√†i nh√©!</p>
            <button class="control-btn" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
        </div>
    </div>

    <canvas id="confetti-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; display:none;"></canvas>

    <script>
        // --- DATA SOURCE ---
        const topics = [
            {
                id: "apples",
                title: "A brief history of apples",
                theme: {
                    primary: "#ff4757", // Red
                    secondary: "#ffe0e3",
                    bgEmojis: ["üçé", "üçè", "üå≥", "ü•ß"],
                    gradient: "radial-gradient(circle at top left, #fff0f1 0%, #ffeaa7 100%)"
                },
                content: [
                    {
                        text: "Do you always have a piece of fruit for your lunch? If you do, it‚Äôs probably an apple! This is true particularly in places like western Europe, where apples have grown for hundreds of years. So it would be easy to (1)........... that‚Äôs where they came from originally.",
                        trans: "B·∫°n c√≥ lu√¥n ƒÉn m·ªôt mi·∫øng tr√°i c√¢y cho b·ªØa tr∆∞a kh√¥ng? N·∫øu c√≥, ƒë√≥ c√≥ th·ªÉ l√† m·ªôt qu·∫£ t√°o! ƒêi·ªÅu n√†y ƒë·∫∑c bi·ªát ƒë√∫ng ·ªü nh·ªØng n∆°i nh∆∞ T√¢y √Çu, n∆°i t√°o ƒë√£ m·ªçc h√†ng trƒÉm nƒÉm nay. V√¨ v·∫≠y, th·∫≠t d·ªÖ d√†ng ƒë·ªÉ (1) t∆∞·ªüng t∆∞·ª£ng/cho r·∫±ng ƒë√≥ l√† n∆°i ch√∫ng xu·∫•t ph√°t ban ƒë·∫ßu."
                    },
                    {
                        text: "In fact, though, the fruit we know today has been on an extraordinary (2)........... over the centuries. Research suggests modern apples originally came all the way from Kazakhstan in Asia, and (3)........... up in Europe partly because of people carrying goods along the famous Silk Road, from western Europe all the way to China in the east.",
                        trans: "Tuy nhi√™n, tr√™n th·ª±c t·∫ø, lo·∫°i tr√°i c√¢y ch√∫ng ta bi·∫øt ng√†y nay ƒë√£ tr·∫£i qua m·ªôt (2) h√†nh tr√¨nh phi th∆∞·ªùng qua nhi·ªÅu th·∫ø k·ª∑. Nghi√™n c·ª©u cho th·∫•y t√°o hi·ªán ƒë·∫°i c√≥ ngu·ªìn g·ªëc t·ª´ Kazakhstan ·ªü ch√¢u √Å, v√† (3) k·∫øt th√∫c (c√≥ m·∫∑t) ·ªü ch√¢u √Çu m·ªôt ph·∫ßn l√† do nh·ªØng ng∆∞·ªùi mang h√†ng h√≥a d·ªçc theo Con ƒë∆∞·ªùng T∆° l·ª•a n·ªïi ti·∫øng, t·ª´ T√¢y √Çu ƒë·∫øn t·∫≠n Trung Qu·ªëc ·ªü ph√≠a ƒë√¥ng."
                    },
                    {
                        text: "This helped to spread apples in both (4)........... . People (5)........... down their apples after they‚Äôd finished eating them, and the seeds entered the ground and produced new types of apple trees. Farmers were then able to start developing a much (6)........... range of apples.",
                        trans: "ƒêi·ªÅu n√†y ƒë√£ gi√∫p lan truy·ªÅn t√°o theo c·∫£ hai (4) h∆∞·ªõng. M·ªçi ng∆∞·ªùi (5) n√©m xu·ªëng nh·ªØng qu·∫£ t√°o (l√µi t√°o) sau khi h·ªç ƒÉn xong, v√† h·∫°t gi·ªëng r∆°i xu·ªëng ƒë·∫•t t·∫°o ra nh·ªØng lo·∫°i c√¢y t√°o m·ªõi. N√¥ng d√¢n sau ƒë√≥ ƒë√£ c√≥ th·ªÉ b·∫Øt ƒë·∫ßu ph√°t tri·ªÉn m·ªôt ph·∫°m vi (6) r·ªông l·ªõn h∆°n nhi·ªÅu c√°c lo·∫°i t√°o."
                    }
                ],
                glossary: [
                    { w: "Extraordinary", t: "adj", m: "Phi th∆∞·ªùng, ƒë·∫∑c bi·ªát" },
                    { w: "Originally", t: "adv", m: "Ban ƒë·∫ßu, ngu·ªìn g·ªëc" },
                    { w: "Suggest", t: "v", m: "G·ª£i √Ω, cho th·∫•y" },
                    { w: "Goods", t: "n", m: "H√†ng h√≥a" },
                    { w: "Spread", t: "v", m: "Lan truy·ªÅn, ph√°t t√°n" },
                    { w: "Develop", t: "v", m: "Ph√°t tri·ªÉn" },
                    { w: "Range", t: "n", m: "Ph·∫°m vi, lo·∫°i" }
                ],
                questions: [
                    {
                        id: 1, text: "Question 1", options: ["A. consider", "B. wonder", "C. imagine", "D. expect"], correct: 2, // Index 0-3
                        exp: {
                            def: "A. c√¢n nh·∫Øc | B. t·ª± h·ªèi | C. t∆∞·ªüng t∆∞·ª£ng/cho r·∫±ng | D. mong ƒë·ª£i",
                            reason: "D·ª±a v√†o ng·ªØ c·∫£nh: 'th·∫≠t d·ªÖ ƒë·ªÉ [cho r·∫±ng] ch√∫ng ƒë·∫øn t·ª´ ƒë√≥'. 'Imagine' ·ªü ƒë√¢y mang nghƒ©a suy ƒëo√°n h·ª£p l√Ω. 'Consider' th∆∞·ªùng c·∫ßn t√¢n ng·ªØ tr·ª±c ti·∫øp (consider sth).",
                            trans: "V·∫≠y n√™n th·∫≠t d·ªÖ ƒë·ªÉ t∆∞·ªüng t∆∞·ª£ng r·∫±ng ƒë√≥ l√† n∆°i ch√∫ng b·∫Øt ngu·ªìn."
                        }
                    },
                    {
                        id: 2, text: "Question 2", options: ["A. distance", "B. travel", "C. course", "D. journey"], correct: 3,
                        exp: {
                            def: "A. kho·∫£ng c√°ch | B. s·ª± ƒëi l·∫°i (chung chung) | C. kh√≥a h·ªçc/ti·∫øn tr√¨nh | D. h√†nh tr√¨nh",
                            reason: "C·ª•m t·ª´ 'extraordinary journey' (h√†nh tr√¨nh phi th∆∞·ªùng) d√πng ƒë·ªÉ mi√™u t·∫£ qu√° tr√¨nh di chuy·ªÉn v√† ph√°t tri·ªÉn qua l·ªãch s·ª≠. 'Travel' l√† danh t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c trong ng·ªØ c·∫£nh n√†y n√™n kh√¥ng d√πng 'an'.",
                            trans: "Tr√°i c√¢y ch√∫ng ta bi·∫øt ng√†y nay ƒë√£ tr·∫£i qua m·ªôt h√†nh tr√¨nh phi th∆∞·ªùng."
                        }
                    },
                    {
                        id: 3, text: "Question 3", options: ["A. reached", "B. ended", "C. set", "D. kept"], correct: 1,
                        exp: {
                            def: "Phrasal verb: end up (k·∫øt th√∫c t·∫°i/c√≥ m·∫∑t t·∫°i)",
                            reason: "C·∫•u tr√∫c: 'end up in [place]' nghƒ©a l√† cu·ªëi c√πng l·∫°i c√≥ m·∫∑t ·ªü ƒë√¢u ƒë√≥. C√°c t·ª´ kh√°c kh√¥ng ƒëi v·ªõi 'up' theo nghƒ©a ph√π h·ª£p: 'reach' kh√¥ng ƒëi v·ªõi up.",
                            trans: "...v√† cu·ªëi c√πng ƒë√£ c√≥ m·∫∑t ·ªü ch√¢u √Çu..."
                        }
                    },
                    {
                        id: 4, text: "Question 4", options: ["A. routes", "B. ways", "C. directions", "D. paths"], correct: 2,
                        exp: {
                            def: "A. tuy·∫øn ƒë∆∞·ªùng | B. c√°ch/l·ªëi | C. h∆∞·ªõng | D. ƒë∆∞·ªùng m√≤n",
                            reason: "C√¢u tr∆∞·ªõc n√≥i v·ªÅ vi·ªác di chuy·ªÉn t·ª´ T√¢y sang ƒê√¥ng (Silk Road). V·∫≠y t√°o lan truy·ªÅn theo c·∫£ 2 'directions' (h∆∞·ªõng ƒê√¥ng v√† T√¢y).",
                            trans: "ƒêi·ªÅu n√†y gi√∫p lan truy·ªÅn t√°o theo c·∫£ hai h∆∞·ªõng."
                        }
                    },
                    {
                        id: 5, text: "Question 5", options: ["A. threw", "B. dropped", "C. fell", "D. let"], correct: 0,
                        exp: {
                            def: "A. n√©m | B. l√†m r∆°i | C. ng√£/r∆°i | D. ƒë·ªÉ",
                            reason: "C·ª•m ƒë·ªông t·ª´ 'throw down' (n√©m xu·ªëng ƒë·∫•t). Ng·ªØ c·∫£nh l√† ƒÉn xong th√¨ v·ª©t l√µi t√°o xu·ªëng. 'Drop' th∆∞·ªùng l√† v√¥ t√¨nh.",
                            trans: "M·ªçi ng∆∞·ªùi n√©m t√°o xu·ªëng sau khi ƒÉn xong."
                        }
                    },
                    {
                        id: 6, text: "Question 6", options: ["A. longer", "B. deeper", "C. higher", "D. broader"], correct: 3,
                        exp: {
                            def: "Collocation: a broad range of (m·ªôt ph·∫°m vi r·ªông l·ªõn/ƒëa d·∫°ng)",
                            reason: "Khi n√≥i v·ªÅ s·ª± ƒëa d·∫°ng (range), ta d√πng t√≠nh t·ª´ 'broad' ho·∫∑c 'wide'.",
                            trans: "N√¥ng d√¢n c√≥ th·ªÉ ph√°t tri·ªÉn s·ª± ƒëa d·∫°ng c√°c lo·∫°i t√°o r·ªông l·ªõn h∆°n nhi·ªÅu."
                        }
                    }
                ]
            },
            {
                id: "surfing",
                title: "Surfing",
                theme: {
                    primary: "#1e90ff", // Blue
                    secondary: "#dff9fb",
                    bgEmojis: ["üèÑ", "üåä", "üèñÔ∏è", "üå§Ô∏è"],
                    gradient: "radial-gradient(circle at top right, #dff9fb 0%, #c7ecee 100%)"
                },
                content: [
                    {
                        text: "Surfing grew throughout the 20th century to (1)........... a popular sport all over the world, but surfers have been around for many years. The explorer James Cook saw surfing in action in 1778 during an (2)........... to the Pacific.",
                        trans: "L∆∞·ªõt s√≥ng ƒë√£ ph√°t tri·ªÉn trong su·ªët th·∫ø k·ª∑ 20 ƒë·ªÉ (1) tr·ªü th√†nh m·ªôt m√¥n th·ªÉ thao ph·ªï bi·∫øn tr√™n to√†n th·∫ø gi·ªõi, nh∆∞ng nh·ªØng ng∆∞·ªùi l∆∞·ªõt s√≥ng ƒë√£ xu·∫•t hi·ªán t·ª´ nhi·ªÅu nƒÉm tr∆∞·ªõc. Nh√† th√°m hi·ªÉm James Cook ƒë√£ th·∫•y l∆∞·ªõt s√≥ng v√†o nƒÉm 1778 trong m·ªôt (2) chuy·∫øn th√°m hi·ªÉm ƒë·∫øn Th√°i B√¨nh D∆∞∆°ng."
                    },
                    {
                        text: "In fact, surfing took (3)........... in the same areas then that have since become popular surfing resorts now, such as Hawaii and Tahiti. Surfing wasn‚Äôt encouraged by local officials (4)........... the 19th century but young Hawaiians took up the activity again in the early 1900s.",
                        trans: "Tr√™n th·ª±c t·∫ø, l∆∞·ªõt s√≥ng ƒë√£ (3) di·ªÖn ra ·ªü c√πng nh·ªØng khu v·ª±c m√† sau n√†y tr·ªü th√†nh c√°c khu ngh·ªâ d∆∞·ª°ng l∆∞·ªõt s√≥ng n·ªïi ti·∫øng hi·ªán nay, nh∆∞ Hawaii v√† Tahiti. L∆∞·ªõt s√≥ng kh√¥ng ƒë∆∞·ª£c c√°c quan ch·ª©c ƒë·ªãa ph∆∞∆°ng khuy·∫øn kh√≠ch (4) trong su·ªët th·∫ø k·ª∑ 19 nh∆∞ng nh·ªØng ng∆∞·ªùi Hawaii tr·∫ª tu·ªïi ƒë√£ b·∫Øt ƒë·∫ßu l·∫°i ho·∫°t ƒë·ªông n√†y v√†o ƒë·∫ßu nh·ªØng nƒÉm 1900."
                    },
                    {
                        text: "Following the invention of lighter surfboards, surfing attracted people around the world. The 1960s saw a huge increase in the (5)........... of surfers as the activity was promoted through the media and popular music. The hobby quickly became the professional sport it is now, and (6)........... and national organisations were created that organised competitions and raised money to hold events.",
                        trans: "Sau khi ph√°t minh ra v√°n l∆∞·ªõt s√≥ng nh·∫π h∆°n, l∆∞·ªõt s√≥ng ƒë√£ thu h√∫t m·ªçi ng∆∞·ªùi tr√™n kh·∫Øp th·∫ø gi·ªõi. Nh·ªØng nƒÉm 1960 ch·ª©ng ki·∫øn s·ª± gia tƒÉng to l·ªõn v·ªÅ (5) s·ªë l∆∞·ª£ng ng∆∞·ªùi l∆∞·ªõt s√≥ng khi ho·∫°t ƒë·ªông n√†y ƒë∆∞·ª£c qu·∫£ng b√° qua truy·ªÅn th√¥ng v√† √¢m nh·∫°c. S·ªü th√≠ch n√†y nhanh ch√≥ng tr·ªü th√†nh m√¥n th·ªÉ thao chuy√™n nghi·ªáp nh∆∞ hi·ªán nay, v√† c√°c t·ªï ch·ª©c (6) ƒë·ªãa ph∆∞∆°ng v√† qu·ªëc gia ƒë√£ ƒë∆∞·ª£c th√†nh l·∫≠p..."
                    }
                ],
                glossary: [
                    { w: "Throughout", t: "prep", m: "Trong su·ªët (th·ªùi gian/kh√¥ng gian)" },
                    { w: "Explorer", t: "n", m: "Nh√† th√°m hi·ªÉm" },
                    { w: "Expedition", t: "n", m: "Cu·ªôc th√°m hi·ªÉm" },
                    { w: "Encourage", t: "v", m: "Khuy·∫øn kh√≠ch" },
                    { w: "Promote", t: "v", m: "Qu·∫£ng b√°, th√∫c ƒë·∫©y" },
                    { w: "Invention", t: "n", m: "S·ª± ph√°t minh" },
                    { w: "Organisation", t: "n", m: "T·ªï ch·ª©c" }
                ],
                questions: [
                    {
                        id: 1, text: "Question 1", options: ["A. create", "B. turn", "C. become", "D. play"], correct: 2,
                        exp: {
                            def: "A. t·∫°o ra | B. bi·∫øn th√†nh | C. tr·ªü th√†nh | D. ch∆°i",
                            reason: "C·∫•u tr√∫c: grow to become (ph√°t tri·ªÉn ƒë·ªÉ tr·ªü th√†nh). 'Turn' th∆∞·ªùng ƒëi v·ªõi 'into'.",
                            trans: "...ph√°t tri·ªÉn trong su·ªët th·∫ø k·ª∑ 20 ƒë·ªÉ tr·ªü th√†nh m·ªôt m√¥n th·ªÉ thao ph·ªï bi·∫øn..."
                        }
                    },
                    {
                        id: 2, text: "Question 2", options: ["A. expedition", "B. travel", "C. drive", "D. move"], correct: 0,
                        exp: {
                            def: "A. cu·ªôc th√°m hi·ªÉm | B. du l·ªãch | C. l√°i xe | D. di chuy·ªÉn",
                            reason: "James Cook l√† nh√† th√°m hi·ªÉm (explorer), n√™n chuy·∫øn ƒëi c·ªßa √¥ng g·ªçi l√† 'expedition' (cu·ªôc h√†nh tr√¨nh c√≥ m·ª•c ƒë√≠ch c·ª• th·ªÉ/nghi√™n c·ª©u).",
                            trans: "...trong m·ªôt cu·ªôc th√°m hi·ªÉm t·ªõi Th√°i B√¨nh D∆∞∆°ng."
                        }
                    },
                    {
                        id: 3, text: "Question 3", options: ["A. part", "B. place", "C. point", "D. position"], correct: 1,
                        exp: {
                            def: "Idiom: take place (di·ªÖn ra/x·∫£y ra)",
                            reason: "ƒê√¢y l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh (collocation). Take part = tham gia (sai nghƒ©a).",
                            trans: "Th·ª±c t·∫ø, l∆∞·ªõt s√≥ng ƒë√£ di·ªÖn ra ·ªü c√πng nh·ªØng khu v·ª±c ƒë√≥."
                        }
                    },
                    {
                        id: 4, text: "Question 4", options: ["A. while", "B. along", "C. for", "D. during"], correct: 3,
                        exp: {
                            def: "A. trong khi (c·ªông m·ªánh ƒë·ªÅ) | B. d·ªçc theo | C. kho·∫£ng (th·ªùi l∆∞·ª£ng) | D. trong su·ªët (th·ªùi k·ª≥)",
                            reason: "Tr∆∞·ªõc 'the 19th century' (m·ªôt danh t·ª´ ch·ªâ th·ªùi k·ª≥), ta d√πng 'during'. 'While' ph·∫£i ƒëi v·ªõi m·ªánh ƒë·ªÅ (S + V).",
                            trans: "L∆∞·ªõt s√≥ng kh√¥ng ƒë∆∞·ª£c khuy·∫øn kh√≠ch trong su·ªët th·∫ø k·ª∑ 19."
                        }
                    },
                    {
                        id: 5, text: "Question 5", options: ["A. group", "B. total", "C. number", "D. sum"], correct: 2,
                        exp: {
                            def: "Collocation: the number of + N (s·ªë l∆∞·ª£ng...)",
                            reason: "D√πng 'the number of surfers' ƒë·ªÉ ch·ªâ s·ªë l∆∞·ª£ng ng∆∞·ªùi ƒë·∫øm ƒë∆∞·ª£c. 'Amount' d√πng cho kh√¥ng ƒë·∫øm ƒë∆∞·ª£c. 'Sum' l√† t·ªïng s·ªë (to√°n h·ªçc).",
                            trans: "Nh·ªØng nƒÉm 60 ch·ª©ng ki·∫øn s·ª± gia tƒÉng l·ªõn v·ªÅ s·ªë l∆∞·ª£ng ng∆∞·ªùi l∆∞·ªõt s√≥ng."
                        }
                    },
                    {
                        id: 6, text: "Question 6", options: ["A. near", "B. close", "C. next", "D. local"], correct: 3,
                        exp: {
                            def: "A/B/C: g·∫ßn/k·∫ø ti·∫øp | D. ƒë·ªãa ph∆∞∆°ng",
                            reason: "ƒê·ªëi l·∫≠p v·ªõi 'national' (qu·ªëc gia) trong c√¢u n√†y l√† 'local' (ƒë·ªãa ph∆∞∆°ng). Hai c·∫•p ƒë·ªô t·ªï ch·ª©c th∆∞·ªùng th·∫•y.",
                            trans: "...c√°c t·ªï ch·ª©c ƒë·ªãa ph∆∞∆°ng v√† qu·ªëc gia ƒë√£ ƒë∆∞·ª£c th√†nh l·∫≠p."
                        }
                    }
                ]
            }
        ];

        let currentTopicIdx = 0;
        let userAnswers = {}; // Store answers { "topicIndex-qIndex": optionIndex }
        let timerInterval;
        let timeLeft = 600; // 10 minutes
        let isTimerRunning = false;

        // --- SOUNDS (Base64 for Single File) ---
        // Short Beep for Correct, Buzz for Wrong
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
                fireConfetti();
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- DOM RENDERER ---
        function init() {
            renderContent(0);
        }

        function switchTopic(idx) {
            currentTopicIdx = idx;
            renderContent(idx);
            // Update buttons style
            document.querySelectorAll('.nav-btn').forEach((btn, i) => {
                if(i === idx) btn.classList.add('active');
                else btn.classList.remove('active');
            });
        }

        function renderContent(idx) {
            const data = topics[idx];
            
            // 1. Apply Theme
            document.documentElement.style.setProperty('--primary-color', data.theme.primary);
            document.documentElement.style.setProperty('--secondary-color', data.theme.secondary);
            document.documentElement.style.setProperty('--bg-gradient', data.theme.gradient);
            generateSvgBackground(data.theme.bgEmojis);

            // 2. Render Reading Passage
            const readPanel = document.getElementById('readingContainer');
            readPanel.innerHTML = `<h2 class="reading-title">${data.title}</h2>`;
            
            data.content.forEach((para, pIdx) => {
                readPanel.innerHTML += `
                    <div class="paragraph">
                        ${para.text}
                        <br>
                        <span class="translate-btn" onclick="toggleTrans('trans-${idx}-${pIdx}')">üìù D·ªãch ƒë·∫ßy ƒë·ªß (Ms Mai An)</span>
                        <div id="trans-${idx}-${pIdx}" class="translation-text">
                            ${para.trans}
                        </div>
                    </div>
                `;
            });

            // 3. Render Glossary
            let glossaryHtml = `
                <div class="glossary-box">
                    <div class="glossary-title">üìö GLOSSARY (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</div>
                    <table class="glossary-table">
                        <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>`;
            data.glossary.forEach(g => {
                glossaryHtml += `<tr><td><strong>${g.w}</strong></td><td><span class="tag">${g.t}</span></td><td>${g.m}</td></tr>`;
            });
            glossaryHtml += `</table></div>`;
            readPanel.innerHTML += glossaryHtml;

            // 4. Render Exercises
            const exPanel = document.getElementById('exerciseContainer');
            exPanel.innerHTML = "";
            data.questions.forEach((q, qIdx) => {
                const qKey = `${idx}-${qIdx}`;
                const savedAns = userAnswers[qKey];
                
                let optionsHtml = "";
                q.options.forEach((opt, oIdx) => {
                    let btnClass = "option-btn";
                    let disabled = "";
                    
                    if (savedAns !== undefined) {
                        disabled = "disabled";
                        if (oIdx === q.correct) btnClass += " correct";
                        else if (oIdx === savedAns) btnClass += " wrong";
                        else btnClass += " fade"; // Fade other options
                    }

                    optionsHtml += `<button class="${btnClass}" ${disabled} onclick="checkAnswer(${idx}, ${qIdx}, ${oIdx})">${opt}</button>`;
                });

                // Explanation Block (Visible if answered)
                let expStyle = savedAns !== undefined ? "display:block;" : "";
                
                exPanel.innerHTML += `
                    <div class="question-card" id="card-${idx}-${qIdx}">
                        <div class="q-header">${q.text} (Gap ${qIdx+1})</div>
                        <div class="options-grid">
                            ${optionsHtml}
                        </div>
                        <div class="explanation-box" id="exp-${idx}-${qIdx}" style="${expStyle}">
                            <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt b·ªüi Ms Mai An:</div>
                            <div class="exp-detail"><strong>Ph√¢n t√≠ch:</strong> ${q.exp.def}</div>
                            <div class="exp-detail"><span class="exp-highlight">T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</span> ${q.exp.reason}</div>
                            <div class="exp-detail"><em>D·ªãch: "${q.exp.trans}"</em></div>
                        </div>
                    </div>
                `;
            });
        }

        // --- LOGIC ---
        function checkAnswer(topicIdx, qIdx, selectedOpt) {
            const key = `${topicIdx}-${qIdx}`;
            if (userAnswers[key] !== undefined) return; // Already answered

            userAnswers[key] = selectedOpt;
            const correctOpt = topics[topicIdx].questions[qIdx].correct;

            // Play Sound
            if (selectedOpt === correctOpt) {
                playSound('correct');
            } else {
                playSound('wrong');
            }

            // Re-render specifically this card to update UI states
            // Or simpler: just reload content to apply classes.
            // For efficiency, let's manipulate DOM directly here.
            const card = document.getElementById(`card-${topicIdx}-${qIdx}`);
            const buttons = card.querySelectorAll('.option-btn');
            
            buttons.forEach((btn, idx) => {
                btn.disabled = true;
                if (idx === correctOpt) btn.classList.add('correct');
                else if (idx === selectedOpt) btn.classList.add('wrong');
            });

            // Show explanation
            const expBox = document.getElementById(`exp-${topicIdx}-${qIdx}`);
            expBox.style.display = "block";
        }

        function toggleTrans(id) {
            const el = document.getElementById(id);
            if (el.style.display === "block") el.style.display = "none";
            else el.style.display = "block";
        }

        function generateSvgBackground(emojis) {
            // Create a simple SVG pattern with emojis
            const svgString = `
            <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
                <text x="20" y="50" font-size="40" opacity="0.1">${emojis[0]}</text>
                <text x="120" y="150" font-size="40" opacity="0.1">${emojis[1]}</text>
                <text x="50" y="180" font-size="30" opacity="0.1">${emojis[2] || emojis[0]}</text>
            </svg>`;
            const url = `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svgString)}`;
            // We append this image over the gradient
            document.body.style.backgroundImage = `${topics[currentTopicIdx].theme.gradient}, url('${url}')`;
        }

        // --- TIMER ---
        const timerEl = document.getElementById('timer');
        const timerBtn = document.getElementById('timerBtn');

        timerBtn.addEventListener('click', () => {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerBtn.innerText = "RESUME";
            } else {
                isTimerRunning = true;
                timerBtn.innerText = "PAUSE";
                timerInterval = setInterval(() => {
                    timeLeft--;
                    let m = Math.floor(timeLeft / 60);
                    let s = timeLeft % 60;
                    timerEl.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        alert("ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c, nh∆∞ng h√£y nh·ªõ luy·ªán t·∫≠p t·ªëc ƒë·ªô nh√©!");
                    }
                }, 1000);
            }
        });

        // --- RESULTS ---
        function showResults() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            timerBtn.innerText = "START";

            let totalQ = 0;
            let correctC = 0;
            
            topics.forEach((t, tIdx) => {
                t.questions.forEach((q, qIdx) => {
                    totalQ++;
                    const key = `${tIdx}-${qIdx}`;
                    if (userAnswers[key] === q.correct) correctC++;
                });
            });

            document.getElementById('finalScore').innerText = `${correctC}/${totalQ}`;
            
            const msgEl = document.getElementById('feedbackMsg');
            const percent = (correctC/totalQ)*100;
            
            if (percent === 100) msgEl.innerText = "üåü XU·∫§T S·∫ÆC! B·∫°n ƒë√∫ng l√† thi√™n t√†i ti·∫øng Anh!";
            else if (percent >= 80) msgEl.innerText = "üí™ L√†m t·ªët l·∫Øm! B·∫°n n·∫Øm r·∫•t ch·∫Øc ki·∫øn th·ª©c.";
            else if (percent >= 50) msgEl.innerText = "üëç Kh√° t·ªët, nh∆∞ng h√£y ƒë·ªçc k·ªπ gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu s√¢u h∆°n nh√©.";
            else msgEl.innerText = "üå± C·ªë l√™n! H√£y xem k·ªπ ph·∫ßn 'Gi·∫£i th√≠ch chi ti·∫øt' ƒë·ªÉ r√∫t kinh nghi·ªám nha.";

            document.getElementById('resultModal').style.display = "flex";
            if (percent >= 80) fireConfetti();
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = "none";
        }

        // --- CONFETTI EFFECT (Minimal Script) ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            canvas.style.display = 'block';
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speed: Math.random() * 5 + 2
                });
            }

            let animationId;
            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.y += p.speed;
                    if (p.y < canvas.height) active = true;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                });

                if (active) animationId = requestAnimationFrame(update);
                else {
                    canvas.style.display = 'none';
                    cancelAnimationFrame(animationId);
                }
            }
            update();
        }

        // Initialize
        init();

    </script>
</body>
</html>