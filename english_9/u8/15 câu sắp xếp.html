<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise 15: Reorder Words - Ms Mai An ULIS</title>
    <!-- Google Fonts: Quicksand & Nunito for friendly look -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-main: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#e0e0e0 15%, transparent 16%), radial-gradient(#e0e0e0 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            padding: 20px;
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
            margin-bottom: 50px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary-pink);
        }

        .header h1 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-pink);
            font-size: 1.5rem;
            margin: 0;
            font-weight: 800;
            text-transform: uppercase;
        }

        .header h2 {
            font-size: 1rem;
            color: #666;
            margin: 5px 0 0;
        }

        /* Progress Bar */
        .progress-container {
            background-color: #dfe6e9;
            border-radius: 50px;
            height: 20px;
            width: 100%;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary-teal), #55efc4);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-in-out;
            border-radius: 50px;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            font-weight: bold;
            color: #2d3436;
        }

        /* Question Card */
        .question-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.2);
            margin-bottom: 20px;
            border: 3px solid #f1f2f6;
            position: relative;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .hint-text {
            font-size: 1rem;
            color: var(--primary-pink);
            font-style: italic;
            background: #f3e5f5;
            padding: 10px 15px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 20px;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            color: #2d3436;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            box-shadow: 0 5px 0 #b2bec3;
            outline: none;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-pink);
            background-color: #f8f0ff;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #b2bec3;
        }

        .option-label {
            font-weight: 800;
            margin-right: 15px;
            background: #dfe6e9;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b894;
            box-shadow: 0 5px 0 #00b894;
        }
        .option-btn.correct .option-label { background: rgba(255,255,255,0.3); color: white; }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #d63031;
            box-shadow: 0 5px 0 #d63031;
            animation: shake 0.5s;
        }
        .option-btn.wrong .option-label { background: rgba(255,255,255,0.3); color: white; }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Explanation Box */
        .explanation-box {
            background: #fff;
            border-left: 6px solid var(--primary-pink);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; margin-top: 10px; }
            to { opacity: 1; margin-top: 25px; }
        }

        .exp-header {
            font-weight: 800;
            color: var(--primary-pink);
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .exp-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-pink);
        }

        .exp-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #2d3436;
        }
        
        .exp-section {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #e0e0e0;
        }
        
        .exp-section:last-child { border-bottom: none; }
        
        .exp-label {
            font-weight: bold;
            color: var(--primary-teal);
            display: block;
            margin-bottom: 5px;
        }

        /* Navigation */
        .nav-controls {
            margin-top: 30px;
            text-align: center;
        }

        .next-btn {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 0 #6c429c;
            transition: transform 0.1s;
            display: none; /* Hidden initially */
        }

        .next-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #6c429c;
        }

        /* Result Screen */
        .result-card {
            text-align: center;
            display: none;
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            max-width: 500px;
            margin: 0 auto;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--primary-teal);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 3rem;
            font-weight: 800;
            box-shadow: 0 10px 0 #00a388;
        }
        
        .score-text { font-size: 1rem; font-weight: 600; opacity: 0.9; }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        
        /* Mobile Responsive */
        @media (max-width: 600px) {
            .question-text { font-size: 1.1rem; }
            .option-btn { font-size: 1rem; padding: 12px; }
            .header h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <div class="header">
        <h1>B√†i ki·ªÉm tra tr·∫Øc nghi·ªám</h1>
        <h2>Gi√°o vi√™n: Ms Mai An ULIS</h2>
    </div>

    <!-- Gameplay Area -->
    <div id="game-area">
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="progress-text" id="progress-text">C√¢u 1/15</div>
        </div>

        <div class="question-card">
            <div class="question-text" id="question-content">
                Loading question...
            </div>
            <div class="hint-text" id="question-hint">
                <!-- Hint will be injected here -->
            </div>
            
            <div class="options-grid" id="options-container">
                <!-- Options will be injected here -->
            </div>
        </div>

        <div class="explanation-box" id="explanation-area">
            <div class="exp-header">
                <span>üë©‚Äçüè´ Ms Mai An gi·∫£i th√≠ch chi ti·∫øt:</span>
            </div>
            <div class="exp-content" id="explanation-content">
                <!-- Explanation detail -->
            </div>
        </div>

        <div class="nav-controls">
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
            <button class="next-btn" id="finish-btn" onclick="showResults()" style="background-color: var(--primary-teal); box-shadow: 0 6px 0 #00a388; display: none;">N·ªôp b√†i & Xem ƒëi·ªÉm</button>
        </div>
    </div>

    <!-- Result Area -->
    <div id="result-area" class="result-card">
        <div class="score-circle">
            <span id="final-score">0/0</span>
            <span class="score-text">ƒê√∫ng</span>
        </div>
        <h2 style="color: var(--primary-pink); margin-bottom: 10px;" id="result-title">Tuy·ªát v·ªùi!</h2>
        <p style="color: #666; margin-bottom: 20px;" id="result-message">B·∫°n ƒë√£ ho√†n th√†nh b√†i t·∫≠p xu·∫•t s·∫Øc.</p>
        <button class="next-btn" style="display: inline-block;" onclick="location.reload()">L√†m l·∫°i b√†i thi ‚Ü∫</button>
    </div>
</div>

<script>
    // --- DATA SOURCE (From provided JSON) ---
    const quizData = {
      "questions": [
        {
          "questionNumber": 1,
          "question": "Reorder: buy/ tourists/ always/ who/ Hoi An/ lanterns/ visit/ the/ colorful/.",
          "hint": "Ch·ªß ng·ªØ l√† 'The tourists'. M·ªánh ƒë·ªÅ quan h·ªá b·∫Øt ƒë·∫ßu b·∫±ng 'who' b·ªï nghƒ©a cho 'tourists'.",
          "answerOptions": [
            {
              "text": "The tourists who visit Hoi An always buy colorful lanterns.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The tourists) + Relative Clause (who visit Hoi An) + V (always buy) + O (colorful lanterns).\n**D·ªãch:** Nh·ªØng du kh√°ch ng∆∞·ªùi m√† gh√© thƒÉm H·ªôi An lu√¥n mua nh·ªØng chi·∫øc ƒë√®n l·ªìng ƒë·∫ßy m√†u s·∫Øc.",
              "isCorrect": true
            },
            {
              "text": "The tourists always buy colorful lanterns who visit Hoi An.",
              "rationale": "Sai. M·ªánh ƒë·ªÅ 'who visit...' ph·∫£i ƒë·ª©ng ngay sau danh t·ª´ n√≥ b·ªï nghƒ©a (tourists), kh√¥ng ƒë·ª©ng cu·ªëi c√¢u.",
              "isCorrect": false
            },
            {
              "text": "The colorful lanterns who visit Hoi An always buy tourists.",
              "rationale": "Sai nghƒ©a ho√†n to√†n (ƒê√®n l·ªìng mua du kh√°ch).",
              "isCorrect": false
            },
            {
              "text": "Who visit Hoi An the tourists always buy colorful lanterns.",
              "rationale": "Sai. 'Who' kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u trong c√¢u tr·∫ßn thu·∫≠t.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 2,
          "question": "Reorder: three/ helpful/ who/ our/ very/ languages/ is/ guide/ speaks/.",
          "hint": "Ch·ªß ng·ªØ l√† 'Our guide'. M·ªánh ƒë·ªÅ quan h·ªá 'who speaks...'.",
          "answerOptions": [
            {
              "text": "Our guide who speaks three languages is very helpful.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (Our guide) + Rel.Clause (who speaks three languages) + V (is) + Adj (very helpful).\n**D·ªãch:** H∆∞·ªõng d·∫´n vi√™n c·ªßa ch√∫ng t√¥i, ng∆∞·ªùi n√≥i ƒë∆∞·ª£c ba th·ª© ti·∫øng, r·∫•t hay gi√∫p ƒë·ª°.",
              "isCorrect": true
            },
            {
              "text": "Our guide is very helpful who speaks three languages.",
              "rationale": "Sai. M·ªánh ƒë·ªÅ quan h·ªá b·ªã t√°ch r·ªùi kh·ªèi danh t·ª´ 'guide'.",
              "isCorrect": false
            },
            {
              "text": "Who speaks three languages is our guide very helpful.",
              "rationale": "Sai c·∫•u tr√∫c ng·ªØ ph√°p.",
              "isCorrect": false
            },
            {
              "text": "Our guide who is very helpful speaks three languages.",
              "rationale": "V·ªÅ ng·ªØ ph√°p th√¨ ƒë√∫ng, nh∆∞ng so v·ªõi ng·ªØ c·∫£nh (nh·∫•n m·∫°nh t√≠nh c√°ch 'helpful' l√† v·ªã ng·ªØ ch√≠nh) th√¨ ƒë√°p √°n A ph·ªï bi·∫øn h∆°n trong b√†i t·∫≠p s·∫Øp x·∫øp.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 3,
          "question": "Reorder: make/ alone/ who/ friends/ usually/ people/ new/ travel/.",
          "hint": "Ch·ªß ng·ªØ l√† 'People'. Nh·ªØng ng∆∞·ªùi ƒëi du l·ªãch m·ªôt m√¨nh (travel alone) th∆∞·ªùng l√†m g√¨?",
          "answerOptions": [
            {
              "text": "People who travel alone usually make new friends.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (People) + Rel.Clause (who travel alone) + Adv (usually) + V (make) + O (new friends).\n**D·ªãch:** Nh·ªØng ng∆∞·ªùi ƒëi du l·ªãch m·ªôt m√¨nh th∆∞·ªùng k·∫øt b·∫°n m·ªõi.",
              "isCorrect": true
            },
            {
              "text": "People who make new friends usually travel alone.",
              "rationale": "Ng·ªØ ph√°p ƒë√∫ng nh∆∞ng sai logic c·ªßa b√†i t·∫≠p (th∆∞·ªùng ƒëi du l·ªãch m·ªõi k·∫øt b·∫°n, ch·ª© kh√¥ng ph·∫£i k·∫øt b·∫°n r·ªìi m·ªõi ƒëi du l·ªãch).",
              "isCorrect": false
            },
            {
              "text": "People usually make new friends who travel alone.",
              "rationale": "Sai. 'Who' ·ªü ƒë√¢y s·∫Ω b·ªï nghƒ©a cho 'friends' -> b·∫°n b√® ƒëi du l·ªãch m·ªôt m√¨nh (sai √Ω nghƒ©a g·ªëc).",
              "isCorrect": false
            },
            {
              "text": "Who travel alone usually make new friends people.",
              "rationale": "Sai tr·∫≠t t·ª± t·ª´.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 4,
          "question": "Reorder: museum/ flash/ who/ the/ visitors/ photos/ in/ not/ take/ use/ must/.",
          "hint": "Ch·ªß ng·ªØ: Visitors. H√†nh ƒë·ªông c·∫•m: must not use flash.",
          "answerOptions": [
            {
              "text": "Visitors who take photos in the museum must not use flash.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (Visitors + who take photos in the museum) + Modal V (must not use) + O (flash).\n**D·ªãch:** Du kh√°ch ch·ª•p ·∫£nh trong b·∫£o t√†ng kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë√®n flash.",
              "isCorrect": true
            },
            {
              "text": "Visitors who use flash must not take photos in the museum.",
              "rationale": "Sai logic (Th∆∞·ªùng l√† c·∫•m flash, ch·ª© kh√¥ng c·∫•m ch·ª•p ·∫£nh ho√†n to√†n n·∫øu kh√¥ng d√πng flash).",
              "isCorrect": false
            },
            {
              "text": "Visitors in the museum who take flash must not use photos.",
              "rationale": "Sai nghƒ©a (s·ª≠ d·ª•ng ·∫£nh?).",
              "isCorrect": false
            },
            {
              "text": "The museum visitors who take photos must not use in flash.",
              "rationale": "Sai gi·ªõi t·ª´ 'in flash'.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 5,
          "question": "Reorder: experienced/ best/ the/ knows/ driver/ is/ city/ who/ routes/ the/.",
          "hint": "Ch·ªß ng·ªØ 'The driver'. Ng∆∞·ªùi n√†y bi·∫øt c√°i g√¨? (best city routes).",
          "answerOptions": [
            {
              "text": "The driver who knows the best city routes is experienced.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The driver) + Rel.Clause (who knows the best city routes) + V (is) + Adj (experienced).\n**D·ªãch:** Ng∆∞·ªùi t√†i x·∫ø ng∆∞·ªùi m√† bi·∫øt nh·ªØng tuy·∫øn ƒë∆∞·ªùng th√†nh ph·ªë t·ªët nh·∫•t th√¨ r·∫•t gi√†u kinh nghi·ªám.",
              "isCorrect": true
            },
            {
              "text": "The driver who is experienced knows the best city routes.",
              "rationale": "C≈©ng ƒë√∫ng ng·ªØ ph√°p, nh∆∞ng c√¢u A nh·∫•n m·∫°nh v√†o ph·∫©m ch·∫•t 'experienced' nh∆∞ m·ªôt k·∫øt qu·∫£/ƒë√°nh gi√° h∆°n.",
              "isCorrect": false
            },
            {
              "text": "The best driver who knows the city routes is experienced.",
              "rationale": "Sai. D∆∞ t·ª´ 'the' ·ªü c·ª•m city routes n·∫øu d√πng 'The best driver'.",
              "isCorrect": false
            },
            {
              "text": "The driver knows the best city routes who is experienced.",
              "rationale": "Sai. 'Who' b·ªã t√°ch kh·ªèi 'driver'.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 6,
          "question": "Reorder: expensive/ pool/ hotel/ is/ a/ which/ the/ more/ swimming/ has/.",
          "hint": "Ch·ªß ng·ªØ 'The hotel'. Kh√°ch s·∫°n c√≥ h·ªì b∆°i (has a swimming pool) th√¨ ƒë·∫Øt h∆°n.",
          "answerOptions": [
            {
              "text": "The hotel which has a swimming pool is more expensive.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The hotel) + Rel.Clause (which has a swimming pool) + V (is) + Adj (more expensive).\n**D·ªãch:** Kh√°ch s·∫°n c√°i m√† c√≥ h·ªì b∆°i th√¨ ƒë·∫Øt h∆°n.",
              "isCorrect": true
            },
            {
              "text": "The hotel is more expensive which has a swimming pool.",
              "rationale": "Sai. M·ªánh ƒë·ªÅ quan h·ªá ph·∫£i ƒë·ª©ng ngay sau 'hotel'.",
              "isCorrect": false
            },
            {
              "text": "The swimming pool which has a hotel is more expensive.",
              "rationale": "Sai nghƒ©a (H·ªì b∆°i c√≥ kh√°ch s·∫°n).",
              "isCorrect": false
            },
            {
              "text": "Which hotel has a swimming pool is more expensive.",
              "rationale": "Sai c·∫•u tr√∫c c√¢u tr·∫ßn thu·∫≠t.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 7,
          "question": "Reorder: popular/ fresh/ which/ restaurant/ very/ the/ seafood/ is/ serves/.",
          "hint": "Ch·ªß ng·ªØ 'The restaurant'. M·ªánh ƒë·ªÅ quan h·ªá 'which serves fresh seafood'.",
          "answerOptions": [
            {
              "text": "The restaurant which serves fresh seafood is very popular.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The restaurant) + Rel.Clause (which serves fresh seafood) + V (is) + Adj (very popular).\n**D·ªãch:** Nh√† h√†ng c√°i m√† ph·ª•c v·ª• h·∫£i s·∫£n t∆∞∆°i s·ªëng th√¨ r·∫•t n·ªïi ti·∫øng.",
              "isCorrect": true
            },
            {
              "text": "The restaurant is very popular which serves fresh seafood.",
              "rationale": "Sai. M·ªánh ƒë·ªÅ quan h·ªá sai v·ªã tr√≠.",
              "isCorrect": false
            },
            {
              "text": "The fresh seafood which serves the restaurant is very popular.",
              "rationale": "Sai nghƒ©a (H·∫£i s·∫£n ph·ª•c v·ª• nh√† h√†ng).",
              "isCorrect": false
            },
            {
              "text": "The restaurant which is very popular serves fresh seafood.",
              "rationale": "C≈©ng ƒë√∫ng ng·ªØ ph√°p, nh∆∞ng c√¢u A t·ª± nhi√™n h∆°n khi d√πng m·ªánh ƒë·ªÅ quan h·ªá ƒë·ªÉ ƒë·ªãnh danh lo·∫°i nh√† h√†ng.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 8,
          "question": "Reorder: many/ beautiful/ attracts/ which/ beach/ tourists/ Nha Trang/ the/ in/ is/.",
          "hint": "Ch·ªß ng·ªØ: 'The beach in Nha Trang'. Hai t√≠nh ch·∫•t: 'attracts tourists' v√† 'beautiful'. H√£y t√¨m c√¢u h·ª£p l√Ω nh·∫•t.",
          "answerOptions": [
            {
              "text": "The beach in Nha Trang which attracts many tourists is beautiful.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The beach in Nha Trang) + Rel.Clause (which attracts many tourists) + V (is) + Adj (beautiful).\n**D·ªãch:** B√£i bi·ªÉn ·ªü Nha Trang n∆°i thu h√∫t nhi·ªÅu du kh√°ch th√¨ r·∫•t ƒë·∫πp.",
              "isCorrect": true
            },
            {
              "text": "The beach which is in Nha Trang attracts many beautiful tourists.",
              "rationale": "Sai nghƒ©a (Thu h√∫t du kh√°ch xinh ƒë·∫πp).",
              "isCorrect": false
            },
            {
              "text": "The beautiful beach in Nha Trang is which attracts many tourists.",
              "rationale": "Sai c·∫•u tr√∫c.",
              "isCorrect": false
            },
            {
              "text": "The beach in Nha Trang which is beautiful attracts many tourists.",
              "rationale": "C≈©ng ƒë√∫ng ng·ªØ ph√°p, nh∆∞ng ƒë√°p √°n A ph√¢n b·ªï c√°c th√†nh ph·∫ßn c√¢u c√¢n ƒë·ªëi h∆°n v·ªõi t·ª´ 'is' l√†m ƒë·ªông t·ª´ ch√≠nh.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 9,
          "question": "Reorder: ago/ built/ temple/ years/ which/ the/ restoration/ 1000/ was/ needs/.",
          "hint": "Ch·ªß ng·ªØ 'The temple'. ƒê∆∞·ª£c x√¢y 1000 nƒÉm tr∆∞·ªõc (built 1000 years ago). ƒê·ªông t·ª´ ch√≠nh 'needs'.",
          "answerOptions": [
            {
              "text": "The temple which was built 1000 years ago needs restoration.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The temple + which was built 1000 years ago) + V (needs) + O (restoration).\n**D·ªãch:** Ng√¥i ƒë·ªÅn c√°i m√† ƒë∆∞·ª£c x√¢y d·ª±ng c√°ch ƒë√¢y 1000 nƒÉm c·∫ßn ƒë∆∞·ª£c tr√πng tu.",
              "isCorrect": true
            },
            {
              "text": "The temple which needs restoration was built 1000 years ago.",
              "rationale": "Ng·ªØ ph√°p ƒë√∫ng, nh∆∞ng th∆∞·ªùng ng∆∞·ªùi ta d√πng m·ªëc th·ªùi gian (1000 nƒÉm) ƒë·ªÉ ƒë·ªãnh danh ng√¥i ƒë·ªÅn tr∆∞·ªõc khi n√≥i v·ªÅ t√¨nh tr·∫°ng hi·ªán t·∫°i (c·∫ßn tr√πng tu). Tuy nhi√™n c√¢u A s√°t v·ªõi tr·∫≠t t·ª± t·ª´ v·ª±ng ƒë·ªÅ b√†i h∆°n.",
              "isCorrect": false
            },
            {
              "text": "The temple needs restoration which was built 1000 years ago.",
              "rationale": "Sai. 'Which' s·∫Ω b·ªï nghƒ©a cho 'restoration' -> sai nghƒ©a.",
              "isCorrect": false
            },
            {
              "text": "Which temple was built 1000 years ago needs the restoration.",
              "rationale": "Sai c·∫•u tr√∫c.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 10,
          "question": "Reorder: cheaper/ midnight/ arrives/ flight/ much/ at/ the/ is/ which/.",
          "hint": "Ch·ªß ng·ªØ 'The flight'. Chuy·∫øn bay ƒë√™m (arrives at midnight) th√¨ r·∫ª h∆°n.",
          "answerOptions": [
            {
              "text": "The flight which arrives at midnight is much cheaper.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The flight + which arrives at midnight) + V (is) + Adj (much cheaper).\n**D·ªãch:** Chuy·∫øn bay c√°i m√† ƒë·∫øn v√†o l√∫c n·ª≠a ƒë√™m th√¨ r·∫ª h∆°n nhi·ªÅu.",
              "isCorrect": true
            },
            {
              "text": "The flight is much cheaper which arrives at midnight.",
              "rationale": "Sai v·ªã tr√≠ m·ªánh ƒë·ªÅ quan h·ªá.",
              "isCorrect": false
            },
            {
              "text": "The flight which is much cheaper arrives at midnight.",
              "rationale": "C≈©ng ƒë√∫ng ng·ªØ ph√°p, nh∆∞ng c√¢u A ph·ªï bi·∫øn h∆°n khi so s√°nh gi√°.",
              "isCorrect": false
            },
            {
              "text": "Which flight arrives at midnight is the much cheaper.",
              "rationale": "Sai c·∫•u tr√∫c.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 11,
          "question": "Reorder: country/ expired/ enter/ whose/ tourists/ the/ passports/ cannot/.",
          "hint": "Ch·ªß ng·ªØ 'Tourists'. H·ªô chi·∫øu h·∫øt h·∫°n (whose passports expired). ƒê·ªông t·ª´ 'cannot enter'.",
          "answerOptions": [
            {
              "text": "Tourists whose passports expired cannot enter the country.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (Tourists + whose passports expired) + V (cannot enter) + O (the country).\n**D·ªãch:** Nh·ªØng du kh√°ch ng∆∞·ªùi m√† h·ªô chi·∫øu ƒë√£ h·∫øt h·∫°n kh√¥ng th·ªÉ nh·∫≠p c·∫£nh.",
              "isCorrect": true
            },
            {
              "text": "The tourists whose passports expired cannot enter country.",
              "rationale": "Thi·∫øu m·∫°o t·ª´ 'the' tr∆∞·ªõc 'country' (trong danh s√°ch t·ª´ ch·ªâ c√≥ 1 t·ª´ 'the', v√† th∆∞·ªùng d√πng l√† 'enter the country').",
              "isCorrect": false
            },
            {
              "text": "Tourists cannot enter the country whose passports expired.",
              "rationale": "Sai. 'Whose' s·∫Ω b·ªï nghƒ©a cho 'country' -> ƒë·∫•t n∆∞·ªõc c√≥ h·ªô chi·∫øu h·∫øt h·∫°n (v√¥ l√Ω).",
              "isCorrect": false
            },
            {
              "text": "Whose passports expired tourists cannot enter the country.",
              "rationale": "Sai tr·∫≠t t·ª±.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 12,
          "question": "Reorder: knowledgeable/ father/ guide/ was/ is/ the/ whose/ very/ historian/ a/.",
          "hint": "Ch·ªß ng·ªØ 'The guide'. C√≥ b·ªë l√† s·ª≠ gia (whose father was a historian).",
          "answerOptions": [
            {
              "text": "The guide whose father was a historian is very knowledgeable.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The guide + whose father was a historian) + V (is) + Adj (very knowledgeable).\n**D·ªãch:** Ng∆∞·ªùi h∆∞·ªõng d·∫´n vi√™n c√≥ cha l√† m·ªôt nh√† s·ª≠ h·ªçc r·∫•t uy√™n b√°c.",
              "isCorrect": true
            },
            {
              "text": "The guide whose father is very knowledgeable was a historian.",
              "rationale": "Ng·ªØ ph√°p ƒë√∫ng nh∆∞ng sai th√¨ (father 'was' a historian h·ª£p l√Ω h∆°n).",
              "isCorrect": false
            },
            {
              "text": "The guide is very knowledgeable whose father was a historian.",
              "rationale": "Sai v·ªã tr√≠ m·ªánh ƒë·ªÅ quan h·ªá.",
              "isCorrect": false
            },
            {
              "text": "A historian whose father was the guide is very knowledgeable.",
              "rationale": "ƒê·ªïi ch·ªß ng·ªØ, sai nghƒ©a g·ªëc.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 13,
          "question": "Reorder: immediately/ was/ travelers/ report/ luggage/ lost/ whose/ must/.",
          "hint": "Ch·ªß ng·ªØ 'Travelers'. H√†nh l√Ω b·ªã m·∫•t (whose luggage was lost).",
          "answerOptions": [
            {
              "text": "Travelers whose luggage was lost must report immediately.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (Travelers + whose luggage was lost) + V (must report) + Adv (immediately).\n**D·ªãch:** Nh·ªØng h√†nh kh√°ch b·ªã m·∫•t h√†nh l√Ω ph·∫£i b√°o c√°o ngay l·∫≠p t·ª©c.",
              "isCorrect": true
            },
            {
              "text": "Travelers must report immediately whose luggage was lost.",
              "rationale": "Sai v·ªã tr√≠ m·ªánh ƒë·ªÅ quan h·ªá.",
              "isCorrect": false
            },
            {
              "text": "Whose luggage was lost travelers must report immediately.",
              "rationale": "Sai tr·∫≠t t·ª±.",
              "isCorrect": false
            },
            {
              "text": "Travelers whose lost luggage was must report immediately.",
              "rationale": "Sai c·∫•u tr√∫c b·ªã ƒë·ªông.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 14,
          "question": "Reorder: Japan/ children/ tour/ family/ from/ whose/ the/ are/ joined/ our/.",
          "hint": "Ch·ªß ng·ªØ 'The family'. M·ªánh ƒë·ªÅ quan h·ªá n√≥i v·ªÅ con c√°i h·ªç (whose children...).",
          "answerOptions": [
            {
              "text": "The family whose children joined our tour are from Japan.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The family + whose children joined our tour) + V (are from) + Place (Japan).\n**D·ªãch:** Gia ƒë√¨nh m√† con c√°i c·ªßa h·ªç ƒë√£ tham gia tour c·ªßa ch√∫ng t√¥i ƒë·∫øn t·ª´ Nh·∫≠t B·∫£n. (L∆∞u √Ω: 'Family' c√≥ th·ªÉ chia s·ªë nhi·ªÅu n·∫øu √°m ch·ªâ c√°c th√†nh vi√™n).",
              "isCorrect": true
            },
            {
              "text": "The family whose children are from Japan joined our tour.",
              "rationale": "C≈©ng ƒë√∫ng ng·ªØ ph√°p. Tuy nhi√™n, ƒë√°p √°n A nghe t·ª± nhi√™n h∆°n khi gi·ªõi thi·ªáu xu·∫•t x·ª© c·ªßa gia ƒë√¨nh ƒë√≥.",
              "isCorrect": false
            },
            {
              "text": "The family joined our tour whose children are from Japan.",
              "rationale": "Sai v·ªã tr√≠ m·ªánh ƒë·ªÅ quan h·ªá.",
              "isCorrect": false
            },
            {
              "text": "Children from Japan whose family joined our tour are the.",
              "rationale": "Th·ª´a t·ª´ 'the' ·ªü cu·ªëi.",
              "isCorrect": false
            }
          ]
        },
        {
          "questionNumber": 15,
          "question": "Reorder: new/ invalid/ whose/ visitor/ must/ is/ the/ ticket/ one/ buy/ a/.",
          "hint": "Ch·ªß ng·ªØ 'The visitor'. V√© kh√¥ng h·ª£p l·ªá (whose ticket is invalid).",
          "answerOptions": [
            {
              "text": "The visitor whose ticket is invalid must buy a new one.",
              "rationale": "Ch√≠nh x√°c! **C·∫•u tr√∫c:** S (The visitor + whose ticket is invalid) + V (must buy) + O (a new one).\n**D·ªãch:** Du kh√°ch c√≥ v√© kh√¥ng h·ª£p l·ªá ph·∫£i mua m·ªôt c√°i m·ªõi.",
              "isCorrect": true
            },
            {
              "text": "The visitor must buy a new one whose ticket is invalid.",
              "rationale": "Sai. 'Whose' s·∫Ω b·ªï nghƒ©a cho 'one' (c√°i v√© m·ªõi) -> sai nghƒ©a.",
              "isCorrect": false
            },
            {
              "text": "The visitor whose ticket is new must buy an invalid one.",
              "rationale": "Sai nghƒ©a ho√†n to√†n.",
              "isCorrect": false
            },
            {
              "text": "Whose ticket is invalid the visitor must buy a new one.",
              "rationale": "Sai tr·∫≠t t·ª±.",
              "isCorrect": false
            }
          ]
        }
      ]
    };

    // --- GAME STATE ---
    let currentQuestionIndex = 0;
    let score = 0;
    let questions = [];

    // --- AUDIO SYSTEM (Base64 Sounds for Offline/Single File Reliability) ---
    // Simple Beep/Boop Synthesizer used for reliability instead of external links
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // High pitched Ding
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        } else {
            // Low pitched Buzz
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.4);
        }
    }

    // --- CONFETTI LOGIC ---
    function fireConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const pieces = [];
        const colors = ['#8854C0', '#00C9A7', '#00D26A', '#FF4757', '#FFD700'];

        for (let i = 0; i < 150; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                w: Math.random() * 10 + 5,
                h: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                dy: Math.random() * 5 + 2,
                dx: Math.random() * 4 - 2,
                rot: Math.random() * 360,
                drot: Math.random() * 10 - 5
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            pieces.forEach(p => {
                p.y += p.dy;
                p.x += p.dx;
                p.rot += p.drot;
                
                if (p.y < canvas.height) active = true;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rot * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
                ctx.restore();
            });

            if (active) requestAnimationFrame(draw);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        draw();
    }

    // --- INITIALIZATION ---
    function initGame() {
        // Shuffle questions
        questions = [...quizData.questions];
        shuffleArray(questions);
        
        currentQuestionIndex = 0;
        score = 0;
        renderQuestion();
        updateProgress();
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // --- RENDER LOGIC ---
    function renderQuestion() {
        const q = questions[currentQuestionIndex];
        
        // Reset UI
        document.getElementById('explanation-area').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('finish-btn').style.display = 'none';
        
        // Render content
        document.getElementById('question-content').innerHTML = `
            <span style="color:var(--primary-pink); margin-right:5px;">C√¢u ${currentQuestionIndex + 1}:</span> 
            ${q.question}
        `;
        document.getElementById('question-hint').innerText = "üí° G·ª£i √Ω: " + q.hint;

        // Shuffle Options (keep track of indices)
        let options = q.answerOptions.map((opt, idx) => ({...opt, originalIndex: idx}));
        shuffleArray(options);

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        const labels = ['A', 'B', 'C', 'D'];
        
        options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.onclick = () => checkAnswer(opt, btn, q, options);
            btn.innerHTML = `
                <div class="option-label">${labels[idx]}</div>
                <div>${opt.text}</div>
            `;
            optionsContainer.appendChild(btn);
        });
    }

    function updateProgress() {
        const pct = ((currentQuestionIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = pct + '%';
        document.getElementById('progress-text').innerText = `C√¢u ${currentQuestionIndex + 1}/${questions.length}`;
    }

    // --- CHECK ANSWER & EXPLANATION LOGIC (THE CORE) ---
    function checkAnswer(selectedOpt, btnElement, questionData, shuffledOptions) {
        // Disable all buttons
        const buttons = document.querySelectorAll('.option-btn');
        buttons.forEach(b => b.disabled = true);

        const isCorrect = selectedOpt.isCorrect;

        if (isCorrect) {
            score++;
            btnElement.classList.add('correct');
            playSound('correct');
            fireConfetti();
        } else {
            btnElement.classList.add('wrong');
            playSound('wrong');
            // Highlight correct answer
            buttons.forEach(b => {
                const txt = b.querySelector('div:last-child').innerText;
                const correctOpt = questionData.answerOptions.find(o => o.isCorrect);
                if (txt === correctOpt.text) {
                    b.classList.add('correct');
                }
            });
        }

        // Show Explanation
        showExplanation(selectedOpt, questionData, isCorrect);
        
        // Show Navigation
        if (currentQuestionIndex < questions.length - 1) {
            document.getElementById('next-btn').style.display = 'inline-block';
        } else {
            document.getElementById('finish-btn').style.display = 'inline-block';
        }
    }

    function showExplanation(selectedOpt, questionData, isCorrect) {
        const expArea = document.getElementById('explanation-area');
        const expContent = document.getElementById('explanation-content');
        
        // Find correct option info
        const correctOpt = questionData.answerOptions.find(o => o.isCorrect);

        // Build HTML for explanation
        let html = '';

        // 1. Translation of Question (Reordered sentence meaning)
        html += `<div class="exp-section">
            <span class="exp-label">üåê D·ªãch nghƒ©a c√¢u ho√†n ch·ªânh:</span>
            <em>"${extractTranslation(correctOpt.rationale)}"</em>
        </div>`;

        // 2. Analysis of the User's Choice (Why Right or Why Wrong)
        if (isCorrect) {
            html += `<div class="exp-section">
                <span class="exp-label" style="color:var(--correct-green)">‚úÖ T·∫°i sao b·∫°n ƒë√∫ng?</span>
                ${formatRationale(correctOpt.rationale)}
            </div>`;
        } else {
             html += `<div class="exp-section">
                <span class="exp-label" style="color:var(--wrong-red)">‚ùå T·∫°i sao c√¢u b·∫°n ch·ªçn sai?</span>
                ${selectedOpt.rationale}
            </div>
            <div class="exp-section">
                <span class="exp-label" style="color:var(--correct-green)">‚úÖ ƒê√°p √°n ƒë√∫ng l√†:</span>
                <b>${correctOpt.text}</b><br><br>
                ${formatRationale(correctOpt.rationale)}
            </div>`;
        }

        // 3. Vocab/Structure Analysis (Extracted from Correct Rationale)
        html += `<div class="exp-section">
            <span class="exp-label">üìö C·∫•u tr√∫c c·∫ßn nh·ªõ:</span>
            ${extractStructure(correctOpt.rationale)}
        </div>`;

        expContent.innerHTML = html;
        expArea.style.display = 'block';
    }

    // Helper to format the Markdown-like syntax in JSON to HTML
    function formatRationale(text) {
        // Remove "Ch√≠nh x√°c!", "Sai." etc if needed, or bold them
        let formatted = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold **text**
            .replace(/\n/g, '<br>');
        return formatted;
    }

    function extractTranslation(text) {
        // Simple regex to find text after "D·ªãch:" or similar markers
        const match = text.match(/D·ªãch:(.*)/);
        return match ? match[1].trim() : "Xem chi ti·∫øt b√™n d∆∞·ªõi.";
    }

    function extractStructure(text) {
         // Simple regex to find text after "C·∫•u tr√∫c:"
        const match = text.match(/C·∫•u tr√∫c:(.*?)(\n|$)/);
        return match ? match[1].trim() : "S + Verb + Object";
    }

    function nextQuestion() {
        currentQuestionIndex++;
        renderQuestion();
        updateProgress();
    }

    function showResults() {
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${questions.length}`;
        
        const pct = (score / questions.length) * 100;
        const title = document.getElementById('result-title');
        const msg = document.getElementById('result-message');

        if (pct === 100) {
            title.innerText = "Tuy·ªát ƒë·ªëi! üèÜ";
            msg.innerText = "B·∫°n l√† ng√¥i sao s√°ng nh·∫•t l·ªõp h·ªçc c·ªßa Ms Mai An h√¥m nay!";
            fireConfetti();
        } else if (pct >= 70) {
            title.innerText = "L√†m t·ªët l·∫Øm! üåü";
            msg.innerText = "B·∫°n n·∫Øm ch·∫Øc ki·∫øn th·ª©c, ch·ªâ c·∫ßn c·∫©n th·∫≠n h∆°n x√≠u th√¥i.";
        } else {
            title.innerText = "C·ªë g·∫Øng l√™n nh√©! üí™";
            msg.innerText = "H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch k·ªπ h∆°n ƒë·ªÉ l√†m t·ªët l·∫ßn sau.";
        }
    }

    // Start Game
    window.onload = initGame;

</script>

</body>
</html>
