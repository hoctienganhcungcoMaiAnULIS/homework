<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #fdf2f8;
            --card-shadow: 0 10px 0px rgba(0,0,0,0.1);
            --btn-shadow: 0 5px 0px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 1.5px, transparent 1.5px), radial-gradient(#00c9a7 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            border: 3px solid var(--primary-pink);
        }

        .header h1 {
            color: var(--primary-pink);
            font-weight: 800;
            margin: 0;
            font-size: 2.2rem;
            text-transform: uppercase;
        }

        .header p {
            color: #666;
            font-weight: 700;
            margin-top: 5px;
            font-size: 1.1rem;
        }

        .quiz-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            border: 2px solid #eee;
            position: relative;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .section-title {
            background-color: var(--primary-teal);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 700;
            margin-bottom: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* Reading Layout Styles */
        .reading-box {
            background: #f8f9fa;
            border: 2px dashed var(--primary-pink);
            padding: 20px;
            border-radius: 15px;
            line-height: 1.8;
            font-size: 1.1rem;
            margin-bottom: 20px;
            white-space: pre-line; /* Gi·ªØ nguy√™n xu·ªëng d√≤ng */
        }

        .gap-number {
            background: var(--primary-pink);
            color: white;
            padding: 2px 8px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.9rem;
            margin: 0 5px;
        }

        /* Glossary Table */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .glossary-table th {
            background: var(--primary-pink);
            color: white;
            padding: 10px;
        }
        
        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .glossary-title {
            font-weight: 800;
            color: var(--primary-pink);
            margin-top: 10px;
            display: block;
        }

        /* Question Layout */
        .question-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .question-item {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid transparent;
        }

        .question-text {
            font-weight: 700;
            margin-bottom: 10px;
            color: #444;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-option {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            color: #555;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #ddd;
            text-align: left;
        }

        .btn-option:hover:not(:disabled) {
            transform: scale(1.05);
            border-color: var(--primary-pink);
        }

        .btn-option:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #ddd;
        }

        .btn-option.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #009e4f;
        }

        .btn-option.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #e03e4d;
            box-shadow: 0 4px 0 #c23642;
        }

        /* Writing Section Input */
        .writing-input {
            width: 95%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            margin-bottom: 10px;
            outline: none;
        }
        
        .writing-input:focus {
            border-color: var(--primary-teal);
        }

        .btn-check-write {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #6a4196;
            transition: all 0.2s;
        }

        .btn-check-write:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Explanation Box */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 15px;
            background: #fff8e1;
            border-left: 5px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            animation: slideDown 0.3s ease-out;
        }

        .explanation.visible {
            display: block;
        }

        .teacher-avatar {
            font-weight: 800;
            color: var(--primary-pink);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .expl-step {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .expl-label {
            font-weight: bold;
            color: #444;
        }

        .expl-correct { color: var(--correct-green); font-weight: bold; }
        .expl-wrong { color: var(--wrong-red); font-weight: bold; }

        /* Animations */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .shake-element {
            animation: shake 0.4s ease-in-out;
        }

        /* Footer / Submit */
        .footer-controls {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .btn-submit {
            background: var(--primary-teal);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #009e82;
            transition: transform 0.2s;
        }

        .btn-submit:active {
            transform: translateY(8px);
            box-shadow: none;
        }

        /* Popup Score */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary-pink);
        }

        @keyframes popUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-teal);
            margin: 20px 0;
        }

    </style>
</head>
<body>

    <div class="header">
        <h1>B√†i Ki·ªÉm Tra Ti·∫øng Anh</h1>
        <p>Gi√°o vi√™n: Ms Mai An ULIS</p>
    </div>

    <div class="quiz-container" id="quiz-container">
        </div>

    <div class="footer-controls">
        <button class="btn-submit" onclick="finishQuiz()">N·ªôp B√†i & Xem ƒêi·ªÉm</button>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
            <div class="score-display" id="finalScore">0/0</div>
            <p id="feedbackText" style="font-size: 1.2rem; font-weight: 600;">B·∫°n l√†m t·ªët l·∫Øm!</p>
            <button class="btn-submit" style="font-size: 1rem; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const quizData = [
            {
                type: "reading",
                title: "IV. Reading A - Movie Trip Announcement",
                text: `Announcement
Dear students,
We are excited to invite you to a movie trip as part of our fun entertainment activities! This is a great chance to (1)______, enjoy a fantastic film, and spend time with friends.
üìÖ Date: Friday, March 15th
üïí Time: 3:00 PM ‚Äì 6:00 PM
üìç Venue: City Cinema
üé¨ Movie: The Adventures of Tom and Jerry
üëâ Why join?
Watch (2)______ .
Have a wonderful experience with classmates.
Enjoy delicious snacks and a fun time together.
üì¢ Important notes:
Please (3) ______ 15 minutes early to get your tickets.
The cinema is very crowded, so you should (4)______ your seats in advance.`,
                glossary: [
                    { word: "Announcement", type: "n", meaning: "Th√¥ng b√°o" },
                    { word: "Entertainment", type: "n", meaning: "S·ª± gi·∫£i tr√≠" },
                    { word: "Venue", type: "n", meaning: "ƒê·ªãa ƒëi·ªÉm" },
                    { word: "Crowded", type: "adj", meaning: "ƒê√¥ng ƒë√∫c" },
                    { word: "In advance", type: "adv", meaning: "Tr∆∞·ªõc" }
                ],
                questions: [
                    {
                        id: "A1", num: 1, 
                        options: ["relax", "relaxing", "relaxed", "relaxes"],
                        correct: 0,
                        expl: {
                            q_trans: "ƒê√¢y l√† c∆° h·ªôi tuy·ªát v·ªùi ƒë·ªÉ (1) th∆∞ gi√£n, t·∫≠n h∆∞·ªüng b·ªô phim...",
                            opts: ["A. relax (v): th∆∞ gi√£n", "B. relaxing (V-ing)", "C. relaxed (V-ed/adj)", "D. relaxes (V-s)"],
                            why_correct: "C·∫•u tr√∫c 'chance + to V' (c∆° h·ªôi ƒë·ªÉ l√†m g√¨). Sau 'to' ta d√πng ƒë·ªông t·ª´ nguy√™n th·ªÉ.",
                            why_wrong: "C√°c ƒë√°p √°n B, C, D ƒë·ªÅu chia ƒëu√¥i sai ng·ªØ ph√°p."
                        }
                    },
                    {
                        id: "A2", num: 2, 
                        options: ["a interesting movie", "an interesting movie", "a interesting movies", "an interesting movies"],
                        correct: 1,
                        expl: {
                            q_trans: "Xem (2) m·ªôt b·ªô phim th√∫ v·ªã.",
                            opts: ["A. sai m·∫°o t·ª´", "B. m·ªôt b·ªô phim th√∫ v·ªã", "C. sai ng·ªØ ph√°p (a + s·ªë nhi·ªÅu)", "D. sai ng·ªØ ph√°p (an + s·ªë nhi·ªÅu)"],
                            why_correct: "T√≠nh t·ª´ 'interesting' b·∫Øt ƒë·∫ßu b·∫±ng nguy√™n √¢m /…™/ n√™n d√πng m·∫°o t·ª´ 'an'. 'Movie' ·ªü ƒë√¢y l√† danh t·ª´ ƒë·∫øm ƒë∆∞·ª£c s·ªë √≠t.",
                            why_wrong: "A sai v√¨ d√πng 'a' tr∆∞·ªõc nguy√™n √¢m. C, D sai v√¨ 'movies' s·ªë nhi·ªÅu kh√¥ng d√πng a/an."
                        }
                    },
                    {
                        id: "A3", num: 3, 
                        options: ["arriving", "arrived", "to arrive", "arrive"],
                        correct: 3,
                        expl: {
                            q_trans: "L√†m ∆°n (3) ƒë·∫øn s·ªõm 15 ph√∫t...",
                            opts: ["A. V-ing", "B. V-ed", "C. To V", "D. Arrive (V-inf): ƒë·∫øn"],
                            why_correct: "ƒê√¢y l√† c√¢u m·ªánh l·ªánh (Imperative sentence) b·∫Øt ƒë·∫ßu b·∫±ng 'Please' + ƒê·ªông t·ª´ nguy√™n th·ªÉ.",
                            why_wrong: "Kh√¥ng d√πng V-ing hay To V sau Please trong c√¢u m·ªánh l·ªánh."
                        }
                    },
                    {
                        id: "A4", num: 4, 
                        options: ["book", "booking", "to booking", "booked"],
                        correct: 0,
                        expl: {
                            q_trans: "...v√¨ v·∫≠y b·∫°n n√™n (4) ƒë·∫∑t ch·ªó tr∆∞·ªõc.",
                            opts: ["A. book (v): ƒë·∫∑t v√©", "B. V-ing", "C. sai c·∫•u tr√∫c", "D. V-ed"],
                            why_correct: "Sau ƒë·ªông t·ª´ khuy·∫øt thi·∫øu 'should' (n√™n) lu√¥n l√† ƒë·ªông t·ª´ nguy√™n th·ªÉ (V-inf).",
                            why_wrong: "B, C, D sai d·∫°ng ƒë·ªông t·ª´."
                        }
                    }
                ]
            },
            {
                type: "reading",
                title: "IV. Reading B - Mid-Autumn Festival Announcement",
                text: `Announcement
Dear students,
Join us for the Mid-Autumn Festival to enjoy lanterns, mooncakes, and performances while celebrating our culture!
üìÖ Date: Friday, September 20th
üïí Time: 6:30 PM ‚Äì 9:00 PM
üìç Venue: School Yard
üé≠ Activities: Lantern parade, lion dance, storytelling, and games
‚ú® How to register?
Students who want to join should (1)______ their names with their class monitors before September 15th.
Each participant will receive (2)______ small gift.
The event will be held (3)______ the school yard, so please arrive on time.
Remember to bring (4)______ for the parade.
For more details, please contact your English teacher or class monitor. We look forward to seeing you there!
üéâ Let's celebrate the festival together! üéâ
School Events Committee`,
                glossary: [
                    { word: "Lantern", type: "n", meaning: "ƒê√®n l·ªìng" },
                    { word: "Parade", type: "n", meaning: "Cu·ªôc di·ªÖu h√†nh" },
                    { word: "Register", type: "v", meaning: "ƒêƒÉng k√Ω" },
                    { word: "Participant", type: "n", meaning: "Ng∆∞·ªùi tham gia" },
                    { word: "Monitor", type: "n", meaning: "L·ªõp tr∆∞·ªüng" }
                ],
                questions: [
                    {
                        id: "B1", num: 1, 
                        options: ["register", "registers", "registering", "registered"],
                        correct: 0,
                        expl: {
                            q_trans: "H·ªçc sinh mu·ªën tham gia n√™n (1) ƒëƒÉng k√Ω t√™n...",
                            opts: ["A. register (v): ƒëƒÉng k√Ω", "B. V-s", "C. V-ing", "D. V-ed"],
                            why_correct: "Sau 'should' l√† ƒë·ªông t·ª´ nguy√™n th·ªÉ (V-inf).",
                            why_wrong: "C√°c d·∫°ng chia ƒë·ªông t·ª´ kh√°c ƒë·ªÅu sai sau modal verb."
                        }
                    },
                    {
                        id: "B2", num: 2, 
                        options: ["a", "an", "the", "no article"],
                        correct: 0,
                        expl: {
                            q_trans: "M·ªói ng∆∞·ªùi tham gia s·∫Ω nh·∫≠n (2) m·ªôt m√≥n qu√† nh·ªè.",
                            opts: ["A. m·ªôt (tr∆∞·ªõc ph·ª• √¢m)", "B. m·ªôt (tr∆∞·ªõc nguy√™n √¢m)", "C. x√°c ƒë·ªãnh", "D. kh√¥ng m·∫°o t·ª´"],
                            why_correct: "'small' b·∫Øt ƒë·∫ßu b·∫±ng ph·ª• √¢m /s/ n√™n d√πng 'a'. ƒê√¢y l√† l·∫ßn ƒë·∫ßu nh·∫Øc ƒë·∫øn m√≥n qu√† (ch∆∞a x√°c ƒë·ªãnh).",
                            why_wrong: "B sai v√¨ 's' l√† ph·ª• √¢m. C kh√¥ng d√πng v√¨ ch∆∞a x√°c ƒë·ªãnh."
                        }
                    },
                    {
                        id: "B3", num: 3, 
                        options: ["on", "in", "between", "above"],
                        correct: 1,
                        expl: {
                            q_trans: "S·ª± ki·ªán s·∫Ω ƒë∆∞·ª£c t·ªï ch·ª©c (3) trong s√¢n tr∆∞·ªùng...",
                            opts: ["A. tr√™n", "B. trong/t·∫°i", "C. gi·ªØa", "D. ph√≠a tr√™n"],
                            why_correct: "C·ª•m t·ª´ ch·ªâ ƒë·ªãa ƒëi·ªÉm: 'in the school yard' (trong s√¢n tr∆∞·ªùng).",
                            why_wrong: "'On' th∆∞·ªùng d√πng cho b·ªÅ m·∫∑t (on the table), nh∆∞ng s√¢n tr∆∞·ªùng l√† kh√¥ng gian bao quanh n√™n d√πng 'in' ph·ªï bi·∫øn h∆°n trong ng·ªØ c·∫£nh n√†y (ho·∫∑c 'at'). Trong 4 ƒë√°p √°n, 'in' h·ª£p l√Ω nh·∫•t."
                        }
                    },
                    {
                        id: "B4", num: 4, 
                        options: ["your lantern", "my lantern", "her lantern", "their lantern"],
                        correct: 0,
                        expl: {
                            q_trans: "Nh·ªõ mang theo (4) ƒë√®n l·ªìng c·ªßa b·∫°n...",
                            opts: ["A. c·ªßa b·∫°n", "B. c·ªßa t√¥i", "C. c·ªßa c√¥ ·∫•y", "D. c·ªßa h·ªç"],
                            why_correct: "Th√¥ng b√°o ƒëang n√≥i tr·ª±c ti·∫øp v·ªõi h·ªçc sinh ('Dear students', 'you'), n√™n d√πng t√≠nh t·ª´ s·ªü h·ªØu 'your'.",
                            why_wrong: "Sai ng√¥i giao ti·∫øp."
                        }
                    }
                ]
            },
            {
                type: "writing",
                title: "D.I. Rearrange the words",
                questions: [
                    {
                        q: "Do/ you/ have/ your/ a/ festival/ harvest/ in/ country/ ?",
                        ans: "Do you have a harvest festival in your country?",
                        expl: "C·∫•u tr√∫c c√¢u h·ªèi Yes/No th√¨ hi·ªán t·∫°i ƒë∆°n: Do + S + V + O + Place?"
                    },
                    {
                        q: "their/ put/ pumpkin/ lanterns/ outside/ homes/ They/ ?",
                        ans: "Do they put pumpkin lanterns outside their homes?",
                        expl: "C√¢u h·ªèi (c√≥ d·∫•u ? ·ªü ƒë·ªÅ b√†i): Do + S + V + O + Place?"
                    },
                    {
                        q: "from/ Hien‚Äôs/ house/ is/ far/ it/ to the bakery/ How/ ?",
                        ans: "How far is it from Hien‚Äôs house to the bakery?",
                        expl: "C·∫•u tr√∫c h·ªèi kho·∫£ng c√°ch: How far is it from [Place A] to [Place B]?"
                    },
                    {
                        q: "you/ How/ do/ go/ school/ to/ every morning/ ?",
                        ans: "How do you go to school every morning?",
                        expl: "H·ªèi ph∆∞∆°ng ti·ªán: How + do + S + go to...?"
                    },
                    {
                        q: "this/ can‚Äôt/ in/ fast/ You/ drive/ area/.",
                        ans: "You can‚Äôt drive fast in this area.",
                        expl: "C√¢u m·ªánh l·ªánh/c·∫•m ƒëo√°n v·ªõi modal verb: S + can't + V + adv + place."
                    },
                    {
                        q: "is/ horror/ ‚ÄúA Nightmare‚Äù/ film/ a/.",
                        ans: "‚ÄúA Nightmare‚Äù is a horror film.",
                        expl: "C√¢u gi·ªõi thi·ªáu: Subject + to be + a/an + Adj + Noun."
                    },
                    {
                        q: "and producer/ He/ the/is/ main actor/ the/ of/ film/.",
                        ans: "He is the main actor and producer of the film.",
                        expl: "Gi·ªõi thi·ªáu ch·ª©c danh: S + be + Noun Phrase."
                    },
                    {
                        q: "want/ I/ to/ a/ watch/ film,/ but/ don‚Äôt/ I/ want/ go/ the/ to/ cinema/.",
                        ans: "I want to watch a film, but I don‚Äôt want to go to the cinema.",
                        expl: "C√¢u gh√©p v·ªõi li√™n t·ª´ 'but'. Want + to V."
                    }
                ]
            },
            {
                type: "writing",
                title: "D.II. Make correct sentences",
                questions: [
                    {
                        q: "My favourite/ kind/ of/ film/ action film/.",
                        ans: "My favourite kind of film is action film.",
                        expl: "Th√™m ƒë·ªông t·ª´ 'is' ƒë·ªÉ li√™n k·∫øt ch·ªß ng·ªØ v√† v·ªã ng·ªØ."
                    },
                    {
                        q: "It/ about/ 5 km/ my village/ nearest town/.",
                        ans: "It is about 5 km from my village to the nearest town.",
                        expl: "C·∫•u tr√∫c kho·∫£ng c√°ch: It is + distance + from A to B."
                    },
                    {
                        q: "they/ hold/ the festival/ every year/?",
                        ans: "Do they hold the festival every year?",
                        expl: "C√¢u h·ªèi th√¨ hi·ªán t·∫°i ƒë∆°n v·ªõi 'they' -> M∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ 'Do'."
                    },
                    {
                        q: "My friends/ and/ I / usually/ go/ school/ foot/.",
                        ans: "My friends and I usually go to school on foot.",
                        expl: "C·ª•m t·ª´ ch·ªâ ph∆∞∆°ng ti·ªán: 'on foot' (ƒëi b·ªô)."
                    },
                    {
                        q: "We/ go /Flower Festival/ Da Lat/ last year/.",
                        ans: "We went to the Flower Festival in Da Lat last year.",
                        expl: "Qu√° kh·ª© ƒë∆°n (last year) -> go th√†nh went. Th√™m gi·ªõi t·ª´ 'to' (ƒëi ƒë·∫øn ƒë√¢u) v√† 'in' (t·∫°i ƒê√† L·∫°t)."
                    },
                    {
                        q: "the Perfume Pagoda Festival/ Viet Nam/ take place/ January/?",
                        ans: "Does the Perfume Pagoda Festival in Viet Nam take place in January?",
                        expl: "C√¢u h·ªèi hi·ªán t·∫°i ƒë∆°n, ch·ªß ng·ªØ s·ªë √≠t -> Tr·ª£ ƒë·ªông t·ª´ 'Does'. Th√™m gi·ªõi t·ª´ 'in'."
                    },
                    {
                        q: "How long/ it/ take/ go/ Ha Noi/ Dien Bien/ plane/?",
                        ans: "How long does it take to go from Ha Noi to Dien Bien by plane?",
                        expl: "C·∫•u tr√∫c: How long does it take to V...?"
                    },
                    {
                        q: "About/ 60,000 people/ attend/ this festival/ last year/.",
                        ans: "About 60,000 people attended this festival last year.",
                        expl: "Qu√° kh·ª© ƒë∆°n (last year) -> attend th√™m 'ed'."
                    }
                ]
            },
            {
                type: "writing",
                title: "D.III. Rewrite sentences",
                questions: [
                    {
                        q: "The distance from Ha Noi to Hue City is about 540 km. (It)",
                        ans: "It is about 540 km from Ha Noi to Hue City.",
                        expl: "D√πng ch·ªß ng·ªØ gi·∫£ 'It' ch·ªâ kho·∫£ng c√°ch."
                    },
                    {
                        q: "What is the distance between your house and your school? (How)",
                        ans: "How far is it from your house to your school?",
                        expl: "Chuy·ªÉn t·ª´ 'What is the distance' sang 'How far is it'."
                    },
                    {
                        q: "Some people said the film was terrible. I found it quite gripping. (Although)",
                        ans: "Although some people said the film was terrible, I found it quite gripping.",
                        expl: "M·ªánh ƒë·ªÅ nh∆∞·ª£ng b·ªô v·ªõi 'Although' + S + V."
                    },
                    {
                        q: "It was a horror film. It wasn‚Äôt frightening at all. (however)",
                        ans: "It was a horror film; however, it wasn‚Äôt frightening at all.",
                        expl: "Li√™n t·ª´ 'however' ƒë·ª©ng sau d·∫•u ch·∫•m ph·∫©y ho·∫∑c d·∫•u ch·∫•m ƒë·ªÉ n·ªëi 2 √Ω t∆∞∆°ng ph·∫£n."
                    },
                    {
                        q: "Take part in the event this time, or you‚Äôll have to wait for next year. (If)",
                        ans: "If you don't take part in the event this time, you‚Äôll have to wait for next year.",
                        expl: "C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1: If + S + V(hi·ªán t·∫°i), S + will + V."
                    },
                    {
                        q: "Why don‚Äôt we go out for dinner? (Let)",
                        ans: "Let's go out for dinner.",
                        expl: "ƒê·ªÅ ngh·ªã: Why don't we + V = Let's + V."
                    },
                    {
                        q: "The weather was bad. However, we had a wonderful holiday. (but)",
                        ans: "The weather was bad, but we had a wonderful holiday.",
                        expl: "N·ªëi 2 c√¢u b·∫±ng 'but'."
                    },
                    {
                        q: "It's not a good for you to stay up too late. (shouldn‚Äôt)",
                        ans: "You shouldn‚Äôt stay up too late.",
                        expl: "Khuy√™n b·∫£o: should/shouldn't + V."
                    }
                ]
            }
        ];

        // --- SOUNDS ---
        // Using generic accessible sounds
        const soundCorrect = new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav'); // High pitch ping
        const soundWrong = new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/player_shoot.wav'); // Low pitch thud

        // --- RENDER LOGIC ---
        const container = document.getElementById('quiz-container');

        quizData.forEach((section, sIndex) => {
            const card = document.createElement('div');
            card.className = 'card';

            let html = `<div class="section-title">${section.title}</div>`;

            // Render Reading Text if exists
            if (section.text) {
                html += `<div class="reading-box">${section.text}</div>`;
                
                // Glossary
                if(section.glossary) {
                    html += `<span class="glossary-title">üìö Glossary (T·ª´ v·ª±ng n√¢ng cao):</span>
                             <table class="glossary-table">
                                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>`;
                    section.glossary.forEach(g => {
                        html += `<tr><td>${g.word}</td><td><em>${g.type}</em></td><td>${g.meaning}</td></tr>`;
                    });
                    html += `</table><hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">`;
                }

                // Reading Multiple Choice Questions
                html += `<div class="question-group">`;
                section.questions.forEach((q, qIndex) => {
                    html += `
                        <div class="question-item" id="q-${sIndex}-${qIndex}">
                            <div class="question-text">Question ${q.num}:</div>
                            <div class="options-grid">
                                ${q.options.map((opt, oIndex) => `
                                    <button class="btn-option" onclick="checkMCAnswer(${sIndex}, ${qIndex}, ${oIndex}, this)">
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            <div class="explanation" id="expl-${sIndex}-${qIndex}">
                                <div class="teacher-avatar">üë©‚Äçüè´ Ms. Mai An gi·∫£i th√≠ch:</div>
                                <div class="expl-step"><span class="expl-label">D·ªãch:</span> ${q.expl.q_trans}</div>
                                <div class="expl-step"><span class="expl-label">ƒê√°p √°n:</span><br> ${q.expl.opts.join('<br>')}</div>
                                <div class="expl-step expl-correct">‚úÖ T·∫°i sao ƒë√∫ng: ${q.expl.why_correct}</div>
                                <div class="expl-step expl-wrong">‚ùå T·∫°i sao sai: ${q.expl.why_wrong}</div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            } 
            // Render Writing Questions
            else if (section.type === "writing") {
                html += `<div class="question-group">`;
                section.questions.forEach((q, qIndex) => {
                    html += `
                        <div class="question-item">
                            <div class="question-text" style="color: var(--primary-pink);">${q.q}</div>
                            <input type="text" class="writing-input" id="write-input-${sIndex}-${qIndex}" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi c·ªßa b·∫°n v√†o ƒë√¢y...">
                            <button class="btn-check-write" onclick="checkWriting(${sIndex}, ${qIndex})">Ki·ªÉm tra</button>
                            
                            <div class="explanation" id="expl-write-${sIndex}-${qIndex}">
                                <div class="teacher-avatar">üë©‚Äçüè´ Ms. Mai An ch·∫•m b√†i:</div>
                                <div class="expl-step"><span class="expl-label" style="color:var(--correct-green)">ƒê√°p √°n m·∫´u:</span> <strong>${q.ans}</strong></div>
                                <div class="expl-step">üí° <span class="expl-label">Gi·∫£i th√≠ch:</span> ${q.expl}</div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            card.innerHTML = html;
            container.appendChild(card);
        });

        // --- INTERACTION FUNCTIONS ---

        let correctCount = 0;
        let totalQuestions = 0;
        // Calculate total questions
        quizData.forEach(s => {
            if(s.questions) totalQuestions += s.questions.length;
        });

        function checkMCAnswer(sIndex, qIndex, oIndex, btn) {
            const q = quizData[sIndex].questions[qIndex];
            const parent = document.getElementById(`q-${sIndex}-${qIndex}`);
            const buttons = parent.querySelectorAll('.btn-option');
            const expl = document.getElementById(`expl-${sIndex}-${qIndex}`);

            // Disable clicks after first selection
            buttons.forEach(b => {
                b.disabled = true;
                b.style.cursor = "default";
            });

            if (oIndex === q.correct) {
                // Correct
                btn.classList.add('correct');
                soundCorrect.play();
                confetti({
                    particleCount: 50,
                    spread: 60,
                    origin: { y: 0.6 }
                });
                correctCount++;
            } else {
                // Wrong
                btn.classList.add('wrong');
                // Highlight correct answer
                buttons[q.correct].classList.add('correct');
                soundWrong.play();
                parent.classList.add('shake-element');
            }

            // Show explanation immediately
            expl.classList.add('visible');
        }

        function checkWriting(sIndex, qIndex) {
            const input = document.getElementById(`write-input-${sIndex}-${qIndex}`);
            const expl = document.getElementById(`expl-write-${sIndex}-${qIndex}`);
            const q = quizData[sIndex].questions[qIndex];

            // Normalize strings for rough comparison (remove case and extra spaces)
            const userAns = input.value.trim().toLowerCase().replace(/\s+/g, ' ').replace(/[.,?!]/g, '');
            const correctAns = q.ans.trim().toLowerCase().replace(/\s+/g, ' ').replace(/[.,?!]/g, '');

            if (userAns === correctAns) {
                soundCorrect.play();
                confetti({ particleCount: 30, spread: 50 });
                input.style.borderColor = "var(--correct-green)";
                input.style.backgroundColor = "#e8f5e9";
                correctCount++; // Simple scoring for writing
            } else {
                soundWrong.play();
                input.style.borderColor = "var(--wrong-red)";
                input.style.backgroundColor = "#ffebee";
            }

            expl.classList.add('visible');
        }

        function finishQuiz() {
            const modal = document.getElementById('resultModal');
            const scoreText = document.getElementById('finalScore');
            const feedback = document.getElementById('feedbackText');

            scoreText.innerText = `${correctCount}/${totalQuestions}`;
            
            const percentage = (correctCount / totalQuestions) * 100;
            if (percentage === 100) feedback.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ti·∫øng Anh! üåü";
            else if (percentage >= 80) feedback.innerText = "Gi·ªèi l·∫Øm! Ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i. üéâ";
            else if (percentage >= 50) feedback.innerText = "C·ªë g·∫Øng l√™n! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©. üí™";
            else feedback.innerText = "ƒê·ª´ng bu·ªìn! C√¥ Mai An ƒë√£ gi·∫£i th√≠ch chi ti·∫øt, h√£y √¥n t·∫≠p l·∫°i nha! üìö";

            modal.style.display = "flex";
            
            // Big Confetti
            var duration = 3000;
            var end = Date.now() + duration;

            (function frame() {
            var timeLeft = end - Date.now();
            if (timeLeft <= 0) return;
            confetti({
                particleCount: 5,
                angle: 60,
                spread: 55,
                origin: { x: 0 }
            });
            confetti({
                particleCount: 5,
                angle: 120,
                spread: 55,
                origin: { x: 1 }
            });
            requestAnimationFrame(frame);
            }());
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = "none";
        }

    </script>
</body>
</html>
