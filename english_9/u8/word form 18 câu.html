<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise 7: Word Formation Practice - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m Pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --accent: #FF9F43; /* Cam */
            --success: #00D26A; /* Xanh l√° */
            --error: #FF4757; /* ƒê·ªè */
            --text: #2d3436;
            --bg-color: #f0f3f5;
            --card-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none; /* Ch·ªëng b√¥i ƒëen ƒë·ªÉ ch∆°i game m∆∞·ª£t h∆°n */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--primary) 1px, transparent 1px), radial-gradient(var(--secondary) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border: 4px solid #fff;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), #a29bfe);
            padding: 20px;
            text-align: center;
            color: white;
            position: relative;
        }

        .header h1 {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            margin-bottom: 5px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.3);
            height: 10px;
            border-radius: 5px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s ease;
        }

        .score-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 800;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .question-box {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 30px;
            line-height: 1.6;
            text-align: left;
        }

        .highlight-word {
            color: var(--primary);
            border-bottom: 3px dashed var(--secondary);
            display: inline-block;
            padding: 0 5px;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .question-box {
                font-size: 1.2rem;
            }
        }

        .btn-option {
            background: white;
            border: 2px solid #dfe6e9;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: #636e72;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 6px 0 #dfe6e9; /* 3D effect */
            position: relative;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-option:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #dfe6e9;
        }

        .btn-option.correct {
            background-color: var(--success);
            color: white;
            border-color: #00b894;
            box-shadow: 0 6px 0 #00b894;
        }

        .btn-option.wrong {
            background-color: var(--error);
            color: white;
            border-color: #d63031;
            box-shadow: 0 6px 0 #d63031;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .option-letter {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 30px;
            height: 30px;
            background: rgba(0,0,0,0.05);
            border-radius: 50%;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        /* Explanation Box */
        .explanation-area {
            margin-top: 30px;
            background: #f8f9fa;
            border-left: 5px solid var(--secondary);
            border-radius: 8px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exp-header {
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin-bottom: 10px;
            line-height: 1.5;
            color: #4b6584;
        }
        
        .exp-section-title {
            font-weight: 700;
            color: #2d3436;
            margin-top: 10px;
            text-decoration: underline;
            text-decoration-color: var(--secondary);
        }

        .vocab-list {
            list-style: none;
            margin: 10px 0;
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed #ccc;
        }

        .vocab-list li {
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .vocab-tag {
            background: #dfe6e9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 5px;
            color: #636e72;
        }

        /* Controls */
        .controls {
            margin-top: 20px;
            text-align: right;
            height: 50px; /* Placeholder height */
        }

        .btn-next {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #5f27cd;
            transition: all 0.2s;
            display: none; /* Hidden initially */
        }

        .btn-next:hover {
            transform: translateY(-2px);
            background: #9b59b6;
        }

        .btn-next:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* End Screen */
        .end-screen {
            text-align: center;
            display: none;
            padding: 40px 20px;
        }

        .end-score {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        .end-message {
            font-size: 1.5rem;
            color: #636e72;
            margin-bottom: 30px;
        }

        .btn-restart {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #10ac84;
        }

        .btn-restart:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

<div class="game-container">
    <div class="header">
        <h1>B√ÄI T·∫¨P WORD FORMATION</h1>
        <p>Gi√°o vi√™n: Ms. Mai An ULIS</p>
        <div class="score-badge">ƒêi·ªÉm: <span id="score-val">0</span></div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
    </div>

    <div class="content" id="quiz-content">
        <!-- Question Area -->
        <div class="question-box" id="question-text">
            Loading...
        </div>

        <!-- Options -->
        <div class="options-grid" id="options-container">
            <!-- Buttons generated by JS -->
        </div>

        <!-- Explanation Area -->
        <div class="explanation-area" id="explanation-box">
            <div class="exp-header">
                <span>üí° Gi·∫£i th√≠ch chi ti·∫øt t·ª´ c√¥ Mai An</span>
            </div>
            <div class="exp-content" id="explanation-content">
                <!-- Content injected by JS -->
            </div>
        </div>

        <!-- Navigation -->
        <div class="controls">
            <button class="btn-next" id="btn-next" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
        </div>
    </div>

    <!-- End Screen -->
    <div class="end-screen" id="end-screen">
        <h2>üéâ CH√öC M·ª™NG B·∫†N ƒê√É HO√ÄN TH√ÄNH! üéâ</h2>
        <div class="end-score" id="final-score">0/0</div>
        <p class="end-message" id="end-message">B·∫°n l√†m r·∫•t t·ªët!</p>
        <button class="btn-restart" onclick="location.reload()">L√†m l·∫°i b√†i thi ‚ü≥</button>
    </div>
</div>

<canvas id="confetti-canvas"></canvas>

<script>
    /* D·ªÆ LI·ªÜU C√ÇU H·ªéI */
    const rawQuestions = [
        {
            q: "These tours usually combine jungle trekking and cave ___________________. (explore)",
            a: "exploration",
            options: ["exploration", "explorer", "exploratory", "exploring"],
            trans: "Nh·ªØng tour n√†y th∆∞·ªùng k·∫øt h·ª£p ƒëi b·ªô trong r·ª´ng v√† th√°m hi·ªÉm hang ƒë·ªông.",
            vocab: [
                {w: "exploration", t: "n", m: "s·ª± th√°m hi·ªÉm"},
                {w: "explorer", t: "n", m: "nh√† th√°m hi·ªÉm (ch·ªâ ng∆∞·ªùi)"},
                {w: "exploratory", t: "adj", m: "c√≥ t√≠nh th√°m hi·ªÉm"},
                {w: "exploring", t: "gerund", m: "vi·ªác kh√°m ph√° (√≠t d√πng trong c·ª•m danh t·ª´ c·ªë ƒë·ªãnh n√†y)"}
            ],
            whyCorrect: "C·∫•u tr√∫c song h√†nh (Parallelism): 'jungle trekking' l√† c·ª•m danh t·ª´, n√™n sau 'and' c≈©ng c·∫ßn m·ªôt danh t·ª´ ƒë·ªÉ ƒëi v·ªõi 'cave'. 'Cave exploration' l√† m·ªôt collocation (c·ª•m t·ª´ c·ªë ƒë·ªãnh).",
            whyWrong: "'Explorer' ch·ªâ ng∆∞·ªùi, kh√¥ng h·ª£p nghƒ©a. T√≠nh t·ª´ 'Exploratory' kh√¥ng th·ªÉ ƒë·ª©ng cu·ªëi l√†m t√¢n ng·ªØ."
        },
        {
            q: "They‚Äôre looking for a travel ___________________ to take care of their trip to Africa. (agent)",
            a: "agency",
            options: ["agency", "agent", "agents", "acting"],
            trans: "H·ªç ƒëang t√¨m m·ªôt ƒë·∫°i l√Ω du l·ªãch ƒë·ªÉ lo li·ªáu chuy·∫øn ƒëi ƒë·∫øn Ch√¢u Phi c·ªßa h·ªç.",
            vocab: [
                {w: "agency", t: "n", m: "ƒë·∫°i l√Ω, c∆° quan, vƒÉn ph√≤ng"},
                {w: "agent", t: "n", m: "nh√¢n vi√™n ƒë·∫°i l√Ω, ƒëi·ªáp vi√™n"},
                {w: "agents", t: "n", m: "nhi·ªÅu nh√¢n vi√™n"},
                {w: "acting", t: "n/adj", m: "di·ªÖn xu·∫•t / quy·ªÅn (gi√°m ƒë·ªëc)"}
            ],
            whyCorrect: "'Travel agency' l√† vƒÉn ph√≤ng/ƒë·∫°i l√Ω du l·ªãch (t·ªï ch·ª©c). Trong b√†i t·∫≠p Word Form, n·∫øu t·ª´ g·ªëc l√† 'agent', ƒë√°p √°n th∆∞·ªùng bi·∫øn ƒë·ªïi th√†nh 'agency'.",
            whyWrong: "'Travel agent' (ng∆∞·ªùi) c≈©ng c√≥ nghƒ©a, nh∆∞ng ng·ªØ c·∫£nh 'looking for a... to take care' th∆∞·ªùng √°m ch·ªâ t√¨m m·ªôt ƒë∆°n v·ªã d·ªãch v·ª• (agency) h∆°n l√† m·ªôt c√° nh√¢n, v√† quan tr·ªçng l√† b√†i t·∫≠p y√™u c·∫ßu bi·∫øn ƒë·ªïi t·ª´ g·ªëc (agent -> agency)."
        },
        {
            q: "Spending the summer holidays in the UK isn‚Äôt very ___________________ as it often rains a lot. (appeal)",
            a: "appealing",
            options: ["appealing", "appeal", "appealed", "appealingly"],
            trans: "D√†nh k·ª≥ ngh·ªâ h√® ·ªü Anh th√¨ kh√¥ng h·∫•p d·∫´n l·∫Øm v√¨ tr·ªùi th∆∞·ªùng m∆∞a nhi·ªÅu.",
            vocab: [
                {w: "appealing", t: "adj", m: "h·∫•p d·∫´n, l√¥i cu·ªën"},
                {w: "appeal", t: "v/n", m: "k√™u g·ªçi / s·ª± h·∫•p d·∫´n"},
                {w: "appealed", t: "v-ed", m: "ƒë√£ k√™u g·ªçi"},
                {w: "appealingly", t: "adv", m: "m·ªôt c√°ch h·∫•p d·∫´n"}
            ],
            whyCorrect: "Sau ƒë·ªông t·ª´ to be 'isn't' v√† tr·∫°ng t·ª´ ch·ªâ m·ª©c ƒë·ªô 'very', ta c·∫ßn m·ªôt T√≠nh t·ª´ (Adjective) ƒë·ªÉ ch·ªâ t√≠nh ch·∫•t c·ªßa vi·ªác ngh·ªâ h√®.",
            whyWrong: "C√°c t·ª´ lo·∫°i kh√°c kh√¥ng ph√π h·ª£p v·ªã tr√≠ ng·ªØ ph√°p sau 'be very'."
        },
        {
            q: "The guest house was on the side of the cliff, with ___________________ views of the ocean below. (breath)",
            a: "breathtaking",
            options: ["breathtaking", "breathless", "breathing", "breath"],
            trans: "Nh√† kh√°ch n·∫±m b√™n s∆∞·ªùn v√°ch ƒë√°, v·ªõi t·∫ßm nh√¨n ngo·∫°n m·ª•c xu·ªëng ƒë·∫°i d∆∞∆°ng b√™n d∆∞·ªõi.",
            vocab: [
                {w: "breathtaking", t: "adj", m: "ngo·∫°n m·ª•c, ƒë·∫πp ƒë·∫øn n√≠n th·ªü"},
                {w: "breathless", t: "adj", m: "h·∫øt h∆°i, kh√≥ th·ªü (d√πng cho ng∆∞·ªùi)"},
                {w: "breathing", t: "n/v", m: "s·ª± th·ªü"},
                {w: "breath", t: "n", m: "h∆°i th·ªü"}
            ],
            whyCorrect: "C·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho danh t·ª´ 'views'. 'Breathtaking views' l√† c·ª•m t·ª´ r·∫•t ph·ªï bi·∫øn (collocation) ch·ªâ c·∫£nh ƒë·∫πp.",
            whyWrong: "'Breathless' d√πng ƒë·ªÉ ch·ªâ tr·∫°ng th√°i m·ªát c·ªßa con ng∆∞·ªùi."
        },
        {
            q: "The Taj Mahal is a ___________________ building which is visited by millions of tourists every year. (magnificence)",
            a: "magnificent",
            options: ["magnificent", "magnificently", "magnify", "magnificence"],
            trans: "Taj Mahal l√† m·ªôt c√¥ng tr√¨nh tr√°ng l·ªá ƒë∆∞·ª£c h√†ng tri·ªáu du kh√°ch gh√© thƒÉm m·ªói nƒÉm.",
            vocab: [
                {w: "magnificent", t: "adj", m: "tr√°ng l·ªá, h√πng vƒ©"},
                {w: "magnificently", t: "adv", m: "m·ªôt c√°ch tr√°ng l·ªá"},
                {w: "magnify", t: "v", m: "ph√≥ng to"},
                {w: "magnificence", t: "n", m: "s·ª± tr√°ng l·ªá (t·ª´ g·ªëc)"}
            ],
            whyCorrect: "ƒê·ª©ng tr∆∞·ªõc danh t·ª´ 'building' c·∫ßn m·ªôt T√≠nh t·ª´ b·ªï nghƒ©a.",
            whyWrong: "'Magnificence' l√† danh t·ª´, 'Magnify' l√† ƒë·ªông t·ª´."
        },
        {
            q: "As the capital of Morbihan, Vannes attracts large numbers of ___________________. (travel)",
            a: "travelers",
            options: ["travelers", "traveling", "travels", "tourist"],
            trans: "L√† th·ªß ph·ªß c·ªßa Morbihan, Vannes thu h√∫t m·ªôt l∆∞·ª£ng l·ªõn kh√°ch du l·ªãch.",
            vocab: [
                {w: "travelers", t: "n", m: "kh√°ch du l·ªãch (s·ªë nhi·ªÅu)"},
                {w: "traveling", t: "gerund", m: "vi·ªác ƒëi du l·ªãch"},
                {w: "travels", t: "n", m: "nh·ªØng chuy·∫øn ƒëi"},
                {w: "tourist", t: "n", m: "kh√°ch du l·ªãch (nh∆∞ng sai g·ªëc t·ª´ travel)"}
            ],
            whyCorrect: "Sau c·ª•m l∆∞·ª£ng t·ª´ 'large numbers of' c·∫ßn Danh t·ª´ ƒë·∫øm ƒë∆∞·ª£c s·ªë nhi·ªÅu. T·ª´ c·∫ßn ƒëi·ªÅn ch·ªâ ng∆∞·ªùi (ng∆∞·ªùi b·ªã thu h√∫t ƒë·∫øn thƒÉm).",
            whyWrong: "'Tourist' ƒë√∫ng nghƒ©a nh∆∞ng sai t·ª´ g·ªëc ƒë·ªÅ b√†i cho (travel). 'Traveling' l√† danh ƒë·ªông t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c."
        },
        {
            q: "His parents paid for his hotel ___________________ when he travelled to Japan. (accommodate)",
            a: "accommodation",
            options: ["accommodation", "accommodating", "accommodative", "accommodates"],
            trans: "B·ªë m·∫π anh ·∫•y ƒë√£ tr·∫£ ti·ªÅn ch·ªó ·ªü kh√°ch s·∫°n khi anh ·∫•y ƒëi du l·ªãch Nh·∫≠t B·∫£n.",
            vocab: [
                {w: "accommodation", t: "n", m: "ch·ªó ·ªü, ti·ªán nghi ƒÉn ·ªü"},
                {w: "accommodating", t: "adj", m: "hay gi√∫p ƒë·ª°, d·ªÖ t√≠nh"},
                {w: "accommodative", t: "adj", m: "c√≥ t√≠nh th√≠ch nghi"},
                {w: "accommodates", t: "v", m: "cung c·∫•p ch·ªó ·ªü"}
            ],
            whyCorrect: "C·∫ßn danh t·ª´ gh√©p v·ªõi 'hotel' -> 'hotel accommodation' (ch·ªó ·ªü kh√°ch s·∫°n).",
            whyWrong: "C√°c ƒë√°p √°n c√≤n l·∫°i l√† t√≠nh t·ª´ ho·∫∑c ƒë·ªông t·ª´ chia th√¨."
        },
        {
            q: "Some areas of the park are ___________________ by car from November through May due to snow. (access)",
            a: "inaccessible",
            options: ["inaccessible", "accessible", "accessing", "accessibility"],
            trans: "M·ªôt s·ªë khu v·ª±c c·ªßa c√¥ng vi√™n kh√¥ng th·ªÉ v√†o ƒë∆∞·ª£c b·∫±ng √¥ t√¥ t·ª´ th√°ng 11 ƒë·∫øn th√°ng 5 do tuy·∫øt r∆°i.",
            vocab: [
                {w: "inaccessible", t: "adj", m: "kh√¥ng th·ªÉ ti·∫øp c·∫≠n, kh√¥ng v√†o ƒë∆∞·ª£c"},
                {w: "accessible", t: "adj", m: "c√≥ th·ªÉ ti·∫øp c·∫≠n, v√†o ƒë∆∞·ª£c"},
                {w: "accessing", t: "v-ing", m: "ƒëang truy c·∫≠p"},
                {w: "accessibility", t: "n", m: "kh·∫£ nƒÉng ti·∫øp c·∫≠n"}
            ],
            whyCorrect: "Sau ƒë·ªông t·ª´ to be 'are' c·∫ßn t√≠nh t·ª´. D·ª±a v√†o ng·ªØ c·∫£nh 'due to snow' (do tuy·∫øt r∆°i) -> xe kh√¥ng v√†o ƒë∆∞·ª£c -> C·∫ßn ti·ªÅn t·ªë ph·ªß ƒë·ªãnh 'in-'.",
            whyWrong: "'Accessible' mang nghƒ©a ng∆∞·ª£c l·∫°i."
        },
        {
            q: "World-famous for football, Barcelona is one of the top sports ___________________ destinations in the world. (tour)",
            a: "tourism",
            options: ["tourism", "tourist", "touring", "tours"],
            trans: "N·ªïi ti·∫øng th·∫ø gi·ªõi v·ªÅ b√≥ng ƒë√°, Barcelona l√† m·ªôt trong nh·ªØng ƒëi·ªÉm ƒë·∫øn du l·ªãch th·ªÉ thao h√†ng ƒë·∫ßu th·∫ø gi·ªõi.",
            vocab: [
                {w: "tourism", t: "n", m: "ng√†nh du l·ªãch, ho·∫°t ƒë·ªông du l·ªãch"},
                {w: "tourist", t: "n", m: "kh√°ch du l·ªãch"},
                {w: "touring", t: "v-ing", m: "ƒëi tour"},
                {w: "tours", t: "n", m: "c√°c chuy·∫øn ƒëi"}
            ],
            whyCorrect: "'Sports tourism' l√† m·ªôt thu·∫≠t ng·ªØ chuy√™n ng√†nh (Compound Noun) nghƒ©a l√† 'Du l·ªãch th·ªÉ thao'.",
            whyWrong: "'Sports tourist' √°m ch·ªâ ng∆∞·ªùi kh√°ch du l·ªãch th·ªÉ thao, nh∆∞ng ·ªü ƒë√¢y ƒëang n√≥i v·ªÅ lo·∫°i h√¨nh ƒëi·ªÉm ƒë·∫øn (destinations) c·ªßa ng√†nh du l·ªãch."
        },
        {
            q: "On the first day of school, the children chatted ___________________ to their friends about their summer vacations. (excite)",
            a: "excitedly",
            options: ["excitedly", "excited", "exciting", "excitement"],
            trans: "V√†o ng√†y ƒë·∫ßu ti√™n ƒëi h·ªçc, b·ªçn tr·∫ª tr√≤ chuy·ªán r√¥m r·∫£ v·ªõi b·∫°n b√® v·ªÅ k·ª≥ ngh·ªâ h√® c·ªßa ch√∫ng.",
            vocab: [
                {w: "excitedly", t: "adv", m: "m·ªôt c√°ch h√†o h·ª©ng"},
                {w: "excited", t: "adj", m: "h√†o h·ª©ng (c·∫£m x√∫c)"},
                {w: "exciting", t: "adj", m: "th√∫ v·ªã (t√≠nh ch·∫•t)"},
                {w: "excitement", t: "n", m: "s·ª± h√†o h·ª©ng"}
            ],
            whyCorrect: "V·ªã tr√≠ n√†y b·ªï nghƒ©a cho ƒë·ªông t·ª´ th∆∞·ªùng 'chatted' (tr√≤ chuy·ªán) -> C·∫ßn m·ªôt Tr·∫°ng t·ª´ (Adverb).",
            whyWrong: "C√°c t·ª´ c√≤n l·∫°i l√† t√≠nh t·ª´ v√† danh t·ª´."
        },
        {
            q: "The travel ___________________ assisted us in booking our dream vacation. (agency)",
            a: "agent",
            options: ["agent", "agency", "agents", "acting"],
            trans: "Nh√¢n vi√™n ƒë·∫°i l√Ω du l·ªãch ƒë√£ h·ªó tr·ª£ ch√∫ng t√¥i ƒë·∫∑t k·ª≥ ngh·ªâ m∆° ∆∞·ªõc.",
            vocab: [
                {w: "agent", t: "n", m: "nh√¢n vi√™n ƒë·∫°i l√Ω (ng∆∞·ªùi)"},
                {w: "agency", t: "n", m: "c∆° quan ƒë·∫°i l√Ω (t·ªï ch·ª©c, n∆°i ch·ªën)"},
                {w: "agents", t: "n", m: "s·ªë nhi·ªÅu"},
                {w: "acting", t: "adj", m: "t·∫°m quy·ªÅn"}
            ],
            whyCorrect: "ƒê·ªông t·ª´ 'assisted' (h·ªó tr·ª£) th∆∞·ªùng do con ng∆∞·ªùi th·ª±c hi·ªán tr·ª±c ti·∫øp. T·ª´ g·ªëc l√† 'agency' (t·ªï ch·ª©c) -> c·∫ßn bi·∫øn ƒë·ªïi th√†nh 'agent' (ng∆∞·ªùi).",
            whyWrong: "Gi·ªØ nguy√™n 'agency' l√† sai nguy√™n t·∫Øc Word Form. 'Agents' s·ªë nhi·ªÅu kh√¥ng ph√π h·ª£p m·∫°o t·ª´ 'The' n·∫øu √°m ch·ªâ 1 ng∆∞·ªùi c·ª• th·ªÉ (d√π grammatically possible, singular agent is better here as a specific contact)."
        },
        {
            q: "The Opera House is one of the most popular tourist ___________________ in Sydney. (attract)",
            a: "attractions",
            options: ["attractions", "attraction", "attractive", "attractiveness"],
            trans: "Nh√† h√°t Opera l√† m·ªôt trong nh·ªØng ƒëi·ªÉm tham quan du l·ªãch n·ªïi ti·∫øng nh·∫•t ·ªü Sydney.",
            vocab: [
                {w: "attractions", t: "n", m: "c√°c ƒëi·ªÉm tham quan (s·ªë nhi·ªÅu)"},
                {w: "attraction", t: "n", m: "s·ª± thu h√∫t / ƒëi·ªÉm tham quan (s·ªë √≠t)"},
                {w: "attractive", t: "adj", m: "h·∫•p d·∫´n"},
                {w: "attractiveness", t: "n", m: "v·∫ª quy·∫øn r≈©"}
            ],
            whyCorrect: "C·∫•u tr√∫c 'One of the most...' (M·ªôt trong nh·ªØng...) lu√¥n ƒëi k√®m v·ªõi Danh t·ª´ s·ªë nhi·ªÅu.",
            whyWrong: "'Attraction' thi·∫øu 's'. 'Attractive' l√† t√≠nh t·ª´."
        },
        {
            q: "___________________ complained about lack of information when travel delays occurred. (Travel)",
            a: "Travelers",
            options: ["Travelers", "Traveling", "Travels", "Traveled"],
            trans: "C√°c du kh√°ch ƒë√£ ph√†n n√†n v·ªÅ vi·ªác thi·∫øu th√¥ng tin khi s·ª± c·ªë ho√£n chuy·∫øn ƒëi x·∫£y ra.",
            vocab: [
                {w: "Travelers", t: "n", m: "H√†nh kh√°ch, du kh√°ch (s·ªë nhi·ªÅu)"},
                {w: "Traveling", t: "gerund", m: "Vi·ªác ƒëi l·∫°i"},
                {w: "Travels", t: "n", m: "Nh·ªØng chuy·∫øn ƒëi"},
                {w: "Traveled", t: "v", m: "ƒê√£ ƒëi du l·ªãch"}
            ],
            whyCorrect: "C·∫ßn ch·ªß ng·ªØ ch·ªâ ng∆∞·ªùi th·ª±c hi·ªán h√†nh ƒë·ªông 'complained' (ph√†n n√†n).",
            whyWrong: "Traveling hay Travels l√† v·∫≠t/s·ª± vi·ªác, kh√¥ng th·ªÉ ph√†n n√†n."
        },
        {
            q: "For ___________________ tourists, the company has trips into the mountains with a local guide. (adventure)",
            a: "adventurous",
            options: ["adventurous", "adventure", "adventurer", "adventurously"],
            trans: "ƒê·ªëi v·ªõi nh·ªØng du kh√°ch th√≠ch m·∫°o hi·ªÉm, c√¥ng ty c√≥ c√°c chuy·∫øn ƒëi v√†o n√∫i v·ªõi h∆∞·ªõng d·∫´n vi√™n ƒë·ªãa ph∆∞∆°ng.",
            vocab: [
                {w: "adventurous", t: "adj", m: "th√≠ch phi√™u l∆∞u, m·∫°o hi·ªÉm"},
                {w: "adventure", t: "n", m: "cu·ªôc phi√™u l∆∞u"},
                {w: "adventurer", t: "n", m: "nh√† th√°m hi·ªÉm"},
                {w: "adventurously", t: "adv", m: "m·ªôt c√°ch m·∫°o hi·ªÉm"}
            ],
            whyCorrect: "Tr∆∞·ªõc danh t·ª´ 'tourists' c·∫ßn m·ªôt T√≠nh t·ª´ ƒë·ªÉ ch·ªâ t√≠nh c√°ch c·ªßa nh√≥m kh√°ch n√†y.",
            whyWrong: "'Adventure' l√† danh t·ª´. 'Adventurer' c≈©ng l√† danh t·ª´ ch·ªâ ng∆∞·ªùi, kh√¥ng ƒë·ª©ng tr∆∞·ªõc 'tourists' ƒë·ªÉ b·ªï nghƒ©a theo c√°ch n√†y."
        },
        {
            q: "The ___________________ have been trying to protect this forest for years. (environment)",
            a: "environmentalists",
            options: ["environmentalists", "environment", "environmental", "environmentally"],
            trans: "C√°c nh√† b·∫£o v·ªá m√¥i tr∆∞·ªùng ƒë√£ c·ªë g·∫Øng b·∫£o v·ªá khu r·ª´ng n√†y trong nhi·ªÅu nƒÉm.",
            vocab: [
                {w: "environmentalists", t: "n", m: "nh√† b·∫£o v·ªá m√¥i tr∆∞·ªùng"},
                {w: "environment", t: "n", m: "m√¥i tr∆∞·ªùng"},
                {w: "environmental", t: "adj", m: "thu·ªôc v·ªÅ m√¥i tr∆∞·ªùng"},
                {w: "environmentally", t: "adv", m: "v·ªÅ m·∫∑t m√¥i tr∆∞·ªùng"}
            ],
            whyCorrect: "C·∫ßn danh t·ª´ l√†m ch·ªß ng·ªØ. ƒê·ªông t·ª´ l√† 'have been' (s·ªë nhi·ªÅu) v√† h√†nh ƒë·ªông l√† 'protect forest' -> Danh t·ª´ ch·ªâ ng∆∞·ªùi ·ªü s·ªë nhi·ªÅu.",
            whyWrong: "'Environment' l√† v·∫≠t. 'Environmental' l√† t√≠nh t·ª´."
        },
        {
            q: "Do you have the complete ___________________ to spend the holiday the way you wish? (free)",
            a: "freedom",
            options: ["freedom", "freely", "freeing", "freed"],
            trans: "B·∫°n c√≥ ho√†n to√†n t·ª± do ƒë·ªÉ d√†nh k·ª≥ ngh·ªâ theo c√°ch b·∫°n mu·ªën kh√¥ng?",
            vocab: [
                {w: "freedom", t: "n", m: "s·ª± t·ª± do"},
                {w: "freely", t: "adv", m: "m·ªôt c√°ch t·ª± do"},
                {w: "freeing", t: "v-ing", m: "gi·∫£i ph√≥ng"},
                {w: "freed", t: "v-ed", m: "ƒë√£ gi·∫£i ph√≥ng"}
            ],
            whyCorrect: "Sau c·ª•m m·∫°o t·ª´ v√† t√≠nh t·ª´ 'the complete...' c·∫ßn m·ªôt Danh t·ª´.",
            whyWrong: "C√°c t·ª´ c√≤n l·∫°i sai lo·∫°i t·ª´."
        },
        {
            q: "They organize tours to visit different ___________________ areas and tribes in Northern Vietnam. (geography)",
            a: "geographical",
            options: ["geographical", "geography", "geographically", "geographer"],
            trans: "H·ªç t·ªï ch·ª©c c√°c tour tham quan c√°c khu v·ª±c ƒë·ªãa l√Ω v√† c√°c b·ªô t·ªôc kh√°c nhau ·ªü mi·ªÅn B·∫Øc Vi·ªát Nam.",
            vocab: [
                {w: "geographical", t: "adj", m: "thu·ªôc v·ªÅ ƒë·ªãa l√Ω"},
                {w: "geography", t: "n", m: "m√¥n ƒë·ªãa l√Ω"},
                {w: "geographically", t: "adv", m: "v·ªÅ m·∫∑t ƒë·ªãa l√Ω"},
                {w: "geographer", t: "n", m: "nh√† ƒë·ªãa l√Ω"}
            ],
            whyCorrect: "Tr∆∞·ªõc danh t·ª´ 'areas' c·∫ßn m·ªôt T√≠nh t·ª´ b·ªï nghƒ©a.",
            whyWrong: "Geography l√† danh t·ª´."
        },
        {
            q: "More and more foreigners like travelling to Vietnam for holiday because things are ___________________ here. (afford)",
            a: "affordable",
            options: ["affordable", "afford", "affordability", "affording"],
            trans: "Ng√†y c√†ng nhi·ªÅu ng∆∞·ªùi n∆∞·ªõc ngo√†i th√≠ch ƒëi du l·ªãch Vi·ªát Nam v√¨ m·ªçi th·ª© ·ªü ƒë√¢y gi√° c·∫£ r·∫•t ph·∫£i chƒÉng.",
            vocab: [
                {w: "affordable", t: "adj", m: "gi√° c·∫£ ph·∫£i chƒÉng, h·ª£p t√∫i ti·ªÅn"},
                {w: "afford", t: "v", m: "ƒë·ªß kh·∫£ nƒÉng chi tr·∫£"},
                {w: "affordability", t: "n", m: "kh·∫£ nƒÉng chi tr·∫£"},
                {w: "affording", t: "v-ing", m: "ƒëang chi tr·∫£"}
            ],
            whyCorrect: "Sau ƒë·ªông t·ª´ to be 'are' c·∫ßn m·ªôt T√≠nh t·ª´ m√¥ t·∫£ t√≠nh ch·∫•t c·ªßa h√†ng h√≥a (things).",
            whyWrong: "'Afford' l√† ƒë·ªông t·ª´ g·ªëc."
        }
    ];

    /* LOGIC GAME */
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let isAnswered = false;

    // Shuffle Array Function
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Audio Context for Generating Sounds
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(type) {
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound: High pitch sine wave
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            // Buzz sound: Low pitch sawtooth
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Confetti Effect
    function fireConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const pieces = [];
        const colors = ['#f1c40f', '#e74c3c', '#3498db', '#9b59b6', '#2ecc71'];

        for (let i = 0; i < 100; i++) {
            pieces.push({
                x: canvas.width / 2,
                y: canvas.height / 2,
                w: Math.random() * 10 + 5,
                h: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                vx: (Math.random() - 0.5) * 20,
                vy: (Math.random() - 0.5) * 20,
                grav: 0.5
            });
        }

        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            pieces.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += p.grav;
                p.vx *= 0.95;
                p.vy *= 0.95;
                
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.w, p.h);

                if (p.y < canvas.height) active = true;
            });

            if (active) requestAnimationFrame(update);
            else ctx.clearRect(0,0,canvas.width, canvas.height);
        }
        update();
    }

    function initGame() {
        // Deep copy and shuffle questions
        questions = JSON.parse(JSON.stringify(rawQuestions));
        shuffleArray(questions);
        
        // Also shuffle options within each question
        // Note: Logic below in renderQuestion handles checking correctness by text, so shuffling options is safe
        
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById('score-val').textContent = score;
        document.getElementById('quiz-content').style.display = 'block';
        document.getElementById('end-screen').style.display = 'none';
        
        renderQuestion();
    }

    function renderQuestion() {
        isAnswered = false;
        const q = questions[currentQuestionIndex];
        
        // Update Progress Bar
        const progress = ((currentQuestionIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        // Update Text
        document.getElementById('question-text').innerHTML = `
            <span style="color:var(--primary); font-size: 1rem;">C√¢u ${currentQuestionIndex + 1}/${questions.length}:</span><br>
            ${q.q.replace(/_+/g, '<span class="highlight-word">_________</span>')}
        `;

        // Reset UI
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('btn-next').style.display = 'none';
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        // Shuffle Options for display
        let currentOptions = [...q.options]; 
        // We don't shuffle options array here to keep A B C D consistent? 
        // Actually, gamification usually shuffles positions. Let's shuffle positions.
        // But we need to keep track of which is correct. The correct answer text is in q.a
        shuffleArray(currentOptions);

        currentOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = `<span class="option-letter">${String.fromCharCode(65+index)}</span> ${opt}`;
            btn.onclick = () => checkAnswer(opt, btn, q.a);
            optionsContainer.appendChild(btn);
        });
    }

    function checkAnswer(selectedText, btnElement, correctText) {
        if (isAnswered) return;
        isAnswered = true;

        const options = document.querySelectorAll('.btn-option');
        let correctBtn;

        // Find the button with the correct text
        options.forEach(btn => {
            if (btn.innerText.includes(correctText)) { // Simple check, careful with substrings but ok here
                correctBtn = btn;
            }
            btn.disabled = true; // Disable all
            btn.style.cursor = 'default';
        });

        if (selectedText === correctText) {
            // CORRECT
            btnElement.classList.add('correct');
            score++;
            document.getElementById('score-val').textContent = score;
            playTone('correct');
            fireConfetti();
        } else {
            // WRONG
            btnElement.classList.add('wrong');
            correctBtn.classList.add('correct');
            playTone('wrong');
        }

        showExplanation();
        document.getElementById('btn-next').style.display = 'inline-block';
    }

    function showExplanation() {
        const q = questions[currentQuestionIndex];
        const expBox = document.getElementById('explanation-box');
        const content = document.getElementById('explanation-content');

        // Build Explanation HTML
        let vocabHTML = '<ul class="vocab-list">';
        q.vocab.forEach(v => {
            vocabHTML += `<li><span class="vocab-tag">${v.w} (${v.t})</span> ${v.m}</li>`;
        });
        vocabHTML += '</ul>';

        content.innerHTML = `
            <div class="exp-section-title">1. D·ªãch c√¢u h·ªèi:</div>
            <p><em>"${q.trans}"</em></p>

            <div class="exp-section-title">2. Ph√¢n t√≠ch t·ª´ v·ª±ng:</div>
            ${vocabHTML}

            <div class="exp-section-title">3. T·∫°i sao ch·ªçn ƒë√°p √°n "${q.a}"?</div>
            <p style="color: var(--success); font-weight: bold;">${q.whyCorrect}</p>

            <div class="exp-section-title">4. T·∫°i sao c√°c ƒë√°p √°n kh√°c sai?</div>
            <p style="color: var(--error);">${q.whyWrong}</p>
        `;

        expBox.style.display = 'block';
        // Scroll to explanation on mobile
        if(window.innerWidth < 600) {
            expBox.scrollIntoView({behavior: "smooth"});
        }
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            renderQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        document.getElementById('quiz-content').style.display = 'none';
        document.getElementById('end-screen').style.display = 'block';
        document.getElementById('progress-bar').style.width = '100%';
        
        const finalScore = document.getElementById('final-score');
        finalScore.textContent = `${score}/${questions.length}`;

        const msg = document.getElementById('end-message');
        if (score === questions.length) {
            msg.textContent = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i Word Form! üåü";
            fireConfetti();
        } else if (score >= questions.length * 0.7) {
            msg.textContent = "L√†m t·ªët l·∫Øm! Ch·ªâ c√≤n v√†i l·ªói nh·ªè th√¥i. üí™";
        } else {
            msg.textContent = "H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nh√©! üìö";
        }
    }

    // Start Game on Load
    initGame();

</script>

</body>
</html>
