<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện tập Từ vựng & Câu tường thuật - Ms. Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-pattern: #f0f4f8;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e0eafc;
            background-image: radial-gradient(#8854c0 0.8px, transparent 0.8px), radial-gradient(#8854c0 0.8px, #e0eafc 0.8px);
            background-size: 32px 32px;
            background-position: 0 0, 16px 16px;
            min-height: 100vh;
            color: #2d3748;
        }

        /* 3D Button Styles */
        .btn-3d {
            transition: all 0.1s;
            border-bottom: 5px solid rgba(0,0,0,0.2);
            transform: translateY(0);
        }

        .btn-3d:active {
            transform: translateY(3px);
            border-bottom: 2px solid rgba(0,0,0,0.2);
        }

        /* Option Cards */
        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .option-card:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--primary-purple);
            background-color: #fcfaff;
        }

        /* State Classes */
        .option-card.correct {
            background-color: var(--correct-green) !important;
            border-color: #00a855 !important;
            color: white !important;
            border-bottom-width: 0px; 
            transform: translateY(2px);
        }

        .option-card.wrong {
            background-color: var(--wrong-red) !important;
            border-color: #d63031 !important;
            color: white !important;
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        .option-card.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Animations */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }

        .question-container {
            animation: popIn 0.4s ease-out;
        }

        /* Explanation Box */
        .explanation-box {
            background: #fff;
            border-left: 6px solid var(--primary-teal);
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            padding: 20px;
            display: none; /* Hidden by default */
        }
        
        .explanation-header {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-purple);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #8854C0; 
            border-radius: 4px;
        }

        /* Markdown Styling in Explanation */
        .rationale-content strong {
            color: #d946ef; /* Pink-600 */
        }
        .rationale-content ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 0.5rem;
        }
        .rationale-content li {
            margin-bottom: 0.25rem;
            padding-left: 1rem;
            border-left: 3px solid #e5e7eb;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center py-6 px-4">

    <!-- Header -->
    <div class="w-full max-w-3xl mb-6 text-center animate-bounce-slow">
        <h1 class="text-3xl md:text-4xl font-extrabold text-white drop-shadow-lg" style="text-shadow: 3px 3px 0px #8854C0;">
            <i class="fas fa-graduation-cap mr-2"></i> Ms. Mai An ULIS
        </h1>
        <p class="text-purple-700 font-bold mt-2 bg-white inline-block px-4 py-1 rounded-full shadow-md opacity-90">
            Luyện tập Từ vựng & Câu tường thuật
        </p>
    </div>

    <!-- Stats Bar -->
    <div class="w-full max-w-3xl flex justify-between items-center bg-white rounded-2xl p-4 shadow-xl mb-6 border-b-4 border-purple-200">
        <div class="flex items-center space-x-2">
            <div class="w-10 h-10 rounded-full bg-yellow-400 flex items-center justify-center text-white font-bold shadow-inner">
                <i class="fas fa-star"></i>
            </div>
            <div>
                <p class="text-xs text-gray-500 font-bold uppercase">Điểm số</p>
                <p class="text-xl font-extrabold text-purple-700"><span id="score">0</span></p>
            </div>
        </div>
        
        <div class="flex-1 mx-4">
            <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner overflow-hidden relative">
                <div id="progress-bar" class="bg-gradient-to-r from-teal-400 to-teal-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <p class="text-center text-xs font-bold text-gray-500 mt-1">Câu <span id="current-question-num">1</span> / <span id="total-questions">0</span></p>
        </div>

        <div class="flex items-center space-x-2">
            <div class="w-10 h-10 rounded-full bg-pink-500 flex items-center justify-center text-white font-bold shadow-inner">
                <i class="fas fa-heart"></i>
            </div>
        </div>
    </div>

    <!-- Main Quiz Container -->
    <div id="quiz-area" class="w-full max-w-3xl relative">
        <!-- Question Card -->
        <div class="question-container bg-white rounded-3xl shadow-[0_10px_0_rgb(0,0,0,0.1)] p-6 md:p-8 border-2 border-purple-100 mb-20">
            
            <div class="mb-6">
                <span class="bg-purple-100 text-purple-700 text-xs font-black px-3 py-1 rounded-lg uppercase tracking-wider mb-2 inline-block">Câu hỏi</span>
                <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 leading-snug">
                    Loading question...
                </h2>
                <div id="hint-box" class="hidden mt-3 text-sm text-yellow-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200 italic">
                    <i class="fas fa-lightbulb mr-1"></i> <span id="hint-text"></span>
                </div>
            </div>

            <!-- Options Grid -->
            <div id="options-container" class="grid grid-cols-1 gap-4 mb-6">
                <!-- Options will be injected here via JS -->
            </div>

            <!-- Detailed Explanation Section (Collapsible) -->
            <div id="explanation-container" class="explanation-box">
                <div class="explanation-header">
                    <i class="fas fa-chalkboard-teacher text-2xl"></i>
                    <span>Giải thích chi tiết của Cô Mai An</span>
                </div>
                <div id="explanation-content" class="rationale-content text-gray-700 text-base leading-relaxed whitespace-pre-line">
                    <!-- Rationale goes here -->
                </div>
            </div>

            <!-- Navigation Footer inside Card -->
            <div class="flex justify-between items-center mt-8 pt-4 border-t border-gray-100">
                <button onclick="prevQuestion()" class="text-gray-400 hover:text-purple-600 font-bold py-2 px-4 rounded-xl transition duration-200 disabled:opacity-30" id="btn-prev">
                    <i class="fas fa-arrow-left mr-2"></i> Quay lại
                </button>
                <button onclick="nextQuestion()" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:-translate-y-1 btn-3d flex items-center" id="btn-next">
                    Tiếp theo <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen (Hidden by default) -->
    <div id="result-screen" class="hidden w-full max-w-2xl bg-white rounded-3xl shadow-2xl p-8 text-center border-4 border-purple-200 animate-popIn">
        <div class="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-trophy text-5xl text-yellow-500"></i>
        </div>
        <h2 class="text-3xl font-extrabold text-purple-800 mb-2">Hoàn thành!</h2>
        <p class="text-gray-500 font-bold text-lg mb-6">Bạn đã làm rất tốt!</p>
        
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-green-50 p-4 rounded-xl border border-green-200">
                <p class="text-green-600 font-bold uppercase text-xs">Câu đúng</p>
                <p class="text-3xl font-black text-green-700" id="final-score">0</p>
            </div>
            <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                <p class="text-red-500 font-bold uppercase text-xs">Câu sai</p>
                <p class="text-3xl font-black text-red-600" id="final-wrong">0</p>
            </div>
        </div>

        <button onclick="location.reload()" class="w-full bg-teal-500 hover:bg-teal-400 text-white font-bold py-4 px-6 rounded-2xl shadow-lg btn-3d text-xl">
            <i class="fas fa-redo-alt mr-2"></i> Làm lại bài
        </button>
    </div>

    <!-- Audio Elements (Base64 Encoded for Single File) -->
    <script>
        // Short 'Ding' sound for Correct
        const soundCorrect = new Audio("data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"); 
        // Note: Using a placeholder very short silent base64 above to avoid huge code block. 
        // I will implement a synthetic sound generator below instead for reliability without large strings.
    </script>

    <script>
        // --- DATA SOURCE ---
        const rawData = {
            "questions": [
                { "questionNumber": 1, "question": "26: Better _______ systems help more tourists reach remote natural wonders safely.", "answerOptions": [ { "text": "A. transportation", "rationale": "**Dịch chi tiết:**\n- A. transportation (n): giao thông vận tải\n- B. decoration (n): sự trang trí\n- C. celebration (n): lễ kỷ niệm\n- D. frustration (n): sự thất vọng\n\n**Giải thích:** Câu văn nói về việc giúp du khách đến các địa điểm xa xôi, nên cần một danh từ chỉ phương tiện đi lại. \n\n**Dịch câu:** Các hệ thống giao thông tốt hơn giúp nhiều du khách đến các kỳ quan thiên nhiên xa xôi một cách an toàn.", "isCorrect": true }, { "text": "B. decoration", "rationale": "...", "isCorrect": false }, { "text": "C. celebration", "rationale": "...", "isCorrect": false }, { "text": "D. frustration", "rationale": "...", "isCorrect": false } ], "hint": "Du khách cần phương tiện gì để di chuyển đến nơi xa?" },
                { "questionNumber": 2, "question": "27: Environmental _______ programs teach children about protecting natural heritage sites.", "answerOptions": [ { "text": "A. education", "rationale": "**Dịch chi tiết:**\n- A. education (n): giáo dục\n- B. pollution (n): sự ô nhiễm\n- C. solution (n): giải pháp\n- D. revolution (n): cuộc cách mạng\n\n**Giải thích:** Cụm từ 'Environmental education programs' (các chương trình giáo dục môi trường) là hợp lý nhất để 'teach' (dạy) trẻ em.\n\n**Dịch câu:** Các chương trình giáo dục môi trường dạy trẻ em về việc bảo vệ các di sản thiên nhiên.", "isCorrect": true }, { "text": "B. pollution", "isCorrect": false }, { "text": "C. solution", "isCorrect": false }, { "text": "D. revolution", "isCorrect": false } ], "hint": "Chương trình gì dùng để 'dạy' (teach) kiến thức cho trẻ em?" },
                { "questionNumber": 3, "question": "28: The _______ of rescue teams is crucial when hikers get lost in canyons.", "answerOptions": [ { "text": "A. performance", "isCorrect": false }, { "text": "B. appearance", "rationale": "**Dịch chi tiết:**\n- A. performance (n): hiệu suất, sự thực hiện\n- B. appearance (n): sự xuất hiện, diện mạo\n- C. clearance (n): sự dọn dẹp, giấy phép\n- D. insurance (n): bảo hiểm\n\n**Giải thích:** Khi ai đó bị lạc, sự 'xuất hiện' (đến nơi) của đội cứu hộ là yếu tố sống còn.\n\n**Dịch câu:** Sự xuất hiện của các đội cứu hộ là rất quan trọng khi những người đi bộ đường dài bị lạc trong các hẻm núi.", "isCorrect": true }, { "text": "C. clearance", "isCorrect": false }, { "text": "D. insurance", "isCorrect": false } ], "hint": "Khi bị lạc, điều gì từ đội cứu hộ là cần thiết nhất ngay lúc đó (sự có mặt)?" },
                { "questionNumber": 4, "question": "29: Tour guides need _______ to safely lead groups through dangerous natural areas.", "answerOptions": [ { "text": "A. casual shopping", "isCorrect": false }, { "text": "B. professional training", "rationale": "**Dịch chi tiết:**\n- A. casual shopping (np): mua sắm bình thường\n- B. professional training (np): đào tạo chuyên nghiệp\n- C. random guessing (np): đoán mò\n- D. careless planning (np): lên kế hoạch bất cẩn\n\n**Giải thích:** Để dẫn đoàn qua khu vực nguy hiểm ('dangerous natural areas'), hướng dẫn viên cần được 'đào tạo chuyên nghiệp'.\n\n**Dịch câu:** Hướng dẫn viên du lịch cần được đào tạo chuyên nghiệp để dẫn các nhóm đi qua các khu vực thiên nhiên nguy hiểm một cách an toàn.", "isCorrect": true }, { "text": "C. random guessing", "isCorrect": false }, { "text": "D. careless planning", "isCorrect": false } ], "hint": "Để đảm bảo an toàn, hướng dẫn viên cần kỹ năng gì?" },
                { "questionNumber": 5, "question": "30: Online booking makes it _______ for tourists to plan visits to natural parks.", "answerOptions": [ { "text": "A. convenient", "rationale": "**Dịch chi tiết:**\n- A. convenient (adj): thuận tiện\n- B. ancient (adj): cổ xưa\n- C. patient (adj): kiên nhẫn\n- D. violent (adj): bạo lực\n\n**Giải thích:** Việc đặt vé trực tuyến giúp quá trình lên kế hoạch trở nên dễ dàng và 'thuận tiện' hơn.\n\n**Dịch câu:** Việc đặt chỗ trực tuyến giúp du khách lên kế hoạch tham quan các công viên thiên nhiên thuận tiện hơn.", "isCorrect": true }, { "text": "B. ancient", "isCorrect": false }, { "text": "C. patient", "isCorrect": false }, { "text": "D. violent", "isCorrect": false } ], "hint": "Đặt vé online giúp tiết kiệm thời gian và công sức, tức là nó rất...?" },
                { "questionNumber": 6, "question": "31: \"Do you want to visit the Amazon rainforest?\"\nShe asked me _______ to visit the Amazon rainforest.", "answerOptions": [ { "text": "A. if I wanted", "rationale": "**Dịch chi tiết:**\n- A. if I wanted: liệu tôi có muốn (đúng)\n- B. that I want: rằng tôi muốn (sai thì và từ nối)\n- C. do I want: (giữ nguyên dạng câu hỏi - sai)\n- D. whether did I want: (thừa trợ động từ did - sai)\n\n**Giải thích:** Câu hỏi Yes/No chuyển sang gián tiếp:\n1. Dùng 'if' hoặc 'whether'.\n2. Đổi ngôi (you -> I).\n3. Lùi thì (want -> wanted).\n4. Bỏ trợ động từ 'do', câu trần thuật không đảo ngữ.\n\n**Dịch câu:** Cô ấy hỏi tôi liệu tôi có muốn đến thăm rừng nhiệt đới Amazon không.", "isCorrect": true }, { "text": "B. that I want", "isCorrect": false }, { "text": "C. do I want", "isCorrect": false }, { "text": "D. whether did I want", "isCorrect": false } ], "hint": "Câu hỏi Yes/No khi chuyển sang gián tiếp cần từ nối 'if' hoặc 'whether' và phải lùi thì." },
                { "questionNumber": 7, "question": "32: \"Is Mount Everest the highest mountain in the world?\"\nThe student asked the teacher _______ the highest mountain in the world at that time.", "answerOptions": [ { "text": "A. is Mount Everest", "isCorrect": false }, { "text": "B. if Mount Everest was", "rationale": "**Dịch chi tiết:**\n- A. is Mount Everest (đảo ngữ - sai)\n- B. if Mount Everest was (đúng)\n- C. that Mount Everest is (sai từ nối)\n- D. Mount Everest was (thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if' cho câu hỏi Yes/No.\n2. Chủ ngữ 'Mount Everest' + Động từ lùi thì (is -> was).\n3. Không đảo ngữ.\n\n**Dịch câu:** Học sinh hỏi giáo viên liệu đỉnh Everest có phải là ngọn núi cao nhất thế giới vào thời điểm đó không.", "isCorrect": true }, { "text": "C. that Mount Everest is", "isCorrect": false }, { "text": "D. Mount Everest was", "isCorrect": false } ], "hint": "Lùi thì của động từ 'is' thành 'was' và thêm từ nối cho câu hỏi Yes/No." },
                { "questionNumber": 8, "question": "33: \"Can tourists swim in this lake?\"\nThe visitor wanted to know _______ in that lake.", "answerOptions": [ { "text": "A. can tourists swim", "isCorrect": false }, { "text": "B. tourists can swim", "isCorrect": false }, { "text": "C. whether tourists could swim", "rationale": "**Dịch chi tiết:**\n- A. can tourists swim (đảo ngữ - sai)\n- B. tourists can swim (chưa lùi thì, thiếu từ nối)\n- C. whether tourists could swim (đúng)\n- D. that tourists could swim (sai từ nối)\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Chủ ngữ 'tourists'.\n3. Lùi thì (can -> could).\n\n**Dịch câu:** Du khách muốn biết liệu khách du lịch có được bơi trong hồ đó không.", "isCorrect": true }, { "text": "D. that tourists could swim", "isCorrect": false } ], "hint": "Chuyển 'can' thành 'could' và dùng 'whether'." },
                { "questionNumber": 9, "question": "34: \"Will you go to Halong Bay tomorrow?\"\nMy friend asked me _______ I would go to Halong Bay the next day.", "answerOptions": [ { "text": "A. will I go", "isCorrect": false }, { "text": "B. that", "isCorrect": false }, { "text": "C. when", "isCorrect": false }, { "text": "D. if", "rationale": "**Dịch chi tiết:**\n- A. will I go (sai cấu trúc)\n- B. that (sai từ nối)\n- C. when (sai từ để hỏi)\n- D. if (đúng)\n\n**Giải thích:** Câu gốc là câu hỏi Yes/No ('Will you...'), nên cần từ nối 'if'. Phần sau 'I would go...' đã được viết sẵn trong đề bài.\n\n**Dịch câu:** Bạn tôi hỏi tôi liệu tôi có đi Vịnh Hạ Long vào ngày hôm sau không.", "isCorrect": true } ], "hint": "Câu hỏi Yes/No bắt đầu bằng 'Will', cần từ nối gì?" },
                { "questionNumber": 10, "question": "35: \"Are there any dangerous animals here?\"\nThe tourist asked the guide _______ any dangerous animals there.", "answerOptions": [ { "text": "A. if there were", "rationale": "**Dịch chi tiết:**\n- A. if there were (đúng)\n- B. are there (đảo ngữ - sai)\n- C. that there were (sai từ nối)\n- D. there are (thiếu từ nối, sai thì)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Chủ ngữ giả 'there'.\n3. Lùi thì (are -> were).\n\n**Dịch câu:** Du khách hỏi hướng dẫn viên liệu có động vật nguy hiểm nào ở đó không.", "isCorrect": true }, { "text": "B. are there", "isCorrect": false }, { "text": "C. that there were", "isCorrect": false }, { "text": "D. there are", "isCorrect": false } ], "hint": "'Are there' chuyển sang gián tiếp thành 'if there were'." },
                { "questionNumber": 11, "question": "36: \"Did you take photos of the waterfall yesterday?\"\nShe wanted to know _______ photos of the waterfall the day before.", "answerOptions": [ { "text": "A. did I take", "isCorrect": false }, { "text": "B. whether I had taken", "rationale": "**Dịch chi tiết:**\n- A. did I take (đảo ngữ - sai)\n- B. whether I had taken (đúng)\n- C. that I took (sai từ nối, sai thì)\n- D. I take (sai thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Quá khứ đơn (did take) lùi thành Quá khứ hoàn thành (had taken).\n3. Đổi ngôi you -> I.\n\n**Dịch câu:** Cô ấy muốn biết liệu tôi có chụp ảnh thác nước vào ngày hôm trước không.", "isCorrect": true }, { "text": "C. that I took", "isCorrect": false }, { "text": "D. I take", "isCorrect": false } ], "hint": "Quá khứ đơn (Did take) lùi một thì thành Quá khứ hoàn thành." },
                { "questionNumber": 12, "question": "37: \"Have you ever seen the Northern Lights?\"\nHe asked me _______ the Northern Lights.", "answerOptions": [ { "text": "A. have I ever seen", "isCorrect": false }, { "text": "B. that I had ever seen", "isCorrect": false }, { "text": "C. if I had ever seen", "rationale": "**Dịch chi tiết:**\n- A. have I ever seen (đảo ngữ, chưa lùi thì - sai)\n- B. that I had ever seen (sai từ nối)\n- C. if I had ever seen (đúng)\n- D. I ever saw (sai thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Hiện tại hoàn thành (Have seen) lùi thành Quá khứ hoàn thành (had seen).\n\n**Dịch câu:** Anh ấy hỏi tôi liệu tôi đã từng thấy Bắc Cực Quang chưa.", "isCorrect": true }, { "text": "D. I ever saw", "isCorrect": false } ], "hint": "Hiện tại hoàn thành (Have seen) chuyển thành Quá khứ hoàn thành." },
                { "questionNumber": 13, "question": "38: \"Is the Grand Canyon in Arizona?\"\nThe child asked his mother _______ in Arizona then.", "answerOptions": [ { "text": "A. the Grand Canyon is", "isCorrect": false }, { "text": "B. is the Grand Canyon", "isCorrect": false }, { "text": "C. that the Grand Canyon was", "isCorrect": false }, { "text": "D. if the Grand Canyon was", "rationale": "**Dịch chi tiết:**\n- A. the Grand Canyon is (chưa lùi thì, thiếu từ nối)\n- B. is the Grand Canyon (đảo ngữ - sai)\n- C. that the Grand Canyon was (sai từ nối)\n- D. if the Grand Canyon was (đúng)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì (is -> was).\n\n**Dịch câu:** Đứa trẻ hỏi mẹ liệu Grand Canyon có ở Arizona không.", "isCorrect": true } ], "hint": "Tìm đáp án có 'if' và động từ 'is' đã lùi thì." },
                { "questionNumber": 14, "question": "39: \"Were you scared when climbing the mountain?\"\nThey asked him _______ scared when climbing the mountain.", "answerOptions": [ { "text": "A. if he had been", "rationale": "**Dịch chi tiết:**\n- A. if he had been (đúng)\n- B. was he (đảo ngữ - sai)\n- C. that he was (sai từ nối)\n- D. he is (sai thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Quá khứ đơn (Were) lùi thành Quá khứ hoàn thành (had been).\n\n**Dịch câu:** Họ hỏi anh ấy liệu anh ấy có sợ khi leo núi không.", "isCorrect": true }, { "text": "B. was he", "isCorrect": false }, { "text": "C. that he was", "isCorrect": false }, { "text": "D. he is", "isCorrect": false } ], "hint": "Quá khứ đơn (Were) lùi thành Quá khứ hoàn thành (had been)." },
                { "questionNumber": 15, "question": "40: \"May I enter the national park now?\"\nThe visitor asked _______ the national park then.", "answerOptions": [ { "text": "A. if he may enter", "isCorrect": false }, { "text": "B. whether he might enter", "rationale": "**Dịch chi tiết:**\n- A. if he may enter (chưa lùi thì may)\n- B. whether he might enter (đúng)\n- C. that he might enter (sai từ nối)\n- D. may he enter (đảo ngữ - sai)\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Lùi thì: May -> Might.\n\n**Dịch câu:** Du khách hỏi liệu anh ấy có thể vào công viên quốc gia lúc đó không.", "isCorrect": true }, { "text": "C. that he might enter", "isCorrect": false }, { "text": "D. may he enter", "isCorrect": false } ], "hint": "'May' chuyển sang quá khứ là 'Might'." },
                { "questionNumber": 16, "question": "41: \"Do the local people speak English?\"\nWe wanted to know _______ English there.", "answerOptions": [ { "text": "A. the local people speak", "isCorrect": false }, { "text": "B. that the local people spoke", "isCorrect": false }, { "text": "C. if the local people spoke", "rationale": "**Dịch chi tiết:**\n- A. the local people speak (thiếu từ nối, chưa lùi thì)\n- B. that the local people spoke (sai từ nối)\n- C. if the local people spoke (đúng)\n- D. do the local people speak (sai đảo ngữ)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì: Speak (hiện tại) -> Spoke (quá khứ).\n\n**Dịch câu:** Chúng tôi muốn biết liệu người dân địa phương có nói tiếng Anh không.", "isCorrect": true }, { "text": "D. do the local people speak", "isCorrect": false } ], "hint": "Hiện tại đơn (speak) lùi thành Quá khứ đơn (spoke)." },
                { "questionNumber": 17, "question": "42: \"Is it safe to hike alone today?\"\nShe asked the ranger _______ to hike alone that day.", "answerOptions": [ { "text": "A. it is safe", "isCorrect": false }, { "text": "B. that it was safe", "isCorrect": false }, { "text": "C. is it safe", "isCorrect": false }, { "text": "D. whether it was safe", "rationale": "**Dịch chi tiết:**\n- A. it is safe\n- B. that it was safe\n- C. is it safe\n- D. whether it was safe\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Lùi thì: Is -> Was.\n\n**Dịch câu:** Cô ấy hỏi nhân viên kiểm lâm liệu đi bộ một mình ngày hôm đó có an toàn không.", "isCorrect": true } ], "hint": "Lùi thì 'is' -> 'was' và dùng 'whether'." },
                { "questionNumber": 18, "question": "43: \"Can we camp near the volcano?\"\nThe tourists asked _______ near the volcano.", "answerOptions": [ { "text": "A. if they could camp", "rationale": "**Dịch chi tiết:**\n- A. if they could camp (đúng)\n- B. can they camp (chưa lùi thì, thiếu từ nối)\n- C. that they could camp (sai từ nối)\n- D. they can camp (chưa lùi thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Đổi ngôi: We -> They.\n3. Lùi thì: Can -> Could.\n\n**Dịch câu:** Các du khách hỏi liệu họ có được cắm trại gần núi lửa không.", "isCorrect": true }, { "text": "B. can they camp", "isCorrect": false }, { "text": "C. that they could camp", "isCorrect": false }, { "text": "D. they can camp", "isCorrect": false } ], "hint": "'Can' chuyển thành 'Could' và đổi ngôi 'We' thành 'They'." },
                { "questionNumber": 19, "question": "44: \"Will the weather be good this weekend?\"\nHe wanted to know _______ good that weekend.", "answerOptions": [ { "text": "A. will the weather be", "isCorrect": false }, { "text": "B. if the weather would be", "rationale": "**Dịch chi tiết:**\n- A. will the weather be\n- B. if the weather would be\n- C. the weather will be\n- D. that the weather would be\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì: Will -> Would.\n\n**Dịch câu:** Anh ấy muốn biết liệu thời tiết cuối tuần đó có đẹp không.", "isCorrect": true }, { "text": "C. the weather will be", "isCorrect": false }, { "text": "D. that the weather would be", "isCorrect": false } ], "hint": "'Will' chuyển thành 'Would'." },
                { "questionNumber": 20, "question": "45: \"Have you booked the tour yet?\"\nMy parents asked me _______ the tour yet.", "answerOptions": [ { "text": "A. have I booked", "isCorrect": false }, { "text": "B. that I had booked", "isCorrect": false }, { "text": "C. whether I had booked", "rationale": "**Dịch chi tiết:**\n- A. have I booked\n- B. that I had booked\n- C. whether I had booked\n- D. I booked\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Hiện tại hoàn thành (Have booked) lùi thành Quá khứ hoàn thành (had booked).\n\n**Dịch câu:** Bố mẹ hỏi tôi liệu tôi đã đặt tour chưa.", "isCorrect": true }, { "text": "D. I booked", "isCorrect": false } ], "hint": "'Have booked' chuyển thành 'had booked'." },
                { "questionNumber": 21, "question": "46: \"Are you enjoying your trip?\"\nThe guide asked us _______ our trip.", "answerOptions": [ { "text": "A. are we enjoying", "isCorrect": false }, { "text": "B. that we were enjoying", "isCorrect": false }, { "text": "C. we enjoy", "isCorrect": false }, { "text": "D. if we were enjoying", "rationale": "**Dịch chi tiết:**\n- A. are we enjoying\n- B. that we were enjoying\n- C. we enjoy\n- D. if we were enjoying\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Đổi ngôi: You -> We.\n3. Lùi thì: Are enjoying -> Were enjoying.\n\n**Dịch câu:** Hướng dẫn viên hỏi chúng tôi liệu chúng tôi có đang tận hưởng chuyến đi không.", "isCorrect": true } ], "hint": "Hiện tại tiếp diễn (Are enjoying) lùi thành Quá khứ tiếp diễn (Were enjoying)." },
                { "questionNumber": 22, "question": "47: \"Did the earthquake damage the natural site?\"\nThe reporter asked _______ the natural site.", "answerOptions": [ { "text": "A. whether the earthquake had damaged", "rationale": "**Dịch chi tiết:**\n- A. whether the earthquake had damaged (đúng)\n- B. did the earthquake damage (sai đảo ngữ)\n- C. the earthquake damaged (thiếu từ nối, chưa lùi thì hoàn thành)\n- D. that the earthquake damaged (sai từ nối)\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Quá khứ đơn (Did damage) lùi thành Quá khứ hoàn thành (had damaged).\n\n**Dịch câu:** Phóng viên hỏi liệu trận động đất có làm hư hại khu di tích thiên nhiên không.", "isCorrect": true }, { "text": "B. did the earthquake damage", "isCorrect": false }, { "text": "C. the earthquake damaged", "isCorrect": false }, { "text": "D. that the earthquake damaged", "isCorrect": false } ], "hint": "Quá khứ đơn lùi về Quá khứ hoàn thành." },
                { "questionNumber": 23, "question": "48: \"Is there a visitor center here?\"\nThe family wanted to know _______ a visitor center there.", "answerOptions": [ { "text": "A. is there", "isCorrect": false }, { "text": "B. if there was", "rationale": "**Dịch chi tiết:**\n- A. is there\n- B. if there was\n- C. that there was\n- D. there is\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì: Is -> Was.\n\n**Dịch câu:** Gia đình muốn biết liệu có trung tâm du khách nào ở đó không.", "isCorrect": true }, { "text": "C. that there was", "isCorrect": false }, { "text": "D. there is", "isCorrect": false } ], "hint": "'Is there' chuyển thành 'if there was'." },
                { "questionNumber": 24, "question": "49: \"Can children participate in this activity?\"\nThe mother asked _______ in that activity.", "answerOptions": [ { "text": "A. children can participate", "isCorrect": false }, { "text": "B. that children could participate", "isCorrect": false }, { "text": "C. whether children could participate", "rationale": "**Dịch chi tiết:**\n- A. children can participate\n- B. that children could participate\n- C. whether children could participate\n- D. can children participate\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Lùi thì: Can -> Could.\n\n**Dịch câu:** Người mẹ hỏi liệu trẻ em có được tham gia hoạt động đó không.", "isCorrect": true }, { "text": "D. can children participate", "isCorrect": false } ], "hint": "'Can' chuyển thành 'Could'." },
                { "questionNumber": 25, "question": "50: \"Were you impressed by the coral reef?\"\nShe asked him _______ impressed by the coral reef.", "answerOptions": [ { "text": "A. was he", "isCorrect": false }, { "text": "B. that he was", "isCorrect": false }, { "text": "C. he is", "isCorrect": false }, { "text": "D. if he was", "rationale": "**Dịch chi tiết:**\n- A. was he\n- B. that he was\n- C. he is\n- D. if he was\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Đổi ngôi You -> He.\n3. Lùi thì: 'Were' thường lùi thành 'had been', nhưng trong các lựa chọn được đưa ra, 'was' là phương án chấp nhận được nhất cho quá trình lùi thì đơn giản (hoặc giữ nguyên quá khứ) trong văn nói.\n\n**Dịch câu:** Cô ấy hỏi anh ấy liệu anh ấy có bị ấn tượng bởi rạn san hô không.", "isCorrect": true } ], "hint": "Chọn đáp án có 'if' và động từ đã được chia ở quá khứ." },
                { "questionNumber": 26, "question": "51: \"Do I need special equipment for this trail?\"\nThe hiker asked _______ special equipment for that trail.", "answerOptions": [ { "text": "A. if he needed", "rationale": "**Dịch chi tiết:**\n- A. if he needed (đúng)\n- B. do I need (sai ngôi, sai đảo ngữ)\n- C. that he needed (sai từ nối)\n- D. I need (sai ngôi, sai thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Đổi ngôi I -> He.\n3. Lùi thì: Need -> Needed.\n\n**Dịch câu:** Người đi bộ hỏi liệu anh ấy có cần thiết bị đặc biệt cho con đường mòn đó không.", "isCorrect": true }, { "text": "B. do I need", "isCorrect": false }, { "text": "C. that he needed", "isCorrect": false }, { "text": "D. I need", "isCorrect": false } ], "hint": "Hiện tại đơn (Need) lùi thành Quá khứ đơn (Needed)." },
                { "questionNumber": 27, "question": "52: \"Has the park opened this morning?\"\nWe asked the staff _______ that morning.", "answerOptions": [ { "text": "A. has the park opened", "isCorrect": false }, { "text": "B. whether the park had opened", "rationale": "**Dịch chi tiết:**\n- A. has the park opened\n- B. whether the park had opened\n- C. the park has opened\n- D. that the park opened\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Hiện tại hoàn thành (Has opened) lùi thành Quá khứ hoàn thành (had opened).\n\n**Dịch câu:** Chúng tôi hỏi nhân viên liệu công viên đã mở cửa sáng hôm đó chưa.", "isCorrect": true }, { "text": "C. the park has opened", "isCorrect": false }, { "text": "D. that the park opened", "isCorrect": false } ], "hint": "Hiện tại hoàn thành lùi về Quá khứ hoàn thành (had opened)." },
                { "questionNumber": 28, "question": "53: \"Will you join our conservation project?\"\nThey asked me _______ I would join their conservation project.", "answerOptions": [ { "text": "A. will", "isCorrect": false }, { "text": "B. that", "isCorrect": false }, { "text": "C. if", "rationale": "**Dịch chi tiết:**\n- A. will\n- B. that\n- C. if\n- D. when\n\n**Giải thích:** Câu hỏi Yes/No cần từ nối 'if'. (Phần 'I would join' đã có sẵn).\n\n**Dịch câu:** Họ hỏi tôi liệu tôi có tham gia dự án bảo tồn của họ không.", "isCorrect": true }, { "text": "D. when", "isCorrect": false } ], "hint": "Điền từ nối cho câu hỏi Yes/No." },
                { "questionNumber": 29, "question": "54: \"Is photography allowed in the cave?\"\nThe tourist wanted to know _______ in the cave at that time.", "answerOptions": [ { "text": "A. photography is allowed", "isCorrect": false }, { "text": "B. is photography allowed", "isCorrect": false }, { "text": "C. that photography was allowed", "isCorrect": false }, { "text": "D. whether photography was allowed", "rationale": "**Dịch chi tiết:**\n- A. photography is allowed\n- B. is photography allowed\n- C. that photography was allowed\n- D. whether photography was allowed\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Lùi thì: Is -> Was.\n\n**Dịch câu:** Du khách muốn biết liệu việc chụp ảnh có được phép trong hang động không.", "isCorrect": true } ], "hint": "Lùi thì 'is' thành 'was' và thêm 'whether'." },
                { "questionNumber": 30, "question": "55: \"Did you see any wildlife yesterday?\"\nThe researcher asked us _______ any wildlife the day before.", "answerOptions": [ { "text": "A. if we had seen", "rationale": "**Dịch chi tiết:**\n- A. if we had seen (đúng)\n- B. did we see (sai đảo ngữ)\n- C. that we saw (sai từ nối)\n- D. we saw (sai thì, thiếu từ nối)\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Quá khứ đơn (Did see) lùi thành Quá khứ hoàn thành (had seen).\n\n**Dịch câu:** Nhà nghiên cứu hỏi chúng tôi liệu chúng tôi có nhìn thấy động vật hoang dã nào vào ngày hôm trước không.", "isCorrect": true }, { "text": "B. did we see", "isCorrect": false }, { "text": "C. that we saw", "isCorrect": false }, { "text": "D. we saw", "isCorrect": false } ], "hint": "Quá khứ đơn (Did see) lùi thành Quá khứ hoàn thành (Had seen)." },
                { "questionNumber": 31, "question": "56: \"Are the trails well-marked?\"\nThe hikers asked the ranger _______ well-marked then.", "answerOptions": [ { "text": "A. the trails are", "isCorrect": false }, { "text": "B. if the trails were", "rationale": "**Dịch chi tiết:**\n- A. the trails are\n- B. if the trails were\n- C. that the trails were\n- D. are the trails\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì: Are -> Were.\n\n**Dịch câu:** Những người đi bộ hỏi kiểm lâm liệu các con đường mòn có được đánh dấu rõ ràng không.", "isCorrect": true }, { "text": "C. that the trails were", "isCorrect": false }, { "text": "D. are the trails", "isCorrect": false } ], "hint": "'Are' lùi thành 'were'." },
                { "questionNumber": 32, "question": "57: \"Have they finished building the bridge?\"\nShe wanted to know _______ building the bridge.", "answerOptions": [ { "text": "A. have they finished", "isCorrect": false }, { "text": "B. they have finished", "isCorrect": false }, { "text": "C. whether they had finished", "rationale": "**Dịch chi tiết:**\n- A. have they finished\n- B. they have finished\n- C. whether they had finished\n- D. that they finished\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Hiện tại hoàn thành (Have finished) lùi thành Quá khứ hoàn thành (had finished).\n\n**Dịch câu:** Cô ấy muốn biết liệu họ đã xây xong cây cầu chưa.", "isCorrect": true }, { "text": "D. that they finished", "isCorrect": false } ], "hint": "Hiện tại hoàn thành (Have finished) lùi về Quá khứ hoàn thành." },
                { "questionNumber": 33, "question": "58: \"Can we see dolphins from here?\"\nThe children asked their teacher _______ dolphins from there.", "answerOptions": [ { "text": "A. can we see", "isCorrect": false }, { "text": "B. we can see", "isCorrect": false }, { "text": "C. that they could see", "isCorrect": false }, { "text": "D. if they could see", "rationale": "**Dịch chi tiết:**\n- A. can we see\n- B. we can see\n- C. that they could see\n- D. if they could see\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Đổi ngôi We -> They.\n3. Lùi thì: Can -> Could.\n\n**Dịch câu:** Lũ trẻ hỏi giáo viên liệu chúng có thể nhìn thấy cá heo từ đó không.", "isCorrect": true } ], "hint": "'Can' chuyển thành 'could' và đổi ngôi." },
                { "questionNumber": 34, "question": "59: \"Was the volcano active last year?\"\nThe scientist asked _______ active the previous year.", "answerOptions": [ { "text": "A. whether the volcano had been", "rationale": "**Dịch chi tiết:**\n- A. whether the volcano had been (đúng)\n- B. was the volcano (sai đảo ngữ)\n- C. the volcano was (thiếu từ nối, chưa lùi thì hoàn thành)\n- D. that the volcano was (sai từ nối)\n\n**Giải thích:**\n1. Dùng 'whether'.\n2. Quá khứ đơn (Was) lùi thành Quá khứ hoàn thành (had been).\n\n**Dịch câu:** Nhà khoa học hỏi liệu ngọn núi lửa có hoạt động vào năm trước đó không.", "isCorrect": true }, { "text": "B. was the volcano", "isCorrect": false }, { "text": "C. the volcano was", "isCorrect": false }, { "text": "D. that the volcano was", "isCorrect": false } ], "hint": "Quá khứ đơn (Was) lùi thành Quá khứ hoàn thành (had been)." },
                { "questionNumber": 35, "question": "60: \"Do you know the history of this place?\"\nThe guide asked me _______ the history of that place.", "answerOptions": [ { "text": "A. do I know", "isCorrect": false }, { "text": "B. if I knew", "rationale": "**Dịch chi tiết:**\n- A. do I know\n- B. if I knew\n- C. that I knew\n- D. I know\n\n**Giải thích:**\n1. Dùng 'if'.\n2. Lùi thì: Know -> Knew.\n\n**Dịch câu:** Hướng dẫn viên hỏi tôi liệu tôi có biết lịch sử của nơi đó không.", "isCorrect": true }, { "text": "C. that I knew", "isCorrect": false }, { "text": "D. I know", "isCorrect": false } ], "hint": "Hiện tại đơn (Know) lùi thành Quá khứ đơn (Knew)." }
            ]
        };

        // --- GAME LOGIC ---

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let wrongCount = 0;
        let isAnswered = false;

        // Sound Synthesis for "No External File" Requirement
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(freq, type, duration) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playCorrectSound() {
            // Ding: High sine wave
            playTone(800, 'sine', 0.1);
            setTimeout(() => playTone(1200, 'sine', 0.3), 100);
        }

        function playWrongSound() {
            // Buzz: Low sawtooth
            playTone(150, 'sawtooth', 0.3);
            setTimeout(() => playTone(120, 'sawtooth', 0.3), 200);
        }

        // Shuffle Function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Initialization
        function initQuiz() {
            // Clone data to avoid mutating original if we restart
            questions = JSON.parse(JSON.stringify(rawData.questions));
            // Shuffle Questions
            shuffleArray(questions);
            
            // Set UI
            document.getElementById('total-questions').innerText = questions.length;
            renderQuestion();
        }

        function renderQuestion() {
            isAnswered = false;
            const q = questions[currentQuestionIndex];
            
            // Update Progress
            document.getElementById('current-question-num').innerText = currentQuestionIndex + 1;
            const progressPercent = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;

            // Render Text
            document.getElementById('question-text').innerText = q.question;
            
            // Hint Logic
            const hintBox = document.getElementById('hint-box');
            if (q.hint) {
                document.getElementById('hint-text').innerText = q.hint;
                hintBox.classList.remove('hidden');
            } else {
                hintBox.classList.add('hidden');
            }

            // Hide Explanation & Reset
            document.getElementById('explanation-container').style.display = 'none';
            document.getElementById('explanation-content').innerHTML = '';
            
            // Render Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            // Ensure we have correct rationale mapping if answer options are shuffled
            // Since rationale is bound to the correct answer in the data structure, we can just render the logic.
            
            q.answerOptions.forEach((opt, index) => {
                const btn = document.createElement('div');
                btn.className = 'option-card';
                btn.innerHTML = `<span class="bg-purple-100 text-purple-800 font-bold px-3 py-1 rounded-lg mr-3">${String.fromCharCode(65 + index)}</span> <span class="flex-1">${opt.text}</span>`;
                btn.onclick = () => checkAnswer(btn, opt, q);
                optionsContainer.appendChild(btn);
            });

            // Nav buttons
            document.getElementById('btn-prev').disabled = currentQuestionIndex === 0;
            const nextBtn = document.getElementById('btn-next');
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.innerHTML = 'Hoàn thành <i class="fas fa-flag-checkered ml-2"></i>';
            } else {
                nextBtn.innerHTML = 'Tiếp theo <i class="fas fa-arrow-right ml-2"></i>';
            }
        }

        function checkAnswer(selectedBtn, optionData, questionData) {
            if (isAnswered) return; // Prevent multiple clicks
            isAnswered = true;

            const allBtns = document.querySelectorAll('.option-card');
            
            // Identify correct option (find it in the array)
            // Note: In shuffled mode, we need to find the correct answer text or ID.
            // My data structure has isCorrect flag.
            let correctBtn;
            allBtns.forEach((btn, idx) => {
                // Find which button corresponds to the correct data option
                // Since I rendered them in order, the index matches questionData.answerOptions[idx]
                if (questionData.answerOptions[idx].isCorrect) {
                    correctBtn = btn;
                }
                btn.classList.add('disabled'); // Disable all
            });

            if (optionData.isCorrect) {
                // Correct Case
                selectedBtn.classList.add('correct');
                score++;
                document.getElementById('score').innerText = score;
                playCorrectSound();
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#00D26A', '#8854C0', '#F1C40F']
                });
            } else {
                // Wrong Case
                selectedBtn.classList.add('wrong');
                correctBtn.classList.add('correct'); // Show correct answer
                wrongCount++;
                playWrongSound();
            }

            // Show Explanation Immediately
            showExplanation(questionData);
        }

        function showExplanation(qData) {
            const expContainer = document.getElementById('explanation-container');
            const expContent = document.getElementById('explanation-content');
            
            // Find the rationale from the CORRECT option (or if rationale is at question level - user data put rationale in options)
            // User data put rationale mainly in the correct option, but sometimes spread out.
            // Let's combine them or prioritize the correct one.
            
            const correctOpt = qData.answerOptions.find(o => o.isCorrect);
            let rawRationale = correctOpt.rationale || "Chi tiết đang cập nhật...";

            // Enhance Formatting for "Super Detailed" Look
            // Bold key phrases
            rawRationale = rawRationale.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            expContent.innerHTML = rawRationale;
            
            // Slide Down Animation
            expContainer.style.display = 'block';
            expContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                window.scrollTo(0, 0);
            } else {
                finishQuiz();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            document.getElementById('final-wrong').innerText = wrongCount;
            
            confetti({
                particleCount: 200,
                spread: 160,
                origin: { y: 0.6 }
            });
        }

        // Start
        initQuiz();

    </script>
</body>
</html>
