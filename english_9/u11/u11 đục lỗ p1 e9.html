<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gap Fill Challenge - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #F0F3F8;
            --card-bg: #FFFFFF;
            --text-dark: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dbe3f0 2px, transparent 2px);
            background-size: 20px 20px;
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* --- Header --- */
        .header-bar {
            background: linear-gradient(135deg, var(--primary-pink), #a29bfe);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(136, 84, 192, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .header-title {
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 1.5rem;
            margin: 0;
            text-transform: uppercase;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .teacher-name {
            font-size: 0.9rem;
            opacity: 0.95;
            margin-top: 5px;
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 3px 10px;
            border-radius: 20px;
            font-weight: 600;
        }

        /* --- Container --- */
        .container {
            max-width: 800px;
            margin: 30px auto;
            padding: 0 15px 100px 15px;
        }

        /* --- Reading Card --- */
        .reading-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 8px 0 #dfe6e9, 0 10px 20px rgba(0,0,0,0.1);
            border: 2px solid #f1f2f6;
            position: relative;
        }

        .card-title {
            color: var(--primary-pink);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 1.4rem;
            margin-bottom: 20px;
            border-bottom: 2px dashed #e1bee7;
            padding-bottom: 10px;
        }

        .reading-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2f3542;
            white-space: pre-wrap; /* Preserves newlines */
        }

        /* --- Gap Styles --- */
        .gap-blank {
            display: inline-block;
            min-width: 80px;
            height: 30px;
            background: #f1f2f6;
            border-bottom: 3px solid #b2bec3;
            border-radius: 8px;
            margin: 0 5px;
            cursor: pointer;
            text-align: center;
            color: var(--primary-pink);
            font-weight: 800;
            vertical-align: middle;
            line-height: 30px;
            padding: 0 10px;
            transition: all 0.2s;
        }

        .gap-blank:hover {
            background: #dfe6e9;
            transform: scale(1.05);
        }

        .gap-blank.correct {
            background: #d4edda;
            color: var(--correct-green);
            border-bottom-color: var(--correct-green);
        }

        .gap-blank.wrong {
            background: #f8d7da;
            color: var(--wrong-red);
            border-bottom-color: var(--wrong-red);
            animation: shake 0.5s;
        }

        /* --- Glossary Table --- */
        .glossary-box {
            margin-top: 30px;
            background: #e0fbf6;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid var(--primary-teal);
        }

        .glossary-title {
            font-weight: 800;
            color: var(--primary-teal);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
        }

        .glossary-table th, .glossary-table td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid rgba(0, 201, 167, 0.3);
            font-size: 0.9rem;
        }
        
        .glossary-table th { color: var(--primary-teal); }
        .glossary-table td strong { color: #2d3436; }

        /* --- Explanation Box --- */
        .explanation-container {
            margin-top: 20px;
        }

        .expl-item {
            display: none; /* Hidden by default */
            background: #fff0f6;
            border-left: 5px solid var(--primary-pink);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: 0.95rem;
            animation: slideUp 0.4s ease-out;
        }

        .expl-header {
            font-weight: 800;
            color: var(--primary-pink);
            margin-bottom: 5px;
            font-size: 1.05rem;
        }

        /* --- Selection Popup (Modal) --- */
        .option-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .option-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 300px;
            text-align: center;
            animation: popIn 0.3s;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: white;
            border: 2px solid #dfe4ea;
            border-bottom: 5px solid #dfe4ea;
            border-radius: 15px;
            font-weight: 700;
            color: #57606f;
            cursor: pointer;
            transition: all 0.1s;
            font-size: 1rem;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            border-color: var(--primary-pink);
            color: var(--primary-pink);
        }
        
        .option-btn:active {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        /* --- Footer --- */
        .quiz-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 99;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
        }

        .score-box {
            font-weight: 800;
            color: var(--primary-teal);
            font-size: 1.4rem;
            background: #e0fbf6;
            padding: 8px 20px;
            border-radius: 50px;
            border: 2px solid var(--primary-teal);
        }

        .submit-btn {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 12px 35px;
            font-size: 1.1rem;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 6px 0 #6c429c;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
        }

        /* --- Animations --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- Result Modal --- */
        .result-modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            border: 4px solid var(--primary-teal);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .image-placeholder {
            border: 2px dashed #ccc;
            background: #f9f9f9;
            color: #888;
            padding: 10px;
            text-align: center;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <header class="header-bar">
        <h1 class="header-title">English Gap Fill</h1>
        <span class="teacher-name">Gi√°o vi√™n: Ms Mai An ULIS</span>
    </header>

    <div class="container" id="quiz-container">
        <div class="reading-card">
            <div class="card-title">‚ë† Announcement: Virtual Reality Experience</div>
            
            <div class="image-placeholder">
                <div style="font-size: 2rem;">ü•Ω</div>
                

[Image of Virtual Reality Event Poster]

            </div>

            <div class="reading-text">
Hello Everyone!
We are <span class="gap-blank" onclick="openGapModal(1, 'set1_q1')">(1)</span> to announce a "Virtual Reality Experience" event <span class="gap-blank" onclick="openGapModal(2, 'set1_q2')">(2)</span> November 15, 2024!
üïí Time: 2:00 PM - 5:00 PM
Location: Multimedia Room, 789 Technology Blvd, Da Nang
Explore <span class="gap-blank" onclick="openGapModal(3, 'set1_q3')">(3)</span> world of virtual reality and how it is changing education. Don‚Äôt miss the chance to <span class="gap-blank" onclick="openGapModal(4, 'set1_q4')">(4)</span> VR headsets!‚ú∂
Be part of this amazing experience!
Reserve your spot at [VREvent.com]!
Can‚Äôt wait to see you there!
            </div>

            <div class="glossary-box">
                <div class="glossary-title">üìö Glossary (T·ª´ v·ª±ng)</div>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                    <tr><td><strong>Virtual Reality</strong></td><td>(n.phr)</td><td>Th·ª±c t·∫ø ·∫£o</td></tr>
                    <tr><td><strong>Announce</strong></td><td>(v)</td><td>Th√¥ng b√°o</td></tr>
                    <tr><td><strong>Experience</strong></td><td>(n)</td><td>Tr·∫£i nghi·ªám</td></tr>
                    <tr><td><strong>Headset</strong></td><td>(n)</td><td>Tai nghe k√®m k√≠nh/mic</td></tr>
                    <tr><td><strong>Reserve</strong></td><td>(v)</td><td>ƒê·∫∑t ch·ªó tr∆∞·ªõc</td></tr>
                </table>
            </div>

            <div class="explanation-container" id="expl-container-1"></div>
        </div>

        <div class="reading-card">
            <div class="card-title">‚ë° We Are Hiring: Electric Device Technicians!</div>
            
            <div class="reading-text">
Do you have an interest in fixing electric devices? We are looking <span class="gap-blank" onclick="openGapModal(5, 'set2_q1')">(1)</span> skilled individuals to join our team as technicians. Here‚Äôs what you need to know:
A full-time position with <span class="gap-blank" onclick="openGapModal(6, 'set2_q2')">(2)</span> working hours.
Competitive pay and training provided.
No previous experience needed; we will teach you everything you need to know.
Apply by December 20, 2024, and help us <span class="gap-blank" onclick="openGapModal(7, 'set2_q3')">(3)</span> our customers‚Äô devices running smoothly!
Contact us:
Email: jobs@electricfixers.com
Phone: 039-111-222
Address: 789 Tech Avenue, <span class="gap-blank" onclick="openGapModal(8, 'set2_q4')">(4)</span> Electric City
            </div>

            <div class="glossary-box">
                <div class="glossary-title">üìö Glossary (T·ª´ v·ª±ng)</div>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                    <tr><td><strong>Technician</strong></td><td>(n)</td><td>K·ªπ thu·∫≠t vi√™n</td></tr>
                    <tr><td><strong>Individual</strong></td><td>(n)</td><td>C√° nh√¢n</td></tr>
                    <tr><td><strong>Competitive</strong></td><td>(adj)</td><td>C·∫°nh tranh (l∆∞∆°ng cao)</td></tr>
                    <tr><td><strong>Previous</strong></td><td>(adj)</td><td>Tr∆∞·ªõc ƒë√≥</td></tr>
                    <tr><td><strong>Smoothly</strong></td><td>(adv)</td><td>Tr√¥i ch·∫£y, m∆∞·ª£t m√†</td></tr>
                </table>
            </div>

            <div class="explanation-container" id="expl-container-2"></div>
        </div>

        <div class="reading-card">
            <div class="card-title">‚ë¢ Dear Students (Safety Letter)</div>
            
             <div class="image-placeholder">
                <div style="font-size: 2rem;">‚ö°</div>
                
            </div>

            <div class="reading-text">
Dear Students,
Understanding how to safely use electric devices is important. Incorrect usage can <span class="gap-blank" onclick="openGapModal(9, 'set3_q1')">(1)</span> accidents or device damage.
Be careful when using any new electric device <span class="gap-blank" onclick="openGapModal(10, 'set3_q2')">(2)</span> the first time.
Follow the <span class="gap-blank" onclick="openGapModal(11, 'set3_q3')">(3)</span> provided in the device manual to ensure proper usage.
Report any malfunctioning device to a trained technician or adult.
Let's keep our environment safe by handling <span class="gap-blank" onclick="openGapModal(12, 'set3_q4')">(4)</span> electric devices with care!
Best regards,
            </div>

            <div class="glossary-box">
                <div class="glossary-title">üìö Glossary (T·ª´ v·ª±ng)</div>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                    <tr><td><strong>Incorrect usage</strong></td><td>(n.phr)</td><td>S·ª≠ d·ª•ng sai c√°ch</td></tr>
                    <tr><td><strong>Damage</strong></td><td>(n)</td><td>Thi·ªát h·∫°i, h∆∞ h·ªèng</td></tr>
                    <tr><td><strong>Manual</strong></td><td>(n)</td><td>S√°ch h∆∞·ªõng d·∫´n</td></tr>
                    <tr><td><strong>Malfunctioning</strong></td><td>(adj)</td><td>B·ªã tr·ª•c tr·∫∑c, h·ªèng h√≥c</td></tr>
                    <tr><td><strong>Handle</strong></td><td>(v)</td><td>X·ª≠ l√Ω, c·∫ßm n·∫Øm</td></tr>
                </table>
            </div>

            <div class="explanation-container" id="expl-container-3"></div>
        </div>

    </div>

    <div class="quiz-footer">
        <div class="score-box">ƒêi·ªÉm: <span id="current-score">0</span>/12</div>
        <button class="submit-btn" onclick="finishQuiz()">N·ªôp b√†i</button>
    </div>

    <div class="option-modal" id="gap-modal">
        <div class="option-content">
            <h3 style="color:var(--primary-pink); margin-top:0;">Ch·ªçn ƒë√°p √°n</h3>
            <div id="modal-options-container">
                </div>
            <button onclick="closeModal()" style="margin-top:10px; background:none; border:none; color:#999; cursor:pointer;">ƒê√≥ng</button>
        </div>
    </div>

    <div class="option-modal" id="result-modal">
        <div class="result-modal-content">
            <h2 style="color:var(--primary-teal); margin-top:0;">T·ªîNG K·∫æT</h2>
            <p>Em ƒë√£ ho√†n th√†nh b√†i t·∫≠p!</p>
            <div style="font-size: 3rem; font-weight:800; color:var(--primary-pink); margin:10px 0;" id="final-score">0/12</div>
            <p id="teacher-message" style="font-weight: 700; color: #57606f;"></p>
            <button class="submit-btn" onclick="document.getElementById('result-modal').style.display='none'">Xem l·∫°i b√†i</button>
        </div>
    </div>

<script>
    // --- DATABASE ---
    // Note: Mapped based on context logic as per thinking process.
    const quizData = {
        // Exercise 1 (VR)
        // Correction: Q1 needs "excited" (Set 2), Q2 needs "on" (Set 1). 
        // Based on Input Data: 
        // 1. A. in B. out C. with D. on
        // 2. A. excited B. exciting C. enjoyed D. excitement
        // Blank (1) "We are ____ to announce" -> Needs Adjective -> Set 2.
        // Blank (2) "Event ____ November 15" -> Needs Preposition -> Set 1.
        // I will map logical IDs to the datasets provided.
        
        'set1_q1': { // Blank 1 - Needs "Excited"
            options: [
                {val: 'A', text: 'excited', correct: true},
                {val: 'B', text: 'exciting', correct: false},
                {val: 'C', text: 'enjoyed', correct: false},
                {val: 'D', text: 'excitement', correct: false}
            ],
            explId: 'expl-container-1',
            questionText: "(1) We are ______ to announce...",
            explanation: `
                <strong>D·ªãch:</strong> Ch√∫ng t√¥i r·∫•t <u>h√†o h·ª©ng</u> ƒë∆∞·ª£c th√¥ng b√°o...<br>
                <strong>Ph√¢n t√≠ch:</strong>
                <ul>
                    <li>A. excited (adj): h√†o h·ª©ng (ch·ªâ c·∫£m x√∫c ng∆∞·ªùi).</li>
                    <li>B. exciting (adj): th√∫ v·ªã (ch·ªâ t√≠nh ch·∫•t s·ª± v·∫≠t).</li>
                    <li>C. enjoyed (v): ƒë√£ th√≠ch.</li>
                    <li>D. excitement (n): s·ª± h√†o h·ª©ng.</li>
                </ul>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> C·∫•u tr√∫c "Be + adj + to V". Ch·ªß ng·ªØ "We" l√† ng∆∞·ªùi n√™n d√πng t√≠nh t·ª´ ƒëu√¥i -ed (excited) ƒë·ªÉ ch·ªâ c·∫£m x√∫c.
            `
        },
        'set1_q2': { // Blank 2 - Needs "On"
            options: [
                {val: 'A', text: 'in', correct: false},
                {val: 'B', text: 'out', correct: false},
                {val: 'C', text: 'with', correct: false},
                {val: 'D', text: 'on', correct: true}
            ],
            explId: 'expl-container-1',
            questionText: "(2) ...event ______ November 15!",
            explanation: `
                <strong>D·ªãch:</strong> ...s·ª± ki·ªán <u>v√†o</u> ng√†y 15 th√°ng 11!<br>
                <strong>Ph√¢n t√≠ch:</strong>
                <ul>
                    <li>A. in (+ th√°ng/nƒÉm/m√πa).</li>
                    <li>D. on (+ ng√†y c·ª• th·ªÉ/ng√†y trong tu·∫ßn).</li>
                </ul>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> Tr∆∞·ªõc ng√†y c·ª• th·ªÉ (November 15) ta b·∫Øt bu·ªôc d√πng gi·ªõi t·ª´ "On".
            `
        },
        'set1_q3': {
            options: [
                {val: 'A', text: 'a', correct: false},
                {val: 'B', text: 'no article', correct: false},
                {val: 'C', text: 'an', correct: false},
                {val: 'D', text: 'the', correct: true}
            ],
            explId: 'expl-container-1',
            questionText: "(3) Explore ______ world of virtual reality...",
            explanation: `
                <strong>D·ªãch:</strong> Kh√°m ph√° <u>th·∫ø gi·ªõi</u> th·ª±c t·∫ø ·∫£o...<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> "World" (th·∫ø gi·ªõi) l√† danh t·ª´ ch·ªâ s·ª± v·∫≠t duy nh·∫•t ho·∫∑c ƒë√£ ƒë∆∞·ª£c x√°c ƒë·ªãnh r√µ (c·ªßa th·ª±c t·∫ø ·∫£o). Ta d√πng m·∫°o t·ª´ x√°c ƒë·ªãnh "The". C·ª•m c·ªë ƒë·ªãnh: "The world of...".
            `
        },
        'set1_q4': {
            options: [
                {val: 'A', text: 'take on', correct: false},
                {val: 'B', text: 'try out', correct: true},
                {val: 'C', text: 'give up', correct: false},
                {val: 'D', text: 'come over', correct: false}
            ],
            explId: 'expl-container-1',
            questionText: "(4) Don‚Äôt miss the chance to ______ VR headsets!",
            explanation: `
                <strong>D·ªãch:</strong> ƒê·ª´ng b·ªè l·ª° c∆° h·ªôi <u>th·ª≠ nghi·ªám</u> k√≠nh VR!<br>
                <strong>Ph√¢n t√≠ch:</strong>
                <ul>
                    <li>A. take on: ƒë·∫£m nh·∫≠n.</li>
                    <li>B. try out: th·ª≠ nghi·ªám/d√πng th·ª≠.</li>
                    <li>C. give up: t·ª´ b·ªè.</li>
                    <li>D. come over: gh√© ch∆°i.</li>
                </ul>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> Trong ng·ªØ c·∫£nh gi·ªõi thi·ªáu s·∫£n ph·∫©m m·ªõi, "try out" (th·ª≠) l√† h·ª£p l√Ω nh·∫•t.
            `
        },

        // Exercise 2 (Job Ad)
        'set2_q1': {
            options: [
                {val: 'A', text: 'out', correct: false},
                {val: 'B', text: 'with', correct: false},
                {val: 'C', text: 'about', correct: false},
                {val: 'D', text: 'for', correct: true}
            ],
            explId: 'expl-container-2',
            questionText: "(1) We are looking ______ skilled individuals...",
            explanation: `
                <strong>D·ªãch:</strong> Ch√∫ng t√¥i ƒëang <u>t√¨m ki·∫øm</u> nh·ªØng c√° nh√¢n c√≥ tay ngh·ªÅ...<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> C·ª•m ƒë·ªông t·ª´ "Look for" = T√¨m ki·∫øm. "Look at" l√† nh√¨n, "Look after" l√† chƒÉm s√≥c.
            `
        },
        'set2_q2': {
            options: [
                {val: 'A', text: 'flexible', correct: true},
                {val: 'B', text: 'flexibly', correct: false},
                {val: 'C', text: 'flexibility', correct: false},
                {val: 'D', text: 'flex', correct: false}
            ],
            explId: 'expl-container-2',
            questionText: "(2) ...position with ______ working hours.",
            explanation: `
                <strong>D·ªãch:</strong> ...v·ªõi gi·ªù l√†m vi·ªác <u>linh ho·∫°t</u>.<br>
                <strong>Ph√¢n t√≠ch:</strong> Tr∆∞·ªõc c·ª•m danh t·ª´ "working hours", ta c·∫ßn m·ªôt T√≠nh t·ª´ (Adjective) ƒë·ªÉ b·ªï nghƒ©a.<br>
                <strong>ƒê√°p √°n:</strong> A. flexible (adj). (B l√† adv, C l√† noun, D l√† verb).
            `
        },
        'set2_q3': {
            options: [
                {val: 'A', text: 'keep', correct: true},
                {val: 'B', text: 'look', correct: false},
                {val: 'C', text: 'make', correct: false},
                {val: 'D', text: 'learn', correct: false}
            ],
            explId: 'expl-container-2',
            questionText: "(3) ...help us ______ our customers‚Äô devices running smoothly!",
            explanation: `
                <strong>D·ªãch:</strong> ...gi√∫p ch√∫ng t√¥i <u>gi·ªØ</u> cho thi·∫øt b·ªã c·ªßa kh√°ch h√†ng ho·∫°t ƒë·ªông tr∆°n tru!<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> C·∫•u tr√∫c: "Keep + O + V-ing/Adj" (Gi·ªØ cho c√°i g√¨ nh∆∞ th·∫ø n√†o/ti·∫øp t·ª•c l√†m g√¨). ·ªû ƒë√¢y l√† "Keep devices running".
            `
        },
        'set2_q4': {
            options: [
                {val: 'A', text: 'the', correct: false},
                {val: 'B', text: 'a', correct: false},
                {val: 'C', text: 'an', correct: false},
                {val: 'D', text: '‚àÖ (no article)', correct: true}
            ],
            explId: 'expl-container-2',
            questionText: "(4) Address: ..., ______ Electric City",
            explanation: `
                <strong>D·ªãch:</strong> ƒê·ªãa ch·ªâ: ..., Th√†nh ph·ªë Electric.<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> Tr∆∞·ªõc t√™n ri√™ng c·ªßa th√†nh ph·ªë (Electric City, Da Nang, Hanoi...), ta KH√îNG d√πng m·∫°o t·ª´ (No article/‚àÖ).
            `
        },

        // Exercise 3 (Safety)
        'set3_q1': {
            options: [
                {val: 'A', text: 'break down', correct: false},
                {val: 'B', text: 'block out', correct: false},
                {val: 'C', text: 'take note', correct: false},
                {val: 'D', text: 'lead to', correct: true}
            ],
            explId: 'expl-container-3',
            questionText: "(1) Incorrect usage can ______ accidents...",
            explanation: `
                <strong>D·ªãch:</strong> S·ª≠ d·ª•ng sai c√°ch c√≥ th·ªÉ <u>d·∫´n ƒë·∫øn</u> tai n·∫°n.<br>
                <strong>Ph√¢n t√≠ch:</strong>
                <ul>
                    <li>A. break down: h·ªèng.</li>
                    <li>D. lead to: d·∫´n ƒë·∫øn, g√¢y ra (= cause).</li>
                </ul>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> "Lead to" ph√π h·ª£p nh·∫•t v·ªÅ nghƒ©a nguy√™n nh√¢n - k·∫øt qu·∫£.
            `
        },
        'set3_q2': {
            options: [
                {val: 'A', text: 'with', correct: false},
                {val: 'B', text: 'about', correct: false},
                {val: 'C', text: 'for', correct: true},
                {val: 'D', text: 'from', correct: false}
            ],
            explId: 'expl-container-3',
            questionText: "(2) ...using any new electric device ______ the first time.",
            explanation: `
                <strong>D·ªãch:</strong> ...s·ª≠ d·ª•ng thi·∫øt b·ªã m·ªõi <u>l·∫ßn ƒë·∫ßu ti√™n</u>.<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> C·ª•m c·ªë ƒë·ªãnh (Collocation): "For the first time" (L·∫ßn ƒë·∫ßu ti√™n).
            `
        },
        'set3_q3': {
            options: [
                {val: 'A', text: 'instructions', correct: true},
                {val: 'B', text: 'instruct', correct: false},
                {val: 'C', text: 'instructor', correct: false},
                {val: 'D', text: 'instructing', correct: false}
            ],
            explId: 'expl-container-3',
            questionText: "(3) Follow the ______ provided in the device manual...",
            explanation: `
                <strong>D·ªãch:</strong> L√†m theo c√°c <u>h∆∞·ªõng d·∫´n</u> ƒë∆∞·ª£c cung c·∫•p trong s√°ch...<br>
                <strong>Ph√¢n t√≠ch:</strong> Sau m·∫°o t·ª´ "the" c·∫ßn m·ªôt Danh t·ª´.
                <ul>
                    <li>A. instructions (n): c√°c h∆∞·ªõng d·∫´n (v·∫≠t).</li>
                    <li>C. instructor (n): ng∆∞·ªùi h∆∞·ªõng d·∫´n (ng∆∞·ªùi).</li>
                </ul>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> S√°ch h∆∞·ªõng d·∫´n (manual) th√¨ ch·ª©a "instructions", kh√¥ng ch·ª©a "instructor".
            `
        },
        'set3_q4': {
            options: [
                {val: 'A', text: '‚àÖ (no article)', correct: true},
                {val: 'B', text: 'the', correct: false},
                {val: 'C', text: 'a', correct: false},
                {val: 'D', text: 'an', correct: false}
            ],
            explId: 'expl-container-3',
            questionText: "(4) ...handling ______ electric devices with care!",
            explanation: `
                <strong>D·ªãch:</strong> ...x·ª≠ l√Ω <u>c√°c thi·∫øt b·ªã ƒëi·ªán</u> c·∫©n th·∫≠n!<br>
                <strong>C√¥ Mai An gi·∫£i th√≠ch:</strong> "Electric devices" l√† danh t·ª´ s·ªë nhi·ªÅu ƒë·∫øm ƒë∆∞·ª£c, d√πng v·ªõi √Ω nghƒ©a chung chung (b·∫•t k·ª≥ thi·∫øt b·ªã n√†o). Do ƒë√≥ ta kh√¥ng d√πng m·∫°o t·ª´ (Zero article).
            `
        }
    };

    // --- VARIABLES ---
    let currentScore = 0;
    let currentBlankId = null;
    let currentKey = null;

    // Sounds
    const audioCorrect = new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");
    const audioWrong = new Audio("https://actions.google.com/sounds/v1/cartoon/clank_car_crash.ogg");

    // --- FUNCTIONS ---

    function openGapModal(blankIndex, key) {
        // Prevent re-opening answered gaps
        const gapEl = document.querySelector(`.gap-blank[onclick*="'${key}'"]`);
        if (gapEl.dataset.answered === "true") return;

        currentKey = key;
        const data = quizData[key];
        const container = document.getElementById('modal-options-container');
        
        container.innerHTML = ''; // Clear old options
        
        data.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `<strong>${opt.val}.</strong> ${opt.text}`;
            btn.onclick = () => selectAnswer(key, opt);
            container.appendChild(btn);
        });

        document.getElementById('gap-modal').style.display = 'flex';
    }

    function selectAnswer(key, option) {
        const gapEl = document.querySelector(`.gap-blank[onclick*="'${key}'"]`);
        const data = quizData[key];
        
        // Update Gap UI
        gapEl.textContent = option.text;
        gapEl.dataset.answered = "true";
        
        if (option.correct) {
            gapEl.classList.add('correct');
            currentScore++;
            audioCorrect.currentTime = 0;
            audioCorrect.play();
            // Confetti
            confetti({
                particleCount: 50,
                spread: 60,
                origin: { y: 0.7 }
            });
        } else {
            gapEl.classList.add('wrong');
            audioWrong.currentTime = 0;
            audioWrong.play();
        }

        // Update Score
        document.getElementById('current-score').innerText = currentScore;

        // Render Explanation Immediately
        renderExplanation(key, option.correct);

        // Close Modal
        closeModal();
    }

    function renderExplanation(key, isCorrect) {
        const data = quizData[key];
        const container = document.getElementById(data.explId);
        
        const div = document.createElement('div');
        div.className = 'expl-item';
        div.style.display = 'block';
        div.innerHTML = `
            <div class="expl-header">
                ${isCorrect ? '‚úÖ ƒê√∫ng r·ªìi!' : '‚ùå Ch∆∞a ch√≠nh x√°c!'} ${data.questionText}
            </div>
            ${data.explanation}
        `;
        container.appendChild(div);
    }

    function closeModal() {
        document.getElementById('gap-modal').style.display = 'none';
    }

    function finishQuiz() {
        const modal = document.getElementById('result-modal');
        const finalScoreEl = document.getElementById('final-score');
        const msgEl = document.getElementById('teacher-message');
        const total = 12;

        finalScoreEl.innerText = `${currentScore}/${total}`;

        const percentage = (currentScore / total) * 100;
        if (percentage === 100) {
            msgEl.innerText = "Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng·ªØ ph√°p! üåü";
            confetti({ particleCount: 200, spread: 150 });
        } else if (percentage >= 80) {
            msgEl.innerText = "R·∫•t t·ªët! Em n·∫Øm b√†i r·∫•t ch·∫Øc. üí™";
        } else if (percentage >= 50) {
            msgEl.innerText = "Kh√° l·∫Øm! H√£y xem l·∫°i c√°c l·ªói sai nh√©. üìö";
        } else {
            msgEl.innerText = "C·ªë l√™n! C√¥ Mai An s·∫Ω gi√∫p em ti·∫øn b·ªô h∆°n. ‚ù§Ô∏è";
        }

        modal.style.display = 'flex';
    }

</script>

</body>
</html>


