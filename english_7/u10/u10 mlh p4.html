<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 10: Energy Sources - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --success: #00D26A;
            --error: #FF4757;
            --text-dark: #2d3436;
            --bg-body: #f0f3f8;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f7f1e3;
            background-image: radial-gradient(#8854c0 15%, transparent 16%), radial-gradient(#00c9a7 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 4px solid var(--primary-pink);
        }

        h1 {
            color: var(--primary-pink);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 2rem;
            text-transform: uppercase;
        }

        .teacher-badge {
            display: inline-block;
            background: var(--primary-teal);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 10px;
        }

        /* CARD STYLES */
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border-bottom: 6px solid #e0e0e0;
            position: relative;
        }

        .section-title {
            color: var(--primary-pink);
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 20px;
            border-bottom: 3px dashed #ddd;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* BUTTONS */
        .btn-3d {
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            font-size: 1rem;
            width: 100%;
            text-align: left;
            background: #f1f2f6;
            color: #57606f;
            box-shadow: 0 5px 0 #ced6e0;
            margin-bottom: 10px;
            position: relative;
        }

        .btn-3d:hover {
            transform: scale(1.02);
            background: #dfe4ea;
        }

        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #ced6e0;
        }

        .btn-3d.correct {
            background: var(--success);
            color: white;
            box-shadow: 0 5px 0 #00b85c;
        }

        .btn-3d.wrong {
            background: var(--error);
            color: white;
            box-shadow: 0 5px 0 #d63031;
            animation: shake 0.5s;
        }

        /* EXPLANATION BOX */
        .explanation {
            background: #f8f9fa;
            border-left: 5px solid var(--primary-teal);
            padding: 15px;
            margin-top: 15px;
            border-radius: 10px;
            display: none;
            font-size: 0.95rem;
        }

        .explanation.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .teacher-note {
            font-weight: bold;
            color: var(--primary-pink);
            display: block;
            margin-bottom: 5px;
        }

        /* GAME SPECIFIC: SORTING */
        .sorting-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .word-pool {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            background: #f1f2f6;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .word-item {
            background: white;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #ddd;
            border: 2px solid transparent;
        }
        
        .word-item.selected {
            border-color: var(--primary-pink);
            background: #efe4ff;
        }

        .word-item.done {
            opacity: 0.5;
            cursor: default;
            background: #ddd;
            box-shadow: none;
        }

        .bin-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            gap: 20px;
        }

        .bin {
            flex: 1;
            min-height: 150px;
            background: #fff;
            border: 3px dashed var(--primary-teal);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bin:hover {
            background: #e0fffa;
        }

        .bin h3 {
            margin: 0 0 10px 0;
            color: var(--primary-teal);
            text-align: center;
        }

        /* STRESS PATTERN BUTTONS */
        .stress-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .stress-btn {
            flex: 1;
            text-align: center;
            padding: 10px;
        }

        /* READING GLOSSARY */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .glossary-table th {
            background: var(--primary-pink);
            color: white;
            padding: 10px;
            text-align: left;
        }
        
        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .glossary-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .passage-box {
            background: #fff8e1;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #ffc107;
            margin-bottom: 20px;
            font-family: 'Georgia', serif;
            font-size: 1.05rem;
        }

        /* GAP FILL POPUP */
        .gap-blank {
            display: inline-block;
            min-width: 60px;
            border-bottom: 2px solid var(--primary-pink);
            color: var(--primary-pink);
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            padding: 0 5px;
        }
        .gap-blank.filled {
            color: var(--text-dark);
            border-bottom-color: var(--success);
        }

        .gap-options-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            width: 80%;
            max-width: 400px;
        }
        .gap-options-modal h3 {
            margin-top: 0;
            text-align: center;
            color: var(--primary-pink);
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* FOOTER */
        .footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10%;
            box-sizing: border-box;
            z-index: 900;
        }

        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 0 #5f2a96;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        #score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-teal);
        }

        /* CONFETTI CANVAS */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
        }
        
        /* PHONETICS UNDERLINE */
        u {
            text-decoration-color: var(--primary-pink);
            text-decoration-thickness: 3px;
        }
        
        /* True/False Buttons specific */
        .tf-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .tf-btn {
            flex: 1;
            text-align: center;
        }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>Unit 10: Energy Sources</h1>
        <div class="teacher-badge">Ms. Mai An ULIS - Super Teacher</div>
    </header>

    <div class="card" id="section-phonetics-1">
        <div class="section-title">üéµ I. Phonetics: Sorting Challenge</div>
        <p>Ch·ªçn m·ªôt t·ª´ trong "B·ªÉ t·ª´ v·ª±ng" (Word Pool) r·ªìi b·∫•m v√†o gi·ªè t∆∞∆°ng ·ª©ng!</p>
        
        <div class="word-pool" id="word-pool">
            </div>

        <div class="bin-container">
            <div class="bin" onclick="checkSort(1, this)">
                <h3>Stress on 1st Syllable</h3>
                <div class="bin-content" id="bin-1"></div>
            </div>
            <div class="bin" onclick="checkSort(2, this)">
                <h3>Stress on 2nd Syllable</h3>
                <div class="bin-content" id="bin-2"></div>
            </div>
        </div>
        <div class="explanation" id="expl-sort">
            <span class="teacher-note">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</span>
            <div id="expl-sort-content"></div>
        </div>
    </div>

    <div class="card">
        <div class="section-title">üéµ II. Supply Stress Pattern</div>
        <p>Ch·ªçn v·ªã tr√≠ tr·ªçng √¢m (1, 2 ho·∫∑c 3) cho c√°c t·ª´ sau:</p>
        <div id="phonetics-2-container">
            </div>
    </div>

    <div class="card">
        <div class="section-title">üìñ D. Reading I: Gap Fill</div>
        <p>Click v√†o ch·ªó tr·ªëng ƒë·ªÉ ch·ªçn t·ª´ th√≠ch h·ª£p t·ª´ trong h·ªôp.</p>
        
        <div style="background: #e1f5fe; padding: 10px; border-radius: 10px; margin-bottom: 15px; font-weight: bold; color: #0277bd; text-align: center;">
            BOX: electricity, hard, new, conserve, recycled, turn, cardboard, gasoline
        </div>

        <div class="passage-box">
            What can you do to take care of natural resources?<br><br>
            You can reduce, reuse, and recycle! For example, (1) <span class="gap-blank" onclick="openGapModal(1)">_____</span> off the lights when you are not in a room and switch off the TV or other electrical appliances when you are not using. This will reduce the use of fossil fuel used to make (2) <span class="gap-blank" onclick="openGapModal(2)">_____</span>. Ride your bicycle and walk more, to reduce the amount of (3) <span class="gap-blank" onclick="openGapModal(3)">_____</span> used to transport you. You can reuse things. Things like plastic jugs, jars, paper, and bags can be reused. Each time you reuse something, you (4) <span class="gap-blank" onclick="openGapModal(4)">_____</span> the natural resources that would have been used to make new ones. Finally, you can recycle. Recycle means to reuse a natural resource or product to make something (5) <span class="gap-blank" onclick="openGapModal(5)">_____</span>. It also means to collect and send these things for reuse. Items that can be easily (6) <span class="gap-blank" onclick="openGapModal(6)">_____</span> include: glass, some plastics, paper, (7) <span class="gap-blank" onclick="openGapModal(7)">_____</span>, aluminum, and steel. Some plastics and metals are hard to recycle. They are often made from mixtures of materials. Mixtures can be (8) <span class="gap-blank" onclick="openGapModal(8)">_____</span> to separate. Try to buy and use things that you can recycle!
        </div>
        
        <table class="glossary-table">
            <thead><tr><th>Word</th><th>Type</th><th>Vietnamese Meaning</th></tr></thead>
            <tbody>
                <tr><td>Natural resources</td><td>(n.phr)</td><td>T√†i nguy√™n thi√™n nhi√™n</td></tr>
                <tr><td>Appliance</td><td>(n)</td><td>Thi·∫øt b·ªã (ƒëi·ªán)</td></tr>
                <tr><td>Fossil fuel</td><td>(n.phr)</td><td>Nhi√™n li·ªáu h√≥a th·∫°ch</td></tr>
                <tr><td>Mixture</td><td>(n)</td><td>H·ªón h·ª£p</td></tr>
                <tr><td>Separate</td><td>(v)</td><td>T√°ch r·ªùi</td></tr>
            </tbody>
        </table>

        <div id="gap-explanations"></div>
    </div>

    <div class="card">
        <div class="section-title">üìñ D. Reading II: Comprehension</div>
        
        <div class="passage-box">
            We use many different energy sources to do work. Energy sources are classified into two groups - renewable and nonrenewable.<br>
            Non-renewable energy sources are those that take millions of years to form and will run out some day. It is energy that comes from fossil fuels such as coal, crude oil, and natural gas. Fossil fuels are mainly made up of carbon and were formed millions of years ago. The chemical reaction which takes place when we burn fossil fuels releases carbon compounds such as carbon monoxide and carbon dioxide into the air. Carbon dioxide is one of the greenhouse gases which is contributing to global warming and air pollution.<br>
            On the other hand, renewable energy sources will never run out, are better for the environment and do not cause pollution. Renewable energy is often called green energy because it is a natural energy, always available and does not have to be formed like nonrenewable energy. The green energy is always there. For example, the sun consistently shines, water is abundant, and the wind blows day after day. The five types include solar, energy from the sun; geothermal, energy from heat within the Earth; hydroelectric, energy from moving water; biomass, energy from dead plants and microorganisms and finally, energy from the wind.
        </div>

        <table class="glossary-table">
            <thead><tr><th>Word</th><th>Type</th><th>Vietnamese Meaning</th></tr></thead>
            <tbody>
                <tr><td>Non-renewable</td><td>(adj)</td><td>Kh√¥ng th·ªÉ t√°i t·∫°o</td></tr>
                <tr><td>Classify</td><td>(v)</td><td>Ph√¢n lo·∫°i</td></tr>
                <tr><td>Release</td><td>(v)</td><td>Th·∫£i ra, ph√≥ng th√≠ch</td></tr>
                <tr><td>Greenhouse gas</td><td>(n)</td><td>Kh√≠ nh√† k√≠nh</td></tr>
                <tr><td>Geothermal</td><td>(adj)</td><td>ƒê·ªãa nhi·ªát</td></tr>
                <tr><td>Microorganism</td><td>(n)</td><td>Vi sinh v·∫≠t</td></tr>
                <tr><td>Consistent</td><td>(adj)</td><td>Ki√™n ƒë·ªãnh, lu√¥n lu√¥n</td></tr>
                <tr><td>Abundant</td><td>(adj)</td><td>D·ªìi d√†o, phong ph√∫</td></tr>
            </tbody>
        </table>

        <h3>A. True (T) or False (F)</h3>
        <div id="tf-container"></div>

        <h3>B. Multiple Choice</h3>
        <div id="mcq-container"></div>
    </div>
    
    <div style="height: 100px;"></div> </div>

<div class="gap-options-modal" id="gap-modal">
    <h3>Ch·ªçn t·ª´ th√≠ch h·ª£p</h3>
    <div id="gap-options-list"></div>
    <button class="btn-3d" onclick="closeGapModal()" style="margin-top:10px; background: #ddd;">ƒê√≥ng</button>
</div>

<div class="footer-bar">
    <div id="score-display">ƒêi·ªÉm s·ªë: 0/0</div>
    <button class="submit-btn" onclick="finishTest()">N·ªòP B√ÄI üöÄ</button>
</div>

<script>
    // Simple Web Audio API for sounds to avoid external files
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
            fireConfetti();
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }
</script>

<script>
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let confetti = [];

    function fireConfetti() {
        for (let i = 0; i < 100; i++) {
            confetti.push({
                x: window.innerWidth / 2,
                y: window.innerHeight / 2,
                w: Math.random() * 10 + 5,
                h: Math.random() * 5 + 5,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                vx: (Math.random() - 0.5) * 20,
                vy: (Math.random() - 0.5) * 20,
                grav: 0.1
            });
        }
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach((c, index) => {
            c.x += c.vx;
            c.y += c.vy;
            c.vy += c.grav;
            c.vx *= 0.95;
            ctx.fillStyle = c.color;
            ctx.fillRect(c.x, c.y, c.w, c.h);
            if (c.y > canvas.height) confetti.splice(index, 1);
        });
        requestAnimationFrame(animateConfetti);
    }
    animateConfetti();
</script>

<script>
    // --- DATA ---
    
    // Phonetics I
    const sortWords = [
        {w: 'energy', s: 1}, {w: 'biogas', s: 1}, {w: 'plentiful', s: 1}, {w: 'pollution', s: 2},
        {w: 'limited', s: 1}, {w: 'unusual', s: 2}, {w: 'natural', s: 1}, {w: 'develop', s: 2},
        {w: 'consumption', s: 2}, {w: 'easily', s: 1}, {w: 'dioxide', s: 2}, {w: 'recycle', s: 2},
        {w: 'countryside', s: 1}, {w: 'improvement', s: 2}, {w: 'generate', s: 1}, {w: 'dangerous', s: 1},
        {w: 'atmosphere', s: 1}, {w: 'important', s: 2}, {w: 'advantage', s: 2}, {w: 'tomorrow', s: 2}
    ];

    // Phonetics II
    const stressPatternData = [
        {w: 'countryside', a: 1, expl: "Danh t·ª´ gh√©p (Compound Noun) th∆∞·ªùng nh·∫•n √¢m 1. <b>COUN</b>-try-side."},
        {w: 'enormous', a: 2, expl: "T√≠nh t·ª´ 3 √¢m ti·∫øt, √¢m 2 l√† nguy√™n √¢m d√†i. e-<b>NOR</b>-mous."},
        {w: 'solar', a: 1, expl: "T√≠nh t·ª´ 2 √¢m ti·∫øt th∆∞·ªùng nh·∫•n √¢m 1. <b>SO</b>-lar."},
        {w: 'renewable', a: 2, expl: "Ti·ªÅn t·ªë 're-' v√† h·∫≠u t·ªë '-able' kh√¥ng nh·∫≠n tr·ªçng √¢m. re-<b>NEW</b>-a-ble."},
        {w: 'available', a: 2, expl: "√Çm ƒë√¥i /ei/ th∆∞·ªùng nh·∫≠n tr·ªçng √¢m. a-<b>VAI</b>-la-ble."},
        {w: 'abundant', a: 2, expl: "√Çm 2 l√† √¢m m·∫°nh /b ån/. a-<b>BUN</b>-dant."},
        {w: 'another', a: 2, expl: "Nguy√™n √¢m ∆° ng·∫Øn ƒë·∫ßu kh√¥ng nh·∫≠n tr·ªçng √¢m. a-<b>NO</b>-ther."},
        {w: 'harmful', a: 1, expl: "H·∫≠u t·ªë '-ful' kh√¥ng nh·∫≠n tr·ªçng √¢m. <b>HARM</b>-ful."},
        {w: 'convenient', a: 2, expl: "Tr·ªçng √¢m r∆°i v√†o ngay tr∆∞·ªõc √¢m 'ient'. con-<b>VE</b>-nient."},
        {w: 'negative', a: 1, expl: "T√≠nh t·ª´ 3 √¢m ti·∫øt, √¢m ƒë·∫ßu m·∫°nh. <b>NE</b>-ga-tive."},
        {w: 'forever', a: 2, expl: "Tr·∫°ng t·ª´. for-<b>E</b>-ver."},
        {w: 'hydro', a: 1, expl: "Ti·ªÅn t·ªë Hydro nh·∫•n √¢m 1. <b>HY</b>-dro."},
        {w: 'effective', a: 2, expl: "√Çm ƒë·∫ßu l√† /…™/ (ng·∫Øn), tr·ªçng √¢m v√†o √¢m 2. ef-<b>FEC</b>-tive."},
        {w: 'exhaustible', a: 2, expl: "√Çm h c√¢m, tr·ªçng √¢m r∆°i v√†o nguy√™n √¢m sau n√≥. ex-<b>HAUS</b>-ti-ble."},
        {w: 'nuclear', a: 1, expl: "T√≠nh t·ª´ 2 √¢m ti·∫øt. <b>NU</b>-cle-ar."},
        {w: 'alternative', a: 2, expl: "Tr·ªçng √¢m r∆°i v√†o √¢m 2. al-<b>TER</b>-na-tive."}
    ];

    // Reading I (Gap Fill)
    const gapData = {
        1: {a: "turn", expl: "<b>Turn off</b> (phr.v): T·∫Øt. C·∫•u tr√∫c 'Turn off the lights' (T·∫Øt ƒë√®n)."},
        2: {a: "electricity", expl: "Fossil fuel (nhi√™n li·ªáu h√≥a th·∫°ch) ƒë∆∞·ª£c ƒë·ªët ƒë·ªÉ t·∫°o ra <b>electricity</b> (ƒëi·ªán nƒÉng)."},
        3: {a: "gasoline", expl: "Li√™n quan ƒë·∫øn 'transport' (giao th√¥ng) v√† 'fossil fuel' -> <b>gasoline</b> (xƒÉng)."},
        4: {a: "conserve", expl: "Reuse (t√°i s·ª≠ d·ª•ng) gi√∫p <b>conserve</b> (b·∫£o t·ªìn) t√†i nguy√™n thi√™n nhi√™n."},
        5: {a: "new", expl: "Recycle (T√°i ch·∫ø) l√† d√πng v·∫≠t li·ªáu c≈© ƒë·ªÉ l√†m ra c√°i g√¨ ƒë√≥ <b>new</b> (m·ªõi)."},
        6: {a: "recycled", expl: "C√¢u b·ªã ƒë·ªông: can be easily + V3/ed. <b>Recycled</b> (ƒë∆∞·ª£c t√°i ch·∫ø)."},
        7: {a: "cardboard", expl: "Li·ªát k√™ c√°c v·∫≠t li·ªáu: glass, plastics, paper... -> <b>cardboard</b> (b√¨a c√°c-t√¥ng)."},
        8: {a: "hard", expl: "Tr∆∞·ªõc ƒë√≥ n√≥i 'Some plastics... are hard to recycle'. V√¨ h·ªón h·ª£p (mixtures) r·∫•t <b>hard</b> (kh√≥) ƒë·ªÉ t√°ch ra."}
    };
    const gapBox = ["electricity", "hard", "new", "conserve", "recycled", "turn", "cardboard", "gasoline"];

    // Reading II - TF
    const tfData = [
        {q: "Non-renewable energy is a source of energy that will eventually run out.", a: true, expl: "ƒê√∫ng. B√†i ƒë·ªçc: '...will run out some day'."},
        {q: "Renewable energy comes from natural sources, like sunlight, wind, water, and heat of the earth.", a: true, expl: "ƒê√∫ng. D·∫´n ch·ª©ng ƒëo·∫°n 3 li·ªát k√™: sun, geothermal (heat), hydroelectric (water), wind."},
        {q: "Burning fossil fuels is harmful to the environment.", a: true, expl: "ƒê√∫ng. D·∫´n ch·ª©ng: '...releases carbon... contributing to global warming'."},
        {q: "Renewable resources are better for the environment, but they are limited in supply.", a: false, expl: "Sai. D·∫´n ch·ª©ng: '...will never run out' v√† 'always available'. Kh√¥ng h·ªÅ limited (h·∫°n ch·∫ø)."},
        {q: "Carbon is the main element in fossil fuels.", a: true, expl: "ƒê√∫ng. D·∫´n ch·ª©ng: 'Fossil fuels are mainly made up of carbon'."},
        {q: "Wind is the primary source of hydroelectric energy.", a: false, expl: "Sai. Hydroelectric l√† 'energy from moving water' (t·ª´ n∆∞·ªõc), kh√¥ng ph·∫£i gi√≥."}
    ];

    // Reading II - MCQ
    const mcqData = [
        {
            q: "Question 1: What are fossil fuels according to the passage?",
            opts: ["A. Energy from sun/wind", "B. Energy from coal, crude oil, natural gas", "C. From dead plants", "D. From heat in Earth"],
            correct: 1, // Index B
            expl: "<b>D·∫´n ch·ª©ng:</b> 'It is energy that comes from fossil fuels such as coal, crude oil, and natural gas.'<br><b>T·∫°i sao sai:</b> A l√† renewable. C l√† biomass. D l√† geothermal."
        },
        {
            q: "Question 2: When were fossil fuels formed?",
            opts: ["A. Recently", "B. A few years ago", "C. Millions of years ago", "D. In the future"],
            correct: 2, // Index C
            expl: "<b>D·∫´n ch·ª©ng:</b> '...formed millions of years ago' (h√¨nh th√†nh h√†ng tri·ªáu nƒÉm tr∆∞·ªõc)."
        },
        {
            q: "Question 3: Do carbon dioxide emissions cause global warming...?",
            opts: ["A. No, good for env", "B. Yes, contribute to global warming", "C. No, affect water", "D. Yes, only affect plants"],
            correct: 1,
            expl: "<b>D·∫´n ch·ª©ng:</b> 'Carbon dioxide is one of the greenhouse gases which is contributing to global warming and air pollution.'"
        },
        {
            q: "Question 4: How many types of renewable energy sources mentioned?",
            opts: ["A. Three", "B. Four", "C. Five: solar, geothermal, hydroelectric, biomass, wind", "D. Two"],
            correct: 2,
            expl: "<b>D·∫´n ch·ª©ng:</b> 'The five types include solar... geothermal... hydroelectric... biomass... wind.'"
        },
        {
            q: "Question 5: Are renewable energy sources bad for the environment?",
            opts: ["A. Yes", "B. No, they are better for the environment", "C. Yes, run out", "D. No, hard to find"],
            correct: 1,
            expl: "<b>D·∫´n ch·ª©ng:</b> '...are better for the environment and do not cause pollution.'"
        },
        {
            q: "Question 6: Why is renewable energy often called 'green energy'?",
            opts: ["A. Colored green", "B. From fossil fuels", "C. Because it is natural, always available...", "D. Takes millions of years"],
            correct: 2,
            expl: "<b>D·∫´n ch·ª©ng:</b> 'called green energy because it is a natural energy, always available and does not have to be formed...'"
        }
    ];

    // --- STATE & RENDER ---
    let selectedSortWord = null;
    let score = 0;
    let totalQuestions = 0;

    // INIT
    window.onload = function() {
        renderSorting();
        renderStressPattern();
        renderTF();
        renderMCQ();
        updateScoreDisplay();
    };

    function updateScoreDisplay() {
        document.getElementById('score-display').innerText = `ƒêi·ªÉm c·ªßa con: ${score}`;
    }

    // 1. SORTING LOGIC
    function renderSorting() {
        const pool = document.getElementById('word-pool');
        sortWords.forEach((item, index) => {
            let div = document.createElement('div');
            div.className = 'word-item';
            div.innerText = item.w;
            div.onclick = function() {
                if (div.classList.contains('done')) return;
                // Deselect others
                document.querySelectorAll('.word-item').forEach(el => el.classList.remove('selected'));
                div.classList.add('selected');
                selectedSortWord = { ...item, element: div };
            };
            pool.appendChild(div);
        });
        totalQuestions += sortWords.length;
    }

    function checkSort(binType, binElement) {
        if (!selectedSortWord) {
            alert("Con h√£y ch·ªçn m·ªôt t·ª´ ·ªü tr√™n tr∆∞·ªõc nh√©!");
            return;
        }

        const explBox = document.getElementById('expl-sort');
        const explContent = document.getElementById('expl-sort-content');
        
        if (selectedSortWord.s === binType) {
            playSound('correct');
            score++;
            updateScoreDisplay();
            
            // Move visuals
            let p = document.createElement('p');
            p.innerText = selectedSortWord.w;
            p.style.margin = "2px";
            p.style.fontWeight = "bold";
            p.style.color = "#00D26A";
            binElement.querySelector('.bin-content').appendChild(p);
            
            selectedSortWord.element.classList.add('done');
            selectedSortWord.element.classList.remove('selected');
            
            explContent.innerHTML = `Ch√≠nh x√°c! T·ª´ <b>${selectedSortWord.w}</b> c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© <b>${binType}</b>.`;
        } else {
            playSound('wrong');
            explContent.innerHTML = `·ªí ti·∫øc qu√°! T·ª´ <b>${selectedSortWord.w}</b> c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© <b>${selectedSortWord.s}</b> c∆°!`;
        }
        
        explBox.style.display = 'block';
        selectedSortWord = null;
    }

    // 2. STRESS PATTERN LOGIC
    function renderStressPattern() {
        const container = document.getElementById('phonetics-2-container');
        stressPatternData.forEach((item, idx) => {
            let row = document.createElement('div');
            row.style.marginBottom = "15px";
            row.style.padding = "10px";
            row.style.borderBottom = "1px solid #eee";
            
            row.innerHTML = `
                <div style="font-size: 1.1rem; font-weight: bold;">${idx+1}. ${item.w}</div>
                <div class="stress-options">
                    <button class="btn-3d stress-btn" onclick="checkStress(this, ${item.a}, 1, '${item.w}', '${item.expl}')">1st</button>
                    <button class="btn-3d stress-btn" onclick="checkStress(this, ${item.a}, 2, '${item.w}', '${item.expl}')">2nd</button>
                    <button class="btn-3d stress-btn" onclick="checkStress(this, ${item.a}, 3, '${item.w}', '${item.expl}')">3rd</button>
                </div>
                <div class="explanation" id="expl-stress-${idx}"></div>
            `;
            container.appendChild(row);
        });
        totalQuestions += stressPatternData.length;
    }

    function checkStress(btn, correctVal, chosenVal, word, explText) {
        if (btn.parentElement.classList.contains('locked')) return;
        btn.parentElement.classList.add('locked'); // Lock buttons

        const explDiv = btn.parentElement.nextElementSibling;
        
        if (correctVal === chosenVal) {
            btn.classList.add('correct');
            playSound('correct');
            score++;
            explDiv.innerHTML = `<span class="teacher-note">ƒê√∫ng r·ªìi!</span> ${explText}`;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Find and highlight correct
            const allBtns = btn.parentElement.querySelectorAll('button');
            allBtns[correctVal-1].classList.add('correct');
            explDiv.innerHTML = `<span class="teacher-note" style="color:var(--error)">Ch∆∞a ƒë√∫ng r·ªìi!</span> ${explText}`;
        }
        explDiv.classList.add('show');
        updateScoreDisplay();
    }

    // 3. READING I: GAP FILL
    let currentGapId = 0;
    
    function openGapModal(id) {
        currentGapId = id;
        const list = document.getElementById('gap-options-list');
        list.innerHTML = '';
        
        gapBox.forEach(word => {
            let btn = document.createElement('button');
            btn.className = 'btn-3d';
            btn.innerText = word;
            btn.onclick = () => checkGap(word);
            list.appendChild(btn);
        });
        
        document.getElementById('gap-modal').style.display = 'block';
    }

    function closeGapModal() {
        document.getElementById('gap-modal').style.display = 'none';
    }

    function checkGap(word) {
        closeGapModal();
        const correctInfo = gapData[currentGapId];
        const span = document.querySelector(`.gap-blank[onclick="openGapModal(${currentGapId})"]`);
        const explArea = document.getElementById('gap-explanations');
        
        // Remove previous expl for this gap if exists
        const oldExpl = document.getElementById(`gap-expl-${currentGapId}`);
        if(oldExpl) oldExpl.remove();

        const explDiv = document.createElement('div');
        explDiv.id = `gap-expl-${currentGapId}`;
        explDiv.className = 'explanation show';
        explDiv.style.marginBottom = '10px';

        span.innerText = word;
        span.classList.add('filled');

        if (word === correctInfo.a) {
            span.style.color = "var(--success)";
            span.style.borderBottomColor = "var(--success)";
            playSound('correct');
            score++;
            explDiv.innerHTML = `<b>(${currentGapId}) Correct:</b> ${correctInfo.expl}`;
        } else {
            span.style.color = "var(--error)";
            span.style.borderBottomColor = "var(--error)";
            playSound('wrong');
            explDiv.innerHTML = `<b>(${currentGapId}) Sai r·ªìi:</b> ƒê√°p √°n ƒë√∫ng l√† <b style="color:var(--success)">${correctInfo.a}</b>. <br> ${correctInfo.expl}`;
        }
        
        explArea.appendChild(explDiv);
        updateScoreDisplay();
        // Disable click
        span.removeAttribute('onclick');
    }
    // Count gap questions
    totalQuestions += 8;

    // 4. READING II: TF & MCQ
    function renderTF() {
        const container = document.getElementById('tf-container');
        tfData.forEach((item, idx) => {
            let div = document.createElement('div');
            div.style.background = "#f9f9f9";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";
            div.style.borderRadius = "10px";
            
            div.innerHTML = `
                <p><b>${idx+1}.</b> ${item.q}</p>
                <div class="tf-container">
                    <button class="btn-3d tf-btn" onclick="checkTF(this, true, ${item.a}, '${item.expl.replace(/'/g, "\\'")}')">TRUE</button>
                    <button class="btn-3d tf-btn" onclick="checkTF(this, false, ${item.a}, '${item.expl.replace(/'/g, "\\'")}')">FALSE</button>
                </div>
                <div class="explanation"></div>
            `;
            container.appendChild(div);
        });
        totalQuestions += tfData.length;
    }

    function checkTF(btn, userChoice, answer, expl) {
        if(btn.parentElement.classList.contains('locked')) return;
        btn.parentElement.classList.add('locked');

        const explDiv = btn.parentElement.nextElementSibling;
        
        if (userChoice === answer) {
            btn.classList.add('correct');
            playSound('correct');
            score++;
            explDiv.innerHTML = `<span class="teacher-note">Tuy·ªát v·ªùi!</span> ${expl}`;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Highlight correct one
            const btns = btn.parentElement.querySelectorAll('button');
            const correctBtnIndex = answer ? 0 : 1;
            btns[correctBtnIndex].classList.add('correct');
            explDiv.innerHTML = `<span class="teacher-note" style="color:var(--error)">Ch∆∞a ƒë√∫ng!</span> ${expl}`;
        }
        explDiv.classList.add('show');
        updateScoreDisplay();
    }

    function renderMCQ() {
        const container = document.getElementById('mcq-container');
        mcqData.forEach((item, idx) => {
            let div = document.createElement('div');
            div.className = 'card'; // nested card style
            div.style.boxShadow = "none";
            div.style.border = "1px solid #eee";
            
            let optsHTML = '';
            item.opts.forEach((opt, optIdx) => {
                optsHTML += `<button class="btn-3d" onclick="checkMCQ(this, ${optIdx}, ${item.correct}, '${item.expl.replace(/'/g, "\\'")}')">${opt}</button>`;
            });

            div.innerHTML = `
                <p style="font-weight:bold; color: var(--primary-pink);">${item.q}</p>
                ${optsHTML}
                <div class="explanation"></div>
            `;
            container.appendChild(div);
        });
        totalQuestions += mcqData.length;
    }

    function checkMCQ(btn, choiceIdx, correctIdx, expl) {
        if(btn.parentElement.querySelector('.explanation').style.display === 'block') return; // already answered

        const container = btn.parentElement;
        const allBtns = container.querySelectorAll('button');
        const explDiv = container.querySelector('.explanation');

        if (choiceIdx === correctIdx) {
            btn.classList.add('correct');
            playSound('correct');
            score++;
            explDiv.innerHTML = `<span class="teacher-note">Ch√≠nh x√°c!</span> ${expl}`;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            allBtns[correctIdx].classList.add('correct'); // Reveal correct
            explDiv.innerHTML = `<span class="teacher-note" style="color:var(--error)">Sai m·∫•t r·ªìi!</span> ${expl}`;
        }
        explDiv.classList.add('show');
        updateScoreDisplay();
    }

    function finishTest() {
        const percentage = Math.round((score / totalQuestions) * 100);
        let msg = "";
        if(percentage >= 90) msg = "Xu·∫•t s·∫Øc! Con ƒë√∫ng l√† thi√™n t√†i ti·∫øng Anh! üåü";
        else if(percentage >= 70) msg = "L√†m t·ªët l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa l√† ho√†n h·∫£o! üí™";
        else msg = "C·∫ßn √¥n t·∫≠p th√™m nh√©! ƒê·ª´ng n·∫£n ch√≠! üìö";

        alert(`T·ªîNG K·∫æT:\nS·ªë c√¢u ƒë√∫ng: ${score}/${totalQuestions}\n\n${msg}`);
    }

</script>

</body>
</html>