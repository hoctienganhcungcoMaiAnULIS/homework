<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Tenses Challenge - Ms Mai An</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f3f5;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #dfe6e9;
            background-image: radial-gradient(#8854C0 1px, transparent 1px), radial-gradient(#00C9A7 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            padding-bottom: 20px;
        }

        /* Header nh·ªè g·ªçn */
        .header-info {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 700;
            text-align: left;
            border-bottom: 4px solid #6c4299;
        }

        /* Progress Bar */
        .progress-container {
            height: 10px;
            background: #eee;
            width: 100%;
        }
        .progress-bar {
            height: 100%;
            background: var(--secondary);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Question Area */
        .question-box {
            padding: 30px;
            text-align: center;
        }

        .question-text {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 3D Button Style */
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 5px 0 #cccccc;
            position: relative;
            outline: none;
        }

        .option-btn:hover {
            transform: scale(1.02);
            background-color: #f9f9f9;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #cccccc;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 5px 0 #00b85c;
        }
        
        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #e0404f;
            box-shadow: 0 5px 0 #e0404f;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation-box {
            display: none;
            margin: 20px;
            background: #f0fdf4;
            border: 2px solid var(--correct);
            border-radius: 15px;
            padding: 20px;
            text-align: left;
            animation: slideIn 0.5s ease;
        }
        
        .explanation-box.wrong-mode {
            background: #fff5f5;
            border-color: var(--wrong);
        }

        .exp-title {
            font-weight: 800;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin: 5px 0;
            line-height: 1.5;
        }

        .exp-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }
        .tag-green { background: var(--correct); }
        .tag-red { background: var(--wrong); }
        .tag-blue { background: var(--primary); }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            font-size: 14px;
        }
        .vocab-table th, .vocab-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .vocab-table th {
            background-color: #f2f2f2;
            color: var(--primary);
        }

        /* Next Button */
        .next-btn {
            display: none;
            margin: 20px auto;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 20px;
            font-weight: 800;
            border-radius: 30px;
            box-shadow: 0 5px 0 #00a388;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .next-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #00a388;
        }

        /* Modal K·∫øt qu·∫£ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .score-display {
            font-size: 48px;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header-info">
        Gi√°o vi√™n t·∫°o: Ms Mai An ULIS
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="question-box">
        <div id="quiz-area">
            <div class="question-text" id="questionText">Loading...</div>
            <div class="options-grid" id="optionsContainer">
                </div>
        </div>
        
        <div class="explanation-box" id="explanationBox">
            <div class="exp-title" id="expTitle"></div>
            <div class="exp-content" id="expContent"></div>
        </div>

        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
    </div>
</div>

<div class="modal-overlay" id="resultModal">
    <div class="modal-content">
        <h2 style="color: var(--secondary);">T·ªîNG K·∫æT ƒêI·ªÇM S·ªê</h2>
        <div class="score-display" id="finalScore">0/30</div>
        <p id="teacherComment" style="font-size: 18px; margin-bottom: 20px;"></p>
        <button class="next-btn" style="display:inline-block;" onclick="location.reload()">L√†m l·∫°i b√†i thi</button>
    </div>
</div>

<audio id="soundCorrect" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="soundWrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
<audio id="soundFinish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<script>
    // D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 C√¢u - Mixed Tenses - Grade 3-4 Level)
    const questionsDB = [
        {
            q: "Look! The boys ______ football in the playground.",
            options: ["plays", "are playing", "played", "will play"],
            correct: 1, // Index c·ªßa ƒë√°p √°n ƒë√∫ng (0, 1, 2, 3)
            exp: {
                trans: "Nh√¨n k√¨a! C√°c b·∫°n nam ƒëang ch∆°i ƒë√° b√≥ng trong s√¢n ch∆°i.",
                vocab: [
                    {w: "plays", t: "v (s/es)", m: "ch∆°i (th∆∞·ªùng xuy√™n)"},
                    {w: "are playing", t: "v (be V-ing)", m: "ƒëang ch∆°i"},
                    {w: "played", t: "v (ed)", m: "ƒë√£ ch∆°i"},
                    {w: "will play", t: "v (future)", m: "s·∫Ω ch∆°i"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'Look!' (Nh√¨n k√¨a!) ƒë·ª©ng ƒë·∫ßu c√¢u ‚ûî D√πng th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn** ƒë·ªÉ di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang x·∫£y ra ngay l√∫c n√≥i.",
                whyWrong: "C√°c ƒë√°p √°n kh√°c sai th√¨: 'plays' (hi·ªán t·∫°i ƒë∆°n - th√≥i quen), 'played' (qu√° kh·ª©), 'will play' (t∆∞∆°ng lai)."
            }
        },
        {
            q: "My mother ______ to the market every morning.",
            options: ["go", "going", "goes", "went"],
            correct: 2,
            exp: {
                trans: "M·∫π c·ªßa t·ªõ ƒëi ch·ª£ m·ªói bu·ªïi s√°ng.",
                vocab: [
                    {w: "go", t: "v", m: "ƒëi (nguy√™n th·ªÉ)"},
                    {w: "going", t: "v-ing", m: "ƒëang ƒëi"},
                    {w: "goes", t: "v (es)", m: "ƒëi (chia s·ªë √≠t)"},
                    {w: "went", t: "v (past)", m: "ƒë√£ ƒëi"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'every morning' (m·ªói s√°ng) ‚ûî Th√≥i quen ‚ûî Th√¨ **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'My mother' l√† s·ªë √≠t (she) n√™n ƒë·ªông t·ª´ th√™m 'es'.",
                whyWrong: "A sai v√¨ thi·∫øu 'es'. B sai ng·ªØ ph√°p (thi·∫øu to be). D sai v√¨ l√† qu√° kh·ª©."
            }
        },
        {
            q: "Where ______ you go yesterday?",
            options: ["do", "did", "are", "will"],
            correct: 1,
            exp: {
                trans: "B·∫°n ƒë√£ ƒëi ƒë√¢u ng√†y h√¥m qua?",
                vocab: [
                    {w: "do", t: "tr·ª£ ƒêT", m: "l√†m (hi·ªán t·∫°i)"},
                    {w: "did", t: "tr·ª£ ƒêT", m: "ƒë√£ l√†m (qu√° kh·ª©)"},
                    {w: "are", t: "to be", m: "th√¨, l√†, ·ªü"},
                    {w: "will", t: "modal", m: "s·∫Ω"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'yesterday' (h√¥m qua) ‚ûî Th√¨ **Qu√° kh·ª© ƒë∆°n**. C√¢u h·ªèi v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'go' c·∫ßn m∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ qu√° kh·ª© l√† 'Did'.",
                whyWrong: "'Do' d√πng cho hi·ªán t·∫°i. 'Are' kh√¥ng ƒëi v·ªõi 'go' nguy√™n th·ªÉ. 'Will' d√πng cho t∆∞∆°ng lai."
            }
        },
        {
            q: "I ______ my homework right now. Don't disturb me.",
            options: ["do", "am doing", "did", "have done"],
            correct: 1,
            exp: {
                trans: "T·ªõ ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√† ngay b√¢y gi·ªù. ƒê·ª´ng l√†m phi·ªÅn t·ªõ.",
                vocab: [
                    {w: "do", t: "v", m: "l√†m"},
                    {w: "am doing", t: "v", m: "ƒëang l√†m"},
                    {w: "did", t: "v", m: "ƒë√£ l√†m"},
                    {w: "have done", t: "v", m: "ƒë√£ l√†m xong"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'right now' (ngay b√¢y gi·ªù) ‚ûî Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn** (S + am/is/are + V-ing). Ch·ªß ng·ªØ 'I' ƒëi v·ªõi 'am doing'.",
                whyWrong: "A ch·ªâ th√≥i quen. C ch·ªâ qu√° kh·ª©. D ch·ªâ h√†nh ƒë·ªông ƒë√£ ho√†n th√†nh."
            }
        },
        {
            q: "She ______ Ha Long Bay last summer.",
            options: ["visits", "visited", "visiting", "will visit"],
            correct: 1,
            exp: {
                trans: "C√¥ ·∫•y ƒë√£ thƒÉm V·ªãnh H·∫° Long m√πa h√® nƒÉm ngo√°i.",
                vocab: [
                    {w: "visits", t: "v", m: "thƒÉm (hi·ªán t·∫°i)"},
                    {w: "visited", t: "v", m: "ƒë√£ thƒÉm (qu√° kh·ª©)"},
                    {w: "visiting", t: "v-ing", m: "ƒëang thƒÉm"},
                    {w: "will visit", t: "v", m: "s·∫Ω thƒÉm"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'last summer' (m√πa h√® tr∆∞·ªõc) ‚ûî H√†nh ƒë·ªông ƒë√£ k·∫øt th√∫c trong qu√° kh·ª© ‚ûî Th√¨ **Qu√° kh·ª© ƒë∆°n** (V-ed).",
                whyWrong: "A sai th√¨ hi·ªán t·∫°i. C thi·∫øu to be. D sai th√¨ t∆∞∆°ng lai."
            }
        },
        {
            q: "We ______ a test tomorrow.",
            options: ["have", "had", "will have", "has"],
            correct: 2,
            exp: {
                trans: "Ch√∫ng t·ªõ s·∫Ω c√≥ m·ªôt b√†i ki·ªÉm tra v√†o ng√†y mai.",
                vocab: [
                    {w: "have", t: "v", m: "c√≥"},
                    {w: "had", t: "v", m: "ƒë√£ c√≥"},
                    {w: "will have", t: "v", m: "s·∫Ω c√≥"},
                    {w: "has", t: "v", m: "c√≥ (s·ªë √≠t)"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'tomorrow' (ng√†y mai) ‚ûî S·ª± vi·ªác ch∆∞a x·∫£y ra ‚ûî Th√¨ **T∆∞∆°ng lai ƒë∆°n** (will + V nguy√™n th·ªÉ).",
                whyWrong: "A, D l√† hi·ªán t·∫°i. B l√† qu√° kh·ª©."
            }
        },
        {
            q: "He ______ English for 3 years.",
            options: ["learns", "learned", "has learned", "is learning"],
            correct: 2,
            exp: {
                trans: "Anh ·∫•y ƒë√£ h·ªçc ti·∫øng Anh ƒë∆∞·ª£c 3 nƒÉm r·ªìi (v√† v·∫´n c√≤n h·ªçc).",
                vocab: [
                    {w: "learns", t: "v", m: "h·ªçc (th∆∞·ªùng xuy√™n)"},
                    {w: "learned", t: "v", m: "ƒë√£ h·ªçc (xong r·ªìi)"},
                    {w: "has learned", t: "v", m: "ƒë√£ v√† ƒëang h·ªçc"},
                    {w: "is learning", t: "v", m: "ƒëang h·ªçc (l√∫c n√†y)"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'for 3 years' (kho·∫£ng th·ªùi gian) ‚ûî H√†nh ƒë·ªông b·∫Øt ƒë·∫ßu trong qu√° kh·ª© k√©o d√†i ƒë·∫øn hi·ªán t·∫°i ‚ûî Th√¨ **Hi·ªán t·∫°i ho√†n th√†nh** (has + V3/ed).",
                whyWrong: "A l√† hi·ªán t·∫°i ƒë∆°n. B l√† qu√° kh·ª© ƒë∆°n (ƒë√£ ch·∫•m d·ª©t). D l√† ƒëang di·ªÖn ra nh·∫•t th·ªùi."
            }
        },
        {
            q: "Listen! Someone ______ the piano.",
            options: ["play", "plays", "is playing", "played"],
            correct: 2,
            exp: {
                trans: "Nghe k√¨a! Ai ƒë√≥ ƒëang ch∆°i ƒë√†n piano.",
                vocab: [
                    {w: "play/plays", t: "v", m: "ch∆°i (th√≥i quen)"},
                    {w: "is playing", t: "v", m: "ƒëang ch∆°i"},
                    {w: "played", t: "v", m: "ƒë√£ ch∆°i"}
                ],
                whyCorrect: "C√≥ t·ª´ 'Listen!' (Nghe k√¨a!) l√† c√¢u m·ªánh l·ªánh c·∫£nh b√°o s·ª± vi·ªác ƒëang di·ªÖn ra ‚ûî Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                whyWrong: "A, B d√πng cho th√≥i quen. D d√πng cho qu√° kh·ª©."
            }
        },
        {
            q: "They ______ football at the moment.",
            options: ["don't play", "aren't playing", "didn't play", "won't play"],
            correct: 1,
            exp: {
                trans: "H·ªç ƒëang kh√¥ng ch∆°i b√≥ng ƒë√° v√†o l√∫c n√†y.",
                vocab: [
                    {w: "don't play", t: "v", m: "kh√¥ng ch∆°i (th√≥i quen)"},
                    {w: "aren't playing", t: "v", m: "ƒëang kh√¥ng ch∆°i"},
                    {w: "didn't play", t: "v", m: "ƒë√£ kh√¥ng ch∆°i"},
                    {w: "won't play", t: "v", m: "s·∫Ω kh√¥ng ch∆°i"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'at the moment' (ngay l√∫c n√†y) ‚ûî Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn**. C√¢u ph·ªß ƒë·ªãnh: aren't + V-ing.",
                whyWrong: "A sai th√¨ hi·ªán t·∫°i ƒë∆°n. C sai th√¨ qu√° kh·ª©. D sai th√¨ t∆∞∆°ng lai."
            }
        },
        {
            q: "Nam often ______ TV in the evening.",
            options: ["watch", "watches", "watching", "watched"],
            correct: 1,
            exp: {
                trans: "Nam th∆∞·ªùng xem TV v√†o bu·ªïi t·ªëi.",
                vocab: [
                    {w: "watch", t: "v", m: "xem (s·ªë nhi·ªÅu)"},
                    {w: "watches", t: "v", m: "xem (s·ªë √≠t)"},
                    {w: "watching", t: "v", m: "ƒëang xem"},
                    {w: "watched", t: "v", m: "ƒë√£ xem"}
                ],
                whyCorrect: "C√≥ tr·∫°ng t·ª´ t·∫ßn su·∫•t 'often' (th∆∞·ªùng) ‚ûî Th√¨ **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'Nam' (He) l√† s·ªë √≠t n√™n ƒë·ªông t·ª´ th√™m 'es'.",
                whyWrong: "A thi·∫øu 'es'. C thi·∫øu to be. D l√† qu√° kh·ª©."
            }
        },
        {
            q: "______ you visit your grandparents next week?",
            options: ["Do", "Did", "Will", "Are"],
            correct: 2,
            exp: {
                trans: "B·∫°n s·∫Ω ƒëi thƒÉm √¥ng b√† v√†o tu·∫ßn t·ªõi ch·ª©?",
                vocab: [
                    {w: "Do", t: "tr·ª£ t·ª´", m: "Hi·ªán t·∫°i"},
                    {w: "Did", t: "tr·ª£ t·ª´", m: "Qu√° kh·ª©"},
                    {w: "Will", t: "tr·ª£ t·ª´", m: "T∆∞∆°ng lai (S·∫Ω)"},
                    {w: "Are", t: "to be", m: "Th√¨/L√†"}
                ],
                whyCorrect: "C√≥ d·∫•u hi·ªáu 'next week' (tu·∫ßn t·ªõi) ‚ûî Th√¨ **T∆∞∆°ng lai ƒë∆°n**. C·∫•u tr√∫c c√¢u h·ªèi: Will + S + V?",
                whyWrong: "A, B sai th√¨. D sai ng·ªØ ph√°p (Are you visit -> sai, ph·∫£i l√† Are you visiting)."
            }
        },
        {
            q: "I ______ this film yesterday evening.",
            options: ["see", "saw", "seen", "seeing"],
            correct: 1,
            exp: {
                trans: "T·ªõ ƒë√£ xem b·ªô phim n√†y t·ªëi h√¥m qua.",
                vocab: [
                    {w: "see", t: "v", m: "nh√¨n/xem (hi·ªán t·∫°i)"},
                    {w: "saw", t: "v", m: "ƒë√£ nh√¨n/xem (qu√° kh·ª©)"},
                    {w: "seen", t: "v", m: "ph√¢n t·ª´ 2"},
                    {w: "seeing", t: "v", m: "ƒëang nh√¨n"}
                ],
                whyCorrect: "'Yesterday evening' (t·ªëi qua) l√† th·ªùi gian x√°c ƒë·ªãnh trong qu√° kh·ª© ‚ûî Th√¨ **Qu√° kh·ª© ƒë∆°n**. V2 c·ªßa 'see' l√† 'saw'.",
                whyWrong: "A l√† hi·ªán t·∫°i. C v√† D kh√¥ng ƒë·ª©ng m·ªôt m√¨nh l√†m ƒë·ªông t·ª´ ch√≠nh trong th√¨ ƒë∆°n."
            }
        },
        {
            q: "Keep silent! The baby ______.",
            options: ["sleeps", "slept", "is sleeping", "will sleep"],
            correct: 2,
            exp: {
                trans: "Gi·ªØ im l·∫∑ng n√†o! Em b√© ƒëang ng·ªß.",
                vocab: [
                    {w: "sleeps", t: "v", m: "ng·ªß (th√≥i quen)"},
                    {w: "slept", t: "v", m: "ƒë√£ ng·ªß"},
                    {w: "is sleeping", t: "v", m: "ƒëang ng·ªß"},
                    {w: "will sleep", t: "v", m: "s·∫Ω ng·ªß"}
                ],
                whyCorrect: "'Keep silent!' (Im l·∫∑ng!) l√† d·∫•u hi·ªáu m·ªánh l·ªánh ‚ûî H√†nh ƒë·ªông ƒëang x·∫£y ra ‚ûî Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                whyWrong: "A, B, D sai th√¨."
            }
        },
        {
            q: "We ______ to the zoo two days ago.",
            options: ["went", "go", "are going", "have gone"],
            correct: 0,
            exp: {
                trans: "Ch√∫ng t·ªõ ƒë√£ ƒëi s·ªü th√∫ c√°ch ƒë√¢y 2 ng√†y.",
                vocab: [
                    {w: "went", t: "v", m: "ƒë√£ ƒëi"},
                    {w: "go", t: "v", m: "ƒëi"},
                    {w: "are going", t: "v", m: "ƒëang ƒëi"},
                    {w: "have gone", t: "v", m: "ƒë√£ ƒëi (ch∆∞a v·ªÅ)"}
                ],
                whyCorrect: "D·∫•u hi·ªáu 'ago' (c√°ch ƒë√¢y) ‚ûî Th√¨ **Qu√° kh·ª© ƒë∆°n**. V2 c·ªßa 'go' l√† 'went'.",
                whyWrong: "B l√† hi·ªán t·∫°i. C l√† ti·∫øp di·ªÖn. D l√† ho√†n th√†nh (kh√¥ng d√πng v·ªõi ago)."
            }
        },
        {
            q: "I have lived in Hanoi ______ 2015.",
            options: ["for", "since", "in", "at"],
            correct: 1,
            exp: {
                trans: "T·ªõ ƒë√£ s·ªëng ·ªü H√† N·ªôi t·ª´ nƒÉm 2015.",
                vocab: [
                    {w: "for", t: "gi·ªõi t·ª´", m: "kho·∫£ng (th·ªùi gian)"},
                    {w: "since", t: "gi·ªõi t·ª´", m: "k·ªÉ t·ª´ (m·ªëc th·ªùi gian)"},
                    {w: "in/at", t: "gi·ªõi t·ª´", m: "trong/t·∫°i"}
                ],
                whyCorrect: "Trong th√¨ **Hi·ªán t·∫°i ho√†n th√†nh** (have lived), d√πng 'SINCE' + M·ªëc th·ªùi gian (2015).",
                whyWrong: "'For' + Kho·∫£ng th·ªùi gian (v√≠ d·ª•: for 10 years). In/At kh√¥ng d√πng l√†m d·∫•u hi·ªáu th√¨ ho√†n th√†nh ·ªü v·ªã tr√≠ n√†y."
            }
        },
        {
            q: "Tom ______ his bike to school every day.",
            options: ["ride", "rides", "riding", "is riding"],
            correct: 1,
            exp: {
                trans: "Tom ƒë·∫°p xe ƒë·∫øn tr∆∞·ªùng m·ªói ng√†y.",
                vocab: [
                    {w: "ride", t: "v", m: "ƒë·∫°p xe"},
                    {w: "rides", t: "v", m: "ƒë·∫°p xe (s·ªë √≠t)"},
                    {w: "riding", t: "v", m: "ƒëang ƒë·∫°p"},
                    {w: "is riding", t: "v", m: "ƒëang ƒë·∫°p"}
                ],
                whyCorrect: "'Every day' ‚ûî Th√≥i quen ‚ûî Th√¨ **Hi·ªán t·∫°i ƒë∆°n**. Tom (ng√¥i th·ª© 3 s·ªë √≠t) ‚ûî ƒê·ªông t·ª´ th√™m 's'.",
                whyWrong: "A thi·∫øu 's'. C, D l√† ti·∫øp di·ªÖn."
            }
        },
        {
            q: "What ______ you doing now?",
            options: ["do", "are", "did", "will"],
            correct: 1,
            exp: {
                trans: "B·∫°n ƒëang l√†m g√¨ b√¢y gi·ªù th·∫ø?",
                vocab: [
                    {w: "do", t: "tr·ª£ t·ª´", m: "l√†m"},
                    {w: "are", t: "to be", m: "l√†/ƒëang"},
                    {w: "did", t: "tr·ª£ t·ª´", m: "ƒë√£"},
                    {w: "will", t: "tr·ª£ t·ª´", m: "s·∫Ω"}
                ],
                whyCorrect: "'Now' ‚ûî Th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn** (V-ing). C·∫•u tr√∫c c√¢u h·ªèi: Wh + to be + S + V-ing? ‚ûî C·∫ßn 'Are'.",
                whyWrong: "Do/Did/Will kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi 'doing' trong c√¢u h·ªèi th√¨ n√†y."
            }
        },
        {
            q: "They ______ new shoes tomorrow.",
            options: ["buy", "bought", "will buy", "buys"],
            correct: 2,
            exp: {
                trans: "H·ªç s·∫Ω mua gi√†y m·ªõi v√†o ng√†y mai.",
                vocab: [
                    {w: "buy", t: "v", m: "mua"},
                    {w: "bought", t: "v", m: "ƒë√£ mua"},
                    {w: "will buy", t: "v", m: "s·∫Ω mua"},
                    {w: "buys", t: "v", m: "mua (s·ªë √≠t)"}
                ],
                whyCorrect: "'Tomorrow' ‚ûî T∆∞∆°ng lai ƒë∆°n ‚ûî Will + V.",
                whyWrong: "A, D l√† hi·ªán t·∫°i. B l√† qu√° kh·ª©."
            }
        },
        {
            q: "She ______ very happy yesterday.",
            options: ["is", "are", "was", "were"],
            correct: 2,
            exp: {
                trans: "C√¥ ·∫•y ƒë√£ r·∫•t vui v√†o h√¥m qua.",
                vocab: [
                    {w: "is/are", t: "to be", m: "th√¨/l√† (hi·ªán t·∫°i)"},
                    {w: "was", t: "to be", m: "ƒë√£ l√† (qu√° kh·ª© s·ªë √≠t)"},
                    {w: "were", t: "to be", m: "ƒë√£ l√† (qu√° kh·ª© s·ªë nhi·ªÅu)"}
                ],
                whyCorrect: "'Yesterday' ‚ûî Qu√° kh·ª© ƒë∆°n. Ch·ªß ng·ªØ 'She' (s·ªë √≠t) ƒëi v·ªõi ƒë·ªông t·ª´ to be qu√° kh·ª© l√† 'was'.",
                whyWrong: "Is/Are l√† hi·ªán t·∫°i. Were d√πng cho s·ªë nhi·ªÅu (They/We/You)."
            }
        },
        {
            q: "______ he play football? - No, he plays badminton.",
            options: ["Do", "Does", "Is", "Will"],
            correct: 1,
            exp: {
                trans: "C·∫≠u ·∫•y c√≥ ch∆°i b√≥ng ƒë√° kh√¥ng? - Kh√¥ng, c·∫≠u ·∫•y ch∆°i c·∫ßu l√¥ng.",
                vocab: [
                    {w: "Do", t: "tr·ª£ t·ª´", m: "d√πng cho I/You/We/They"},
                    {w: "Does", t: "tr·ª£ t·ª´", m: "d√πng cho He/She/It"},
                    {w: "Is", t: "to be", m: "d√πng cho ti·∫øp di·ªÖn"},
                    {w: "Will", t: "tr·ª£ t·ª´", m: "t∆∞∆°ng lai"}
                ],
                whyCorrect: "C√¢u h·ªèi v·ªÅ th√≥i quen/s·ª± th·∫≠t ‚ûî **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'He' m∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ 'Does'.",
                whyWrong: "Do sai ng√¥i. Is kh√¥ng ƒëi v·ªõi 'play' nguy√™n th·ªÉ. Will sai th√¨."
            }
        },
        {
            q: "We ______ just ______ our dinner.",
            options: ["have/finished", "has/finished", "did/finish", "are/finishing"],
            correct: 0,
            exp: {
                trans: "Ch√∫ng t·ªõ v·ª´a m·ªõi ƒÉn xong b·ªØa t·ªëi.",
                vocab: [
                    {w: "have...finished", t: "HTHT", m: "v·ª´a l√†m xong"},
                    {w: "has...finished", t: "HTHT", m: "v·ª´a l√†m xong (s·ªë √≠t)"},
                    {w: "did...finish", t: "QKƒê", m: "ƒë√£ l√†m"},
                    {w: "are...finishing", t: "HTTD", m: "ƒëang l√†m"}
                ],
                whyCorrect: "T·ª´ 'just' (v·ª´a m·ªõi) n·∫±m gi·ªØa c√¢u th∆∞·ªùng l√† d·∫•u hi·ªáu th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**. 'We' ƒëi v·ªõi 'have'.",
                whyWrong: "B sai v√¨ 'has' d√πng cho s·ªë √≠t. C, D sai th√¨."
            }
        },
        {
            q: "Where ______ you usually ______ on Sundays?",
            options: ["do/go", "did/go", "are/going", "will/go"],
            correct: 0,
            exp: {
                trans: "B·∫°n th∆∞·ªùng ƒëi ƒë√¢u v√†o c√°c ng√†y Ch·ªß Nh·∫≠t?",
                vocab: [
                    {w: "do...go", t: "HTƒê", m: "th∆∞·ªùng ƒëi"},
                    {w: "did...go", t: "QKƒê", m: "ƒë√£ ƒëi"},
                    {w: "are...going", t: "HTTD", m: "ƒëang ƒëi"},
                    {w: "will...go", t: "TLƒê", m: "s·∫Ω ƒëi"}
                ],
                whyCorrect: "'Usually' v√† 'on Sundays' (s·ªë nhi·ªÅu) ‚ûî Th√≥i quen l·∫∑p l·∫°i ‚ûî Th√¨ **Hi·ªán t·∫°i ƒë∆°n**. C√¢u h·ªèi v·ªõi 'you' d√πng tr·ª£ t·ª´ 'do'.",
                whyWrong: "Did (qu√° kh·ª©). Are...going (ƒëang di·ªÖn ra). Will (t∆∞∆°ng lai)."
            }
        },
        {
            q: "My dad ______ a car last year.",
            options: ["doesn't buy", "didn't buy", "won't buy", "hasn't bought"],
            correct: 1,
            exp: {
                trans: "B·ªë t·ªõ ƒë√£ kh√¥ng mua √¥ t√¥ v√†o nƒÉm ngo√°i.",
                vocab: [
                    {w: "doesn't buy", t: "v", m: "kh√¥ng mua (hi·ªán t·∫°i)"},
                    {w: "didn't buy", t: "v", m: "ƒë√£ kh√¥ng mua (qu√° kh·ª©)"},
                    {w: "won't buy", t: "v", m: "s·∫Ω kh√¥ng mua"},
                    {w: "hasn't bought", t: "v", m: "v·∫´n ch∆∞a mua"}
                ],
                whyCorrect: "'Last year' ‚ûî Qu√° kh·ª© ƒë∆°n. D·∫°ng ph·ªß ƒë·ªãnh qu√° kh·ª©: Didn't + V nguy√™n th·ªÉ.",
                whyWrong: "A (hi·ªán t·∫°i). C (t∆∞∆°ng lai). D (ho√†n th√†nh)."
            }
        },
        {
            q: "Look at the clouds! It ______ rain.",
            options: ["is going to", "will", "did", "is"],
            correct: 0,
            exp: {
                trans: "Nh√¨n m√¢y k√¨a! Tr·ªùi s·∫Øp m∆∞a r·ªìi.",
                vocab: [
                    {w: "is going to", t: "TL g·∫ßn", m: "s·∫Øp/d·ª± ƒë·ªãnh"},
                    {w: "will", t: "TL ƒë∆°n", m: "s·∫Ω"},
                    {w: "did", t: "QK", m: "ƒë√£"},
                    {w: "is", t: "to be", m: "l√†"}
                ],
                whyCorrect: "C√≥ b·∫±ng ch·ª©ng c·ª• th·ªÉ ·ªü hi·ªán t·∫°i (Look at the clouds!) ‚ûî D√πng **T∆∞∆°ng lai g·∫ßn** (be going to) ƒë·ªÉ d·ª± ƒëo√°n.",
                whyWrong: "'Will' d√πng cho ph·ªèng ƒëo√°n kh√¥ng cƒÉn c·ª© ho·∫∑c quy·∫øt ƒë·ªãnh t·ª©c th√¨. 'Did' l√† qu√° kh·ª©."
            }
        },
        {
            q: "I ______ never ______ sushi before.",
            options: ["have/eaten", "has/eaten", "did/eat", "do/eat"],
            correct: 0,
            exp: {
                trans: "T·ªõ ch∆∞a bao gi·ªù ƒÉn sushi tr∆∞·ªõc ƒë√¢y c·∫£.",
                vocab: [
                    {w: "have eaten", t: "HTHT", m: "ƒë√£ ƒÉn"},
                    {w: "has eaten", t: "HTHT", m: "ƒë√£ ƒÉn (s·ªë √≠t)"},
                    {w: "did eat", t: "QKƒê", m: "ƒë√£ ƒÉn"},
                    {w: "do eat", t: "HTƒê", m: "ƒÉn"}
                ],
                whyCorrect: "'Never...before' n√≥i v·ªÅ tr·∫£i nghi·ªám ‚ûî Th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**. 'I' ƒëi v·ªõi 'have'.",
                whyWrong: "B sai ng√¥i. C, D sai th√¨."
            }
        },
        {
            q: "While I was reading, my sister ______ TV.",
            options: ["watch", "watched", "was watching", "is watching"],
            correct: 2,
            exp: {
                trans: "Trong khi t·ªõ ƒëang ƒë·ªçc s√°ch th√¨ em g√°i t·ªõ ƒëang xem TV.",
                vocab: [
                    {w: "watch", t: "v", m: "xem"},
                    {w: "watched", t: "v", m: "ƒë√£ xem"},
                    {w: "was watching", t: "v", m: "ƒëang xem (qu√° kh·ª©)"},
                    {w: "is watching", t: "v", m: "ƒëang xem (hi·ªán t·∫°i)"}
                ],
                whyCorrect: "C·∫•u tr√∫c 'While' (trong khi) di·ªÖn t·∫£ 2 h√†nh ƒë·ªông x·∫£y ra song song trong qu√° kh·ª© ‚ûî C·∫£ 2 ƒë·ªÅu d√πng **Qu√° kh·ª© ti·∫øp di·ªÖn** (was/were + V-ing).",
                whyWrong: "A, D sai th√¨ hi·ªán t·∫°i. B l√† h√†nh ƒë·ªông ng·∫Øn xen v√†o (kh√¥ng h·ª£p ng·ªØ c·∫£nh song song n√†y)."
            }
        },
        {
            q: "At 8 PM last night, I ______ my homework.",
            options: ["did", "was doing", "am doing", "do"],
            correct: 1,
            exp: {
                trans: "V√†o l√∫c 8 gi·ªù t·ªëi qua, t·ªõ ƒëang l√†m b√†i t·∫≠p.",
                vocab: [
                    {w: "did", t: "v", m: "ƒë√£ l√†m (xong r·ªìi)"},
                    {w: "was doing", t: "v", m: "ƒëang l√†m (t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥)"},
                    {w: "am doing", t: "v", m: "ƒëang l√†m (b√¢y gi·ªù)"},
                    {w: "do", t: "v", m: "l√†m (th∆∞·ªùng xuy√™n)"}
                ],
                whyCorrect: "Gi·ªù c·ª• th·ªÉ trong qu√° kh·ª© (8 PM last night) ‚ûî Th√¨ **Qu√° kh·ª© ti·∫øp di·ªÖn** ƒë·ªÉ nh·∫•n m·∫°nh qu√° tr√¨nh ƒëang di·ªÖn ra.",
                whyWrong: "A d√πng cho h√†nh ƒë·ªông ƒë√£ k·∫øt th√∫c. C, D l√† hi·ªán t·∫°i."
            }
        },
        {
            q: "______ you ______ the dishes yet?",
            options: ["Did/wash", "Have/washed", "Do/wash", "Are/washing"],
            correct: 1,
            exp: {
                trans: "B·∫°n ƒë√£ r·ª≠a b√°t xong ch∆∞a?",
                vocab: [
                    {w: "Did...wash", t: "QKƒê", m: "ƒë√£ r·ª≠a"},
                    {w: "Have...washed", t: "HTHT", m: "ƒë√£ r·ª≠a (k·∫øt qu·∫£)"},
                    {w: "Do...wash", t: "HTƒê", m: "r·ª≠a"},
                    {w: "Are...washing", t: "HTTD", m: "ƒëang r·ª≠a"}
                ],
                whyCorrect: "T·ª´ 'yet' cu·ªëi c√¢u h·ªèi th∆∞·ªùng d√πng trong th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**.",
                whyWrong: "A d√πng cho qu√° kh·ª© x√°c ƒë·ªãnh th·ªùi gian. C th√≥i quen. D ƒëang di·ªÖn ra."
            }
        },
        {
            q: "I promise I ______ help you tomorrow.",
            options: ["will", "do", "am", "have"],
            correct: 0,
            exp: {
                trans: "T·ªõ h·ª©a t·ªõ s·∫Ω gi√∫p c·∫≠u v√†o ng√†y mai.",
                vocab: [
                    {w: "will", t: "modal", m: "s·∫Ω"},
                    {w: "do", t: "tr·ª£ t·ª´", m: "l√†m"},
                    {w: "am", t: "to be", m: "th√¨/l√†"},
                    {w: "have", t: "v", m: "c√≥/ƒë√£"}
                ],
                whyCorrect: "ƒê·ªông t·ª´ 'Promise' (h·ª©a) th∆∞·ªùng ƒëi v·ªõi th√¨ **T∆∞∆°ng lai ƒë∆°n** (Will).",
                whyWrong: "Do/Am/Have kh√¥ng d√πng ƒë·ªÉ di·ªÖn t·∫£ l·ªùi h·ª©a trong t∆∞∆°ng lai theo c√°ch n√†y."
            }
        },
        {
            q: "The sun ______ in the East.",
            options: ["rise", "rises", "rising", "rose"],
            correct: 1,
            exp: {
                trans: "M·∫∑t tr·ªùi m·ªçc ·ªü h∆∞·ªõng ƒê√¥ng.",
                vocab: [
                    {w: "rise", t: "v", m: "m·ªçc"},
                    {w: "rises", t: "v", m: "m·ªçc (s·ªë √≠t)"},
                    {w: "rising", t: "v", m: "ƒëang m·ªçc"},
                    {w: "rose", t: "v", m: "ƒë√£ m·ªçc"}
                ],
                whyCorrect: "S·ª± th·∫≠t hi·ªÉn nhi√™n ‚ûî Th√¨ **Hi·ªán t·∫°i ƒë∆°n**. 'The sun' l√† s·ªë √≠t ‚ûî Th√™m 's'.",
                whyWrong: "A thi·∫øu 's'. C sai ng·ªØ ph√°p. D l√† qu√° kh·ª©."
            }
        }
    ];

    let currentQ = 0;
    let score = 0;
    let shuffledQ = [];
    let isAnswered = false;

    // √Çm thanh
    const sCorrect = document.getElementById("soundCorrect");
    const sWrong = document.getElementById("soundWrong");
    const sFinish = document.getElementById("soundFinish");

    // Kh·ªüi t·∫°o
    function init() {
        shuffledQ = questionsDB.sort(() => Math.random() - 0.5);
        currentQ = 0;
        score = 0;
        loadQuestion();
        updateProgress();
    }

    function updateProgress() {
        const percent = ((currentQ) / shuffledQ.length) * 100;
        document.getElementById("progressBar").style.width = percent + "%";
    }

    function loadQuestion() {
        isAnswered = false;
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("explanationBox").style.display = "none";
        document.getElementById("explanationBox").className = "explanation-box"; // Reset class
        
        const qData = shuffledQ[currentQ];
        document.getElementById("questionText").innerHTML = `C√¢u ${currentQ + 1}: ${qData.q}`;

        const optsDiv = document.getElementById("optionsContainer");
        optsDiv.innerHTML = "";

        qData.options.forEach((opt, index) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = String.fromCharCode(65 + index) + ". " + opt; // A. ..., B. ...
            btn.onclick = () => checkAnswer(index, btn);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, btnElement) {
        if (isAnswered) return;
        isAnswered = true;

        const qData = shuffledQ[currentQ];
        const allBtns = document.querySelectorAll(".option-btn");
        
        // Disable all buttons
        allBtns.forEach(b => b.classList.add("disabled"));

        if (selectedIndex === qData.correct) {
            // ƒê√öNG
            btnElement.classList.add("correct");
            score++;
            sCorrect.currentTime = 0;
            sCorrect.play();
            triggerConfetti();
        } else {
            // SAI
            btnElement.classList.add("wrong");
            // Highlight ƒë√°p √°n ƒë√∫ng
            allBtns[qData.correct].classList.add("correct");
            document.getElementById("explanationBox").classList.add("wrong-mode");
            sWrong.currentTime = 0;
            sWrong.play();
        }

        showExplanation(qData);
        document.getElementById("nextBtn").style.display = "block";
        updateProgress();
    }

    function showExplanation(qData) {
        const expBox = document.getElementById("explanationBox");
        const expTitle = document.getElementById("expTitle");
        const expContent = document.getElementById("expContent");

        expTitle.innerHTML = "üìù Ms Mai An gi·∫£i th√≠ch chi ti·∫øt:";
        
        let vocabRows = "";
        qData.exp.vocab.forEach(v => {
            vocabRows += `<tr>
                <td><b>${v.w}</b></td>
                <td><span class="exp-tag tag-blue">${v.t}</span></td>
                <td>${v.m}</td>
            </tr>`;
        });

        expContent.innerHTML = `
            <p><b>üîç D·ªãch c√¢u h·ªèi:</b> "${qData.exp.trans}"</p>
            <table class="vocab-table">
                <tr><th>T·ª´ v·ª±ng</th><th>Lo·∫°i t·ª´</th><th>Nghƒ©a</th></tr>
                ${vocabRows}
            </table>
            <p style="margin-top:15px"><span class="exp-tag tag-green">T·∫†I SAO ƒê√öNG?</span> ${qData.exp.whyCorrect}</p>
            <p><span class="exp-tag tag-red">T·∫†I SAO SAI?</span> ${qData.exp.whyWrong}</p>
        `;
        
        expBox.style.display = "block";
    }

    function nextQuestion() {
        currentQ++;
        if (currentQ < shuffledQ.length) {
            loadQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        document.getElementById("resultModal").style.display = "flex";
        document.getElementById("finalScore").innerText = `${score} / ${shuffledQ.length}`;
        sFinish.play();
        triggerConfetti();

        const comment = document.getElementById("teacherComment");
        const percent = (score / shuffledQ.length) * 100;
        
        if (percent === 100) comment.innerText = "üèÜ Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng·ªØ ph√°p!";
        else if (percent >= 80) comment.innerText = "üåü R·∫•t gi·ªèi! C√¥ r·∫•t t·ª± h√†o v·ªÅ em!";
        else if (percent >= 50) comment.innerText = "üëç Kh√° t·ªët! C·ªë g·∫Øng √¥n th√™m ch√∫t n·ªØa nh√©!";
        else comment.innerText = "üí™ C·∫ßn n·ªó l·ª±c h∆°n! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©!";
    }

    function triggerConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }

    // Start
    init();

</script>
</body>
</html>