<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIT 10 - PLANET EARTH | Ms Mai An ULIS</title>
    <style>
        :root {
            --primary-color: #0056b3; /* Xanh dương */
            --success-color: #28a745; /* Xanh lá */
            --danger-color: #dc3545;  /* Đỏ */
            --warning-color: #ffc107; /* Vàng cam */
            --light-bg: #f8f9fa;
            --text-color: #333;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef2f5;
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding-bottom: 80px; /* Space for sticky footer */
        }

        /* Header */
        header {
            background-color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border-bottom: 4px solid var(--primary-color);
        }

        h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
        }

        .author {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Question Cards */
        .question-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid transparent;
            transition: all 0.3s ease;
        }

        .question-card.correct { border-left-color: var(--success-color); }
        .question-card.incorrect { border-left-color: var(--danger-color); }
        .question-card.unanswered { border-left-color: var(--warning-color); }

        .q-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .q-text {
            font-size: 1.05rem;
            margin-bottom: 15px;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        .option-label {
            display: block;
            padding: 10px 15px;
            background: var(--light-bg);
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .option-label:hover {
            background: #e9ecef;
        }

        input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* Coloring Options after Check */
        .option-label.is-correct {
            background-color: #d4edda;
            border-color: var(--success-color);
            color: #155724;
            font-weight: bold;
        }

        .option-label.is-wrong {
            background-color: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
            opacity: 0.8;
        }

        /* Explanations */
        .explanation {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #e7f1ff;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .explanation h4 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .explanation ul {
            padding-left: 20px;
            margin: 5px 0;
        }

        /* Reading Section Styles */
        .data-box {
            background-color: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .glossary {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.9rem;
        }
        
        .glossary th, .glossary td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .glossary th {
            background-color: #0056b3;
            color: white;
        }

        /* Gap Fill Layout */
        .gap-fill-container {
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 25px;
            background: white;
            box-shadow: var(--shadow);
        }

        .gf-options-box {
            background-color: #e3f2fd;
            padding: 15px;
            border-bottom: 1px solid #ccc;
        }

        .gf-option-item {
            background: white;
            padding: 5px 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #b3d7ff;
            display: block;
        }

        .gf-text-box {
            padding: 20px;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            border-bottom: 1px solid #ccc;
        }

        .gf-answer-area {
            padding: 20px;
            background-color: #f8f9fa;
        }

        /* Buttons */
        .btn-check {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .btn-check:hover { background-color: #004494; }

        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .btn-submit {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.3);
            transition: transform 0.2s;
        }

        .btn-submit:hover { transform: scale(1.05); }

        /* Visuals for Q29, Q30 */
        .visual-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }

        /* Q29 Wet Paint Sign */
        .sign-wet-paint {
            width: 250px;
            background-color: #1a73e8; /* Blue background */
            border: 4px solid #fff;
            box-shadow: 0 0 0 2px #ccc;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-family: 'Arial Black', sans-serif;
            color: white;
            position: relative;
        }
        
        .sign-wet-paint h2 {
            font-size: 32px;
            margin: 0;
            line-height: 1;
            text-transform: uppercase;
        }
        
        .sign-wet-paint .lower-text {
            background: white;
            color: #333;
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sign-wet-paint .lower-text h3 {
            margin: 0;
            font-size: 20px;
            text-align: left;
            line-height: 1.1;
        }

        .hand-icon {
            font-size: 40px;
            color: #1a73e8;
        }

        /* Q30 Notice Board */
        .notice-board {
            background-color: #fffde7; /* Yellowish */
            border: 3px solid #304ffe; /* Blue border */
            border-radius: 10px;
            padding: 20px;
            width: 300px;
            text-align: center;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.2);
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            color: #222;
        }

        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            text-align: center;
            width: 80%;
            max-width: 400px;
        }
        .popup h2 { color: var(--primary-color); }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1500;
        }

    </style>
</head>
<body>

<header>
    <div class="author">Giáo viên tạo: Ms Mai An ULIS</div>
    <h1>UNIT 10 – PLANET EARTH</h1>
    <p>TEST 01 - Interactive Assessment</p>
</header>

<div class="container" id="quiz-container">
    </div>

<div class="sticky-footer">
    <button class="btn-submit" onclick="submitTest()">NỘP BÀI (SUBMIT)</button>
</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="result-popup">
    <h2>KẾT QUẢ</h2>
    <p id="score-text" style="font-size: 1.5rem; font-weight: bold;">--/40</p>
    <p>Hãy xem lại chi tiết giải thích bên dưới nhé!</p>
    <button class="btn-check" onclick="closePopup()">Xem lại bài</button>
</div>

<script>
// --- DATA SOURCE ---
const quizData = [
    // PHONETICS
    {
        id: 1,
        type: 'phonetics',
        instruction: "Mark the letter A, B, C or D... to indicate the word whose underlined part differs from the other three in pronunciation.",
        question: "Choose the word with different pronunciation:",
        options: [
            { id: 'A', text: "pl<u>a</u>net" },
            { id: 'B', text: "l<u>a</u>ndform" },
            { id: 'C', text: "flor<u>a</u>" },
            { id: 'D', text: "n<u>a</u>tural" }
        ],
        correct: 'C',
        explanation: `
            <p><strong>Dịch nghĩa:</strong> A. Hành tinh, B. Địa hình, C. Hệ thực vật, D. Tự nhiên.</p>
            <p><strong>Phân tích phiên âm:</strong></p>
            <ul>
                <li>A. pl<u>a</u>net /ˈplæn.ɪt/ (âm /æ/)</li>
                <li>B. l<u>a</u>ndform /ˈlænd.fɔːm/ (âm /æ/)</li>
                <li>C. flor<u>a</u> /ˈflɔː.rə/ (âm /ə/ - âm schwa nhẹ vì đứng cuối từ không nhấn trọng âm)</li>
                <li>D. n<u>a</u>tural /ˈnætʃ.ər.əl/ (âm /æ/)</li>
            </ul>
            <p><strong>Kết luận:</strong> Chọn C vì phát âm là /ə/, các từ còn lại là /æ/.</p>
        `
    },
    {
        id: 2,
        type: 'phonetics',
        instruction: "",
        question: "Choose the word with different pronunciation:",
        options: [
            { id: 'A', text: "se<u>ss</u>ion" },
            { id: 'B', text: "mi<u>ss</u>ion" },
            { id: 'C', text: "i<u>ss</u>ue" },
            { id: 'D', text: "de<u>ss</u>ert" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Dịch nghĩa:</strong> A. Phiên họp, B. Sứ mệnh, C. Vấn đề, D. Món tráng miệng.</p>
            <p><strong>Phân tích phiên âm:</strong></p>
            <ul>
                <li>A. se<u>ss</u>ion /ˈseʃ.ən/ (âm /ʃ/)</li>
                <li>B. mi<u>ss</u>ion /ˈmɪʃ.ən/ (âm /ʃ/)</li>
                <li>C. i<u>ss</u>ue /ˈɪʃ.uː/ (âm /ʃ/)</li>
                <li>D. de<u>ss</u>ert /dɪˈzɜːt/ (âm /z/)</li>
            </ul>
            <p><strong>Kết luận:</strong> Chọn D vì 'ss' phát âm là /z/, còn lại là /ʃ/.</p>
        `
    },
    // STRESS
    {
        id: 3,
        type: 'stress',
        instruction: "Mark the letter A, B, C or D... to indicate the word that differs from the other three in the position of primary stress.",
        question: "Choose the word with different stress pattern:",
        options: [
            { id: 'A', text: "relation" },
            { id: 'B', text: "tropical" },
            { id: 'C', text: "pesticides" },
            { id: 'D', text: "benefit" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Phân tích trọng âm:</strong></p>
            <ul>
                <li>A. relation /rɪˈleɪ.ʃən/ -> Trọng âm 2 (Quy tắc đuôi -tion nhấn âm trước nó).</li>
                <li>B. tropical /ˈtrɒp.ɪ.kəl/ -> Trọng âm 1.</li>
                <li>C. pesticides /ˈpes.tɪ.saɪdz/ -> Trọng âm 1.</li>
                <li>D. benefit /ˈben.ɪ.fɪt/ -> Trọng âm 1.</li>
            </ul>
            <p><strong>Kết luận:</strong> Chọn A (âm 2), còn lại âm 1.</p>
        `
    },
    {
        id: 4,
        type: 'stress',
        instruction: "",
        question: "Choose the word with different stress pattern:",
        options: [
            { id: 'A', text: "mankind" },
            { id: 'B', text: "polar" },
            { id: 'C', text: "preserve" },
            { id: 'D', text: "diverse" }
        ],
        correct: 'B',
        explanation: `
            <p><strong>Phân tích trọng âm:</strong></p>
            <ul>
                <li>A. mankind /mænˈkaɪnd/ -> Thường nhấn âm 2.</li>
                <li>B. polar /ˈpəʊ.lə(r)/ -> Trọng âm 1.</li>
                <li>C. preserve /prɪˈzɜːv/ -> Trọng âm 2 (Động từ 2 âm tiết).</li>
                <li>D. diverse /daɪˈvɜːs/ -> Trọng âm 2 (Tính từ 2 âm tiết).</li>
            </ul>
            <p><strong>Kết luận:</strong> Chọn B (âm 1), còn lại âm 2.</p>
        `
    },
    // GRAMMAR & VOCAB
    {
        id: 5,
        type: 'multiple_choice',
        instruction: "Mark the letter A, B, C or D... to indicate the correct answer.",
        question: "Farmers need to find alternatives to harmful _______ to protect the environment.",
        options: [
            { id: 'A', text: "Pesticides" },
            { id: 'B', text: "emissions" },
            { id: 'C', text: "medicines" },
            { id: 'D', text: "plants" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Nông dân cần tìm các giải pháp thay thế cho _______ độc hại để bảo vệ môi trường.</p>
            <p><strong>Phân tích đáp án:</strong></p>
            <ul>
                <li>A. Pesticides (n): Thuốc trừ sâu (Phù hợp ngữ cảnh nông dân và độc hại).</li>
                <li>B. Emissions (n): Khí thải (Thường dùng cho nhà máy, xe cộ).</li>
                <li>C. Medicines (n): Thuốc chữa bệnh.</li>
                <li>D. Plants (n): Cây cối.</li>
            </ul>
        `
    },
    {
        id: 6,
        type: 'multiple_choice',
        instruction: "",
        question: "Deforestation is a _______ to wildlife habitats around the world.",
        options: [
            { id: 'A', text: "Benefit" },
            { id: 'B', text: "landform" },
            { id: 'C', text: "safety" },
            { id: 'D', text: "threat" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Nạn phá rừng là một _______ đối với môi trường sống của động vật hoang dã trên toàn thế giới.</p>
            <p><strong>Phân tích đáp án:</strong></p>
            <ul>
                <li>A. Benefit (n): Lợi ích (Sai nghĩa).</li>
                <li>B. Landform (n): Địa hình.</li>
                <li>C. Safety (n): Sự an toàn.</li>
                <li>D. Threat (n): Mối đe dọa.</li>
            </ul>
            <p><strong>Collocation:</strong> A threat to something (Mối đe dọa đối với cái gì).</p>
        `
    },
    {
        id: 7,
        type: 'multiple_choice',
        instruction: "",
        question: "On 4 October 1957, the Soviet Union ______ the first artificial satellite, Sputnik into orbit around the Earth.",
        options: [
            { id: 'A', text: "Launched" },
            { id: 'B', text: "shutted" },
            { id: 'C', text: "took" },
            { id: 'D', text: "pushed" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Ngày 4/10/1957, Liên Xô _______ vệ tinh nhân tạo đầu tiên, Sputnik vào quỹ đạo Trái Đất.</p>
            <p><strong>Phân tích đáp án:</strong></p>
            <ul>
                <li>A. Launched (v): Phóng (tên lửa, vệ tinh, tàu vũ trụ). -> Đúng chuyên ngành.</li>
                <li>B. Shutted -> Sai (Shut quá khứ vẫn là Shut).</li>
                <li>C. Took (v): Cầm, nắm.</li>
                <li>D. Pushed (v): Đẩy.</li>
            </ul>
        `
    },
    {
        id: 8,
        type: 'multiple_choice',
        instruction: "",
        question: "The Himalayas, __________ peaks are known as the “Roof of the World”, are a mountain range in Asia.",
        options: [
            { id: 'A', text: "Whose" },
            { id: 'B', text: "which" },
            { id: 'C', text: "that" },
            { id: 'D', text: "what" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Dãy Himalaya, nơi có những đỉnh núi được mệnh danh là 'Nóc nhà thế giới', là một dãy núi ở Châu Á.</p>
            <p><strong>Giải thích ngữ pháp:</strong></p>
            <ul>
                <li>Cần một đại từ quan hệ chỉ sở hữu vì "peaks" (đỉnh núi) thuộc về "The Himalayas".</li>
                <li><strong>A. Whose + Noun:</strong> Chỉ sở hữu (Những đỉnh núi CỦA dãy Himalaya). -> Đúng.</li>
                <li>B. Which: Chỉ vật, đóng vai trò chủ ngữ/tân ngữ, không chỉ sở hữu.</li>
                <li>C. That: Không dùng sau dấu phẩy (Mệnh đề quan hệ không xác định).</li>
                <li>D. What: Không dùng làm đại từ quan hệ thay thế cho danh từ đứng trước.</li>
            </ul>
        `
    },
    {
        id: 9,
        type: 'multiple_choice',
        instruction: "",
        question: "The documentary ______ director won many awards is about Earth’s flora and fauna.",
        options: [
            { id: 'A', text: "Which" },
            { id: 'B', text: "that" },
            { id: 'C', text: "what" },
            { id: 'D', text: "of which" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Bộ phim tài liệu mà đạo diễn của nó đã giành nhiều giải thưởng thì nói về hệ thực vật và động vật Trái Đất.</p>
            <p><strong>Giải thích ngữ pháp:</strong></p>
            <ul>
                <li>Câu này cần chỉ sở hữu cho vật (The documentary).</li>
                <li>Cấu trúc sở hữu cho vật: <strong>Whose + Noun</strong> HOẶC <strong>The Noun + of which</strong> HOẶC <strong>Of which + the Noun</strong>.</li>
                <li>Ở đây cấu trúc là: <em>...of which [the] director...</em> (Tuy nhiên đề bài hơi thiếu mạo từ 'the' trước director trong đáp án D nếu xét ngữ pháp chuẩn mực, nhưng trong 4 đáp án thì D là khả dĩ nhất để chỉ sở hữu).</li>
                <li>A, B, C đều không chỉ sở hữu.</li>
                <li>Đáp án chuẩn nhất thường là "whose director", nhưng nếu bắt buộc chọn trong A, B, C, D thì D (of which) là đáp án chỉ sở hữu duy nhất.</li>
            </ul>
        `
    },
    {
        id: 10,
        type: 'multiple_choice',
        instruction: "",
        question: "My favourite holiday was the one _____ in a cottage in the mountains.",
        options: [
            { id: 'A', text: "Which spent" },
            { id: 'B', text: "We spent" },
            { id: 'C', text: "that we spent in" },
            { id: 'D', text: "where we spent" }
        ],
        correct: 'B',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Kỳ nghỉ yêu thích của tôi là kỳ nghỉ mà chúng tôi đã dành thời gian ở một ngôi nhà gỗ trên núi.</p>
            <p><strong>Phân tích:</strong></p>
            <ul>
                <li>Cần mệnh đề quan hệ bổ nghĩa cho "the one".</li>
                <li>Câu đầy đủ: "...the one [which/that] we spent in a cottage..."</li>
                <li><strong>B. We spent:</strong> Đây là mệnh đề quan hệ rút gọn đại từ (bỏ which/that vì nó là tân ngữ của động từ spent). -> <em>We spent [the holiday] in a cottage</em>. Đúng.</li>
                <li>A. Which spent: Sai vì thiếu chủ ngữ (Ai spent?).</li>
                <li>C. That we spent in: Thừa giới từ "in" ở cuối vì sau đó lại có "in a cottage". -> <em>spent in in a cottage</em> (Sai).</li>
                <li>D. Where we spent: Sau Where phải là một mệnh đề trọn vẹn (S+V+O) và không cần tân ngữ chỉ nơi chốn nữa, nhưng "spent" thường cần tân ngữ (spend time/holiday). Nếu dùng Where thì câu phải là "Where we stayed". Dùng "spent" thì phải dùng Which/That/Rỗng.</li>
            </ul>
        `
    },
    {
        id: 11,
        type: 'multiple_choice',
        instruction: "",
        question: "Alan: “Hey, I heard you have an exam coming up. ________.”<br>John: “Thanks a lot.”",
        options: [
            { id: 'A', text: "Let’s study together later" },
            { id: 'B', text: "I hope I can pass this" },
            { id: 'C', text: "Would you like to teach me?" },
            { id: 'D', text: "Good luck with your studies!" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Dịch ngữ cảnh:</strong> Alan nghe tin John sắp thi. John trả lời "Cảm ơn nhiều". Vậy Alan phải chúc hoặc khen ngợi.</p>
            <ul>
                <li>A. Học cùng nhé (John sẽ không nói Cảm ơn nhiều theo cách xã giao này).</li>
                <li>B. Tớ hy vọng tớ qua (Đây là lời của người đi thi, không phải người chúc).</li>
                <li>C. Bạn dạy tớ nhé? (Sai ngữ cảnh).</li>
                <li><strong>D. Chúc may mắn nhé!</strong> -> Phù hợp nhất để nhận lại lời cảm ơn "Thanks a lot".</li>
            </ul>
        `
    },
    {
        id: 12,
        type: 'multiple_choice',
        instruction: "",
        question: "The survival of predators in the food chain relies _______ the availability of their prey.",
        options: [
            { id: 'A', text: "On" },
            { id: 'B', text: "with" },
            { id: 'C', text: "under" },
            { id: 'D', text: "for" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Dịch câu hỏi:</strong> Sự sống còn của động vật săn mồi trong chuỗi thức ăn phụ thuộc _______ sự có sẵn của con mồi.</p>
            <p><strong>Cấu trúc:</strong> Rely on (v): Phụ thuộc vào, dựa vào.</p>
            <p>Các giới từ khác không đi với Rely.</p>
        `
    },
    // GAP FILL - ANNOUNCEMENT
    {
        id: 13,
        type: 'multiple_choice',
        instruction: "Read the announcement and mark the correct option (13-16).",
        question: "Would you like a holiday job where you could meet people from all over (13) ____world?",
        options: [
            { id: 'A', text: "a" },
            { id: 'B', text: "an" },
            { id: 'C', text: "the" },
            { id: 'D', text: "X" }
        ],
        correct: 'C',
        explanation: "<p><strong>Cụm cố định:</strong> From all over <strong>the</strong> world (Từ khắp nơi trên thế giới).</p>"
    },
    {
        id: 14,
        type: 'multiple_choice',
        instruction: "",
        question: "We are looking (14) ___someone to work in the City Museum shop...",
        options: [
            { id: 'A', text: "for" },
            { id: 'B', text: "on" },
            { id: 'C', text: "at" },
            { id: 'D', text: "in" }
        ],
        correct: 'A',
        explanation: "<p><strong>Cấu trúc:</strong> Look for (v): Tìm kiếm. (Chúng tôi đang tìm kiếm ai đó...)</p>"
    },
    {
        id: 15,
        type: 'multiple_choice',
        instruction: "",
        question: "No experience is necessary but you must be (15) ____ and helpful...",
        options: [
            { id: 'A', text: "friend" },
            { id: 'B', text: "friendship" },
            { id: 'C', text: "friendliness" },
            { id: 'D', text: "friendly" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Phân tích ngữ pháp:</strong></p>
            <ul>
                <li>Sau động từ "be" và liên từ "and" nối với tính từ "helpful", ta cần một <strong>Tính từ</strong>.</li>
                <li>A. Friend (n): Bạn bè.</li>
                <li>B. Friendship (n): Tình bạn.</li>
                <li>C. Friendliness (n): Sự thân thiện.</li>
                <li>D. Friendly (adj): Thân thiện. -> Chọn D.</li>
            </ul>
        `
    },
    {
        id: 16,
        type: 'multiple_choice',
        instruction: "",
        question: "...and have interest (16) ____ art.",
        options: [
            { id: 'A', text: "at" },
            { id: 'B', text: "in" },
            { id: 'C', text: "of" },
            { id: 'D', text: "on" }
        ],
        correct: 'B',
        explanation: "<p><strong>Cấu trúc:</strong> Have an interest <strong>in</strong> something (Có hứng thú với cái gì).</p>"
    },
    // SENTENCE ARRANGEMENT
    {
        id: 17,
        type: 'sentence_arrangement',
        instruction: "Arrange the sentences to make a meaningful text.",
        dataText: `
            <p><strong>(a)</strong> Let’s start with the advantages. Living in a smart city can reduce the negative impact on the environment.</p>
            <p><strong>(b)</strong> In my opinion, the benefits are greater, and people will find a way to adapt to the new lifestyle.</p>
            <p><strong>(c)</strong> Smart cities are built on new technologies to improve people’s life.</p>
            <p><strong>(d)</strong> What about the disadvantages? Smart cities can also affect people’s private life.</p>
        `,
        question: "Choose the correct arrangement:",
        options: [
            { id: 'A', text: "a-c-b-d" },
            { id: 'B', text: "c-b-d-a" },
            { id: 'C', text: "c-d-a-b" },
            { id: 'D', text: "c-a-b-d" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Lưu ý về đáp án:</strong> Dựa trên logic bài văn, trật tự chuẩn thường là: Mở bài (c) -> Ưu điểm (a) -> Nhược điểm (d) -> Kết luận/Ý kiến (b). Tức là <strong>c-a-d-b</strong>. Tuy nhiên, trong các phương án đề bài đưa ra không có c-a-d-b.</p>
            <p><strong>Phân tích phương án D (c-a-b-d) là khả dĩ nhất (hoặc đề bị in sai vị trí b-d):</strong></p>
            <ul>
                <li>(c) Giới thiệu chủ đề Smart cities. (Bắt buộc đầu tiên).</li>
                <li>(a) "Let's start with advantages" -> Bắt đầu phần thân bài bằng ưu điểm. (Hợp lý sau c).</li>
                <li>(d) Nhược điểm.</li>
                <li>(b) "In my opinion... benefits are greater" (Ý kiến cá nhân/Kết luận: Lợi ích lớn hơn [tác hại]). Câu này thường phải đứng sau khi đã nêu cả lợi và hại.</li>
            </ul>
            <p><em>Giả định: Đáp án D (c-a-b-d) được chọn vì nó bắt đầu đúng mạch (c-a...), mặc dù vị trí b và d hơi ngược logic thông thường. Chúng ta chọn D vì đây là phương án duy nhất bắt đầu bằng mạch logic "Giới thiệu -> Ưu điểm".</em></p>
        `
    },
    {
        id: 18,
        type: 'multiple_choice',
        instruction: "",
        question: "Choose the sentence that most appropriately ends the text (in question 17)",
        options: [
            { id: 'A', text: "In conclusion, there are both advantages and disadvantages of living in a smart city." },
            { id: 'B', text: "In conclusion, residents should choose the best place to live." },
            { id: 'C', text: "In conclusion, because of drawbacks of smart city, we should move to rural areas..." },
            { id: 'D', text: "In conclusion, smart cities help people live longer." }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Phân tích:</strong> Bài văn thảo luận về cả mặt tốt (advantages) và mặt xấu (disadvantages) của thành phố thông minh.</p>
            <ul>
                <li><strong>A. Kết luận, có cả ưu và nhược điểm...</strong> -> Tóm tắt bao quát và trung lập nhất. Đúng.</li>
                <li>B. Khuyên chọn nơi sống (Không liên quan trực tiếp).</li>
                <li>C. Khuyên về quê (Quá tiêu cực, bài văn có nói benefits greater mà).</li>
                <li>D. Giúp sống lâu hơn (Chỉ là một chi tiết nhỏ, không bao quát).</li>
            </ul>
        `
    },
    // CLOZE TEST
    {
        id: 19,
        type: 'reading_cloze',
        instruction: "Read the passage and choose the correct option (19-24).",
        dataText: `
            <div class="data-box">
                <p>The wind controls our planet’s weather and climate. But how much do we understand about this complex force <strong>(19) ____</strong> can kill and spread fear? On the night of October 15, 1987, the south of England was struck by strong winds. Gusts of over 130 km/h <strong>(20) ____</strong> through the region. Nineteen people <strong>(21) ____</strong>, $1.5 billion worth of damage was <strong>(22) ____</strong> and 19 million trees were blown down in just a few hours. Although people thought of this as a hurricane, the winds of 1987 were only a <strong>(23) _____</strong> 7 storm. They remain far better known than the much more serious storms of January 25, 1990, when most of Britain was hit by daytime winds of up to 173 km/h. On this occasion, 47 people were killed, even though, <strong>(24) ____</strong> in 1987, the weather forecasters issued accurate warnings.</p>
            </div>
            <h4>GLOSSARY</h4>
            <table class="glossary">
                <tr><th>Word</th><th>Meaning</th></tr>
                <tr><td>Gusts (n)</td><td>Cơn gió mạnh đột ngột</td></tr>
                <tr><td>Struck (v - strike)</td><td>Tấn công, đổ bộ</td></tr>
            </table>
        `,
        question: "Question 19:",
        options: [
            { id: 'A', text: "what" },
            { id: 'B', text: "which" },
            { id: 'C', text: "when" },
            { id: 'D', text: "where" }
        ],
        correct: 'B',
        explanation: "<p>Thay thế cho danh từ chỉ vật 'force' (lực lượng/sức mạnh) -> Dùng <strong>Which</strong> hoặc That.</p>"
    },
    {
        id: 20,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 20:",
        options: [
            { id: 'A', text: "ran" },
            { id: 'B', text: "blew" },
            { id: 'C', text: "flew" },
            { id: 'D', text: "spread" }
        ],
        correct: 'B',
        explanation: "<p><strong>Collocation:</strong> Gió (Gusts/Winds) thì dùng <strong>blew</strong> (thổi). 'Gusts... blew through the region' (Những cơn gió mạnh thổi qua vùng này).</p>"
    },
    {
        id: 21,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 21:",
        options: [
            { id: 'A', text: "was killed" },
            { id: 'B', text: "killed" },
            { id: 'C', text: "were killed" },
            { id: 'D', text: "were being killed" }
        ],
        correct: 'C',
        explanation: "<p>Chủ ngữ 'Nineteen people' (số nhiều) + Bị động (bị giết/thiệt mạng) -> Dùng <strong>were killed</strong>.</p>"
    },
    {
        id: 22,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 22:",
        options: [
            { id: 'A', text: "paid" },
            { id: 'B', text: "created" },
            { id: 'C', text: "resulted" },
            { id: 'D', text: "caused" }
        ],
        correct: 'D',
        explanation: "<p>Damage was <strong>caused</strong> (Thiệt hại đã bị gây ra). Resulted thường đi với 'in' hoặc 'from'.</p>"
    },
    {
        id: 23,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 23:",
        options: [
            { id: 'A', text: "strength" },
            { id: 'B', text: "length" },
            { id: 'C', text: "power" },
            { id: 'D', text: "force" }
        ],
        correct: 'D',
        explanation: "<p>Thuật ngữ bão: <strong>Force 7 storm</strong> (Bão cấp 7 - theo thang Beaufort). Không dùng strength/power 7.</p>"
    },
    {
        id: 24,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 24:",
        options: [
            { id: 'A', text: "when" },
            { id: 'B', text: "like" },
            { id: 'C', text: "unlike" },
            { id: 'D', text: "such as" }
        ],
        correct: 'C',
        explanation: `
            <p><strong>Dịch ngữ cảnh:</strong> Năm 1990 chết 47 người, mặc dù dự báo chính xác... (trước đó đoạn 1 nói năm 1987 bị bất ngờ). Vậy năm 1990 <strong>không giống</strong> năm 1987 (năm 1987 không có cảnh báo chuẩn, năm 1990 có nhưng vẫn chết nhiều).</p>
            <p>Chọn <strong>Unlike</strong> (Không giống như).</p>
        `
    },
    // SENTENCE TRANSFORMATION
    {
        id: 25,
        type: 'multiple_choice',
        instruction: "Mark the sentence that is closest in meaning.",
        question: "A wetland is mostly covered with water. This is necessary for plants here.",
        options: [
            { id: 'A', text: "A wetland is mostly covered with water, what is necessary for plants here." },
            { id: 'B', text: "A wetland is mostly covered with water, when is necessary for plants here." },
            { id: 'C', text: "A wetland is mostly covered with water, which is necessary for plants here." },
            { id: 'D', text: "A wetland is mostly covered with water, where is necessary for plants here." }
        ],
        correct: 'C',
        explanation: `
            <p><strong>Giải thích:</strong> Mệnh đề "This is necessary..." thay thế cho cả sự việc "covered with water" phía trước. Dùng đại từ quan hệ <strong>Which</strong> để thay thế cho cả mệnh đề đứng trước.</p>
        `
    },
    {
        id: 26,
        type: 'multiple_choice',
        instruction: "",
        question: "We learnt about the vital role of clean water on Earth. The surface of Earth is mostly covered by water.",
        options: [
            { id: 'A', text: "We learnt about the vital role of clean water on Earth, which surface..." },
            { id: 'B', text: "We learnt about the vital role of clean water on Earth, whose surface..." },
            { id: 'C', text: "We learnt about the vital role of clean water on Earth, who surface..." },
            { id: 'D', text: "We learnt about the vital role of clean water on Earth, what surface..." }
        ],
        correct: 'B',
        explanation: `
            <p><strong>Giải thích:</strong> Surface (bề mặt) CỦA Earth (Trái đất). Dùng <strong>Whose</strong> để chỉ sở hữu. (The Earth, whose surface...)</p>
        `
    },
    {
        id: 27,
        type: 'multiple_choice',
        instruction: "Indicate the sentence made from the given cues.",
        question: "Flora and fauna/ be/ fascinating/ because/ their beauty/ significance/ human life.",
        options: [
            { id: 'A', text: "Flora and fauna are fascinating because their beauty and significance to human life." },
            { id: 'B', text: "Flora and fauna are fascinating because of their beauty and their significance to human life." },
            { id: 'C', text: "Flora and fauna are fascinating because at their beauty..." },
            { id: 'D', text: "Flora and fauna are fascinating because by their beauty..." }
        ],
        correct: 'B',
        explanation: `
            <p><strong>Giải thích:</strong> "Their beauty and significance" là một Cụm danh từ (Noun Phrase). Trước cụm danh từ phải dùng <strong>Because of</strong>. (Because + Mệnh đề S+V).</p>
            <p>Đáp án A sai vì dùng "Because" + Noun Phrase.</p>
        `
    },
    {
        id: 28,
        type: 'multiple_choice',
        instruction: "",
        question: "The Earth,/ surface/ be/ mostly water,/ be/ often/ call/ the “Blue Planet”",
        options: [
            { id: 'A', text: "The Earth, which has surface be mostly water, is often called..." },
            { id: 'B', text: "The Earth, whose surface is mostly water, often called..." },
            { id: 'C', text: "The Earth, which surface is mostly water, often called..." },
            { id: 'D', text: "The Earth, whose surface is mostly water, is often called the “Blue Planet”" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Giải thích:</strong></p>
            <ul>
                <li>Dùng <strong>Whose</strong> chỉ sở hữu (Bề mặt của Trái đất).</li>
                <li>Mệnh đề chính cần động từ chia bị động "is often called".</li>
                <li>Đáp án B thiếu động từ "is" ở vế sau (often called -> is often called).</li>
                <li>Đáp án D đầy đủ và đúng ngữ pháp nhất.</li>
            </ul>
        `
    },
    // SIGNS
    {
        id: 29,
        type: 'visual',
        instruction: "What does the sign say?",
        question: "",
        customHTML: `
            <div class="visual-container">
                <div class="sign-wet-paint">
                    <h2>WET PAINT</h2>
                    <div class="lower-text">
                        <h3>DO NOT<br>TOUCH</h3>
                        <div class="hand-icon">✋</div>
                    </div>
                </div>
            </div>
        `,
        options: [
            { id: 'A', text: "The paint is dry and safe to touch" },
            { id: 'B', text: "The paint is still wet, so please do not touch it" },
            { id: 'C', text: "You are encouraged to touch the paint" },
            { id: 'D', text: "The paint is not for public use." }
        ],
        correct: 'B',
        explanation: "<p>Biển báo ghi 'WET PAINT' (Sơn ướt) và 'DO NOT TOUCH' (Đừng chạm vào). -> Đáp án B đúng.</p>"
    },
    {
        id: 30,
        type: 'visual',
        instruction: "What does the notice say?",
        question: "",
        customHTML: `
            <div class="visual-container">
                <div class="notice-board">
                    <p style="color:blue">"Please wait in the designated area.<br>Do not move around while waiting for your turn"</p>
                </div>
            </div>
        `,
        options: [
            { id: 'A', text: "Wait in this area and do not move around" },
            { id: 'B', text: "You can wait anywhere" },
            { id: 'C', text: "Moving around while waiting is allowed" },
            { id: 'D', text: "Waiting is not required here." }
        ],
        correct: 'A',
        explanation: "<p>Thông báo ghi: 'Vui lòng chờ ở khu vực quy định. Đừng di chuyển lung tung'. -> Đáp án A khớp nghĩa hoàn toàn.</p>"
    },
    // READING 2
    {
        id: 31,
        type: 'reading_comp',
        instruction: "Read the passage and answer questions 31-36.",
        dataText: `
            <div class="data-box">
                <p>Polar habitats cover the top and bottom of planet Earth at the North and South Poles. The North Pole is surrounded by the Arctic Ocean. There isn’t any land here, just a group of continually shifting ice sheets. Parts of Canada and Greenland are near the North Pole. The South Pole is located in Antarctica. This area has land, but it’s completely covered with a layer of ice that’s almost 3 miles thick.</p>
                <p>The polar regions have two seasons: summer and winter. In the summer, the sun shines 24 hours a day, but it never gets high enough above the horizon to warm things up, so even summers are pretty cold. It’s dark all winter because the sun doesn’t rise during those months of the year. Fierce continuous winds make it feel even colder.</p>
                <p>It’s much too cold and dry for trees to grow in most areas of the Arctic, and there is no room for their roots, because just under the surface of the ground there is always a layer of ice, called permafrost. You won’t find trees in Antarctica, but some types of small shrubs, lichens, mosses, and algae are able to grow in the harsh climate.</p>
                <p>Polar bears and arctic foxes are adapted to the extreme weather of the Arctic region. Walruses and humpback whales live in the Arctic ocean. Several kinds of penguins, including the emperor penguin, live in Antarctica, and so do walruses and narwhals.</p>
            </div>
            <table class="glossary">
                <tr><th>Word</th><th>Meaning</th></tr>
                <tr><td>Permafrost</td><td>Lớp băng vĩnh cửu</td></tr>
                <tr><td>Shifting ice sheets</td><td>Các tảng băng trôi dạt/di chuyển</td></tr>
                <tr><td>Shrubs/Lichens</td><td>Cây bụi/Địa y</td></tr>
            </table>
        `,
        question: "Question 31: What is the main idea of the passage?",
        options: [
            { id: 'A', text: "Polar bears and penguins are well-adapted to their environments." },
            { id: 'B', text: "The North and South Poles have distinct geographical features." },
            { id: 'C', text: "The Arctic and Antarctic regions have unique and harsh climates." },
            { id: 'D', text: "Permafrost prevents tree growth in the Arctic." }
        ],
        correct: 'C',
        explanation: "<p><strong>Giải thích:</strong> Bài đọc nói tổng quan về cả đặc điểm địa lý, khí hậu (mùa, nhiệt độ), thực vật và động vật ở hai cực. Đáp án C (Khí hậu khắc nghiệt và độc đáo của Bắc/Nam cực) là bao quát nhất. Các đáp án khác chỉ là ý phụ.</p>"
    },
    {
        id: 32,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 32: Why can’t trees grow in the Arctic?",
        options: [
            { id: 'A', text: "Because the permafrost prevents the roots from growing" },
            { id: 'B', text: "Because the sun doesn’t rise most of the time." },
            { id: 'C', text: "Because shrubs and lichens grow instead of trees" },
            { id: 'D', text: "Because the winds make the weather even colder" }
        ],
        correct: 'A',
        explanation: `
            <p><strong>Dẫn chứng:</strong> "there is no room for their roots, because just under the surface of the ground there is always a layer of ice, called permafrost."</p>
            <p><strong>Dịch:</strong> Không có chỗ cho rễ cây vì ngay dưới mặt đất là lớp băng vĩnh cửu.</p>
        `
    },
    {
        id: 33,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 33: What animals can be found in both the North and South Poles?",
        options: [
            { id: 'A', text: "Polar bears" },
            { id: 'B', text: "Emperor penguins" },
            { id: 'C', text: "Humpback whales" },
            { id: 'D', text: "Walruses" }
        ],
        correct: 'D',
        explanation: `
            <p><strong>Dẫn chứng:</strong> "Walruses... live in the Arctic ocean." (Đoạn 4 dòng 2) VÀ "Several kinds of penguins... live in Antarctica, and so do walruses..." (Đoạn 4 dòng 3).</p>
            <p><strong>Lưu ý:</strong> Mặc dù thực tế sinh học Walrus chủ yếu ở Bắc Cực, nhưng <em>dựa vào văn bản bài đọc</em> thì tác giả viết chúng sống ở cả hai nơi. Ta phải chọn theo bài đọc -> Đáp án D.</p>
        `
    },
    {
        id: 34,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 34: Which of the following sentences is NOT TRUE about polar habitats?",
        options: [
            { id: 'A', text: "There is land covered with ice in the South Pole" },
            { id: 'B', text: "There are other types of penguins besides the emperor penguins in the South Pole" },
            { id: 'C', text: "The polar habitats have four seasons just like other parts of the world" },
            { id: 'D', text: "It’s cold and dry in most areas of the Arctic." }
        ],
        correct: 'C',
        explanation: `
            <p><strong>Dẫn chứng:</strong> "The polar regions have two seasons: summer and winter." (Đoạn 2).</p>
            <p><strong>Giải thích:</strong> Bài nói chỉ có 2 mùa, nhưng đáp án C nói có 4 mùa -> C là câu KHÔNG ĐÚNG.</p>
        `
    },
    {
        id: 35,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 35: The word “horizon” is CLOSEST in meaning to _____.",
        options: [
            { id: 'A', text: "Sea level" },
            { id: 'B', text: "skyline" },
            { id: 'C', text: "ice sheet" },
            { id: 'D', text: "the Earth" }
        ],
        correct: 'B',
        explanation: "<p>Horizon: Đường chân trời. Nghĩa gần nhất là <strong>Skyline</strong> (Đường chân trời/đường ranh giới trời đất).</p>"
    },
    {
        id: 36,
        type: 'multiple_choice',
        instruction: "",
        question: "Question 36: The word “harsh” is OPPOSITE in meaning to _____.",
        options: [
            { id: 'A', text: "Severe" },
            { id: 'B', text: "hard" },
            { id: 'C', text: "difficult" },
            { id: 'D', text: "comfortable" }
        ],
        correct: 'D',
        explanation: "<p>Harsh (adj): Khắc nghiệt. Trái nghĩa là <strong>Comfortable</strong> (Dễ chịu, thoải mái). Các từ còn lại (Severe, hard, difficult) là đồng nghĩa.</p>"
    },
    // GAP FILL - FAMILY (3 PART LAYOUT)
    {
        id: 37,
        type: 'gap_fill_layout',
        instruction: "Choose the correct phrase/sentence (A-D) to fill in the blanks (37-40).",
        optionsList: [
            { label: 'A', text: "they also think the man should support the family" },
            { label: 'B', text: "there may be more one-person households" },
            { label: 'C', text: "Others think that the only certainty in history changes" },
            { label: 'D', text: "In fact, if more women decide to have children on their own" }
        ],
        textWithGaps: `
            Many people today would like the traditional two-parent family back, that is to say, they want a man and a woman to marry for life; <strong>(37) _____</strong>, the woman should stay home with the children. However, few families now fall in this category. <strong>(38) _____</strong>, the single-parents household may become more typical than the traditional family in many countries. Also, couples may decide to have more children, or they might take in foster children or bring up. And because people are staying single and living longer, <strong>(39) _____</strong>. On the other hand, some people believe that similar events happen again and again in history. If this is true, people may go back to the traditional extended or nuclear family of the past. <strong>(40) _____</strong>. In other words, the structure of the future family could begin to change faster and faster and in more and more ways.
        `,
        questions: [
            {
                qId: 37,
                question: "Question 37",
                options: [ {id:'A', text:'A'}, {id:'B', text:'B'}, {id:'C', text:'C'}, {id:'D', text:'D'} ],
                correct: 'A',
                explanation: "Câu trước nói về gia đình truyền thống (đàn ông phụ nữ kết hôn), vế sau (37) bổ sung ý kiến truyền thống: 'họ cũng nghĩ đàn ông nên nuôi gia đình', phụ nữ ở nhà. -> A hợp lý."
            },
            {
                qId: 38,
                question: "Question 38",
                options: [ {id:'A', text:'A'}, {id:'B', text:'B'}, {id:'C', text:'C'}, {id:'D', text:'D'} ],
                correct: 'D',
                explanation: "Câu sau nhắc đến 'single-parents household' (hộ gia đình đơn thân). Đáp án D: 'Nếu phụ nữ quyết định có con một mình' -> Dẫn đến gia đình đơn thân. -> D hợp lý."
            },
            {
                qId: 39,
                question: "Question 39",
                options: [ {id:'A', text:'A'}, {id:'B', text:'B'}, {id:'C', text:'C'}, {id:'D', text:'D'} ],
                correct: 'B',
                explanation: "Câu trước: 'staying single and living longer' (sống độc thân và sống thọ hơn). -> Hệ quả: 'có nhiều hộ gia đình một người hơn'. -> B hợp lý."
            },
            {
                qId: 40,
                question: "Question 40",
                options: [ {id:'A', text:'A'}, {id:'B', text:'B'}, {id:'C', text:'C'}, {id:'D', text:'D'} ],
                correct: 'C',
                explanation: "Đoạn trước nói về quan điểm 'lịch sử lặp lại' (quay lại quá khứ). Câu sau (40) đưa ra quan điểm ngược lại để dẫn vào câu kết 'cấu trúc thay đổi nhanh hơn'. Đáp án C: 'Người khác nghĩ rằng điều chắc chắn duy nhất là sự thay đổi' -> Phù hợp ngữ cảnh chuyển ý."
            }
        ]
    }
];

// --- RENDER FUNCTIONS ---
const container = document.getElementById('quiz-container');

function renderQuiz() {
    quizData.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.id = `card-${item.id || 'group-' + index}`;

        // Header Instruction
        if (item.instruction) {
            const instr = document.createElement('div');
            instr.style.color = '#666';
            instr.style.fontStyle = 'italic';
            instr.style.marginBottom = '10px';
            instr.innerText = item.instruction;
            card.appendChild(instr);
        }

        // Handle Types
        if (item.type === 'gap_fill_layout') {
            renderGapFillLayout(item, card);
        } else {
            // Standard render for most types
            // Data Box for Reading/Cloze
            if (item.dataText) {
                const dataDiv = document.createElement('div');
                dataDiv.innerHTML = item.dataText;
                card.appendChild(dataDiv);
            }

            // Custom HTML (for Signs)
            if (item.customHTML) {
                const customDiv = document.createElement('div');
                customDiv.innerHTML = item.customHTML;
                card.appendChild(customDiv);
            }

            // Question Title
            const qTitle = document.createElement('div');
            qTitle.className = 'q-title';
            qTitle.innerText = item.question || `Question ${item.id}`;
            card.appendChild(qTitle);

            // Options
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-grid';
            
            item.options.forEach(opt => {
                const label = document.createElement('label');
                label.className = 'option-label';
                label.id = `label-${item.id}-${opt.id}`;
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `q${item.id}`;
                radio.value = opt.id;
                
                label.appendChild(radio);
                // Allow HTML in options (for underlining)
                const span = document.createElement('span');
                span.innerHTML = `${opt.id}. ${opt.text}`;
                label.appendChild(span);
                
                optionsDiv.appendChild(label);
            });
            card.appendChild(optionsDiv);

            // Check Button
            const checkBtn = document.createElement('button');
            checkBtn.className = 'btn-check';
            checkBtn.innerText = 'Kiểm tra câu này';
            checkBtn.onclick = () => checkQuestion(item.id);
            card.appendChild(checkBtn);

            // Explanation
            const explainDiv = document.createElement('div');
            explainDiv.className = 'explanation';
            explainDiv.id = `explain-${item.id}`;
            explainDiv.innerHTML = `<h4>GIẢI THÍCH CHI TIẾT:</h4> ${item.explanation}`;
            card.appendChild(explainDiv);
        }

        container.appendChild(card);
    });
}

function renderGapFillLayout(item, card) {
    // 1. Options Box
    const optionsBox = document.createElement('div');
    optionsBox.className = 'gf-options-box';
    optionsBox.innerHTML = `<strong>OPTIONS:</strong><br>`;
    item.optionsList.forEach(opt => {
        optionsBox.innerHTML += `<span class="gf-option-item"><strong>${opt.label}:</strong> ${opt.text}</span>`;
    });
    
    // 2. Text Box
    const textBox = document.createElement('div');
    textBox.className = 'gf-text-box';
    textBox.innerHTML = item.textWithGaps;

    // 3. Answer Area
    const answerArea = document.createElement('div');
    answerArea.className = 'gf-answer-area';

    const containerDiv = document.createElement('div');
    containerDiv.className = 'gap-fill-container';
    containerDiv.appendChild(optionsBox);
    containerDiv.appendChild(textBox);
    containerDiv.appendChild(answerArea);
    card.appendChild(containerDiv);

    // Render Sub-questions inside Answer Area
    item.questions.forEach(subQ => {
        const subDiv = document.createElement('div');
        subDiv.style.marginBottom = '20px';
        subDiv.style.borderBottom = '1px dashed #ccc';
        subDiv.style.paddingBottom = '10px';
        subDiv.id = `card-${subQ.qId}`; // Mock card ID for styling

        const title = document.createElement('div');
        title.className = 'q-title';
        title.innerText = subQ.question;
        subDiv.appendChild(title);

        const optsDiv = document.createElement('div');
        optsDiv.className = 'options-grid';
        optsDiv.style.gridTemplateColumns = 'repeat(4, 1fr)'; // Compact for A B C D

        subQ.options.forEach(opt => {
            const label = document.createElement('label');
            label.className = 'option-label';
            label.style.textAlign = 'center';
            label.id = `label-${subQ.qId}-${opt.id}`;

            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = `q${subQ.qId}`;
            radio.value = opt.id;

            label.appendChild(radio);
            label.appendChild(document.createTextNode(opt.text));
            optsDiv.appendChild(label);
        });
        subDiv.appendChild(optsDiv);

        // Check Button for SubQ
        const checkBtn = document.createElement('button');
        checkBtn.className = 'btn-check';
        checkBtn.innerText = 'Kiểm tra';
        checkBtn.onclick = () => checkQuestion(subQ.qId);
        subDiv.appendChild(checkBtn);

        // Explanation for SubQ
        const explDiv = document.createElement('div');
        explDiv.className = 'explanation';
        explDiv.id = `explain-${subQ.qId}`;
        explDiv.innerHTML = `<h4>GIẢI THÍCH CHI TIẾT:</h4> ${subQ.explanation}`;
        subDiv.appendChild(explDiv);

        answerArea.appendChild(subDiv);
    });
}

// --- LOGIC FUNCTIONS ---

function getQuestionData(id) {
    // Find in main list
    let found = quizData.find(q => q.id === id);
    if (found) return found;
    
    // Find in sub-questions (gap fill)
    for (let q of quizData) {
        if (q.questions) {
            let sub = q.questions.find(sq => sq.qId === id);
            if (sub) return sub;
        }
    }
    return null;
}

function checkQuestion(id) {
    const qData = getQuestionData(id);
    if (!qData) return;

    // Get selected value
    const selected = document.querySelector(`input[name="q${id}"]:checked`);
    const card = document.getElementById(`card-${id}`);
    const explanation = document.getElementById(`explain-${id}`);

    // Reset styles
    document.querySelectorAll(`input[name="q${id}"]`).forEach(input => {
        const label = document.getElementById(`label-${id}-${input.value}`);
        label.classList.remove('is-correct', 'is-wrong');
    });

    if (!selected) {
        alert("Vui lòng chọn một đáp án trước khi kiểm tra!");
        return;
    }

    const userVal = selected.value;
    const correctVal = qData.correct;

    // Highlight Selected
    const selectedLabel = document.getElementById(`label-${id}-${userVal}`);
    if (userVal === correctVal) {
        selectedLabel.classList.add('is-correct');
        if(card) card.classList.add('correct');
    } else {
        selectedLabel.classList.add('is-wrong');
        // Show correct one
        document.getElementById(`label-${id}-${correctVal}`).classList.add('is-correct');
        if(card) card.classList.add('incorrect');
    }

    // Show Explanation
    explanation.style.display = 'block';
}

function submitTest() {
    let score = 0;
    let total = 40;
    let unanswered = 0;

    // Loop through 1 to 40
    for (let i = 1; i <= 40; i++) {
        const qData = getQuestionData(i);
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        const card = document.getElementById(`card-${i}`);
        const explanation = document.getElementById(`explain-${i}`);

        if (selected) {
            if (selected.value === qData.correct) {
                score++;
                // Visual Check triggers automatically
                checkQuestion(i); 
            } else {
                checkQuestion(i);
            }
        } else {
            unanswered++;
            // Mark as Unanswered visuals
            if(card) card.classList.add('unanswered');
            // Show correct answer
            const correctLabel = document.getElementById(`label-${i}-${qData.correct}`);
            if(correctLabel) correctLabel.classList.add('is-correct');
            // Show Explanation
            if(explanation) explanation.style.display = 'block';
        }
    }

    // Show Popup
    const popup = document.getElementById('result-popup');
    const overlay = document.getElementById('overlay');
    const scoreText = document.getElementById('score-text');
    
    scoreText.innerText = `${score} / ${total}`;
    overlay.style.display = 'block';
    popup.style.display = 'block';
}

function closePopup() {
    document.getElementById('result-popup').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
    window.scrollTo(0,0);
}

// Initial Render
renderQuiz();

</script>
</body>
</html>

