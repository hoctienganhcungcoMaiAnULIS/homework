<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Gi·ªõi T·ª´ - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* H·ªìng t√≠m nh·∫°t */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: radial-gradient(#d4d4d4 1px, transparent 1px);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f3f8;
            background-image: var(--bg-pattern);
            background-size: 20px 20px;
            color: #333;
            margin: 0;
            padding: 0;
            padding-bottom: 50px;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--primary), #a29bfe);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        header h1 {
            font-size: 1.2rem;
            margin: 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            font-size: 0.9rem;
            margin: 5px 0 0;
            opacity: 0.9;
        }

        /* --- Container --- */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* --- Theory Section --- */
        .theory-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            border: 2px solid #e1e1e1;
        }

        .theory-title {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 3px dashed #eee;
            padding-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        th {
            background-color: var(--secondary);
            color: white;
            padding: 12px;
            text-align: left;
            border-radius: 8px 8px 0 0;
        }

        td {
            border: 1px solid #eee;
            padding: 10px;
            vertical-align: top;
        }

        tr:nth-child(even) {
            background-color: #f9fdfc;
        }

        .highlight-box {
            background-color: #fff4e6;
            border-left: 5px solid #ff9f43;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        /* --- Question Card --- */
        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 0 #dfe6e9; /* 3D Effect */
            border: 2px solid #e1e1e1;
            transition: transform 0.2s;
            position: relative;
        }

        .question-number {
            background: var(--primary);
            color: white;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e1e1e1;
            border-radius: 15px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #e1e1e1; /* 3D button */
            position: relative;
            outline: none;
        }

        .option-btn:hover {
            transform: scale(1.02);
            border-color: var(--secondary);
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #00b85c;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #e03b4b;
            box-shadow: 0 4px 0 #e03b4b;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* --- Explanation Box --- */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background-color: #f0fbf7;
            border: 2px dashed var(--secondary);
            border-radius: 15px;
            padding: 20px;
            animation: slideDown 0.3s ease-out;
        }

        .exp-header {
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .exp-label {
            font-weight: 700;
            color: #2d3436;
        }

        /* --- Animations --- */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Footer / Submit --- */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: linear-gradient(to bottom, #00C9A7, #00b89c);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            box-shadow: 0 8px 0 #008f72;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: none;
        }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: zoomIn 0.3s;
            border: 5px solid var(--primary);
        }

        .score-display {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<header>
    <h1>Ms Mai An ULIS</h1>
    <p>Chuy√™n gia Luy·ªán thi & Ti·∫øng Anh H·ªçc thu·∫≠t</p>
</header>

<div class="container">

    <div class="theory-card">
        <div class="theory-title">üìö √îN T·∫¨P: GI·ªöI T·ª™ CH·ªà TH·ªúI GIAN</div>
        <table>
            <thead><tr><th>Gi·ªõi t·ª´</th><th>C√°ch d√πng</th><th>V√≠ d·ª•</th></tr></thead>
            <tbody>
                <tr>
                    <td><b>IN</b></td>
                    <td>- Bu·ªïi trong ng√†y<br>- Th√°ng, NƒÉm, M√πa, Th·∫ø k·ª∑<br>- Kho·∫£ng th·ªùi gian (bao l√¢u n·ªØa)</td>
                    <td>- in the morning<br>- in 2020, in May<br>- in summer<br>- in two hours (trong 2 ti·∫øng n·ªØa)</td>
                </tr>
                <tr>
                    <td><b>ON</b></td>
                    <td>- Ng√†y trong tu·∫ßn<br>- Ng√†y th√°ng nƒÉm c·ª• th·ªÉ<br>- Ng√†y l·ªÖ c√≥ ch·ª© "Day"</td>
                    <td>- on Monday<br>- on May 19th<br>- on Christmas Day</td>
                </tr>
                <tr>
                    <td><b>AT</b></td>
                    <td>- Gi·ªù c·ª• th·ªÉ<br>- Th·ªùi ƒëi·ªÉm (noon, night)<br>- D·ªãp l·ªÖ (kh√¥ng c√≥ Day)</td>
                    <td>- at 7 p.m.<br>- at night, at noon<br>- at Christmas, at the moment</td>
                </tr>
            </tbody>
        </table>
        
        <div class="highlight-box">
            <b>‚ö† L∆∞u √Ω quan tr·ªçng:</b><br>
            - <i>in a minute / in an hour</i>: Trong 1 ph√∫t/gi·ªù n·ªØa (t∆∞∆°ng lai).<br>
            - Kh√¥ng d√πng gi·ªõi t·ª´ tr∆∞·ªõc: <i>tomorrow, yesterday, tonight, this morning...</i>
        </div>
    </div>

    <div class="theory-card">
        <div class="theory-title">üåç √îN T·∫¨P: GI·ªöI T·ª™ CH·ªà V·ªä TR√ç & N∆†I CH·ªêN</div>
        <table>
            <thead><tr><th>Gi·ªõi t·ª´</th><th>C√°ch d√πng</th><th>V√≠ d·ª•</th></tr></thead>
            <tbody>
                <tr>
                    <td><b>IN</b></td>
                    <td>- Kh√¥ng gian k√≠n, trong t√≤a nh√†<br>- Th√†nh ph·ªë, Qu·ªëc gia, Ch√¢u l·ª•c</td>
                    <td>- in the box, in the room<br>- in Hanoi, in Vietnam</td>
                </tr>
                <tr>
                    <td><b>ON</b></td>
                    <td>- Tr√™n b·ªÅ m·∫∑t<br>- T√™n ƒë∆∞·ªùng, S·ªë t·∫ßng, ƒê·∫£o<br>- Ph∆∞∆°ng ti·ªán c√¥ng c·ªông (bus, train, plane)</td>
                    <td>- on the table, on the wall<br>- on Le Loi Street<br>- on the bus, on a plane</td>
                </tr>
                <tr>
                    <td><b>AT</b></td>
                    <td>- ƒê·ªãa ch·ªâ c·ª• th·ªÉ (s·ªë nh√†)<br>- N∆°i ch·ªën c·ª• th·ªÉ (ƒë·ªÉ l√†m g√¨ ƒë√≥: at school, at work)</td>
                    <td>- at 25 Tran Phu Street<br>- at school, at the airport</td>
                </tr>
            </tbody>
        </table>

        <div class="highlight-box">
            <b>üöó Ph∆∞∆°ng ti·ªán ƒëi l·∫°i:</b><br>
            - <b>IN</b>: car, taxi (xe nh·ªè, ng·ªìi trong).<br>
            - <b>ON</b>: bus, train, plane, ship, bike (ph∆∞∆°ng ti·ªán c√¥ng c·ªông/xe m√°y).<br><br>
            <b>‚úàÔ∏è Arrive (ƒê·∫øn):</b><br>
            - Arrive <b>IN</b>: Th√†nh ph·ªë, ƒê·∫•t n∆∞·ªõc (ƒë·ªãa ƒëi·ªÉm to).<br>
            - Arrive <b>AT</b>: S√¢n bay, Ga t√†u, Kh√°ch s·∫°n (ƒë·ªãa ƒëi·ªÉm nh·ªè).
        </div>
    </div>

    <hr style="border: 0; border-top: 2px dashed #ccc; margin: 40px 0;">

    <div id="quiz-container">
        </div>

    <div class="submit-section">
        <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI üìù</button>
    </div>

</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h2>üéâ K·∫æT QU·∫¢ üéâ</h2>
        <div class="score-display" id="finalScore">0/30</div>
        <p id="feedbackText">L√†m t·ªët l·∫Øm!</p>
        <button class="submit-btn" onclick="closeModal()" style="font-size: 1rem; padding: 10px 30px;">Xem l·∫°i b√†i</button>
    </div>
</div>

<script>
    // --- DATABASE: 30 Questions (Full detailed explanation) ---
    const questionsData = [
        // --- PREPOSITIONS OF TIME ---
        {
            q: "We often watch TV ______ the evening.",
            options: ["A. at", "B. in", "C. on", "D. to"],
            correct: 1, // B
            trans: "Ch√∫ng t√¥i th∆∞·ªùng xem TV v√†o bu·ªïi t·ªëi.",
            vocab: [
                "A. at: D√πng cho gi·ªù/th·ªùi ƒëi·ªÉm c·ª• th·ªÉ.",
                "B. in: D√πng cho bu·ªïi trong ng√†y/th√°ng/nƒÉm.",
                "C. on: D√πng cho ng√†y/th·ª©.",
                "D. to: ƒê·∫øn (h∆∞·ªõng di chuy·ªÉn)."
            ],
            whyRight: "C·ª•m t·ª´ c·ªë ƒë·ªãnh ch·ªâ c√°c bu·ªïi trong ng√†y: 'in the morning', 'in the afternoon', 'in the evening'.",
            whyWrong: "Kh√¥ng d√πng 'at/on' cho 'the evening' tr·ª´ khi c√≥ ng√†y c·ª• th·ªÉ ƒëi k√®m (v√≠ d·ª•: on Friday evening)."
        },
        {
            q: "My birthday is ______ May 19th.",
            options: ["A. in", "B. at", "C. on", "D. from"],
            correct: 2, // C
            trans: "Sinh nh·∫≠t c·ªßa t√¥i v√†o ng√†y 19 th√°ng 5.",
            vocab: [
                "A. in: D√πng cho th√°ng/nƒÉm.",
                "B. at: D√πng cho gi·ªù.",
                "C. on: D√πng cho ng√†y c·ª• th·ªÉ.",
                "D. from: T·ª´."
            ],
            whyRight: "Quy t·∫Øc: Tr∆∞·ªõc ng√†y th√°ng c·ª• th·ªÉ (May 19th) ta lu√¥n d√πng gi·ªõi t·ª´ 'ON'.",
            whyWrong: "'In' ch·ªâ d√πng n·∫øu ch·ªâ c√≥ th√°ng (in May). ·ªû ƒë√¢y c√≥ ng√†y 19 n√™n ph·∫£i d√πng 'On'."
        },
        {
            q: "The train leaves ______ 7 o'clock.",
            options: ["A. on", "B. in", "C. for", "D. at"],
            correct: 3, // D
            trans: "T√†u r·ªùi ƒëi l√∫c 7 gi·ªù.",
            vocab: [
                "A. on: Tr√™n/v√†o ng√†y.",
                "B. in: Trong.",
                "C. for: Cho/trong kho·∫£ng.",
                "D. at: T·∫°i/l√∫c."
            ],
            whyRight: "Tr∆∞·ªõc gi·ªù c·ª• th·ªÉ (7 o'clock), ta d√πng gi·ªõi t·ª´ 'AT'.",
            whyWrong: "'On/In' kh√¥ng d√πng ƒë·ªÉ ch·ªâ gi·ªù gi·∫•c c·ª• th·ªÉ."
        },
        {
            q: "He was born ______ 1990.",
            options: ["A. at", "B. on", "C. in", "D. since"],
            correct: 2, // C
            trans: "Anh ·∫•y sinh nƒÉm 1990.",
            vocab: [
                "A. at (prep): l√∫c.",
                "B. on (prep): v√†o ng√†y.",
                "C. in (prep): v√†o nƒÉm/th√°ng.",
                "D. since (prep): k·ªÉ t·ª´ khi."
            ],
            whyRight: "Tr∆∞·ªõc c√°c nƒÉm (years), th·∫ø k·ª∑, th·∫≠p k·ª∑, ta d√πng gi·ªõi t·ª´ 'IN'.",
            whyWrong: "'On' d√πng cho ng√†y, 'At' d√πng cho gi·ªù."
        },
        {
            q: "We will meet ______ Christmas Day.",
            options: ["A. in", "B. at", "C. on", "D. of"],
            correct: 2, // C
            trans: "Ch√∫ng ta s·∫Ω g·∫∑p nhau v√†o ng√†y Gi√°ng sinh.",
            vocab: [
                "A. in (prep): trong.",
                "B. at (prep): t·∫°i.",
                "C. on (prep): v√†o ng√†y.",
                "D. of (prep): c·ªßa."
            ],
            whyRight: "M·∫∑c d√π 'Christmas' ƒë·ª©ng m·ªôt m√¨nh d√πng 'At', nh∆∞ng khi c√≥ ch·ªØ 'Day' (Christmas Day), ta bu·ªôc ph·∫£i d√πng 'ON' v√¨ n√≥ ch·ªâ m·ªôt ng√†y c·ª• th·ªÉ.",
            whyWrong: "Ch·ªâ d√πng 'At Christmas' (d·ªãp l·ªÖ). D√πng 'On Christmas Day' (ng√†y l·ªÖ)."
        },
        {
            q: "Are you busy ______ the moment?",
            options: ["A. on", "B. in", "C. at", "D. with"],
            correct: 2, // C
            trans: "B·∫°n c√≥ b·∫≠n v√†o l√∫c n√†y kh√¥ng?",
            vocab: [
                "A. on: tr√™n.",
                "B. in: trong.",
                "C. at: t·∫°i.",
                "D. with: v·ªõi."
            ],
            whyRight: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'At the moment' (ngay l√∫c n√†y).",
            whyWrong: "Kh√¥ng c√≥ c·ª•m 'in the moment' hay 'on the moment' trong ng·ªØ c·∫£nh n√†y."
        },
        {
            q: "I usually go to the beach ______ summer.",
            options: ["A. at", "B. on", "C. in", "D. by"],
            correct: 2, // C
            trans: "T√¥i th∆∞·ªùng ƒëi bi·ªÉn v√†o m√πa h√®.",
            vocab: [
                "A. at: t·∫°i.",
                "B. on: tr√™n.",
                "C. in: trong/v√†o.",
                "D. by: b·ªüi."
            ],
            whyRight: "Tr∆∞·ªõc c√°c m√πa trong nƒÉm (spring, summer, autumn, winter), ta d√πng gi·ªõi t·ª´ 'IN'.",
            whyWrong: "'On' d√πng cho ng√†y, 'At' d√πng cho th·ªùi ƒëi·ªÉm c·ª• th·ªÉ."
        },
        {
            q: "Can you finish the report ______ two hours?",
            options: ["A. at", "B. on", "C. in", "D. during"],
            correct: 2, // C
            trans: "B·∫°n c√≥ th·ªÉ ho√†n th√†nh b√°o c√°o trong 2 ti·∫øng n·ªØa kh√¥ng?",
            vocab: [
                "A. at: t·∫°i.",
                "B. on: tr√™n.",
                "C. in: trong (bao l√¢u n·ªØa).",
                "D. during: trong su·ªët."
            ],
            whyRight: "'In' + kho·∫£ng th·ªùi gian = Trong bao l√¢u n·ªØa (th∆∞·ªùng d√πng cho t∆∞∆°ng lai). V√≠ d·ª•: In 5 minutes.",
            whyWrong: "'During' mang nghƒ©a 'trong su·ªët qu√° tr√¨nh di·ªÖn ra', kh√¥ng d√πng ƒë·ªÉ ch·ªâ h·∫°n ƒë·ªãnh ho√†n th√†nh trong t∆∞∆°ng lai g·∫ßn."
        },
        
        // --- PREPOSITIONS OF PLACE ---
        {
            q: "My family lives ______ Hanoi.",
            options: ["A. at", "B. on", "C. in", "D. to"],
            correct: 2, // C
            trans: "Gia ƒë√¨nh t√¥i s·ªëng ·ªü H√† N·ªôi.",
            vocab: [
                "A. at: t·∫°i (ƒëi·ªÉm nh·ªè).",
                "B. on: tr√™n.",
                "C. in: trong (khu v·ª±c l·ªõn).",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Tr∆∞·ªõc t√™n th√†nh ph·ªë, ƒë·∫•t n∆∞·ªõc, ch√¢u l·ª•c (ƒë·ªãa ƒëi·ªÉm r·ªông l·ªõn), ta d√πng 'IN'.",
            whyWrong: "'At' ch·ªâ d√πng cho ƒë·ªãa ƒëi·ªÉm nh·ªè c·ª• th·ªÉ (s√¢n bay, tr∆∞·ªùng h·ªçc)."
        },
        {
            q: "Don't leave your books ______ the floor.",
            options: ["A. in", "B. at", "C. on", "D. under"],
            correct: 2, // C
            trans: "ƒê·ª´ng ƒë·ªÉ s√°ch c·ªßa b·∫°n tr√™n s√†n nh√†.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n b·ªÅ m·∫∑t.",
                "D. under: d∆∞·ªõi."
            ],
            whyRight: "S√†n nh√† (floor) l√† m·ªôt b·ªÅ m·∫∑t ph·∫≥ng. Tr∆∞·ªõc b·ªÅ m·∫∑t, ta d√πng 'ON'.",
            whyWrong: "'In' l√† b√™n trong kh√¥ng gian k√≠n."
        },
        {
            q: "She lives ______ 25 Tran Phu Street.",
            options: ["A. in", "B. on", "C. at", "D. from"],
            correct: 2, // C
            trans: "C√¥ ·∫•y s·ªëng t·∫°i s·ªë 25 ƒë∆∞·ªùng Tr·∫ßn Ph√∫.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. from: t·ª´."
            ],
            whyRight: "Khi c√≥ s·ªë nh√† c·ª• th·ªÉ (ƒë·ªãa ch·ªâ ch√≠nh x√°c), ta d√πng 'AT'.",
            whyWrong: "N·∫øu ch·ªâ c√≥ t√™n ƒë∆∞·ªùng (Tran Phu Street) th√¨ d√πng 'On'. Nh∆∞ng c√≥ s·ªë nh√† ph·∫£i d√πng 'At'."
        },
        {
            q: "The picture is ______ the wall.",
            options: ["A. in", "B. at", "C. on", "D. above"],
            correct: 2, // C
            trans: "B·ª©c tranh ·ªü tr√™n t∆∞·ªùng.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n b·ªÅ m·∫∑t.",
                "D. above: ph√≠a tr√™n (kh√¥ng ch·∫°m)."
            ],
            whyRight: "T∆∞·ªùng (wall) l√† b·ªÅ m·∫∑t. Tranh treo ti·∫øp x√∫c v·ªõi m·∫∑t t∆∞·ªùng n√™n d√πng 'ON'.",
            whyWrong: "'Above' nghƒ©a l√† treo l∆° l·ª≠ng ph√≠a tr√™n ch·ª© kh√¥ng ch·∫°m v√†o."
        },
        {
            q: "I am currently ______ work.",
            options: ["A. in", "B. at", "C. on", "D. to"],
            correct: 1, // B
            trans: "Hi·ªán t·∫°i t√¥i ƒëang ·ªü ch·ªó l√†m.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "C·ª•m c·ªë ƒë·ªãnh ch·ªâ tr·∫°ng th√°i ƒëang l√†m g√¨ ·ªü ƒë√¢u: 'at work', 'at school', 'at home'.",
            whyWrong: "Kh√¥ng d√πng 'in work' ƒë·ªÉ ch·ªâ ƒë·ªãa ƒëi·ªÉm l√†m vi·ªác."
        },

        // --- TRANSPORT & MOTION & ARRIVE ---
        {
            q: "We went to Da Nang ______ plane.",
            options: ["A. in", "B. on", "C. by", "D. with"],
            correct: 2, // C (Wait, check prompt theory carefully. Prompt implies prep with vehicles. Usually 'by plane'. But if prompt focuses on in/on/at specific usage: 'on a plane'. The question is generic mode transport -> BY. But let's check the table provided. Table says 'on a plane' (location) but standard transport mode is 'by'. Let's stick to standard grammar: By + vehicle. OR adjust question to 'We are ... the plane'")
            // Let's change question to location to fit the 'IN/ON' theory better.
            q: "There are many passengers ______ the plane.",
            options: ["A. in", "B. at", "C. on", "D. by"],
            correct: 2, // C
            trans: "C√≥ r·∫•t nhi·ªÅu h√†nh kh√°ch tr√™n m√°y bay.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n.",
                "D. by: b·∫±ng."
            ],
            whyRight: "V·ªõi c√°c ph∆∞∆°ng ti·ªán c√¥ng c·ªông l·ªõn c√≥ th·ªÉ ƒëi l·∫°i b√™n trong (bus, train, plane), ta d√πng gi·ªõi t·ª´ 'ON'.",
            whyWrong: "'In' d√πng cho ph∆∞∆°ng ti·ªán nh·ªè c√° nh√¢n (car, taxi)."
        },
        {
            q: "He arrived ______ the airport very late.",
            options: ["A. in", "B. on", "C. at", "D. to"],
            correct: 2, // C
            trans: "Anh ·∫•y ƒë·∫øn s√¢n bay r·∫•t mu·ªôn.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Arrive AT + ƒë·ªãa ƒëi·ªÉm nh·ªè, c·ª• th·ªÉ (airport, station, school).",
            whyWrong: "Arrive IN + ƒë·ªãa ƒëi·ªÉm l·ªõn (th√†nh ph·ªë, qu·ªëc gia). Kh√¥ng bao gi·ªù d√πng 'Arrive to'."
        },
        {
            q: "They arrived ______ Vietnam yesterday.",
            options: ["A. at", "B. in", "C. on", "D. to"],
            correct: 1, // B
            trans: "H·ªç ƒë√£ ƒë·∫øn Vi·ªát Nam ng√†y h√¥m qua.",
            vocab: [
                "A. at: t·∫°i.",
                "B. in: trong.",
                "C. on: tr√™n.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Vietnam l√† m·ªôt qu·ªëc gia (ƒë·ªãa ƒëi·ªÉm l·ªõn) -> D√πng 'Arrive IN'.",
            whyWrong: "'At' ch·ªâ d√πng cho ƒë·ªãa ƒëi·ªÉm nh·ªè."
        },
        {
            q: "She goes to school ______ foot.",
            options: ["A. on", "B. in", "C. by", "D. with"],
            correct: 0, // A
            trans: "C√¥ ·∫•y ƒëi b·ªô ƒë·∫øn tr∆∞·ªùng.",
            vocab: [
                "A. on: tr√™n.",
                "B. in: trong.",
                "C. by: b·∫±ng.",
                "D. with: v·ªõi."
            ],
            whyRight: "C·ª•m c·ªë ƒë·ªãnh: 'On foot' (ƒëi b·ªô).",
            whyWrong: "M·∫∑c d√π ph∆∞∆°ng ti·ªán kh√°c d√πng 'by' (by car, by bus), nh∆∞ng ƒëi b·ªô b·∫Øt bu·ªôc d√πng 'on foot'."
        },
        {
            q: "Get ______ the car! We need to leave now.",
            options: ["A. on", "B. at", "C. in", "D. to"],
            correct: 2, // C
            trans: "L√™n xe ƒëi! Ch√∫ng ta c·∫ßn r·ªùi ƒëi ngay.",
            vocab: [
                "A. on: tr√™n.",
                "B. at: t·∫°i.",
                "C. in: v√†o trong.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "V·ªõi xe √¥ t√¥ con (car) ho·∫∑c taxi, ta d√πng 'In' (get in) v√¨ ph·∫£i khom ng∆∞·ªùi chui v√†o.",
            whyWrong: "'On' d√πng cho xe bu√Ωt, t√†u h·ªèa."
        },
        {
            q: "My father is working ______ the garden.",
            options: ["A. on", "B. at", "C. in", "D. to"],
            correct: 2, // C
            trans: "B·ªë t√¥i ƒëang l√†m vi·ªác trong v∆∞·ªùn.",
            vocab: [
                "A. on: tr√™n.",
                "B. at: t·∫°i.",
                "C. in: trong.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "V∆∞·ªùn (garden) ƒë∆∞·ª£c xem l√† m·ªôt kh√¥ng gian c√≥ bao quanh -> D√πng 'IN'.",
            whyWrong: "'On' d√πng cho b·ªÅ m·∫∑t, 'At' d√πng cho ƒëi·ªÉm."
        },
        {
            q: "The shop is ______ the left of the bank.",
            options: ["A. in", "B. at", "C. on", "D. by"],
            correct: 2, // C
            trans: "C·ª≠a h√†ng n·∫±m ·ªü b√™n tr√°i ng√¢n h√†ng.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n.",
                "D. by: b·ªüi."
            ],
            whyRight: "C·ª•m ch·ªâ ph∆∞∆°ng h∆∞·ªõng: 'On the left', 'On the right'.",
            whyWrong: "Kh√¥ng d√πng 'in the left' hay 'at the left'."
        },
        
        // --- MIXED & ADVANCED ---
        {
            q: "I saw her ______ the bus stop.",
            options: ["A. in", "B. on", "C. at", "D. to"],
            correct: 2, // C
            trans: "T√¥i nh√¨n th·∫•y c√¥ ·∫•y t·∫°i tr·∫°m xe bu√Ωt.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Bus stop l√† m·ªôt ƒëi·ªÉm d·ª´ng c·ª• th·ªÉ -> D√πng 'AT'.",
            whyWrong: "Kh√¥ng ai ·ªü 'trong' (in) tr·∫°m xe bu√Ωt, v√† 'on' d√πng cho b·ªÅ m·∫∑t."
        },
        {
            q: "Are you free ______ Sunday morning?",
            options: ["A. in", "B. at", "C. on", "D. for"],
            correct: 2, // C
            trans: "B·∫°n c√≥ r·∫£nh v√†o s√°ng Ch·ªß nh·∫≠t kh√¥ng?",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: v√†o.",
                "D. for: cho."
            ],
            whyRight: "M·∫∑c d√π c√≥ 'morning' (th∆∞·ªùng d√πng in), nh∆∞ng v√¨ c√≥ th·ª© 'Sunday' ƒë·ª©ng tr∆∞·ªõc, n√™n ∆∞u ti√™n d√πng 'ON'. (On + Th·ª© + Bu·ªïi).",
            whyWrong: "Ch·ªâ d√πng 'In the morning' khi kh√¥ng c√≥ th·ª© ƒëi k√®m."
        },
        {
            q: "He is sitting ______ the back of the class.",
            options: ["A. in", "B. on", "C. at", "D. to"],
            correct: 2, // C
            trans: "C·∫≠u ·∫•y ƒëang ng·ªìi ·ªü cu·ªëi l·ªõp.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "C·ª•m t·ª´: 'At the back of...' (·ªü ph√≠a sau/cu·ªëi c·ªßa c√°i g√¨ ƒë√≥).",
            whyWrong: "'In the back' th∆∞·ªùng d√πng trong vƒÉn c·∫£nh kh√°c (v√≠ d·ª•: xe h∆°i). Trong l·ªõp h·ªçc d√πng 'At the back'."
        },
        {
            q: "We are flying ______ Phu Quoc tomorrow.",
            options: ["A. in", "B. on", "C. at", "D. to"],
            correct: 3, // D
            trans: "Ch√∫ng t√¥i s·∫Ω bay ƒë·∫øn Ph√∫ Qu·ªëc ng√†y mai.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Fly (bay) l√† ƒë·ªông t·ª´ ch·ªâ s·ª± di chuy·ªÉn (motion) -> D√πng 'TO' ch·ªâ ƒëi·ªÉm ƒë·∫øn.",
            whyWrong: "'In/At' ch·ªâ v·ªã tr√≠ ƒë·ª©ng y√™n, kh√¥ng d√πng v·ªõi ƒë·ªông t·ª´ di chuy·ªÉn h∆∞·ªõng ƒë·∫øn ƒë√¢u."
        },
        {
            q: "Put the toys ______ the box, please.",
            options: ["A. at", "B. on", "C. in", "D. of"],
            correct: 2, // C
            trans: "L√†m ∆°n h√£y b·ªè ƒë·ªì ch∆°i v√†o trong h·ªôp.",
            vocab: [
                "A. at: t·∫°i.",
                "B. on: tr√™n.",
                "C. in: trong.",
                "D. of: c·ªßa."
            ],
            whyRight: "C√°i h·ªôp (box) l√† v·∫≠t ch·ª©a, kh√¥ng gian k√≠n -> D√πng 'IN'.",
            whyWrong: "On l√† ƒë·ªÉ l√™n n·∫Øp h·ªôp, In l√† b·ªè v√†o l√≤ng h·ªôp."
        },
        {
            q: "I woke up ______ midnight.",
            options: ["A. in", "B. on", "C. at", "D. to"],
            correct: 2, // C
            trans: "T√¥i ƒë√£ th·ª©c gi·∫•c v√†o l√∫c n·ª≠a ƒë√™m.",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Midnight (n·ª≠a ƒë√™m), Noon (gi·ªØa tr∆∞a), Night (ƒë√™m) lu√¥n ƒëi v·ªõi gi·ªõi t·ª´ 'AT'.",
            whyWrong: "Kh√¥ng d√πng 'in midnight'."
        },
        {
            q: "See you ______ tomorrow afternoon!",
            options: ["A. in", "B. on", "C. at", "D. (No Preposition)"],
            correct: 3, // D
            trans: "G·∫∑p b·∫°n v√†o chi·ªÅu mai nh√©!",
            vocab: [
                "A. in: trong.",
                "B. on: tr√™n.",
                "C. at: t·∫°i.",
                "D. Kh√¥ng ƒëi·ªÅn gi·ªõi t·ª´."
            ],
            whyRight: "Tr∆∞·ªõc c√°c t·ª´ ch·ªâ th·ªùi gian c√≥ 'tomorrow, yesterday, today, next, last, this', ta KH√îNG d√πng gi·ªõi t·ª´ in/on/at.",
            whyWrong: "Ng∆∞·ªùi Vi·ªát hay nh·∫ßm l√† 'in tomorrow', nh∆∞ng ti·∫øng Anh kh√¥ng d√πng v·∫≠y."
        },
        {
            q: "There is a spider ______ the ceiling.",
            options: ["A. in", "B. at", "C. on", "D. above"],
            correct: 2, // C
            trans: "C√≥ m·ªôt con nh·ªán ·ªü tr√™n tr·∫ßn nh√†.",
            vocab: [
                "A. in: trong.",
                "B. at: t·∫°i.",
                "C. on: tr√™n b·ªÅ m·∫∑t.",
                "D. above: ph√≠a tr√™n."
            ],
            whyRight: "Tr·∫ßn nh√† (ceiling) l√† b·ªÅ m·∫∑t ph·∫≥ng. D√π l·ªôn ng∆∞·ª£c th√¨ nh·ªán v·∫´n b√°m 'tr√™n b·ªÅ m·∫∑t' -> D√πng 'ON'.",
            whyWrong: "'In' l√† chui v√†o trong tr·∫ßn nh√†."
        },
        {
            q: "My office is ______ the 3rd floor.",
            options: ["A. at", "B. in", "C. on", "D. under"],
            correct: 2, // C
            trans: "VƒÉn ph√≤ng c·ªßa t√¥i ·ªü t·∫ßng 3.",
            vocab: [
                "A. at: t·∫°i.",
                "B. in: trong.",
                "C. on: tr√™n.",
                "D. under: d∆∞·ªõi."
            ],
            whyRight: "S·ªë t·∫ßng c·ªßa t√≤a nh√† (1st floor, 2nd floor...) lu√¥n d√πng gi·ªõi t·ª´ 'ON'.",
            whyWrong: "Kh√¥ng d√πng 'at/in' cho s·ªë t·∫ßng."
        },
        {
            q: "Japan is ______ Asia.",
            options: ["A. on", "B. at", "C. in", "D. to"],
            correct: 2, // C
            trans: "Nh·∫≠t B·∫£n n·∫±m ·ªü Ch√¢u √Å.",
            vocab: [
                "A. on: tr√™n.",
                "B. at: t·∫°i.",
                "C. in: trong.",
                "D. to: ƒë·∫øn."
            ],
            whyRight: "Ch√¢u l·ª•c (Asia, Europe, Africa...) l√† khu v·ª±c ƒë·ªãa l√Ω l·ªõn -> D√πng 'IN'.",
            whyWrong: "On d√πng cho ƒë·∫£o, At d√πng cho ƒëi·ªÉm nh·ªè."
        }
    ];

    // --- LOGIC ---
    let shuffledQuestions = [];
    let score = 0;
    
    // Audio Context for Generating Sounds (No external files needed)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High pitch, decays)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            // Wrong sound (Low pitch, wobble)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Confetti Logic
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let confetti = [];

    function fireConfetti() {
        for (let i = 0; i < 100; i++) {
            confetti.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 10 + 5,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 2 - 1
            });
        }
    }

    function updateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach((p, index) => {
            p.y += p.speedY;
            p.x += p.speedX;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if (p.y > canvas.height) confetti.splice(index, 1);
        });
        requestAnimationFrame(updateConfetti);
    }
    updateConfetti();

    // Shuffle Array
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    // Init Quiz
    function initQuiz() {
        const container = document.getElementById('quiz-container');
        shuffledQuestions = shuffle([...questionsData]); // Shuffle questions
        // Limit to 30 just in case data grows, but here fits exactly
        
        shuffledQuestions.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.id = `q-${index}`;

            let optionsHtml = '';
            item.options.forEach((opt, optIndex) => {
                optionsHtml += `<button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, this)">${opt}</button>`;
            });

            // Vocab List HTML
            let vocabList = item.vocab.map(v => `<li>${v}</li>`).join('');

            card.innerHTML = `
                <span class="question-number">Question ${index + 1}</span>
                <div class="question-text">${item.q}</div>
                <div class="options-grid">
                    ${optionsHtml}
                </div>
                <div class="explanation" id="exp-${index}">
                    <div class="exp-header">üí° GI·∫¢I TH√çCH CHI TI·∫æT (C√¥ Mai An)</div>
                    <div class="exp-content">
                        <p><span class="exp-label">D·ªãch c√¢u:</span> ${item.trans}</p>
                        <p><span class="exp-label">Ph√¢n t√≠ch t·ª´ v·ª±ng:</span></p>
                        <ul style="margin: 5px 0 10px 20px; padding: 0; color: #555;">${vocabList}</ul>
                        <p><span class="exp-label" style="color:var(--correct)">T·∫°i sao ƒê√öNG:</span> ${item.whyRight}</p>
                        <p><span class="exp-label" style="color:var(--wrong)">T·∫°i sao SAI:</span> ${item.whyWrong}</p>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function checkAnswer(qIndex, choiceIndex, btnElement) {
        const question = shuffledQuestions[qIndex];
        const card = document.getElementById(`q-${qIndex}`);
        const allBtns = card.querySelectorAll('.option-btn');
        const expBox = document.getElementById(`exp-${qIndex}`);

        // Disable all buttons to prevent re-clicking
        allBtns.forEach(btn => btn.classList.add('disabled'));

        if (choiceIndex === question.correct) {
            // Correct
            btnElement.classList.add('correct');
            playSound('correct');
            fireConfetti();
            score++;
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            playSound('wrong');
            // Highlight correct answer
            allBtns[question.correct].classList.add('correct');
        }

        // Show explanation
        expBox.style.display = 'block';
    }

    function finishQuiz() {
        const modal = document.getElementById('resultModal');
        const scoreText = document.getElementById('finalScore');
        const feedback = document.getElementById('feedbackText');
        
        scoreText.innerText = `${score} / ${shuffledQuestions.length}`;
        
        const percentage = (score / shuffledQuestions.length) * 100;
        if (percentage === 100) feedback.innerText = "Tuy·ªát ƒë·ªëi! B·∫°n l√† si√™u cao th·ªß! üèÜ";
        else if (percentage >= 80) feedback.innerText = "Gi·ªèi l·∫Øm! Ki·∫øn th·ª©c r·∫•t v·ªØng! üåü";
        else if (percentage >= 50) feedback.innerText = "Kh√° t·ªët! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
        else feedback.innerText = "ƒê·ª´ng bu·ªìn, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üìö";

        modal.style.display = 'flex';
        playSound('correct'); // Victory sound
        fireConfetti();
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
    }

    // Run on load
    window.onload = initQuiz;

</script>

</body>
</html>