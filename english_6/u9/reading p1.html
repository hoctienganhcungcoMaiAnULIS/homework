<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Test - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 1.5px, transparent 1.5px), radial-gradient(#00c9a7 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin-bottom: 50px;
        }

        /* HEADER */
        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-teal));
            padding: 20px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        .header p {
            margin: 5px 0 0 0;
            font-size: 1rem;
            opacity: 0.9;
        }

        /* CARD STYLE */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.15);
            border: 2px solid #eef2f5;
            position: relative;
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--primary-pink);
            font-weight: 800;
            margin-bottom: 20px;
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
        }

        /* READING BOX */
        .reading-box {
            background-color: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #444;
        }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            border: 2px solid var(--primary-teal);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .glossary-table th {
            background-color: var(--primary-teal);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            background-color: #fdfdfd;
        }
        
        .glossary-table tr:last-child td {
            border-bottom: none;
        }

        /* OPTIONS BOX (FOR GAP FILL) */
        .options-box {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            background: #fff0f6;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid var(--primary-pink);
            margin-bottom: 20px;
        }

        .option-chip {
            background: white;
            border: 2px solid var(--primary-pink);
            color: var(--primary-pink);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: default;
        }

        /* QUESTIONS INTERFACE */
        .question-group {
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }

        .gap-input {
            display: inline-block;
            min-width: 120px;
            padding: 5px 10px;
            margin: 0 5px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background: white;
            color: #333;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .gap-input:hover {
            border-color: var(--primary-pink);
            transform: scale(1.05);
        }

        .gap-input.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: var(--correct-green);
        }

        .gap-input.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: var(--wrong-red);
            animation: shake 0.5s;
        }

        /* DROPDOWN POPUP */
        .popup-options {
            display: none;
            position: absolute;
            z-index: 100;
            background: white;
            border: 2px solid var(--primary-pink);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px;
            min-width: 200px;
        }
        
        .popup-option-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: background 0.2s;
            font-weight: 600;
        }

        .popup-option-item:hover {
            background-color: #f0f4f8;
            color: var(--primary-pink);
        }

        /* TRUE/FALSE BUTTONS */
        .tf-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .btn-tf {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 rgba(0,0,0,0.1);
            color: white;
        }

        .btn-true { background-color: #48dbfb; }
        .btn-false { background-color: #ff9ff3; }

        .btn-tf:active { transform: translateY(4px); box-shadow: none; }
        .btn-tf.selected-correct { background-color: var(--correct-green) !important; box-shadow: 0 5px 0 #00b85c !important; }
        .btn-tf.selected-wrong { background-color: var(--wrong-red) !important; animation: shake 0.5s; box-shadow: 0 5px 0 #e6404f !important; }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 15px;
            background-color: #e8fbf4;
            border-left: 5px solid var(--primary-teal);
            padding: 15px;
            border-radius: 8px;
            animation: slideDown 0.3s ease-out;
        }

        .expl-title {
            font-weight: 800;
            color: var(--primary-teal);
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .expl-title::before {
            content: "üí°";
            margin-right: 8px;
        }

        .expl-content p { margin: 5px 0; font-size: 0.95rem; }
        .expl-label { font-weight: bold; color: #555; text-decoration: underline; }
        .expl-correct { color: var(--correct-green); font-weight: bold; }
        .expl-wrong { color: var(--wrong-red); }

        /* SUBMIT BUTTON */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }
        
        .btn-submit {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #6c429c;
            transition: all 0.2s;
        }

        .btn-submit:hover { transform: scale(1.05); }
        .btn-submit:active { transform: translateY(4px); box-shadow: 0 4px 0 #6c429c; }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CANVAS FOR CONFETTI */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 9999;
        }
        
        /* Popup Result */
        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 10000;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary-pink);
        }
        
        .result-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .result-score {
            font-size: 3rem;
            color: var(--primary-pink);
            font-weight: 800;
        }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <div class="header">
        <h1>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</h1>
        <p>H·ªçc vui - Hi·ªÉu s√¢u - Nh·ªõ l√¢u</p>
    </div>

    <div class="card">
        <div class="card-title">IX. Complete the conversation (ƒêi·ªÅn c√¢u v√†o h·ªôi tho·∫°i)</div>
        <div class="options-box">
            <div class="option-chip">A. What did you do yesterday?</div>
            <div class="option-chip">B. What did you eat?</div>
            <div class="option-chip">C. Did you visit any famous places?</div>
            <div class="option-chip">D. Are you having a good time?</div>
            <div class="option-chip">E. Did you have fun?</div>
        </div>

        <div class="reading-box">
            <strong>Phong:</strong> Hi, Mum!<br>
            <strong>Mum:</strong> Hi, Phong. (1) <div class="gap-input" onclick="showOptions(this, 'q1', ['A', 'B', 'C', 'D', 'E'])">?</div><br>
            <strong>Phong:</strong> Yes, we are. Singapore is such an amazing city!<br>
            <div id="expl-q1" class="explanation-box"></div>

            <strong>Mum:</strong> (2) <div class="gap-input" onclick="showOptions(this, 'q2', ['A', 'B', 'C', 'D', 'E'])">?</div><br>
            <strong>Phong:</strong> My friends and I went around the city and did some shopping.<br>
            <div id="expl-q2" class="explanation-box"></div>

            <strong>Mum:</strong> (3) <div class="gap-input" onclick="showOptions(this, 'q3', ['A', 'B', 'C', 'D', 'E'])">?</div><br>
            <strong>Phong:</strong> Yes, we visited Merlion - a famous landmark here. Then, we went to Disneyland.<br>
            <div id="expl-q3" class="explanation-box"></div>

            <strong>Mum:</strong> (4) <div class="gap-input" onclick="showOptions(this, 'q4', ['A', 'B', 'C', 'D', 'E'])">?</div><br>
            <strong>Phong:</strong> Absolutely. There were a lot of exciting and fun games. We spent the whole afternoon playing.<br>
            <div id="expl-q4" class="explanation-box"></div>

            <strong>Mum:</strong> (5) <div class="gap-input" onclick="showOptions(this, 'q5', ['A', 'B', 'C', 'D', 'E'])">?</div><br>
            <strong>Phong:</strong> We enjoyed the best local dishes such as Hainanese chicken and chili crab.<br>
            <div id="expl-q5" class="explanation-box"></div>

            <strong>Mum:</strong> Enjoy your time there!<br>
            <strong>Phong:</strong> Thanks, Mum.
        </div>
    </div>

    <div class="card">
        <div class="card-title">I. Read about Seoul and decide True (T) or False (F)</div>
        <div class="reading-box">
            Seoul is the capital and lies in the northern part of South Korea. It has a population of nearly 10 million people. Seoul is famous for modern skyscrapers and high-tech subways. There are also many temples, palaces and street markets. Popular tourist attractions in Seoul are Dongdaemun Design Plaza, Gyeongbokgung Palace, The War Memorial of Korea and Namsan Seoul Tower. Gangnam, Itaewon and Hongdae are popular neighbourhoods in Seoul. Here you can find busy downtown districts, exciting social life, crowded shopping centres and great restaurants. You can also try tasty Korean dishes like bibimbap, kimchi and BBQ grilled meat. Exploring this massive city can be an enjoyable experience for travellers.
        </div>
        
        <h3>üìö Glossary (T·ª´ v·ª±ng x·ªãn x√≤)</h3>
        <table class="glossary-table">
            <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            <tr><td>Skyscraper</td><td>(n)</td><td>Nh√† ch·ªçc tr·ªùi</td></tr>
            <tr><td>High-tech</td><td>(adj)</td><td>C√¥ng ngh·ªá cao</td></tr>
            <tr><td>Attraction</td><td>(n)</td><td>ƒêi·ªÉm thu h√∫t du l·ªãch</td></tr>
            <tr><td>Neighbourhood</td><td>(n)</td><td>Khu v·ª±c l√¢n c·∫≠n/Khu ph·ªë</td></tr>
            <tr><td>Downtown</td><td>(adj/n)</td><td>Trung t√¢m th√†nh ph·ªë</td></tr>
            <tr><td>District</td><td>(n)</td><td>Qu·∫≠n/Huy·ªán</td></tr>
            <tr><td>Massive</td><td>(adj)</td><td>To l·ªõn, ƒë·ªì s·ªô</td></tr>
        </table>

        <div class="question-group">
            <p><strong>1. Seoul is in the northern west of South Korea.</strong></p>
            <div class="tf-container">
                <button class="btn-tf btn-true" onclick="checkTF(this, 'q6', true)">TRUE</button>
                <button class="btn-tf btn-false" onclick="checkTF(this, 'q6', false)">FALSE</button>
            </div>
            <div id="expl-q6" class="explanation-box"></div>
        </div>

        <div class="question-group">
            <p><strong>2. Modern tall buildings and subway systems make Seoul famous.</strong></p>
            <div class="tf-container">
                <button class="btn-tf btn-true" onclick="checkTF(this, 'q7', true)">TRUE</button>
                <button class="btn-tf btn-false" onclick="checkTF(this, 'q7', false)">FALSE</button>
            </div>
            <div id="expl-q7" class="explanation-box"></div>
        </div>

        <div class="question-group">
            <p><strong>3. Itaewon and Gangnam are two popular areas outside Seoul.</strong></p>
            <div class="tf-container">
                <button class="btn-tf btn-true" onclick="checkTF(this, 'q8', true)">TRUE</button>
                <button class="btn-tf btn-false" onclick="checkTF(this, 'q8', false)">FALSE</button>
            </div>
            <div id="expl-q8" class="explanation-box"></div>
        </div>

        <div class="question-group">
            <p><strong>4. There are a lot of things to do in Seoul.</strong></p>
            <div class="tf-container">
                <button class="btn-tf btn-true" onclick="checkTF(this, 'q9', true)">TRUE</button>
                <button class="btn-tf btn-false" onclick="checkTF(this, 'q9', false)">FALSE</button>
            </div>
            <div id="expl-q9" class="explanation-box"></div>
        </div>

        <div class="question-group">
            <p><strong>5. You should try bibimbap and kimchi.</strong></p>
            <div class="tf-container">
                <button class="btn-tf btn-true" onclick="checkTF(this, 'q10', true)">TRUE</button>
                <button class="btn-tf btn-false" onclick="checkTF(this, 'q10', false)">FALSE</button>
            </div>
            <div id="expl-q10" class="explanation-box"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">II. Read and complete (ƒêi·ªÅn t·ª´ v√†o ch·ªó tr·ªëng)</div>
        <div class="options-box">
            <div class="option-chip">windy</div>
            <div class="option-chip">excited</div>
            <div class="option-chip">tourist</div>
            <div class="option-chip">delicious</div>
            <div class="option-chip">crowded</div>
            <div class="option-chip">friendly</div>
        </div>

        <div class="reading-box">
            We arrived in Sapa at 9:00 yesterday morning and stayed in a nice hotel in the town centre. It is close to many (1) <div class="gap-input" onclick="showOptions(this, 'q11', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div> attractions.<br>
            <div id="expl-q11" class="explanation-box"></div>

            Sapa is a lovely and (2) <div class="gap-input" onclick="showOptions(this, 'q12', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div> town.<br>
            <div id="expl-q12" class="explanation-box"></div>

            Yesterday, we took a bus to Muong Hoa Station. There are many kinds of beautiful flowers there. I took many photos with my parents and my sister. We also went to Mount Fansipan. The weather was a bit cold and (3) <div class="gap-input" onclick="showOptions(this, 'q13', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div>.<br>
            <div id="expl-q13" class="explanation-box"></div>

            The surrounding was like a beautiful sea of clouds and we all felt (4) <div class="gap-input" onclick="showOptions(this, 'q14', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div>.<br>
            <div id="expl-q14" class="explanation-box"></div>
            
            In the evening, we went to the town market and enjoyed a lot of (5) <div class="gap-input" onclick="showOptions(this, 'q15', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div> local food.<br>
            <div id="expl-q15" class="explanation-box"></div>
            
            Ethnic people in Sapa are really (6) <div class="gap-input" onclick="showOptions(this, 'q16', ['windy','excited','tourist','delicious','crowded','friendly'])">...</div> and helpful.<br>
            <div id="expl-q16" class="explanation-box"></div>
        </div>

        <h3>üìö Glossary (T·ª´ v·ª±ng x·ªãn x√≤)</h3>
        <table class="glossary-table">
            <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            <tr><td>Attraction</td><td>(n)</td><td>ƒêi·ªÉm tham quan</td></tr>
            <tr><td>Surrounding</td><td>(n)</td><td>Khung c·∫£nh xung quanh</td></tr>
            <tr><td>Sea of clouds</td><td>(phrase)</td><td>Bi·ªÉn m√¢y</td></tr>
            <tr><td>Ethnic</td><td>(adj)</td><td>Thu·ªôc d√¢n t·ªôc</td></tr>
            <tr><td>Helpful</td><td>(adj)</td><td>Hay gi√∫p ƒë·ª° ng∆∞·ªùi kh√°c</td></tr>
            <tr><td>Local</td><td>(adj)</td><td>ƒê·ªãa ph∆∞∆°ng</td></tr>
        </table>
    </div>

    <div class="submit-section">
        <button class="btn-submit" onclick="submitTest()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
    </div>

</div>

<div id="dropdown-popup" class="popup-options"></div>

<div id="result-popup" class="result-popup">
    <h2>K·∫æT QU·∫¢ C·ª¶A CON</h2>
    <div class="result-score" id="final-score">0/16</div>
    <p id="result-message" style="font-size: 1.2rem; margin-top: 10px;"></p>
    <button class="btn-submit" style="font-size: 1rem; padding: 10px 20px;" onclick="closeResult()">Xem l·∫°i b√†i l√†m</button>
</div>

<script>
    // SOUND EFFECTS (Base64 short sounds)
    const audioCorrect = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3'); // Ding
    const audioWrong = new Audio('https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3'); // Buzz

    // DATA FOR EXPLANATIONS
    const explanations = {
        // Part IX
        q1: {
            correct: 'D',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> "Con c√≥ ƒëang vui v·∫ª kh√¥ng?"</p>
                <p><strong>T·∫°i sao ch·ªçn D?</strong> Phong tr·∫£ l·ªùi: "Yes, we are" (V√¢ng, ch√∫ng con c√≥). ƒê√¢y l√† c√¢u tr·∫£ l·ªùi cho c√¢u h·ªèi Yes/No ·ªü th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn (Present Continuous) v·ªõi ch·ªß ng·ªØ "you" -> C√¢u h·ªèi ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng "Are you...?".</p>
                <p><strong>C√°c c√¢u kh√°c sai:</strong>
                <br>A: H·ªèi qu√° kh·ª© (did).
                <br>B: H·ªèi ƒÉn g√¨.
                <br>C: H·ªèi qu√° kh·ª© (did).</p>
            </div>`
        },
        q2: {
            correct: 'A',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> "H√¥m qua c√°c con ƒë√£ l√†m g√¨?"</p>
                <p><strong>T·∫°i sao ch·ªçn A?</strong> Phong k·ªÉ: "went around... did some shopping" (ƒë√£ ƒëi d·∫°o... ƒë√£ mua s·∫Øm). ƒê√¢y l√† c√°c h√†nh ƒë·ªông trong qu√° kh·ª© -> M·∫π ph·∫£i h·ªèi "What did you do..."</p>
            </div>`
        },
        q3: {
            correct: 'C',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> "Con c√≥ ƒëi thƒÉm ƒë·ªãa danh n·ªïi ti·∫øng n√†o kh√¥ng?"</p>
                <p><strong>T·∫°i sao ch·ªçn C?</strong> Phong tr·∫£ l·ªùi: "Yes, we visited Merlion" (C√≥, ch√∫ng con ƒë√£ thƒÉm t∆∞·ª£ng S∆∞ t·ª≠ bi·ªÉn). C√¢u tr·∫£ l·ªùi Yes/No ·ªü qu√° kh·ª© -> C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng "Did you...?"</p>
            </div>`
        },
        q4: {
            correct: 'E',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> "Con c√≥ vui kh√¥ng?"</p>
                <p><strong>T·∫°i sao ch·ªçn E?</strong> Phong tr·∫£ l·ªùi: "Absolutely" (Ch·∫Øc ch·∫Øn r·ªìi) v√† k·ªÉ v·ªÅ tr√≤ ch∆°i vui nh·ªôn -> M·∫π h·ªèi v·ªÅ c·∫£m x√∫c (fun).</p>
            </div>`
        },
        q5: {
            correct: 'B',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> "Con ƒë√£ ƒÉn g√¨ th·∫ø?"</p>
                <p><strong>T·∫°i sao ch·ªçn B?</strong> Phong k·ªÉ v·ªÅ m√≥n ƒÉn: "Hainanese chicken and chili crab" -> M·∫π h·ªèi v·ªÅ ƒë·ªì ƒÉn (eat).</p>
            </div>`
        },
        // Part I (True/False)
        q6: {
            correct: false,
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>C√¢u h·ªèi:</strong> Seoul n·∫±m ·ªü ph√≠a T√¢y B·∫Øc c·ªßa H√†n Qu·ªëc.</p>
                <p><span class="expl-correct">T·∫°i sao FALSE?</span> B√†i ƒë·ªçc ghi: "lies in the <u>northern part</u> of South Korea" (n·∫±m ·ªü ph√≠a B·∫Øc), kh√¥ng ph·∫£i T√¢y B·∫Øc (northern west).</p>
            </div>`
        },
        q7: {
            correct: true,
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>C√¢u h·ªèi:</strong> Nh·ªØng t√≤a nh√† cao t·∫ßng hi·ªán ƒë·∫°i v√† h·ªá th·ªëng t√†u ƒëi·ªán ng·∫ßm l√†m Seoul n·ªïi ti·∫øng.</p>
                <p><span class="expl-correct">T·∫°i sao TRUE?</span> D·∫´n ch·ª©ng: "Seoul is famous for modern skyscrapers and high-tech subways."</p>
            </div>`
        },
        q8: {
            correct: false,
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>C√¢u h·ªèi:</strong> Itaewon v√† Gangnam l√† hai khu v·ª±c n·ªïi ti·∫øng b√™n ngo√†i Seoul.</p>
                <p><span class="expl-correct">T·∫°i sao FALSE?</span> B√†i ƒë·ªçc ghi: "...are popular neighbourhoods <u>in Seoul</u>" (·ªû TRONG Seoul), kh√¥ng ph·∫£i b√™n ngo√†i (outside).</p>
            </div>`
        },
        q9: {
            correct: true,
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>C√¢u h·ªèi:</strong> C√≥ r·∫•t nhi·ªÅu vi·ªác ƒë·ªÉ l√†m ·ªü Seoul.</p>
                <p><span class="expl-correct">T·∫°i sao TRUE?</span> B√†i ƒë·ªçc li·ªát k√™ r·∫•t nhi·ªÅu ho·∫°t ƒë·ªông: social life (ƒë·ªùi s·ªëng x√£ h·ªôi), shopping (mua s·∫Øm), great restaurants (nh√† h√†ng), try tasty dishes (th·ª≠ m√≥n ƒÉn ngon)...</p>
            </div>`
        },
        q10: {
            correct: true,
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>C√¢u h·ªèi:</strong> B·∫°n n√™n th·ª≠ m√≥n c∆°m tr·ªôn (bibimbap) v√† kim chi.</p>
                <p><span class="expl-correct">T·∫°i sao TRUE?</span> D·∫´n ch·ª©ng: "You can also try tasty Korean dishes like bibimbap, kimchi..."</p>
            </div>`
        },
        // Part II (Gap Fill Sapa)
        q11: {
            correct: 'tourist',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> tourist (kh√°ch du l·ªãch)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> C·ª•m t·ª´ c·ªë ƒë·ªãnh (Collocation): <strong>"tourist attractions"</strong> (c√°c ƒëi·ªÉm thu h√∫t kh√°ch du l·ªãch).</p>
                <p><strong>D·ªãch:</strong> N√≥ g·∫ßn nhi·ªÅu ƒëi·ªÉm tham quan du l·ªãch.</p>
            </div>`
        },
        q12: {
            correct: 'crowded',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> crowded (ƒë√¥ng ƒë√∫c)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> ƒê√¢y l√† t√≠nh t·ª´ mi√™u t·∫£ th·ªã tr·∫•n. M·∫∑c d√π Sapa ƒë·∫πp (lovely), nh∆∞ng n√≥ c≈©ng l√† m·ªôt ƒëi·ªÉm du l·ªãch n·ªïi ti·∫øng n√™n r·∫•t "ƒë√¥ng ƒë√∫c". (Lo·∫°i c√°c t·ª´ kh√°c nh∆∞ 'delicious' - ngon, 'excited' - h√†o h·ª©ng ch·ªâ d√πng cho ng∆∞·ªùi).</p>
                <p><strong>D·ªãch:</strong> Sapa l√† m·ªôt th·ªã tr·∫•n d·ªÖ th∆∞∆°ng v√† ƒë√¥ng ƒë√∫c.</p>
            </div>`
        },
        q13: {
            correct: 'windy',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> windy (c√≥ gi√≥)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> "The weather" (th·ªùi ti·∫øt) th√¨ ph·∫£i ƒëi v·ªõi t√≠nh t·ª´ ch·ªâ th·ªùi ti·∫øt. Trong danh s√°ch ch·ªâ c√≥ "windy" l√† ph√π h·ª£p nh·∫•t b√™n c·∫°nh "cold".</p>
                <p><strong>D·ªãch:</strong> Th·ªùi ti·∫øt h∆°i l·∫°nh v√† c√≥ gi√≥.</p>
            </div>`
        },
        q14: {
            correct: 'excited',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> excited (h√†o h·ª©ng)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> C·∫•u tr√∫c "felt + adj" (c·∫£m th·∫•y...). Ch·ªß ng·ªØ l√† "we" (ng∆∞·ªùi) n√™n d√πng t√≠nh t·ª´ ƒëu√¥i -ed ƒë·ªÉ ch·ªâ c·∫£m x√∫c.</p>
                <p><strong>D·ªãch:</strong> Ch√∫ng t√¥i ƒë·ªÅu c·∫£m th·∫•y h√†o h·ª©ng.</p>
            </div>`
        },
        q15: {
            correct: 'delicious',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> delicious (ngon)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> ƒê·ª©ng tr∆∞·ªõc danh t·ª´ "food" (ƒë·ªì ƒÉn) c·∫ßn m·ªôt t√≠nh t·ª´ mi√™u t·∫£ ƒë·ªì ƒÉn. "Delicious" l√† h·ª£p l√Ω nh·∫•t.</p>
                <p><strong>D·ªãch:</strong> Th∆∞·ªüng th·ª©c nhi·ªÅu m√≥n ƒÉn ƒë·ªãa ph∆∞∆°ng ngon tuy·ªát.</p>
            </div>`
        },
        q16: {
            correct: 'friendly',
            html: `
            <div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> friendly (th√¢n thi·ªán)</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> Mi√™u t·∫£ con ng∆∞·ªùi (Ethnic people). ƒêi k√®m v·ªõi "helpful" (hay gi√∫p ƒë·ª°) th√¨ "friendly" l√† c·∫∑p b√†i tr√πng ho√†n h·∫£o.</p>
                <p><strong>D·ªãch:</strong> Ng∆∞·ªùi d√¢n t·ªôc ·ªü Sapa r·∫•t th√¢n thi·ªán v√† hay gi√∫p ƒë·ª°.</p>
            </div>`
        }
    };

    let userScore = 0;
    let answeredCount = 0;
    const totalQuestions = 16;
    let activeInput = null;

    // --- GAP FILL LOGIC ---
    function showOptions(element, qId, options) {
        if (element.classList.contains('correct')) return; // Prevent changing if already correct

        activeInput = element;
        const popup = document.getElementById('dropdown-popup');
        popup.innerHTML = '';
        
        options.forEach(opt => {
            const div = document.createElement('div');
            div.className = 'popup-option-item';
            div.innerText = opt;
            div.onclick = function() {
                selectOption(element, qId, opt);
                popup.style.display = 'none';
            };
            popup.appendChild(div);
        });

        // Position popup
        const rect = element.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        popup.style.top = (rect.bottom + scrollTop + 5) + 'px';
        popup.style.left = rect.left + 'px';
        popup.style.display = 'block';
    }

    function selectOption(element, qId, value) {
        element.innerText = value;
        const correctAnswer = explanations[qId].correct;
        const explDiv = document.getElementById('expl-' + qId);

        // Check correct/wrong immediately
        if (value === correctAnswer) {
            element.className = 'gap-input correct';
            audioCorrect.play();
            triggerConfettiSimple();
        } else {
            element.className = 'gap-input wrong';
            audioWrong.play();
            // Remove wrong class after animation to allow retry
            setTimeout(() => {
                element.classList.remove('wrong');
            }, 1000);
        }

        // Always show explanation
        explDiv.innerHTML = explanations[qId].html;
        explDiv.style.display = 'block';
    }

    // --- TRUE/FALSE LOGIC ---
    function checkTF(btn, qId, userChoice) {
        const parent = btn.parentElement;
        // Disable buttons after selection to prevent spamming score (optional, but good for logic)
        // For this interaction model, we allow changing but only "first try" counts or just visual feedback.
        // Let's go with: Visual feedback immediately.

        const correctAnswer = explanations[qId].correct;
        const explDiv = document.getElementById('expl-' + qId);

        // Reset styles first
        parent.querySelectorAll('.btn-tf').forEach(b => {
            b.classList.remove('selected-correct', 'selected-wrong');
        });

        if (userChoice === correctAnswer) {
            btn.classList.add('selected-correct');
            audioCorrect.play();
            triggerConfettiSimple();
        } else {
            btn.classList.add('selected-wrong');
            audioWrong.play();
        }

        // Show Explanation
        explDiv.innerHTML = explanations[qId].html;
        explDiv.style.display = 'block';
    }

    // --- SUBMIT LOGIC ---
    function submitTest() {
        // Count score based on current UI state
        let score = 0;
        
        // Count gap fills
        document.querySelectorAll('.gap-input').forEach(input => {
            if (input.classList.contains('correct')) score++;
        });

        // Count T/F
        document.querySelectorAll('.tf-container').forEach(container => {
            if (container.querySelector('.selected-correct')) score++;
        });

        const popup = document.getElementById('result-popup');
        const scoreText = document.getElementById('final-score');
        const msgText = document.getElementById('result-message');
        
        scoreText.innerText = `${score}/${totalQuestions}`;
        
        if (score === totalQuestions) {
            msgText.innerText = "Wow! Con l√† thi√™n t√†i ngo·∫°i ng·ªØ! üåü Xu·∫•t s·∫Øc!";
            triggerConfetti();
        } else if (score >= totalQuestions * 0.7) {
            msgText.innerText = "Gi·ªèi l·∫Øm! Con l√†m r·∫•t t·ªët, ch·ªâ sai x√≠u xiu th√¥i! üí™";
        } else {
            msgText.innerText = "C·ªë l√™n nh√©! Con h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu b√†i h∆°n nha! ‚ù§";
        }

        popup.classList.add('show');
    }

    function closeResult() {
        document.getElementById('result-popup').classList.remove('show');
    }

    // --- SIMPLE CONFETTI ---
    // A simplified version of confetti logic
    function triggerConfettiSimple() {
        // Just a burst
        confetti({
            particleCount: 50,
            spread: 70,
            origin: { y: 0.6 }
        });
    }
    
    // Close popup if clicked outside
    window.onclick = function(event) {
        if (!event.target.matches('.gap-input')) {
            const dropdowns = document.getElementsByClassName("popup-options");
            for (let i = 0; i < dropdowns.length; i++) {
                let openDropdown = dropdowns[i];
                if (openDropdown.style.display === 'block') {
                    openDropdown.style.display = 'none';
                }
            }
        }
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</body>
</html>