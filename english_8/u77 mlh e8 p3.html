<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Ti·∫øng Anh 8 - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng ch·ªß ƒë·∫°o */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --accent: #FF9FF3; /* H·ªìng pastel */
            --bg: #F0F3F8;
            --correct: #00D26A;
            --wrong: #FF4757;
            --text: #2C3A47;
            --white: #ffffff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 120px; /* Ch·ª´a ch·ªó cho n√∫t n·ªôp b√†i */
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--white);
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.15);
            border-bottom: 6px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        h1 {
            color: var(--primary);
            font-size: 2.2rem;
            margin: 0;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sub-header {
            color: #888;
            font-size: 1rem;
            margin-top: 10px;
            font-weight: 700;
            display: inline-block;
            background: #eee;
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* SECTION STYLES */
        .section-title {
            background: var(--secondary);
            color: white;
            padding: 15px 30px;
            border-radius: 20px;
            margin-top: 50px;
            margin-bottom: 25px;
            display: inline-block;
            font-weight: 800;
            box-shadow: 0 6px 0 #00967D;
            font-size: 1.3rem;
            text-transform: uppercase;
        }

        /* QUESTION CARD */
        .q-card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .q-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        /* ƒê√°nh d·∫•u th·∫ª ƒë√£ l√†m ƒë√∫ng ƒë·ªÉ t√≠nh ƒëi·ªÉm */
        .q-card.user-correct {
            border-color: var(--correct);
            background-color: #f0fff4;
        }
        
        .q-card.user-correct::after {
            content: '‚úì';
            position: absolute;
            top: 15px; right: 15px;
            background: var(--correct);
            color: white;
            width: 30px; height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .q-number {
            font-weight: 900;
            color: var(--primary);
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .q-text {
            font-size: 1.15rem;
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* BUTTONS & INPUTS */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }

        .option-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 15px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            font-family: inherit;
            color: var(--text);
            text-align: left;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .option-btn:hover:not(:disabled) {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .option-btn.correct {
            background: var(--correct) !important;
            color: white !important;
            border-color: var(--correct) !important;
            box-shadow: 0 4px 0 #00a352;
        }

        .option-btn.wrong {
            background: var(--wrong) !important;
            color: white !important;
            border-color: var(--wrong) !important;
            animation: shake 0.4s;
            opacity: 0.8;
        }

        .q-input {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 8px 12px;
            font-family: inherit;
            font-size: 1.1rem;
            width: 160px;
            margin: 0 5px;
            transition: 0.3s;
            color: var(--primary);
            font-weight: 700;
            text-align: center;
        }

        .q-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(136, 84, 192, 0.1); }
        .q-input.correct { border-color: var(--correct); background-color: #e6fffa; color: var(--correct); }
        .q-input.wrong { border-color: var(--wrong); background-color: #ffeef0; color: var(--wrong); animation: shake 0.4s; }

        .prep-choice {
            display: inline-block; padding: 5px 12px; border-radius: 8px; cursor: pointer;
            font-weight: 800; color: var(--primary); border: 2px dashed var(--primary); margin: 0 4px; transition: 0.2s;
        }
        .prep-choice:hover { background: var(--accent); color: white; border-color: transparent; }
        .prep-choice.correct { background: var(--correct); color: white; border: 2px solid var(--correct); }
        .prep-choice.wrong { background: var(--wrong); color: white; border: 2px solid var(--wrong); }

        /* SCRAMBLE */
        .scramble-pool, .scramble-answer {
            min-height: 60px; padding: 15px; border-radius: 15px; display: flex; flex-wrap: wrap; gap: 10px;
        }
        .scramble-pool { background: #f1f3f5; margin-bottom: 15px; }
        .scramble-answer { border: 2px dashed var(--primary); background: #fff; }
        .word-chip {
            background: white; padding: 10px 20px; border-radius: 25px; border: 2px solid #e0e0e0;
            color: var(--text); font-weight: 700; cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.05); user-select: none;
        }
        .word-chip:hover { transform: translateY(-3px); border-color: var(--primary); color: var(--primary); }
        .scramble-answer .word-chip { background: var(--primary); color: white; border-color: var(--primary); box-shadow: none; }

        /* EXPLANATION */
        .action-row {
            display: flex; justify-content: flex-end; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px dashed #e0e0e0;
        }
        .check-btn {
            background: var(--secondary); color: white; border: none; padding: 12px 30px; border-radius: 30px;
            font-weight: 800; font-size: 1rem; cursor: pointer; box-shadow: 0 5px 0 #00967D; transition: 0.2s; text-transform: uppercase;
        }
        .check-btn:active { transform: translateY(4px); box-shadow: none; }

        .explanation {
            display: none; margin-top: 20px; background: #fff; border: 2px solid var(--primary);
            padding: 20px; border-radius: 15px; font-size: 1rem; animation: fadeIn 0.5s;
        }
        .explanation h4 { margin: 0 0 10px 0; color: var(--primary); text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .explanation h4::before { content: 'üí°'; font-size: 1.5rem; }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%; border-collapse: separate; border-spacing: 0; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 50px;
        }
        .glossary-table th { background: var(--primary); color: white; padding: 18px; text-align: left; font-weight: 800; }
        .glossary-table td { padding: 15px 18px; border-bottom: 1px solid #eee; font-weight: 600; }

        /* STICKY FOOTER */
        .sticky-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 15px; box-shadow: 0 -5px 30px rgba(0,0,0,0.1);
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .submit-all-btn {
            background: linear-gradient(45deg, var(--primary), #a55eea); color: white; border: none;
            padding: 15px 50px; border-radius: 50px; font-size: 1.3rem; font-weight: 900;
            cursor: pointer; box-shadow: 0 8px 20px rgba(136, 84, 192, 0.4); transition: transform 0.2s;
        }
        .submit-all-btn:hover { transform: scale(1.05); }

        /* --- MODAL POPUP (NEW) --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            align-items: center; justify-content: center;
        }

        .modal-content {
            background-color: #fff; padding: 40px; border-radius: 30px; text-align: center;
            max-width: 500px; width: 90%; position: relative;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 6px solid var(--secondary); box-shadow: 0 25px 60px rgba(0,0,0,0.4);
        }

        .score-circle {
            width: 160px; height: 160px; background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; margin: 25px auto;
            font-size: 3.5rem; font-weight: 900; box-shadow: 0 10px 0 #5f27cd; border: 5px solid white;
        }

        .modal h2 { color: var(--text); margin: 0; font-size: 2rem; font-weight: 900; }
        .feedback-msg { font-size: 1.2rem; color: #555; margin: 20px 0; line-height: 1.6; }
        
        .close-modal-btn {
            background: #eee; color: #333; border: none; padding: 15px 35px; border-radius: 30px;
            font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        .close-modal-btn:hover { background: #ddd; }

        /* ANIMATIONS */
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-8px); } 50% { transform: translateX(8px); } 75% { transform: translateX(-8px); } 100% { transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2000; }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>ENGLISH TEST - GRADE 8</h1>
            <div class="sub-header">Gi√°o vi√™n: Ms Mai An ULIS</div>
            <div style="margin-top: 15px; font-weight: bold; color: var(--secondary);">UNIT 7: ENVIRONMENTAL PROTECTION</div>
        </header>

        <div class="section-title">X. Find the Mistake</div>
        <div id="part-x"></div>

        <div class="section-title">XI. Conditional Sentences Type 1</div>
        <div id="part-xi"></div>

        <div class="section-title">XII. Word Forms</div>
        <div id="part-xii"></div>

        <div class="section-title">XIII. Prepositions</div>
        <div id="part-xiii"></div>

        <div class="section-title">Speaking: Make Questions</div>
        <div id="part-speaking"></div>

        <div class="section-title">Glossary (T·ª´ v·ª±ng n√¢ng cao)</div>
        <table class="glossary-table">
            <thead>
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            </thead>
            <tbody id="glossary-body"></tbody>
        </table>
    </div>

    <div class="sticky-footer">
        <button class="submit-all-btn" onclick="submitAll()">N·ªòP B√ÄI (SUBMIT)</button>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ B√ÄI THI</h2>
            <div class="score-circle">
                <span id="final-score-text">0/50</span>
            </div>
            <div id="feedback-text" class="feedback-msg">...</div>
            <button class="close-modal-btn" onclick="closeModal()">Xem l·∫°i b√†i & L·ªùi gi·∫£i</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const glossaryData = [
            {word: "Endangered species", type: "n phr", meaning: "C√°c lo√†i c√≥ nguy c∆° tuy·ªát ch·ªßng"},
            {word: "Ecosystem", type: "n", meaning: "H·ªá sinh th√°i"},
            {word: "Respiratory", type: "adj", meaning: "Thu·ªôc h√¥ h·∫•p"},
            {word: "Marine animals", type: "n phr", meaning: "ƒê·ªông v·∫≠t bi·ªÉn"},
            {word: "Insecticide", type: "n", meaning: "Thu·ªëc tr·ª´ s√¢u"},
            {word: "Conservation", type: "n", meaning: "S·ª± b·∫£o t·ªìn"},
            {word: "Single-use", type: "adj", meaning: "D√πng m·ªôt l·∫ßn"}
        ];

        const partXData = [
            { q: "1. It‚Äôs necessary to raise awareness of <u>endangered species</u> (C) and <u>environment protection</u> (D).", options: ["A", "B", "C", "D"], correct: 3, explain: "<b>D·ªãch:</b> C·∫ßn n√¢ng cao nh·∫≠n th·ª©c v·ªÅ b·∫£o v·ªá m√¥i tr∆∞·ªùng.<br><b>S·ª≠a:</b> environment ‚Üí <b>environmental</b> protection (C·∫ßn t√≠nh t·ª´)." },
            { q: "2. The amount of waste <u>will decrease</u> (A) when people <u>will start</u> (C) to buy <u>reusable</u> (D) packages.", options: ["A", "B", "C", "D"], correct: 2, explain: "<b>Ng·ªØ ph√°p:</b> M·ªánh ƒë·ªÅ th·ªùi gian 'when' ·ªü t∆∞∆°ng lai d√πng Hi·ªán t·∫°i ƒë∆°n.<br><b>S·ª≠a:</b> will start ‚Üí <b>start</b>." },
            { q: "3. Could you tell me the <u>negative effects</u> (B) of cutting <u>up</u> (C) trees on the ecosystem?", options: ["A", "B", "C", "D"], correct: 2, explain: "<b>Phrasal verb:</b> Ch·∫∑t c√¢y l√† cut down.<br><b>S·ª≠a:</b> cutting up ‚Üí <b>cutting down</b>." },
            { q: "4. There will be much less pollution <u>while</u> (B) people <u>stop</u> (C) using cars <u>completely</u> (D).", options: ["A", "B", "C", "D"], correct: 1, explain: "<b>Ng·ªØ ph√°p:</b> C√¢u ƒëi·ªÅu ki·ªán, d√πng If.<br><b>S·ª≠a:</b> while ‚Üí <b>if</b>." },
            { q: "5. <u>Use-single</u> (A) products like plastic bottles and bags can kill <u>or</u> (C) trap <u>marine</u> (D) animals.", options: ["A", "B", "C", "D"], correct: 0, explain: "<b>T·ª´ v·ª±ng:</b> ƒê·ªì d√πng 1 l·∫ßn l√† Single-use.<br><b>S·ª≠a:</b> Use-single ‚Üí <b>Single-use</b>." },
            { q: "6. If we don‚Äôt bury chemical <u>wastes</u> (B) underground, we <u>won't</u> (C) pollute fresh water <u>supplies</u> (D).", options: ["A", "B", "C", "D"], correct: 2, explain: "<b>Logic:</b> N·∫øu KH√îNG ch√¥n ƒë√∫ng c√°ch -> S·∫º g√¢y √¥ nhi·ªÖm.<br><b>S·ª≠a:</b> won't ‚Üí <b>will</b>." },
            { q: "7. The firefighters <u>immediately</u> (A) came to rescue the koala <u>until</u> (C) they saw <u>it</u> (D) in the fire.", options: ["A", "B", "C", "D"], correct: 2, explain: "<b>Ng·ªØ ph√°p:</b> C·ª©u ngay khi nh√¨n th·∫•y.<br><b>S·ª≠a:</b> until ‚Üí <b>when/as soon as</b>." },
            { q: "8. Please <u>wait</u> (A) here <u>when</u> (B) the volunteers <u>are picking up</u> (C) rubbish along the river.", options: ["A", "B", "C", "D"], correct: 1, explain: "<b>Ng·ªØ ph√°p:</b> H√†nh ƒë·ªông ƒëang di·ªÖn ra d√πng While.<br><b>S·ª≠a:</b> when ‚Üí <b>while</b>." },
            { q: "9. If people pay a <u>few</u> (A) more attention <u>to</u> (B) the environment, <u>the</u> (C) Earth will be <u>greener</u> (D).", options: ["A", "B", "C", "D"], correct: 0, explain: "<b>Ng·ªØ ph√°p:</b> Attention kh√¥ng ƒë·∫øm ƒë∆∞·ª£c -> d√πng Little.<br><b>S·ª≠a:</b> a few ‚Üí <b>a little</b>." },
            { q: "10. We can <u>help</u> (A) the environment by avoiding <u>using</u> (C) plastic products and stopping <u>litter</u> (D).", options: ["A", "B", "C", "D"], correct: 3, explain: "<b>Ng·ªØ ph√°p:</b> Song h√†nh sau By: avoiding... and stopping littering.<br><b>S·ª≠a:</b> litter ‚Üí <b>littering</b>." }
        ];

        const partXIData = [
            { q: "1. If the air in a city _______ (get) very polluted, it can make people's eyes burn.", answers: ["gets"], explain: "Ch·ªß ng·ªØ 'The air' s·ªë √≠t -> gets." },
            { q: "2. If we dump chemicals, we _______ (not be) able to swim.", answers: ["won't be", "will not be"], explain: "V·∫ø ch√≠nh c√¢u ƒêK lo·∫°i 1 -> won't be." },
            { q: "3. Habitats will be destroyed if people _______ (keep) polluting.", answers: ["keep"], explain: "V·∫ø If, ch·ªß ng·ªØ 'people' s·ªë nhi·ªÅu -> keep." },
            { q: "4. If we use public transport, we _______ (help) reduce pollution.", answers: ["will help"], explain: "V·∫ø ch√≠nh c√¢u ƒêK lo·∫°i 1 -> will help." },
            { q: "5. If we _______ (not stop) over-fishing, species _______ (become) extinct.", answers: ["don't stop", "will become"], multi: true, explain: "V·∫ø If -> don't stop. V·∫ø ch√≠nh -> will become." },
            { q: "6. If everyone _______ (recycle), we _______ (not produce) rubbish.", answers: ["recycles", "won't produce"], multi: true, explain: "V·∫ø If (everyone - s·ªë √≠t) -> recycles. V·∫ø ch√≠nh -> won't produce." },
            { q: "7. We _______ (have) dirty seafood if we _______ (dump) rubbish.", answers: ["will have", "dump"], multi: true, explain: "V·∫ø ch√≠nh -> will have. V·∫ø If -> dump." },
            { q: "8. If global warming _______ (continue), temperatures _______ (rise).", answers: ["continues", "will rise"], multi: true, explain: "V·∫ø If (s·ªë √≠t) -> continues. V·∫ø ch√≠nh -> will rise." },
            { q: "9. If light pollution _______ (keep) growing, you _______ (not be) able to see stars.", answers: ["keeps", "won't be"], multi: true, explain: "V·∫ø If -> keeps. V·∫ø ch√≠nh -> won't be." },
            { q: "10. We _______ (threaten) our existence if we _______ (not cut down) waste.", answers: ["will threaten", "don't cut down"], multi: true, explain: "V·∫ø ch√≠nh -> will threaten. V·∫ø If -> don't cut down." }
        ];

        const partXIIData = [
            { q: "1. It's evidence that this ocean is clean and environmentally _______ (pollute).", answers: ["unpolluted"], explain: "C·∫ßn t√≠nh t·ª´ nghƒ©a t·ªët -> unpolluted (trong l√†nh)." },
            { q: "2. World Wide Fund is a famous _______ organisation. (environment)", answers: ["environmental"], explain: "T√≠nh t·ª´ -> environmental." },
            { q: "3. This area is a part of a wildlife _______ programme. (conserve)", answers: ["conservation"], explain: "Danh t·ª´ -> conservation (s·ª± b·∫£o t·ªìn)." },
            { q: "4. Sea turtles are some _______ species. (endanger)", answers: ["endangered"], explain: "T√≠nh t·ª´ -> endangered (nguy c·∫•p)." },
            { q: "5. The crops are free of _______ insecticides. (poison)", answers: ["poisonous"], explain: "T√≠nh t·ª´ -> poisonous (c√≥ ƒë·ªôc)." },
            { q: "6. Habitat _______ poses the greatest threat. (lose)", answers: ["loss"], explain: "Danh t·ª´ -> loss (s·ª± m·∫•t m√°t)." },
            { q: "7. Field trip to Cat Ba _______ Park. (nation)", answers: ["national"], explain: "V∆∞·ªùn qu·ªëc gia -> National Park." },
            { q: "8. Camel's _______ habitat is the deserts. (nature)", answers: ["natural"], explain: "T√≠nh t·ª´ -> natural (t·ª± nhi√™n)." },
            { q: "9. Our _______ encourages practising the 3Rs. (neighbour)", answers: ["neighbourhood", "neighborhood"], explain: "Danh t·ª´ -> neighbourhood (khu d√¢n c∆∞)." },
            { q: "10. Water pollution leads to the _______ of aquatic plants. (die)", answers: ["death"], explain: "Danh t·ª´ -> death (c√°i ch·∫øt)." }
        ];

        const partXIIIData = [
            { text: "1. Water pollution can be harmful [at / to] fish.", correct: "to", explain: "harmful to: c√≥ h·∫°i cho." },
            { text: "2. Using drinking water for garden is a waste [from / of] resources!", correct: "of", explain: "a waste of: s·ª± l√£ng ph√≠." },
            { text: "3. Prevent the poisonous gases [on / from] polluting.", correct: "from", explain: "prevent ... from: ngƒÉn ch·∫∑n kh·ªèi." },
            { text: "4. Factories dump toxic waste [into / at] the river.", correct: "into", explain: "dump into: ƒë·ªï v√†o." },
            { text: "5. She's come up [to / with] amazing new ideas.", correct: "with", explain: "come up with: n·∫£y ra √Ω t∆∞·ªüng." },
            { text: "6. Noise pollution effects [on / in] human health.", correct: "on", explain: "effect on: ·∫£nh h∆∞·ªüng l√™n." },
            { text: "7. Toxic substances are unsafe [for / with] the ecosystem.", correct: "for", explain: "unsafe for: kh√¥ng an to√†n cho." },
            { text: "8. Cat Tien National Park is home [in / to] some monkeys.", correct: "to", explain: "be home to: l√† nh√† c·ªßa." },
            { text: "9. The river has been polluted [with / from] toxic waste.", correct: "with", explain: "polluted with: b·ªã √¥ nhi·ªÖm b·ªüi." },
            { text: "10. Children should be aware [at / of] the issues.", correct: "of", explain: "aware of: nh·∫≠n th·ª©c v·ªÅ." }
        ];

        const partSpeakingData = [
            { text: "Water pollution is <u>the contamination of water bodies</u>.", words: ["What", "is", "water", "pollution?"], full: "What is water pollution?", explain: "H·ªèi ƒë·ªãnh nghƒ©a -> What is..." },
            { text: "Animals are extinct <u>because of illegal hunting</u>.", words: ["Why", "are", "animals", "extinct?"], full: "Why are animals extinct?", explain: "H·ªèi l√Ω do -> Why are..." },
            { text: "There are <u>sixty-three</u> national parks.", words: ["How", "many", "national", "parks", "are", "there?"], full: "How many national parks are there?", explain: "H·ªèi s·ªë l∆∞·ª£ng -> How many..." },
            { text: "He <u>will build a campfire</u>.", words: ["What", "will", "he", "do?"], full: "What will he do?", explain: "H·ªèi h√†nh ƒë·ªông -> What will..." },
            { text: "Plastic waste ends up <u>in the oceans</u>.", words: ["Where", "does", "plastic", "waste", "end", "up?"], full: "Where does plastic waste end up?", explain: "H·ªèi n∆°i ch·ªën -> Where..." },
            { text: "Students visit the park <u>this weekend</u>.", words: ["When", "do", "students", "visit", "the", "park?"], full: "When do students visit the park?", explain: "H·ªèi th·ªùi gian -> When..." },
            { text: "<u>HCM City</u> is more polluted than Da Nang.", words: ["Which", "city", "is", "more", "polluted?"], full: "Which city is more polluted?", explain: "C√¢u h·ªèi l·ª±a ch·ªçn -> Which city..." },
            { text: "People collect garbage <u>every day</u>.", words: ["How", "often", "do", "people", "collect", "garbage?"], full: "How often do people collect garbage?", explain: "H·ªèi t·∫ßn su·∫•t -> How often..." },
            { text: "<u>Every individual</u> is responsible.", words: ["Who", "is", "responsible?"], full: "Who is responsible?", explain: "H·ªèi ng∆∞·ªùi -> Who..." },
            { text: "Prevent pollution <u>by proper disposing</u>.", words: ["How", "can", "we", "prevent", "pollution?"], full: "How can we prevent pollution?", explain: "H·ªèi c√°ch th·ª©c -> How..." }
        ];

        // --- RENDER LOGIC ---
        // Render Glossary
        document.getElementById('glossary-body').innerHTML = glossaryData.map(i => `<tr><td>${i.word}</td><td><span style="background:#eee;padding:2px 5px;border-radius:4px;font-size:0.8em">${i.type}</span></td><td>${i.meaning}</td></tr>`).join('');

        // Render functions
        function renderPartX() {
            const container = document.getElementById('part-x');
            partXData.forEach((item, index) => {
                container.innerHTML += `
                    <div class="q-card" id="card-x-${index}">
                        <div class="q-text"><span class="q-number">${index+1}.</span>${item.q}</div>
                        <div class="options-grid" id="px-opt-${index}">
                            ${item.options.map((opt, i) => `<button class="option-btn" onclick="checkPartX(${index}, ${i}, this)">${opt}. ${['Necessary','Awareness','Endangered','Environment'][i] || 'Option'}</button>`).join('')}
                        </div>
                        <div class="explanation" id="px-exp-${index}"><h4>Gi·∫£i th√≠ch:</h4><p>${item.explain}</p></div>
                    </div>`;
            });
        }

        function renderPartXI() {
            const container = document.getElementById('part-xi');
            partXIData.forEach((item, index) => {
                let htmlQ = item.q.replace('_______', `<input class="q-input" id="pxi-${index}-0">`);
                if(item.multi) htmlQ = item.q.split('_______').join(`<input class="q-input" id="pxi-split-${index}">`).replace(`id="pxi-split-${index}"`, `id="pxi-${index}-0"`).replace(`id="pxi-split-${index}"`, `id="pxi-${index}-1"`);
                container.innerHTML += `
                    <div class="q-card" id="card-xi-${index}">
                        <div class="q-text"><span class="q-number">${index+1}.</span>${htmlQ}</div>
                        <div class="action-row"><button class="check-btn" onclick="checkPartXI(${index})">Ki·ªÉm tra</button></div>
                        <div class="explanation" id="pxi-exp-${index}"><h4>Gi·∫£i th√≠ch:</h4><p>${item.explain}</p></div>
                    </div>`;
            });
        }

        function renderPartXII() {
            const container = document.getElementById('part-xii');
            partXIIData.forEach((item, index) => {
                container.innerHTML += `
                    <div class="q-card" id="card-xii-${index}">
                        <div class="q-text"><span class="q-number">${index+1}.</span>${item.q.replace('_______', `<input class="q-input" id="pxii-${index}">`)}</div>
                        <div class="action-row"><button class="check-btn" onclick="checkPartXII(${index})">Ki·ªÉm tra</button></div>
                        <div class="explanation" id="pxii-exp-${index}"><h4>Gi·∫£i th√≠ch:</h4><p>${item.explain}</p></div>
                    </div>`;
            });
        }

        function renderPartXIII() {
            const container = document.getElementById('part-xiii');
            partXIIIData.forEach((item, index) => {
                const parts = item.text.split('[');
                const suffix = parts[1].split(']');
                const choices = suffix[0].split('/');
                container.innerHTML += `
                    <div class="q-card" id="card-xiii-${index}">
                        <div class="q-text"><span class="q-number">${index+1}.</span>${parts[0]} [ 
                        <span class="prep-choice" onclick="selectPrep(this, ${index}, '${choices[0].trim()}', '${item.correct}')">${choices[0].trim()}</span> / 
                        <span class="prep-choice" onclick="selectPrep(this, ${index}, '${choices[1].trim()}', '${item.correct}')">${choices[1].trim()}</span> ] ${suffix[1]}</div>
                        <div class="explanation" id="pxiii-exp-${index}"><h4>Gi·∫£i th√≠ch:</h4><p>${item.explain}</p></div>
                    </div>`;
            });
        }

        function renderSpeaking() {
            const container = document.getElementById('part-speaking');
            partSpeakingData.forEach((item, index) => {
                const shuffled = [...item.words].sort(() => Math.random() - 0.5);
                container.innerHTML += `
                    <div class="q-card" id="card-sp-${index}">
                        <div class="q-text"><span class="q-number">${index+1}.</span>${item.text}</div>
                        <div class="scramble-container">
                            <div class="scramble-answer" id="sa-${index}"></div>
                            <div class="scramble-pool" id="sp-${index}">
                                ${shuffled.map(w => `<div class="word-chip" onclick="moveWord(this, 'sa-${index}', 'sp-${index}')">${w}</div>`).join('')}
                            </div>
                        </div>
                        <div class="action-row"><button class="check-btn" onclick="checkSpeaking(${index})">Ki·ªÉm tra</button></div>
                        <div class="explanation" id="psp-exp-${index}"><p><b>ƒê√°p √°n:</b> ${item.full}</p><p>${item.explain}</p></div>
                    </div>`;
            });
        }

        // --- CHECK FUNCTIONS ---
        function checkPartX(qIdx, optIdx, btn) {
            const q = partXData[qIdx];
            const parent = document.getElementById(`px-opt-${qIdx}`);
            const buttons = parent.getElementsByClassName('option-btn');
            const card = document.getElementById(`card-x-${qIdx}`);
            
            for(let b of buttons) b.disabled = true;
            if(optIdx === q.correct) {
                btn.classList.add('correct');
                card.classList.add('user-correct'); // Mark as correct for scoring
                playSuccess();
            } else {
                btn.classList.add('wrong');
                buttons[q.correct].classList.add('correct');
            }
            document.getElementById(`px-exp-${qIdx}`).style.display = 'block';
        }

        function checkPartXI(index) {
            const data = partXIData[index];
            const card = document.getElementById(`card-xi-${index}`);
            let isCorrect = true;
            
            // Logic map for inputs
            let inputs = [document.getElementById(`pxi-${index}-0`)];
            if(data.multi) inputs.push(document.getElementById(`pxi-${index}-1`));
            
            // Hardcoded answers mapping for demo safety
            let ans = [data.answers];
            if(data.multi) {
                if(index===4) ans = [["don't stop", "do not stop"], ["will become"]];
                else if(index===5) ans = [["recycles"], ["won't produce"]];
                else if(index===6) ans = [["will have"], ["dump"]];
                else if(index===7) ans = [["continues"], ["will rise"]];
                else if(index===8) ans = [["keeps"], ["won't be"]];
                else if(index===9) ans = [["will threaten"], ["don't cut down"]];
            }

            inputs.forEach((inp, i) => {
                if(!checkInput(inp, ans[i])) isCorrect = false;
            });

            if(isCorrect) { card.classList.add('user-correct'); playSuccess(); }
            else card.classList.remove('user-correct');
            
            document.getElementById(`pxi-exp-${index}`).style.display = 'block';
        }

        function checkPartXII(index) {
            const card = document.getElementById(`card-xii-${index}`);
            const inp = document.getElementById(`pxii-${index}`);
            if(checkInput(inp, partXIIData[index].answers)) {
                card.classList.add('user-correct'); playSuccess();
            } else {
                card.classList.remove('user-correct');
            }
            document.getElementById(`pxii-exp-${index}`).style.display = 'block';
        }

        function checkInput(el, correctArr) {
            const val = el.value.trim().toLowerCase();
            if(correctArr.map(x=>x.toLowerCase()).includes(val)) {
                el.classList.add('correct'); el.classList.remove('wrong'); return true;
            }
            el.classList.add('wrong'); el.classList.remove('correct'); return false;
        }

        function selectPrep(el, index, text, correct) {
            const card = document.getElementById(`card-xiii-${index}`);
            // Reset siblings
            Array.from(el.parentElement.children).forEach(c => c.classList.remove('correct','wrong'));
            
            if(text.toLowerCase() === correct.toLowerCase()) {
                el.classList.add('correct');
                card.classList.add('user-correct');
                playSuccess();
            } else {
                el.classList.add('wrong');
                card.classList.remove('user-correct');
            }
            document.getElementById(`pxiii-exp-${index}`).style.display = 'block';
        }

        function moveWord(el, targetId, sourceId) {
            const target = document.getElementById(targetId);
            const source = document.getElementById(sourceId);
            if(el.parentElement.id === sourceId) target.appendChild(el); else source.appendChild(el);
        }

        function checkSpeaking(index) {
            const card = document.getElementById(`card-sp-${index}`);
            const userWords = Array.from(document.getElementById(`sa-${index}`).children).map(c=>c.innerText).join(' ');
            const cleanUser = userWords.toLowerCase().replace(/[?.,]/g, '').trim();
            const cleanKey = partSpeakingData[index].full.toLowerCase().replace(/[?.,]/g, '').trim();
            
            if(cleanUser === cleanKey) {
                card.classList.add('user-correct');
                document.getElementById(`sa-${index}`).style.backgroundColor = '#e6fffa';
                document.getElementById(`sa-${index}`).style.borderColor = 'var(--correct)';
                playSuccess();
            } else {
                card.classList.remove('user-correct');
                document.getElementById(`sa-${index}`).style.borderColor = 'var(--wrong)';
            }
            document.getElementById(`psp-exp-${index}`).style.display = 'block';
        }

        // --- SUBMIT SYSTEM ---
        function submitAll() {
            const total = 50;
            const correct = document.querySelectorAll('.q-card.user-correct').length;
            const scoreText = document.getElementById('final-score-text');
            const feedback = document.getElementById('feedback-text');
            
            scoreText.innerText = `${correct}/${total}`;
            
            if(correct >= 45) {
                feedback.innerHTML = "üåü <b>XU·∫§T S·∫ÆC!</b><br>C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em. Ki·∫øn th·ª©c c·ªßa em c·ª±c k·ª≥ v·ªØng ch·∫Øc!";
                fireConfetti(3); // Many confetti
            } else if (correct >= 35) {
                feedback.innerHTML = "üëç <b>L√ÄM T·ªêT L·∫ÆM!</b><br>Em ƒë√£ n·∫Øm ƒë∆∞·ª£c b√†i r·ªìi. C·ªë g·∫Øng √¥n l·∫°i c√°c l·ªói sai ƒë·ªÉ ƒë·∫°t ƒëi·ªÉm tuy·ªát ƒë·ªëi nh√©!";
                fireConfetti(1); // Little confetti
            } else {
                feedback.innerHTML = "üí™ <b>C·ªê G·∫ÆNG L√äN!</b><br>ƒê·ª´ng n·∫£n l√≤ng nh√©. H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt b√™n d∆∞·ªõi ƒë·ªÉ r√∫t kinh nghi·ªám n√†o!";
            }
            
            document.getElementById('result-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

        function playSuccess() { fireConfetti(0.2); }

        function fireConfetti(duration) {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            
            const particles = [];
            for(let i=0; i<150; i++) particles.push({
                x: Math.random()*canvas.width, y: Math.random()*canvas.height-canvas.height,
                vx: Math.random()*4-2, vy: Math.random()*5+3,
                color: ['#8854C0','#00C9A7','#FF9FF3','#F39C12'][Math.floor(Math.random()*4)],
                size: Math.random()*8+4
            });
            
            let frame = 0;
            function animate() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.x+=p.vx; p.y+=p.vy; p.vy+=0.05;
                    ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size);
                    if(p.y < canvas.height) active = true;
                });
                if(active && frame < duration*60) requestAnimationFrame(animate);
                else ctx.clearRect(0,0,canvas.width,canvas.height);
                frame++;
            }
            animate();
        }

        // INIT
        renderPartX(); renderPartXI(); renderPartXII(); renderPartXIII(); renderSpeaking();
    </script>
</body>
</html>