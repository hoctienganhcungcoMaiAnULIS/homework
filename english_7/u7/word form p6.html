<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Form Quiz - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --bg: #F0F4F8;
            --correct: #00D26A;
            --wrong: #FF4757;
            --text: #2D3436;
            --card-bg: #FFFFFF;
        }

        * {
            box-sizing: border-box;
            font-family: 'Quicksand', sans-serif;
        }

        body {
            background: var(--bg);
            background-image: radial-gradient(#8854c022 1px, transparent 0);
            background-size: 30px 30px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        .teacher-name {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-size: 1.8rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
        }

        .quiz-container {
            width: 100%;
            max-width: 700px;
            perspective: 1000px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-bottom: 8px solid #ddd;
            transition: transform 0.3s;
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-bar {
            flex-grow: 1;
            height: 12px;
            background: #E0E0E0;
            border-radius: 10px;
            margin-right: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), #55efc4);
            width: 0%;
            transition: width 0.4s ease;
        }

        .score-badge {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .word-clue {
            color: var(--primary);
            font-style: italic;
            background: #f1f0ff;
            padding: 2px 8px;
            border-radius: 5px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 500px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 18px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #E0E0E0;
            position: relative;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 0 #E0E0E0;
            border-color: var(--primary);
            color: var(--primary);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #E0E0E0;
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            border-color: #00b359 !important;
            color: white !important;
            box-shadow: 0 4px 0 #00b359 !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            border-color: #d63031 !important;
            color: white !important;
            box-shadow: 0 4px 0 #d63031 !important;
        }

        .explanation {
            margin-top: 25px;
            padding: 20px;
            border-radius: 15px;
            background: #F9F9F9;
            border-left: 5px solid var(--primary);
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake { animation: shake 0.3s ease-in-out 2; }

        .explanation h3 {
            margin: 0 0 10px 0;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .explanation p {
            margin: 5px 0;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .nav-buttons {
            margin-top: 25px;
            display: flex;
            justify-content: flex-end;
        }

        .next-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 0 #00a88c;
            display: none;
        }

        .next-btn:hover {
            filter: brightness(1.1);
        }

        .next-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #00a88c;
        }

        .summary-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .summary-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .summary-score {
            font-size: 4rem;
            color: var(--primary);
            font-weight: 800;
            margin: 20px 0;
        }

        .summary-msg {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--text);
        }

        .restart-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
        }

        /* Sound Toggle */
        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 0 #ddd;
        }
    </style>
</head>
<body>

    <button class="sound-toggle" onclick="toggleSound()" title="T·∫Øt/M·ªü √¢m thanh">üîä</button>

    <header>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <h1>Word Form Challenge (32-50)</h1>
    </header>

    <div class="quiz-container">
        <div class="card" id="quiz-card">
            <div class="question-meta">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="score-badge">C√¢u <span id="current-q-num">1</span>/19</div>
            </div>

            <div class="question-text" id="question-text">
                ƒêang t·∫£i c√¢u h·ªèi...
            </div>

            <div class="options-grid" id="options-grid">
                <!-- Options will be injected here -->
            </div>

            <div class="explanation" id="explanation-box">
                <!-- Explanation will be injected here -->
            </div>

            <div class="nav-buttons">
                <button class="next-btn" id="next-btn" onclick="nextQuestion()">Ti·∫øp t·ª•c ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="summary-overlay" id="summary-overlay">
        <div class="summary-card">
            <h2>üéâ HO√ÄN TH√ÄNH! üéâ</h2>
            <div class="summary-score" id="final-score">0/19</div>
            <div class="summary-msg" id="final-msg"></div>
            <button class="restart-btn" onclick="location.reload()">L√†m l·∫°i th·ª≠ th√°ch</button>
        </div>
    </div>

    <script>
        const quizData = [
            {
                num: 32,
                q: "Do you know what this flower ________? (SYMBOL)",
                options: ["symbolizes", "symbol", "symbolic", "symbolism"],
                correct: "symbolizes",
                analysis: [
                    "A. symbol (n): bi·ªÉu t∆∞·ª£ng",
                    "B. symbolizes (v): t∆∞·ª£ng tr∆∞ng cho",
                    "C. symbolic (adj): mang t√≠nh t∆∞·ª£ng tr∆∞ng",
                    "D. symbolism (n): ch·ªß nghƒ©a t∆∞·ª£ng tr∆∞ng"
                ],
                translation: "B·∫°n c√≥ bi·∫øt lo√†i hoa n√†y t∆∞·ª£ng tr∆∞ng cho ƒëi·ªÅu g√¨ kh√¥ng?",
                why: "ƒê√¢y l√† m·ªánh ƒë·ªÅ danh ng·ªØ 'what this flower...'. V√¨ 'this flower' l√† ch·ªß ng·ªØ s·ªë √≠t n√™n c·∫ßn ƒë·ªông t·ª´ chia ng√¥i th·ª© 3 s·ªë √≠t."
            },
            {
                num: 33,
                q: "The pineapple was sweet and ________. (juice)",
                options: ["juicy", "juice", "juices", "juicily"],
                correct: "juicy",
                analysis: [
                    "A. juicy (adj): m·ªçng n∆∞·ªõc",
                    "B. juice (n): n∆∞·ªõc √©p",
                    "C. juices (n): c√°c lo·∫°i n∆∞·ªõc √©p",
                    "D. juicily (adv): m·ªôt c√°ch m·ªçng n∆∞·ªõc"
                ],
                translation: "Qu·∫£ d·ª©a th√¨ ng·ªçt v√† m·ªçng n∆∞·ªõc.",
                why: "C·∫•u tr√∫c song song: 'sweet' l√† t√≠nh t·ª´ n√™n sau 'and' c≈©ng c·∫ßn m·ªôt t√≠nh t·ª´ ƒë·ªÉ mi√™u t·∫£ qu·∫£ d·ª©a."
            },
            {
                num: 34,
                q: "The black rhino is a(n) ________ species. There are very few of them left in the wild. (DANGER)",
                options: ["endangered", "dangerous", "danger", "endanger"],
                correct: "endangered",
                analysis: [
                    "A. endangered (adj): c√≥ nguy c∆° tuy·ªát ch·ªßng",
                    "B. dangerous (adj): nguy hi·ªÉm",
                    "C. danger (n): s·ª± nguy hi·ªÉm",
                    "D. endanger (v): g√¢y nguy hi·ªÉm"
                ],
                translation: "T√™ gi√°c ƒëen l√† m·ªôt lo√†i ƒëang b·ªã ƒëe d·ªça tuy·ªát ch·ªßng.",
                why: "C·ª•m t·ª´ 'endangered species' l√† thu·∫≠t ng·ªØ ch·ªâ c√°c lo√†i s·∫Øp tuy·ªát ch·ªßng. Ng·ªØ c·∫£nh 'r·∫•t √≠t c√° th·ªÉ c√≤n l·∫°i' x√°c nh·∫≠n ƒë√°p √°n n√†y."
            },
            {
                num: 35,
                q: "I loved the ________ this night. (perform)",
                options: ["performance", "performer", "perform", "performing"],
                correct: "performance",
                analysis: [
                    "A. performance (n): m√†n tr√¨nh di·ªÖn",
                    "B. performer (n): ng∆∞·ªùi bi·ªÉu di·ªÖn",
                    "C. perform (v): bi·ªÉu di·ªÖn",
                    "D. performing (v-ing): vi·ªác bi·ªÉu di·ªÖn"
                ],
                translation: "T√¥i r·∫•t th√≠ch m√†n tr√¨nh di·ªÖn t·ªëi nay.",
                why: "Sau m·∫°o t·ª´ 'the' c·∫ßn m·ªôt danh t·ª´. ·ªû ƒë√¢y n√≥i v·ªÅ s·ª± ki·ªán n√™n ch·ªçn performance."
            },
            {
                num: 36,
                q: "Limit car trips by relying on biking, walking, public ________. (transport)",
                options: ["transport", "transporter", "transported", "transporting"],
                correct: "transport",
                analysis: [
                    "A. transport (n): giao th√¥ng/v·∫≠n t·∫£i",
                    "B. transporter (n): ng∆∞·ªùi v·∫≠n chuy·ªÉn",
                    "C. transported (v-ed): ƒë√£ v·∫≠n chuy·ªÉn",
                    "D. transporting (v-ing): vi·ªác v·∫≠n chuy·ªÉn"
                ],
                translation: "H·∫°n ch·∫ø ƒëi xe h∆°i b·∫±ng c√°ch ƒëi xe ƒë·∫°p, ƒëi b·ªô ho·∫∑c ph∆∞∆°ng ti·ªán c√¥ng c·ªông.",
                why: "C·ª•m danh t·ª´ c·ªë ƒë·ªãnh: 'public transport' (ph∆∞∆°ng ti·ªán c√¥ng c·ªông)."
            },
            {
                num: 37,
                q: "Energy is used to ________ a lot of electrical things. (product)",
                options: ["produce", "product", "production", "productive"],
                correct: "produce",
                analysis: [
                    "A. produce (v): s·∫£n xu·∫•t",
                    "B. product (n): s·∫£n ph·∫©m",
                    "C. production (n): s·ª± s·∫£n xu·∫•t",
                    "D. productive (adj): nƒÉng su·∫•t"
                ],
                translation: "NƒÉng l∆∞·ª£ng ƒë∆∞·ª£c d√πng ƒë·ªÉ s·∫£n xu·∫•t r·∫•t nhi·ªÅu ƒë·ªì ƒëi·ªán t·ª≠.",
                why: "C·∫•u tr√∫c 'be used to + V-infinitive' ch·ªâ m·ª•c ƒë√≠ch: ƒë∆∞·ª£c d√πng ƒë·ªÉ l√†m g√¨."
            },
            {
                num: 38,
                q: "Although I prepared carefully, I got nervous when giving my ________. (PRESENT)",
                options: ["presentation", "present", "presenter", "presence"],
                correct: "presentation",
                analysis: [
                    "A. presentation (n): b√†i thuy·∫øt tr√¨nh",
                    "B. present (v): tr√¨nh b√†y",
                    "C. presenter (n): ng∆∞·ªùi thuy·∫øt tr√¨nh",
                    "D. presence (n): s·ª± hi·ªán di·ªán"
                ],
                translation: "M·∫∑c d√π chu·∫©n b·ªã k·ªπ, t√¥i v·∫´n lo l·∫Øng khi l√†m b√†i thuy·∫øt tr√¨nh.",
                why: "Sau t√≠nh t·ª´ s·ªü h·ªØu 'my' c·∫ßn danh t·ª´. C·ª•m 'give a presentation' nghƒ©a l√† thuy·∫øt tr√¨nh."
            },
            {
                num: 39,
                q: "Air ________ is a serious problem in big cities like Tokyo or Shanghai. (POLLUTE)",
                options: ["pollution", "polluted", "pollute", "pollutant"],
                correct: "pollution",
                analysis: [
                    "A. pollution (n): s·ª± √¥ nhi·ªÖm",
                    "B. polluted (adj): b·ªã √¥ nhi·ªÖm",
                    "C. pollute (v): l√†m √¥ nhi·ªÖm",
                    "D. pollutant (n): ch·∫•t g√¢y √¥ nhi·ªÖm"
                ],
                translation: "√î nhi·ªÖm kh√¥ng kh√≠ l√† v·∫•n ƒë·ªÅ nghi√™m tr·ªçng ·ªü c√°c th√†nh ph·ªë l·ªõn.",
                why: "C·ª•m danh t·ª´ 'Air pollution' ƒë√≥ng vai tr√≤ ch·ªß ng·ªØ ch√≠nh trong c√¢u."
            },
            {
                num: 40,
                q: "Make a ________ to charity projects. (DONATE)",
                options: ["donation", "donate", "donor", "donating"],
                correct: "donation",
                analysis: [
                    "A. donation (n): s·ª± quy√™n g√≥p",
                    "B. donate (v): quy√™n g√≥p",
                    "C. donor (n): ng∆∞·ªùi quy√™n g√≥p",
                    "D. donating (v-ing): vi·ªác quy√™n g√≥p"
                ],
                translation: "H√£y th·ª±c hi·ªán m·ªôt kho·∫£n quy√™n g√≥p cho c√°c d·ª± √°n t·ª´ thi·ªán.",
                why: "Sau m·∫°o t·ª´ 'a' c·∫ßn danh t·ª´. C·ª•m 'make a donation' = donate (quy√™n g√≥p)."
            },
            {
                num: 41,
                q: "Just by wearing a virtual ________ headset, gamers feel as if they are actually in a new environment. (real)",
                options: ["reality", "real", "really", "realize"],
                correct: "reality",
                analysis: [
                    "A. reality (n): th·ª±c t·∫ø",
                    "B. real (adj): th·∫≠t",
                    "C. really (adv): th·ª±c s·ª±",
                    "D. realize (v): nh·∫≠n ra"
                ],
                translation: "Ch·ªâ c·∫ßn ƒëeo k√≠nh th·ª±c t·∫ø ·∫£o, ng∆∞·ªùi ch∆°i c·∫£m th·∫•y nh∆∞ ƒëang ·ªü m√¥i tr∆∞·ªùng m·ªõi.",
                why: "C·ª•m danh t·ª´ c·ªë ƒë·ªãnh: 'Virtual Reality' (VR) - Th·ª±c t·∫ø ·∫£o."
            },
            {
                num: 42,
                q: "My classmate is very ________. She talks all the time and often gets into trouble. (TALK)",
                options: ["talkative", "talker", "talking", "talk"],
                correct: "talkative",
                analysis: [
                    "A. talkative (adj): hay n√≥i/l·∫Øm l·ªùi",
                    "B. talker (n): ng∆∞·ªùi n√≥i",
                    "C. talking (v-ing): ƒëang n√≥i",
                    "D. talk (v): n√≥i"
                ],
                translation: "B·∫°n c√πng l·ªõp c·ªßa t√¥i r·∫•t hay n√≥i.",
                why: "Sau 'is very' c·∫ßn m·ªôt t√≠nh t·ª´ ch·ªâ t√≠nh c√°ch. 'Talks all the time' d·∫´n ƒë·∫øn ƒë√°p √°n talkative."
            },
            {
                num: 43,
                q: "Most of the audience left in the middle of the ________ movie. (INTEREST)",
                options: ["uninteresting", "interesting", "interested", "interest"],
                correct: "uninteresting",
                analysis: [
                    "A. uninteresting (adj): kh√¥ng th√∫ v·ªã/ch√°n",
                    "B. interesting (adj): th√∫ v·ªã",
                    "C. interested (adj): quan t√¢m (d√πng cho ng∆∞·ªùi)",
                    "D. interest (n): s·ª± quan t√¢m"
                ],
                translation: "H·∫ßu h·∫øt kh√°n gi·∫£ b·ªè v·ªÅ gi·ªØa ch·ª´ng b·ªô phim t·∫ª nh·∫°t ƒë√≥.",
                why: "Kh√°n gi·∫£ b·ªè v·ªÅ (left) ch·ª©ng t·ªè phim d·ªü. C·∫ßn t√≠nh t·ª´ mang nghƒ©a ph·ªß ƒë·ªãnh 'uninteresting'."
            },
            {
                num: 44,
                q: "I went to bed too late, and I have been so ________ all morning. (SLEEP)",
                options: ["sleepy", "sleeping", "sleepless", "sleep"],
                correct: "sleepy",
                analysis: [
                    "A. sleepy (adj): bu·ªìn ng·ªß",
                    "B. sleeping (v-ing): ƒëang ng·ªß",
                    "C. sleepless (adj): m·∫•t ng·ªß",
                    "D. sleep (v): ng·ªß"
                ],
                translation: "T√¥i ƒëi ng·ªß mu·ªôn qu√° n√™n c·∫£ s√°ng nay c·ª© bu·ªìn ng·ªß.",
                why: "T√≠nh t·ª´ ch·ªâ tr·∫°ng th√°i c∆° th·ªÉ: 'feel/be sleepy' (bu·ªìn ng·ªß)."
            },
            {
                num: 45,
                q: "We took the children to a ________ show. (puppetry)",
                options: ["puppet", "puppetry", "puppeteer", "puppets"],
                correct: "puppet",
                analysis: [
                    "A. puppet (n): con r·ªëi",
                    "B. puppetry (n): ngh·ªá thu·∫≠t m√∫a r·ªëi",
                    "C. puppeteer (n): ngh·ªá nh√¢n m√∫a r·ªëi",
                    "D. puppets (n): nh·ªØng con r·ªëi"
                ],
                translation: "Ch√∫ng t√¥i ƒë∆∞a l≈© tr·∫ª ƒëi xem m·ªôt bu·ªïi di·ªÖn m√∫a r·ªëi.",
                why: "C·ª•m danh t·ª´ gh√©p: 'puppet show' (bu·ªïi di·ªÖn m√∫a r·ªëi). Danh t·ª´ ƒë·ª©ng tr∆∞·ªõc b·ªï nghƒ©a cho danh t·ª´ sau."
            },
            {
                num: 46,
                q: "Mike couldn't sleep. Today he was tired, so he fell ________ in math class. (SLEEP)",
                options: ["asleep", "sleepy", "sleeping", "sleep"],
                correct: "asleep",
                analysis: [
                    "A. asleep (adj): tr·∫°ng th√°i ƒëang ng·ªß",
                    "B. sleepy (adj): bu·ªìn ng·ªß",
                    "C. sleeping (v-ing): vi·ªác ng·ªß",
                    "D. sleep (v): ng·ªß"
                ],
                translation: "Mike m·ªát qu√° n√™n ƒë√£ ng·ªß thi·∫øp ƒëi trong gi·ªù To√°n.",
                why: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'fall asleep' (ng·ªß thi·∫øp ƒëi/ng·ªß g·∫≠t)."
            },
            {
                num: 47,
                q: "That young man is ________. He often lies to his parents and teachers. (HONEST)",
                options: ["dishonest", "honest", "honestly", "honesty"],
                correct: "dishonest",
                analysis: [
                    "A. dishonest (adj): kh√¥ng trung th·ª±c",
                    "B. honest (adj): trung th·ª±c",
                    "C. honestly (adv): m·ªôt c√°ch trung th·ª±c",
                    "D. honesty (n): s·ª± trung th·ª±c"
                ],
                translation: "Ch√†ng trai ƒë√≥ kh√¥ng trung th·ª±c. Anh ta hay n√≥i d·ªëi.",
                why: "D·ª±a v√†o h√†nh ƒë·ªông 'often lies' (hay n√≥i d·ªëi), ta c·∫ßn t√≠nh t·ª´ mang nghƒ©a tr√°i ng∆∞·ª£c v·ªõi honest."
            },
            {
                num: 48,
                q: "The weather in Vietnam is completely ________ from the weather in London. (differ)",
                options: ["different", "difference", "differ", "differently"],
                correct: "different",
                analysis: [
                    "A. different (adj): kh√°c bi·ªát",
                    "B. difference (n): s·ª± kh√°c bi·ªát",
                    "C. differ (v): kh√°c nhau",
                    "D. differently (adv): m·ªôt c√°ch kh√°c bi·ªát"
                ],
                translation: "Th·ªùi ti·∫øt Vi·ªát Nam ho√†n to√†n kh√°c v·ªõi th·ªùi ti·∫øt ·ªü London.",
                why: "C·∫•u tr√∫c: 'be different from something' (kh√°c v·ªõi c√°i g√¨)."
            },
            {
                num: 49,
                q: "He is ________ about his sister's performance because she was sick. (anxiety)",
                options: ["anxious", "anxiety", "anxiously", "anxiousness"],
                correct: "anxious",
                analysis: [
                    "A. anxious (adj): lo l·∫Øng",
                    "B. anxiety (n): s·ª± lo l·∫Øng",
                    "C. anxiously (adv): m·ªôt c√°ch lo l·∫Øng",
                    "D. anxiousness (n): n·ªói lo"
                ],
                translation: "Anh ·∫•y lo l·∫Øng v·ªÅ ph·∫ßn tr√¨nh di·ªÖn c·ªßa em g√°i.",
                why: "C·∫•u tr√∫c: 'be anxious about something' (lo l·∫Øng v·ªÅ ƒëi·ªÅu g√¨)."
            },
            {
                num: 50,
                q: "You can't use this library card anymore until you have ________ it. (NEW)",
                options: ["renewed", "renew", "new", "news"],
                correct: "renewed",
                analysis: [
                    "A. renewed (v-p2): ƒë√£ gia h·∫°n",
                    "B. renew (v): gia h·∫°n",
                    "C. new (adj): m·ªõi",
                    "D. news (n): tin t·ª©c"
                ],
                translation: "B·∫°n kh√¥ng th·ªÉ d√πng th·∫ª th∆∞ vi·ªán cho t·ªõi khi b·∫°n gia h·∫°n n√≥.",
                why: "Th√¨ Hi·ªán t·∫°i ho√†n th√†nh: 'have + V3/ed'. Gia h·∫°n th·∫ª l√† 'renew', d·∫°ng qu√° kh·ª© ph√¢n t·ª´ l√† 'renewed'."
            }
        ];

        let currentQ = 0;
        let score = 0;
        let isAnswered = false;
        let soundEnabled = true;

        // Shuffle logic
        const shuffledQuiz = [...quizData].sort(() => Math.random() - 0.5);
        shuffledQuiz.forEach(item => {
            item.options = [...item.options].sort(() => Math.random() - 0.5);
        });

        // Audio Context for Gamification sounds
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (!soundEnabled) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); // A5
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(110, audioCtx.currentTime); // A2
                osc.frequency.linearRampToValueAtTime(55, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.querySelector('.sound-toggle').innerText = soundEnabled ? 'üîä' : 'üîà';
        }

        function loadQuestion() {
            isAnswered = false;
            const data = shuffledQuiz[currentQ];
            document.getElementById('current-q-num').innerText = currentQ + 1;
            document.getElementById('progress-fill').style.width = `${((currentQ) / shuffledQuiz.length) * 100}%`;
            
            // Format question text
            const formattedQ = data.q.replace(/\((.*?)\)/, '<span class="word-clue">($1)</span>');
            document.getElementById('question-text').innerHTML = formattedQ;
            
            const optionsGrid = document.getElementById('options-grid');
            optionsGrid.innerHTML = '';
            
            data.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                optionsGrid.appendChild(btn);
            });

            document.getElementById('explanation-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('quiz-card').classList.remove('shake');
        }

        function checkAnswer(selected, btn) {
            if (isAnswered) return;
            isAnswered = true;
            
            const data = shuffledQuiz[currentQ];
            const explanationBox = document.getElementById('explanation-box');
            
            // Mark correct/wrong
            if (selected === data.correct) {
                btn.classList.add('correct');
                score++;
                playSound('correct');
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8854C0', '#00C9A7', '#FFD700']
                });
            } else {
                btn.classList.add('wrong');
                document.getElementById('quiz-card').classList.add('shake');
                playSound('wrong');
                // Highlight the correct one
                Array.from(document.querySelectorAll('.option-btn')).forEach(b => {
                    if (b.innerText === data.correct) b.classList.add('correct');
                });
            }

            // Show explanation
            explanationBox.innerHTML = `
                <h3>C√¥ Mai An gi·∫£i th√≠ch:</h3>
                <p><strong>1. Ph√¢n t√≠ch 4 ƒë√°p √°n:</strong></p>
                ${data.analysis.map(line => `<p style="margin-left: 10px;">‚Ä¢ ${line}</p>`).join('')}
                <p><strong>2. D·ªãch nghƒ©a:</strong> "${data.translation}"</p>
                <p><strong>3. T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</strong> ${data.why}</p>
            `;
            explanationBox.style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // Scroll to explanation
            setTimeout(() => {
                explanationBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ < shuffledQuiz.length) {
                loadQuestion();
            } else {
                showSummary();
            }
        }

        function showSummary() {
            document.getElementById('summary-overlay').style.display = 'flex';
            document.getElementById('final-score').innerText = `${score}/${shuffledQuiz.length}`;
            
            let msg = "";
            const percent = (score / shuffledQuiz.length) * 100;
            if (percent === 100) msg = "SI√äU ƒê·ªàNH! B·∫°n l√† thi√™n t√†i Word Form r·ªìi ƒë·∫•y! üåü";
            else if (percent >= 80) msg = "Tuy·ªát v·ªùi! Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t v·ªØng ch·∫Øc. üî•";
            else if (percent >= 50) msg = "Kh√° t·ªët! H√£y √¥n l·∫°i c√°c l·ªói sai m·ªôt ch√∫t nh√©. üëç";
            else msg = "ƒê·ª´ng n·∫£n ch√≠! ƒê·ªçc k·ªπ gi·∫£i th√≠ch c·ªßa c√¥ ƒë·ªÉ ti·∫øn b·ªô h∆°n nh√©. üí™";
            
            document.getElementById('final-msg').innerText = msg;
        }

        // Init
        window.onload = loadQuestion;
    </script>
</body>
</html>
