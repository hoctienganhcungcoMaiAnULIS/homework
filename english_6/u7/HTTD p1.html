<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán t·∫≠p HTTD - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #8854C0;
            --secondary-color: #00C9A7;
            --correct-color: #00D26A;
            --wrong-color: #FF4757;
            --bg-color: #f0f4f8;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 0.5px, transparent 0.5px), radial-gradient(#8854c0 0.5px, #f0f4f8 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .teacher-name {
            font-size: 0.9rem;
            color: var(--primary-color);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin: 0;
            text-shadow: 2px 2px 0px white;
        }

        .quiz-container {
            width: 100%;
            max-width: 600px;
            perspective: 1000px;
        }

        .card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1);
            border: 4px solid #fff;
            position: relative;
            transition: transform 0.3s ease;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e0e0e0;
            padding: 15px 20px;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 0 #e0e0e0;
            text-align: left;
            position: relative;
            outline: none;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-color);
            background-color: #f9f7ff;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #e0e0e0;
        }

        .option-btn.correct {
            background-color: var(--correct-color) !important;
            border-color: #00b35a !important;
            color: white !important;
            box-shadow: 0 5px 0 #00b35a !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color) !important;
            border-color: #e63946 !important;
            color: white !important;
            box-shadow: 0 5px 0 #e63946 !important;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            padding: 20px;
            background: #fff8e1;
            border-radius: 15px;
            border-left: 6px solid #ffca28;
            display: none;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation-box h4 {
            margin: 0 0 10px 0;
            color: #f57c00;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation-content {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .next-btn {
            margin-top: 20px;
            width: 100%;
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 5px 0 #00a88b;
            display: none;
        }

        .next-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #00a88b;
        }

        /* Shake animation for wrong answer */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake { animation: shake 0.3s ease-in-out 2; }

        /* Final Result Popup */
        #result-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 8px solid #f0f0f0;
        }

        .comment {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .restart-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
        }

        /* Q29 & Q30 Special Styles */
        .sale-sign {
            background: #ff4757;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 900;
            border: 3px dashed white;
            margin-bottom: 10px;
            border-radius: 10px;
        }

        .phone-msg {
            background: #e1ffc7;
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
            margin: 10px 0;
            border: 1px solid #c5e1a5;
            align-self: flex-start;
            max-width: 80%;
            font-style: italic;
        }
    </style>
</head>
<body>

    <header>
        <div class="teacher-name">Gi√°o vi√™n: Ms Mai An ULIS</div>
        <h1>‚ú® Th√¨ Hi·ªán T·∫°i Ti·∫øp Di·ªÖn ‚ú®</h1>
    </header>

    <div class="quiz-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="card" id="quizCard">
            <div id="questionContainer">
                <div class="question-text" id="questionText">ƒêang t·∫£i c√¢u h·ªèi...</div>
                <div class="options-grid" id="optionsGrid"></div>
            </div>

            <div class="explanation-box" id="explanationBox">
                <h4><span id="explIcon">üí°</span> C√¥ Mai An gi·∫£i th√≠ch:</h4>
                <div class="explanation-content" id="explanationText"></div>
            </div>

            <button class="next-btn" id="nextBtn" onclick="nextQuestion()">C√ÇU TI·∫æP THEO ‚ûú</button>
        </div>
    </div>

    <div id="result-overlay">
        <div class="result-card">
            <div class="score-circle" id="finalScore">0/30</div>
            <div class="comment" id="finalComment">Tuy·ªát v·ªùi!</div>
            <p id="finalStats"></p>
            <button class="restart-btn" onclick="location.reload()">L√ÄM L·∫†I B√ÄI</button>
        </div>
    </div>

    <!-- Audio Effects -->
    <audio id="sndCorrect" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sndWrong" src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"></audio>

    <script>
        const quizData = [
            {
                q: "Look! The bus __________.",
                options: ["come", "is coming", "coming", "are coming"],
                correct: 1,
                analyze: [
                    "come (v): ƒë·∫øn (nguy√™n th·ªÉ)",
                    "is coming (v): ƒëang ƒë·∫øn (HTTD s·ªë √≠t)",
                    "coming (v-ing): ƒëang ƒë·∫øn (thi·∫øu tobe)",
                    "are coming (v): ƒëang ƒë·∫øn (HTTD s·ªë nhi·ªÅu)"
                ],
                translation: "Nh√¨n k√¨a! Xe bu√Ωt ƒëang ƒë·∫øn.",
                whyCorrect: "D·∫•u hi·ªáu 'Look!' (Nh√¨n k√¨a!) b√°o hi·ªáu h√†nh ƒë·ªông ƒëang x·∫£y ra ngay l√∫c n√≥i. Ch·ªß ng·ªØ 'The bus' l√† danh t·ª´ s·ªë √≠t n√™n ta d√πng 'is + V-ing'.",
                whyWrong: "Lo·∫°i A v√¨ l√† hi·ªán t·∫°i ƒë∆°n. Lo·∫°i C v√¨ thi·∫øu ƒë·ªông t·ª´ 'be'. Lo·∫°i D v√¨ 'are' ch·ªâ d√πng cho s·ªë nhi·ªÅu."
            },
            {
                q: "My friends __________ football in the playground now.",
                options: ["is playing", "are playing", "play", "plays"],
                correct: 1,
                analyze: [
                    "is playing (v): ƒëang ch∆°i (s·ªë √≠t)",
                    "are playing (v): ƒëang ch∆°i (s·ªë nhi·ªÅu)",
                    "play (v): ch∆°i (nguy√™n th·ªÉ)",
                    "plays (v): ch∆°i (s·ªë √≠t)"
                ],
                translation: "C√°c b·∫°n c·ªßa t·ªõ ƒëang ch∆°i b√≥ng ƒë√° ·ªü s√¢n ch∆°i b√¢y gi·ªù.",
                whyCorrect: "D·∫•u hi·ªáu 'now' (b√¢y gi·ªù) y√™u c·∫ßu th√¨ HTTD. Ch·ªß ng·ªØ 'My friends' c√≥ ƒëu√¥i -s l√† s·ªë nhi·ªÅu, n√™n ƒëi v·ªõi 'are + playing'.",
                whyWrong: "Lo·∫°i A v√¨ d√πng 'is' cho s·ªë nhi·ªÅu l√† sai. Lo·∫°i C v√† D l√† th√¨ hi·ªán t·∫°i ƒë∆°n."
            },
            {
                q: "We __________ our school uniforms today.",
                options: ["aren't wearing", "isn't wearing", "don't wear", "not wearing"],
                correct: 0,
                analyze: [
                    "aren't wearing (v): kh√¥ng ƒëang m·∫∑c (s·ªë nhi·ªÅu)",
                    "isn't wearing (v): kh√¥ng ƒëang m·∫∑c (s·ªë √≠t)",
                    "don't wear (v): kh√¥ng m·∫∑c (hi·ªán t·∫°i ƒë∆°n)",
                    "not wearing: thi·∫øu ƒë·ªông t·ª´ tobe"
                ],
                translation: "H√¥m nay ch√∫ng t·ªõ kh√¥ng m·∫∑c ƒë·ªìng ph·ª•c tr∆∞·ªùng.",
                whyCorrect: "D·∫•u hi·ªáu 'today' trong c√¢u n√†y nh·∫•n m·∫°nh m·ªôt s·ª± vi·ªác t·∫°m th·ªùi kh√°c v·ªõi th∆∞·ªùng ng√†y. Ch·ªß ng·ªØ 'We' (ch√∫ng t√¥i) ƒëi v·ªõi 'are not' vi·∫øt t·∫Øt l√† 'aren't'.",
                whyWrong: "Lo·∫°i B v√¨ 'isn't' d√πng cho s·ªë √≠t. Lo·∫°i C l√† hi·ªán t·∫°i ƒë∆°n ch·ªâ th√≥i quen l√¢u d√†i. Lo·∫°i D thi·∫øu 'are'."
            },
            {
                q: "Be quiet! The baby __________.",
                options: ["sleeps", "is sleeping", "are sleeping", "sleeping"],
                correct: 1,
                analyze: [
                    "sleeps (v): ng·ªß (s·ªë √≠t)",
                    "is sleeping (v): ƒëang ng·ªß (s·ªë √≠t)",
                    "are sleeping (v): ƒëang ng·ªß (s·ªë nhi·ªÅu)",
                    "sleeping: thi·∫øu tobe"
                ],
                translation: "Tr·∫≠t t·ª± n√†o! Em b√© ƒëang ng·ªß.",
                whyCorrect: "M·ªánh l·ªánh 'Be quiet!' cho bi·∫øt h√†nh ƒë·ªông ƒëang di·ªÖn ra. 'The baby' l√† 1 em b√© (s·ªë √≠t) n√™n ch·ªçn 'is sleeping'.",
                whyWrong: "A l√† hi·ªán t·∫°i ƒë∆°n. C sai s·ª± h√≤a h·ª£p ch·ªß v·ªã. D thi·∫øu 'is'."
            },
            {
                q: "__________ you __________ your homework right now?",
                options: ["Do / do", "Are / do", "Are / doing", "Is / doing"],
                correct: 2,
                analyze: [
                    "Do / do: Tr·ª£ ƒë·ªông t·ª´ hi·ªán t·∫°i ƒë∆°n",
                    "Are / do: Sai c·∫•u tr√∫c (Are kh√¥ng ƒëi v·ªõi V nguy√™n th·ªÉ)",
                    "Are / doing: ƒêang l√†m (HTTD nghi v·∫•n)",
                    "Is / doing: Sai tobe v·ªõi ch·ªß ng·ªØ 'you'"
                ],
                translation: "B·∫°n ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√† ngay b√¢y gi·ªù ph·∫£i kh√¥ng?",
                whyCorrect: "D·∫•u hi·ªáu 'right now'. C√¢u h·ªèi HTTD c√≥ d·∫°ng: Am/Is/Are + S + V-ing? Ch·ªß ng·ªØ 'you' lu√¥n ƒëi v·ªõi 'Are'.",
                whyWrong: "A d√πng sai th√¨. B sai c·∫•u tr√∫c ng·ªØ ph√°p. D sai 'is' cho 'you'."
            },
            {
                q: "Nam and Ba __________ lunch in the canteen at the moment.",
                options: ["is having", "are having", "having", "are haveing"],
                correct: 1,
                analyze: [
                    "is having (v): ƒëang ƒÉn (s·ªë √≠t)",
                    "are having (v): ƒëang ƒÉn (s·ªë nhi·ªÅu)",
                    "having: thi·∫øu tobe",
                    "are haveing: sai ch√≠nh t·∫£"
                ],
                translation: "Nam v√† Ba ƒëang ƒÉn tr∆∞a ·ªü cƒÉng tin l√∫c n√†y.",
                whyCorrect: "Ch·ªß ng·ªØ 'Nam and Ba' l√† 2 ng∆∞·ªùi (s·ªë nhi·ªÅu) n√™n d√πng 'are having'. L∆∞u √Ω 'have' b·ªè 'e' th√™m 'ing'.",
                whyWrong: "D sai ch√≠nh t·∫£ nghi√™m tr·ªçng, quy t·∫Øc l√† b·ªè 'e' r·ªìi m·ªõi th√™m 'ing'."
            },
            {
                q: "What __________ she __________?",
                options: ["is / cooking", "are / cooking", "does / cook", "is / cook"],
                correct: 0,
                analyze: [
                    "is / cooking: ƒëang n·∫•u (s·ªë √≠t)",
                    "are / cooking: ƒëang n·∫•u (s·ªë nhi·ªÅu)",
                    "does / cook: hi·ªán t·∫°i ƒë∆°n",
                    "is / cook: sai c·∫•u tr√∫c"
                ],
                translation: "C√¥ ·∫•y ƒëang n·∫•u m√≥n g√¨ v·∫≠y?",
                whyCorrect: "C·∫•u tr√∫c c√¢u h·ªèi Wh-word: Wh- + is + she + V-ing? Ph√π h·ª£p ƒë·ªÉ h·ªèi v·ªÅ h√†nh ƒë·ªông ƒëang l√†m.",
                whyWrong: "B sai tobe. C h·ªèi v·ªÅ s·ª± th·∫≠t hi·ªÉn nhi√™n. D thi·∫øu 'ing'."
            },
            {
                q: "I __________ a book. I __________ to music.",
                options: ["am not reading / listening", "am not reading / am listening", "don't read / am listening", "not reading / listening"],
                correct: 1,
                analyze: [
                    "am not reading / listening: v·∫ø sau thi·∫øu tobe",
                    "am not reading / am listening: ƒë√∫ng c·∫•u tr√∫c",
                    "don't read / am listening: sai th√¨ v·∫ø ƒë·∫ßu",
                    "not reading / listening: thi·∫øu tobe c·∫£ 2 v·∫ø"
                ],
                translation: "T·ªõ ƒëang kh√¥ng ƒë·ªçc s√°ch. T·ªõ ƒëang nghe nh·∫°c.",
                whyCorrect: "C·∫£ hai v·∫ø ƒë·ªÅu di·ªÖn t·∫£ tr·∫°ng th√°i ƒëang x·∫£y ra v·ªõi ch·ªß ng·ªØ 'I' n√™n c·∫ßn 'am (not) + V-ing'.",
                whyWrong: "C√°c ph∆∞∆°ng √°n kh√°c ƒë·ªÅu thi·∫øu th√†nh ph·∫ßn quan tr·ªçng c·ªßa th√¨ ti·∫øp di·ªÖn."
            },
            {
                q: "My sister is in her room. She __________ a letter.",
                options: ["writes", "writing", "is writting", "is writing"],
                correct: 3,
                analyze: [
                    "writes (v): vi·∫øt (s·ªë √≠t)",
                    "writing: thi·∫øu tobe",
                    "is writting: sai ch√≠nh t·∫£",
                    "is writing: ƒëang vi·∫øt"
                ],
                translation: "Ch·ªã t·ªõ ƒëang ·ªü trong ph√≤ng. Ch·ªã ·∫•y ƒëang vi·∫øt m·ªôt l√° th∆∞.",
                whyCorrect: "Ng·ªØ c·∫£nh 'is in her room' ng·ª• √Ω ch·ªã ·∫•y ƒëang th·ª±c hi·ªán h√†nh ƒë·ªông ƒë√≥ ngay b√¢y gi·ªù. Write -> writing (b·ªè e).",
                whyWrong: "C b·ªã b·∫´y g·∫•p ƒë√¥i ph·ª• √¢m 't' l√† sai, 'write' ch·ªâ c√≥ 1 ch·ªØ 't' n√™n kh√¥ng g·∫•p ƒë√¥i."
            },
            {
                q: "Where are the students? - They __________ in the library.",
                options: ["reading", "is reading", "are reading", "read"],
                correct: 2,
                analyze: [
                    "reading: thi·∫øu tobe",
                    "is reading: sai tobe",
                    "are reading: ƒëang ƒë·ªçc",
                    "read: hi·ªán t·∫°i ƒë∆°n"
                ],
                translation: "C√°c b·∫°n h·ªçc sinh ƒë√¢u r·ªìi? - H·ªç ƒëang ƒë·ªçc s√°ch trong th∆∞ vi·ªán.",
                whyCorrect: "C√¢u h·ªèi 'Where are...' ƒëang t√¨m ng∆∞·ªùi ·ªü th·ªùi ƒëi·ªÉm hi·ªán t·∫°i, n√™n c√¢u tr·∫£ l·ªùi d√πng HTTD. 'They' ƒëi v·ªõi 'are'.",
                whyWrong: "A, B, D sai v·ªÅ m·∫∑t ng·ªØ ph√°p v√† s·ª± h√≤a h·ª£p ch·ªß v·ªã."
            },
            {
                q: "Keep silent! The teacher __________.",
                options: ["is talkking", "talking", "is talking", "are talking"],
                correct: 2,
                analyze: [
                    "is talkking: sai ch√≠nh t·∫£",
                    "talking: thi·∫øu tobe",
                    "is talking: ƒëang n√≥i",
                    "are talking: sai tobe"
                ],
                translation: "Gi·ªØ y√™n l·∫∑ng n√†o! Gi√°o vi√™n ƒëang n√≥i.",
                whyCorrect: "M·ªánh l·ªánh 'Keep silent!' l√† d·∫•u hi·ªáu. 'The teacher' s·ªë √≠t ƒëi v·ªõi 'is talking'.",
                whyWrong: "A sai ch√≠nh t·∫£ v√¨ 'talk' k·∫øt th√∫c b·∫±ng 2 ph·ª• √¢m 'lk' n√™n kh√¥ng g·∫•p ƒë√¥i ch·ªØ 'k'."
            },
            {
                q: "Is he playing badminton? - No, __________.",
                options: ["he is", "he isn't", "he not", "he doesn't"],
                correct: 1,
                analyze: [
                    "he is: v√¢ng ƒë√∫ng v·∫≠y",
                    "he isn't: kh√¥ng ph·∫£i",
                    "he not: sai c·∫•u tr√∫c",
                    "he doesn't: sai tr·ª£ ƒë·ªông t·ª´"
                ],
                translation: "Anh ·∫•y ƒëang ch∆°i c·∫ßu l√¥ng ph·∫£i kh√¥ng? - Kh√¥ng, kh√¥ng ph·∫£i.",
                whyCorrect: "C√¢u tr·∫£ l·ªùi ng·∫Øn cho c√¢u h·ªèi 'Is he...?' l√† 'Yes, he is' ho·∫∑c 'No, he isn't'.",
                whyWrong: "D l√† tr·ª£ ƒë·ªông t·ª´ c·ªßa hi·ªán t·∫°i ƒë∆°n, kh√¥ng d√πng cho c√¢u h·ªèi v·ªõi 'is'."
            },
            {
                q: "They __________ in the pool right now.",
                options: ["are swiming", "are swimming", "is swimming", "swimming"],
                correct: 1,
                analyze: [
                    "are swiming: sai ch√≠nh t·∫£",
                    "are swimming: ƒëang b∆°i",
                    "is swimming: sai tobe",
                    "swimming: thi·∫øu tobe"
                ],
                translation: "H·ªç ƒëang b∆°i trong b·ªÉ b∆°i ngay l√∫c n√†y.",
                whyCorrect: "ƒê·ªông t·ª´ 'swim' c√≥ quy t·∫Øc: 1 √¢m ti·∫øt, k·∫øt th√∫c b·∫±ng 1 nguy√™n √¢m + 1 ph·ª• √¢m -> g·∫•p ƒë√¥i ph·ª• √¢m cu·ªëi 'm' th√†nh 'swimming'.",
                whyWrong: "A sai ch√≠nh t·∫£ v√¨ thi·∫øu m·ªôt ch·ªØ 'm'. C sai tobe cho ch·ªß ng·ªØ 'They'."
            },
            {
                q: "__________ Lan and Mai __________ to school by bike?",
                options: ["Is / going", "Do / go", "Are / going", "Are / go"],
                correct: 2,
                analyze: [
                    "Is / going: sai tobe",
                    "Do / go: hi·ªán t·∫°i ƒë∆°n",
                    "Are / going: ƒëang ƒëi",
                    "Are / go: thi·∫øu -ing"
                ],
                translation: "Lan v√† Mai ƒëang ƒëi xe ƒë·∫°p ƒë·∫øn tr∆∞·ªùng ph·∫£i kh√¥ng?",
                whyCorrect: "Ch·ªß ng·ªØ l√† 2 ng∆∞·ªùi (s·ªë nhi·ªÅu) n√™n d√πng 'Are'. ƒê·ªông t·ª´ ph·∫£i th√™m -ing.",
                whyWrong: "B h·ªèi v·ªÅ th√≥i quen, kh√¥ng ph√π h·ª£p ng·ªØ c·∫£nh b√†i t·∫≠p n√†y. D thi·∫øu 'ing'."
            },
            {
                q: "Listen! Someone __________ the piano.",
                options: ["is playing", "are playing", "play", "plays"],
                correct: 0,
                analyze: [
                    "is playing: ƒëang ch∆°i (s·ªë √≠t)",
                    "are playing: ƒëang ch∆°i (s·ªë nhi·ªÅu)",
                    "play: nguy√™n th·ªÉ",
                    "plays: s·ªë √≠t"
                ],
                translation: "Nghe k√¨a! Ai ƒë√≥ ƒëang ch∆°i ƒë√†n piano.",
                whyCorrect: "D·∫•u hi·ªáu 'Listen!'. ƒê·∫°i t·ª´ b·∫•t ƒë·ªãnh 'Someone' lu√¥n ƒë∆∞·ª£c coi l√† ng√¥i th·ª© 3 s·ªë √≠t (gi·ªëng He/She/It) n√™n d√πng 'is'.",
                whyWrong: "B sai v√¨ 'Someone' kh√¥ng ƒëi v·ªõi 'are'. C, D sai th√¨."
            },
            {
                q: "My father is in the garden. He __________ flowers.",
                options: ["planting", "is planting", "plants", "are planting"],
                correct: 1,
                analyze: [
                    "planting: thi·∫øu tobe",
                    "is planting: ƒëang tr·ªìng",
                    "plants: hi·ªán t·∫°i ƒë∆°n",
                    "are planting: sai tobe"
                ],
                translation: "B·ªë t·ªõ ƒëang ·ªü ngo√†i v∆∞·ªùn. √îng ·∫•y ƒëang tr·ªìng hoa.",
                whyCorrect: "C√¢u ƒë·∫ßu ti√™n gi·ªõi thi·ªáu v·ªã tr√≠ hi·ªán t·∫°i c·ªßa b·ªë, suy ra h√†nh ƒë·ªông tr·ªìng hoa ƒëang di·ªÖn ra.",
                whyWrong: "B·ªë l√† 'He' n√™n ph·∫£i c√≥ 'is' ƒëi k√®m 'planting'."
            },
            {
                q: "At present, they __________ a new project.",
                options: ["do", "doing", "are doing", "is doing"],
                correct: 2,
                analyze: [
                    "do: l√†m",
                    "doing: thi·∫øu tobe",
                    "are doing: ƒëang l√†m (s·ªë nhi·ªÅu)",
                    "is doing: ƒëang l√†m (s·ªë √≠t)"
                ],
                translation: "Hi·ªán t·∫°i, h·ªç ƒëang th·ª±c hi·ªán m·ªôt d·ª± √°n m·ªõi.",
                whyCorrect: "C·ª•m 'At present' = 'Now'. Ch·ªß ng·ªØ 'They' ƒëi v·ªõi 'are doing'.",
                whyWrong: "A, B, D sai v·ªÅ th√¨ ho·∫∑c s·ª± h√≤a h·ª£p ch·ªß v·ªã."
            },
            {
                q: "Who __________ she __________ to?",
                options: ["is / talk", "are / talking", "does / talk", "is / talking"],
                correct: 3,
                analyze: [
                    "is / talk: thi·∫øu -ing",
                    "are / talking: sai tobe",
                    "does / talk: hi·ªán t·∫°i ƒë∆°n",
                    "is / talking: ƒëang n√≥i chuy·ªán"
                ],
                translation: "C√¥ ·∫•y ƒëang n√≥i chuy·ªán v·ªõi ai th·∫ø?",
                whyCorrect: "C·∫•u tr√∫c Wh- + is + she + V-ing? d√πng ƒë·ªÉ h·ªèi v·ªÅ h√†nh ƒë·ªông ƒëang th·ª±c hi·ªán.",
                whyWrong: "B d√πng 'are' cho 'she' l√† sai. C kh√¥ng ph√π h·ª£p ng·ªØ c·∫£nh ti·∫øp di·ªÖn."
            },
            {
                q: "Look at the cat! It __________ the mouse.",
                options: ["chasing", "is chaseing", "is chasing", "are chasing"],
                correct: 2,
                analyze: [
                    "chasing: thi·∫øu tobe",
                    "is chaseing: sai ch√≠nh t·∫£",
                    "is chasing: ƒëang ƒëu·ªïi theo",
                    "are chasing: sai tobe"
                ],
                translation: "Nh√¨n con m√®o k√¨a! N√≥ ƒëang ƒëu·ªïi b·∫Øt con chu·ªôt.",
                whyCorrect: "H√†nh ƒë·ªông 'Look at...' h∆∞·ªõng s·ª± ch√∫ √Ω v√†o vi·ªác ƒëang di·ªÖn ra. Chase -> chasing (b·ªè e).",
                whyWrong: "B sai ch√≠nh t·∫£ v√¨ ch∆∞a b·ªè 'e' tr∆∞·ªõc khi th√™m 'ing'. D sai tobe cho 'It'."
            },
            {
                q: "My brother __________ TV right now. He is doing his homework.",
                options: ["isn't watching", "is watching", "not watching", "doesn't watch"],
                correct: 0,
                analyze: [
                    "isn't watching: kh√¥ng ƒëang xem",
                    "is watching: ƒëang xem",
                    "not watching: thi·∫øu tobe",
                    "doesn't watch: hi·ªán t·∫°i ƒë∆°n"
                ],
                translation: "Em trai t·ªõ kh√¥ng ƒëang xem TV b√¢y gi·ªù. Em ·∫•y ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√†.",
                whyCorrect: "V·∫ø sau kh·∫≥ng ƒë·ªãnh ƒëang l√†m b√†i t·∫≠p, n√™n v·∫ø ƒë·∫ßu ph·∫£i ph·ªß ƒë·ªãnh h√†nh ƒë·ªông xem TV. 'My brother' s·ªë √≠t d√πng 'isn't'.",
                whyWrong: "B sai v·ªÅ m·∫∑t logic ng·ªØ nghƒ©a c·ªßa c√¢u."
            },
            {
                q: "What __________ you __________?",
                options: ["are / study", "are / studying", "do / study", "is / studying"],
                correct: 1,
                analyze: [
                    "are / study: thi·∫øu -ing",
                    "are / studying: ƒëang h·ªçc",
                    "do / study: hi·ªán t·∫°i ƒë∆°n",
                    "is / studying: sai tobe"
                ],
                translation: "B·∫°n ƒëang h·ªçc g√¨ v·∫≠y?",
                whyCorrect: "C√¢u h·ªèi v·ªÅ h√†nh ƒë·ªông hi·ªán t·∫°i v·ªõi 'you' ph·∫£i d√πng 'are' v√† 'V-ing'.",
                whyWrong: "C h·ªèi v·ªÅ th√≥i quen h·ªçc t·∫≠p chung chung. D sai tobe cho 'you'."
            },
            {
                q: "They __________ (not work) in the office at the moment.",
                options: ["isn't working", "aren't working", "not working", "don't working"],
                correct: 1,
                analyze: [
                    "isn't working: sai tobe",
                    "aren't working: kh√¥ng ƒëang l√†m vi·ªác",
                    "not working: thi·∫øu tobe",
                    "don't working: sai c·∫•u tr√∫c"
                ],
                translation: "H·ªç kh√¥ng ƒëang l√†m vi·ªác t·∫°i vƒÉn ph√≤ng v√†o l√∫c n√†y.",
                whyCorrect: "D·∫•u hi·ªáu 'at the moment'. Ph·ªß ƒë·ªãnh s·ªë nhi·ªÅu: S + are not (aren't) + V-ing.",
                whyWrong: "D sai v√¨ 'don't' kh√¥ng bao gi·ªù ƒëi k√®m tr·ª±c ti·∫øp v·ªõi V-ing."
            },
            {
                q: "Is your mother cooking dinner? - __________.",
                options: ["Yes, she does.", "Yes, she is.", "Yes, she cooking.", "No, she is."],
                correct: 1,
                analyze: [
                    "Yes, she does: sai tr·ª£ t·ª´",
                    "Yes, she is: v√¢ng, ƒë√∫ng v·∫≠y",
                    "Yes, she cooking: thi·∫øu tobe",
                    "No, she is: m√¢u thu·∫´n No/is"
                ],
                translation: "M·∫π b·∫°n ƒëang n·∫•u b·ªØa t·ªëi h·∫£? - V√¢ng, ƒë√∫ng r·ªìi.",
                whyCorrect: "Tr·∫£ l·ªùi ng·∫Øn cho c√¢u h·ªèi 'Is + S...?' l√† 'Yes, S + is'.",
                whyWrong: "A l√† c√¢u tr·∫£ l·ªùi c·ªßa th√¨ hi·ªán t·∫°i ƒë∆°n."
            },
            {
                q: "The children __________ in the park.",
                options: ["is skipping", "are skiping", "are skipping", "skipping"],
                correct: 2,
                analyze: [
                    "is skipping: sai tobe",
                    "are skiping: sai ch√≠nh t·∫£",
                    "are skipping: ƒëang nh·∫£y d√¢y",
                    "skipping: thi·∫øu tobe"
                ],
                translation: "B·ªçn tr·∫ª ƒëang nh·∫£y d√¢y ·ªü c√¥ng vi√™n.",
                whyCorrect: "Children l√† s·ªë nhi·ªÅu. Skip -> skipping (g·∫•p ƒë√¥i ph·ª• √¢m cu·ªëi 'p' v√¨ l√† t·ª´ 1 √¢m ti·∫øt c√≥ c·∫•u tr√∫c Ph·ª•-Nguy√™n-Ph·ª•).",
                whyWrong: "B sai ch√≠nh t·∫£ do thi·∫øu m·ªôt ch·ªØ 'p'. A sai tobe."
            },
            {
                q: "Hurry up! The train __________.",
                options: ["leave", "is leaving", "is leavving", "are leaving"],
                correct: 1,
                analyze: [
                    "leave: r·ªùi ƒëi",
                    "is leaving: ƒëang r·ªùi ƒëi",
                    "is leavving: sai ch√≠nh t·∫£",
                    "are leaving: sai tobe"
                ],
                translation: "Nhanh l√™n! T√†u ƒëang r·ªùi b√°nh r·ªìi.",
                whyCorrect: "Hurry up! cho th·∫•y s·ª± kh·∫©n c·∫•p c·ªßa h√†nh ƒë·ªông ƒëang di·ªÖn ra. Leave -> leaving (b·ªè e).",
                whyWrong: "C sai ch√≠nh t·∫£ do g·∫•p ƒë√¥i 'v' v√¥ l√Ω. D sai tobe cho 'The train'."
            },
            {
                q: "We __________ English class right now.",
                options: ["are having", "is having", "having", "are haveing"],
                correct: 0,
                analyze: [
                    "are having: ƒëang c√≥/h·ªçc",
                    "is having: sai tobe",
                    "having: thi·∫øu tobe",
                    "are haveing: sai ch√≠nh t·∫£"
                ],
                translation: "Ch√∫ng t√¥i ƒëang c√≥ ti·∫øt h·ªçc Ti·∫øng Anh ngay b√¢y gi·ªù.",
                whyCorrect: "Right now y√™u c·∫ßu HTTD. We + are + having.",
                whyWrong: "Have k·∫øt th√∫c b·∫±ng 'e' n√™n ph·∫£i b·ªè 'e' r·ªìi m·ªõi th√™m 'ing'."
            },
            {
                q: "Where __________ your father __________?",
                options: ["is / working", "are / working", "does / work", "is / work"],
                correct: 0,
                analyze: [
                    "is / working: ƒëang l√†m vi·ªác",
                    "are / working: sai tobe",
                    "does / work: hi·ªán t·∫°i ƒë∆°n",
                    "is / work: thi·∫øu -ing"
                ],
                translation: "B·ªë b·∫°n ƒëang l√†m vi·ªác ·ªü ƒë√¢u v·∫≠y?",
                whyCorrect: "C√¢u h·ªèi v·ªÅ v·ªã tr√≠ l√†m vi·ªác t·∫°m th·ªùi ho·∫∑c ƒëang di·ªÖn ra. Your father (s·ªë √≠t) d√πng 'is'.",
                whyWrong: "B sai tobe. C h·ªèi v·ªÅ ngh·ªÅ nghi·ªáp/n∆°i l√†m c·ªë ƒë·ªãnh, nh∆∞ng HTTD v·∫´n l√† ∆∞u ti√™n trong b√†i n√†y."
            },
            {
                q: "I __________ to music, I‚Äôm doing my homework.",
                options: ["am not listening", "not listening", "don't listen", "am listening"],
                correct: 0,
                analyze: [
                    "am not listening: kh√¥ng ƒëang nghe",
                    "not listening: thi·∫øu tobe",
                    "don't listen: hi·ªán t·∫°i ƒë∆°n",
                    "am listening: ƒëang nghe"
                ],
                translation: "T·ªõ kh√¥ng ƒëang nghe nh·∫°c ƒë√¢u, t·ªõ ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√† m√†.",
                whyCorrect: "Ng·ªØ c·∫£nh ƒëang l√†m b√†i t·∫≠p cho th·∫•y ng∆∞·ªùi n√≥i ƒëang ph·ªß nh·∫≠n vi·ªác nghe nh·∫°c.",
                whyWrong: "D sai v·ªÅ nghƒ©a logic trong c√¢u."
            },
            {
                q: "Look! The dog __________ in the garden.",
                options: ["runing", "is running", "are running", "running"],
                correct: 1,
                analyze: [
                    "runing: sai ch√≠nh t·∫£",
                    "is running: ƒëang ch·∫°y",
                    "are running: sai tobe",
                    "running: thi·∫øu tobe"
                ],
                translation: "Nh√¨n k√¨a! Con ch√≥ ƒëang ch·∫°y trong v∆∞·ªùn.",
                whyCorrect: "Run -> running (g·∫•p ƒë√¥i ph·ª• √¢m cu·ªëi 'n'). The dog (s·ªë √≠t) d√πng 'is'.",
                whyWrong: "A sai ch√≠nh t·∫£ v√¨ t·ª´ 'run' ph·∫£i g·∫•p ƒë√¥i 'n'."
            },
            {
                q: "What __________ those students __________?",
                options: ["is / doing", "are / doing", "do / do", "are / do"],
                correct: 1,
                analyze: [
                    "is / doing: sai tobe",
                    "are / doing: ƒëang l√†m",
                    "do / do: hi·ªán t·∫°i ƒë∆°n",
                    "are / do: thi·∫øu -ing"
                ],
                translation: "Nh·ªØng h·ªçc sinh kia ƒëang l√†m g√¨ v·∫≠y?",
                whyCorrect: "Those students (nh·ªØng h·ªçc sinh kia) l√† s·ªë nhi·ªÅu n√™n d√πng 'are' v√† 'V-ing'.",
                whyWrong: "A sai tobe. D sai c·∫•u tr√∫c c√¢u ti·∫øp di·ªÖn."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let canAnswer = true;

        const questionText = document.getElementById('questionText');
        const optionsGrid = document.getElementById('optionsGrid');
        const explanationBox = document.getElementById('explanationBox');
        const explanationText = document.getElementById('explanationText');
        const nextBtn = document.getElementById('nextBtn');
        const progressFill = document.getElementById('progressFill');
        const sndCorrect = document.getElementById('sndCorrect');
        const sndWrong = document.getElementById('sndWrong');

        function loadQuestion() {
            canAnswer = true;
            nextBtn.style.display = 'none';
            explanationBox.style.display = 'none';
            
            const qData = quizData[currentQuestion];
            
            // Special styling for last few if needed
            let displayQ = qData.q;
            if (currentQuestion === 28) {
                displayQ = `<div class="sale-sign">SALE OFF 50%</div>` + displayQ;
            } else if (currentQuestion === 29) {
                displayQ = `<div class="phone-msg">Where are you?</div>` + displayQ;
            }

            questionText.innerHTML = `C√¢u ${currentQuestion + 1}: ${displayQ}`;
            optionsGrid.innerHTML = '';
            
            qData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = String.fromCharCode(65 + index) + '. ' + opt;
                btn.onclick = () => checkAnswer(index, btn);
                optionsGrid.appendChild(btn);
            });

            progressFill.style.width = `${(currentQuestion / quizData.length) * 100}%`;
        }

        function checkAnswer(idx, btn) {
            if (!canAnswer) return;
            canAnswer = false;

            const qData = quizData[currentQuestion];
            const isCorrect = idx === qData.correct;

            if (isCorrect) {
                score++;
                btn.classList.add('correct');
                sndCorrect.currentTime = 0;
                sndCorrect.play();
                triggerConfetti();
            } else {
                btn.classList.add('wrong');
                optionsGrid.children[qData.correct].classList.add('correct');
                document.getElementById('quizCard').classList.add('shake');
                setTimeout(() => document.getElementById('quizCard').classList.remove('shake'), 500);
                sndWrong.currentTime = 0;
                sndWrong.play();
            }

            showExplanation(qData, isCorrect);
            nextBtn.style.display = 'block';
        }

        function showExplanation(data, isCorrect) {
            explanationBox.style.display = 'block';
            document.getElementById('explIcon').innerText = isCorrect ? 'üéâ' : 'üí°';
            
            let html = `
                <p><strong>1. Ph√¢n t√≠ch 4 ƒë√°p √°n:</strong><br>
                ${data.analyze.map(item => '‚Ä¢ ' + item).join('<br>')}
                </p>
                <p><strong>2. D·ªãch nghƒ©a c√¢u:</strong><br>
                <em>"${data.translation}"</em></p>
                <p><strong>3. T·∫°i sao ch·ªçn ${String.fromCharCode(65 + data.correct)}?</strong><br>
                ${data.whyCorrect}</p>
                <p><strong>4. T·∫°i sao lo·∫°i c√°c ph∆∞∆°ng √°n kia?</strong><br>
                ${data.whyWrong}</p>
            `;
            explanationText.innerHTML = html;
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < quizData.length) {
                loadQuestion();
            } else {
                showFinalResult();
            }
        }

        function triggerConfetti() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#8854C0', '#00C9A7', '#FFD700']
            });
        }

        function showFinalResult() {
            document.getElementById('result-overlay').style.display = 'flex';
            document.getElementById('finalScore').innerText = `${score}/${quizData.length}`;
            
            let comment = "";
            const percent = (score / quizData.length) * 100;
            if (percent === 100) comment = "XU·∫§T S·∫ÆC! Em l√† thi√™n t√†i HTTD!";
            else if (percent >= 80) comment = "GI·ªéI QU√Å! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em!";
            else if (percent >= 50) comment = "C·ªê G·∫ÆNG L√äN! Em s·∫Øp l√†m ch·ªß ƒë∆∞·ª£c r·ªìi!";
            else comment = "ƒê·ª™NG BU·ªíN! H√£y l√†m l·∫°i ƒë·ªÉ nh·ªõ k·ªπ h∆°n nh√©!";
            
            document.getElementById('finalComment').innerText = comment;
            document.getElementById('finalStats').innerText = `Em ƒë√£ ho√†n th√†nh b√†i thi c·ªßa Ms Mai An ULIS v·ªõi t·ª∑ l·ªá ƒë√∫ng ${Math.round(percent)}%.`;
        }

        // Start Quiz
        window.onload = loadQuestion;
    </script>
</body>
</html>
