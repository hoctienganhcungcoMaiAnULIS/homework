<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - The Giant Piano Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dynamic Theme: Music/Piano */
            --primary-color: #6c5ce7; /* T√≠m s√°ng t·∫°o */
            --secondary-color: #a29bfe; /* T√≠m nh·∫°t */
            --accent-color: #ffeaa7; /* V√†ng nh·∫°t */
            --text-color: #2d3436;
            --success-color: #00b894; /* Xanh l√° */
            --error-color: #ff7675; /* ƒê·ªè cam */
            --card-bg: #ffffff;
            --font-main: 'Nunito', sans-serif;
        }

        /* SVG Background Generation using Data URI */
        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background-color: var(--secondary-color);
            /* SVG Background with Emojis: Piano, Note, Score */
            background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg opacity='0.1'%3E%3Ctext x='10' y='40' font-size='30'%3Eüéπ%3C/text%3E%3Ctext x='70' y='90' font-size='30'%3Eüéµ%3C/text%3E%3Ctext x='80' y='30' font-size='30'%3Eüéº%3C/text%3E%3C/g%3E%3C/svg%3E"), 
            radial-gradient(circle at center, #a29bfe 0%, #6c5ce7 100%);
            color: var(--text-color);
        }

        /* HEADER */
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            position: relative;
            height: 60px;
        }

        .teacher-brand {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .teacher-badge {
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        /* TIMER CONTROL */
        .timer-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #fff;
            padding: 5px 15px;
            border-radius: 30px;
            border: 2px solid var(--primary-color);
            box-shadow: 0 4px 0 var(--primary-color);
        }

        #timer-display {
            font-weight: 900;
            font-size: 1.2rem;
            color: var(--primary-color);
            font-family: 'Quicksand', sans-serif;
            min-width: 60px;
            text-align: center;
        }

        .control-btn {
            background: var(--accent-color);
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .control-btn:hover { transform: scale(1.1); }

        /* MAIN LAYOUT: SPLIT SCREEN */
        .main-container {
            display: flex;
            height: calc(100vh - 80px); /* Minus header */
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .panel {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-y: auto;
            padding: 25px;
            position: relative;
        }

        /* SCROLLBAR CUSTOMIZATION */
        .panel::-webkit-scrollbar { width: 8px; }
        .panel::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .panel::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 10px; }
        .panel::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* LEFT PANEL: READING */
        h1.title {
            color: var(--primary-color);
            font-family: 'Quicksand', sans-serif;
            text-align: center;
            margin-top: 0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .reading-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #444;
        }

        .gap-marker {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin: 0 5px;
            box-shadow: 0 3px 0 #4834d4;
        }

        .trans-btn {
            background: #dfe6e9;
            border: none;
            color: #636e72;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 5px;
            display: block;
            width: fit-content;
            transition: all 0.2s;
        }
        .trans-btn:hover { background: var(--primary-color); color: white; }

        .trans-content {
            display: none;
            background: #f0fdf4;
            padding: 10px;
            border-left: 4px solid var(--success-color);
            border-radius: 5px;
            margin-top: 5px;
            font-style: italic;
            color: #2d3436;
            font-size: 0.95rem;
        }

        /* GLOSSARY */
        .glossary-box {
            margin-top: 30px;
            border: 2px dashed var(--primary-color);
            border-radius: 15px;
            padding: 15px;
            background: #fdfbff;
        }
        .glossary-title {
            text-align: center;
            color: var(--primary-color);
            font-weight: 800;
            margin-bottom: 10px;
        }
        .gloss-table {
            width: 100%;
            border-collapse: collapse;
        }
        .gloss-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .word { font-weight: 700; color: #d63031; }
        .type { font-size: 0.8rem; color: #636e72; font-style: italic; background: #eee; padding: 2px 5px; border-radius: 4px;}

        /* RIGHT PANEL: EXERCISES */
        .question-card {
            background: #fff;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 25px;
            border: 1px solid #eee;
            position: relative;
        }

        .q-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .q-number {
            background: var(--primary-color);
            color: white;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: 900;
            box-shadow: 0 3px 0 #4834d4;
        }

        .options-grid {
            display: grid;
            gap: 10px;
        }

        /* GAMIFICATION BUTTONS */
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px 15px;
            border-radius: 12px;
            text-align: left;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #dcdcdc;
            color: #555;
        }

        .option-btn:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--primary-color);
        }

        .option-btn:active:not(.disabled) {
            top: 4px;
            box-shadow: 0 0 0 #dcdcdc;
        }

        /* STATE CLASSES */
        .option-btn.correct {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
            box-shadow: 0 4px 0 #009476;
        }
        
        .option-btn.wrong {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            box-shadow: 0 4px 0 #eb3b49;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* SUPPORT SECTION */
        .support-area {
            margin-top: 15px;
            display: none; /* Hidden initially */
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .teacher-feedback {
            background: #eef2ff;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--primary-color);
            margin-bottom: 10px;
        }
        
        .teacher-avatar {
            width: 40px; 
            height: 40px; 
            background: var(--primary-color); 
            border-radius: 50%; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            color: white;
            font-size: 20px;
            margin-right: 10px;
            float: left;
        }

        .support-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            color: white;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .action-btn:active { transform: translateY(3px); box-shadow: none; }
        
        .btn-explain { background: #6c5ce7; }
        .btn-translate { background: #0984e3; }
        .btn-paraphrase { background: #00b894; }

        .detail-content {
            margin-top: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
            border: 1px solid #ddd;
        }

        /* SUBMIT BUTTON */
        .submit-container {
            text-align: center;
            margin-top: 20px;
            padding-bottom: 40px;
        }
        .submit-btn {
            background: linear-gradient(to bottom, #fdcb6e, #e17055);
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #d35400, 0 10px 20px rgba(0,0,0,0.2);
            font-family: 'Quicksand', sans-serif;
            transition: all 0.2s;
        }
        .submit-btn:hover { transform: translateY(-3px); }
        .submit-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #d35400; }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
            animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--primary-color);
        }
        @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .score-big {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 3px 3px 0px #dfe6e9;
        }

        /* CONFETTI (Simple CSS) */
        .confetti-piece {
            position: absolute;
            width: 10px; height: 10px;
            background: #ffd300;
            top: 0;
            opacity: 0;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; height: auto; overflow-y: auto; }
            .panel { height: auto; overflow: visible; }
            header { flex-direction: column; height: auto; gap: 10px; }
        }
    </style>
</head>
<body>

<header>
    <div class="teacher-brand">
        <span>üë©‚Äçüè´ Ms Mai An ULIS</span>
        <span class="teacher-badge">Master of TESOL</span>
    </div>
    <div class="timer-container">
        <span style="font-size: 1.5rem;">‚è∞</span>
        <div id="timer-display">10:00</div>
        <button class="control-btn" id="timer-toggle" onclick="toggleTimer()">‚è∏</button>
    </div>
</header>

<div class="main-container">
    <div class="panel" id="reading-panel">
        <h1 class="title">The Giant Piano üéπ</h1>
        
        <div class="reading-content">
            <p>
                A young man in New Zealand recently became famous for making one of the largest pianos ever.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">M·ªôt thanh ni√™n tr·∫ª ·ªü New Zealand g·∫ßn ƒë√¢y ƒë√£ tr·ªü n√™n n·ªïi ti·∫øng v√¨ ch·∫ø t·∫°o ra m·ªôt trong nh·ªØng c√¢y ƒë√†n piano l·ªõn nh·∫•t t·ª´ tr∆∞·ªõc t·ªõi nay.</span>
            </p>

            <p>
                Adrian Mann, who now works as a professional piano builder, started building the piano when he was just 16 years old, and made many of the parts for it himself. The piano is 5.7 metres long and is very heavy. And the keyboard actually has keys that are a metre in length. <span class="gap-marker">1</span> But despite this difference in size, the instrument can still be played perfectly, thanks to Adrian‚Äôs hard work.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">Adrian Mann, ng∆∞·ªùi hi·ªán ƒëang l√†m vi·ªác nh∆∞ m·ªôt th·ª£ ch·∫ø t·∫°o piano chuy√™n nghi·ªáp, ƒë√£ b·∫Øt ƒë·∫ßu l√†m c√¢y ƒë√†n n√†y khi m·ªõi ch·ªâ 16 tu·ªïi, v√† t·ª± tay l√†m r·∫•t nhi·ªÅu b·ªô ph·∫≠n cho n√≥. C√¢y ƒë√†n d√†i 5.7 m√©t v√† r·∫•t n·∫∑ng. V√† b√†n ph√≠m th·ª±c s·ª± c√≥ c√°c ph√≠m d√†i t·ªõi m·ªôt m√©t. [1] Nh∆∞ng b·∫•t ch·∫•p s·ª± kh√°c bi·ªát v·ªÅ k√≠ch th∆∞·ªõc n√†y, nh·∫°c c·ª• v·∫´n c√≥ th·ªÉ ƒë∆∞·ª£c ch∆°i m·ªôt c√°ch ho√†n h·∫£o, nh·ªù v√†o s·ª± l√†m vi·ªác chƒÉm ch·ªâ c·ªßa Adrian.</span>
            </p>

            <p>
                <span class="gap-marker">2</span> In fact, the whole thing started when Adrian became interested in the materials used for the wires inside the piano. These create the notes when they‚Äôre hit.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">[2] Th·ª±c t·∫ø, to√†n b·ªô s·ª± vi·ªác b·∫Øt ƒë·∫ßu khi Adrian tr·ªü n√™n h·ª©ng th√∫ v·ªõi c√°c v·∫≠t li·ªáu ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m d√¢y ƒë√†n b√™n trong piano. Nh·ªØng d√¢y n√†y t·∫°o ra c√°c n·ªët nh·∫°c khi ch√∫ng ƒë∆∞·ª£c g√µ v√†o.</span>
            </p>

            <p>
                And he found that if the wires were really long, he could get an amazing sound. From there, he went on to build the whole piano.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">V√† anh ·∫•y ph√°t hi·ªán ra r·∫±ng n·∫øu d√¢y ƒë√†n th·ª±c s·ª± d√†i, anh ·∫•y c√≥ th·ªÉ t·∫°o ra √¢m thanh tuy·ªát v·ªùi. T·ª´ ƒë√≥, anh ·∫•y ti·∫øp t·ª•c ch·∫ø t·∫°o to√†n b·ªô c√¢y ƒë√†n.</span>
            </p>

            <p>
                The instrument was kept inside a church in his town for some time, before Adrian decided it was time to transfer the huge piano from the church to his workshop. <span class="gap-marker">3</span> So in the end, the fire service had to come and help take the instrument to its new home.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">Nh·∫°c c·ª• n√†y ƒë√£ ƒë∆∞·ª£c gi·ªØ b√™n trong m·ªôt nh√† th·ªù ·ªü th·ªã tr·∫•n c·ªßa anh ·∫•y m·ªôt th·ªùi gian, tr∆∞·ªõc khi Adrian quy·∫øt ƒë·ªãnh ƒë√£ ƒë·∫øn l√∫c chuy·ªÉn c√¢y ƒë√†n kh·ªïng l·ªì t·ª´ nh√† th·ªù v·ªÅ x∆∞·ªüng c·ªßa m√¨nh. [3] V√¨ v·∫≠y cu·ªëi c√πng, ƒë·ªôi c·ª©u h·ªèa ƒë√£ ph·∫£i ƒë·∫øn v√† gi√∫p ƒë∆∞a nh·∫°c c·ª• v·ªÅ nh√† m·ªõi c·ªßa n√≥.</span>
            </p>

            <p>
                Since the move, a lot of piano players have visited Adrian to try out the piano. But Adrian says that when they arrive, some people aren‚Äôt very positive about the piano.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">K·ªÉ t·ª´ khi di chuy·ªÉn, r·∫•t nhi·ªÅu ng∆∞·ªùi ch∆°i piano ƒë√£ ƒë·∫øn thƒÉm Adrian ƒë·ªÉ th·ª≠ c√¢y ƒë√†n. Nh∆∞ng Adrian n√≥i r·∫±ng khi h·ªç ƒë·∫øn, m·ªôt s·ªë ng∆∞·ªùi kh√¥ng c√≥ c√°i nh√¨n t√≠ch c·ª±c l·∫Øm v·ªÅ c√¢y ƒë√†n n√†y.</span>
            </p>

            <p>
                <span class="gap-marker">4</span> But actually, it always performs brilliantly. They soon discover that the piano can play a wide range of music, just like any normal piano.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">[4] Nh∆∞ng th·ª±c ra, n√≥ lu√¥n tr√¨nh di·ªÖn m·ªôt c√°ch xu·∫•t s·∫Øc. H·ªç s·ªõm ph√°t hi·ªán ra r·∫±ng c√¢y ƒë√†n c√≥ th·ªÉ ch∆°i nhi·ªÅu lo·∫°i nh·∫°c kh√°c nhau, gi·ªëng h·ªát nh∆∞ b·∫•t k·ª≥ c√¢y ƒë√†n b√¨nh th∆∞·ªùng n√†o.</span>
            </p>

            <p>
                There‚Äôs been so much interest in Adrian‚Äôs piano that he could probably start making and selling others just like it. <span class="gap-marker">5</span> So, at the moment, he has no plans to make any more.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫£n d·ªãch</button>
                <span class="trans-content">ƒê√£ c√≥ r·∫•t nhi·ªÅu s·ª± quan t√¢m ƒë·∫øn c√¢y ƒë√†n c·ªßa Adrian ƒë·∫øn n·ªói anh ·∫•y c√≥ th·ªÉ b·∫Øt ƒë·∫ßu ch·∫ø t·∫°o v√† b√°n nh·ªØng chi·∫øc kh√°c gi·ªëng h·ªát n√≥. [5] V√¨ v·∫≠y, v√†o l√∫c n√†y, anh ·∫•y kh√¥ng c√≥ k·∫ø ho·∫°ch l√†m th√™m c√°i n√†o n·ªØa.</span>
            </p>
        </div>

        <div class="glossary-box">
            <div class="glossary-title">üìñ GLOSSARY (T·ª´ v·ª±ng x·ªãn)</div>
            <table class="gloss-table">
                <tr>
                    <td><span class="word">Professional</span> <span class="type">adj</span></td>
                    <td>Chuy√™n nghi·ªáp</td>
                </tr>
                <tr>
                    <td><span class="word">Instrument</span> <span class="type">n</span></td>
                    <td>Nh·∫°c c·ª• (ƒë√†n, s√°o...)</td>
                </tr>
                <tr>
                    <td><span class="word">Material</span> <span class="type">n</span></td>
                    <td>Nguy√™n v·∫≠t li·ªáu</td>
                </tr>
                <tr>
                    <td><span class="word">Transfer</span> <span class="type">v</span></td>
                    <td>Di chuy·ªÉn, d·ªùi ƒëi</td>
                </tr>
                <tr>
                    <td><span class="word">Workshop</span> <span class="type">n</span></td>
                    <td>X∆∞·ªüng l√†m vi·ªác</td>
                </tr>
                <tr>
                    <td><span class="word">Brilliantly</span> <span class="type">adv</span></td>
                    <td>M·ªôt c√°ch r·ª±c r·ª°, xu·∫•t s·∫Øc</td>
                </tr>
                <tr>
                    <td><span class="word">Discover</span> <span class="type">v</span></td>
                    <td>Kh√°m ph√°, ph√°t hi·ªán ra</td>
                </tr>
                 <tr>
                    <td><span class="word">Original</span> <span class="type">adj</span></td>
                    <td>Nguy√™n b·∫£n, g·ªëc, ban ƒë·∫ßu</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="panel" id="exercise-panel">
        <h2 style="color: var(--primary-color); text-align: center; margin-bottom: 20px;">üß© Fill in the Gaps</h2>
        
        <div id="quiz-container">
            </div>

        <div class="submit-container">
            <button class="submit-btn" onclick="calculateFinalScore()">N·ªòP B√ÄI üöÄ</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="score-modal">
    <div class="modal-content">
        <h2>K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
        <div class="score-big" id="final-score-display">0/5</div>
        <p id="feedback-msg" style="font-size: 1.2rem; color: #555;"></p>
        <button class="submit-btn" style="font-size: 1rem; padding: 10px 20px; margin-top: 15px;" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
    </div>
</div>

<script>
    // --- DATA ---
    const quizData = [
        {
            id: 1,
            gap: 1,
            correct: "F",
            options: [
                {id: "A", text: "However, he put a lot of work into his original model."},
                {id: "B", text: "It‚Äôs so big, you could imagine actually lying down inside it!"},
                {id: "C", text: "So what gave Adrian the idea to create such a huge piano?"},
                {id: "F", text: "That‚Äôs much larger than on a normal-sized piano."}
            ],
            explanation: "Gap 1 c·∫ßn m·ªôt c√¢u so s√°nh v·ªÅ k√≠ch th∆∞·ªõc. Tr∆∞·ªõc ƒë√≥ b√†i n√≥i 'keys are a metre in length' (ph√≠m d√†i 1 m√©t). ƒê√°p √°n F ('L·ªõn h∆°n nhi·ªÅu so v·ªõi ƒë√†n th∆∞·ªùng') l√† s·ª± so s√°nh h·ª£p l√Ω nh·∫•t.",
            translation: "C√¢u F: ƒêi·ªÅu ƒë√≥ l·ªõn h∆°n nhi·ªÅu so v·ªõi m·ªôt c√¢y ƒë√†n piano k√≠ch c·ª° b√¨nh th∆∞·ªùng.",
            paraphrase: "Metre in length = Much larger than normal."
        },
        {
            id: 2,
            gap: 2,
            correct: "C",
            options: [
                {id: "C", text: "So what gave Adrian the idea to create such a huge piano?"},
                {id: "D", text: "They expect that the instrument won‚Äôt sound very good."},
                {id: "E", text: "But things weren‚Äôt always that simple."},
                {id: "G", text: "Most of them were surprised by the wonderful result."}
            ],
            explanation: "Gap 2 ƒë·ª©ng ƒë·∫ßu ƒëo·∫°n, sau ƒë√≥ l√† c√¢u 'In fact, the whole thing started when...' (Th·ª±c t·∫ø m·ªçi chuy·ªán b·∫Øt ƒë·∫ßu khi...). ƒê√¢y l√† c√¢u tr·∫£ l·ªùi cho c√¢u h·ªèi ·ªü ƒë√°p √°n C ('V·∫≠y ƒëi·ªÅu g√¨ ƒë√£ cho Adrian √Ω t∆∞·ªüng...?').",
            translation: "C√¢u C: V·∫≠y ƒëi·ªÅu g√¨ ƒë√£ cho Adrian √Ω t∆∞·ªüng t·∫°o ra m·ªôt c√¢y ƒë√†n piano kh·ªïng l·ªì nh∆∞ v·∫≠y?",
            paraphrase: "Gave idea ~ Started when..."
        },
        {
            id: 3,
            gap: 3,
            correct: "H",
            options: [
                {id: "A", text: "However, he put a lot of work into his original model."},
                {id: "B", text: "It‚Äôs so big, you could imagine actually lying down inside it!"},
                {id: "H", text: "But he soon found he couldn‚Äôt move it out on his own."},
                {id: "D", text: "They expect that the instrument won‚Äôt sound very good."}
            ],
            explanation: "Tr∆∞·ªõc Gap 3 n√≥i v·ªÅ vi·ªác chuy·ªÉn ƒë√†n (transfer). Sau Gap 3 n√≥i 'fire service had to come help' (c·ª©u h·ªèa ph·∫£i ƒë·∫øn gi√∫p). Suy ra Gap 3 ph·∫£i n√≥i v·ªÅ kh√≥ khƒÉn khi di chuy·ªÉn -> ƒê√°p √°n H ('Kh√¥ng th·ªÉ t·ª± m√¨nh di chuy·ªÉn n√≥').",
            translation: "C√¢u H: Nh∆∞ng anh ·∫•y s·ªõm nh·∫≠n ra m√¨nh kh√¥ng th·ªÉ t·ª± di chuy·ªÉn n√≥ ra ngo√†i.",
            paraphrase: "Couldn't move on his own -> Fire service had to help."
        },
        {
            id: 4,
            gap: 4,
            correct: "D",
            options: [
                {id: "G", text: "Most of them were surprised by the wonderful result."},
                {id: "D", text: "They expect that the instrument won‚Äôt sound very good."},
                {id: "E", text: "But things weren‚Äôt always that simple."},
                {id: "F", text: "That‚Äôs much larger than on a normal-sized piano."}
            ],
            explanation: "Tr∆∞·ªõc Gap 4 n√≥i m·ªçi ng∆∞·ªùi 'aren't very positive' (kh√¥ng t√≠ch c·ª±c l·∫Øm). Sau Gap 4 d√πng 'But actually' (Nh∆∞ng th·ª±c ra) ƒë·ªÉ ph·∫£n b√°c. V·∫≠y Gap 4 ph·∫£i l√† suy nghƒ© ti√™u c·ª±c c·ª• th·ªÉ -> ƒê√°p √°n D ('H·ªç nghƒ© n√≥ nghe kh√¥ng hay').",
            translation: "C√¢u D: H·ªç mong ƒë·ª£i r·∫±ng nh·∫°c c·ª• s·∫Ω kh√¥ng c√≥ √¢m thanh hay l·∫Øm.",
            paraphrase: "Aren't positive ~ Expect won't sound good."
        },
        {
            id: 5,
            gap: 5,
            correct: "A",
            options: [
                {id: "A", text: "However, he put a lot of work into his original model."},
                {id: "B", text: "It‚Äôs so big, you could imagine actually lying down inside it!"},
                {id: "H", text: "But he soon found he couldn‚Äôt move it out on his own."},
                {id: "C", text: "So what gave Adrian the idea to create such a huge piano?"}
            ],
            explanation: "Tr∆∞·ªõc Gap 5 n√≥i anh ·∫•y 'could start selling' (c√≥ th·ªÉ b√°n). Sau Gap 5 l·∫°i n√≥i 'no plans to make more' (kh√¥ng ƒë·ªãnh l√†m th√™m). C·∫ßn m·ªôt l√Ω do c·∫£n tr·ªü -> ƒê√°p √°n A ('Anh ·∫•y ƒë√£ t·ªën qu√° nhi·ªÅu c√¥ng s·ª©c v√†o b·∫£n m·∫´u').",
            translation: "C√¢u A: Tuy nhi√™n, anh ·∫•y ƒë√£ ƒë·∫∑t r·∫•t nhi·ªÅu c√¥ng s·ª©c v√†o m√¥ h√¨nh ban ƒë·∫ßu c·ªßa m√¨nh.",
            paraphrase: "Put a lot of work -> No plans to make more (too hard)."
        }
    ];

    let score = 0;
    let answeredCount = 0;

    // --- SOUND EFFECTS (Synthesized to keep single file) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High pitch, fast decay)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
            fireConfetti();
        } else {
            // Wrong sound (Low pitch wobble)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- CONFETTI EFFECT ---
    function fireConfetti() {
        const colors = ['#a864fd', '#29cdff', '#78ff44', '#ff718d', '#fdff6a'];
        for (let i = 0; i < 50; i++) {
            const conf = document.createElement('div');
            conf.classList.add('confetti-piece');
            conf.style.left = Math.random() * 100 + 'vw';
            conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            conf.style.animation = `drop ${Math.random() * 2 + 1}s linear forwards`;
            document.body.appendChild(conf);
            
            // Cleanup
            setTimeout(() => { conf.remove(); }, 3000);
        }
    }
    
    // Add Keyframes for confetti dynamically
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `@keyframes drop { 0% { top: -10px; opacity: 1; transform: rotate(0deg); } 100% { top: 100vh; opacity: 0; transform: rotate(720deg); } }`;
    document.head.appendChild(styleSheet);


    // --- QUIZ RENDERING ---
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        quizData.forEach(q => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${q.id}`;
            
            let optionsHTML = '';
            // Shuffle options slightly for randomness or keep fixed? Keep fixed A-H as per request logic but let's show subset if needed. 
            // The prompt gave specific subsets for options but the original test has 8 options (A-H) for all gaps.
            // To make it user friendly like "Blooket", I will display 4 relevant options (Distractors) per question as I defined in data above.
            
            q.options.forEach(opt => {
                optionsHTML += `<button class="option-btn" onclick="checkAnswer(${q.id}, '${opt.id}', this)"><b>${opt.id}.</b> ${opt.text}</button>`;
            });

            card.innerHTML = `
                <div class="q-header">
                    <div class="q-number">${q.gap}</div>
                    <span style="font-weight: 700; color: #555;">Ch·ªçn c√¢u ph√π h·ª£p ƒëi·ªÅn v√†o v·ªã tr√≠ [${q.gap}]</span>
                </div>
                <div class="options-grid" id="options-${q.id}">
                    ${optionsHTML}
                </div>
                <div class="support-area" id="support-${q.id}">
                    <div class="teacher-feedback">
                        <div class="teacher-avatar">üë©‚Äçüè´</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">Ms. Mai An gi·∫£i th√≠ch:</div>
                        <div style="font-size: 0.95rem;">${q.explanation}</div>
                    </div>
                    <div class="support-actions">
                        <button class="action-btn btn-translate" onclick="toggleDetail('trans-${q.id}')">D·ªãch c√¢u</button>
                        <button class="action-btn btn-paraphrase" onclick="toggleDetail('para-${q.id}')">Paraphrase</button>
                    </div>
                    <div id="trans-${q.id}" class="detail-content">üìù <b>D·ªãch:</b> ${q.translation}</div>
                    <div id="para-${q.id}" class="detail-content">üîÑ <b>So s√°nh:</b> ${q.paraphrase}</div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // --- INTERACTION LOGIC ---
    function checkAnswer(qId, selectedOptId, btnElement) {
        const qData = quizData.find(q => q.id === qId);
        const parentGrid = document.getElementById(`options-${qId}`);
        const allBtns = parentGrid.querySelectorAll('.option-btn');
        
        // Prevent re-clicking
        if (parentGrid.classList.contains('answered')) return;
        parentGrid.classList.add('answered');

        if (selectedOptId === qData.correct) {
            // Correct
            btnElement.classList.add('correct');
            playSound('correct');
            score++;
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            playSound('wrong');
            // Highlight correct one
            allBtns.forEach(btn => {
                if (btn.innerText.startsWith(qData.correct)) {
                    btn.classList.add('correct');
                }
            });
        }
        
        // Disable all buttons
        allBtns.forEach(btn => btn.classList.add('disabled'));

        // Show Support
        document.getElementById(`support-${qId}`).style.display = 'block';
        answeredCount++;
    }

    function toggleDetail(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function toggleTrans(btn) {
        const content = btn.nextElementSibling;
        if (content.style.display === 'block') {
            content.style.display = 'none';
            btn.innerText = 'B·∫£n d·ªãch';
            btn.style.background = '#dfe6e9';
            btn.style.color = '#636e72';
        } else {
            content.style.display = 'block';
            btn.innerText = '·∫®n d·ªãch';
            btn.style.background = '#a29bfe';
            btn.style.color = 'white';
        }
    }

    // --- TIMER LOGIC ---
    let time = 600; // 10 minutes
    let timerInterval;
    let isRunning = false;

    function startTimer() {
        if (isRunning) return;
        isRunning = true;
        document.getElementById('timer-toggle').innerText = '‚è∏';
        timerInterval = setInterval(() => {
            time--;
            updateTimerDisplay();
            if (time <= 0) {
                clearInterval(timerInterval);
                alert("ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c, nh∆∞ng nh·ªõ t·ªëc ƒë·ªô thi th·∫≠t nh√©!");
            }
        }, 1000);
    }

    function toggleTimer() {
        if (isRunning) {
            clearInterval(timerInterval);
            isRunning = false;
            document.getElementById('timer-toggle').innerText = '‚ñ∂Ô∏è';
        } else {
            startTimer();
        }
    }

    function updateTimerDisplay() {
        const m = Math.floor(time / 60);
        const s = time % 60;
        document.getElementById('timer-display').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    }

    // --- SCORING ---
    function calculateFinalScore() {
        const modal = document.getElementById('score-modal');
        const scoreDisplay = document.getElementById('final-score-display');
        const feedback = document.getElementById('feedback-msg');
        
        scoreDisplay.innerText = `${score}/5`;
        
        if (score === 5) feedback.innerText = "üèÜ THI√äN T√ÄI! B·∫°n qu√° xu·∫•t s·∫Øc!";
        else if (score >= 3) feedback.innerText = "üåü L√ÄM T·ªêT L·∫ÆM! C·ªë th√™m ch√∫t n·ªØa l√† tuy·ªát ƒë·ªëi.";
        else feedback.innerText = "üí™ C·ªê L√äN NH√â! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥.";

        modal.style.display = 'flex';
        playSound('correct'); // Celebration sound
    }

    function closeModal() {
        document.getElementById('score-modal').style.display = 'none';
    }

    // INITIALIZE
    window.onload = function() {
        renderQuiz();
        // Auto start timer interaction needs user gesture usually, so we wait for first click or just show paused
        document.getElementById('timer-toggle').innerText = '‚ñ∂Ô∏è'; // Start in paused state
    };

</script>

</body>
</html>