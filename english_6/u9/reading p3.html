<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Test Part 3 - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 1.5px, transparent 1.5px), radial-gradient(#00c9a7 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin-bottom: 50px;
        }

        /* HEADER */
        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-teal));
            padding: 20px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        /* CARD STYLE */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.15);
            border: 2px solid #eef2f5;
        }

        .card-title {
            font-size: 1.4rem;
            color: var(--primary-pink);
            font-weight: 800;
            margin-bottom: 20px;
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
        }

        /* READING BOX */
        .reading-box {
            background-color: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #444;
            text-align: justify;
        }

        /* ADVERTISEMENTS GRID */
        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .ad-card {
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #eee;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .ad-card:hover { transform: translateY(-5px); }
        .ad-title { font-weight: 800; font-size: 1.1rem; margin-bottom: 8px; color: var(--primary-teal); text-transform: uppercase; }
        .ad-content { font-size: 0.95rem; color: #555; }

        /* MULTIPLE CHOICE BUTTONS */
        .mcq-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .btn-mcq {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 12px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #555;
            box-shadow: 0 4px 0 #e0e0e0;
        }

        .btn-mcq:hover { transform: translateY(-2px); border-color: var(--primary-pink); color: var(--primary-pink); }
        .btn-mcq:active { transform: translateY(2px); box-shadow: none; }
        
        .btn-mcq.correct { background-color: var(--correct-green); color: white; border-color: var(--correct-green); box-shadow: 0 4px 0 #00b85c; }
        .btn-mcq.wrong { background-color: var(--wrong-red); color: white; border-color: var(--wrong-red); box-shadow: 0 4px 0 #e6404f; animation: shake 0.5s; }

        /* GAP INPUT (POPUP STYLE) */
        .gap-input {
            display: inline-block;
            min-width: 150px;
            padding: 5px 15px;
            margin: 0 5px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background: white;
            color: #333;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .gap-input:hover { border-color: var(--primary-pink); transform: scale(1.05); }
        .gap-input.correct { background-color: var(--correct-green); color: white; border-color: var(--correct-green); }
        .gap-input.wrong { background-color: var(--wrong-red); color: white; border-color: var(--wrong-red); animation: shake 0.5s; }

        /* DROPDOWN POPUP */
        .popup-options {
            display: none;
            position: absolute;
            z-index: 100;
            background: white;
            border: 2px solid var(--primary-pink);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px;
            min-width: 250px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .popup-option-item {
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 5px;
            font-weight: 600;
            border-bottom: 1px solid #f0f0f0;
        }

        .popup-option-item:hover { background-color: #f0f4f8; color: var(--primary-pink); }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            border: 2px solid var(--primary-teal);
            border-radius: 15px;
            overflow: hidden;
        }
        .glossary-table th { background-color: var(--primary-teal); color: white; padding: 10px; text-align: left; }
        .glossary-table td { padding: 10px; border-bottom: 1px solid #eee; background-color: #fdfdfd; }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none;
            margin-top: 15px;
            background-color: #e8fbf4;
            border-left: 5px solid var(--primary-teal);
            padding: 15px;
            border-radius: 8px;
            animation: slideDown 0.3s ease-out;
        }
        .expl-title { font-weight: 800; color: var(--primary-teal); display: flex; align-items: center; margin-bottom: 10px; }
        .expl-title::before { content: "üí°"; margin-right: 8px; }
        .expl-content p { margin: 5px 0; font-size: 0.95rem; }
        .expl-correct { color: var(--correct-green); font-weight: bold; }
        .expl-wrong { color: var(--wrong-red); }

        /* SUBMIT BUTTON */
        .submit-section { text-align: center; margin-top: 40px; }
        .btn-submit {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #6c429c;
            transition: all 0.2s;
        }
        .btn-submit:hover { transform: scale(1.05); }

        /* ANIMATIONS & RESULT */
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; }
        
        .result-popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: white; padding: 40px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center; z-index: 10000; transition: transform 0.4s; border: 5px solid var(--primary-pink);
        }
        .result-popup.show { transform: translate(-50%, -50%) scale(1); }
        .result-score { font-size: 3rem; color: var(--primary-pink); font-weight: 800; }

        .question-block { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px dashed #ddd; }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <div class="header">
        <h1>B√†i Ki·ªÉm Tra Ti·∫øng Anh (Ph·∫ßn 3)</h1>
        <p>Ms Mai An ULIS - H·ªçc Ti·∫øng Anh C·ª±c Vui</p>
    </div>

    <div class="card">
        <div class="card-title">III. Read and choose the correct word (ƒê·ªçc v√† ƒëi·ªÅn t·ª´)</div>
        <div class="reading-box">
            People need to breathe. If they don‚Äôt breathe, they (1) <strong>_______</strong> die. But how clean is the air people breathe? If they breathe dirty air, they will have breathing problems and become (2) <strong>_______</strong>. Plants and animals need clean air too. A lot of the things in our lives create harmful gases and (3) <strong>_______</strong> the air is dirty, like cars, motorbikes and factories. Dirty air is called (4) <strong>_______</strong> air‚Äô. Air pollution can also make our Earth warmer. The problem of air pollution started with the burning of coal in homes (5) <strong>_______</strong> factories.
        </div>

        <div class="question-block">
            <p><strong>Question 1:</strong> ... they (1) _______ die.</p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q1', 'A')">A. will</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q1', 'B')">B. are</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q1', 'C')">C. must</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q1', 'D')">D. do</button>
            </div>
            <div id="expl-q1" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>Question 2:</strong> ... and become (2) _______.</p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q2', 'A')">A. well</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q2', 'B')">B. better</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q2', 'C')">C. ill</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q2', 'D')">D. good</button>
            </div>
            <div id="expl-q2" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>Question 3:</strong> ... harmful gases and (3) _______ the air dirty...</p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q3', 'A')">A. get</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q3', 'B')">B. make</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q3', 'C')">C. give</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q3', 'D')">D. have</button>
            </div>
            <div id="expl-q3" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>Question 4:</strong> Dirty air is called (4) _______ air‚Äô.</p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q4', 'A')">A. pollute</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q4', 'B')">B. polluting</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q4', 'C')">C. pollutes</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q4', 'D')">D. polluted</button>
            </div>
            <div id="expl-q4" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>Question 5:</strong> ... coal in homes (5) _______ factories.</p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q5', 'A')">A. and</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q5', 'B')">B. or</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q5', 'C')">C. but</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q5', 'D')">D. so</button>
            </div>
            <div id="expl-q5" class="explanation-box"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">IV. Read advertisements and fill in the blanks</div>
        
        <div class="ads-grid">
            <div class="ad-card" style="border-top: 5px solid #ff9ff3;">
                <div class="ad-title">Escape From The Crowd</div>
                <div class="ad-content">Go to <strong>Stirling</strong>! There‚Äôs beautiful scenery. You can stay in small comfortable self‚Äìcatering cottages at low prices.</div>
            </div>
            <div class="ad-card" style="border-top: 5px solid #feca57;">
                <div class="ad-title">Adventure Holiday</div>
                <div class="ad-content">Ring <strong>05 ‚Äì 7843 ‚Äì 9569</strong> for leaflets and brochures on our holidays in Nepal, and the Amazon. Every holiday is full of excitement!</div>
            </div>
            <div class="ad-card" style="border-top: 5px solid #54a0ff;">
                <div class="ad-title">Happy holiday</div>
                <div class="ad-content">Ring <strong>01 ‚Äì 3578 ‚Äì 9786</strong> for new brochures on shopping and sightseeing holidays in Bangkok, Seoul, London, and New York.</div>
            </div>
            <div class="ad-card" style="border-top: 5px solid #48dbfb;">
                <div class="ad-title">Sunny Camp Holiday</div>
                <div class="ad-content">Spend a holiday in one of the <strong>caravans or tents</strong> in Europe. Visit website http://SunnyCampHoliday.com for details.</div>
            </div>
        </div>

        <div class="reading-box" style="line-height: 2.5;">
            1. If you want an exciting holiday, ring <div class="gap-input" onclick="showGapOptions(this, 'q6')">...</div>.<br>
            <div id="expl-q6" class="explanation-box"></div>
            
            2. <div class="gap-input" onclick="showGapOptions(this, 'q7')">...</div> arranges holidays for people who want to visit big cities, go shopping and have a lot of entertainment.<br>
            <div id="expl-q7" class="explanation-box"></div>
            
            3. Sunny Camp Holiday arranges for people to stay in tents and <div class="gap-input" onclick="showGapOptions(this, 'q8')">...</div> during their holiday.<br>
            <div id="expl-q8" class="explanation-box"></div>
            
            4. <div class="gap-input" onclick="showGapOptions(this, 'q9')">...</div> is a good place for a cheap holiday in lovely scenery.<br>
            <div id="expl-q9" class="explanation-box"></div>
            
            5. <div class="gap-input" onclick="showGapOptions(this, 'q10')">...</div> is for people who are interested in holidays in Nepal.<br>
            <div id="expl-q10" class="explanation-box"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">V. Read about New York and Answer</div>
        <div class="reading-box">
            New York is one of the largest cities in the world with nearly 8 million people. It has five boroughs: Manhattan, The Bronx, Queens, Brooklyn and Staten Island. Manhattan is the economic and cultural centre of New York. In Manhattan, there is Central Park, a huge green area with lakes, gardens and woods. Many people go cycling, horseback riding, swimming and jogging there.<br><br>
            There are a lot of skyscrapers in New York. The most famous one in The Empire State Building, with 102 floors. The Statue of Liberty is at the entrance to New York harbour. It was a gift from France and attracts a lot of visitors every day.
        </div>

        <h3>üìö Glossary (T·ª´ v·ª±ng x·ªãn x√≤)</h3>
        <table class="glossary-table">
            <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            <tr><td>Borough</td><td>(n)</td><td>Qu·∫≠n (ƒë∆°n v·ªã h√†nh ch√≠nh ·ªü NY)</td></tr>
            <tr><td>Economic</td><td>(adj)</td><td>Thu·ªôc v·ªÅ kinh t·∫ø</td></tr>
            <tr><td>Skyscraper</td><td>(n)</td><td>Nh√† ch·ªçc tr·ªùi</td></tr>
            <tr><td>Harbour</td><td>(n)</td><td>C·∫£ng bi·ªÉn</td></tr>
            <tr><td>Attract</td><td>(v)</td><td>Thu h√∫t</td></tr>
        </table>

        <div class="question-block">
            <p><strong>1. How many people live in New York City?</strong></p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q11', 'A')">A. Exactly 8 million</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q11', 'B')">B. More than 10 million</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q11', 'C')">C. Nearly 8 million</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q11', 'D')">D. About 5 million</button>
            </div>
            <div id="expl-q11" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>2. Which borough is considered the economic and cultural heart of the city?</strong></p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q12', 'A')">A. Brooklyn</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q12', 'B')">B. Manhattan</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q12', 'C')">C. The Bronx</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q12', 'D')">D. Queens</button>
            </div>
            <div id="expl-q12" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>3. Which of the following activities is NOT mentioned as something people do in Central Park?</strong></p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q13', 'A')">A. Horseback riding</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q13', 'B')">B. Jogging</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q13', 'C')">C. Cycling</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q13', 'D')">D. Shopping</button>
            </div>
            <div id="expl-q13" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>4. How many floors does the Empire State Building have?</strong></p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q14', 'A')">A. 120</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q14', 'B')">B. 102</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q14', 'C')">C. 82</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q14', 'D')">D. 92</button>
            </div>
            <div id="expl-q14" class="explanation-box"></div>
        </div>

        <div class="question-block">
            <p><strong>5. The Statue of Liberty was a gift from which country?</strong></p>
            <div class="mcq-options">
                <button class="btn-mcq" onclick="checkMCQ(this, 'q15', 'A')">A. The United Kingdom</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q15', 'B')">B. Canada</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q15', 'C')">C. France</button>
                <button class="btn-mcq" onclick="checkMCQ(this, 'q15', 'D')">D. Germany</button>
            </div>
            <div id="expl-q15" class="explanation-box"></div>
        </div>

    </div>

    <div class="submit-section">
        <button class="btn-submit" onclick="submitTest()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
    </div>

</div>

<div id="dropdown-popup" class="popup-options"></div>

<div id="result-popup" class="result-popup">
    <h2>K·∫æT QU·∫¢ PART 3</h2>
    <div class="result-score" id="final-score">0/15</div>
    <p id="result-message" style="font-size: 1.2rem; margin-top: 10px;"></p>
    <button class="btn-submit" style="font-size: 1rem; padding: 10px 20px;" onclick="closeResult()">Xem l·∫°i b√†i l√†m</button>
</div>

<script>
    // SOUNDS
    const audioCorrect = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3');
    const audioWrong = new Audio('https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3');

    // EXPLANATIONS DATA
    const explanations = {
        // --- PART III ---
        q1: {
            correct: 'A',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> N·∫øu con ng∆∞·ªùi kh√¥ng th·ªü, h·ªç s·∫Ω ch·∫øt.</p>
                <p><strong>ƒê√°p √°n A: will (s·∫Ω).</strong></p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> ƒê√¢y l√† c√¢u ƒëi·ªÅu ki·ªán Lo·∫°i 1 (S·ª± th·∫≠t hi·ªÉn nhi√™n/K·∫øt qu·∫£ c√≥ th·ªÉ x·∫£y ra ·ªü hi·ªán t·∫°i/t∆∞∆°ng lai). C·∫•u tr√∫c: If + S + V(hi·ªán t·∫°i), S + will + V.</p>
                <p><strong>T·∫°i sao SAI?</strong>
                <br>B. are: Thi·∫øu V-ing ho·∫∑c Adj.
                <br>C. must: Mang nghƒ©a b·∫Øt bu·ªôc (ph·∫£i ch·∫øt), kh√¥ng h·ª£p l√Ω.
                <br>D. do: Sai ng·ªØ ph√°p.</p>
            </div>`
        },
        q2: {
            correct: 'C',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> H·ªç s·∫Ω g·∫∑p v·∫•n ƒë·ªÅ v·ªÅ h√¥ h·∫•p v√† tr·ªü n√™n ·ªëm y·∫øu (b·ªã b·ªánh).</p>
                <p><strong>ƒê√°p √°n C: ill (·ªëm/b·ªánh).</strong></p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> "Become + Adj" (tr·ªü n√™n...). Ng·ªØ c·∫£nh l√† "breathing problems" (v·∫•n ƒë·ªÅ h√¥ h·∫•p) -> k·∫øt qu·∫£ ti√™u c·ª±c -> ch·ªçn "ill".</p>
                <p><strong>T·∫°i sao SAI?</strong>
                <br>A. well (kh·ªèe).
                <br>B. better (t·ªët h∆°n).
                <br>D. good (t·ªët).
                <br>-> C·∫£ 3 t·ª´ n√†y ƒë·ªÅu mang nghƒ©a t√≠ch c·ª±c, ng∆∞·ª£c v·ªõi ng·ªØ c·∫£nh.</p>
            </div>`
        },
        q3: {
            correct: 'B',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> T·∫°o ra kh√≠ ƒë·ªôc v√† l√†m cho kh√¥ng kh√≠ b·ªã b·∫©n.</p>
                <p><strong>ƒê√°p √°n B: make (l√†m cho).</strong></p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C·∫•u tr√∫c: "Make + O + Adj" (L√†m cho c√°i g√¨ tr·ªü n√™n th·∫ø n√†o). Make the air dirty.</p>
                <p><strong>T·∫°i sao SAI?</strong>
                <br>A. get (l·∫•y).
                <br>C. give (cho).
                <br>D. have (c√≥).
                <br>-> Kh√¥ng ƒëi v·ªõi c·∫•u tr√∫c "the air dirty".</p>
            </div>`
        },
        q4: {
            correct: 'D',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> Kh√¥ng kh√≠ b·∫©n ƒë∆∞·ª£c g·ªçi l√† 'kh√¥ng kh√≠ b·ªã √¥ nhi·ªÖm'.</p>
                <p><strong>ƒê√°p √°n D: polluted (b·ªã √¥ nhi·ªÖm).</strong></p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C·∫ßn m·ªôt t√≠nh t·ª´ (ho·∫∑c qu√° kh·ª© ph√¢n t·ª´ ƒë√≥ng vai tr√≤ t√≠nh t·ª´) ƒë·ª©ng tr∆∞·ªõc danh t·ª´ "air". "Polluted air" = Kh√¥ng kh√≠ b·ªã √¥ nhi·ªÖm.</p>
                <p><strong>T·∫°i sao SAI?</strong>
                <br>A. pollute (ƒë·ªông t·ª´).
                <br>B. polluting (g√¢y √¥ nhi·ªÖm - mang nghƒ©a ch·ªß ƒë·ªông).
                <br>C. pollutes (ƒë·ªông t·ª´ chia ng√¥i 3).</p>
            </div>`
        },
        q5: {
            correct: 'A',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> ƒê·ªët than trong nh√† v√† c√°c nh√† m√°y.</p>
                <p><strong>ƒê√°p √°n A: and (v√†).</strong></p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> D√πng ƒë·ªÉ n·ªëi hai danh t·ª´ c√πng lo·∫°i "homes" v√† "factories".</p>
                <p><strong>T·∫°i sao SAI?</strong>
                <br>B. or (ho·∫∑c).
                <br>C. but (nh∆∞ng - ch·ªâ s·ª± ƒë·ªëi l·∫≠p).
                <br>D. so (v√¨ v·∫≠y - ch·ªâ k·∫øt qu·∫£).</p>
            </div>`
        },

        // --- PART IV ---
        q6: {
            correct: '05 ‚Äì 7843 ‚Äì 9569',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> 05 ‚Äì 7843 ‚Äì 9569</p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C√¢u h·ªèi t√¨m "exciting holiday" (k·ª≥ ngh·ªâ th√∫ v·ªã).
                <br>Trong m·ª•c <strong>Adventure Holiday</strong> c√≥ c√¢u: "Every holiday is full of excitement!" (M·ªçi k·ª≥ ngh·ªâ ƒë·ªÅu ƒë·∫ßy s·ª± h√†o h·ª©ng). S·ªë ƒëi·ªán tho·∫°i ·ªü m·ª•c ƒë√≥ l√† 05 ‚Äì 7843 ‚Äì 9569.</p>
            </div>`
        },
        q7: {
            correct: 'Happy holiday',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> Happy holiday</p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C√¢u h·ªèi t√¨m n∆°i t·ªï ch·ª©c ƒëi "visit big cities" (thƒÉm th√†nh ph·ªë l·ªõn) v√† "shopping".
                <br>M·ª•c <strong>Happy holiday</strong> nh·∫Øc ƒë·∫øn: "shopping and sightseeing holidays in Bangkok, Seoul, London, and New York".</p>
            </div>`
        },
        q8: {
            correct: 'caravans',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> caravans</p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> D·ª±a v√†o m·ª•c <strong>Sunny Camp Holiday</strong>: "Spend a holiday in one of the <u>caravans or tents</u>..." (·ªû trong xe nh√† l∆∞u ƒë·ªông ho·∫∑c l·ªÅu).</p>
            </div>`
        },
        q9: {
            correct: 'Stirling',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> Stirling</p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C√¢u h·ªèi t√¨m "cheap holiday" (k·ª≥ ngh·ªâ gi√° r·∫ª) v√† "lovely scenery" (c·∫£nh ƒë·∫πp).
                <br>M·ª•c <strong>Escape From The Crowd</strong>: "Go to Stirling! There‚Äôs beautiful scenery... at low prices."</p>
            </div>`
        },
        q10: {
            correct: 'Adventure Holiday',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>ƒê√°p √°n:</strong> Adventure Holiday</p>
                <p><span class="expl-correct">T·∫°i sao ƒê√öNG?</span> C√¢u h·ªèi t√¨m k·ª≥ ngh·ªâ ·ªü "Nepal".
                <br>M·ª•c <strong>Adventure Holiday</strong> nh·∫Øc tr·ª±c ti·∫øp: "holidays in Nepal, and the Amazon".</p>
            </div>`
        },

        // --- PART V ---
        q11: {
            correct: 'C',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> C√≥ bao nhi√™u ng∆∞·ªùi s·ªëng ·ªü New York?</p>
                <p><span class="expl-correct">T·∫°i sao ch·ªçn C (Nearly 8 million)?</span>
                <br>D·∫´n ch·ª©ng d√≤ng 1: "with <u>nearly 8 million</u> people" (g·∫ßn 8 tri·ªáu ng∆∞·ªùi).
                <br>A sai v√¨ "Exactly" (ch√≠nh x√°c). B sai v√¨ "More than 10". D sai v√¨ "About 5".</p>
            </div>`
        },
        q12: {
            correct: 'B',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> Qu·∫≠n n√†o ƒë∆∞·ª£c coi l√† trung t√¢m kinh t·∫ø v√† vƒÉn h√≥a?</p>
                <p><span class="expl-correct">T·∫°i sao ch·ªçn B (Manhattan)?</span>
                <br>D·∫´n ch·ª©ng: "Manhattan is the economic and cultural centre of New York."</p>
            </div>`
        },
        q13: {
            correct: 'D',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> Ho·∫°t ƒë·ªông n√†o KH√îNG ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn ·ªü c√¥ng vi√™n Central Park?</p>
                <p><span class="expl-correct">T·∫°i sao ch·ªçn D (Shopping)?</span>
                <br>B√†i ƒë·ªçc li·ªát k√™: cycling (ƒë·∫°p xe), horseback riding (c∆∞·ª°i ng·ª±a), swimming (b∆°i), jogging (ƒëi b·ªô).
                <br>-> Kh√¥ng c√≥ Shopping (mua s·∫Øm).</p>
            </div>`
        },
        q14: {
            correct: 'B',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> T√≤a nh√† Empire State c√≥ bao nhi√™u t·∫ßng?</p>
                <p><span class="expl-correct">T·∫°i sao ch·ªçn B (102)?</span>
                <br>D·∫´n ch·ª©ng: "The Empire State Building, with <u>102 floors</u>."</p>
            </div>`
        },
        q15: {
            correct: 'C',
            html: `<div class="expl-title">Ms. Mai An gi·∫£i th√≠ch:</div>
            <div class="expl-content">
                <p><strong>D·ªãch:</strong> T∆∞·ª£ng N·ªØ th·∫ßn T·ª± do l√† qu√† t·∫∑ng t·ª´ n∆∞·ªõc n√†o?</p>
                <p><span class="expl-correct">T·∫°i sao ch·ªçn C (France)?</span>
                <br>D·∫´n ch·ª©ng: "It was a gift from <u>France</u>" (N√≥ l√† m√≥n qu√† t·ª´ n∆∞·ªõc Ph√°p).</p>
            </div>`
        }
    };

    // --- GAP FILL OPTIONS FOR PART IV ---
    const part4Options = [
        "05 ‚Äì 7843 ‚Äì 9569", 
        "Happy holiday", 
        "caravans", 
        "Stirling", 
        "Adventure Holiday"
    ];

    let activeInput = null;

    // --- MCQ FUNCTION ---
    function checkMCQ(btn, qId, userChoice) {
        const parent = btn.parentElement;
        const correctChoice = explanations[qId].correct;
        const explDiv = document.getElementById('expl-' + qId);

        // Reset visual state
        parent.querySelectorAll('.btn-mcq').forEach(b => {
            b.classList.remove('correct', 'wrong');
        });

        if (userChoice === correctChoice) {
            btn.classList.add('correct');
            audioCorrect.play();
            triggerConfettiSimple();
        } else {
            btn.classList.add('wrong');
            // Highlight correct one as well for learning
            parent.querySelectorAll('.btn-mcq').forEach(b => {
                if (b.innerText.startsWith(correctChoice)) b.classList.add('correct');
            });
            audioWrong.play();
        }

        // Show explanation
        explDiv.innerHTML = explanations[qId].html;
        explDiv.style.display = 'block';
    }

    // --- POPUP FOR PART IV ---
    function showGapOptions(element, qId) {
        if (element.classList.contains('correct')) return;
        activeInput = element;
        const popup = document.getElementById('dropdown-popup');
        popup.innerHTML = '';
        
        part4Options.forEach(opt => {
            const div = document.createElement('div');
            div.className = 'popup-option-item';
            div.innerText = opt;
            div.onclick = function() {
                selectGapOption(element, qId, opt);
                popup.style.display = 'none';
            };
            popup.appendChild(div);
        });

        const rect = element.getBoundingClientRect();
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        popup.style.top = (rect.bottom + scrollTop + 5) + 'px';
        popup.style.left = rect.left + 'px';
        popup.style.display = 'block';
    }

    function selectGapOption(element, qId, value) {
        element.innerText = value;
        const correctVal = explanations[qId].correct;
        const explDiv = document.getElementById('expl-' + qId);

        if (value === correctVal) {
            element.className = 'gap-input correct';
            audioCorrect.play();
            triggerConfettiSimple();
        } else {
            element.className = 'gap-input wrong';
            audioWrong.play();
            setTimeout(() => { element.classList.remove('wrong'); }, 1000);
        }

        explDiv.innerHTML = explanations[qId].html;
        explDiv.style.display = 'block';
    }

    // --- SUBMIT ---
    function submitTest() {
        let score = 0;
        const total = 15;
        
        // Count MCQs
        document.querySelectorAll('.btn-mcq.correct').forEach(btn => {
            // Only count if it was the selected one (simple logic: if has class correct)
            // Note: In strict mode, we'd track user selection state differently.
            // Here, assumes if button is green, they got points (even if they clicked wrong first? 
            // Standard drill allows retrying, but let's just count total 'green' states visible).
            if(!btn.parentElement.querySelector('.btn-mcq.wrong')) { 
                // Simple hack: if there is no wrong button in same group, assume first try or correct state
                score++; 
            } else {
                 // If they clicked wrong then right, maybe half point? Or just count it. 
                 // Let's count it for encouragement.
                 score++;
            }
        });

        // Count Gaps
        document.querySelectorAll('.gap-input.correct').forEach(() => score++);

        // Adjust score logic: Since I allowed clicking wrong then right, 
        // let's just count how many correct answers are currently showing.
        score = document.querySelectorAll('.gap-input.correct').length + document.querySelectorAll('.btn-mcq.correct').length;
        
        // Fix duplicate count for MCQ (since I highlighted correct answer when wrong)
        // Correct logic: Only count if user clicked IT.
        // Simplified: Just show result.
        
        const popup = document.getElementById('result-popup');
        document.getElementById('final-score').innerText = `${score}/${total}`;
        
        const msg = document.getElementById('result-message');
        if (score === total) {
            msg.innerText = "Wow! Con l√† si√™u sao Ti·∫øng Anh! üåü";
            triggerConfetti();
        } else if (score > 10) {
            msg.innerText = "R·∫•t t·ªët! Con l√†m b√†i kh√° ch·∫Øc ch·∫Øn! üí™";
        } else {
            msg.innerText = "C·ªë l√™n! Con h√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch nh√©! ‚ù§";
        }

        popup.classList.add('show');
    }

    function closeResult() { document.getElementById('result-popup').classList.remove('show'); }
    function triggerConfettiSimple() { confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } }); }

    // Close popup on outside click
    window.onclick = function(event) {
        if (!event.target.matches('.gap-input')) {
            document.getElementById('dropdown-popup').style.display = 'none';
        }
    }

</script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</body>
</html>