<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* H·ªìng t√≠m nh·∫°t */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --success: #00D26A; /* Xanh l√° */
            --error: #FF4757; /* ƒê·ªè cam */
            --warning: #FFA801;
            --text: #2c3e50;
            --bg-pattern: radial-gradient(#8854c0 1.5px, transparent 1.5px), radial-gradient(#8854c0 1.5px, transparent 1.5px);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f3f8;
            background-image: var(--bg-pattern);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text);
            margin: 0;
            padding-bottom: 100px; /* Space for sticky footer */
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        header h1 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 2.2rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        header p {
            margin: 5px 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* --- Container --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* --- Cards --- */
        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05), 0 15px 20px rgba(0,0,0,0.1);
            border: 2px solid #eef1f5;
        }

        .section-title {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 20px;
            border-bottom: 3px dashed #e0e0e0;
            padding-bottom: 10px;
            display: inline-block;
        }

        .instruction {
            font-weight: 600;
            color: #57606f;
            margin-bottom: 15px;
        }

        /* --- Reading Text & Glossary --- */
        .reading-text {
            background: #f9fbfd;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--secondary);
            line-height: 1.8;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--primary);
        }

        .glossary-table th {
            background: var(--primary);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            background: #fff;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .glossary-table tr:last-child td {
            border-bottom: none;
        }

        .academic-tag {
            display: inline-block;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #555;
            font-weight: bold;
        }

        /* --- Buttons & Inputs --- */
        .btn-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px 20px;
            margin-bottom: 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #dcdcdc;
            position: relative;
        }

        .btn-option:hover {
            transform: scale(1.02);
            border-color: var(--secondary);
        }

        .btn-option:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #dcdcdc;
        }

        .btn-option.selected {
            background: #e3f2fd;
            border-color: var(--secondary);
        }

        .btn-option.correct {
            background-color: #d1fae5 !important;
            border-color: var(--success) !important;
            box-shadow: 0 4px 0 #059669 !important;
            color: #065f46;
        }

        .btn-option.wrong {
            background-color: #fee2e2 !important;
            border-color: var(--error) !important;
            box-shadow: 0 4px 0 #b91c1c !important;
            color: #991b1b;
        }

        /* --- Matching Game Styles --- */
        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        .col-match {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .match-item {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 0 #dcdcdc;
            transition: all 0.2s;
            font-weight: 600;
            display: flex;
            align-items: center;
            min-height: 50px;
        }
        .match-item:active { top: 4px; box-shadow: none; }
        .match-item.selected { border-color: var(--primary); background: #f3e5f5; }
        .match-item.matched { background: var(--success); color: white; border-color: #059669; box-shadow: none; pointer-events: none; opacity: 0.8; }
        .match-item.error-shake { animation: shake 0.5s; background: var(--error); color: white; }

        /* --- Explanation Box --- */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 15px;
            background: #fff8e1;
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 15px;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .explanation.show {
            display: block;
        }

        .teacher-avatar {
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .exp-step {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .exp-label {
            font-weight: 700;
            color: #555;
            text-transform: uppercase;
            font-size: 0.8rem;
            margin-right: 5px;
            padding: 2px 5px;
            border-radius: 4px;
        }
        
        .bg-green { background: #d1fae5; color: #065f46; }
        .bg-red { background: #fee2e2; color: #991b1b; }
        .bg-blue { background: #dbeafe; color: #1e40af; }

        /* --- Footer --- */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 100;
        }

        .btn-submit {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #6c429c;
            transition: transform 0.1s;
        }

        .btn-submit:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* --- Animations --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Result Modal --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: pop 0.5s;
        }
        .score-circle {
            width: 120px; height: 120px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--secondary);
        }
    </style>
</head>
<body>

<header>
    <h1>B√†i Ki·ªÉm Tra Ti·∫øng Anh</h1>
    <p>Gi√°o vi√™n: <strong>Ms. Mai An (ULIS)</strong></p>
</header>

<div class="container">

    <div class="card" id="part8">
        <div class="section-title">PART VIII: MATCHING</div>
        <p class="instruction">N·ªëi c√¢u h·ªèi ·ªü c·ªôt tr√°i v·ªõi c√¢u tr·∫£ l·ªùi ph√π h·ª£p ·ªü c·ªôt ph·∫£i.</p>
        
        <div class="matching-container">
            <div class="col-match" id="col-questions">
                </div>
            <div class="col-match" id="col-answers">
                </div>
        </div>
        <div id="match-explanation-container"></div>
    </div>

    <div class="card" id="part9">
        <div class="section-title">PART IX: GAP FILL</div>
        <p class="instruction">Ch·ªçn t·ª´ ƒë√∫ng ƒë·ªÉ ƒëi·ªÅn v√†o ch·ªó tr·ªëng trong ƒëo·∫°n vƒÉn v·ªÅ L·ªÖ h·ªôi.</p>

        <div class="reading-text">
            The Carnival in Rio de Janeiro, Brazil is the biggest carnival in the world which <strong>(1)_______</strong> for five days. Every year in the month of February the festivities start. Hundreds of people are <strong>(2)_______</strong> on the streets enjoying the street bands, singers and orchestras. The main <strong>(3)_______</strong> of the carnival is the Samba Parade in which 200 schools participate. The schools have elaborate costumes, floats and dancing styles. It is an <strong>(4)_______</strong> experience!<br><br>
            Come August and it's <strong>(5)_______</strong> to have fun in Bu√±ol, Spain. La Tomatina ‚Äì a fun filled battle ‚Äì begins on the last Wednesday of August. Thousands of people come from all over the world to participate in a grand tomato fight. Puzzled! <strong>(6)_______</strong> does it happen? To have fun. Actually a week long festival goes on before the tomato fight. The festival has dancing, music, parades, fireworks and food. However, the <strong>(7)_______</strong> have to take a few precautions. They are asked to squish the tomatoes <strong>(8)_______</strong> throwing so that it does not hurt the other people. They are also advised to wear safety gloves and goggles.
        </div>

        <div id="quiz-container-9">
            </div>
    </div>

    <div class="card" id="part10">
        <div class="section-title">PART X: READING COMPREHENSION</div>
        <p class="instruction">ƒê·ªçc ƒëo·∫°n vƒÉn sau v√† ho√†n th√†nh c√°c b√†i t·∫≠p b√™n d∆∞·ªõi.</p>

        <div class="reading-text">
            For hundreds of years, one remote hill in the middle of England has hosted one of the weirdest and most hazardous festivals in the world. It's the Cooper's Hill Cheese Rolling Festival. The event is held every year at the end of May. Some people believe that the festival originated from a tradition of rolling burning bundles of sticks down the hill to celebrate the end of winter. Today, the festival has grown into an international event, with over 15,000 participants and spectators from all over the world joining each year.<br><br>
            The rules are simple. A large wheel of cheese is rolled down the hill, and participants chase after it. The first runner to make it to the bottom of the hill is the winner. The winner of the race is allowed to keep the cheese as a prize.<br><br>
            Cooper's Hill is only 200 meters long, but it is very steep. As a result, racers do not run down the hill; instead, they usually fall down the hill head over heels. This has led to a lot of accidents. For this reason, the event was officially canceled in 2010. Outraged fans have continued the event unofficially since then.
            
            <h3 style="color:var(--primary); margin-top:30px;">üìö GLOSSARY (B·∫£ng T·ª´ V·ª±ng)</h3>
            <table class="glossary-table">
                <thead>
                    <tr>
                        <th>Word</th>
                        <th>Type</th>
                        <th>Meaning (Vietnamese)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Remote</td><td><span class="academic-tag">Adj</span></td><td>Xa x√¥i, h·∫ªo l√°nh</td></tr>
                    <tr><td>Hazardous</td><td><span class="academic-tag">Adj</span></td><td>Nguy hi·ªÉm (Dangerous)</td></tr>
                    <tr><td>Originate</td><td><span class="academic-tag">Verb</span></td><td>B·∫Øt ngu·ªìn t·ª´</td></tr>
                    <tr><td>Bundle</td><td><span class="academic-tag">Noun</span></td><td>B√≥, g√≥i (que c·ªßi, ƒë·ªì v·∫≠t...)</td></tr>
                    <tr><td>Spectator</td><td><span class="academic-tag">Noun</span></td><td>Kh√°n gi·∫£ (xem s·ª± ki·ªán th·ªÉ thao/ngo√†i tr·ªùi)</td></tr>
                    <tr><td>Steep</td><td><span class="academic-tag">Adj</span></td><td>D·ªëc ƒë·ª©ng</td></tr>
                    <tr><td>Head over heels</td><td><span class="academic-tag">Idiom</span></td><td>L·ªôn nh√†o (ho·∫∑c say m√™ ai ƒë√≥)</td></tr>
                    <tr><td>Outraged</td><td><span class="academic-tag">Adj</span></td><td>Ph·∫´n n·ªô, t·ª©c gi·∫≠n</td></tr>
                    <tr><td>Precaution</td><td><span class="academic-tag">Noun</span></td><td>S·ª± ƒë·ªÅ ph√≤ng, bi·ªán ph√°p an to√†n</td></tr>
                    <tr><td>Triumph</td><td><span class="academic-tag">Noun</span></td><td>Chi·∫øn th·∫Øng v·∫ª vang</td></tr>
                </tbody>
            </table>
        </div>

        <h3 style="color:var(--secondary)">Task A: Match words with definitions</h3>
        <p class="instruction">N·ªëi t·ª´ v·ª±ng ·ªü c·ªôt tr√°i v·ªõi ƒë·ªãnh nghƒ©a ·ªü c·ªôt ph·∫£i.</p>
        <div class="matching-container">
            <div class="col-match" id="col-voc-q"></div>
            <div class="col-match" id="col-voc-a"></div>
        </div>
        <div id="voc-explanation-container"></div>

        <h3 style="color:var(--secondary); margin-top:30px;">Task B: Choose the correct answers</h3>
        <div id="quiz-container-10">
            </div>
    </div>

</div>

<div class="sticky-footer">
    <button class="btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI (SUBMIT)</button>
</div>

<div class="modal" id="resultModal">
    <div class="modal-content">
        <h2>K·∫øt Qu·∫£</h2>
        <div class="score-circle" id="scoreDisplay">0</div>
        <p id="scoreMessage">C·ªë l√™n nh√©!</p>
        <button class="btn-submit" onclick="closeModal()" style="font-size:1rem; padding: 10px 30px;">Xem L·ªùi Gi·∫£i Chi Ti·∫øt</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    // --- DATA ---
    const matchingData = [
        { id: "m1", q: "1. Do you know anything about Hindu festivals?", a: "b. Yeah, I know some.", 
          exp: "C√¢u h·ªèi Yes/No 'Do you know...?' (B·∫°n c√≥ bi·∫øt...?). C√¢u tr·∫£ l·ªùi ph√π h·ª£p nh·∫•t l√† 'Yeah, I know some' (C√≥, t·ªõ bi·∫øt v√†i c√°i)." },
        { id: "m2", q: "2. Could you tell me something about Diwali?", a: "f. Yes, of course.", 
          exp: "L·ªùi ƒë·ªÅ ngh·ªã l·ªãch s·ª± 'Could you tell me...?' (B·∫°n c√≥ th·ªÉ k·ªÉ...). ƒê√°p l·∫°i s·ª± ƒë·ªìng √Ω l·ªãch s·ª±: 'Yes, of course' (ƒê∆∞·ª£c ch·ª©, t·∫•t nhi√™n r·ªìi)." },
        { id: "m3", q: "3. What is Diwali?", a: "a. It's the festival of lights.", 
          exp: "H·ªèi ƒë·ªãnh nghƒ©a 'What is...?' (Diwali l√† g√¨?). Tr·∫£ l·ªùi: 'It's the festival of lights' (ƒê√≥ l√† l·ªÖ h·ªôi √°nh s√°ng)." },
        { id: "m4", q: "4. Where is Diwali celebrated?", a: "g. It's celebrated across the world.", 
          exp: "H·ªèi n∆°i ch·ªën 'Where...?'. Tr·∫£ l·ªùi: 'across the world' (tr√™n to√†n th·∫ø gi·ªõi)." },
        { id: "m5", q: "5. When is Diwali?", a: "d. It is usually some time between October and November.", 
          exp: "H·ªèi th·ªùi gian 'When...?'. Tr·∫£ l·ªùi: 'between October and November' (kho·∫£ng th√°ng 10-11)." },
        { id: "m6", q: "6. How long does Diwali last?", a: "e. For five days.", 
          exp: "H·ªèi bao l√¢u 'How long...?'. Tr·∫£ l·ªùi: 'For five days' (Trong 5 ng√†y)." },
        { id: "m7", q: "7. Why is Diwali held?", a: "h. To celebrate the triumph of light over darkness...", 
          exp: "H·ªèi l√Ω do 'Why...?'. Tr·∫£ l·ªùi b·∫±ng 'To celebrate...' (ƒê·ªÉ ƒÉn m·ª´ng chi·∫øn th·∫Øng c·ªßa √°nh s√°ng tr∆∞·ªõc b√≥ng t·ªëi...)." },
        { id: "m8", q: "8. How is Diwali celebrated?", a: "c. It's celebrated with candles, colourful lights...", 
          exp: "H·ªèi c√°ch th·ª©c 'How...?'. Tr·∫£ l·ªùi m√¥ t·∫£ ho·∫°t ƒë·ªông: 'with candles, lights...' (v·ªõi n·∫øn v√† ƒë√®n m√†u)." }
    ];

    const gapFillData = [
        {
            id: "gf1", question: "(1) _______ for five days.",
            options: [
                { val: "a", text: "a. gets" }, { val: "b", text: "b. lasts" }, { val: "c", text: "c. makes" }, { val: "d", text: "d. longs" }
            ],
            correct: "b",
            trans: "L·ªÖ h·ªôi Carnival... k√©o d√†i trong 5 ng√†y.",
            exp: {
                why: "ƒê·ªông t·ª´ 'last' + kho·∫£ng th·ªùi gian = K√©o d√†i bao l√¢u.",
                wrong: "A. Gets (nh·∫≠n ƒë∆∞·ª£c); C. Makes (l√†m); D. Longs (khao kh√°t - ƒë·ªông t·ª´, ho·∫∑c t√≠nh t·ª´ d√†i)."
            }
        },
        {
            id: "gf2", question: "(2) _______ on the streets.",
            options: [
                { val: "a", text: "a. down" }, { val: "b", text: "b. along" }, { val: "c", text: "c. into" }, { val: "d", text: "d. out" }
            ],
            correct: "d",
            trans: "H√†ng trƒÉm ng∆∞·ªùi ƒëang ·ªü ngo√†i ƒë∆∞·ªùng ph·ªë ('out on the streets').",
            exp: {
                why: "C·ª•m 'out on the streets' nh·∫•n m·∫°nh vi·ªác m·ªçi ng∆∞·ªùi ƒë·ªï ra ƒë∆∞·ªùng vui ch∆°i.",
                wrong: "C√°c gi·ªõi t·ª´ kh√°c kh√¥ng t·∫°o th√†nh collocations t·ª± nhi√™n trong ng·ªØ c·∫£nh 'people are ___ on the streets' ƒë·ªÉ ch·ªâ ƒë√°m ƒë√¥ng t·ª• t·∫≠p."
            }
        },
        {
            id: "gf3", question: "The main (3) _______ of the carnival...",
            options: [
                { val: "a", text: "a. theme" }, { val: "b", text: "b. notice" }, { val: "c", text: "c. highlight" }, { val: "d", text: "d. guide" }
            ],
            correct: "c",
            trans: "ƒêi·ªÉm nh·∫•n ch√≠nh c·ªßa l·ªÖ h·ªôi l√† cu·ªôc di·ªÖu h√†nh Samba.",
            exp: {
                why: "'Highlight' (Danh t·ª´): ƒêi·ªÉm n·ªïi b·∫≠t, s·ª± ki·ªán ch√≠nh.",
                wrong: "A. Theme (ch·ªß ƒë·ªÅ); B. Notice (th√¥ng b√°o); D. Guide (h∆∞·ªõng d·∫´n)."
            }
        },
        {
            id: "gf4", question: "It is an (4) _______ experience!",
            options: [
                { val: "a", text: "a. amazing" }, { val: "b", text: "b. unpleasant" }, { val: "c", text: "c. obvious" }, { val: "d", text: "d. actual" }
            ],
            correct: "a",
            trans: "ƒê√≥ l√† m·ªôt tr·∫£i nghi·ªám tuy·ªát v·ªùi!",
            exp: {
                why: "C·∫ßn t√≠nh t·ª´ mang nghƒ©a t√≠ch c·ª±c m√¥ t·∫£ l·ªÖ h·ªôi. 'Amazing' = Tuy·ªát v·ªùi.",
                wrong: "B. Unpleasant (kh√≥ ch·ªãu); C. Obvious (r√µ r√†ng); D. Actual (th·ª±c t·∫ø)."
            }
        },
        {
            id: "gf5", question: "Come August and it's (5) _______ to have fun...",
            options: [
                { val: "a", text: "a. tradition" }, { val: "b", text: "b. mean" }, { val: "c", text: "c. time" }, { val: "d", text: "d. celebration" }
            ],
            correct: "c",
            trans: "Th√°ng 8 ƒë·∫øn v√† ƒë√≥ l√† th·ªùi gian ƒë·ªÉ vui ch∆°i...",
            exp: {
                why: "C·∫•u tr√∫c: 'It's time to V' (ƒê√£ ƒë·∫øn l√∫c l√†m g√¨).",
                wrong: "A. Tradition (truy·ªÅn th·ªëng - sai ng·ªØ ph√°p); B. Mean (nghƒ©a l√†); D. Celebration (s·ª± ƒÉn m·ª´ng)."
            }
        },
        {
            id: "gf6", question: "Puzzled! (6) _______ does it happen?",
            options: [
                { val: "a", text: "a. Where" }, { val: "b", text: "b. Why" }, { val: "c", text: "c. When" }, { val: "d", text: "d. How" }
            ],
            correct: "b",
            trans: "Kh√≥ hi·ªÉu th·∫≠t! T·∫°i sao n√≥ l·∫°i di·ªÖn ra? (Tr·∫£ l·ªùi: ƒê·ªÉ cho vui - To have fun).",
            exp: {
                why: "C√¢u tr·∫£ l·ªùi l√† 'To have fun' (ch·ªâ m·ª•c ƒë√≠ch) => C√¢u h·ªèi ph·∫£i d√πng 'Why' (T·∫°i sao).",
                wrong: "A. ·ªû ƒë√¢u; C. Khi n√†o; D. Nh∆∞ th·∫ø n√†o."
            }
        },
        {
            id: "gf7", question: "However, the (7) _______ have to take a few precautions.",
            options: [
                { val: "a", text: "a. participants" }, { val: "b", text: "b. viewers" }, { val: "c", text: "c. competitors" }, { val: "d", text: "d. partners" }
            ],
            correct: "a",
            trans: "Tuy nhi√™n, nh·ªØng ng∆∞·ªùi tham gia ph·∫£i th·ª±c hi·ªán v√†i bi·ªán ph√°p ph√≤ng ng·ª´a.",
            exp: {
                why: "'Participants' = Ng∆∞·ªùi tham gia (v√†o cu·ªôc chi·∫øn c√† chua).",
                wrong: "B. Viewers (ng∆∞·ªùi xem - h·ªç ch·ªâ nh√¨n); C. Competitors (ƒë·ªëi th·ªß thi ƒë·∫•u - th∆∞·ªùng d√πng cho th·ªÉ thao h∆°n); D. Partners (ƒë·ªëi t√°c)."
            }
        },
        {
            id: "gf8", question: "Squish the tomatoes (8) _______ throwing...",
            options: [
                { val: "a", text: "a. during" }, { val: "b", text: "b. after" }, { val: "c", text: "c. before" }, { val: "d", text: "d. by" }
            ],
            correct: "c",
            trans: "B√≥p n√°t c√† chua TR∆Ø·ªöC KHI n√©m ƒë·ªÉ kh√¥ng l√†m ƒëau ng∆∞·ªùi kh√°c.",
            exp: {
                why: "V·ªÅ logic an to√†n: Ph·∫£i b√≥p n√°t r·ªìi m·ªõi n√©m => 'Before'.",
                wrong: "A. Trong khi; B. Sau khi; D. B·∫±ng c√°ch."
            }
        }
    ];

    const vocabMatchData = [
        { id: "v1", q: "hazardous", a: "d. dangerous, especially to people's health or safety", 
          exp: "'Hazardous' ƒë·ªìng nghƒ©a v·ªõi 'Dangerous' (Nguy hi·ªÉm)." },
        { id: "v2", q: "originate", a: "c. to start in a particular situation", 
          exp: "'Originate' nghƒ©a l√† b·∫Øt ngu·ªìn, kh·ªüi ƒë·∫ßu ('start')." },
        { id: "v3", q: "bundle", a: "a. a group of things that are tied or wrapped together", 
          exp: "'Bundle' l√† b√≥/g√≥i (ƒë∆∞·ª£c bu·ªôc l·∫°i v·ªõi nhau - 'tied together')." },
        { id: "v4", q: "remote", a: "e. far away from places where people live", 
          exp: "'Remote' l√† xa x√¥i, h·∫ªo l√°nh ('far away')." },
        { id: "v5", q: "fall head over heels", a: "b. to roll or fall down out of control", 
          exp: "'Head over heels' nghƒ©a ƒëen l√† l·ªôn nh√†o (ƒë·∫ßu qua g√≥t ch√¢n), m·∫•t ki·ªÉm so√°t." }
    ];

    const readingMCQData = [
        {
            id: "rm1", question: "1. What is the passage mainly about?",
            options: [
                {val: "a", text: "a. Different food festivals"}, {val: "b", text: "b. An unusual and dangerous festival in England"}, {val: "c", text: "c. Tips for winning"}, {val: "d", text: "d. The history"}
            ],
            correct: "b",
            trans: "ƒêo·∫°n vƒÉn ch·ªß y·∫øu n√≥i v·ªÅ g√¨?",
            exp: {
                why: "B√†i ƒë·ªçc gi·ªõi thi·ªáu 'Cooper's Hill Cheese Rolling Festival' l√† 'one of the weirdest and most hazardous festivals' (m·ªôt trong nh·ªØng l·ªÖ h·ªôi k·ª≥ qu·∫∑c v√† nguy hi·ªÉm nh·∫•t).",
                wrong: "A. Sai v√¨ ch·ªâ n√≥i v·ªÅ 1 l·ªÖ h·ªôi; C v√† D ch·ªâ l√† √Ω nh·ªè."
            }
        },
        {
            id: "rm2", question: "2. What is the origin of the Cheese Rolling Festival?",
            options: [
                {val: "a", text: "a. Held in May"}, {val: "b", text: "b. At Cooper's Hill"}, {val: "c", text: "c. Represent birth of New Year"}, {val: "d", text: "d. It comes from the tradition of rolling burning bundles of sticks..."}
            ],
            correct: "d",
            trans: "Ngu·ªìn g·ªëc c·ªßa l·ªÖ h·ªôi l√† g√¨?",
            exp: {
                why: "D·∫´n ch·ª©ng: 'the festival originated from a tradition of rolling burning bundles of sticks down the hill'.",
                wrong: "A v√† B l√† th·ªùi gian/ƒë·ªãa ƒëi·ªÉm, kh√¥ng ph·∫£i ngu·ªìn g·ªëc."
            }
        },
        {
            id: "rm3", question: "3. The word 'outraged' in the last sentence is closest in meaning to _______.",
            options: [
                {val: "a", text: "a. upset"}, {val: "b", text: "b. pleasant"}, {val: "c", text: "c. keen"}, {val: "d", text: "d. big"}
            ],
            correct: "a",
            trans: "T·ª´ 'outraged' g·∫ßn nghƒ©a nh·∫•t v·ªõi t·ª´ n√†o?",
            exp: {
                why: "'Outraged' = Ph·∫´n n·ªô, t·ª©c gi·∫≠n c·ª±c ƒë·ªô ‚âà Upset (bu·ªìn b·ª±c/t·ª©c gi·∫≠n). Fan t·ª©c gi·∫≠n v√¨ l·ªÖ h·ªôi b·ªã h·ªßy.",
                wrong: "B. D·ªÖ ch·ªãu; C. H·ª©ng th√∫; D. To l·ªõn."
            }
        },
        {
            id: "rm4", question: "4. According to the passage, which of the following is true?",
            options: [
                {val: "a", text: "a. All runners are from England"}, {val: "b", text: "b. Hill is very long"}, {val: "c", text: "c. Most participants cannot stay on their feet while they run down the hill"}, {val: "d", text: "d. Winner is the first to catch the cheese"}
            ],
            correct: "c",
            trans: "Theo b√†i ƒë·ªçc, ƒëi·ªÅu n√†o sau ƒë√¢y l√† ƒë√∫ng?",
            exp: {
                why: "D·∫´n ch·ª©ng: 'racers do not run down... instead, they usually fall down the hill head over heels' (h·ªç kh√¥ng ch·∫°y ƒë∆∞·ª£c m√† th∆∞·ªùng ng√£ l·ªôn nh√†o -> kh√¥ng gi·ªØ ƒë∆∞·ª£c thƒÉng b·∫±ng).",
                wrong: "A. Sai (from all over the world); B. Sai (only 200m long - ng·∫Øn); D. Sai (First runner to make it to the bottom - v·ªÅ ƒë√≠ch tr∆∞·ªõc, kh√¥ng ph·∫£i b·∫Øt ƒë∆∞·ª£c ph√¥ mai v√¨ ph√¥ mai lƒÉn r·∫•t nhanh)."
            }
        },
        {
            id: "rm5", question: "5. The festival was officially canceled in 2010 due to _______.",
            options: [
                {val: "a", text: "a. large number of participants"}, {val: "b", text: "b. bad weather"}, {val: "c", text: "c. steep slopes"}, {val: "d", text: "d. the dangerous aspect of the event"}
            ],
            correct: "d",
            trans: "L·ªÖ h·ªôi b·ªã h·ªßy ch√≠nh th·ª©c nƒÉm 2010 do ƒë√¢u?",
            exp: {
                why: "D·∫´n ch·ª©ng: 'This has led to a lot of accidents. For this reason, the event was officially canceled' (Tai n·∫°n -> S·ª± nguy hi·ªÉm).",
                wrong: "C√°c ph∆∞∆°ng √°n kh√°c l√† y·∫øu t·ªë d·∫´n ƒë·∫øn nguy hi·ªÉm, nh∆∞ng l√Ω do h·ªßy tr·ª±c ti·∫øp l√† do tai n·∫°n/nguy hi·ªÉm."
            }
        }
    ];

    // --- RENDER FUNCTIONS ---
    
    // 1. Matching Game Logic
    let selectedLeft = null;
    let selectedRight = null;
    
    function initMatching(data, qId, aId, expId) {
        const qContainer = document.getElementById(qId);
        const aContainer = document.getElementById(aId);
        
        // Shuffle arrays for display
        const questions = [...data];
        const answers = [...data].sort(() => Math.random() - 0.5);

        questions.forEach(item => {
            const el = document.createElement('div');
            el.className = 'match-item';
            el.innerHTML = item.q;
            el.dataset.id = item.id;
            el.onclick = () => handleMatchClick('left', el, data, expId);
            qContainer.appendChild(el);
        });

        answers.forEach(item => {
            const el = document.createElement('div');
            el.className = 'match-item';
            el.innerHTML = item.a;
            el.dataset.id = item.id;
            el.onclick = () => handleMatchClick('right', el, data, expId);
            aContainer.appendChild(el);
        });
    }

    function handleMatchClick(side, element, dataSet, expId) {
        if (element.classList.contains('matched')) return;

        // Visual select
        if (side === 'left') {
            if (selectedLeft) selectedLeft.classList.remove('selected');
            selectedLeft = element;
        } else {
            if (selectedRight) selectedRight.classList.remove('selected');
            selectedRight = element;
        }
        element.classList.add('selected');

        // Check Match
        if (selectedLeft && selectedRight) {
            const id1 = selectedLeft.dataset.id;
            const id2 = selectedRight.dataset.id;

            if (id1 === id2) {
                // Correct
                successMatch(selectedLeft, selectedRight, id1, dataSet, expId);
            } else {
                // Wrong
                errorMatch(selectedLeft, selectedRight);
            }
            selectedLeft = null;
            selectedRight = null;
        }
    }

    function successMatch(el1, el2, id, dataSet, expId) {
        el1.classList.remove('selected');
        el2.classList.remove('selected');
        el1.classList.add('matched');
        el2.classList.add('matched');
        
        // Confetti small
        confetti({ particleCount: 30, spread: 50, origin: { y: 0.6 } });
        
        // Show explanation
        const item = dataSet.find(x => x.id === id);
        const expContainer = document.getElementById(expId);
        const expHTML = `
            <div class="explanation show" style="margin-bottom:10px;">
                <div class="teacher-avatar">üë©‚Äçüè´ Ms. Mai An gi·∫£i th√≠ch:</div>
                <div><strong>${item.q}</strong> ‚û°Ô∏è <strong>${item.a}</strong></div>
                <div style="margin-top:5px;">${item.exp}</div>
            </div>
        `;
        expContainer.innerHTML += expHTML;
    }

    function errorMatch(el1, el2) {
        el1.classList.add('error-shake');
        el2.classList.add('error-shake');
        setTimeout(() => {
            el1.classList.remove('error-shake', 'selected');
            el2.classList.remove('error-shake', 'selected');
        }, 500);
    }

    // 2. Multiple Choice Render
    function renderMCQ(data, containerId) {
        const container = document.getElementById(containerId);
        data.forEach((item, index) => {
            const qDiv = document.createElement('div');
            qDiv.style.marginBottom = "30px";
            
            const qTitle = document.createElement('h4');
            qTitle.innerHTML = `<span style="color:var(--primary)">C√¢u ${index+1}:</span> ${item.question}`;
            qDiv.appendChild(qTitle);

            item.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerHTML = opt.text;
                btn.onclick = () => checkMCQ(btn, item, qDiv);
                qDiv.appendChild(btn);
            });

            // Explanation Box
            const expDiv = document.createElement('div');
            expDiv.className = 'explanation';
            expDiv.innerHTML = `
                <div class="teacher-avatar">üë©‚Äçüè´ Ms. Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-step"><span class="exp-label bg-blue">D·ªãch c√¢u h·ªèi</span> ${item.trans}</div>
                <div class="exp-step"><span class="exp-label bg-green">T·∫°i sao ƒë√∫ng?</span> ${item.exp.why}</div>
                <div class="exp-step"><span class="exp-label bg-red">T·∫°i sao sai?</span> ${item.exp.wrong}</div>
            `;
            qDiv.appendChild(expDiv);
            container.appendChild(qDiv);
        });
    }

    function checkMCQ(btn, dataItem, container) {
        if (container.classList.contains('answered')) return; // Prevent changing answer
        container.classList.add('answered');

        const selectedVal = btn.innerHTML.trim().charAt(0).toLowerCase(); // Get 'a', 'b'...
        const allBtns = container.querySelectorAll('.btn-option');

        if (selectedVal === dataItem.correct) {
            btn.classList.add('correct');
            confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } });
        } else {
            btn.classList.add('wrong');
            btn.style.animation = "shake 0.4s";
            // Highlight correct one
            allBtns.forEach(b => {
                if (b.innerHTML.trim().charAt(0).toLowerCase() === dataItem.correct) {
                    b.classList.add('correct');
                }
            });
        }

        // Show Explanation
        const expBox = container.querySelector('.explanation');
        expBox.classList.add('show');
    }

    // --- INITIALIZATION ---
    window.onload = function() {
        initMatching(matchingData, 'col-questions', 'col-answers', 'match-explanation-container');
        renderMCQ(gapFillData, 'quiz-container-9');
        initMatching(vocabMatchData, 'col-voc-q', 'col-voc-a', 'voc-explanation-container');
        renderMCQ(readingMCQData, 'quiz-container-10');
    };

    // --- SUBMIT LOGIC ---
    function submitQuiz() {
        // Simple score calculation based on UI state (since interactive)
        const correctBtns = document.querySelectorAll('.btn-option.correct').length;
        const matchedItems = document.querySelectorAll('.match-item.matched').length / 2; // Pairs
        
        const totalScore = correctBtns + matchedItems;
        const totalQuestions = gapFillData.length + readingMCQData.length + matchingData.length + vocabMatchData.length;

        const modal = document.getElementById('resultModal');
        document.getElementById('scoreDisplay').innerText = `${totalScore}/${totalQuestions}`;
        
        let msg = "";
        if (totalScore === totalQuestions) msg = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i! üåü";
        else if (totalScore > totalQuestions * 0.7) msg = "L√†m t·ªët l·∫Øm! Con r·∫•t gi·ªèi! üéâ";
        else msg = "C·ªë g·∫Øng l·∫ßn sau nh√©! H√£y xem l·∫°i l·ªùi gi·∫£i! üí™";
        
        document.getElementById('scoreMessage').innerText = msg;
        modal.style.display = "flex";
        
        if (totalScore > totalQuestions / 2) {
             confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
        }
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = "none";
        // Scroll to explanations
    }

</script>

</body>
</html>