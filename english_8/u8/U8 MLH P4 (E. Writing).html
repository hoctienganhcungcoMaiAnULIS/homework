<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 8: Writing Mastery - Ms Mai An ULIS</title>
    <!-- Nh√∫ng Font Google -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* NgƒÉn b√¥i ƒëen ƒë·ªÉ tr·∫£i nghi·ªám nh∆∞ app */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            /* H·ªça ti·∫øt zigzag/ch·∫•m bi m·ªù */
            background-image: radial-gradient(#8854C0 0.5px, transparent 0.5px), radial-gradient(#8854C0 0.5px, var(--bg-color) 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Header --- */
        header {
            width: 100%;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 5px solid var(--primary-purple);
        }

        h1 {
            margin: 0;
            color: var(--primary-purple);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #636e72;
            margin-top: 5px;
        }

        /* --- Game Container --- */
        .game-container {
            width: 95%;
            max-width: 800px;
            margin: 20px auto;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Progress Bar */
        .progress-wrapper {
            background: #dfe6e9;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            width: 100%;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-teal));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Card Question */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.05), 0 20px 30px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #fff;
            position: relative;
        }

        .q-tag {
            background: var(--primary-purple);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3436;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* 3D Button Style */
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #2d3436;
            cursor: pointer;
            position: relative;
            transition: all 0.1s ease;
            box-shadow: 0 5px 0 #b2bec3; /* 3D effect */
            text-align: left;
            display: flex;
            align-items: center;
            min-height: 80px;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #b2bec3;
            border-color: var(--primary-purple);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: 0 0 0 #b2bec3;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 5px 0 #008f47 !important;
            transform: translateY(0);
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #ff2e40;
            box-shadow: 0 5px 0 #d63031 !important;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* Shake Animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        /* --- Explanation Box (Teacher's Note) --- */
        .explanation-box {
            background: #fff;
            border-radius: 15px;
            border-left: 8px solid var(--primary-purple);
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: none; /* Hidden by default */
            animation: slideUp 0.4s ease-out;
            text-align: left;
        }

        .exp-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .exp-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .exp-title {
            font-weight: 800;
            color: var(--primary-purple);
            font-size: 1.1rem;
        }

        .exp-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #4b4b4b;
            white-space: pre-wrap; /* Gi·ªØ ƒë·ªãnh d·∫°ng xu·ªëng d√≤ng */
        }

        .exp-content strong {
            color: var(--primary-teal);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Next Button */
        .next-btn {
            background: var(--primary-purple);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            box-shadow: 0 5px 0 #5f27cd;
            cursor: pointer;
            margin: 20px auto;
            display: none; /* Hidden by default */
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #5f27cd;
            background: #9b59b6;
        }

        .next-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #5f27cd;
        }

        /* --- Result Screen --- */
        .result-screen {
            display: none;
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
            margin: auto;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            background: var(--primary-teal);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 800;
            color: white;
            margin: 0 auto 20px;
            box-shadow: 0 10px 0 #00a884;
        }

        .message {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-purple);
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <header>
        <h1>Ms Mai An ULIS</h1>
        <div class="subtitle">Unit 8: Writing Mastery - Sentence Building & Transformation</div>
    </header>

    <div class="game-container" id="game-ui">
        <div class="progress-wrapper">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="question-card">
            <span class="q-tag" id="q-tag">Question 1</span>
            <div class="question-text" id="question-text">
                Loading question...
            </div>

            <div class="options-grid" id="options-grid">
                <!-- Options will be injected here -->
            </div>
        </div>

        <div class="explanation-box" id="explanation-box">
            <div class="exp-header">
                <div class="exp-avatar">M</div>
                <div class="exp-title">C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</div>
            </div>
            <div class="exp-content" id="exp-content">
                <!-- Explanation text -->
            </div>
        </div>

        <button class="next-btn" id="next-btn" onclick="nextQuestion()">Ti·∫øp t·ª•c ‚ûî</button>
    </div>

    <!-- Result Screen -->
    <div class="result-screen" id="result-ui">
        <div class="score-circle" id="final-score">0/0</div>
        <div class="message" id="final-message">Tuy·ªát v·ªùi!</div>
        <button class="next-btn" style="display: inline-block;" onclick="location.reload()">L√†m l·∫°i b√†i thi ‚ü≥</button>
    </div>

    <script>
        // --- D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI (DATA) ---
        const quizData = [
            {
                "id": 1,
                "type": "Building",
                "question": "Make a sentence: The shop owner/ always/ treat/ his customers/ respect.",
                "options": [
                    "The shop owner always treats his customers with respect.",
                    "The shop owner always treat his customers with respect.",
                    "The shop owner always treats his customers by respect.",
                    "The shop owner treats always his customers with respect."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** Ch·ªß c·ª≠a h√†ng lu√¥n ƒë·ªëi x·ª≠ v·ªõi kh√°ch h√†ng c·ªßa m√¨nh b·∫±ng s·ª± t√¥n tr·ªçng.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c: Ch·ªß ng·ªØ (The shop owner - s·ªë √≠t) + Tr·∫°ng t·ª´ t·∫ßn su·∫•t (always) + ƒê·ªông t·ª´ (treats - th√™m 's') + T√¢n ng·ªØ (his customers) + C·ª•m gi·ªõi t·ª´ (with respect).\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Ch·ªß ng·ªØ 'The shop owner' l√† ng√¥i th·ª© 3 s·ªë √≠t, ƒë·ªông t·ª´ 'treat' ph·∫£i th√™m 's' -> 'treats'.\n- C: Sai gi·ªõi t·ª´. C·∫•u tr√∫c l√† 'with respect', kh√¥ng d√πng 'by respect'.\n- D: Sai v·ªã tr√≠ tr·∫°ng t·ª´. Tr·∫°ng t·ª´ ch·ªâ t·∫ßn su·∫•t 'always' ph·∫£i ƒë·ª©ng TR∆Ø·ªöC ƒë·ªông t·ª´ th∆∞·ªùng 'treats'."
            },
            {
                "id": 2,
                "type": "Building",
                "question": "Make a sentence: The grand opening/ begin/ 8 o‚Äôclock/ morning/ next Monday.",
                "options": [
                    "The grand opening begins at 8 o‚Äôclock in the morning next Monday.",
                    "The grand opening will begin at 8 o‚Äôclock in the morning on next Monday.",
                    "The grand opening begins on 8 o‚Äôclock in the morning next Monday.",
                    "The grand opening begin at 8 o‚Äôclock in the morning next Monday."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** L·ªÖ khai tr∆∞∆°ng b·∫Øt ƒë·∫ßu l√∫c 8 gi·ªù s√°ng th·ª© Hai t·ªõi.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** L·ªãch tr√¨nh s·ª± ki·ªán trong t∆∞∆°ng lai d√πng th√¨ Hi·ªán t·∫°i ƒë∆°n (begins). Gi·ªõi t·ª´ ch·ªâ th·ªùi gian: 'at' 8 o'clock, 'in' the morning.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Tr∆∞·ªõc 'next Monday' kh√¥ng d√πng gi·ªõi t·ª´ 'on'. Ngo√†i ra, l·ªãch tr√¨nh c·ªë ƒë·ªãnh ∆∞u ti√™n d√πng Hi·ªán t·∫°i ƒë∆°n h∆°n T∆∞∆°ng lai ƒë∆°n.\n- C: Sai gi·ªõi t·ª´. Tr∆∞·ªõc gi·ªù ph·∫£i d√πng 'at', kh√¥ng d√πng 'on'.\n- D: Sai ng·ªØ ph√°p. Ch·ªß ng·ªØ s·ªë √≠t 'The grand opening' th√¨ ƒë·ªông t·ª´ ph·∫£i l√† 'begins'."
            },
            {
                "id": 3,
                "type": "Building",
                "question": "Make a sentence: you/ usually/ bargain/ when/ you/ go/ open-air market?",
                "options": [
                    "Do you usually bargain when you go to an open-air market?",
                    "Are you usually bargain when you go to an open-air market?",
                    "Do you usually bargain when you go an open-air market?",
                    "Do you usually bargain when you go to open-air market?"
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** B·∫°n c√≥ th∆∞·ªùng m·∫∑c c·∫£ khi ƒëi ch·ª£ tr·ªùi kh√¥ng?\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C√¢u h·ªèi nghi v·∫•n hi·ªán t·∫°i ƒë∆°n: Do + S + adv + V...? C·ª•m 'go to a market' (ƒëi ch·ª£). 'An open-air market' (m·ªôt khu ch·ª£ tr·ªùi).\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai tr·ª£ ƒë·ªông t·ª´. ƒê·ªông t·ª´ th∆∞·ªùng 'bargain' ph·∫£i d√πng tr·ª£ ƒë·ªông t·ª´ 'Do', kh√¥ng d√πng 'Are'.\n- C: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† 'go TO' an open-air market.\n- D: Thi·∫øu m·∫°o t·ª´. Danh t·ª´ ƒë·∫øm ƒë∆∞·ª£c s·ªë √≠t 'market' c·∫ßn c√≥ m·∫°o t·ª´ 'an' ho·∫∑c 'the' ph√≠a tr∆∞·ªõc."
            },
            {
                "id": 4,
                "type": "Building",
                "question": "Make a sentence: We/ not file/ a complaint/ if/ the shop assistant/ apologise/ us.",
                "options": [
                    "We won't file a complaint if the shop assistant apologises to us.",
                    "We don't file a complaint if the shop assistant apologises us.",
                    "We won't file a complaint if the shop assistant will apologise to us.",
                    "We won't file a complaint if the shop assistant apologises us."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** Ch√∫ng t√¥i s·∫Ω kh√¥ng khi·∫øu n·∫°i n·∫øu nh√¢n vi√™n b√°n h√†ng xin l·ªói ch√∫ng t√¥i.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1. M·ªánh ƒë·ªÅ ch√≠nh: Future Simple (won't file). M·ªánh ƒë·ªÅ IF: Present Simple (apologises). C·ª•m 'Apologise TO someone' (xin l·ªói ai).\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai c·∫•u tr√∫c & gi·ªõi t·ª´. Thi·∫øu 'to' sau apologises. D√πng 'won't' hay h∆°n 'don't' trong ng·ªØ c·∫£nh gi·∫£ ƒë·ªãnh c·ª• th·ªÉ n√†y.\n- C: Sai ng·ªØ ph√°p. Trong m·ªánh ƒë·ªÅ IF c·ªßa c√¢u ƒëi·ªÅu ki·ªán lo·∫°i 1 kh√¥ng d√πng th√¨ t∆∞∆°ng lai ƒë∆°n (will).\n- D: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† 'apologises TO us'."
            },
            {
                "id": 5,
                "type": "Building",
                "question": "Make a sentence: Shopping centres/ offer/ wide/ range/ products/ choose/ from.",
                "options": [
                    "Shopping centres offer a wide range of products to choose from.",
                    "Shopping centres offer wide range of products to choose from.",
                    "Shopping centres offer a wide range products choose from.",
                    "Shopping centres offer a wide range of products choosing from."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** C√°c trung t√¢m mua s·∫Øm cung c·∫•p nhi·ªÅu lo·∫°i s·∫£n ph·∫©m ƒë·ªÉ l·ª±a ch·ªçn.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·ª•m 'a wide range of' (nhi·ªÅu lo·∫°i/ƒëa d·∫°ng). C·ª•m ƒë·ªông t·ª´ 'choose from' (l·ª±a ch·ªçn t·ª´ nh·ªØng c√°i ƒë√≥).\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Thi·∫øu m·∫°o t·ª´. Ph·∫£i l√† 'A wide range of'.\n- C: Thi·∫øu gi·ªõi t·ª´ 'of' sau range v√† thi·∫øu 'to' tr∆∞·ªõc choose.\n- D: Sai d·∫°ng ƒë·ªông t·ª´. D√πng 'to choose' (m·ª•c ƒë√≠ch/b·ªï ng·ªØ) ch√≠nh x√°c h∆°n 'choosing'."
            },
            {
                "id": 6,
                "type": "Building",
                "question": "Make a sentence: How often/ your mother/ shop/ the local market?",
                "options": [
                    "How often does your mother shop at the local market?",
                    "How often your mother shops at the local market?",
                    "How often does your mother shops at the local market?",
                    "How often does your mother shop the local market?"
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** M·∫π b·∫°n c√≥ th∆∞·ªùng xuy√™n ƒëi ch·ª£ ƒë·ªãa ph∆∞∆°ng kh√¥ng?\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c: How often + tr·ª£ ƒë·ªông t·ª´ (does) + S (your mother) + V (shop) + Preposition (at) + Place?\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai c·∫•u tr√∫c. Thi·∫øu tr·ª£ ƒë·ªông t·ª´ 'does' ƒë·∫£o l√™n tr∆∞·ªõc ch·ªß ng·ªØ.\n- C: Sai chia ƒë·ªông t·ª´. ƒê√£ c√≥ tr·ª£ ƒë·ªông t·ª´ 'does' th√¨ ƒë·ªông t·ª´ ch√≠nh 'shop' ph·∫£i ƒë·ªÉ nguy√™n m·∫´u, kh√¥ng th√™m 's'.\n- D: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† shop 'AT' the market."
            },
            {
                "id": 7,
                "type": "Building",
                "question": "Make a sentence: Although/ they/ go/ shop/ all/ yesterday morning/ they/ not buy/ anything.",
                "options": [
                    "Although they went shopping all yesterday morning, they didn't buy anything.",
                    "Although they went shopping all yesterday morning, but they didn't buy anything.",
                    "Although they go shopping all yesterday morning, they don't buy anything.",
                    "Although they went to shop all yesterday morning, they didn't buy anything."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** M·∫∑c d√π h·ªç ƒë√£ ƒëi mua s·∫Øm c·∫£ s√°ng h√¥m qua, nh∆∞ng h·ªç kh√¥ng mua ƒë∆∞·ª£c g√¨.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** 'Yesterday morning' -> Qu√° kh·ª© ƒë∆°n (went, didn't buy). C·∫•u tr√∫c Although + S + V, S + V.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Ti·∫øng Anh kh√¥ng d√πng 'Although' v√† 'but' trong c√πng m·ªôt c√¢u.\n- C: Sai th√¨. 'Yesterday' l√† qu√° kh·ª©, kh√¥ng d√πng hi·ªán t·∫°i (go/don't).\n- D: Ch∆∞a t·ª± nhi√™n. C·ª•m 'go shopping' (ƒëi mua s·∫Øm) t·ª± nhi√™n h∆°n 'go to shop'."
            },
            {
                "id": 8,
                "type": "Building",
                "question": "Make a sentence: Some people/ go/ shopping malls/ order/ avoid/ the heat/ outside.",
                "options": [
                    "Some people go to shopping malls in order to avoid the heat outside.",
                    "Some people go shopping malls order avoid the heat outside.",
                    "Some people go to shopping malls to order avoid the heat outside.",
                    "Some people go shopping malls in order to avoid the heat outside."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** M·ªôt s·ªë ng∆∞·ªùi ƒë·∫øn c√°c trung t√¢m mua s·∫Øm ƒë·ªÉ tr√°nh c√°i n√≥ng b√™n ngo√†i.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c S + go to + Place + in order to + V (ch·ªâ m·ª•c ƒë√≠ch).\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Thi·∫øu gi·ªõi t·ª´ 'to' sau go, thi·∫øu 'in' v√† 'to' trong c·ª•m 'in order to'.\n- C: Sai c·∫•u tr√∫c. Th·ª´a 'to' tr∆∞·ªõc order, ho·∫∑c th·ª´a 'order' n·∫øu d√πng 'to avoid'. C·ª•m ƒë√∫ng l√† 'in order to'.\n- D: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† go 'TO' shopping malls."
            },
            {
                "id": 9,
                "type": "Transformation",
                "question": "Rewrite: She visits that discount shop all the time to look for cheap products. (Use: always)",
                "options": [
                    "She always visits that discount shop to look for cheap products.",
                    "She visits always that discount shop to look for cheap products.",
                    "She always visit that discount shop to look for cheap products.",
                    "She visits that discount shop to look for cheap products always."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** C√¥ ·∫•y lu√¥n gh√© qua c·ª≠a h√†ng gi·∫£m gi√° ƒë√≥ ƒë·ªÉ t√¨m ƒë·ªì r·∫ª.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** 'all the time' = 'always'. Tr·∫°ng t·ª´ 'always' ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ th∆∞·ªùng 'visits'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai v·ªã tr√≠. 'Always' ph·∫£i ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ 'visits'.\n- C: Sai chia ƒë·ªông t·ª´. 'She' s·ªë √≠t -> 'visits'.\n- D: Sai v·ªã tr√≠. 'Always' √≠t khi ƒë·ª©ng cu·ªëi c√¢u trong vƒÉn phong trang tr·ªçng."
            },
            {
                "id": 10,
                "type": "Transformation",
                "question": "Rewrite: It is difficult for my grandmother to buy things online. (Use: difficulty)",
                "options": [
                    "My grandmother has difficulty (in) buying things online.",
                    "My grandmother has difficulty to buy things online.",
                    "My grandmother is difficulty buying things online.",
                    "My grandmother has difficult buying things online."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** B√† t√¥i g·∫∑p kh√≥ khƒÉn trong vi·ªác mua ƒë·ªì tr·ª±c tuy·∫øn.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c 'have/has difficulty (in) V-ing'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Sau 'have difficulty' ph·∫£i d√πng V-ing, kh√¥ng d√πng to-V.\n- C: Sai ƒë·ªông t·ª´. Ph·∫£i d√πng ƒë·ªông t·ª´ 'have/has', kh√¥ng d√πng to be 'is'.\n- D: Sai t·ª´ lo·∫°i. C·∫ßn danh t·ª´ 'difficulty', kh√¥ng ph·∫£i t√≠nh t·ª´ 'difficult'."
            },
            {
                "id": 11,
                "type": "Transformation",
                "question": "Rewrite: Tim didn‚Äôt like Takashimaya because their products were expensive. (Use: of)",
                "options": [
                    "Because of the expensive products, Tim didn‚Äôt like Takashimaya.",
                    "Because of their products were expensive, Tim didn‚Äôt like Takashimaya.",
                    "Because of the expensive of their products, Tim didn‚Äôt like Takashimaya.",
                    "Because of Tim didn't like Takashimaya, their products were expensive."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** V√¨ nh·ªØng s·∫£n ph·∫©m ƒë·∫Øt ƒë·ªè, Tim kh√¥ng th√≠ch Takashimaya.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c 'Because of + Noun Phrase'. 'their products were expensive' -> 'the expensive products'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Sau 'Because of' kh√¥ng ƒë∆∞·ª£c l√† m·ªôt m·ªánh ƒë·ªÅ (c√≥ ƒë·ªông t·ª´ 'were').\n- C: Sai ng·ªØ ph√°p. 'The expensive' l√† t√≠nh t·ª´, kh√¥ng ƒë·ª©ng l√†m danh t·ª´ ch√≠nh ƒë∆∞·ª£c.\n- D: Sai nghƒ©a ho√†n to√†n (ƒê·∫£o ng∆∞·ª£c nguy√™n nh√¢n k·∫øt qu·∫£)."
            },
            {
                "id": 12,
                "type": "Transformation",
                "question": "Rewrite: The children almost never come to that open-air market. (Use: rarely)",
                "options": [
                    "The children rarely come to that open-air market.",
                    "The children come rarely to that open-air market.",
                    "Rarely the children come to that open-air market.",
                    "The children don't rarely come to that open-air market."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** L≈© tr·∫ª hi·∫øm khi ƒë·∫øn khu ch·ª£ tr·ªùi ƒë√≥.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** 'almost never' = 'rarely'. Tr·∫°ng t·ª´ t·∫ßn su·∫•t ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ th∆∞·ªùng 'come'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai v·ªã tr√≠. Tr·∫°ng t·ª´ t·∫ßn su·∫•t th∆∞·ªùng ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ ch√≠nh.\n- C: Sai ng·ªØ ph√°p. N·∫øu 'Rarely' ƒë·ª©ng ƒë·∫ßu c√¢u ph·∫£i ƒë·∫£o ng·ªØ (Rarely do the children come...).\n- D: Sai nghƒ©a. Ph·ªß ƒë·ªãnh k√©p (don't + rarely) l√†m sai l·ªách √Ω nghƒ©a c√¢u g·ªëc."
            },
            {
                "id": 13,
                "type": "Transformation",
                "question": "Rewrite: It took us two hours to explore every shop at the mall. (Use: spent)",
                "options": [
                    "We spent two hours exploring every shop at the mall.",
                    "We spent two hours to explore every shop at the mall.",
                    "We spent two hours explore every shop at the mall.",
                    "We spent two hours on explore every shop at the mall."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** Ch√∫ng t√¥i ƒë√£ d√†nh hai gi·ªù ƒë·ªÉ kh√°m ph√° m·ªçi c·ª≠a h√†ng t·∫°i trung t√¢m mua s·∫Øm.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c 'It took SB + time + to V' = 'SB + spent + time + V-ing'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Sau 'spend time' ph·∫£i l√† V-ing, kh√¥ng ph·∫£i to-V.\n- C: Sai ng·ªØ ph√°p. Thi·∫øu ƒëu√¥i -ing.\n- D: Sai ng·ªØ ph√°p. Sau gi·ªõi t·ª´ 'on' ph·∫£i l√† danh t·ª´ ho·∫∑c V-ing (on exploring)."
            },
            {
                "id": 14,
                "type": "Transformation",
                "question": "Rewrite: That luxury bag is too expensive for Sarah to buy. (Use: so)",
                "options": [
                    "That luxury bag is so expensive that Sarah can't buy it.",
                    "That luxury bag is so expensive for Sarah to buy.",
                    "That luxury bag is so expensive that Sarah can't buy.",
                    "That luxury bag is so expensive that Sarah buys it."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** Chi·∫øc t√∫i sang tr·ªçng ƒë√≥ ƒë·∫Øt ƒë·∫øn n·ªói Sarah kh√¥ng th·ªÉ mua n√≥.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c 'S + be + so + adj + THAT + S + can't/couldn't + V + O'. Ph·∫£i th√™m t√¢n ng·ªØ 'it' ·ªü cu·ªëi.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai c·∫•u tr√∫c. 'So' kh√¥ng ƒëi v·ªõi 'for...to...'.\n- C: Thi·∫øu t√¢n ng·ªØ. ƒê·ªông t·ª´ 'buy' c·∫ßn t√¢n ng·ªØ 'it' trong m·ªánh ƒë·ªÅ sau 'that'.\n- D: Sai nghƒ©a. ƒê·∫Øt qu√° th√¨ KH√îNG mua ƒë∆∞·ª£c (can't buy)."
            },
            {
                "id": 15,
                "type": "Transformation",
                "question": "Rewrite: Katie went shopping all morning, but she didn‚Äôt buy anything. (Use: although)",
                "options": [
                    "Although Katie went shopping all morning, she didn‚Äôt buy anything.",
                    "Although Katie went shopping all morning, but she didn‚Äôt buy anything.",
                    "Katie went shopping all morning although she didn‚Äôt buy anything.",
                    "Although she didn‚Äôt buy anything, Katie went shopping all morning."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** M·∫∑c d√π Katie ƒëi mua s·∫Øm c·∫£ s√°ng, nh∆∞ng c√¥ ·∫•y kh√¥ng mua g√¨ c·∫£.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** D√πng 'Although' th√¨ KH√îNG d√πng 'but'. C·∫•u tr√∫c Although + S + V, S + V.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. C√≥ 'Although' th√¨ b·ªè 'but'.\n- C: Sai logic. Nghƒ©a c√¢u n√†y l√† 'Katie ƒëi mua s·∫Øm m·∫∑c d√π kh√¥ng mua g√¨' (Ng∆∞·ª£c nh√¢n qu·∫£).\n- D: Sai logic. M·∫∑c d√π kh√¥ng mua g√¨, c√¥ ·∫•y ƒë√£ ƒëi mua s·∫Øm (Ng∆∞·ª£c nghƒ©a)."
            },
            {
                "id": 16,
                "type": "Transformation",
                "question": "Rewrite: I can‚Äôt wait to see the shops at Suria KLCC in Kuala Lumpur. (Use: forward)",
                "options": [
                    "I am looking forward to seeing the shops at Suria KLCC in Kuala Lumpur.",
                    "I am looking forward to see the shops at Suria KLCC in Kuala Lumpur.",
                    "I look forward seeing the shops at Suria KLCC in Kuala Lumpur.",
                    "I am looking forward seeing the shops at Suria KLCC in Kuala Lumpur."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** T√¥i ƒëang r·∫•t mong ch·ªù ƒë∆∞·ª£c ng·∫Øm c√°c c·ª≠a h√†ng t·∫°i Suria KLCC ·ªü Kuala Lumpur.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C·∫•u tr√∫c 'look forward to + V-ing'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. Sau 'look forward to' ph·∫£i l√† V-ing, kh√¥ng ph·∫£i V nguy√™n th·ªÉ.\n- C: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† 'look forward TO' seeing.\n- D: Thi·∫øu gi·ªõi t·ª´. Ph·∫£i l√† 'to seeing'."
            },
            {
                "id": 17,
                "type": "Transformation",
                "question": "Rewrite: What time does your plane land tomorrow? (Use: when)\n-> Can you tell ...",
                "options": [
                    "Can you tell me when your plane lands tomorrow?",
                    "Can you tell me when does your plane land tomorrow?",
                    "Can you tell me when your plane land tomorrow?",
                    "Can you tell me when will your plane land tomorrow?"
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** B·∫°n c√≥ th·ªÉ cho t√¥i bi·∫øt khi n√†o m√°y bay c·ªßa b·∫°n h·∫° c√°nh ng√†y mai kh√¥ng?\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** C√¢u h·ªèi gi√°n ti·∫øp (Indirect Question): Wh-word + S + V (kh√¥ng ƒë·∫£o ng·ªØ). 'your plane lands'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai c·∫•u tr√∫c. C√¢u h·ªèi gi√°n ti·∫øp kh√¥ng ƒë∆∞·ª£c ƒë·∫£o ng·ªØ (kh√¥ng d√πng 'does' tr∆∞·ªõc ch·ªß ng·ªØ).\n- C: Sai chia ƒë·ªông t·ª´. 'Your plane' l√† s·ªë √≠t, ƒë·ªông t·ª´ 'land' ph·∫£i th√™m 's' -> 'lands'.\n- D: Sai th√¨ & c·∫•u tr√∫c. L·ªãch tr√¨nh ∆∞u ti√™n Hi·ªán t·∫°i ƒë∆°n, v√† kh√¥ng ƒë·∫£o ng·ªØ 'will' l√™n tr∆∞·ªõc."
            },
            {
                "id": 18,
                "type": "Transformation",
                "question": "Rewrite: If we don‚Äôt hurry, we can‚Äôt go to the speciality shop as planned. (Use: unless)",
                "options": [
                    "We can‚Äôt go to the speciality shop as planned unless we hurry.",
                    "Unless we don't hurry, we can‚Äôt go to the speciality shop as planned.",
                    "We can go to the speciality shop as planned unless we hurry.",
                    "Unless we hurry, we can go to the speciality shop as planned."
                ],
                "correctIndex": 0,
                "explanation": "**D·ªãch nghƒ©a:** Ch√∫ng ta kh√¥ng th·ªÉ ƒë·∫øn c·ª≠a h√†ng chuy√™n doanh nh∆∞ k·∫ø ho·∫°ch tr·ª´ khi ch√∫ng ta nhanh l√™n.\n\n**Ph√¢n t√≠ch chi ti·∫øt:**\n- **ƒê√°p √°n A (ƒê√öNG):** 'Unless' = 'If ... not'. 'If we don't hurry' = 'Unless we hurry'. Gi·ªØ nguy√™n v·∫ø ch√≠nh ph·ªß ƒë·ªãnh 'can't go'.\n\n**T·∫°i sao c√°c ƒë√°p √°n kh√°c SAI?**\n- B: Sai ng·ªØ ph√°p. 'Unless' ƒë√£ mang nghƒ©a ph·ªß ƒë·ªãnh, kh√¥ng d√πng th√™m 'don't'.\n- C: Sai nghƒ©a. M·∫•t 'not' ·ªü v·∫ø ch√≠nh -> Nghƒ©a ng∆∞·ª£c l·∫°i.\n- D: Sai nghƒ©a. (Tr·ª´ khi nhanh l√™n, ch√∫ng ta m·ªõi c√≥ th·ªÉ ƒëi... -> Nghe c√≥ v·∫ª ƒë√∫ng nh∆∞ng c√¢u g·ªëc l√† 'can't go', c·∫•u tr√∫c chu·∫©n l√† gi·ªØ nguy√™n ph·ªß ƒë·ªãnh ·ªü v·∫ø ch√≠nh)."
            }
        ];

        // --- TR·∫†NG TH√ÅI GAME ---
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;

        // --- DOM ELEMENTS ---
        const progressBar = document.getElementById('progress-bar');
        const qTag = document.getElementById('q-tag');
        const questionText = document.getElementById('question-text');
        const optionsGrid = document.getElementById('options-grid');
        const explanationBox = document.getElementById('explanation-box');
        const expContent = document.getElementById('exp-content');
        const nextBtn = document.getElementById('next-btn');
        const gameUI = document.getElementById('game-ui');
        const resultUI = document.getElementById('result-ui');
        const finalScore = document.getElementById('final-score');
        const finalMessage = document.getElementById('final-message');

        // --- SOUND SYSTEM (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Ti·∫øng Ding (High Pitch Sine Wave)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Ti·∫øng Buzz (Low Pitch Sawtooth)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'win') {
                // Ti·∫øng chi·∫øn th·∫Øng
                 osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.setValueAtTime(600, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(800, audioCtx.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
                osc.start();
                osc.stop(audioCtx.currentTime + 1);
            }
        }

        // --- CONFETTI SYSTEM ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let confettiParticles = [];

        function fireConfetti() {
            const colors = ['#8854C0', '#00C9A7', '#FF4757', '#F1C40F', '#3498DB'];
            for (let i = 0; i < 100; i++) {
                confettiParticles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    r: Math.random() * 6 + 2,
                    dx: Math.random() * 10 - 5,
                    dy: Math.random() * 10 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    life: 100
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if (confettiParticles.length === 0) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < confettiParticles.length; i++) {
                let p = confettiParticles[i];
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.fill();
                p.x += p.dx;
                p.y += p.dy;
                p.dy += 0.2; // Gravity
                p.life--;
            }
            confettiParticles = confettiParticles.filter(p => p.life > 0);
            if (confettiParticles.length > 0) requestAnimationFrame(animateConfetti);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // --- GAME LOGIC ---

        function loadQuestion() {
            // Reset state
            answered = false;
            explanationBox.style.display = 'none';
            nextBtn.style.display = 'none';
            
            // Get data
            const currentQ = quizData[currentQuestionIndex];
            
            // Update UI
            qTag.textContent = `C√¢u ${currentQuestionIndex + 1} / ${quizData.length} - ${currentQ.type === 'Building' ? 'X√¢y d·ª±ng c√¢u' : 'Vi·∫øt l·∫°i c√¢u'}`;
            questionText.textContent = currentQ.question;
            
            // Update Progress Bar
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;

            // Render Options
            optionsGrid.innerHTML = '';
            currentQ.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(index, btn);
                optionsGrid.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (answered) return;
            answered = true;

            const currentQ = quizData[currentQuestionIndex];
            const isCorrect = selectedIndex === currentQ.correctIndex;
            const buttons = document.querySelectorAll('.option-btn');

            if (isCorrect) {
                btnElement.classList.add('correct');
                playSound('correct');
                fireConfetti();
                score++;
            } else {
                btnElement.classList.add('wrong');
                playSound('wrong');
                // Highlight correct answer
                buttons[currentQ.correctIndex].classList.add('correct');
            }

            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);

            // Show Explanation
            expContent.innerHTML = currentQ.explanation.replace(/\n/g, '<br>');
            explanationBox.style.display = 'block';
            explanationBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Show Next Button
            nextBtn.style.display = 'block';
            
            // Update text of Next Button based on position
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.textContent = 'HO√ÄN TH√ÄNH - XEM ƒêI·ªÇM';
            } else {
                nextBtn.textContent = 'Ti·∫øp t·ª•c ‚ûî';
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
                window.scrollTo(0, 0);
            } else {
                showResults();
            }
        }

        function showResults() {
            gameUI.style.display = 'none';
            resultUI.style.display = 'block';
            
            finalScore.textContent = `${score}/${quizData.length}`;
            playSound('win');
            fireConfetti(); // Big confetti for finish

            let msg = "";
            const percentage = (score / quizData.length) * 100;
            if (percentage === 100) msg = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ti·∫øng Anh! üåü";
            else if (percentage >= 80) msg = "L√†m t·ªët l·∫Øm! B·∫°n r·∫•t ch·∫Øc ki·∫øn th·ª©c! üî•";
            else if (percentage >= 50) msg = "Kh√° l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
            else msg = "ƒê·ª´ng bu·ªìn! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nh√©! üìö";
            
            finalMessage.textContent = msg;
        }

        // --- INIT ---
        loadQuestion();

        // Resize canvas on window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

    </script>
</body>
</html>
