<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Tập Tiếng Anh - Ms Mai An ULIS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#d7d7d7 1px, transparent 1px), radial-gradient(#d7d7d7 1px, transparent 1px);
            background-position: 0 0, 20px 20px;
            background-size: 40px 40px;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            margin-top: 20px;
            margin-bottom: 50px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-pink), var(--primary-teal));
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            color: white;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .score-board {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2rem;
            backdrop-filter: blur(5px);
        }

        /* Question Card */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05), 0 20px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            transition: transform 0.3s ease;
            position: relative;
        }

        .question-header {
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .original-text-box {
            background: #f1f9f8;
            border-left: 5px solid var(--primary-teal);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            color: #444;
        }

        /* Reading/Arrangement Layout */
        .arrangement-box {
            background: #fff8e1;
            border: 2px dashed #ffd54f;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .arrangement-item {
            margin-bottom: 8px;
            display: block;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-bottom: 6px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            position: relative;
            display: flex;
            align-items: center;
        }

        .option-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--primary-pink);
            border-bottom-color: var(--primary-pink);
            background-color: #fcf6ff;
        }

        .option-letter {
            background: #eee;
            color: #777;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            margin-right: 15px;
            flex-shrink: 0;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-green);
            border-color: #00a855;
            border-bottom-color: #008f48;
            color: white;
        }
        .option-btn.correct .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            border-color: #d63030;
            border-bottom-color: #b02121;
            color: white;
        }
        .option-btn.wrong .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background: #eaf6ff;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #b3d9ff;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .teacher-avatar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 2px dashed #b3d9ff;
            padding-bottom: 10px;
        }

        .avatar-circle {
            width: 50px;
            height: 50px;
            background: var(--primary-pink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 15px;
            border: 3px solid white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }

        .teacher-name {
            font-weight: 800;
            color: var(--primary-pink);
            font-size: 1.1rem;
        }

        .explain-step {
            margin-bottom: 15px;
        }

        .step-title {
            font-weight: 800;
            color: #2980b9;
            text-transform: uppercase;
            font-size: 0.8rem;
            margin-bottom: 5px;
            display: block;
        }

        .step-content {
            font-size: 1rem;
            color: #34495e;
            line-height: 1.6;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .vocab-table th {
            background: var(--primary-teal);
            color: white;
            padding: 8px;
            text-align: left;
        }

        .vocab-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        /* Glossary Section within Question */
        .glossary-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .glossary-title {
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 10px;
            display: block;
        }

        /* Animations */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s;
        }

        /* Footer */
        .quiz-footer {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            border-bottom: 6px solid #6c429c;
            padding: 15px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 800;
            transition: all 0.2s;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.4);
        }

        .submit-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        /* Result Popup */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: slideDown 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .score-circle {
            width: 120px;
            height: 120px;
            background: var(--primary-teal);
            color: white;
            font-size: 2.5rem;
            font-weight: 900;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 10px 20px rgba(0,201,167,0.4);
        }

        .feedback-text {
            font-size: 1.5rem;
            color: var(--text-color);
            margin-bottom: 20px;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1><i class="fas fa-graduation-cap"></i> Ms Mai An ULIS</h1>
            <p>Bài kiểm tra Tiếng Anh 9 - Global Success</p>
            <div class="score-board">
                Điểm: <span id="current-score">0</span>
            </div>
        </header>

        <div id="quiz-area">
            </div>

        <div class="quiz-footer">
            <button class="submit-btn" onclick="finishQuiz()">
                <i class="fas fa-flag-checkered"></i> Nộp Bài
            </button>
        </div>
    </div>

    <div id="result-modal" class="result-modal">
        <div class="result-content">
            <div class="score-circle" id="final-score">0/19</div>
            <h2 style="color: var(--primary-pink); margin-bottom: 10px;">Kết quả của bạn!</h2>
            <p class="feedback-text" id="feedback-msg">Bạn làm tốt lắm!</p>
            <button class="submit-btn" onclick="location.reload()">Làm lại bài</button>
        </div>
    </div>

    <script>
        // Dữ liệu bài tập (Exercise 3, 4, 5)
        const quizData = [
            // Exercise 3: Combine Sentences
            {
                id: 1,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "1. The United States has a large English-speaking population. English is the dominant language there.",
                options: [
                    "A. The United States has a large English-speaking population the dominant language there.",
                    "B. The United States which has a large English-speaking population is the dominant language.",
                    "C. The United States where English is the dominant language has a large English-speaking population.",
                    "D. There is a large English-speaking population in the United States the dominant language."
                ],
                correct: 2, // C
                explanation: {
                    translateQ: "Hoa Kỳ có dân số nói tiếng Anh lớn. Tiếng Anh là ngôn ngữ thống trị ở đó.",
                    translateOpt: [
                        "A. Hoa Kỳ có dân số nói tiếng Anh lớn ngôn ngữ thống trị ở đó. (Câu cụt, sai ngữ pháp)",
                        "B. Hoa Kỳ, nơi có dân số nói tiếng Anh lớn, là ngôn ngữ thống trị. (Sai nghĩa: Hoa Kỳ không phải là ngôn ngữ)",
                        "C. Hoa Kỳ, nơi tiếng Anh là ngôn ngữ thống trị, có dân số nói tiếng Anh lớn.",
                        "D. Có một dân số nói tiếng Anh lớn ở Hoa Kỳ ngôn ngữ thống trị. (Câu lủng củng)"
                    ],
                    whyCorrect: "Sử dụng đại từ quan hệ trạng ngữ **'where'** thay thế cho 'there' để chỉ địa điểm (The United States). Mệnh đề 'where English is the dominant language' bổ nghĩa cho 'The United States'.",
                    whyWrong: "Các đáp án khác sai ngữ pháp (Fragment) hoặc sai nghĩa cơ bản của câu gốc."
                }
            },
            {
                id: 2,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "2. Many countries offer English language courses. These courses help people learn English for business.",
                options: [
                    "A. Many countries offer English language courses that help people learn English for business.",
                    "B. These courses that help people learn English for business offer in many countries.",
                    "C. English language courses offered by many countries help people learn English for business.",
                    "D. Many countries offer English language courses who help people learn English for business."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Nhiều quốc gia cung cấp các khóa học tiếng Anh. Những khóa học này giúp mọi người học tiếng Anh thương mại.",
                    translateOpt: [
                        "A. Nhiều quốc gia cung cấp các khóa học tiếng Anh, cái mà giúp mọi người học tiếng Anh thương mại.",
                        "B. Những khóa học giúp mọi người... cung cấp ở nhiều quốc gia. (Sai ngữ pháp: thiếu bị động 'are offered')",
                        "C. Các khóa học tiếng Anh được cung cấp bởi nhiều quốc gia giúp... (Đúng ngữ pháp nhưng thay đổi chủ ngữ chính, tuy nhiên A sát nghĩa gốc nhất về cấu trúc câu nối)",
                        "D. Dùng 'who' cho vật (courses). (Sai ngữ pháp)"
                    ],
                    whyCorrect: "Sử dụng đại từ quan hệ **'that'** (hoặc 'which') để thay thế cho danh từ chỉ vật 'English language courses'. Câu A kết nối tự nhiên nhất.",
                    whyWrong: "B sai dạng bị động (offer -> are offered). D sai đại từ quan hệ ('who' chỉ dùng cho người). C đúng ngữ pháp nhưng A là cách nối câu trực tiếp dùng Relative Clause chuẩn nhất cho bài tập này."
                }
            },
            {
                id: 3,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "3. Australia has a unique variety of wildlife. Many tourists visit there each year.",
                options: [
                    "A. Australia has a unique variety of wildlife that many tourists visit there each year.",
                    "B. Australia where many tourists visit each year has a unique variety of wildlife.",
                    "C. Many tourists visit Australia which is a country with a unique variety of wildlife.",
                    "D. There’s a unique variety of wildlife in Australia whom many tourists visit it each year."
                ],
                correct: 1, // B
                explanation: {
                    translateQ: "Úc có sự đa dạng độc đáo về động vật hoang dã. Nhiều du khách đến thăm đó mỗi năm.",
                    translateOpt: [
                        "A. Sai vì dư từ 'there' trong mệnh đề quan hệ.",
                        "B. Úc, nơi nhiều du khách đến thăm hàng năm, có sự đa dạng độc đáo về động vật hoang dã.",
                        "C. Nhiều du khách thăm Úc, quốc gia có... (Đổi trọng tâm câu).",
                        "D. Sai vì dùng 'whom' cho vật/địa điểm và dư từ 'it'."
                    ],
                    whyCorrect: "Sử dụng **'where'** thay thế cho 'there' để tạo mệnh đề quan hệ chỉ nơi chốn. Cấu trúc: Noun (Place) + where + S + V...",
                    whyWrong: "A và D mắc lỗi thừa từ (visit THERE, visit IT) trong mệnh đề quan hệ. C thay đổi cấu trúc câu gốc quá nhiều."
                }
            },
            {
                id: 4,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "4. Many English words come from other languages. These words enrich the English vocabulary.",
                options: [
                    "A. There are many English words coming from other languages to enrich the vocabulary.",
                    "B. Enriching the English vocabulary, many English words come from other languages.",
                    "C. Other languages are the source of many English words, which enrich the vocabulary.",
                    "D. Many English words come from other languages that enrich the English vocabulary."
                ],
                correct: 3, // D
                explanation: {
                    translateQ: "Nhiều từ tiếng Anh đến từ các ngôn ngữ khác. Những từ này làm phong phú vốn từ vựng tiếng Anh.",
                    translateOpt: [
                        "A. Có nhiều từ tiếng Anh... để làm phong phú. (Sai nghĩa 'purpose' - mục đích)",
                        "B. Làm phong phú vốn từ, nhiều từ tiếng Anh... (Rút gọn mệnh đề quan hệ, chấp nhận được nhưng D trực tiếp hơn).",
                        "C. Ngôn ngữ khác là nguồn... (Thay đổi chủ ngữ).",
                        "D. Nhiều từ tiếng Anh đến từ các ngôn ngữ khác, cái mà làm phong phú vốn từ vựng tiếng Anh."
                    ],
                    whyCorrect: "Sử dụng đại từ quan hệ **'that'** thay thế cho cả cụm ý trước hoặc danh từ 'languages/words' (ở đây hiểu là việc mượn từ làm phong phú). Câu D kết hợp mượt mà nhất.",
                    whyWrong: "A dùng 'to enrich' chỉ mục đích (không đúng ý gốc là kết quả/tính chất). C thay đổi chủ ngữ."
                }
            },
            {
                id: 5,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "5. Studying English grammar can be challenging. It helps you communicate more effectively.",
                options: [
                    "A. Studying English grammar, which helps you communicate more effectively, can be challenging.",
                    "B. It helps you communicate more effectively although studying English grammar can be challenging.",
                    "C. There’s a challenge in studying English grammar, which helps with better communication.",
                    "D. English grammar can be challenging to learn, but it helps for effective communication."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Học ngữ pháp tiếng Anh có thể đầy thách thức. Nó giúp bạn giao tiếp hiệu quả hơn.",
                    translateOpt: [
                        "A. Việc học ngữ pháp TA, cái mà giúp bạn giao tiếp hiệu quả hơn, thì có thể đầy thách thức.",
                        "B. Câu lủng củng về đại từ 'It' đứng đầu.",
                        "C. Thay đổi cấu trúc quá nhiều.",
                        "D. Ngữ pháp TA thì khó học, nhưng nó giúp... (Dùng 'but' cũng đúng nhưng bài đang tập trung Relative Clause, A academic hơn)."
                    ],
                    whyCorrect: "Sử dụng mệnh đề quan hệ không xác định (Non-defining relative clause) **', which...'** để thêm thông tin bổ sung về việc học ngữ pháp.",
                    whyWrong: "D là câu ghép dùng 'but', không sai về nghĩa nhưng trong bối cảnh bài tập nối câu nâng cao, A được ưu tiên vì dùng cấu trúc lồng ghép."
                }
            },
            {
                id: 6,
                type: "combine",
                category: "Exercise 3: Choose the sentence that best combines the original ones.",
                question: "6. English movies and TV shows are popular worldwide. They are enjoyed by people of all ages and cultures.",
                options: [
                    "A. English movies and TV shows, which are enjoyed by people of all ages and cultures, are popular worldwide.",
                    "B. English movies and TV shows are popular worldwide enjoyed by people of all ages and cultures.",
                    "C. They are enjoyed by people of all ages and cultures, English movies and TV shows are popular worldwide.",
                    "D. Popularity worldwide surrounds English movies and TV shows, enjoyed by people of all ages and cultures."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Phim và chương trình truyền hình tiếng Anh phổ biến toàn cầu. Chúng được yêu thích bởi mọi lứa tuổi và văn hóa.",
                    translateOpt: [
                        "A. Phim... TA, cái mà được yêu thích bởi..., thì phổ biến toàn cầu.",
                        "B. Thiếu đại từ quan hệ hoặc dấu phẩy cho rút gọn mệnh đề (cần 'which are' hoặc ', enjoyed').",
                        "C. Lỗi Run-on sentence (hai câu đơn nối nhau bằng dấu phẩy).",
                        "D. Diễn đạt cồng kềnh, thiếu tự nhiên."
                    ],
                    whyCorrect: "Sử dụng Mệnh đề quan hệ không xác định **', which are enjoyed...'** xen vào giữa chủ ngữ và động từ chính để bổ sung thông tin.",
                    whyWrong: "B sai ngữ pháp (thiếu liên từ/quan hệ từ). C sai lỗi dấu câu (comma splice)."
                }
            },

            // Exercise 4: Closest Meaning
            {
                id: 7,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "1. You can easily form a relationship with some people.",
                options: [
                    "A. Some people are easy to form a relationship.",
                    "B. It's easy to form a relationship with some people.",
                    "C. There are some people with whom you can easily form a relationship.",
                    "D. You can easily form a relationship with anyone."
                ],
                correct: 2, // C
                explanation: {
                    translateQ: "Bạn có thể dễ dàng thiết lập mối quan hệ với một số người.",
                    translateOpt: [
                        "A. Một số người thì dễ để thiết lập... (Thiếu 'with').",
                        "B. Thật dễ để thiết lập quan hệ với một số người.",
                        "C. Có một số người mà với họ bạn có thể dễ dàng thiết lập mối quan hệ.",
                        "D. Bạn có thể... với bất kỳ ai (Sai nghĩa 'some' vs 'anyone')."
                    ],
                    whyCorrect: "Đáp án C sử dụng cấu trúc **'with whom'** (giới từ + đại từ quan hệ) rất trang trọng và chính xác, giữ nguyên nghĩa gốc nhấn mạnh vào đối tượng 'some people'.",
                    whyWrong: "A thiếu giới từ cuối câu ('relationship with'). B đúng nhưng C sát nghĩa về cấu trúc nhấn mạnh đối tượng hơn. D sai nghĩa từ vựng."
                }
            },
            {
                id: 8,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "2. Nancy always plays tricks on me in front of my classmates.",
                options: [
                    "A. Nancy is the one who always plays tricks on me in front of my classmates.",
                    "B. My classmates and Nancy always play tricks on me.",
                    "C. Nancy always plays tricks on my classmates.",
                    "D. Nancy is always tricked by me in front of my classmates."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Nancy luôn trêu chọc tôi trước mặt các bạn cùng lớp.",
                    translateOpt: [
                        "A. Nancy chính là người luôn trêu chọc tôi trước mặt các bạn.",
                        "B. Các bạn và Nancy luôn trêu tôi (Sai chủ ngữ).",
                        "C. Nancy trêu các bạn (Sai tân ngữ).",
                        "D. Nancy bị tôi trêu (Sai nghĩa bị động)."
                    ],
                    whyCorrect: "Đây là cấu trúc **Cleft Sentence (Câu chẻ)**: 'It is/was + S + who + V...', dùng để nhấn mạnh chủ ngữ (Nancy).",
                    whyWrong: "B, C, D đều thay đổi ý nghĩa gốc của câu (ai làm gì ai)."
                }
            },
            {
                id: 9,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "3. This is the most useful English lesson we’ve ever had.",
                options: [
                    "A. We’ve never had such a useful English lesson.",
                    "B. We’ve never had a more useful English lesson than this.",
                    "C. This is the first time we have had such a useful English lesson.",
                    "D. This English lesson is more useful than any others."
                ],
                correct: 1, // B
                explanation: {
                    translateQ: "Đây là bài học tiếng Anh hữu ích nhất mà chúng tôi từng có.",
                    translateOpt: [
                        "A. Chúng tôi chưa bao giờ có bài học hữu ích như vậy (Thiếu so sánh hơn/nhất với bài hiện tại).",
                        "B. Chúng tôi chưa bao giờ có bài học tiếng Anh nào hữu ích hơn bài này.",
                        "C. Đây là lần đầu tiên... (Không nhấn mạnh tính 'nhất').",
                        "D. Bài này hữu ích hơn bất kỳ bài nào khác (Thiếu thì hiện tại hoàn thành 'ever had')."
                    ],
                    whyCorrect: "Cấu trúc so sánh nhất (Superlative) thường được viết lại bằng: **Subject + have/has + never + PII + a + comparative adj + N + than this.**",
                    whyWrong: "A sai vì thiếu sự so sánh trực tiếp với 'this'. D đúng về logic nhưng B sát cấu trúc ngữ pháp 'have ever had' -> 'have never had' hơn."
                }
            },
            {
                id: 10,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "4. If you don’t practice speaking English regularly, you can’t improve your speaking skills.",
                options: [
                    "A. Unless you practice speaking English regularly, you can't improve your speaking skills.",
                    "B. You can’t improve your speaking skills without practicing English regularly.",
                    "C. Practicing speaking English regularly is not necessary to improve your speaking skills.",
                    "D. You should practice speaking English regularly to improve your speaking skills."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Nếu bạn không luyện nói tiếng Anh thường xuyên, bạn không thể cải thiện kỹ năng nói.",
                    translateOpt: [
                        "A. Trừ khi bạn luyện nói thường xuyên, bạn không thể cải thiện...",
                        "B. Bạn không thể cải thiện... mà không luyện tập... (Cũng đúng nhưng A là cấu trúc điều kiện chuẩn).",
                        "C. Luyện tập là không cần thiết (Sai nghĩa).",
                        "D. Bạn nên luyện tập... (Lời khuyên, không phải câu điều kiện)."
                    ],
                    whyCorrect: "Cấu trúc **Unless = If... not**. Câu A giữ nguyên cấu trúc điều kiện loại 1.",
                    whyWrong: "B cũng đúng nghĩa nhưng A là cách viết lại câu trực tiếp nhất cho cấu trúc 'If not'. D chuyển sang lời khuyên (should) thay vì điều kiện (can't)."
                }
            },
            {
                id: 11,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "5. “Is the singer staying in a penthouse suite that is situated on the top 2 floors?”",
                options: [
                    "A. Someone wanted to know if the singer was staying in a penthouse suite on the top 2 floors.",
                    "B. The journalist wanted to know if the singer was staying in a penthouse suite that was situated on the top 2 floors.",
                    "C. People wondered if the singer was staying in a penthouse suite situated on the top 2 floors.",
                    "D. It was questioned whether the singer was staying in a penthouse suite on the top 2 floors."
                ],
                correct: 1, // B (Note: Original text implies reporting context, B is most detailed)
                explanation: {
                    translateQ: "“Ca sĩ có đang ở trong căn hộ áp mái nằm trên 2 tầng cao nhất không?”",
                    translateOpt: [
                        "A. Ai đó muốn biết...",
                        "B. Nhà báo muốn biết liệu ca sĩ có đang ở trong căn hộ áp mái cái mà nằm trên 2 tầng cao nhất không.",
                        "C. Mọi người tự hỏi...",
                        "D. Một câu hỏi được đặt ra là..."
                    ],
                    whyCorrect: "Câu tường thuật câu hỏi Yes/No: **S + wanted to know + if/whether + S + V(lùi thì)**. Đáp án B giữ nguyên mệnh đề quan hệ 'that was situated' và đầy đủ thông tin nhất.",
                    whyWrong: "Các đáp án khác không sai ngữ pháp nhưng B thường là đáp án chuẩn trong bài tập tường thuật khi có ngữ cảnh cụ thể (dù đề bài chưa cho biết ai nói, nhưng B giữ cấu trúc 'that was situated' đầy đủ nhất)."
                }
            },
            {
                id: 12,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "6. “What language do you think you will learn next year?” Mary asked Jim.",
                options: [
                    "A. Mary asked Jim what language he thought he would learn next year.",
                    "B. Mary asked Jim what language he thought he would learn the following year.",
                    "C. Mary asked Jim what language he thought he would learn the year after.",
                    "D. Mary asked Jim what language he would learn the year after."
                ],
                correct: 1, // B
                explanation: {
                    translateQ: "“Bạn nghĩ bạn sẽ học ngôn ngữ gì vào năm sau?” Mary hỏi Jim.",
                    translateOpt: [
                        "A. Sai vì chưa đổi 'next year'.",
                        "B. Mary hỏi Jim ngôn ngữ anh ấy nghĩ sẽ học vào năm sau đó.",
                        "C. Dùng 'the year after' cũng được nhưng 'the following year' phổ biến hơn.",
                        "D. Thiếu 'he thought' (mất ý 'bạn nghĩ')."
                    ],
                    whyCorrect: "Tường thuật câu hỏi Wh-questions: Lùi thì (will -> would), đổi ngôi (you -> he), đổi trạng từ thời gian (**next year -> the following year**).",
                    whyWrong: "A chưa đổi trạng từ thời gian. D làm mất động từ 'think' của câu gốc."
                }
            },
            {
                id: 13,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "7. We have decided that your contract will not be renewed.",
                options: [
                    "A. Your contract will not be renewed.",
                    "B. Your contract will not be renewed by us.",
                    "C. A decision has been made not to renew your contract.",
                    "D. It has been decided that your contract will not be renewed."
                ],
                correct: 3, // D
                explanation: {
                    translateQ: "Chúng tôi đã quyết định rằng hợp đồng của bạn sẽ không được gia hạn.",
                    translateOpt: [
                        "A. Hợp đồng sẽ không được gia hạn (Thiếu ý 'đã quyết định').",
                        "B. ...bởi chúng tôi (Thiếu ý 'quyết định').",
                        "C. Một quyết định đã được đưa ra... (Cấu trúc tốt).",
                        "D. Đã được quyết định rằng hợp đồng của bạn sẽ không được gia hạn."
                    ],
                    whyCorrect: "Cấu trúc bị động khách quan (Impersonal Passive): **It + has been + PII (decided) + that clause**. Đây là cách viết trang trọng nhất.",
                    whyWrong: "A và B làm mất mệnh đề chính 'We have decided'. C đúng nhưng D giữ nguyên cấu trúc mệnh đề 'that...' sát với câu gốc hơn."
                }
            },
            {
                id: 14,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "8. Revising for exams takes up all my time at the moment.",
                options: [
                    "A. I’m busy revising for exams at the moment.",
                    "B. I spend all my time revising for exams at the moment.",
                    "C. Revising for exams is taking up all my time at the moment.",
                    "D. All my time is being taken up by revising for exams at the moment."
                ],
                correct: 1, // B
                explanation: {
                    translateQ: "Việc ôn thi chiếm hết thời gian của tôi lúc này.",
                    translateOpt: [
                        "A. Tôi bận ôn thi (Thiếu ý 'hết thời gian').",
                        "B. Tôi dành toàn bộ thời gian để ôn thi lúc này.",
                        "C. Đang chiếm hết... (Sai thì, câu gốc present simple chỉ sự thật hiển nhiên/thói quen).",
                        "D. Bị động (Hơi cồng kềnh)."
                    ],
                    whyCorrect: "Cấu trúc tương đương: **Something takes up time = Spend time doing something**. Đáp án B diễn đạt chính xác nghĩa này.",
                    whyWrong: "A thiếu mức độ 'all my time'. C tự ý chuyển sang thì tiếp diễn."
                }
            },
            {
                id: 15,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "9. Some people prefer going abroad for holidays to traveling in their own countries.",
                options: [
                    "A. Some people would rather go abroad for holidays than travel in their own countries.",
                    "B. Some people prefer going abroad for holidays to travel in their countries.",
                    "C. Some people prefer to travel abroad for holidays rather than travel in their own countries.",
                    "D. Some people would prefer to go abroad for holidays than traveling in their own countries."
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Một số người thích đi nghỉ ở nước ngoài hơn là du lịch trong nước.",
                    translateOpt: [
                        "A. Một số người thà đi nước ngoài hơn là du lịch trong nước.",
                        "B. Sai cấu trúc (prefer Ving to Ving).",
                        "C. Prefer to V rather than V (Cũng đúng, nhưng A phổ biến hơn trong bài tập biến đổi).",
                        "D. Sai cấu trúc 'would prefer'."
                    ],
                    whyCorrect: "Cấu trúc: **Prefer V-ing to V-ing** = **Would rather V than V**. Đáp án A sử dụng đúng cấu trúc 'Would rather'.",
                    whyWrong: "B sai vì dùng 'to travel' (phải là traveling). D sai cấu trúc 'would prefer... than' (phải là rather than)."
                }
            },
            {
                id: 16,
                type: "meaning",
                category: "Exercise 4: Circle the answer closest in meaning.",
                question: "10. We could look for the information about the history of English on the Internet.",
                options: [
                    "A. Shall we look for the information about the history of English on the Internet?",
                    "B. Why don't we look for the information about the history of English on the Internet?",
                    "C. How about looking for the information about the history of English on the Internet?",
                    "D. Let's look for the information about the history of English on the Internet."
                ],
                correct: 1, // B
                explanation: {
                    translateQ: "Chúng ta có thể tìm thông tin về lịch sử tiếng Anh trên mạng.",
                    translateOpt: [
                        "A. Chúng ta sẽ...? (Hỏi ý kiến).",
                        "B. Tại sao chúng ta không tìm...? (Gợi ý).",
                        "C. Còn việc tìm... thì sao? (Gợi ý).",
                        "D. Hãy tìm... (Mệnh lệnh/Gợi ý)."
                    ],
                    whyCorrect: "**'We could...'** thường dùng để đưa ra một gợi ý nhẹ nhàng. **'Why don't we...'** là cấu trúc câu hỏi gợi ý tương đương nhất về sắc thái.",
                    whyWrong: "Tất cả đều là câu gợi ý, nhưng B (Why don't we) thường được dùng để thay thế cho 'We could' trong các bài tập viết lại câu vì nó giữ được tính chất đưa ra giải pháp."
                }
            },

            // Exercise 5: Arrangement
            {
                id: 17,
                type: "arrangement",
                category: "Exercise 5: Arrange the sentences to make a meaningful paragraph.",
                question: "Sắp xếp đoạn văn về: <b>English Accents</b>",
                contentBox: [
                    "a. First, it's important to understand that English is spoken differently around the world.",
                    "b. Learning about different ways of speaking English is really interesting!",
                    "c. Also, English accents can vary a lot. Someone from England will sound very different from someone from South Africa...",
                    "d. People in Australia, for example, might use different words and phrases than people in the United States.",
                    "e. Finally, knowing about these differences can help us understand each other better. It's like learning about different cultures!"
                ],
                options: [
                    "A. a-b-c-d-e",
                    "B. b-a-d-c-e",
                    "C. a-c-b-e-d",
                    "D. b-a-c-d-e"
                ],
                correct: 3, // D
                explanation: {
                    translateQ: "Sắp xếp đoạn văn nói về các giọng tiếng Anh (Accents).",
                    translateOpt: [
                        "A. a-b-c-d-e",
                        "B. b-a-d-c-e",
                        "C. a-c-b-e-d",
                        "D. b-a-c-d-e"
                    ],
                    whyCorrect: "Trình tự logic:\n1. **b**: Câu chủ đề (Intro) - Learning... is interesting.\n2. **a**: Ý đầu tiên (First) - Spoken differently.\n3. **c**: Ý tiếp theo (Also) - Accents vary (England vs SA).\n4. **d**: Ví dụ minh họa (For example) - Australia vs US.\n5. **e**: Kết luận (Finally) - Understanding others.",
                    whyWrong: "A sai vì bắt đầu bằng 'First' mà thiếu câu dẫn nhập chủ đề. B sai trật tự ý (đưa ví dụ d trước khi nói ý c). C sai trật tự hoàn toàn."
                }
            },
            {
                id: 18,
                type: "arrangement",
                category: "Exercise 5: Arrange the sentences to make a meaningful paragraph.",
                question: "Sắp xếp đoạn văn về: <b>Learning English in Germany</b>",
                contentBox: [
                    "a. Learning English is becoming increasingly important in Germany.",
                    "b. Moreover, many schools in Germany now include English in their curriculum, starting in primary school.",
                    "c. Therefore, learning English can benefit German students and workers by giving them more opportunities to connect with the world.",
                    "d. Firstly, German businesses often use English to communicate with international partners.",
                    "e. In addition, knowing English opens up opportunities in the tourism industry, especially in popular cities like Berlin and Munich."
                ],
                options: [
                    "A. a-d-b-e-c",
                    "B. d-a-b-e-c",
                    "C. d-a-e-b-c",
                    "D. a-d-e-b-c"
                ],
                correct: 3, // D (Logic: Intro -> First -> Addition -> Moreover -> Conclusion)
                explanation: {
                    translateQ: "Sắp xếp đoạn văn về việc học tiếng Anh ở Đức.",
                    translateOpt: ["A", "B", "C", "D"],
                    whyCorrect: "Trình tự:\n1. **a**: Câu chủ đề (Quan trọng ở Đức).\n2. **d**: Ý 1 (Firstly) - Kinh doanh.\n3. **e**: Ý 2 (In addition) - Du lịch.\n4. **b**: Ý 3 (Moreover) - Trường học.\n5. **c**: Kết luận (Therefore) - Lợi ích tổng quát.",
                    whyWrong: "Cần chọn D vì sắp xếp các ý bổ trợ (First, In addition, Moreover) hợp lý sau câu chủ đề a."
                }
            },
            {
                id: 19,
                type: "arrangement",
                category: "Exercise 5: Arrange the sentences to make a meaningful letter.",
                question: "Sắp xếp thư của Lan gửi Mai.",
                contentBox: [
                    "Dear Mai,",
                    "a. I hope you're doing well.",
                    "b. It's really easy to connect with people online and find information quickly.",
                    "c. People spend a lot of time on their phones and sometimes forget to enjoy the real world. What are your thoughts on this?",
                    "d. I wanted to share some ideas about how technology is changing the world.",
                    "e. Besides, while technology makes life more convenient, it can also be distracting.",
                    "f. First, almost everyone has a smartphone now.",
                    "Looking forward to hearing from you.",
                    "Best, Lan"
                ],
                options: [
                    "A. a-d-f-b-e-c",
                    "B. a-d-f-e-b-c",
                    "C. d-a-f-b-c-e",
                    "D. d-a-f-b-e-c"
                ],
                correct: 0, // A
                explanation: {
                    translateQ: "Thư thảo luận về công nghệ.",
                    translateOpt: ["A", "B", "C", "D"],
                    whyCorrect: "Trình tự:\n1. **a**: Lời chào hỏi sức khỏe (đầu thư).\n2. **d**: Mục đích thư (Share ideas).\n3. **f**: Ý 1 (First - smartphone).\n4. **b**: Lợi ích (Connect online).\n5. **e**: Mặt trái (Besides - distracting).\n6. **c**: Câu hỏi kết thúc (What are your thoughts?).",
                    whyWrong: "A là trình tự chuẩn nhất cho một bức thư thân mật có cấu trúc nghị luận."
                }
            }
        ];

        let currentScore = 0;
        let answeredQuestions = 0;

        // Sound Effects
        const correctSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3'); // Ding sound
        const wrongSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3'); // Error sound

        // Helper: Play Sound
        function playSound(isCorrect) {
            try {
                if (isCorrect) {
                    correctSound.currentTime = 0;
                    correctSound.volume = 0.5;
                    correctSound.play();
                } else {
                    wrongSound.currentTime = 0;
                    wrongSound.volume = 0.5;
                    wrongSound.play();
                }
            } catch (e) {
                console.log("Audio autoplay might be blocked");
            }
        }

        // Render Quiz
        function renderQuiz() {
            const quizArea = document.getElementById('quiz-area');
            quizArea.innerHTML = '';

            quizData.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-card';
                questionDiv.id = `q-${index}`;

                // Header
                let html = `<div class="question-header">${item.category}</div>`;
                
                // Question Content
                if (item.type === "arrangement") {
                    html += `<div class="question-text">${item.question}</div>`;
                    html += `<div class="arrangement-box">`;
                    item.contentBox.forEach(line => {
                        html += `<span class="arrangement-item">${line}</span>`;
                    });
                    html += `</div>`;
                } else {
                    html += `<div class="original-text-box">${item.question}</div>`;
                }

                // Options
                html += `<div class="options-grid">`;
                item.options.forEach((opt, optIndex) => {
                    const letter = ["A", "B", "C", "D"][optIndex];
                    html += `
                        <button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, this)">
                            <div class="option-letter">${letter}</div>
                            <div class="option-text">${opt}</div>
                        </button>
                    `;
                });
                html += `</div>`;

                // Explanation Block (Hidden initially)
                html += `
                    <div class="explanation-box" id="explain-${index}">
                        <div class="teacher-avatar">
                            <div class="avatar-circle"><i class="fas fa-chalkboard-teacher"></i></div>
                            <div class="teacher-name">Cô Mai An (ULIS) giải thích:</div>
                        </div>
                        <div class="explain-step">
                            <span class="step-title"><i class="fas fa-language"></i> Dịch câu hỏi:</span>
                            <div class="step-content">${item.explanation.translateQ}</div>
                        </div>
                        
                        <div class="glossary-card">
                            <span class="glossary-title"><i class="fas fa-list-ul"></i> Phân tích đáp án:</span>
                            <ul style="list-style: none; padding-left: 5px;">
                                ${item.explanation.translateOpt.map(o => `<li style="margin-bottom:5px;">${o}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="explain-step">
                            <span class="step-title" style="color: var(--correct-green);"><i class="fas fa-check-circle"></i> Tại sao ĐÚNG?</span>
                            <div class="step-content">${item.explanation.whyCorrect}</div>
                        </div>

                        <div class="explain-step">
                            <span class="step-title" style="color: var(--wrong-red);"><i class="fas fa-times-circle"></i> Tại sao SAI?</span>
                            <div class="step-content">${item.explanation.whyWrong}</div>
                        </div>
                    </div>
                `;

                questionDiv.innerHTML = html;
                quizArea.appendChild(questionDiv);
            });
        }

        // Check Answer Logic
        function checkAnswer(qIndex, selectedOptIndex, btnElement) {
            // Prevent re-answering
            if (btnElement.classList.contains('disabled') || btnElement.parentElement.classList.contains('answered')) return;

            const question = quizData[qIndex];
            const isCorrect = (selectedOptIndex === question.correct);
            const parentGrid = btnElement.parentElement;
            
            // Mark as answered
            parentGrid.classList.add('answered');
            const allBtns = parentGrid.querySelectorAll('.option-btn');
            allBtns.forEach(btn => btn.classList.add('disabled'));

            // Show Explanation immediately
            document.getElementById(`explain-${qIndex}`).style.display = 'block';

            if (isCorrect) {
                // UI Update
                btnElement.classList.add('correct');
                currentScore++;
                document.getElementById('current-score').innerText = currentScore;
                
                // Sound & Confetti
                playSound(true);
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8854C0', '#00C9A7', '#FFD700']
                });

            } else {
                // UI Update
                btnElement.classList.add('wrong');
                // Highlight the correct one
                allBtns[question.correct].classList.add('correct');
                
                // Sound & Shake
                playSound(false);
                const card = document.getElementById(`q-${qIndex}`);
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 500);
            }
            
            answeredQuestions++;
        }

        // Finish Quiz
        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const finalScore = document.getElementById('final-score');
            const msg = document.getElementById('feedback-msg');

            finalScore.innerText = `${currentScore}/${quizData.length}`;
            
            if (currentScore === quizData.length) {
                msg.innerText = "Xuất sắc! Cô Mai An rất tự hào về em! 🌟";
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (currentScore > quizData.length * 0.7) {
                msg.innerText = "Làm tốt lắm! Cố gắng thêm chút nữa nhé! 💪";
            } else {
                msg.innerText = "Đừng nản lòng! Hãy xem kỹ giải thích của cô nhé! 📚";
            }

            modal.style.display = 'flex';
        }

        // Initialize
        window.onload = function() {
            renderQuiz();
        };

    </script>
</body>
</html>