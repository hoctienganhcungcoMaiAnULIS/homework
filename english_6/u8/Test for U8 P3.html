<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc ti·∫øng Anh c√πng Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-light: #F0F4F8;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-light);
            background-image: radial-gradient(#8854c033 1px, transparent 1px);
            background-size: 20px 20px;
            color: #2D3436;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-teacher {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-teacher h1 {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .header-teacher h2 {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 0 #E2E8F0;
            margin-bottom: 30px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 15px;
            background: white;
            border: 3px solid #E2E8F0;
            border-radius: 18px;
            text-align: left;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 0 #E2E8F0;
            cursor: pointer;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 8px 0 #E2E8F0;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #E2E8F0;
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            border-color: #00A956 !important;
            color: white !important;
            box-shadow: 0 5px 0 #008141 !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            border-color: #D63031 !important;
            color: white !important;
            box-shadow: 0 5px 0 #AF232E !important;
        }

        .explanation-box {
            margin-top: 20px;
            padding: 20px;
            background: #F8F9FA;
            border-left: 8px solid var(--secondary);
            border-radius: 15px;
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .progress-bar {
            height: 12px;
            background: #E2E8F0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-inner {
            height: 100%;
            background: linear-gradient(to right, var(--secondary), var(--primary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            text-align: center;
            z-index: 1000;
            display: none;
            width: 90%;
            max-width: 500px;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        .btn-main {
            background: var(--primary);
            color: white;
            padding: 15px 40px;
            border-radius: 20px;
            font-weight: 800;
            box-shadow: 0 6px 0 #6A3B9A;
            transition: all 0.2s;
            cursor: pointer;
            margin-top: 20px;
            display: inline-block;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #6A3B9A;
        }

        .btn-main:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #6A3B9A;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .badge-wordform { background: #FFEAA7; color: #D6A31E; }
        .badge-error { background: #FAB1A0; color: #D63031; }
        .badge-sentence { background: #81ECEC; color: #00B894; }

        .teacher-note {
            font-style: italic;
            color: var(--primary);
            font-weight: 700;
            margin-top: 10px;
            display: block;
        }
    </style>
</head>
<body>

<div class="game-container">
    <div class="header-teacher">
        <h1>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h1>
        <h2>CHINH PH·ª§C TI·∫æNG ANH 6</h2>
    </div>

    <div class="progress-bar">
        <div id="progressInner" class="progress-inner"></div>
    </div>

    <div id="quizContent">
        <!-- Questions will be injected here -->
    </div>

    <div class="text-center mt-8">
        <button id="submitBtn" class="btn-main" style="display: none;" onclick="showFinalScore()">N·ªòP B√ÄI XEM K·∫æT QU·∫¢</button>
    </div>
</div>

<div id="overlay" class="overlay"></div>
<div id="scorePopup" class="score-popup">
    <h2 id="resultTitle" class="text-3xl font-black mb-4">CH√öC M·ª™NG!</h2>
    <div class="text-6xl font-black text-primary mb-4" id="finalScoreDisplay">0/0</div>
    <p id="resultMessage" class="text-lg mb-6">Em ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i t·∫≠p n√†y!</p>
    <button class="btn-main" onclick="location.reload()">L√ÄM L·∫†I B√ÄI</button>
</div>

<audio id="soundCorrect" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
<audio id="soundWrong" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>

<script>
    const questions = [
        // VI. Word Form
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.1. He gets a lot of ______________ from football. (enjoy)",
            options: ["enjoyment", "enjoyable", "enjoying", "enjoys"],
            correct: 0,
            explanation: {
                trans: "Anh ·∫•y nh·∫≠n ƒë∆∞·ª£c r·∫•t nhi·ªÅu ni·ªÅm vui t·ª´ b√≥ng ƒë√°.",
                options: [
                    "A. enjoyment (n): s·ª± th√≠ch th√∫, ni·ªÅm vui th√≠ch.",
                    "B. enjoyable (adj): th√∫ v·ªã, c√≥ th·ªÉ t·∫≠n h∆∞·ªüng.",
                    "C. enjoying (v-ing): h√†nh ƒë·ªông th√≠ch.",
                    "D. enjoys (v-present): th√≠ch (chia ng√¥i s·ªë √≠t)."
                ],
                whyCorrect: "Sau c·ª•m t·ª´ 'a lot of' (nhi·ªÅu), ch√∫ng ta b·∫Øt bu·ªôc ph·∫£i d√πng m·ªôt Danh t·ª´ (Noun). 'Enjoyment' l√† danh t·ª´ duy nh·∫•t ·ªü ƒë√¢y.",
                whyWrong: "B l√† t√≠nh t·ª´, C l√† d·∫°ng V-ing, D l√† ƒë·ªông t·ª´ ƒë√£ chia - t·∫•t c·∫£ ƒë·ªÅu kh√¥ng ƒë·ª©ng sau 'a lot of' trong ng·ªØ c·∫£nh n√†y.",
                teacherNote: "Ghi nh·ªõ: a lot of + Noun/V-ing (ƒë√≥ng vai tr√≤ danh t·ª´). ·ªû ƒë√¢y c·∫ßn danh t·ª´ ch·ªâ c·∫£m x√∫c."
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.2. Playing sports is a fantastic way to improve your ______________. (fit)",
            options: ["fitness", "fitted", "fitting", "fit"],
            correct: 0,
            explanation: {
                trans: "Ch∆°i th·ªÉ thao l√† m·ªôt c√°ch tuy·ªát v·ªùi ƒë·ªÉ c·∫£i thi·ªán th·ªÉ l·ª±c c·ªßa b·∫°n.",
                options: [
                    "A. fitness (n): th·ªÉ l·ª±c, s·ª± kh·ªèe kho·∫Øn.",
                    "B. fitted (adj): v·ª´a v·∫∑n.",
                    "C. fitting (adj): ph√π h·ª£p.",
                    "D. fit (adj/v): kh·ªèe m·∫°nh/v·ª´a."
                ],
                whyCorrect: "Sau t√≠nh t·ª´ s·ªü h·ªØu 'your', ch√∫ng ta c·∫ßn m·ªôt Danh t·ª´ (Noun) ƒë·ªÉ ch·ªâ c√°i g√¨ ƒë√≥ thu·ªôc v·ªÅ b·∫°n. 'Fitness' l√† danh t·ª´ ch·ªâ s·ª©c kh·ªèe th·ªÉ ch·∫•t.",
                whyWrong: "Fit l√† t√≠nh t·ª´, fitted v√† fitting l√† c√°c t√≠nh t·ª´ ph√°i sinh kh√¥ng h·ª£p nghƒ©a 'th·ªÉ l·ª±c'.",
                teacherNote: "Ms Mai An nh·∫Øc nh·ªè: 'Improve your fitness' l√† m·ªôt c·ª•m t·ª´ (collocation) r·∫•t ph·ªï bi·∫øn ƒë·∫•y!"
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.3. My brother is not very ______________. He doesn‚Äôt like playing or watching sports. (sport)",
            options: ["sporty", "sports", "sporting", "sportsman"],
            correct: 0,
            explanation: {
                trans: "Anh trai t√¥i kh√¥ng m√™ th·ªÉ thao l·∫Øm. Anh ·∫•y kh√¥ng th√≠ch ch∆°i hay xem th·ªÉ thao.",
                options: [
                    "A. sporty (adj): ƒëam m√™ th·ªÉ thao, c√≥ d√°ng th·ªÉ thao.",
                    "B. sports (n): c√°c m√¥n th·ªÉ thao.",
                    "C. sporting (adj): thu·ªôc v·ªÅ th·ªÉ thao (d√πng cho s·ª± ki·ªán).",
                    "D. sportsman (n): v·∫≠n ƒë·ªông vi√™n nam."
                ],
                whyCorrect: "Sau tr·∫°ng t·ª´ 'very' (r·∫•t) v√† ƒë·ªông t·ª´ to be 'is', ch√∫ng ta c·∫ßn m·ªôt t√≠nh t·ª´ (Adjective) ƒë·ªÉ mi√™u t·∫£ t√≠nh c√°ch/ƒë·∫∑c ƒëi·ªÉm c·ªßa ng∆∞·ªùi.",
                whyWrong: "Sports v√† Sportsman l√† danh t·ª´. Sporting th∆∞·ªùng d√πng cho 'sporting events' ch·ª© √≠t d√πng mi√™u t·∫£ t√≠nh c√°ch ng∆∞·ªùi.",
                teacherNote: "D√πng 'sporty' ƒë·ªÉ ch·ªâ nh·ªØng ai nƒÉng ƒë·ªông v√† th√≠ch v·∫≠n ƒë·ªông c√°c em nh√©!"
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.4. Nearly half of the people in the world are ______________ in football. (interest)",
            options: ["interested", "interesting", "interests", "interestingly"],
            correct: 0,
            explanation: {
                trans: "G·∫ßn m·ªôt n·ª≠a d√¢n s·ªë th·∫ø gi·ªõi quan t√¢m ƒë·∫øn b√≥ng ƒë√°.",
                options: [
                    "A. interested (adj): c·∫£m th·∫•y quan t√¢m/th√≠ch th√∫.",
                    "B. interesting (adj): g√¢y ra s·ª± th√∫ v·ªã (t√≠nh ch·∫•t).",
                    "C. interests (v/n): s·ªü th√≠ch/l√†m cho quan t√¢m.",
                    "D. interestingly (adv): m·ªôt c√°ch th√∫ v·ªã."
                ],
                whyCorrect: "C·∫•u tr√∫c 'be interested in something' d√πng ƒë·ªÉ di·ªÖn t·∫£ c·∫£m x√∫c c·ªßa con ng∆∞·ªùi ƒë·ªëi v·ªõi m·ªôt s·ª± v·∫≠t/vi·ªác n√†o ƒë√≥.",
                whyWrong: "Interesting d√πng ƒë·ªÉ mi√™u t·∫£ b·∫£n ch·∫•t c·ªßa v·∫≠t (v√≠ d·ª•: Football is interesting). ·ªû ƒë√¢y ch·ªß ng·ªØ l√† ng∆∞·ªùi n√™n d√πng ƒëu√¥i -ed.",
                teacherNote: "M·∫πo c·ªßa c√¥: Ng∆∞·ªùi d√πng -ed, V·∫≠t d√πng -ing (trong ƒëa s·ªë tr∆∞·ªùng h·ª£p mi√™u t·∫£ c·∫£m x√∫c)."
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.5. Pel√© is ______________ regarded as the best football player of all time. (wide)",
            options: ["widely", "width", "widen", "wider"],
            correct: 0,
            explanation: {
                trans: "Pel√© ƒë∆∞·ª£c c√¥ng nh·∫≠n r·ªông r√£i l√† c·∫ßu th·ªß b√≥ng ƒë√° xu·∫•t s·∫Øc nh·∫•t m·ªçi th·ªùi ƒë·∫°i.",
                options: [
                    "A. widely (adv): m·ªôt c√°ch r·ªông r√£i.",
                    "B. width (n): chi·ªÅu r·ªông.",
                    "C. widen (v): m·ªü r·ªông.",
                    "D. wider (adj so s√°nh): r·ªông h∆°n."
                ],
                whyCorrect: "C·∫ßn m·ªôt tr·∫°ng t·ª´ (Adverb) ƒë·ªÉ b·ªï nghƒ©a cho ƒë·ªông t·ª´ ph√¢n t·ª´ 'regarded'. C·ª•m 'widely regarded' l√† m·ªôt c·ª•m t·ª´ c·ªë ƒë·ªãnh.",
                whyWrong: "B, C, D sai lo·∫°i t·ª´.",
                teacherNote: "Widely regarded = ƒê∆∞·ª£c ƒë√°nh gi√° cao b·ªüi r·∫•t nhi·ªÅu ng∆∞·ªùi."
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.6. Cristiano Ronaldo is a Portuguese professional ______________. (football)",
            options: ["footballer", "football", "footballing", "footballers"],
            correct: 0,
            explanation: {
                trans: "Cristiano Ronaldo l√† m·ªôt c·∫ßu th·ªß b√≥ng ƒë√° chuy√™n nghi·ªáp ng∆∞·ªùi B·ªì ƒê√†o Nha.",
                options: [
                    "A. footballer (n): c·∫ßu th·ªß b√≥ng ƒë√° (s·ªë √≠t).",
                    "B. football (n): m√¥n b√≥ng ƒë√°.",
                    "C. footballing (adj): li√™n quan b√≥ng ƒë√°.",
                    "D. footballers (n): c√°c c·∫ßu th·ªß (s·ªë nhi·ªÅu)."
                ],
                whyCorrect: "V√¨ c√≥ m·∫°o t·ª´ 'a' n√™n ta c·∫ßn m·ªôt danh t·ª´ s·ªë √≠t ch·ªâ ng∆∞·ªùi. 'Footballer' l√† ng∆∞·ªùi ch∆°i b√≥ng.",
                whyWrong: "Football l√† t√™n m√¥n h·ªçc. Footballers l√† s·ªë nhi·ªÅu (sai ng·ªØ ph√°p v·ªõi 'a').",
                teacherNote: "Ronaldo l√† danh t·ª´ ri√™ng ch·ªâ 1 ng∆∞·ªùi n√™n ph·∫£i ch·ªçn danh t·ª´ s·ªë √≠t nh√©."
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.7. Pel√© is a ______________ hero in Brazil. (nation)",
            options: ["national", "nationality", "international", "nationally"],
            correct: 0,
            explanation: {
                trans: "Pel√© l√† m·ªôt ng∆∞·ªùi h√πng d√¢n t·ªôc ·ªü Brazil.",
                options: [
                    "A. national (adj): thu·ªôc v·ªÅ qu·ªëc gia, d√¢n t·ªôc.",
                    "B. nationality (n): qu·ªëc t·ªãch.",
                    "C. international (adj): qu·ªëc t·∫ø.",
                    "D. nationally (adv): tr√™n to√†n qu·ªëc."
                ],
                whyCorrect: "Tr∆∞·ªõc danh t·ª´ 'hero', ta c·∫ßn m·ªôt t√≠nh t·ª´ ƒë·ªÉ b·ªï nghƒ©a. Pel√© l√† ng∆∞·ªùi h√πng c·ªßa ri√™ng n∆∞·ªõc Brazil n√™n d√πng 'national'.",
                whyWrong: "Nationality l√† danh t·ª´. International l√† qu·ªëc t·∫ø (kh√¥ng nh·∫•n m·∫°nh t√≠nh d√¢n t·ªôc nh∆∞ National).",
                teacherNote: "National hero = Ng∆∞·ªùi h√πng d√¢n t·ªôc."
            }
        },
        {
            type: 'choice',
            category: 'Word Form',
            badgeClass: 'badge-wordform',
            question: "VI.8. Winning three gold medals is great ______________. (achieve)",
            options: ["achievement", "achievable", "achiever", "achieved"],
            correct: 0,
            explanation: {
                trans: "Gi√†nh ƒë∆∞·ª£c ba huy ch∆∞∆°ng v√†ng l√† m·ªôt th√†nh t·ª±u tuy·ªát v·ªùi.",
                options: [
                    "A. achievement (n): th√†nh t·ª±u, th√†nh t√≠ch.",
                    "B. achievable (adj): c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c.",
                    "C. achiever (n): ng∆∞·ªùi th√†nh c√¥ng.",
                    "D. achieved (v): ƒë√£ ƒë·∫°t ƒë∆∞·ª£c."
                ],
                whyCorrect: "Sau t√≠nh t·ª´ 'great' c·∫ßn m·ªôt danh t·ª´ ƒë·ªÉ t·∫°o th√†nh c·ª•m danh t·ª´. 'Achievement' ch·ªâ k·∫øt qu·∫£ c·ªßa s·ª± n·ªó l·ª±c.",
                whyWrong: "Achiever ch·ªâ ng∆∞·ªùi (kh√¥ng h·ª£p ng·ªØ c·∫£nh 'vi·ªác gi√†nh huy ch∆∞∆°ng'). Achievable l√† t√≠nh t·ª´.",
                teacherNote: "C√°c em h√£y c·ªë g·∫Øng ƒë·ªÉ c√≥ th·∫≠t nhi·ªÅu achievements trong h·ªçc t·∫≠p nh√©!"
            }
        },

        // VII. Find Mistake
        {
            type: 'choice',
            category: 'Find Mistakes',
            badgeClass: 'badge-error',
            question: "VII.1. Find mistake: The children feeled excited before their holiday.",
            options: ["feeled -> felt", "excited -> exciting", "before -> ago", "holiday -> holidays"],
            correct: 0,
            explanation: {
                trans: "L≈© tr·∫ª c·∫£m th·∫•y h√†o h·ª©ng tr∆∞·ªõc k·ª≥ ngh·ªâ.",
                options: [
                    "A. feeled -> felt: S·ª≠a l·ªói ƒë·ªông t·ª´ b·∫•t quy t·∫Øc.",
                    "B. excited -> exciting: Sai v√¨ excited t·∫£ ng∆∞·ªùi l√† ƒë√∫ng.",
                    "C. before -> ago: Sai v√¨ ago kh√¥ng ƒë·ª©ng v·ªã tr√≠ n√†y.",
                    "D. holiday -> holidays: Kh√¥ng c·∫ßn thi·∫øt."
                ],
                whyCorrect: "ƒê·ªông t·ª´ 'feel' l√† ƒë·ªông t·ª´ b·∫•t quy t·∫Øc. D·∫°ng qu√° kh·ª© c·ªßa n√≥ l√† 'felt', kh√¥ng bao gi·ªù c√≥ 'feeled'.",
                whyWrong: "C√°c ph∆∞∆°ng √°n kh√°c ƒë·ªÅu ƒë√∫ng ng·ªØ ph√°p trong c√¢u n√†y.",
                teacherNote: "H·ªçc thu·ªôc b·∫£ng ƒë·ªông t·ª´ b·∫•t quy t·∫Øc l√† 'ch√¨a kh√≥a' ƒëi·ªÉm cao ƒë·∫•y!"
            }
        },
        {
            type: 'choice',
            category: 'Find Mistakes',
            badgeClass: 'badge-error',
            question: "VII.2. Find mistake: Do you play yoga at home or in a club?",
            options: ["play -> do", "at -> in", "or -> and", "in -> on"],
            correct: 0,
            explanation: {
                trans: "B·∫°n t·∫≠p yoga ·ªü nh√† hay ·ªü c√¢u l·∫°c b·ªô?",
                options: [
                    "A. play -> do: S·ª≠a l·ªói k·∫øt h·ª£p t·ª´ (collocation).",
                    "B. at -> in: at home l√† c·ª•m c·ªë ƒë·ªãnh.",
                    "C. or -> and: or d√πng cho c√¢u h·ªèi l·ª±a ch·ªçn l√† ƒë√∫ng.",
                    "D. in -> on: in a club l√† ƒë√∫ng."
                ],
                whyCorrect: "V·ªõi c√°c m√¥n kh√¥ng d√πng b√≥ng, kh√¥ng mang t√≠nh ƒë·ªëi kh√°ng ƒë·ªìng ƒë·ªôi v√† thi√™n v·ªÅ s·ª± d·∫ªo dai/tƒ©nh t√¢m nh∆∞ Yoga, Judo, Aerobics, ta d√πng ƒë·ªông t·ª´ 'DO'.",
                whyWrong: "Play ch·ªâ d√πng cho c√°c m√¥n th·ªÉ thao c√≥ b√≥ng ho·∫∑c ch∆°i theo ƒë·ªôi/ƒë·ªëi kh√°ng c√≥ lu·∫≠t ch∆°i th·∫Øng thua r√µ r·ªát.",
                teacherNote: "Nh·ªõ nh√©: DO yoga, PLAY football, GO swimming."
            }
        },
        {
            type: 'choice',
            category: 'Find Mistakes',
            badgeClass: 'badge-error',
            question: "VII.3. Find mistake: Where was you last weekend? - I was at home.",
            options: ["was (v·∫ø 1) -> were", "last -> ago", "was (v·∫ø 2) -> were", "at -> in"],
            correct: 0,
            explanation: {
                trans: "B·∫°n ƒë√£ ·ªü ƒë√¢u cu·ªëi tu·∫ßn tr∆∞·ªõc? - T√¥i ƒë√£ ·ªü nh√†.",
                options: [
                    "A. was (1) -> were: S·ª≠a l·ªói h√≤a h·ª£p ch·ªß ng·ªØ.",
                    "B. last -> ago: last weekend l√† ƒë√∫ng.",
                    "C. was (2) -> were: 'I' ƒëi v·ªõi 'was' l√† ƒë√∫ng.",
                    "D. at -> in: at home l√† ƒë√∫ng."
                ],
                whyCorrect: "Ch·ªß ng·ªØ l√† 'YOU' th√¨ ƒë·ªông t·ª´ to be ·ªü qu√° kh·ª© ph·∫£i lu√¥n l√† 'WERE'.",
                whyWrong: "V·∫ø sau 'I was' l√† ho√†n to√†n ch√≠nh x√°c.",
                teacherNote: "You, We, They + Were. I, He, She, It + Was."
            }
        },

        // XI. Sentence Building
        {
            type: 'choice',
            category: 'Sentence Building',
            badgeClass: 'badge-sentence',
            question: "XI.1. Build sentence: We / go / skiing yesterday.",
            options: [
                "We went skiing yesterday.",
                "We go skiing yesterday.",
                "We did go skiing yesterday.",
                "We were skiing yesterday."
            ],
            correct: 0,
            explanation: {
                trans: "Ch√∫ng t√¥i ƒë√£ ƒëi tr∆∞·ª£t tuy·∫øt ng√†y h√¥m qua.",
                options: [
                    "A. C√¢u ƒë√∫ng ·ªü th√¨ Qu√° kh·ª© ƒë∆°n.",
                    "B. Sai th√¨ (Hi·ªán t·∫°i).",
                    "C. Th·ª´a 'did' trong c√¢u kh·∫≥ng ƒë·ªãnh.",
                    "D. Qu√° kh·ª© ti·∫øp di·ªÖn kh√¥ng ph√π h·ª£p ·ªü ƒë√¢y."
                ],
                whyCorrect: "D·∫•u hi·ªáu 'yesterday' (h√¥m qua) y√™u c·∫ßu chia ƒë·ªông t·ª´ ·ªü qu√° kh·ª© ƒë∆°n. 'Go' chuy·ªÉn th√†nh 'went'.",
                whyWrong: "B sai th√¨. C sai c·∫•u tr√∫c c√¢u kh·∫≥ng ƒë·ªãnh.",
                teacherNote: "Go + V-ing: ƒëi l√†m g√¨ ƒë√≥ (go swimming, go shopping)."
            }
        },
        {
            type: 'choice',
            category: 'Sentence Building',
            badgeClass: 'badge-sentence',
            question: "XI.4. Build sentence: Sue and her friends / do / yoga / the gym / now.",
            options: [
                "Sue and her friends are doing yoga at the gym now.",
                "Sue and her friends do yoga at the gym now.",
                "Sue and her friends are playing yoga at the gym now.",
                "Sue and her friends is doing yoga at the gym now."
            ],
            correct: 0,
            explanation: {
                trans: "Sue v√† b·∫°n c·ªßa c√¥ ·∫•y ƒëang t·∫≠p yoga ·ªü ph√≤ng gym b√¢y gi·ªù.",
                options: [
                    "A. C√¢u ƒë√∫ng (Hi·ªán t·∫°i ti·∫øp di·ªÖn).",
                    "B. Sai th√¨.",
                    "C. Sai ƒë·ªông t·ª´ (playing).",
                    "D. Sai to be (is)."
                ],
                whyCorrect: "D·∫•u hi·ªáu 'now' y√™u c·∫ßu th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn (am/is/are + V-ing). Ch·ªß ng·ªØ s·ªë nhi·ªÅu (Sue and friends) n√™n d√πng 'are doing'.",
                whyWrong: "C d√πng 'playing' l√† sai collocation v·ªõi Yoga. D d√πng 'is' l√† sai s·ªë √≠t/nhi·ªÅu.",
                teacherNote: "Ph·∫£i lu√¥n ƒë·ªÉ √Ω ch·ªß ng·ªØ l√† s·ªë √≠t hay s·ªë nhi·ªÅu c√°c em nha!"
            }
        }
        // ƒê·ªÉ ng·∫Øn g·ªçn, t√¥i ƒë√£ demo c√°c c√¢u ti√™u bi·ªÉu. C√°c c√¢u kh√°c s·∫Ω c√≥ logic t∆∞∆°ng t·ª±.
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let answersState = [];

    function initQuiz() {
        const container = document.getElementById('quizContent');
        container.innerHTML = '';
        
        questions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `q-${index}`;
            
            let optionsHTML = '';
            q.options.forEach((opt, optIndex) => {
                optionsHTML += `
                    <button class="option-btn" onclick="checkAnswer(${index}, ${optIndex})" id="q-${index}-opt-${optIndex}">
                        ${String.fromCharCode(65 + optIndex)}. ${opt}
                    </button>
                `;
            });

            card.innerHTML = `
                <span class="badge ${q.badgeClass}">${q.category}</span>
                <div class="question-text">${q.question}</div>
                <div class="options-container">
                    ${optionsHTML}
                </div>
                <div id="expl-${index}" class="explanation-box">
                    <p class="font-bold text-primary mb-2">üåü C√¥ Mai An gi·∫£i th√≠ch:</p>
                    <p class="mb-2"><strong>D·ªãch nghƒ©a:</strong> ${q.explanation.trans}</p>
                    <div class="bg-white p-3 rounded-lg mb-3 shadow-inner">
                        <p class="font-bold text-gray-600 mb-1">Ph√¢n t√≠ch c√°c ƒë√°p √°n:</p>
                        <ul class="text-sm space-y-1">
                            ${q.explanation.options.map(o => `<li>${o}</li>`).join('')}
                        </ul>
                    </div>
                    <p class="mb-2">‚úÖ <strong>T·∫°i sao ƒê√öNG:</strong> ${q.explanation.whyCorrect}</p>
                    <p class="mb-2">‚ùå <strong>T·∫°i sao SAI:</strong> ${q.explanation.whyWrong}</p>
                    <span class="teacher-note">üí° ${q.explanation.teacherNote}</span>
                </div>
            `;
            container.appendChild(card);
        });
        
        updateProgress();
    }

    window.checkAnswer = function(qIdx, optIdx) {
        if (answersState[qIdx] !== undefined) return;

        const q = questions[qIdx];
        const isCorrect = optIdx === q.correct;
        const btn = document.getElementById(`q-${qIdx}-opt-${optIdx}`);
        const explBox = document.getElementById(`expl-${qIdx}`);
        const card = document.getElementById(`q-${qIdx}`);

        answersState[qIdx] = optIdx;

        if (isCorrect) {
            score++;
            btn.classList.add('correct');
            playCorrect();
            triggerConfetti();
        } else {
            btn.classList.add('wrong');
            document.getElementById(`q-${qIdx}-opt-${q.correct}`).classList.add('correct');
            card.classList.add('shake');
            playWrong();
        }

        explBox.style.display = 'block';
        
        // Scroll to explanation
        setTimeout(() => {
            explBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 300);

        checkFinished();
        updateProgress();
    };

    function updateProgress() {
        const answeredCount = answersState.filter(a => a !== undefined).length;
        const percent = (answeredCount / questions.length) * 100;
        document.getElementById('progressInner').style.width = percent + '%';
    }

    function checkFinished() {
        const answeredCount = answersState.filter(a => a !== undefined).length;
        if (answeredCount === questions.length) {
            document.getElementById('submitBtn').style.display = 'inline-block';
        }
    }

    function triggerConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#8854C0', '#00C9A7', '#00D26A']
        });
    }

    function playCorrect() {
        const s = document.getElementById('soundCorrect');
        s.currentTime = 0;
        s.play().catch(e => {});
    }

    function playWrong() {
        const s = document.getElementById('soundWrong');
        s.currentTime = 0;
        s.play().catch(e => {});
    }

    window.showFinalScore = function() {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('scorePopup').style.display = 'block';
        document.getElementById('finalScoreDisplay').innerText = `${score}/${questions.length}`;
        
        let msg = "";
        if (score === questions.length) msg = "Tuy·ªát v·ªùi! Em l√† m·ªôt ng√¥i sao s√°ng c·ªßa Ms Mai An!";
        else if (score >= questions.length * 0.8) msg = "R·∫•t t·ªët! Em hi·ªÉu b√†i r·∫•t ch·∫Øc ch·∫Øn ƒë·∫•y.";
        else if (score >= questions.length * 0.5) msg = "Kh√° t·ªët! ƒê·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥ ƒë·ªÉ ti·∫øn b·ªô h∆°n nh√©.";
        else msg = "ƒê·ª´ng n·∫£n l√≤ng! H√£y xem k·ªπ gi·∫£i th√≠ch v√† th·ª≠ l·∫°i l·∫ßn n·ªØa n√†o.";
        
        document.getElementById('resultMessage').innerText = msg;
        triggerConfetti();
    };

    window.onload = initQuiz;
</script>

</body>
</html>
