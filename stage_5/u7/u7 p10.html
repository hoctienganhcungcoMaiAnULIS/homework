<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Gi·ªõi T·ª´ C√πng Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f4f8;
            --card-bg: #ffffff;
            --text-main: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(var(--primary) 1px, transparent 1px), radial-gradient(var(--secondary) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: var(--primary);
            text-align: center;
            text-shadow: 2px 2px 0px #fff;
            font-weight: 900;
            margin-bottom: 10px;
            font-size: 2.2rem;
            background: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid var(--primary);
        }

        .teacher-badge {
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 30px;
            box-shadow: 0 4px 0 #009e82;
        }

        .quiz-container {
            width: 100%;
            max-width: 800px;
        }

        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.15);
            border: 2px solid #e1e1e1;
            position: relative;
            transition: transform 0.3s ease;
        }

        .question-number {
            position: absolute;
            top: -15px;
            left: 20px;
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 800;
            box-shadow: 0 4px 0 #6c429c;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 15px;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-bottom: 5px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-main);
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            background-color: #f9f9f9;
        }

        .option-btn:active:not(:disabled) {
            border-bottom: 2px solid #e0e0e0;
            transform: translateY(3px);
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00a352;
            border-bottom-color: #00a352;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #d63030;
            border-bottom-color: #d63030;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 20px;
            background: #f0f9ff;
            border: 2px dashed var(--primary);
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-section {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .exp-label {
            font-weight: 700;
            color: #444;
            text-decoration: underline;
            text-decoration-color: var(--secondary);
            margin-right: 5px;
        }

        .vocab-list {
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.95rem;
            border: 1px solid #ddd;
        }

        .vocab-item {
            display: block;
            margin-bottom: 5px;
        }

        .highlight-green { color: var(--correct); font-weight: bold; }
        .highlight-red { color: var(--wrong); font-weight: bold; }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Submit Button */
        .submit-section {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            font-size: 1.5rem;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            border-bottom: 6px solid #009e82;
            cursor: pointer;
            font-weight: 800;
            font-family: 'Nunito', sans-serif;
            transition: all 0.2s;
            box-shadow: 0 10px 20px rgba(0, 201, 167, 0.3);
        }

        .submit-btn:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .submit-btn:active {
            border-bottom: 2px solid #009e82;
            transform: translateY(4px);
        }

        /* Result Popup */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 5px solid var(--primary);
            animation: zoomIn 0.5s;
        }

        @keyframes zoomIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .score-display {
            font-size: 3rem;
            font-weight: 900;
            color: var(--secondary);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #555;
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <h1>B√ÄI KI·ªÇM TRA GI·ªöI T·ª™ IN/ON/AT</h1>
    <div class="teacher-badge">Bi√™n so·∫°n b·ªüi: Ms Mai An ULIS</div>

    <div class="quiz-container" id="quiz-container">
        </div>

    <div class="submit-section">
        <button class="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary);">K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p class="feedback-text" id="feedback-msg">B·∫°n l√†m t·ªët l·∫Øm!</p>
            <button class="submit-btn" onclick="location.reload()" style="font-size: 1rem; padding: 10px 30px;">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <script>
        // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 C√¢u bao ph·ªß to√†n b·ªô l√Ω thuy·∫øt) ---
        const quizData = [
            // --- TIME (TH·ªúI GIAN) ---
            {
                id: 1,
                question: "I always go for a run ______ the morning.",
                options: { A: "at", B: "on", C: "in", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): d√πng cho gi·ªù/d·ªãp l·ªÖ",
                        "B. on (prep): d√πng cho ng√†y",
                        "C. in (prep): d√πng cho bu·ªïi trong ng√†y/th√°ng/nƒÉm",
                        "D. to (prep): ƒë·∫øn (h∆∞·ªõng ƒëi)"
                    ],
                    trans: "T√¥i lu√¥n ƒëi ch·∫°y b·ªô v√†o bu·ªïi s√°ng.",
                    why_correct: "D√πng <b>'in'</b> cho c√°c bu·ªïi trong ng√†y: <i>in the morning, in the afternoon, in the evening</i>.",
                    why_wrong: "C√°c ƒë√°p √°n kh√°c sai quy t·∫Øc: 'at' + gi·ªù, 'on' + ng√†y."
                }
            },
            {
                id: 2,
                question: "My grandfather was born ______ 1950.",
                options: { A: "on", B: "at", C: "in", D: "from" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. on (prep): tr√™n/v√†o ng√†y",
                        "B. at (prep): t·∫°i",
                        "C. in (prep): trong/v√†o nƒÉm",
                        "D. from (prep): t·ª´"
                    ],
                    trans: "√îng c·ªßa t√¥i sinh nƒÉm 1950.",
                    why_correct: "D√πng <b>'in'</b> tr∆∞·ªõc nƒÉm (years). V√≠ d·ª•: <i>in 1990, in 2025</i>.",
                    why_wrong: "'On' d√πng cho ng√†y c·ª• th·ªÉ, 'At' d√πng cho gi·ªù."
                }
            },
            {
                id: 3,
                question: "We usually go to the beach ______ summer.",
                options: { A: "at", B: "on", C: "in", D: "of" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): t·∫°i",
                        "B. on (prep): tr√™n",
                        "C. in (prep): trong/v√†o m√πa",
                        "D. of (prep): c·ªßa"
                    ],
                    trans: "Ch√∫ng t√¥i th∆∞·ªùng ƒëi bi·ªÉn v√†o m√πa h√®.",
                    why_correct: "D√πng <b>'in'</b> tr∆∞·ªõc c√°c m√πa: <i>in summer, in winter, in spring, in autumn</i>.",
                    why_wrong: "Kh√¥ng d√πng 'on summer' hay 'at summer'."
                }
            },
            {
                id: 4,
                question: "The meeting starts ______ 9 a.m.",
                options: { A: "in", B: "on", C: "at", D: "about" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): l√∫c (gi·ªù c·ª• th·ªÉ)",
                        "D. about (prep): kho·∫£ng"
                    ],
                    trans: "Cu·ªôc h·ªçp b·∫Øt ƒë·∫ßu l√∫c 9 gi·ªù s√°ng.",
                    why_correct: "D√πng <b>'at'</b> tr∆∞·ªõc gi·ªù c·ª• th·ªÉ: <i>at 7 o'clock, at 9 a.m.</i>",
                    why_wrong: "'In' v√† 'On' kh√¥ng d√πng cho gi·ªù ƒë·ªìng h·ªì."
                }
            },
            {
                id: 5,
                question: "I have an English class ______ Monday.",
                options: { A: "in", B: "at", C: "on", D: "by" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. on (prep): v√†o (th·ª©)",
                        "D. by (prep): b·ªüi/tr∆∞·ªõc"
                    ],
                    trans: "T√¥i c√≥ l·ªõp ti·∫øng Anh v√†o th·ª© Hai.",
                    why_correct: "D√πng <b>'on'</b> tr∆∞·ªõc c√°c th·ª© trong tu·∫ßn: <i>on Monday, on Sunday</i>.",
                    why_wrong: "Sai quy t·∫Øc: 'in Monday' hay 'at Monday' l√† sai."
                }
            },
            {
                id: 6,
                question: "Ho Chi Minh was born ______ May 19th, 1890.",
                options: { A: "in", B: "on", C: "at", D: "since" },
                correct: "B",
                explanation: {
                    vocab: [
                        "A. in (prep): th√°ng/nƒÉm",
                        "B. on (prep): ng√†y c·ª• th·ªÉ",
                        "C. at (prep): gi·ªù",
                        "D. since (prep): k·ªÉ t·ª´"
                    ],
                    trans: "H·ªì Ch√≠ Minh sinh ng√†y 19 th√°ng 5 nƒÉm 1890.",
                    why_correct: "D√πng <b>'on'</b> tr∆∞·ªõc ng√†y th√°ng nƒÉm c·ª• th·ªÉ (ƒë·∫ßy ƒë·ªß ng√†y).",
                    why_wrong: "N·∫øu ch·ªâ c√≥ th√°ng/nƒÉm m·ªõi d√πng 'in' (in May, in 1890). Nh∆∞ng c√≥ ng√†y 19 -> Ph·∫£i d√πng 'On'."
                }
            },
            {
                id: 7,
                question: "We give gifts to each other ______ Christmas Day.",
                options: { A: "at", B: "in", C: "on", D: "for" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): t·∫°i",
                        "B. in (prep): trong",
                        "C. on (prep): v√†o ng√†y",
                        "D. for (prep): cho"
                    ],
                    trans: "Ch√∫ng t√¥i t·∫∑ng qu√† cho nhau v√†o Ng√†y Gi√°ng Sinh.",
                    why_correct: "C√≥ ch·ªØ <b>'Day'</b> th√¨ ph·∫£i d√πng <b>'On'</b>: <i>On Christmas Day</i>.",
                    why_wrong: "L∆∞u √Ω: N·∫øu n√≥i v·ªÅ d·ªãp l·ªÖ chung chung kh√¥ng c√≥ ch·ªØ 'Day' th√¨ d√πng 'At Christmas'. Nh∆∞ng ·ªü ƒë√¢y c√≥ 'Day' n√™n 'On' l√† ƒë√°p √°n ƒë√∫ng duy nh·∫•t."
                }
            },
            {
                id: 8,
                question: "I often read books ______ night.",
                options: { A: "in", B: "on", C: "at", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): v√†o (ban ƒë√™m)",
                        "D. to (prep): ƒë·∫øn"
                    ],
                    trans: "T√¥i th∆∞·ªùng ƒë·ªçc s√°ch v√†o ban ƒë√™m.",
                    why_correct: "C·ª•m c·ªë ƒë·ªãnh: <b>at night</b>, <b>at noon</b>.",
                    why_wrong: "Ta n√≥i 'in the evening' nh∆∞ng l·∫°i n√≥i 'at night'. ƒê√¢y l√† ngo·∫°i l·ªá ph·∫£i nh·ªõ."
                }
            },
            {
                id: 9,
                question: "The bus will arrive ______ 10 minutes.",
                options: { A: "at", B: "on", C: "in", D: "for" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): l√∫c",
                        "B. on (prep): tr√™n",
                        "C. in (prep): trong (kho·∫£ng th·ªùi gian t·ªõi)",
                        "D. for (prep): kho·∫£ng (ƒë√£ qua)"
                    ],
                    trans: "Xe bu√Ωt s·∫Ω ƒë·∫øn trong 10 ph√∫t n·ªØa.",
                    why_correct: "D√πng <b>'in' + kho·∫£ng th·ªùi gian</b> ƒë·ªÉ ch·ªâ t∆∞∆°ng lai (trong bao l√¢u n·ªØa): <i>in a minute, in two weeks</i>.",
                    why_wrong: "'For' ch·ªâ ƒë·ªô d√†i h√†nh ƒë·ªông (ƒë√£ x·∫£y ra), 'At/On' kh√¥ng k·∫øt h·ª£p v·ªõi kho·∫£ng th·ªùi gian theo nghƒ©a n√†y."
                }
            },
            {
                id: 10,
                question: "She is busy ______ the moment.",
                options: { A: "in", B: "on", C: "with", D: "at" },
                correct: "D",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. with (prep): v·ªõi",
                        "D. at (prep): t·∫°i"
                    ],
                    trans: "C√¥ ·∫•y ƒëang b·∫≠n ngay l√∫c n√†y.",
                    why_correct: "C·ª•m c·ªë ƒë·ªãnh: <b>at the moment</b> (ngay l√∫c n√†y) = now.",
                    why_wrong: "Kh√¥ng d√πng in/on the moment."
                }
            },
            // --- PLACE (N∆†I CH·ªêN) ---
            {
                id: 11,
                question: "My uncle lives ______ Hanoi.",
                options: { A: "at", B: "on", C: "in", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): t·∫°i ƒëi·ªÉm nh·ªè",
                        "B. on (prep): tr√™n b·ªÅ m·∫∑t",
                        "C. in (prep): trong (th√†nh ph·ªë/qu·ªëc gia)",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "Ch√∫ t√¥i s·ªëng ·ªü H√† N·ªôi.",
                    why_correct: "D√πng <b>'in'</b> tr∆∞·ªõc th√†nh ph·ªë, qu·ªëc gia, ch√¢u l·ª•c: <i>in Hanoi, in Vietnam, in Asia</i>.",
                    why_wrong: "'At' ch·ªâ d√πng cho ƒë·ªãa ch·ªâ c·ª• th·ªÉ ho·∫∑c ƒëi·ªÉm nh·ªè. Hanoi l√† th√†nh ph·ªë l·ªõn n√™n d√πng 'In'."
                }
            },
            {
                id: 12,
                question: "There is a beautiful picture ______ the wall.",
                options: { A: "in", B: "at", C: "on", D: "above" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. on (prep): tr√™n b·ªÅ m·∫∑t",
                        "D. above (prep): ph√≠a tr√™n (kh√¥ng ch·∫°m)"
                    ],
                    trans: "C√≥ m·ªôt b·ª©c tranh ƒë·∫πp ·ªü tr√™n t∆∞·ªùng.",
                    why_correct: "D√πng <b>'on'</b> khi v·∫≠t n·∫±m tr√™n m·ªôt b·ªÅ m·∫∑t: <i>on the wall, on the table, on the floor</i>.",
                    why_wrong: "'In' l√† ·ªü b√™n trong. 'At' l√† t·∫°i m·ªôt ƒëi·ªÉm."
                }
            },
            {
                id: 13,
                question: "They are waiting ______ the bus stop.",
                options: { A: "in", B: "on", C: "at", D: "under" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i (ƒëi·ªÉm)",
                        "D. under (prep): d∆∞·ªõi"
                    ],
                    trans: "H·ªç ƒëang ƒë·ª£i ·ªü tr·∫°m xe bu√Ωt.",
                    why_correct: "D√πng <b>'at'</b> cho m·ªôt ƒëi·ªÉm d·ª´ng c·ª• th·ªÉ, n∆°i c√¥ng c·ªông nh·ªè: <i>at the bus stop, at the door, at the airport</i>.",
                    why_wrong: "Kh√¥ng d√πng 'in' (kh√¥ng ph·∫£i kh√¥ng gian k√≠n) hay 'on'."
                }
            },
            {
                id: 14,
                question: "Don't sit ______ the floor! It's dirty.",
                options: { A: "in", B: "at", C: "to", D: "on" },
                correct: "D",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. to (prep): t·ªõi",
                        "D. on (prep): tr√™n"
                    ],
                    trans: "ƒê·ª´ng ng·ªìi tr√™n s√†n nh√†! N√≥ b·∫©n l·∫Øm.",
                    why_correct: "S√†n nh√† (floor) l√† m·ªôt b·ªÅ m·∫∑t -> D√πng <b>'on'</b>.",
                    why_wrong: "C√°c gi·ªõi t·ª´ kh√°c kh√¥ng ch·ªâ v·ªã tr√≠ ti·∫øp x√∫c b·ªÅ m·∫∑t."
                }
            },
            {
                id: 15,
                question: "Her house is ______ 25 Tran Phu Street.",
                options: { A: "in", B: "on", C: "at", D: "by" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i (ƒë·ªãa ch·ªâ)",
                        "D. by (prep): b√™n c·∫°nh"
                    ],
                    trans: "Nh√† c√¥ ·∫•y ·ªü s·ªë 25 ƒë∆∞·ªùng Tr·∫ßn Ph√∫.",
                    why_correct: "Khi c√≥ **s·ªë nh√† c·ª• th·ªÉ**, ta d√πng <b>'at'</b>: <i>at 25 Tran Phu Street</i>.",
                    why_wrong: "L∆∞u √Ω: N·∫øu ch·ªâ c√≥ t√™n ƒë∆∞·ªùng (Tran Phu Street) th√¨ d√πng 'On'. Nh∆∞ng c√≥ s·ªë nh√† th√¨ b·∫Øt bu·ªôc d√πng 'At'."
                }
            },
            {
                id: 16,
                question: "I think I left my phone ______ the box.",
                options: { A: "at", B: "on", C: "in", D: "of" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. at (prep): t·∫°i",
                        "B. on (prep): tr√™n",
                        "C. in (prep): trong (kh√¥ng gian k√≠n)",
                        "D. of (prep): c·ªßa"
                    ],
                    trans: "T√¥i nghƒ© t√¥i ƒë√£ ƒë·ªÉ qu√™n ƒëi·ªán tho·∫°i trong h·ªôp.",
                    why_correct: "H·ªôp (box) l√† kh√¥ng gian ch·ª©a ƒë·ª±ng b√™n trong -> D√πng <b>'in'</b>.",
                    why_wrong: "'On' l√† ƒë·ªÉ tr√™n n·∫Øp h·ªôp. C√¢u n√†y √Ω n√≥i ƒë·ªÉ b√™n trong."
                }
            },
            {
                id: 17,
                question: "Phu Quoc is an island. We are ______ Phu Quoc Island.",
                options: { A: "in", B: "at", C: "on", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. on (prep): tr√™n (ƒë·∫£o)",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "Ph√∫ Qu·ªëc l√† m·ªôt h√≤n ƒë·∫£o. Ch√∫ng t√¥i ƒëang ·ªü tr√™n ƒë·∫£o Ph√∫ Qu·ªëc.",
                    why_correct: "Tr∆∞·ªõc t√™n c√°c h√≤n ƒë·∫£o (island), ta d√πng <b>'on'</b>: <i>on Phu Quoc Island</i>.",
                    why_wrong: "Kh√¥ng d√πng 'in' cho ƒë·∫£o (tr·ª´ khi coi n√≥ l√† m·ªôt ƒë∆°n v·ªã h√†nh ch√≠nh/qu·ªëc gia l·ªõn nh∆∞ In Japan, nh∆∞ng ƒë·∫£o du l·ªãch th∆∞·ªùng d√πng On)."
                }
            },
            {
                id: 18,
                question: "Someone is standing ______ the door.",
                options: { A: "on", B: "in", C: "at", D: "under" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. on (prep): tr√™n",
                        "B. in (prep): trong",
                        "C. at (prep): t·∫°i",
                        "D. under (prep): d∆∞·ªõi"
                    ],
                    trans: "C√≥ ai ƒë√≥ ƒëang ƒë·ª©ng ·ªü c·ª≠a.",
                    why_correct: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: <b>at the door</b> (ƒë·ª©ng ngay t·∫°i v·ªã tr√≠ c·ª≠a).",
                    why_wrong: "'In the door' nghƒ©a l√† b·ªã k·∫πt trong c√°nh c·ª≠a. 'On the door' l√† g·∫Øn tr√™n c√°nh c·ª≠a."
                }
            },
            {
                id: 19,
                question: "My father is working ______ the garden.",
                options: { A: "on", B: "at", C: "in", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. on (prep): tr√™n",
                        "B. at (prep): t·∫°i",
                        "C. in (prep): trong",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "B·ªë t√¥i ƒëang l√†m vi·ªác trong v∆∞·ªùn.",
                    why_correct: "V∆∞·ªùn (garden) l√† m·ªôt kh√¥ng gian c√≥ bao quanh -> D√πng <b>'in the garden'</b>.",
                    why_wrong: "Kh√¥ng d√πng 'on the garden' hay 'at the garden'."
                }
            },
            {
                id: 20,
                question: "The supermarket is ______ the left.",
                options: { A: "in", B: "at", C: "by", D: "on" },
                correct: "D",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. by (prep): c·∫°nh",
                        "D. on (prep): tr√™n/b√™n"
                    ],
                    trans: "Si√™u th·ªã ·ªü b√™n tay tr√°i.",
                    why_correct: "Ch·ªâ h∆∞·ªõng: <b>on the left, on the right</b>.",
                    why_wrong: "Kh√¥ng d√πng in/at cho ph∆∞∆°ng h∆∞·ªõng tr√°i ph·∫£i."
                }
            },
            // --- VEHICLES (PH∆Ø∆†NG TI·ªÜN) ---
            {
                id: 21,
                question: "We are traveling to Da Nang ______ a plane.",
                options: { A: "in", B: "on", C: "at", D: "by" },
                correct: "B",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i",
                        "D. by (prep): b·∫±ng (nh∆∞ng by + ph∆∞∆°ng ti·ªán kh√¥ng c√≥ 'a')"
                    ],
                    trans: "Ch√∫ng t√¥i ƒëang ƒëi du l·ªãch ƒë·∫øn ƒê√† N·∫µng tr√™n m·ªôt chi·∫øc m√°y bay.",
                    why_correct: "V·ªõi ph∆∞∆°ng ti·ªán c√¥ng c·ªông l·ªõn c√≥ th·ªÉ ƒëi l·∫°i b√™n trong (bus, train, plane, ship) + bike, ta d√πng <b>'on'</b>.",
                    why_wrong: "N·∫øu d√πng 'by' th√¨ kh√¥ng c√≥ m·∫°o t·ª´ 'a' (by plane). ·ªû ƒë√¢y c√≥ 'a' -> d√πng 'on'."
                }
            },
            {
                id: 22,
                question: "Hurry up! Get ______ the car.",
                options: { A: "on", B: "at", C: "in", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. on (prep): tr√™n",
                        "B. at (prep): t·∫°i",
                        "C. in (prep): trong",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "Nhanh l√™n! V√†o trong xe √¥ t√¥ ƒëi.",
                    why_correct: "V·ªõi √¥ t√¥ (car) v√† taxi, ta ph·∫£i khom ng∆∞·ªùi chui v√†o -> D√πng <b>'in'</b> (in a car, in a taxi).",
                    why_wrong: "Kh√¥ng d√πng 'on a car' (tr·ª´ khi ng·ªìi tr√™n n√≥c xe)."
                }
            },
            {
                id: 23,
                question: "I saw him sitting ______ the bus this morning.",
                options: { A: "in", B: "on", C: "at", D: "from" },
                correct: "B",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i",
                        "D. from (prep): t·ª´"
                    ],
                    trans: "T√¥i th·∫•y anh ·∫•y ng·ªìi tr√™n xe bu√Ωt s√°ng nay.",
                    why_correct: "Xe bu√Ωt (bus) -> D√πng <b>'on'</b> (on the bus).",
                    why_wrong: "Bus l√† ph∆∞∆°ng ti·ªán l·ªõn, s√†n ph·∫≥ng, ƒëi l·∫°i ƒë∆∞·ª£c -> On."
                }
            },
            // --- ARRIVE & MOTION (ƒê·∫æN & DI CHUY·ªÇN) ---
            {
                id: 24,
                question: "They arrived ______ London at 6 a.m.",
                options: { A: "to", B: "on", C: "in", D: "at" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. to (prep): t·ªõi (kh√¥ng d√πng sau arrive)",
                        "B. on (prep): tr√™n",
                        "C. in (prep): t·∫°i (n∆°i l·ªõn)",
                        "D. at (prep): t·∫°i (n∆°i nh·ªè)"
                    ],
                    trans: "H·ªç ƒë√£ ƒë·∫øn London l√∫c 6 gi·ªù s√°ng.",
                    why_correct: "Arrive in + Th√†nh ph·ªë/Qu·ªëc gia. London l√† th√†nh ph·ªë l·ªõn -> <b>Arrive in</b>.",
                    why_wrong: "Sai l·∫ßm ph·ªï bi·∫øn: Arrive KH√îNG ƒëi v·ªõi 'to'. Arrive at ch·ªâ d√πng cho ƒë·ªãa ƒëi·ªÉm nh·ªè."
                }
            },
            {
                id: 25,
                question: "When did you arrive ______ the hotel?",
                options: { A: "in", B: "at", C: "to", D: "on" },
                correct: "B",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. to (prep): t·ªõi",
                        "D. on (prep): tr√™n"
                    ],
                    trans: "B·∫°n ƒë√£ ƒë·∫øn kh√°ch s·∫°n khi n√†o?",
                    why_correct: "Kh√°ch s·∫°n (hotel) l√† ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ, t√≤a nh√† -> D√πng <b>Arrive at</b>.",
                    why_wrong: "Kh√¥ng d√πng 'Arrive in' (tr·ª´ khi n√≥i v·ªÅ th√†nh ph·ªë ch·ª©a kh√°ch s·∫°n)."
                }
            },
            {
                id: 26,
                question: "He goes ______ school by bike every day.",
                options: { A: "in", B: "at", C: "to", D: "on" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. at (prep): t·∫°i",
                        "C. to (prep): ƒë·∫øn",
                        "D. on (prep): tr√™n"
                    ],
                    trans: "Anh ·∫•y ƒëi ƒë·∫øn tr∆∞·ªùng b·∫±ng xe ƒë·∫°p m·ªói ng√†y.",
                    why_correct: "ƒê·ªông t·ª´ ch·ªâ chuy·ªÉn ƒë·ªông (Go, Come, Move) + <b>'to'</b>: <i>go to school, go to work</i>.",
                    why_wrong: "Kh√¥ng n√≥i 'go in school' hay 'go at school'."
                }
            },
            {
                id: 27,
                question: "Look! The bird is ______ the top of the tree.",
                options: { A: "in", B: "on", C: "at", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i (ƒë·ªânh)",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "Nh√¨n k√¨a! Con chim ƒëang ·ªü tr√™n ng·ªçn c√¢y.",
                    why_correct: "C·ª•m t·ª´: <b>at the top of</b> (·ªü tr√™n ƒë·ªânh/ng·ªçn) ho·∫∑c <b>at the bottom of</b> (·ªü d∆∞·ªõi ƒë√°y).",
                    why_wrong: "'On the top' c≈©ng d√πng ƒë∆∞·ª£c nh∆∞ng 'at the top of' ph·ªï bi·∫øn h∆°n khi ch·ªâ v·ªã tr√≠ ƒëi·ªÉm cao nh·∫•t c·ªßa v·∫≠t th·ªÉ."
                }
            },
            {
                id: 28,
                question: "My birthday is ______ September.",
                options: { A: "on", B: "at", C: "in", D: "of" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. on (prep): ng√†y",
                        "B. at (prep): gi·ªù",
                        "C. in (prep): th√°ng",
                        "D. of (prep): c·ªßa"
                    ],
                    trans: "Sinh nh·∫≠t t√¥i l√† v√†o th√°ng Ch√≠n.",
                    why_correct: "Ch·ªâ c√≥ th√°ng (kh√¥ng c√≥ ng√†y) -> D√πng <b>'in'</b>: <i>in September</i>.",
                    why_wrong: "N·∫øu c√≥ ng√†y (Sep 2nd) m·ªõi d√πng On."
                }
            },
            {
                id: 29,
                question: "Is Tom ______ work today?",
                options: { A: "in", B: "on", C: "at", D: "to" },
                correct: "C",
                explanation: {
                    vocab: [
                        "A. in (prep): trong",
                        "B. on (prep): tr√™n",
                        "C. at (prep): t·∫°i (n∆°i ch·ªën/ch·ª©c nƒÉng)",
                        "D. to (prep): t·ªõi"
                    ],
                    trans: "H√¥m nay Tom c√≥ ƒëi l√†m kh√¥ng (·ªü ch·ªó l√†m kh√¥ng)?",
                    why_correct: "C·ª•m c·ªë ƒë·ªãnh ch·ªâ tr·∫°ng th√°i ƒëang l√†m vi·ªác/ƒëi h·ªçc: <b>at work, at school, at home</b>.",
                    why_wrong: "Kh√¥ng d√πng 'in work'."
                }
            },
            {
                id: 30,
                question: "We stayed ______ a very nice hotel.",
                options: { A: "to", B: "in", C: "on", D: "at" },
                correct: "D",
                explanation: {
                    vocab: [
                        "A. to (prep): t·ªõi",
                        "B. in (prep): trong",
                        "C. on (prep): tr√™n",
                        "D. at (prep): t·∫°i"
                    ],
                    trans: "Ch√∫ng t√¥i ƒë√£ ·ªü t·∫°i m·ªôt kh√°ch s·∫°n r·∫•t ƒë·∫πp.",
                    why_correct: "Stay <b>at</b> + ƒë·ªãa ƒëi·ªÉm (hotel, home).",
                    why_wrong: "C√≥ th·ªÉ d√πng 'stay in' (·ªü trong) nh∆∞ng 'stay at' ph·ªï bi·∫øn h∆°n khi n√≥i v·ªÅ ƒë·ªãa ƒëi·ªÉm c∆∞ tr√∫ t·∫°m th·ªùi."
                }
            }
        ];

        // --- √ÇM THANH (Base64 ƒë·ªÉ ch·∫°y Single File) ---
        // Ding (Correct)
        const soundCorrect = new Audio("data:audio/mp3;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG84n418AAoAAIv4+bL//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG84n418AAoAAIv4+bL//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG84n418AAoAAIv4+bL//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAG84n418AAoAAIv4+bL"); // Placeholder short beep (th·ª±c t·∫ø c·∫ßn file x·ªãn h∆°n, ·ªü ƒë√¢y gi·∫£ l·∫≠p)
        // D√πng link online cho √¢m thanh hay h∆°n
        const audioDing = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
        const audioBuzz = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');

        // --- TR·∫†NG TH√ÅI GAME ---
        let score = 0;
        let answeredCount = 0;

        // --- H√ÄM KH·ªûI T·∫†O ---
        function initQuiz() {
            const container = document.getElementById('quiz-container');
            // Shuffle c√¢u h·ªèi
            shuffleArray(quizData);
            
            quizData.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-${q.id}`;
                
                // T·∫°o HTML cho t·ª´ng c√¢u
                let optionsHtml = '';
                ['A', 'B', 'C', 'D'].forEach(opt => {
                    optionsHtml += `<button class="option-btn" onclick="checkAnswer(${q.id}, '${opt}', this)">${opt}. ${q.options[opt]}</button>`;
                });

                // T·∫°o Vocabulary List HTML
                let vocabHtml = q.explanation.vocab.map(v => `<span class="vocab-item">‚Ä¢ ${v}</span>`).join('');

                card.innerHTML = `
                    <div class="question-number">C√¢u ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid">
                        ${optionsHtml}
                    </div>
                    <div class="explanation-box" id="exp-${q.id}">
                        <div class="explanation-header">üìù GI·∫¢I TH√çCH CHI TI·∫æT (C√¥ Mai An):</div>
                        
                        <div class="exp-section">
                            <span class="exp-label">1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</span>
                            <div class="vocab-list">${vocabHtml}</div>
                        </div>

                        <div class="exp-section">
                            <span class="exp-label">2. D·ªãch nghƒ©a:</span>
                            "${q.explanation.trans}"
                        </div>

                        <div class="exp-section">
                            <span class="exp-label">3. T·∫°i sao ƒê√öNG?</span>
                            <span class="highlight-green">${q.explanation.why_correct}</span>
                        </div>

                        <div class="exp-section">
                            <span class="exp-label">4. T·∫°i sao SAI?</span>
                            <span class="highlight-red">${q.explanation.why_wrong}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- H√ÄM X·ª¨ L√ù CH·ªåN ƒê√ÅP √ÅN ---
        function checkAnswer(qId, selectedOpt, btnElement) {
            const questionObj = quizData.find(q => q.id === qId);
            const card = document.getElementById(`q-${qId}`);
            const allBtns = card.querySelectorAll('.option-btn');
            const expBox = document.getElementById(`exp-${qId}`);

            // Ch·∫∑n click l·∫°i
            if (btnElement.disabled) return;
            
            // Disable t·∫•t c·∫£ n√∫t trong c√¢u n√†y
            allBtns.forEach(btn => btn.disabled = true);

            if (selectedOpt === questionObj.correct) {
                // ƒê√öNG
                btnElement.classList.add('correct');
                score++;
                audioDing.currentTime = 0;
                audioDing.play();
                fireConfetti();
            } else {
                // SAI
                btnElement.classList.add('wrong');
                // T√¨m n√∫t ƒë√∫ng ƒë·ªÉ b√¥i xanh
                allBtns.forEach(btn => {
                    if (btn.innerText.startsWith(questionObj.correct)) {
                        btn.classList.add('correct');
                    }
                });
                audioBuzz.currentTime = 0;
                audioBuzz.play();
            }

            answeredCount++;
            // Hi·ªán gi·∫£i th√≠ch
            expBox.style.display = 'block';
        }

        // --- H√ÄM N·ªòP B√ÄI ---
        function submitQuiz() {
            if (answeredCount < quizData.length) {
                if(!confirm(`B·∫°n m·ªõi l√†m ${answeredCount}/${quizData.length} c√¢u. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`)) {
                    return;
                }
            }

            const modal = document.getElementById('resultModal');
            const scoreDisplay = document.getElementById('final-score');
            const feedback = document.getElementById('feedback-msg');

            scoreDisplay.innerText = `${score}/${quizData.length}`;
            
            // L·ªùi khen ng·∫´u nhi√™n
            const percentage = (score / quizData.length) * 100;
            if (percentage === 100) feedback.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng·ªØ ph√°p! üåüüèÜ";
            else if (percentage >= 80) feedback.innerText = "Gi·ªèi qu√°! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ b·∫°n! üéâ";
            else if (percentage >= 50) feedback.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng √¥n th√™m x√≠u n·ªØa l√† ƒëi·ªÉm 10 nha! üí™";
            else feedback.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ ti·∫øn b·ªô h∆°n! ‚ù§Ô∏è";

            modal.style.display = 'flex';
            fireConfetti();
        }

        // --- UTILS: SHUFFLE ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- CONFETTI EFFECT (Simple Implementation) ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const pieces = [];
            const numberOfPieces = 100;
            const colors = ['#8854C0', '#00C9A7', '#FF4757', '#FFD700'];

            for (let i = 0; i < numberOfPieces; i++) {
                pieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    w: Math.random() * 10 + 5,
                    h: Math.random() * 10 + 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    speed: Math.random() * 5 + 2,
                    angle: Math.random() * 360
                });
            }

            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                pieces.forEach(p => {
                    p.y += p.speed;
                    p.angle += 2;
                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.angle * Math.PI / 180);
                    ctx.fillStyle = p.color;
                    ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                    ctx.restore();
                    if (p.y < canvas.height) active = true;
                });

                if (active) requestAnimationFrame(update);
                else ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            update();
        }

        // Start Quiz on Load
        window.onload = initQuiz;

    </script>
</body>
</html>