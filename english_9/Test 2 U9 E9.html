<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIT 9 – WORLD ENGLISHES | Ms Mai An ULIS</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --font-main: 'Segoe UI', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-bottom: 80px; /* Space for sticky footer */
            line-height: 1.6;
        }

        /* --- Header --- */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        header p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* --- Card Styles --- */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .section-title {
            color: var(--primary-color);
            font-weight: 700;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 30px;
        }

        /* --- Question Styles --- */
        .question-box {
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
            padding-left: 15px;
        }

        .question-text {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 15px;
        }

        .question-text u {
            text-decoration: underline;
            text-decoration-thickness: 2px;
            text-decoration-color: var(--primary-color);
        }

        /* --- Options --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-label:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
        }

        .option-label input {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* --- Specific Layouts --- */
        .data-box {
            background-color: #eef2f7;
            border: 1px solid #d1d9e6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        /* Gap Fill / Sentence Insertion Layout */
        .gap-fill-container {
            border: 1px solid #ced4da;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .gap-options-box {
            background-color: #d1ecf1;
            padding: 15px;
            border-bottom: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .gap-options-box p { margin: 5px 0; font-weight: 500;}

        .gap-text-box {
            padding: 20px;
            background-color: #fff;
            border-bottom: 1px solid #ced4da;
            font-size: 1rem;
        }

        .gap-answer-area {
            padding: 15px;
            background-color: #f8f9fa;
        }

        /* --- Glossary Table --- */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
            background: white;
        }

        .glossary-table th, .glossary-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }

        .glossary-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .glossary-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 10px;
            display: block;
        }

        /* --- CSS Signs (Q29, Q30) --- */
        .sign-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .sign-board {
            width: 180px;
            height: 180px;
            border: 6px solid #333;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            text-align: center;
            font-family: Arial, sans-serif;
        }

        .sign-header {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 14px;
            line-height: 1.1;
            color: #222;
        }
        
        .sign-footer {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 12px;
            color: #c00;
            margin-top: 5px;
        }

        .ban-circle {
            width: 100px;
            height: 100px;
            border: 8px solid #cc0000;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ban-circle::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 100%;
            background-color: #cc0000;
            transform: rotate(-45deg);
        }

        .sign-icon {
            width: 60px;
            height: 60px;
            fill: black;
            z-index: 1; /* Behind the slash */
        }
        
        /* --- Feedback & Buttons --- */
        .btn-check {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .btn-check:hover { background-color: #5a6268; }

        .explanation-box {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f5e9;
            border-left: 4px solid var(--success-color);
            border-radius: 4px;
            font-size: 0.95rem;
        }

        .explanation-box.visible { display: block; }
        
        .expl-label { font-weight: bold; color: var(--success-color); }
        .expl-trans { color: #555; font-style: italic; display: block; margin-bottom: 5px; }
        .expl-wrong { color: var(--danger-color); margin-top: 5px; font-size: 0.9rem;}

        /* Status colors for options */
        .option-label.correct { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .option-label.wrong { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .card.unanswered { border: 2px solid var(--warning-color); }

        /* --- Footer --- */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .btn-submit {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,86,179,0.3);
            transition: transform 0.1s;
        }

        .btn-submit:hover { transform: scale(1.05); background-color: #004494; }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }

    </style>
</head>
<body>

<header>
    <h1>UNIT 9 – WORLD ENGLISHES (TEST 02)</h1>
    <p>Giáo viên tạo: Ms Mai An ULIS</p>
</header>

<div class="container" id="quiz-container">
    </div>

<div class="sticky-footer">
    <button class="btn-submit" onclick="submitQuiz()">NỘP BÀI (SUBMIT)</button>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div class="score-circle" id="scoreDisplay">0/40</div>
        <h2>Kết quả của bạn</h2>
        <p id="scoreMessage">Hãy xem lại phần giải thích chi tiết bên dưới nhé!</p>
        <button class="btn-check" onclick="closeModal()" style="background: var(--primary-color); width: 100%;">Xem chi tiết</button>
    </div>
</div>

<script>
// --- DATABASE CÂU HỎI ---
const quizData = [
    // PHẦN 1: PHONETICS
    {
        id: 1,
        type: 'phonetics',
        instruction: "Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.",
        question: "A. disc<u>u</u>ssion | B. f<u>u</u>nction | C. fl<u>u</u>ent | D. <u>u</u>nstressed",
        options: ["discussion", "function", "fluent", "unstressed"],
        answer: 2, // C (0-index based)
        explanation: {
            trans: "A. discussion /dɪˈskʌʃn/ (n): cuộc thảo luận<br>B. function /ˈfʌŋkʃn/ (n): chức năng<br>C. fluent /ˈfluːənt/ (adj): trôi chảy<br>D. unstressed /ˌʌnˈstrest/ (adj): không nhấn âm",
            why: "Đáp án C phát âm là /uː/. Các đáp án còn lại phát âm là /ʌ/.",
            wrong: ""
        }
    },
    {
        id: 2,
        type: 'phonetics',
        instruction: "",
        question: "A. exampl<u>es</u> | B. languag<u>es</u> | C. stress<u>es</u> | D. sentenc<u>es</u>",
        options: ["examples", "languages", "stresses", "sentences"],
        answer: 0, // A
        explanation: {
            trans: "A. examples /ɪɡˈzɑːmplz/ (n): ví dụ<br>B. languages /ˈlæŋɡwɪdʒɪz/ (n): ngôn ngữ<br>C. stresses /ˈstresɪz/ (n): trọng âm<br>D. sentences /ˈsentənsɪz/ (n): câu",
            why: "Đáp án A đuôi -es phát âm là /z/. Các đáp án còn lại (B, C, D) đuôi -es phát âm là /ɪz/ do từ kết thúc bằng âm xuýt (/dʒ/, /s/).",
            wrong: ""
        }
    },
    // PHẦN 2: STRESS
    {
        id: 3,
        type: 'stress',
        instruction: "Mark the letter A, B, C or D to indicate the word that differs from the other three in the position of primary stress.",
        question: "Choose the word with different stress pattern.",
        options: ["aggression", "medical", "rarity", "confident"], // Fixed typo 'agression' -> 'aggression'
        answer: 0, // A
        explanation: {
            trans: "A. aggression /əˈɡreʃn/ (n): sự xâm lược (nhấn âm 2)<br>B. medical /ˈmedɪkl/ (adj): thuộc y học (nhấn âm 1)<br>C. rarity /ˈreərəti/ (n): sự hiếm có (nhấn âm 1)<br>D. confident /ˈkɒnfɪdənt/ (adj): tự tin (nhấn âm 1)",
            why: "Đáp án A nhấn âm 2. Các đáp án còn lại nhấn âm 1.",
            wrong: ""
        }
    },
    {
        id: 4,
        type: 'stress',
        instruction: "",
        question: "Choose the word with different stress pattern.",
        options: ["information", "administer", "facility", "theoretical"], 
        answer: 1, // B is wrong? Wait. Info(3), Administer(2), Facility(2), Theoretical(3). Wait.
        // Info /ˌɪnfəˈmeɪʃn/ (3), Administer /ədˈmɪnɪstə(r)/ (2), Facility /fəˈsɪləti/ (2), Theoretical /ˌθɪəˈretɪkl/ (3).
        // Let's re-check grouping. A(3), B(2), C(2), D(3). No unique one.
        // Let's check prompt again. A. information, B. administer, C. facility, D. theoretical.
        // Maybe C or B differs? Usually group is 3 vs 1.
        // Let's re-read carefully. Information (3). Administer (2). Facility (2). Theoretical (3).
        // ERROR IN QUESTION DATA? Or maybe Theoretical is /ˌθɪəˈretɪkl/ (3) but sometimes main stress considered?
        // Let's assume the question meant "simplicity" or something else.
        // But I must follow data. Let's look for a typo.
        // Maybe "Theoretical" vs others? Or maybe "Administer" vs others?
        // Let's pick B and C as group (2). A and D as group (3). There is no single answer.
        // HOWEVER, "theoretical" primary stress is on 'ret'. "information" on 'ma'.
        // Let's check if 'theoretical' can be stressed differently. No.
        // I will mark B (Administer - 2) and Explain the anomaly in data, OR assume A/D have secondary stress?
        // Let's look closer. Info (3). Theo (3). Admin (2). Facil (2).
        // Actually, maybe D is A-theoretical? No.
        // Let's assume the Answer Key intended B (Administer) and the odd one out was supposed to be A, D and something else like "Economics".
        // BUT, strictly speaking based on the provided text: 
        // Let's Assume A, C, D are Nouns/Adj.
        // Let's pick C. Facility /fəˈsɪləti/ (2). Administer (2). 
        // Is it possible "Theoretical" is considered 4? /ˌθɪəˈretɪkl/. No.
        // I will set ANSWER as A (Information - suffix -tion usually clear) if others were 2?
        // Let's check typical exams. Usually, Words ending in -tion (3), -ical (preceding).
        // Let's assume the answer is **A** and explain D might be typo. Or Answer **B/C** vs A/D. 
        // Let's go with B (Administer) and assume D was meant to be different. 
        // *Correction*: Let's check typical English tests. "Administer" (2). "Facility" (2). "Information" (3). "Theoretical" (3). 
        // This question has 2 pairs. I will Choose **A** and explain it is 3, while B&C are 2, and claim D is the error in question, OR usually questions like this might have "Facility" read differently by students?
        // Actually, let's look at syllables. In-for-ma-tion (4), Ad-mi-ni-ster (4), Fa-ci-li-ty (4), The-o-re-ti-cal (5).
        // I will default to **A** (Information) being the distractor in some context, but realistically I will mark **B** and explain clearly the stress of all 4. 
        // WAIT! Let's re-read standard accent rules.
        // Let's swap to: B. Administer. Explanation will clarify. 
        // Actually, looking at typical Vietnamese exams, sometimes "Theoretical" is treated as stress on 1 or 2 by mistake? No.
        // I will mark **A** (Information) as the odd one out if I assume others are 2. (Theoretical is definitely 3).
        // Let's check if A is B. Administer (2), Facility (2).
        // I will choose **A** and say "Group 2 vs Group 3". It's a bad question in the source.
        // **Let's pretend D is 'Identity' (2) or something.** No, I must respect data.
        // I will mark **A** and explain.
        explanation: {
            trans: "A. information /ˌɪnfəˈmeɪʃn/ (3)<br>B. administer /ədˈmɪnɪstə(r)/ (2)<br>C. facility /fəˈsɪləti/ (2)<br>D. theoretical /ˌθɪəˈretɪkl/ (3)",
            why: "Câu hỏi này trong đề bài gốc có vấn đề vì có 2 từ trọng âm 2 (B, C) và 2 từ trọng âm 3 (A, D). Tuy nhiên, nếu bắt buộc chọn, ta thường thấy suffix -tion và -ical có quy tắc nhấn trước nó. Administer và Facility nhấn âm 2.",
            wrong: "Lỗi đề bài: Không có đáp án duy nhất đúng."
        }
    },
    // PHẦN 3: GRAMMAR & VOCAB
    {
        id: 5,
        type: 'grammar',
        instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
        question: "My sister decided to learn ______ English to improve her communication skills.",
        options: ["Standard", "fluent", "foreign", "especial"],
        answer: 0, // A
        explanation: {
            trans: "Chị gái tôi quyết định học tiếng Anh chuẩn để cải thiện kỹ năng giao tiếp.<br>A. Standard (adj): Chuẩn<br>B. fluent (adj): Trôi chảy (thường dùng 'speak fluent English')<br>C. foreign (adj): Nước ngoài<br>D. especial (adj): Đặc biệt",
            why: "Collocation: 'Standard English' (Tiếng Anh chuẩn) là một thuật ngữ trong chủ đề World Englishes, chỉ dạng tiếng Anh được coi là chuẩn mực trong giáo dục và truyền thông.",
            wrong: "'Fluent' là tính từ chỉ khả năng (trôi chảy), ta thường nói 'become fluent in English' chứ ít khi nói 'learn fluent English' (dù có thể hiểu, nhưng Standard hợp ngữ cảnh học thuật hơn)."
        }
    },
    {
        id: 6,
        type: 'grammar',
        instruction: "",
        question: "There are many _____ of English spoken around the world, each with its own unique accents and dialects.",
        options: ["languages", "translations", "skills", "varieties"],
        answer: 3, // D
        explanation: {
            trans: "Có nhiều biến thể của tiếng Anh được nói trên khắp thế giới...<br>A. languages: ngôn ngữ<br>B. translations: bản dịch<br>C. skills: kỹ năng<br>D. varieties: biến thể/loại",
            why: "Thuật ngữ 'Varieties of English' (các biến thể tiếng Anh như Anh-Anh, Anh-Mỹ, Anh-Úc...) là từ khóa của Unit 9.",
            wrong: "English là 1 ngôn ngữ, không thể nói 'many languages of English'."
        }
    },
    {
        id: 7,
        type: 'grammar',
        instruction: "",
        question: "We paid extra for the VIP package tour __________ provided us with an English tour guide.",
        options: ["which", "whose", "who", "whom"],
        answer: 0, // A
        explanation: {
            trans: "Chúng tôi trả thêm tiền cho gói tour VIP, cái mà cung cấp hướng dẫn viên tiếng Anh.<br>A. which: thay cho vật (package tour)<br>B. whose: chỉ sở hữu<br>C. who: thay cho người<br>D. whom: thay cho người (tân ngữ)",
            why: "Đại từ quan hệ thay thế cho danh từ chỉ vật 'VIP package tour' làm chủ ngữ cho động từ 'provided' => dùng 'which' hoặc 'that'.",
            wrong: ""
        }
    },
    {
        id: 8,
        type: 'grammar',
        instruction: "",
        question: "You don’t need to interrupt your reading to look up every unfamiliar word right away – it’s better to ________ first.",
        options: ["master", "copy", "translate", "guess"],
        answer: 3, // D
        explanation: {
            trans: "Bạn không cần ngắt quãng việc đọc để tra từ mới ngay - tốt hơn là nên đoán trước.<br>A. master (v): nắm vững<br>B. copy (v): sao chép<br>C. translate (v): dịch<br>D. guess (v): đoán",
            why: "Kỹ năng đọc hiểu: 'Guess meaning from context' (Đoán nghĩa từ ngữ cảnh) là kỹ năng quan trọng được khuyên dùng.",
            wrong: ""
        }
    },
    {
        id: 9,
        type: 'grammar',
        instruction: "",
        question: "Many learners find English _____ the most difficult to master because the spelling and sound of words can be different.",
        options: ["grammar", "reading", "listening", "pronunciation"],
        answer: 3, // D
        explanation: {
            trans: "Nhiều người học thấy phát âm tiếng Anh khó nhất vì cách viết và âm đọc có thể khác nhau.<br>A. ngữ pháp<br>B. đọc<br>C. nghe<br>D. phát âm",
            why: "Dựa vào mệnh đề sau 'because the spelling and sound... can be different' (chính tả và âm thanh khác nhau) -> Đây là vấn đề của Pronunciation.",
            wrong: ""
        }
    },
    {
        id: 10,
        type: 'grammar',
        instruction: "",
        question: "Before you submit your essay, remember to go ____ the spelling.",
        options: ["over", "up", "into", "on"],
        answer: 0, // A
        explanation: {
            trans: "Trước khi nộp bài luận, nhớ kiểm tra lại chính tả.<br>A. go over: kiểm tra kỹ, xem lại<br>B. go up: tăng lên<br>C. go into: đi vào, thảo luận chi tiết<br>D. go on: tiếp tục",
            why: "Phrasal verb 'go over' = examine/check something carefully.",
            wrong: ""
        }
    },
    {
        id: 11,
        type: 'grammar',
        instruction: "",
        question: "Jane: “I know you are applying for an English speaking club. Break a leg!”<br>Lien: “__________”",
        options: ["Thanks. I’ll try my best", "Sure, I like that club very much", "Thank you. Welcome to the club", "Yes, I feel better now"],
        answer: 0, // A
        explanation: {
            trans: "Jane: 'Tớ biết cậu đang nộp đơn vào CLB tiếng Anh. Chúc may mắn nhé!' (Break a leg = Good luck)<br>Lien: 'Cảm ơn. Tớ sẽ cố hết sức.'",
            why: "'Break a leg' là thành ngữ chúc may mắn. Đáp lại lời chúc là lời cảm ơn.",
            wrong: "B, C, D không hợp ngữ cảnh giao tiếp."
        }
    },
    {
        id: 12,
        type: 'grammar',
        instruction: "",
        question: "She’s fluent _______ Polish and French and can speak a little Italian.",
        options: ["on", "at", "in", "from"],
        answer: 2, // C
        explanation: {
            trans: "Cô ấy trôi chảy tiếng Ba Lan và Pháp...<br>Cấu trúc: Be fluent in + language.",
            why: "Giới từ đi với fluent chỉ ngôn ngữ là 'in'.",
            wrong: ""
        }
    },
    // PHẦN 4: CLOZE TEST 1 (English Center)
    {
        id: 13,
        type: 'gap_fill_reading',
        instruction: "Read the announcement and choose the best option.",
        text_context: "We offer courses for all levels, from beginners to (13) _____.",
        question: "Question 13:",
        options: ["advance", "advanced", "advancing", "advancement"],
        answer: 1, // B
        explanation: {
            trans: "Chúng tôi cung cấp khóa học cho mọi trình độ, từ người mới bắt đầu đến nâng cao.<br>A. advance (n/v)<br>B. advanced (adj): trình độ cao/nâng cao<br>C. advancing (V-ing)<br>D. advancement (n)",
            why: "Cấu trúc 'from beginners to advanced' (từ sơ cấp đến cao cấp). Cần tính từ/danh từ chỉ trình độ tương đương 'beginners'. Ở đây 'advanced students' được rút gọn.",
            wrong: ""
        }
    },
    {
        id: 14,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "For more details, visit our (14) ____ website or call us...",
        question: "Question 14:",
        options: ["a", "an", "the", "X"],
        answer: 3, // D (No article needed usually before possessive, but text says 'visit our ___ website'. Wait.
        // Text: 'visit our (14) ____ website'.
        // Options: A. a, B. an, C. the, D. X (no article).
        // Analysis: We already have determiner "our". We CANNOT put "our the website" or "our a website".
        // So Answer is D (No word).
        explanation: {
            trans: "Ghé thăm trang web của chúng tôi.<br>A, B, C đều là mạo từ.",
            why: "Trước danh từ 'website' đã có tính từ sở hữu 'our', nên không điền thêm mạo từ (a/an/the) nào nữa. Đáp án là X (rỗng).",
            wrong: "Sai ngữ pháp cơ bản: Possessive + Article là sai."
        }
    },
    {
        id: 15,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "We are looking forward (15) ________ you.",
        question: "Question 15:",
        options: ["to meet", "meeting", "to meeting", "meet"],
        answer: 2, // C
        explanation: {
            trans: "Chúng tôi mong chờ được gặp bạn.<br>Cấu trúc: Look forward to + V-ing.",
            why: "Sau cụm 'look forward to', động từ phải ở dạng V-ing.",
            wrong: "A, B, D sai cấu trúc."
        }
    },
    {
        id: 16,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "Let’s start learning together (16) ____ our new center!",
        question: "Question 16:",
        options: ["at", "in", "on", "by"],
        answer: 0, // A (at center is best for location point)
        explanation: {
            trans: "Hãy cùng bắt đầu học tại trung tâm mới của chúng tôi!<br>A. at: tại (địa điểm cụ thể)<br>B. in: bên trong<br>C. on: trên<br>D. by: bởi",
            why: "Dùng 'at' cho địa điểm cụ thể như 'at the center', 'at school'.",
            wrong: ""
        }
    },
    // PHẦN 5: SENTENCE ARRANGEMENT
    {
        id: 17,
        type: 'grammar',
        instruction: "Rearrange the sentences to make a meaningful paragraph.",
        data_box: "(a) Firstly, English is widely used in Vietnam for international business and tourism.<br>(b) In addition, many schools in Vietnam teach English as a second language from an early age.<br>(c) For instance, English is often used in popular tourist destinations, such as Hanoi and Ho Chi Minh City.<br>(d) Moreover, English proficiency helps Vietnamese people connect with the global community and access international resources.",
        question: "Choose the correct order:",
        options: ["a-c-b-d", "a-b-c-d", "a-b-d-c", "a-d-b-c"],
        answer: 0, // a-c-b-d usually.
        // Analysis:
        // (a) Main idea 1: widely used for business/tourism.
        // (c) Example for (a): For instance... tourist destinations -> Links to tourism in (a). So (a) -> (c).
        // (b) Addition: Schools teach it.
        // (d) Moreover: Connect global community.
        // Logic: (a) General use -> (c) Specific Example -> (b) Education aspect -> (d) Benefits (Conclusion/Extension).
        // Let's check options.
        // A. a-c-b-d: Used(a) -> Example(c) -> Schools(b) -> Benefits(d). Makes sense.
        // B. a-b-c-d: Used(a) -> Schools(b) -> Example(c). 'For instance' in (c) mentions "tourist destinations". (b) talks about schools. Putting (c) after (b) is disjointed.
        // So A is best.
        explanation: {
            trans: "Sắp xếp đoạn văn:<br>(a) Đầu tiên, tiếng Anh dùng cho kinh doanh/du lịch.<br>(c) Ví dụ, dùng ở điểm du lịch HN/HCM (Bổ sung cho ý a).<br>(b) Thêm nữa, trường học dạy tiếng Anh.<br>(d) Hơn nữa, giúp kết nối toàn cầu.",
            why: "Câu (c) lấy ví dụ về 'tourist destinations' nên phải đứng ngay sau câu (a) nói về 'tourism'. Trật tự a-c là bắt buộc. Chỉ có đáp án A thỏa mãn.",
            wrong: ""
        }
    },
    {
        id: 18,
        type: 'grammar',
        instruction: "Choose the sentence that most appropriately ends the text in question 17.",
        question: "Select the concluding sentence:",
        options: ["As well as, learning English can bring more chances for students.", "To sum up, only students who learn English can be successful in the future.", "Therefore, learning English can provide valuable opportunities for students and professionals in Vietnam.", "As a result, more English schools and centres should be built for studying and teaching."],
        answer: 2, // C
        explanation: {
            trans: "C. Do đó, học tiếng Anh có thể mang lại những cơ hội quý giá cho học sinh và người đi làm tại Việt Nam.",
            why: "Câu kết luận (Concluding sentence) cần tóm lược lại lợi ích đã nêu (cơ hội, kết nối) một cách tổng quát. Đáp án C dùng 'Therefore' và tóm tắt ý nghĩa tích cực phù hợp nhất.",
            wrong: "A. Sai ngữ pháp 'As well as' đứng đầu câu. B. Quá cực đoan ('Only students...'). D. Đưa ra giải pháp/khuyên bảo (should be built) thay vì tóm tắt ý chính."
        }
    },
    // PHẦN 6: GUIDED CLOZE (Passage about Learning Language)
    {
        id: 19,
        type: 'gap_fill_reading',
        instruction: "Read the passage and choose the best word to fill in the blank.",
        text_context: "This helps you pick up their pronunciation and get used (19) ____ different accents.",
        question: "Question 19:",
        options: ["to", "with", "for", "in"],
        answer: 0, // A
        explanation: {
            trans: "...và làm quen với các giọng khác nhau.<br>Cấu trúc: Get used to + N/V-ing (Quen với cái gì).",
            why: "Giới từ đi với 'used' trong cấu trúc 'quen với' là 'to'.",
            wrong: ""
        }
    },
    {
        id: 20,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "If you aren’t sure, don’t hesitate to (20) _____ the word in a dictionary...",
        question: "Question 20:",
        options: ["give up", "write down", "look up", "get by"],
        answer: 2, // C
        explanation: {
            trans: "...đừng ngần ngại tra từ trong từ điển.<br>A. bỏ cuộc<br>B. viết xuống<br>C. tra cứu<br>D. xoay xở",
            why: "Look up + word: Tra từ điển.",
            wrong: ""
        }
    },
    {
        id: 21,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "Don’t be afraid to practise with native speakers, even (21) ____ you have difficulty...",
        question: "Question 21:",
        options: ["though", "as", "how", "if"],
        answer: 3, // D (even if) or A (even though). Context: "Don't be afraid..., even __ you have difficulty".
        // "Even if" implies a condition that doesn't matter. "Even though" implies a fact.
        // Context suggests: Do it regardless of the potential difficulty. "Even if" is slightly better for advice/hypothetical.
        // However, "Even though" works if the difficulty is a known constant.
        // Usually "Even if" is paired with advice. "Don't stop, even if it hurts".
        // Let's check options. A. though, B. as, C. how, D. if.
        // "Even though" vs "Even if".
        // Let's pick D. "Even if" (ngay cả khi).
        answer: 3,
        explanation: {
            trans: "Đừng ngại luyện tập... ngay cả khi bạn gặp khó khăn.<br>A. though (mặc dù)<br>D. if (nếu)",
            why: "Cụm 'even if' (ngay cả khi/dù cho) dùng để diễn tả một giả định: dù khó khăn có xảy ra thì cũng đừng ngại.",
            wrong: "'Even though' dùng cho sự việc đã/đang xảy ra (thực tế). Ở đây mang tính khuyên bảo cho tình huống giả định nên 'even if' chuẩn xác hơn."
        }
    },
    {
        id: 22,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "...have difficulty (22) _____ yourself.",
        question: "Question 22:",
        options: ["express", "expressing", "expressed", "to express"],
        answer: 1, // B
        explanation: {
            trans: "...gặp khó khăn trong việc diễn đạt bản thân.<br>Cấu trúc: Have difficulty (in) + V-ing.",
            why: "Sau cụm 'have difficulty', động từ chia ở dạng V-ing.",
            wrong: ""
        }
    },
    {
        id: 23,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "Learning a new language can be a journey with (23) _____.",
        question: "Question 23:",
        options: ["dark and light", "ups and downs", "black and white", "facts and figures"],
        answer: 1, // B
        explanation: {
            trans: "Học ngôn ngữ là hành trình có những thăng trầm.<br>A. tối và sáng<br>B. thăng trầm (lên và xuống)<br>C. trắng đen<br>D. dữ liệu",
            why: "Idiom 'ups and downs' chỉ những lúc thuận lợi và khó khăn.",
            wrong: ""
        }
    },
    {
        id: 24,
        type: 'gap_fill_reading',
        instruction: "",
        text_context: "Conversations in your new (24) ____ will become second nature...",
        question: "Question 24:",
        options: ["tone", "stress", "pronunciation", "tongue"],
        answer: 3, // D
        explanation: {
            trans: "Các cuộc hội thoại bằng ngôn ngữ (thứ tiếng) mới của bạn...<br>A. tông giọng<br>B. trọng âm<br>C. phát âm<br>D. cái lưỡi (nghĩa bóng: ngôn ngữ)",
            why: "'Tongue' trong cụm 'mother tongue' hay ngữ cảnh này đồng nghĩa với 'language'. 'New tongue' = New language.",
            wrong: ""
        }
    },
    // PHẦN 7: SENTENCE TRANSFORMATION
    {
        id: 25,
        type: 'grammar',
        instruction: "Choose the sentence CLOSEST in meaning to: 'I don’t know any Korean.'",
        question: "",
        options: ["Korean is too hard for me to study.", "My Korean is a bit rusty.", "I am quite bad at Korean.", "I can’t speak a word of Korean."],
        answer: 3, // D
        explanation: {
            trans: "Gốc: Tôi không biết chút tiếng Hàn nào.<br>D: Tôi không thể nói một từ tiếng Hàn nào.",
            why: "'Not know any' = 'Can't speak a word' (hoàn toàn không biết).",
            wrong: "A. Quá khó (sai nghĩa). B. Bị mai một (nghĩa là đã từng biết). C. Khá tệ (nghĩa là biết chút ít)."
        }
    },
    {
        id: 26,
        type: 'grammar',
        instruction: "Choose the sentence CLOSEST in meaning to: 'Duong learned a few words of Thai on holiday.'",
        question: "",
        options: ["Duong picked up a few words of Thai on holiday.", "Duong went on a holiday to Thailand to learn Thai.", "Duong looked up a few words of Thai on holiday.", "Duong had a short conversation in Thai during his holiday in Thailand."],
        answer: 0, // A
        explanation: {
            trans: "Gốc: Dương học được vài từ tiếng Thái khi đi nghỉ.<br>A: Dương 'nhặt' (học lỏm/học nhanh) được vài từ...",
            why: "Phrasal verb 'pick up' = learn a language skills naturally/informally without study. Rất sát nghĩa với ngữ cảnh đi du lịch học được vài từ.",
            wrong: "B. Mục đích đi là để học (sai). C. Tra từ điển (look up). D. Có cuộc hội thoại (xa nghĩa)."
        }
    },
    {
        id: 27,
        type: 'grammar',
        instruction: "Choose the correct sentence made from cues: 'They/ translate/ that book/ many languages'",
        question: "",
        options: ["They translated that book with many languages.", "They are translated that book into many languages.", "They are translating that book to many languages.", "They have translated that book into many languages."],
        answer: 3, // D (Or A? "Translate INTO"). 
        // A. with (wrong preposition).
        // B. are translated (Passive voice used incorrectly with 'They' as agent? No, 'They' are doing it. If passive: 'That book is translated'). 'They are translated' implies 'Họ bị dịch' -> Wrong.
        // C. to (wrong prep, usually 'into').
        // D. have translated ... into. Correct structure.
        explanation: {
            trans: "Họ đã dịch cuốn sách đó sang nhiều thứ tiếng.",
            why: "Cấu trúc: Translate sth INTO sth. Chỉ có D dùng đúng giới từ 'into' và thì hiện tại hoàn thành hợp lý.",
            wrong: "A. Sai giới từ 'with'. B. Sai cấu trúc bị động (They are translated = Họ bị dịch). C. Sai giới từ 'to' (thường dùng into)."
        }
    },
    {
        id: 28,
        type: 'grammar',
        instruction: "Choose the correct sentence made from cues.",
        question: "Cues: other languages/ English/ always/ change/ but/ change/ slowly",
        options: ["Like other languages, English is always changing, but it changes very slowly.", "As other languages, English is always changing, and it changes very slowly.", "Other languages like English is always changing, but it changes slowly.", "Like other languages, English is always changing, but it will change very slowly."],
        answer: 0, // A
        explanation: {
            trans: "Giống như các ngôn ngữ khác, tiếng Anh luôn thay đổi, nhưng nó thay đổi rất chậm.",
            why: "Dùng 'Like' để so sánh. Thì hiện tại tiếp diễn (is always changing) diễn tả sự thay đổi liên tục. Mệnh đề sau dùng hiện tại đơn chỉ sự thật hiển nhiên.",
            wrong: "B. As (sai nghĩa so sánh). C. 'Other languages' số nhiều nhưng động từ 'is' -> sai. D. Sai thì tương lai 'will change'."
        }
    },
    // PHẦN 8: SIGNS (CUSTOM CSS)
    {
        id: 29,
        type: 'sign',
        instruction: "Look at the sign and choose the best answer.",
        sign_id: "sign_dog", // Helper for rendering
        sign_title: "CHILDREN'S<br>PLAY AREA",
        sign_footer: "NO DOGS ALLOWED",
        sign_icon: "dog",
        question: "Question 29:",
        options: ["Dogs are not safe for children in this play area.", "Dogs cannot be taken into this place as it is a children’s play area.", "Don’t let your children play here because of the dogs.", "Dogs are not allowed to play with children in this area."],
        answer: 1, // B
        explanation: {
            trans: "Biển báo: KHU VUI CHƠI TRẺ EM - KHÔNG CHO PHÉP CHÓ.<br>B. Chó không được đưa vào nơi này vì đây là khu vui chơi trẻ em.",
            why: "Biển cấm (No dogs allowed) đặt tại khu vui chơi -> Cấm chó vào.",
            wrong: "A. Chó không an toàn (Suy diễn). C. Đừng cho trẻ chơi (Sai). D. Chó không được chơi với trẻ (Sai, là cấm chó vào hẳn)."
        }
    },
    {
        id: 30,
        type: 'sign',
        instruction: "Look at the sign and choose the best answer.",
        sign_id: "sign_shoes",
        sign_title: "NOTICE",
        sign_footer: "SHOES<br>NOT ALLOWED HERE",
        sign_icon: "shoes",
        question: "Question 30:",
        options: ["Please take off your shoes when entering this place.", "You don’t have to wear shoes in this place.", "Please put on your shoes when entering this place.", "You can’t buy any shoes in this place."],
        answer: 0, // A
        explanation: {
            trans: "Biển báo: CHÚ Ý - KHÔNG ĐƯỢC ĐI GIẦY Ở ĐÂY.<br>A. Vui lòng cởi giày khi vào nơi này.",
            why: "'Shoes not allowed' = Phải cởi giày ra (Take off shoes).",
            wrong: "B. Không cần phải đeo (nghĩa là đeo cũng được -> Sai). C. Hãy đi giày vào (Sai). D. Không thể mua giày (Sai)."
        }
    },
    // PHẦN 9: READING COMPREHENSION
    {
        id: 31,
        type: 'reading_comp',
        instruction: "Read the passage and choose the correct answer.",
        data_box: `
            <p><strong>Learning a new language</strong> is always an excellent idea. It provides you incredible benefits that come with the backing of science! One of the most useful languages to learn is English.</p>
            <p>Learning a second language is one of the best ways to keep your brain active and challenged. Studies have shown that the brain undergoes changes in electrical activity and even structure and size while learning a foreign language that do not occur when learning any other type of task or skill. Learning another language offers important <strong>cognitive</strong> benefits at any age, helping to keep the mind active and even reducing the risk of mental disease and slowing mental decline later in life.</p>
            <p>When learning English as a second language, you approach new ways to think and express yourself through written and spoken words. Learning multiple languages can help you communicate more clearly in any language as you learn more about how language itself works and how to use it to promote ideas and reach out to others in a variety of social and work situations.</p>
            <p>The world may not have a global language, but English is the default option for countless forms of communication across the globe. That’s why one of the benefits of learning English is that it significantly boosts your hiring potential. In addition, it can offer you educational opportunities. If you desire access to some of the best schools like Harvard, Stanford, Oxford, Cambridge or MIT, then knowing English provides you an incredible <strong>edge</strong>. It’s expected that around 2 billion people around the world will learn English over the next decade.</p>
            
            <table class="glossary-table">
                <thead><tr><th>Word</th><th>Meaning</th></tr></thead>
                <tbody>
                    <tr><td>Cognitive (adj)</td><td>Liên quan đến nhận thức/tư duy</td></tr>
                    <tr><td>Decline (n)</td><td>Sự suy giảm</td></tr>
                    <tr><td>Edge (n)</td><td>Lợi thế (nghĩa bóng)</td></tr>
                    <tr><td>Dementia (n)</td><td>Chứng mất trí nhớ</td></tr>
                </tbody>
            </table>
        `,
        question: "Question 31: What is the main idea of the passage?",
        options: ["Ways to improve your English level", "How to keep your mind active", "The advantages and disadvantages of language learning", "The benefits of learning English"],
        answer: 3, // D
        explanation: {
            trans: "Ý chính của đoạn văn là gì?<br>D. Những lợi ích của việc học tiếng Anh.",
            why: "Đoạn 1 mở đầu: 'incredible benefits'. Đoạn 2: brain benefits. Đoạn 3: communication benefits. Đoạn 4: career/education benefits. Toàn bài nói về lợi ích.",
            wrong: "A. Cách cải thiện (không đề cập phương pháp). B. Giữ trí óc minh mẫn (chỉ là 1 ý nhỏ). C. Ưu nhược điểm (không nói nhược điểm)."
        }
    },
    {
        id: 32,
        type: 'reading_comp',
        instruction: "",
        question: "Question 32: What is TRUE according to the text about learning English?",
        options: ["It has a negative effect on the brain", "It slows the mental decline due to aging", "It reduces brain function", "It lowers the risk of heart disease"],
        answer: 1, // B
        explanation: {
            trans: "Điều gì đúng về việc học tiếng Anh?<br>B. Nó làm chậm sự suy giảm trí tuệ do lão hóa.",
            why: "Dẫn chứng đoạn 2: '...slowing mental decline later in life.' (làm chậm sự suy giảm tinh thần sau này).",
            wrong: "A. Tác động tiêu cực (Sai). C. Giảm chức năng não (Sai, nó giúp active). D. Bệnh tim (Bài không nhắc đến, chỉ nhắc mental disease)."
        }
    },
    {
        id: 33,
        type: 'reading_comp',
        instruction: "",
        question: "Question 33: Learning multiple languages makes you a better communicator because __________.",
        options: ["you can improve your writing and speaking skills", "you know how to get the attention of someone", "you learn more about how to promote your ideas and make contact with others", "you can communicate more effectively in your mother tongue"],
        answer: 2, // C
        explanation: {
            trans: "Học nhiều ngôn ngữ giúp bạn giao tiếp tốt hơn vì...<br>C. bạn học được cách thúc đẩy ý tưởng và kết nối với người khác.",
            why: "Dẫn chứng đoạn 3: '...learn more about how language itself works and how to use it to promote ideas and reach out to others...'",
            wrong: ""
        }
    },
    {
        id: 34,
        type: 'reading_comp',
        instruction: "",
        question: "Question 34: The word “cognitive” in the second paragraph is CLOSEST in meaning to ___.",
        options: ["Mental", "Intellectual", "Emotional", "Subjective"], // A and B are close.
        // Cognitive: relating to cognition (mental process). 
        // Mental: relating to the mind.
        // Intellectual: relating to the intellect.
        // Usually Cognitive -> Mental/Intellectual. Let's see context. "cognitive benefits... keeping the mind active".
        // In multiple choice, "Mental" is often the synonym for cognitive skills/health.
        answer: 0, // A
        explanation: {
            trans: "Từ 'cognitive' (nhận thức) gần nghĩa nhất với?<br>A. Mental (thuộc về tinh thần/trí tuệ).",
            why: "Cognitive benefits = Mental benefits (liên quan đến hoạt động của não bộ).",
            wrong: "C. Cảm xúc. D. Chủ quan."
        }
    },
    {
        id: 35,
        type: 'reading_comp',
        instruction: "",
        question: "Question 35: What does the word 'edge' used in the third paragraph mean?",
        options: ["Point", "Border", "Limit", "Advantage"],
        answer: 3, // D
        explanation: {
            trans: "Từ 'edge' ở đoạn 3 có nghĩa là gì?<br>D. Advantage (Lợi thế).",
            why: "Cụm từ 'give you an edge' = cho bạn một lợi thế cạnh tranh. Ngữ cảnh: vào trường xịn (Harvard) thì tiếng Anh là lợi thế.",
            wrong: "A, B, C là nghĩa đen (cạnh, bờ, giới hạn) không hợp ngữ cảnh."
        }
    },
    {
        id: 36,
        type: 'reading_comp',
        instruction: "",
        question: "Question 36: What is NOT TRUE about the benefits of learning English?",
        options: ["It helps prevent dementia and Alzheimer’s", "It provides better employment opportunities", "It’s easy to use in communication", "It gives you access to the world’s best universities"],
        answer: 2, // C
        explanation: {
            trans: "Điều gì KHÔNG ĐÚNG về lợi ích?<br>C. Nó dễ sử dụng trong giao tiếp.",
            why: "Bài đọc nói tiếng Anh giúp giao tiếp rõ ràng hơn, nhưng KHÔNG nói rằng 'nó dễ sử dụng' (easy to use). Thực tế bài đọc còn nói học ngôn ngữ là 'challenged'.<br>Các ý còn lại đều có trong bài:<br>A. prevent mental disease (đoạn 2)<br>B. hiring potential (đoạn 4)<br>D. access best schools (đoạn 4)",
            wrong: ""
        }
    },
    // PHẦN 10: SENTENCE INSERTION (GAP FILL)
    {
        id: 37,
        type: 'gap_fill_sentences',
        instruction: "Choose the correct sentence (A-D) to fill in the blanks.",
        options_box: [
            "A - The result was more irregularity.",
            "B – They used the 23 letters of Latin to write down the sounds of Anglo-Saxon speech as they heard it.",
            "C – Inevitably, there were inconsistencies in the way that letters were combined.",
            "D – but the spelling of many English words changed to follow French patterns."
        ],
        text_context: `
            <p><strong>ENGLISH SPELLING</strong></p>
            <p>Why does English spelling have a reputation for being difficult? English was first written down when Christian monks came to England in Anglo-Saxon times. (37) ____. However, English has a wider range of basic sounds (over 40) than Latin. The alphabet was too small, and so combinations of letters were needed to express the different sounds. (38) _____.</p>
            <p>With the Norman invasion of England, the English language was put at risk. English survived, (39) ____, and many French words were introduced into the language. (40) ______.</p>
        `,
        question: "Question 37:",
        options: ["A", "B", "C", "D"],
        answer: 1, // B
        explanation: {
            trans: "Câu trước: Các tu sĩ đạo Thiên chúa đến Anh...<br>Câu chọn (B): Họ sử dụng 23 chữ cái Latin để ghi lại âm thanh của tiếng Anglo-Saxon...",
            why: "Đại từ 'They' trong câu B thay thế cho 'Christian monks' ở câu trước. Ngữ cảnh nói về việc bắt đầu viết tiếng Anh (written down).",
            wrong: ""
        }
    },
    {
        id: 38,
        type: 'gap_fill_sentences',
        instruction: "",
        text_context: null, // Shared text
        question: "Question 38:",
        options: ["A", "B", "C", "D"],
        answer: 2, // C
        explanation: {
            trans: "Câu trước: Cần kết hợp các chữ cái để diễn tả âm thanh khác nhau.<br>Câu chọn (C): Không tránh khỏi, đã có những sự không nhất quán trong cách kết hợp chữ cái.",
            why: "Câu trước nói về giải pháp (combinations needed), câu C nói về hệ quả trực tiếp của việc kết hợp đó (inconsistencies - sự không nhất quán).",
            wrong: ""
        }
    },
    {
        id: 39,
        type: 'gap_fill_sentences',
        instruction: "",
        text_context: null,
        question: "Question 39:",
        options: ["A", "B", "C", "D"],
        answer: 3, // D
        explanation: {
            trans: "Câu văn: English survived, (39) ..., and many French words...<br>Câu chọn (D): ...nhưng cách viết của nhiều từ tiếng Anh đã thay đổi theo kiểu Pháp.",
            why: "Câu chứa chỗ trống nói về ảnh hưởng của cuộc xâm lược Norman (Pháp). Mệnh đề 'but...' (nhưng) bổ sung thông tin tương phản: dù tiếng Anh sống sót, nhưng bị thay đổi (theo French patterns).",
            wrong: ""
        }
    },
    {
        id: 40,
        type: 'gap_fill_sentences',
        instruction: "",
        text_context: null,
        question: "Question 40:",
        options: ["A", "B", "C", "D"],
        answer: 0, // A
        explanation: {
            trans: "Câu chọn (A): Kết quả là sự bất quy tắc nhiều hơn.",
            why: "Đây là câu kết luận cho đoạn văn nói về sự ảnh hưởng của Pháp (French words introduced). Việc pha trộn này dẫn đến 'more irregularity' (nhiều bất quy tắc hơn) trong chính tả.",
            wrong: ""
        }
    }
];

// --- RENDER LOGIC ---

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    let html = '';
    
    // Group questions for shared contexts if needed, but linear render is easier for this prompt structure
    // Special handling: Render Gap Fill Texts once for the group
    
    // Helper to check if context changed or text box needs rendering
    let currentSectionType = '';
    
    quizData.forEach((q, index) => {
        // Section Titles Logic
        if (q.type !== currentSectionType) {
            currentSectionType = q.type;
            // Add Section Header based on type
            let sectionTitle = '';
            if(q.type === 'phonetics') sectionTitle = 'PHONETICS & STRESS';
            else if(q.type === 'grammar') sectionTitle = 'GRAMMAR & VOCABULARY';
            else if(q.type === 'gap_fill_reading') sectionTitle = 'GUIDED CLOZE TEST';
            else if(q.type === 'reading_comp') sectionTitle = 'READING COMPREHENSION';
            else if(q.type === 'sign') sectionTitle = 'SIGNS & NOTICES';
            else if(q.type === 'gap_fill_sentences') sectionTitle = 'SENTENCE INSERTION';
            
            if(sectionTitle) html += `<div class="section-title">${sectionTitle}</div>`;
        }

        // Render Shared Text Data Box (Reading/GapFill)
        if (q.data_box && !q.data_rendered) {
            html += `<div class="data-box">${q.data_box}</div>`;
            // Mark siblings as rendered if they share ID? No, just linear check.
            // For this specific JSON structure, data_box is attached to first Q of group usually.
        }

        // Specific Render for Sentence Insertion Box (Only render once for Q37)
        if (q.type === 'gap_fill_sentences' && q.id === 37) {
             html += `
                <div class="gap-fill-container">
                    <div class="gap-options-box">
                        ${q.options_box.map(opt => `<p>${opt}</p>`).join('')}
                    </div>
                    <div class="gap-text-box">
                        ${q.text_context}
                    </div>
                </div>
             `;
        }
        
        // Specific Render for Gap Fill Reading (Render Text Context if it exists and is not null)
        // For Q13, Q19 etc. Text is short snippets. For Reading, it's long.
        if (q.type === 'gap_fill_reading' && q.text_context) {
             // For simple gap fills, we can show context inside the card or above.
             // The prompt implies "Read passage...". Since prompts 19-24 share a passage, 
             // we should have rendered the passage once.
             // BUT, the provided data in `quizData` for 19-24 uses short `text_context`.
             // To make it better: I will add the FULL passage for 19-24 in the data_box of Q19.
             // (I did this in the code construction phase mentally, let's ensure code reflects it).
             // Actually, the prompt gave specific text per question for 13-16. 
             // For 19-24, it's a passage. I will adjust Q19 to have a data_box containing the full text.
        }
        
        // --- Special Handling for Q19 Passage ---
        if (q.id === 19) {
            html += `<div class="data-box">
                <p>When learning a new language, it’s important to communicate with native speakers. This helps you pick up their pronunciation and get used (19) ____ different accents. Sometimes, you might figure out what a word means from the context. If you aren’t sure, don’t hesitate to (20) _____ the word in a dictionary or even translate it back to your own language to get a clue.</p>
                <p>But remember that everyone may make mistakes when learning something new! In fact, making mistakes is an important part of the learning process. It shows you where you need to focus. Don’t be afraid to practise with native speakers, even (21) ____ you have difficulty (22) _____ yourself. They’ll likely appreciate your efforts and be happy to give your tips.</p>
                <p>Learning a new language can be a journey with (23) _____. It’s a process that requires patience, practice and perseverance. It’s not about perfection, but progress. Keep communicating, keep making mistakes, and keep learning and our efforts will pay off. Conversations in your new (24) ____ will become second nature, and you’ll surprise yourself with your confidence.</p>
                <table class="glossary-table">
                    <thead><tr><th>Word</th><th>Meaning</th></tr></thead>
                    <tbody>
                        <tr><td>Hesitate (v)</td><td>Do dự/ngần ngại</td></tr>
                        <tr><td>Perseverance (n)</td><td>Sự kiên trì</td></tr>
                        <tr><td>Second nature (idm)</td><td>Bản năng thứ hai (việc làm quen thuộc)</td></tr>
                    </tbody>
                </table>
            </div>`;
        }

        // --- CARD START ---
        html += `<div class="card" id="card-${q.id}">`;
        
        // Instruction
        if (q.instruction) {
            html += `<div style="font-size:0.9rem; color:#666; margin-bottom:10px; font-style:italic;">${q.instruction}</div>`;
        }

        // Signs (Q29, Q30)
        if (q.type === 'sign') {
            html += `
            <div class="sign-container">
                <div class="sign-board">
                    <div class="sign-header">${q.sign_title}</div>
                    <div class="ban-circle">
                        ${getIconSvg(q.sign_icon)}
                    </div>
                    <div class="sign-footer">${q.sign_footer}</div>
                </div>
            </div>`;
        }

        // Context snippet (for simple gap fill like 13-16)
        if (q.text_context && q.type === 'gap_fill_reading' && !q.data_box) {
             html += `<div style="background:#f8f9fa; padding:10px; border-radius:5px; margin-bottom:10px; font-family:'Georgia', serif;">"${q.text_context}"</div>`;
        }

        // Question Text
        html += `<div class="question-box"><div class="question-text">${q.question}</div></div>`;

        // Options
        html += `<div class="options-grid">`;
        q.options.forEach((opt, optIndex) => {
            html += `
                <label class="option-label" id="lbl-${q.id}-${optIndex}">
                    <input type="radio" name="q${q.id}" value="${optIndex}" onclick="selectAnswer(${q.id}, ${optIndex})">
                    <span>${formatOptionText(opt)}</span>
                </label>
            `;
        });
        html += `</div>`;

        // Check Button
        html += `<button class="btn-check" id="btn-check-${q.id}" onclick="checkQuestion(${q.id})">Check Answer</button>`;

        // Explanation Box
        html += `
            <div class="explanation-box" id="expl-${q.id}">
                <div class="expl-label">GIẢI THÍCH CHI TIẾT:</div>
                <span class="expl-trans">${q.explanation.trans}</span>
                <p><strong>Tại sao đúng?</strong> ${q.explanation.why}</p>
                ${q.explanation.wrong ? `<p class="expl-wrong"><strong>Tại sao sai?</strong> ${q.explanation.wrong}</p>` : ''}
            </div>
        `;

        html += `</div>`; // Card End
    });

    container.innerHTML = html;
}

// --- HELPER FUNCTIONS ---

function formatOptionText(text) {
    // Replace text-based underline markup with HTML tag if needed (though we used <u> in data)
    return text; // Data already has <u> tags if needed
}

function getIconSvg(type) {
    if (type === 'dog') {
        return `<svg class="sign-icon" viewBox="0 0 576 512"><path d="M298.8 322.9c-2.4-7.2-9.2-11.9-16.8-11.9H166.3l-19.6-59.5 76.5-19.4c17.6-4.5 28.1-22.4 23.6-39.9-4.5-17.6-22.4-28.1-39.9-23.6l-78.7 19.9c-5.6 1.4-10.7 4.5-14.4 8.8L59 249.2c-15.6 18.2-13.8 45.4 3.7 61.4l50.3 45.9c-5.1 7.2-8.2 16-8.2 25.4 0 24.3 19.7 44 44 44 14 0 26.4-6.5 34.6-16.7l50.4-62.9 65 26.7zM569.2 225.9c-24.8-10.3-157.6-65.7-157.6-65.7-16-7.9-32.6 1.8-36.8 21.6-1.5 7.1.4 14.1 4.5 19.8l21.2 30.2-101.4 5.2c-1.3-4.2-2.7-8.4-4.3-12.7-10.6-28.2-40-42.9-68.9-35.3l-16.4-53c-4.4-14.1 2.9-29.3 16.7-34.4l112.9-42.3c15.2-5.7 23.1-22.7 17.5-37.9-5.7-15.2-22.7-23.1-37.9-17.5L205.6 45.6c-48 18-73.6 71.3-58.3 120.7l13.6 44c-19.2 4.2-36.1 16.7-44.5 35.1l-50.6 111.3c-9.1 20 6.6 42.6 28.1 40.5l88-8.8 59.5 76.1c11.1 14.2 31.7 16.5 45.8 5.1l80-64c8.8-7.1 12.8-18.7 10.4-29.8L359 308.2l76.9-3.9c13.4-.7 25.1-9.1 29.3-21.9l21.8-66.2 62.3 26c15.9 6.6 34.2-1 40.8-16.9 6.7-15.8-.8-34.1-16.7-40.7z"/></svg>`;
    } else if (type === 'shoes') {
        return `<svg class="sign-icon" viewBox="0 0 640 512"><path d="M192 192c26.5 0 48-21.5 48-48s-21.5-48-48-48-48 21.5-48 48 21.5 48 48 48zm375.3 84c-11.7 0-22.7 5.3-30.1 14.3L480 361.3V140c0-6.6-5.4-12-12-12h-34c-6.6 0-12 5.4-12 12v124l-67.9-20.4c-8.8-2.6-18.1-1.3-26 3.9l-88 57.2c-7.2 4.7-11.4 12.7-11.2 21.2.2 8.6 4.7 16.3 12.1 20.7l22.6 13.6c-1.9 6.9-2.9 14.1-2.9 21.6 0 25.1 11.4 47.6 29.3 62.9l2.8 2.4c17.5 14.6 41.5 24.9 69.2 24.9 59.7 0 108-48.3 108-108v-32h85.3c7.7 0 13.8-6.9 12.5-14.5-1.2-7.5-7.7-13.1-15.3-13.1zM192 256c-106 0-192 86-192 192 0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32 0-106-86-192-192-192zm0 160c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>`;
    }
    return '';
}

// --- LOGIC ---

// Store user answers: { questionId: selectedOptionIndex }
let userAnswers = {};
let checkedQuestions = new Set();

function selectAnswer(qId, optionIndex) {
    if (checkedQuestions.has(qId)) return; // Prevent changing after check
    userAnswers[qId] = optionIndex;
    // Remove unanswered warning style if exists
    document.getElementById(`card-${qId}`).classList.remove('unanswered');
}

function checkQuestion(qId) {
    const qData = quizData.find(q => q.id === qId);
    const selected = userAnswers[qId];
    
    // UI Updates
    const explanation = document.getElementById(`expl-${qId}`);
    const checkBtn = document.getElementById(`btn-check-${qId}`);
    
    // Logic
    if (selected === undefined) {
        alert("Vui lòng chọn một đáp án trước khi kiểm tra!");
        return;
    }

    checkedQuestions.add(qId);
    
    // Disable inputs
    const inputs = document.querySelectorAll(`input[name="q${qId}"]`);
    inputs.forEach(input => input.disabled = true);
    
    // Highlight Answers
    const correctLbl = document.getElementById(`lbl-${qId}-${qData.answer}`);
    correctLbl.classList.add('correct');
    
    if (selected !== qData.answer) {
        const wrongLbl = document.getElementById(`lbl-${qId}-${selected}`);
        wrongLbl.classList.add('wrong');
    }
    
    // Show Explanation
    explanation.classList.add('visible');
    checkBtn.style.display = 'none'; // Hide check button after checking
}

function submitQuiz() {
    let score = 0;
    let unansweredCount = 0;
    let firstUnansweredId = null;

    quizData.forEach(q => {
        // If not checked yet, auto-check it
        if (!checkedQuestions.has(q.id)) {
            if (userAnswers[q.id] === undefined) {
                unansweredCount++;
                document.getElementById(`card-${q.id}`).classList.add('unanswered');
                if(!firstUnansweredId) firstUnansweredId = q.id;
            } else {
                // Determine correctness for score even if user clicked Submit without clicking Check
                if (userAnswers[q.id] === q.answer) score++;
            }
            // Trigger visual check for all
            forceCheck(q.id); 
        } else {
            // Already checked
            if (userAnswers[q.id] === q.answer) score++;
        }
    });

    if (unansweredCount > 0) {
        const confirmSubmit = confirm(`Bạn còn ${unansweredCount} câu chưa làm. Bạn có chắc muốn nộp bài không?`);
        if (!confirmSubmit) {
            if(firstUnansweredId) {
                document.getElementById(`card-${firstUnansweredId}`).scrollIntoView({behavior: 'smooth', block: 'center'});
            }
            return;
        }
    }

    // Show Result
    const scoreDisplay = document.getElementById('scoreDisplay');
    const scoreMessage = document.getElementById('scoreMessage');
    const modal = document.getElementById('resultModal');

    scoreDisplay.innerText = `${score}/${quizData.length}`;
    
    if (score === quizData.length) scoreMessage.innerText = "Xuất sắc! Bạn đúng tuyệt đối!";
    else if (score >= quizData.length * 0.8) scoreMessage.innerText = "Làm tốt lắm! Bạn nắm khá vững kiến thức.";
    else if (score >= quizData.length * 0.5) scoreMessage.innerText = "Khá tốt, nhưng hãy xem lại các câu sai nhé.";
    else scoreMessage.innerText = "Cố gắng hơn nhé! Hãy đọc kỹ giải thích.";

    modal.style.display = 'flex';
}

function forceCheck(qId) {
    // Similar to checkQuestion but handles null selection (displays correct answer)
    const qData = quizData.find(q => q.id === qId);
    const selected = userAnswers[qId];
    
    const explanation = document.getElementById(`expl-${qId}`);
    const checkBtn = document.getElementById(`btn-check-${qId}`);
    const inputs = document.querySelectorAll(`input[name="q${qId}"]`);
    
    inputs.forEach(input => input.disabled = true);
    
    // Always highlight correct
    const correctLbl = document.getElementById(`lbl-${qId}-${qData.answer}`);
    if(correctLbl) correctLbl.classList.add('correct');
    
    // Highlight wrong if selected
    if (selected !== undefined && selected !== qData.answer) {
        const wrongLbl = document.getElementById(`lbl-${qId}-${selected}`);
        if(wrongLbl) wrongLbl.classList.add('wrong');
    }
    
    explanation.classList.add('visible');
    if(checkBtn) checkBtn.style.display = 'none';
    checkedQuestions.add(qId);
}

function closeModal() {
    document.getElementById('resultModal').style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('resultModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

// Initial Render
renderQuiz();

</script>

</body>
</html>

