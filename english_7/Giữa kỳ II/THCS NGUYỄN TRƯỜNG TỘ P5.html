<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Test - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --correct: #00d26a;
            --wrong: #ff4757;
            --text: #2d3436;
            --white: #ffffff;
            --shadow: 0 8px 0 rgba(0,0,0,0.15);
            --shadow-pressed: 0 4px 0 rgba(0,0,0,0.15);
        }

        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Nunito', sans-serif;
            overflow: hidden; /* Prevent body scroll, handle inside split */
            background-color: #f0f0f0;
            transition: background 0.5s ease;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- BACKGROUND DYNAMIC SVG --- */
        #dynamic-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background-size: cover;
            opacity: 0.6;
            transition: background-image 0.5s ease;
        }

        /* --- HEADER --- */
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 100;
            height: 70px;
        }
        .teacher-name {
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .teacher-avatar {
            width: 40px; height: 40px;
            background: #ff7675;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; font-weight: bold;
        }
        .timer-container {
            background: #2d3436;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 1.2rem;
            display: flex; align-items: center; gap: 10px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .timer-container:active { transform: scale(0.95); }
        .section-tabs {
            display: flex; gap: 10px;
        }
        .tab-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            background: #dfe6e9;
            color: #636e72;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        /* --- MAIN LAYOUT (SPLIT SCREEN) --- */
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 70px);
            overflow: hidden;
        }
        
        /* LEFT: READING PASSAGE */
        .left-panel {
            width: 50%;
            padding: 30px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            border-right: 2px solid rgba(0,0,0,0.1);
        }
        .passage-title {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }
        .passage-content {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #2d3436;
            text-align: justify;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .trans-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #00896f;
            width: 100%;
            margin-bottom: 20px;
        }
        .trans-btn:active { transform: translateY(4px); box-shadow: none; }
        .translation-text {
            display: none;
            background: #e3fcf3;
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #00b894;
            margin-bottom: 20px;
            font-style: italic;
            color: #444;
        }

        /* GLOSSARY TABLE */
        .glossary-box {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .glossary-title {
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex; align-items: center; gap: 5px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: var(--secondary); color: white; border-radius: 5px; }
        .word-type { font-size: 0.85em; color: #888; font-style: italic; }

        /* RIGHT: EXERCISES */
        .right-panel {
            width: 50%;
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
            border: 2px solid rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        .question-text {
            font-weight: 700;
            font-size: 1.15rem;
            margin-bottom: 20px;
            color: #2d3436;
        }
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 15px;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            cursor: pointer;
            text-align: left;
            box-shadow: 0 4px 0 #e0e0e0;
            transition: all 0.2s;
            position: relative;
        }
        .option-btn:hover {
            transform: scale(1.02);
            border-color: var(--secondary);
        }
        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }
        /* States */
        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: var(--correct);
            box-shadow: 0 4px 0 #009e4f;
        }
        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: var(--wrong);
            box-shadow: 0 4px 0 #d63031;
            animation: shake 0.5s;
        }
        .option-btn.disabled { pointer-events: none; opacity: 0.7; }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background: #f1f2f6;
            border-radius: 10px;
            padding: 15px;
            border-left: 5px solid var(--primary);
            animation: slideDown 0.3s ease-out;
        }
        .exp-header { font-weight: 800; color: var(--primary); margin-bottom: 5px; }
        .exp-detail { font-size: 0.95rem; color: #555; }
        .exp-detail strong { color: #333; }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* SUBMIT BUTTON */
        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding-bottom: 50px;
        }
        .submit-btn {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-weight: 900;
            box-shadow: 0 6px 0 #c0392b;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .submit-btn:hover { transform: scale(1.05); }

        /* RESULT MODAL */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            width: 90%; max-width: 500px;
            position: relative;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .score-display { font-size: 4rem; font-weight: 900; color: var(--primary); margin: 10px 0; }
        .feedback-text { font-size: 1.5rem; font-weight: 700; color: #555; margin-bottom: 20px; }
        @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Confetti Canvas */
        #confetti {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999;
        }

    </style>
</head>
<body>

    <div id="dynamic-bg"></div>
    <canvas id="confetti"></canvas>

    <header>
        <div class="teacher-name">
            <div class="teacher-avatar">MA</div>
            <span>Ms Mai An ULIS - English Test</span>
        </div>
        
        <div class="section-tabs">
            <button class="tab-btn active" onclick="switchSection('A')">Part A: Easter</button>
            <button class="tab-btn" onclick="switchSection('B')">Part B: Driving</button>
        </div>

        <div class="timer-container" onclick="toggleTimer()">
            <span id="timer-icon">‚è±Ô∏è</span>
            <span id="time-display">10:00</span>
        </div>
    </header>

    <div class="main-container">
        <div class="left-panel">
            <h1 id="p-title" class="passage-title">Title Here</h1>
            <div id="p-content" class="passage-content">
                </div>
            <button class="trans-btn" onclick="toggleTranslation()">üìñ HI·ªÜN B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
            <div id="p-translation" class="translation-text">
                </div>

            <div class="glossary-box">
                <div class="glossary-title">üìö Glossary (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</div>
                <table id="glossary-table">
                    </table>
            </div>
        </div>

        <div class="right-panel">
            <div id="quiz-container">
                </div>
            
            <div class="submit-section">
                <button class="submit-btn" onclick="showResults()">N·ªòP B√ÄI üöÄ</button>
            </div>
        </div>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>üéâ K·∫æT QU·∫¢ C·ª¶A B·∫†N üéâ</h2>
            <div class="score-display" id="final-score">0/12</div>
            <p class="feedback-text" id="final-feedback">Xu·∫•t s·∫Øc!</p>
            <button class="submit-btn" style="font-size: 1rem; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i</button>
        </div>
    </div>

<script>
    // --- D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI V√Ä GI·∫¢I TH√çCH CHI TI·∫æT ---
    const data = {
        A: {
            theme: {
                primary: "#fd79a8", // Pink
                secondary: "#ffeaa7", // Yellow
                emojis: ["üê∞", "ü•ö", "üå∏", "üç´"],
                bgColors: ["#ffe0e9", "#fff5d7"]
            },
            title: "Easter Celebrations",
            content: `Easter is an important Christian festival and holiday. It is held to celebrate the resurrection of Jesus Christ. Easter is not a fixed holiday. Its date varies between 22nd March and 25th April. People celebrate Easter around the world. In the UK, Easter is a public holiday. People give Easter chocolate eggs to their friends and family. There are also egg hunts for kids. In the US, Easter is a national holiday. People can go to church and have a special family meal. They also organise egg-hunts and give gifts of coloured eggs. In Russia, Easter is one of the most important holidays. People celebrate it with an Easter breakfast or meal. They also create very beautiful Easter eggs.`,
            translation: `L·ªÖ Ph·ª•c sinh l√† m·ªôt l·ªÖ h·ªôi v√† ng√†y l·ªÖ quan tr·ªçng c·ªßa C∆° ƒë·ªëc gi√°o. N√≥ ƒë∆∞·ª£c t·ªï ch·ª©c ƒë·ªÉ k·ª∑ ni·ªám s·ª± ph·ª•c sinh c·ªßa Ch√∫a Gi√™su Kit√¥. L·ªÖ Ph·ª•c sinh kh√¥ng ph·∫£i l√† m·ªôt ng√†y l·ªÖ c·ªë ƒë·ªãnh. Ng√†y c·ªßa n√≥ thay ƒë·ªïi trong kho·∫£ng t·ª´ ng√†y 22 th√°ng 3 ƒë·∫øn ng√†y 25 th√°ng 4. M·ªçi ng∆∞·ªùi t·ªï ch·ª©c l·ªÖ Ph·ª•c sinh tr√™n kh·∫Øp th·∫ø gi·ªõi. ·ªû Anh, l·ªÖ Ph·ª•c sinh l√† m·ªôt ng√†y l·ªÖ chung. M·ªçi ng∆∞·ªùi t·∫∑ng tr·ª©ng s√¥ c√¥ la Ph·ª•c sinh cho b·∫°n b√® v√† gia ƒë√¨nh. C≈©ng c√≥ nh·ªØng cu·ªôc sƒÉn tr·ª©ng cho tr·∫ª em. ·ªû M·ªπ, l·ªÖ Ph·ª•c sinh l√† m·ªôt ng√†y l·ªÖ qu·ªëc gia. M·ªçi ng∆∞·ªùi c√≥ th·ªÉ ƒë·∫øn nh√† th·ªù v√† d√πng b·ªØa ƒÉn gia ƒë√¨nh ƒë·∫∑c bi·ªát. H·ªç c≈©ng t·ªï ch·ª©c sƒÉn tr·ª©ng v√† t·∫∑ng qu√† l√† nh·ªØng qu·∫£ tr·ª©ng m√†u. ·ªû Nga, l·ªÖ Ph·ª•c sinh l√† m·ªôt trong nh·ªØng ng√†y l·ªÖ quan tr·ªçng nh·∫•t. M·ªçi ng∆∞·ªùi ƒÉn m·ª´ng b·∫±ng b·ªØa s√°ng ho·∫∑c b·ªØa ƒÉn Ph·ª•c sinh. H·ªç c≈©ng t·∫°o ra nh·ªØng qu·∫£ tr·ª©ng Ph·ª•c sinh r·∫•t ƒë·∫πp.`,
            glossary: [
                {w: "Resurrection", t: "n", m: "S·ª± ph·ª•c sinh"},
                {w: "Festival", t: "n", m: "L·ªÖ h·ªôi"},
                {w: "Fixed", t: "adj", m: "C·ªë ƒë·ªãnh"},
                {w: "Vary", t: "v", m: "Thay ƒë·ªïi, bi·∫øn ƒë·ªïi"},
                {w: "Celebrate", t: "v", m: "T·ªï ch·ª©c k·ª∑ ni·ªám, ƒÉn m·ª´ng"},
                {w: "Public holiday", t: "n", m: "Ng√†y l·ªÖ chung (ƒë∆∞·ª£c ngh·ªâ)"},
                {w: "National", t: "adj", m: "Thu·ªôc v·ªÅ qu·ªëc gia"},
                {w: "Organise", t: "v", m: "T·ªï ch·ª©c"},
                {w: "Decorate", t: "v", m: "Trang tr√≠ (imply context)"},
                {w: "Christian", t: "adj/n", m: "Thu·ªôc C∆° ƒë·ªëc gi√°o"}
            ],
            questions: [
                {
                    q: "1. What is the passage mainly about?",
                    options: ["A. The history and meaning of Easter.", "B. The way Easter is celebrated worldwide.", "C. The reason why Easter is important.", "D. The different types of Easter eggs."],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>B√†i ƒë·ªçc li·ªát k√™ c√°ch ƒë√≥n l·ªÖ ·ªü UK, US, v√† Russia -> N√≥i v·ªÅ c√°ch ƒÉn m·ª´ng tr√™n th·∫ø gi·ªõi.<br>Lo·∫°i A v√¨ kh√¥ng n√≥i s√¢u v·ªÅ l·ªãch s·ª≠. Lo·∫°i C, D qu√° h·∫πp.`
                },
                {
                    q: "2. Which of the following is NOT true about Easter?",
                    options: ["A. Easter is a Christian festival and holiday.", "B. Easter is celebrated on the same date every year.", "C. People in the UK give chocolate eggs as gifts.", "D. Easter celebrations include egg hunts for children."],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>B√†i ƒë·ªçc: "Easter is **not a fixed holiday**. Its date varies..." (Kh√¥ng c·ªë ƒë·ªãnh, ng√†y thay ƒë·ªïi).<br>C√¢u B n√≥i "same date" (c√πng 1 ng√†y) l√† Sai -> Ch·ªçn B.`
                },
                {
                    q: "3. What does the word ‚Äúvaries‚Äù in the passage mean?",
                    options: ["A. stays the same", "B. changes over time", "C. happens once a year", "D. is celebrated early"],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>"Varies" = Thay ƒë·ªïi/Bi·∫øn ƒë·ªïi.<br>A: Gi·ªØ nguy√™n. **B: Thay ƒë·ªïi theo th·ªùi gian** (ƒê√∫ng). C: X·∫£y ra 1 nƒÉm 1 l·∫ßn. D: T·ªï ch·ª©c s·ªõm.`
                },
                {
                    q: "4. What is the opposite of the word ‚Äúbeautiful‚Äù in the passage?",
                    options: ["A. ugly", "B. colourful", "C. lovely", "D. pretty"],
                    correct: 0,
                    exp: `**T·∫°i sao ch·ªçn A?**<br>Beautiful (ƒê·∫πp) >< **Ugly (X·∫•u)**.<br>Colourful (S·∫∑c s·ª°), Lovely (ƒê√°ng y√™u), Pretty (Xinh) ƒë·ªÅu mang nghƒ©a t√≠ch c·ª±c t∆∞∆°ng ƒë∆∞∆°ng.`
                },
                {
                    q: "5. How do people in Russia celebrate Easter?",
                    options: ["A. They organize egg hunts for kids.", "B. They give chocolate eggs as gifts.", "C. They prepare a special Easter meal.", "D. They go to church for celebrations."],
                    correct: 2,
                    exp: `**T·∫°i sao ch·ªçn C?**<br>D·∫´n ch·ª©ng ƒëo·∫°n Nga: "People celebrate it with an Easter breakfast or **meal**."<br>Egg hunts l√† ·ªü UK/US.`
                },
                {
                    q: "6. What do people in the US do on Easter?",
                    options: ["A. They decorate their houses for the holiday.", "B. They give gifts of coloured eggs to others.", "C. They have a big street parade together.", "D. They make homemade chocolate eggs."],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>D·∫´n ch·ª©ng ƒëo·∫°n US: "give **gifts of coloured eggs**."<br>B√†i kh√¥ng nh·∫Øc ƒë·∫øn vi·ªác trang tr√≠ nh√† (A) hay di·ªÖu h√†nh (C) hay t·ª± l√†m socola (D).`
                }
            ]
        },
        B: {
            theme: {
                primary: "#0984e3", // Blue
                secondary: "#ff7675", // Red
                emojis: ["üöó", "üö¶", "üëÆ", "üõ£Ô∏è"],
                bgColors: ["#dff9fb", "#c7ecee"]
            },
            title: "Drivers & Road Safety",
            content: `Who are the best drivers? Which drivers are the safest on the roads? According to a recent survey, young and inexperienced drivers are the most likely to have an accident. Older drivers are more careful. Young men have the worst accident records of all. They often choose faster cars with bigger engines. One of the most interesting facts in the survey is that passengers have an effect on the driver. When young male drivers have their friends in the car, their driving becomes worse. When their wife or girlfriend is in the car, however, their driving is better. But this is not true for women. Their driving is more dangerous when their husband or boyfriend is in the car. However, if their small children are in the car, they drive more slowly and safely.`,
            translation: `Ai l√† nh·ªØng ng∆∞·ªùi l√°i xe gi·ªèi nh·∫•t? Nh·ªØng ng∆∞·ªùi l√°i xe n√†o an to√†n nh·∫•t tr√™n ƒë∆∞·ªùng? Theo m·ªôt cu·ªôc kh·∫£o s√°t g·∫ßn ƒë√¢y, nh·ªØng ng∆∞·ªùi l√°i xe tr·∫ª v√† thi·∫øu kinh nghi·ªám l√† nh·ªØng ng∆∞·ªùi d·ªÖ g·∫∑p tai n·∫°n nh·∫•t. Nh·ªØng ng∆∞·ªùi l√°i xe l·ªõn tu·ªïi c·∫©n th·∫≠n h∆°n. Nam gi·ªõi tr·∫ª tu·ªïi c√≥ h·ªì s∆° tai n·∫°n t·ªìi t·ªá nh·∫•t trong s·ªë t·∫•t c·∫£. H·ªç th∆∞·ªùng ch·ªçn nh·ªØng chi·∫øc xe nhanh h∆°n v·ªõi ƒë·ªông c∆° l·ªõn h∆°n. M·ªôt trong nh·ªØng s·ª± th·∫≠t th√∫ v·ªã nh·∫•t trong cu·ªôc kh·∫£o s√°t l√† h√†nh kh√°ch c√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn ng∆∞·ªùi l√°i xe. Khi nh·ªØng ng∆∞·ªùi l√°i xe nam tr·∫ª tu·ªïi c√≥ b·∫°n b√® trong xe, vi·ªác l√°i xe c·ªßa h·ªç tr·ªü n√™n t·ªìi t·ªá h∆°n. Tuy nhi√™n, khi v·ª£ ho·∫∑c b·∫°n g√°i c·ªßa h·ªç ·ªü trong xe, vi·ªác l√°i xe c·ªßa h·ªç t·ªët h∆°n. Nh∆∞ng ƒëi·ªÅu n√†y kh√¥ng ƒë√∫ng v·ªõi ph·ª• n·ªØ. Vi·ªác l√°i xe c·ªßa h·ªç nguy hi·ªÉm h∆°n khi ch·ªìng ho·∫∑c b·∫°n trai c·ªßa h·ªç ·ªü trong xe. Tuy nhi√™n, n·∫øu con nh·ªè c·ªßa h·ªç ·ªü trong xe, h·ªç l√°i xe ch·∫≠m h∆°n v√† an to√†n h∆°n.`,
            glossary: [
                {w: "Inexperienced", t: "adj", m: "Thi·∫øu kinh nghi·ªám"},
                {w: "Survey", t: "n", m: "Cu·ªôc kh·∫£o s√°t"},
                {w: "Accident", t: "n", m: "Tai n·∫°n"},
                {w: "Engine", t: "n", m: "ƒê·ªông c∆°"},
                {w: "Passenger", t: "n", m: "H√†nh kh√°ch"},
                {w: "Effect", t: "n", m: "S·ª± ·∫£nh h∆∞·ªüng/t√°c ƒë·ªông"},
                {w: "Dangerous", t: "adj", m: "Nguy hi·ªÉm"},
                {w: "Carefully", t: "adv", m: "M·ªôt c√°ch c·∫©n th·∫≠n"},
                {w: "Record", t: "n", m: "H·ªì s∆°/K·ª∑ l·ª•c"},
                {w: "Likely", t: "adj", m: "C√≥ kh·∫£ nƒÉng, c√≥ l·∫Ω"}
            ],
            questions: [
                {
                    q: "1. What is the main idea of the passage?",
                    options: ["A. How different factors affect driving safety.", "B. The types of cars young people often drive.", "C. The reason why accidents happen in cities.", "D. How to improve driving skills for young men."],
                    correct: 0,
                    exp: `**T·∫°i sao ch·ªçn A?**<br>B√†i vi·∫øt n√≥i v·ªÅ tu·ªïi t√°c (tr·∫ª/gi√†), gi·ªõi t√≠nh (nam/n·ªØ) v√† h√†nh kh√°ch ·∫£nh h∆∞·ªüng th·∫ø n√†o ƒë·∫øn an to√†n -> C√°c y·∫øu t·ªë ·∫£nh h∆∞·ªüng l√°i xe.`
                },
                {
                    q: "2. Which of the following is NOT mentioned in the passage?",
                    options: ["A. Young and inexperienced drivers have more accidents.", "B. Women drive more carefully when their children are in the car.", "C. Young men always follow traffic rules on the road.", "D. Older drivers are more careful than younger ones."],
                    correct: 2,
                    exp: `**T·∫°i sao ch·ªçn C?**<br>B√†i n√≥i "Young men have the worst accident records" (h·ªì s∆° tai n·∫°n t·ªá nh·∫•t) -> H·ªç KH√îNG tu√¢n th·ªß lu·∫≠t t·ªët.<br>C√¢u C n√≥i "always follow rules" l√† sai.`
                },
                {
                    q: "3. The word \"choose\" in the passage is closest in meaning to:",
                    options: ["A. select", "B. refuse", "C. change", "D. follow"],
                    correct: 0,
                    exp: `**T·∫°i sao ch·ªçn A?**<br>Choose = Ch·ªçn l·ª±a.<br>**Select = Ch·ªçn**.<br>Refuse = T·ª´ ch·ªëi. Change = Thay ƒë·ªïi.`
                },
                {
                    q: "4. The word \"dangerous\" in the passage is opposite in meaning to:",
                    options: ["A. fast", "B. safe", "C. bad", "D. strict"],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>Dangerous (Nguy hi·ªÉm) >< **Safe (An to√†n)**.`
                },
                {
                    q: "5. Why do young male drivers often have more accidents?",
                    options: ["A. They usually drive bigger and faster cars.", "B. They do not have enough time to practice.", "C. They often drive slowly on busy roads.", "D. They prefer to drive alone on the road."],
                    correct: 0,
                    exp: `**T·∫°i sao ch·ªçn A?**<br>D·∫´n ch·ª©ng: "They often **choose faster cars with bigger engines**."`
                },
                {
                    q: "6. How do passengers affect male drivers?",
                    options: ["A. They drive better when their friends are with them.", "B. They drive more dangerously with their friends inside.", "C. They drive faster when their parents are in the car.", "D. They drive carelessly when they are alone."],
                    correct: 1,
                    exp: `**T·∫°i sao ch·ªçn B?**<br>D·∫´n ch·ª©ng: "When young male drivers have their friends in the car, their **driving becomes worse**." (L√°i t·ªá h∆°n = Nguy hi·ªÉm h∆°n).`
                }
            ]
        }
    };

    let currentSection = 'A';
    let userAnswers = {}; // Store user answers { 'A-0': 1, 'B-2': 0 }
    let timerInterval;
    let timeRemaining = 600; // 10 minutes in seconds
    let isTimerRunning = false;

    // --- KH·ªûI T·∫†O ---
    document.addEventListener('DOMContentLoaded', () => {
        switchSection('A');
    });

    // --- H√ÄM X·ª¨ L√ù THEME & RENDER ---
    function switchSection(sectionKey) {
        currentSection = sectionKey;
        const sData = data[sectionKey];
        const root = document.documentElement;

        // 1. Update Buttons
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event ? event.target.classList.add('active') : document.querySelector('.tab-btn').classList.add('active');

        // 2. Update CSS Variables (Theme)
        root.style.setProperty('--primary', sData.theme.primary);
        root.style.setProperty('--secondary', sData.theme.secondary);

        // 3. Update Dynamic SVG Background
        const svg = `
        <svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>
            <defs>
                <radialGradient id='grad' cx='50%' cy='50%' r='50%' fx='50%' fy='50%'>
                    <stop offset='0%' style='stop-color:${sData.theme.bgColors[0]};stop-opacity:1' />
                    <stop offset='100%' style='stop-color:${sData.theme.bgColors[1]};stop-opacity:1' />
                </radialGradient>
            </defs>
            <rect width='100%' height='100%' fill='url(#grad)' />
            <text x='10%' y='20%' font-size='50' opacity='0.2' transform='rotate(20 100,100)'>${sData.theme.emojis[0]}</text>
            <text x='80%' y='15%' font-size='60' opacity='0.2' transform='rotate(-15)'>${sData.theme.emojis[1]}</text>
            <text x='20%' y='80%' font-size='55' opacity='0.2' transform='rotate(10)'>${sData.theme.emojis[2]}</text>
            <text x='85%' y='85%' font-size='45' opacity='0.2' transform='rotate(-20)'>${sData.theme.emojis[3] || sData.theme.emojis[0]}</text>
            <text x='50%' y='50%' font-size='100' opacity='0.05'>${sData.theme.emojis[1]}</text>
        </svg>`;
        const encodedSvg = `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svg)))}`;
        document.getElementById('dynamic-bg').style.backgroundImage = `url("${encodedSvg}")`;

        // 4. Render Passage Content
        document.getElementById('p-title').innerText = sData.title;
        document.getElementById('p-content').innerText = sData.content;
        document.getElementById('p-translation').innerText = sData.translation;
        document.getElementById('p-translation').style.display = 'none'; // Hide translation on switch

        // 5. Render Glossary
        const tbody = document.getElementById('glossary-table');
        tbody.innerHTML = '';
        sData.glossary.forEach(item => {
            const row = `<tr>
                <td><strong>${item.w}</strong> <span class="word-type">(${item.t})</span></td>
                <td>${item.m}</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        // 6. Render Questions
        const quizContainer = document.getElementById('quiz-container');
        quizContainer.innerHTML = '';
        sData.questions.forEach((q, idx) => {
            const qKey = `${currentSection}-${idx}`;
            const savedAns = userAnswers[qKey];
            
            let optionsHtml = '';
            q.options.forEach((opt, oIdx) => {
                let statusClass = '';
                if (savedAns !== undefined) {
                    if (oIdx === q.correct) statusClass = 'correct';
                    else if (oIdx === savedAns && oIdx !== q.correct) statusClass = 'wrong';
                    else statusClass = 'disabled';
                }

                optionsHtml += `<button class="option-btn ${statusClass}" 
                    onclick="checkAnswer('${currentSection}', ${idx}, ${oIdx}, this)">
                    ${opt}
                </button>`;
            });

            // Explanation visibility
            const expDisplay = savedAns !== undefined ? 'block' : 'none';

            const cardHtml = `
            <div class="question-card">
                <div class="question-text">${q.q}</div>
                <div class="options-grid" id="opts-${qKey}">
                    ${optionsHtml}
                </div>
                <div class="explanation-box" id="exp-${qKey}" style="display: ${expDisplay}">
                    <div class="exp-header">üí° GI·∫¢I TH√çCH CHI TI·∫æT (C√¥ Mai An):</div>
                    <div class="exp-detail">${q.exp}</div>
                </div>
            </div>`;
            quizContainer.innerHTML += cardHtml;
        });
    }

    // --- H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN ---
    function checkAnswer(section, qIdx, oIdx, btnElement) {
        const qKey = `${section}-${qIdx}`;
        if (userAnswers[qKey] !== undefined) return; // Prevent re-answering

        const qData = data[section].questions[qIdx];
        userAnswers[qKey] = oIdx; // Save answer

        const parentGrid = document.getElementById(`opts-${qKey}`);
        const buttons = parentGrid.querySelectorAll('.option-btn');

        // Logic Visual
        if (oIdx === qData.correct) {
            // Correct
            btnElement.classList.add('correct');
            fireConfetti(btnElement);
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            // Show correct answer immediately
            buttons[qData.correct].classList.add('correct');
        }

        // Disable all buttons
        buttons.forEach(btn => {
            if (!btn.classList.contains('correct') && !btn.classList.contains('wrong')) {
                btn.classList.add('disabled');
            }
            btn.style.pointerEvents = 'none';
        });

        // Show Explanation
        document.getElementById(`exp-${qKey}`).style.display = 'block';
    }

    // --- TI·ªÜN √çCH KH√ÅC ---
    function toggleTranslation() {
        const t = document.getElementById('p-translation');
        t.style.display = t.style.display === 'none' ? 'block' : 'none';
    }

    function toggleTimer() {
        if (isTimerRunning) {
            clearInterval(timerInterval);
            isTimerRunning = false;
        } else {
            if (timeRemaining <= 0) return;
            isTimerRunning = true;
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m, nh∆∞ng nh·ªõ l√† trong ph√≤ng thi th·∫≠t, b·∫°n ch·ªâ n√™n l√†m m·ªôt b√†i nh∆∞ th·∫ø n√†y trong 10 ph√∫t th√¥i nha.");
                }
            }, 1000);
        }
    }

    function updateTimerDisplay() {
        const m = Math.floor(timeRemaining / 60);
        const s = timeRemaining % 60;
        document.getElementById('time-display').innerText = `${m}:${s < 10 ? '0'+s : s}`;
    }

    // --- T·ªîNG K·∫æT ---
    function showResults() {
        let totalQ = 0;
        let correctC = 0;

        ['A', 'B'].forEach(sec => {
            data[sec].questions.forEach((q, idx) => {
                totalQ++;
                const key = `${sec}-${idx}`;
                if (userAnswers[key] === q.correct) correctC++;
            });
        });

        const scoreEl = document.getElementById('final-score');
        const feedEl = document.getElementById('final-feedback');
        
        scoreEl.innerText = `${correctC}/${totalQ}`;
        
        const ratio = correctC / totalQ;
        if (ratio === 1) feedEl.innerText = "üèÜ THI√äN T√ÄI! B·∫°n ƒë√∫ng tuy·ªát ƒë·ªëi!";
        else if (ratio >= 0.8) feedEl.innerText = "üåü L√†m t·ªët l·∫Øm! B·∫°n n·∫Øm r·∫•t ch·∫Øc b√†i.";
        else if (ratio >= 0.5) feedEl.innerText = "üëç Kh√° t·ªët, nh∆∞ng c·∫ßn xem k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©.";
        else feedEl.innerText = "üí™ C·ªë l√™n nh√©! H√£y ƒë·ªçc k·ªπ l·∫°i ph·∫ßn d·ªãch v√† t·ª´ v·ª±ng.";

        document.getElementById('result-modal').style.display = 'flex';
        // Big Confetti
        for(let i=0; i<5; i++) {
            setTimeout(() => fireConfetti(document.body), i*300);
        }
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
    }

    // --- HI·ªÜU ·ª®NG CONFETTI (Simple JS Canvas implementation) ---
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];

    function fireConfetti(element) {
        // Get position of element to burst from
        const rect = element.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;

        for (let i = 0; i < 30; i++) {
            particles.push({
                x: x, y: y,
                dx: (Math.random() - 0.5) * 10,
                dy: (Math.random() - 0.5) * 10,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 5 + 2,
                life: 100
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        if (particles.length === 0) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        particles.forEach((p, index) => {
            p.x += p.dx;
            p.y += p.dy;
            p.dy += 0.2; // gravity
            p.life--;
            
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
            
            if (p.life <= 0) particles.splice(index, 1);
        });
        
        requestAnimationFrame(animateConfetti);
    }
    
    // Resize canvas on window resize
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

</script>
</body>
</html>
