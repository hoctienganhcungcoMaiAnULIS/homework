<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 6: Going Places - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #FF9F43; /* Cam nƒÉng ƒë·ªông */
            --secondary: #54a0ff; /* Xanh da tr·ªùi */
            --accent: #5f27cd; /* T√≠m ƒë·∫≠m */
            --correct: #1dd1a1; /* Xanh ng·ªçc */
            --wrong: #ff6b6b; /* ƒê·ªè pastel */
            --bg-color: #feca57; /* N·ªÅn v√†ng nh·∫°t */
            --card-bg: #ffffff;
            --text-color: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#ff9f43 0.5px, transparent 0.5px), radial-gradient(#ff9f43 0.5px, #feca57 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            user-select: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 4px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }

        h1 {
            color: var(--accent);
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 2.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .teacher-name {
            color: var(--secondary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 5px;
            background: #dff9fb;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 50px;
        }

        /* CARD STYLES */
        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 #c8d6e5;
            border: 2px solid #fff;
            transition: transform 0.3s;
        }

        h2 {
            color: var(--secondary);
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
            margin-top: 0;
            font-family: 'Quicksand', sans-serif;
        }

        /* QUESTIONS & OPTIONS */
        .question-block {
            margin-bottom: 40px;
        }

        .question-text {
            font-weight: 800;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            transition: all 0.1s;
            box-shadow: 0 6px 0 #bdc3c7;
            position: relative;
            color: #57606f;
        }

        .option-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #bdc3c7;
        }

        /* STATES: CORRECT / WRONG */
        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: #10ac84;
            box-shadow: 0 6px 0 #10ac84;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: #ee5253;
            box-shadow: 0 6px 0 #c23616;
            opacity: 0.7;
        }

        /* FEEDBACK ALERT BOX */
        .feedback-alert {
            display: none;
            padding: 15px;
            margin-top: 15px;
            border-radius: 12px;
            font-weight: 800;
            text-align: center;
            font-size: 1.1rem;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .feedback-alert.wrong-alert {
            display: block;
            background: var(--wrong);
            animation: shake 0.5s;
            border: 2px solid #d63031;
        }

        .feedback-alert.correct-alert {
            display: block;
            background: var(--correct);
            animation: pop 0.3s;
            border: 2px solid #00b894;
        }

        /* EXPLANATION BOX */
        .explanation {
            display: none;
            margin-top: 15px;
            background: #e8fbf4;
            border: 2px solid var(--correct);
            border-radius: 15px;
            padding: 20px;
            animation: slideDown 0.3s ease-out;
            text-align: left;
        }

        .explanation.visible { display: block; }
        
        .exp-header {
            font-weight: 800;
            color: var(--correct);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .exp-content p { margin: 5px 0; font-size: 1rem; }
        
        /* GAP FILL LAYOUT */
        .gap-fill-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .options-box {
            background: #fff4e6;
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .word-tag {
            background: white;
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
            box-shadow: 0 3px 0 #ffeaa7;
        }

        .reading-text {
            background: #f1f2f6;
            padding: 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            line-height: 1.8;
            border-left: 5px solid var(--secondary);
        }

        .gap-blank {
            display: inline-block;
            width: 50px;
            height: 30px;
            border-bottom: 2px solid #333;
            text-align: center;
            font-weight: bold;
            color: var(--accent);
        }

        .answer-group {
            background: white;
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 0 #ddd;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #eee;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .mini-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.9rem;
        }

        .mini-btn:hover { background: #eee; }
        .mini-btn.correct { background: var(--correct); color: white; border-color: var(--correct); }
        .mini-btn.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }

        /* GLOSSARY */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 0 #eee;
        }
        .glossary-table th { background: var(--secondary); color: white; padding: 10px; }
        .glossary-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .word-type { color: #888; font-style: italic; font-size: 0.8rem; }

        /* ANIMATIONS */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* POPUP SCORE */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            max-width: 400px; width: 90%;
            border: 5px solid var(--secondary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: slideDown 0.5s;
        }

        .score-big { font-size: 4rem; font-weight: 800; color: var(--correct); margin: 10px 0; }
        
        .btn-submit {
            background: var(--primary); color: white; border: none;
            padding: 15px 40px; font-size: 1.5rem; border-radius: 50px;
            font-weight: 800; cursor: pointer; box-shadow: 0 8px 0 #e58e26;
            display: block; margin: 40px auto; transition: 0.2s;
        }
        .btn-submit:active { transform: translateY(6px); box-shadow: 0 2px 0 #e58e26; }

        #confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>Unit 6: Going Places üåç</h1>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
    </header>

    <div class="card">
        <h2>Part 1: Vocabulary - Getting Around & Road Safety</h2>
        <p style="text-align: center; color: #666; font-style: italic;">Ch·ªçn t·ª´ ƒë√∫ng v·ªõi ƒë·ªãnh nghƒ©a.</p>

        <div class="question-block" id="q1-block">
            <div class="question-text">1. "We take the ________." It travels on rails in the street.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">A. Ferry</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">B. Tram</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">C. Tuk-tuk</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">D. Lorry</button>
            </div>
            <div id="alert-q1" class="feedback-alert"></div>
            <div class="explanation" id="exp-q1">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> "Ch√∫ng t√¥i ƒëi t√†u ƒëi·ªán." N√≥ ch·∫°y tr√™n ƒë∆∞·ªùng ray ·ªü tr√™n ph·ªë.</p>
                    <p><strong>T·∫°i sao ch·ªçn B?</strong> Tram (T√†u ƒëi·ªán) l√† ph∆∞∆°ng ti·ªán ch·∫°y tr√™n ƒë∆∞·ªùng ray (rails) ngay trong th√†nh ph·ªë.</p>
                    <p><strong>Ph√¢n t√≠ch sai:</strong> Ferry (Ph√† - ƒëi d∆∞·ªõi n∆∞·ªõc), Tuk-tuk (Xe ba b√°nh), Lorry (Xe t·∫£i).</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q2-block">
            <div class="question-text">2. You must "wear a ________" when you go on a zipwire to be safe.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q2', 4, this)">A. Helmet</button>
                <button class="option-btn" onclick="checkAnswer('q2', 4, this)">B. Seatbelt</button>
                <button class="option-btn" onclick="checkAnswer('q2', 4, this)">C. Armband</button>
                <button class="option-btn" onclick="checkAnswer('q2', 4, this)">D. Harness</button>
            </div>
            <div id="alert-q2" class="feedback-alert"></div>
            <div class="explanation" id="exp-q2">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> B·∫°n ph·∫£i "ƒëeo ƒëai b·∫£o h·ªô" khi ƒëi tr∆∞·ª£t zipline ƒë·ªÉ ƒë∆∞·ª£c an to√†n.</p>
                    <p><strong>T·∫°i sao ch·ªçn D?</strong> Harness l√† b·ªô ƒëai ƒëeo quanh ng∆∞·ªùi ƒë·ªÉ gi·ªØ an to√†n khi leo n√∫i ho·∫∑c tr∆∞·ª£t zipwire.</p>
                    <p><strong>L∆∞u √Ω:</strong> Helmet (M≈© b·∫£o hi·ªÉm) ƒë·ªôi l√™n ƒë·∫ßu, Seatbelt (D√¢y an to√†n) d√πng trong √¥ t√¥.</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q3-block">
            <div class="question-text">3. "The ________ is deep." It is a deep valley with steep sides.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q3', 3, this)">A. Bridge</button>
                <button class="option-btn" onclick="checkAnswer('q3', 3, this)">B. Pier</button>
                <button class="option-btn" onclick="checkAnswer('q3', 3, this)">C. Canyon</button>
                <button class="option-btn" onclick="checkAnswer('q3', 3, this)">D. Theme Park</button>
            </div>
            <div id="alert-q3" class="feedback-alert"></div>
            <div class="explanation" id="exp-q3">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> "H·∫ªm n√∫i th√¨ s√¢u." ƒê√≥ l√† m·ªôt thung l≈©ng s√¢u v·ªõi v√°ch d·ª±ng ƒë·ª©ng.</p>
                    <p><strong>T·∫°i sao ch·ªçn C?</strong> Canyon (H·∫ªm n√∫i) kh·ªõp v·ªõi m√¥ t·∫£ "deep valley" (thung l≈©ng s√¢u).</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q4-block">
            <div class="question-text">4. Where should you cross the road safely? "Cross at the ________."</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q4', 1, this)">A. Pedestrian Crossing</button>
                <button class="option-btn" onclick="checkAnswer('q4', 1, this)">B. Metro</button>
                <button class="option-btn" onclick="checkAnswer('q4', 1, this)">C. Zipwire</button>
                <button class="option-btn" onclick="checkAnswer('q4', 1, this)">D. Cable</button>
            </div>
            <div id="alert-q4" class="feedback-alert"></div>
            <div class="explanation" id="exp-q4">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> B·∫°n n√™n qua ƒë∆∞·ªùng ·ªü ƒë√¢u cho an to√†n? "Qua ƒë∆∞·ªùng t·∫°i v·∫°ch cho ng∆∞·ªùi ƒëi b·ªô."</p>
                    <p><strong>T·∫°i sao ch·ªçn A?</strong> Pedestrian Crossing (v·∫°ch k·∫ª ƒë∆∞·ªùng/l·ªëi ƒëi b·ªô) l√† n∆°i d√†nh ri√™ng ƒë·ªÉ qua ƒë∆∞·ªùng an to√†n.</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q5-block">
            <div class="question-text">5. "Wear ________ at night" so drivers can see you clearly.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q5', 2, this)">A. Seatbelts</button>
                <button class="option-btn" onclick="checkAnswer('q5', 2, this)">B. Reflective Armbands</button>
                <button class="option-btn" onclick="checkAnswer('q5', 2, this)">C. Helmets</button>
                <button class="option-btn" onclick="checkAnswer('q5', 2, this)">D. Cables</button>
            </div>
            <div id="alert-q5" class="feedback-alert"></div>
            <div class="explanation" id="exp-q5">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> "ƒêeo bƒÉng tay ph·∫£n quang v√†o ban ƒë√™m" ƒë·ªÉ t√†i x·∫ø c√≥ th·ªÉ nh√¨n th·∫•y b·∫°n r√µ r√†ng.</p>
                    <p><strong>T·∫°i sao ch·ªçn B?</strong> Reflective (Ph·∫£n quang) gi√∫p ph√°t s√°ng khi c√≥ ƒë√®n chi·∫øu v√†o, an to√†n khi ƒëi ƒë√™m.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Part 2: Getting Around Cities (Map & Directions)</h2>
        <p style="margin-bottom: 20px;"><em>Look at the map instructions and fill in the missing words.</em></p>

        <div class="options-box">
            <div class="word-tag">A. towards</div>
            <div class="word-tag">B. across</div>
            <div class="word-tag">C. from / to</div>
            <div class="word-tag">D. up</div>
        </div>

        <div class="reading-text">
            I am standing at the hotel. First, I need to go <strong>(6)</strong> <span class="gap-blank">___</span> the hotel <strong>(7)</strong> <span class="gap-blank">___</span> the museum. Then, I will go <strong>(8)</strong> <span class="gap-blank">___</span> the bridge to cross the river. Finally, I walk <strong>(9)</strong> <span class="gap-blank">___</span> the park to meet my friends.
        </div>

        <table class="glossary-table">
            <thead>
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>Go across</strong></td><td>(phrase)</td><td>ƒêi bƒÉng qua (c·∫ßu, ƒë∆∞·ªùng)</td></tr>
                <tr><td><strong>Towards</strong></td><td>(prep)</td><td>V·ªÅ ph√≠a, h∆∞·ªõng v·ªÅ</td></tr>
                <tr><td><strong>From... to...</strong></td><td>(phrase)</td><td>T·ª´... ƒë·∫øn...</td></tr>
                <tr><td><strong>Metro</strong></td><td>(n)</td><td>T√†u ƒëi·ªán ng·∫ßm</td></tr>
            </tbody>
        </table>

        <div class="gap-fill-container" style="margin-top: 20px;">
            
            <div class="answer-group">
                <label>6 & 7. "go ___ the hotel ___ the museum"</label>
                <div style="display:flex; gap:5px;">
                    <button class="mini-btn" onclick="checkGap('q6', 0, 2, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q6', 1, 2, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q6', 2, 2, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q6', 3, 2, this, ['A','B','C','D'])">D</button>
                </div>
            </div>
            <div id="alert-q6" class="feedback-alert"></div>
            <div class="explanation" id="exp-q6">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>ƒê√°p √°n ƒë√∫ng: C. from / to</strong></p>
                    <p>C·∫•u tr√∫c: <strong>"Go from [Place A] to [Place B]"</strong> (ƒêi t·ª´ ƒë·ªãa ƒëi·ªÉm A ƒë·∫øn ƒë·ªãa ƒëi·ªÉm B).</p>
                    <p>V√≠ d·ª• trong ·∫£nh: "We go from the hotel to the museum."</p>
                </div>
            </div>

            <div class="answer-group">
                <label>8. "go ___ the bridge"</label>
                <div style="display:flex; gap:5px;">
                    <button class="mini-btn" onclick="checkGap('q8', 0, 1, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q8', 1, 1, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q8', 2, 1, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q8', 3, 1, this, ['A','B','C','D'])">D</button>
                </div>
            </div>
            <div id="alert-q8" class="feedback-alert"></div>
            <div class="explanation" id="exp-q8">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>ƒê√°p √°n ƒë√∫ng: B. across</strong></p>
                    <p>C·ª•m t·ª´: <strong>"Go across the bridge"</strong> (ƒêi bƒÉng qua c·∫ßu).</p>
                    <p>Across d√πng khi ta di chuy·ªÉn t·ª´ b√™n n√†y sang b√™n kia c·ªßa m·ªôt b·ªÅ m·∫∑t.</p>
                </div>
            </div>

            <div class="answer-group">
                <label>9. "walk ___ the park"</label>
                <div style="display:flex; gap:5px;">
                    <button class="mini-btn" onclick="checkGap('q9', 0, 0, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q9', 1, 0, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q9', 2, 0, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q9', 3, 0, this, ['A','B','C','D'])">D</button>
                </div>
            </div>
            <div id="alert-q9" class="feedback-alert"></div>
            <div class="explanation" id="exp-q9">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>ƒê√°p √°n ƒë√∫ng: A. towards</strong></p>
                    <p>C·ª•m t·ª´: <strong>"Walk towards the park"</strong> (ƒêi b·ªô v·ªÅ ph√≠a c√¥ng vi√™n).</p>
                    <p>Towards ch·ªâ ph∆∞∆°ng h∆∞·ªõng di chuy·ªÉn.</p>
                </div>
            </div>

        </div>
    </div>

    <button class="btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
</div>

<div class="popup-overlay" id="scorePopup">
    <div class="popup-content">
        <h2 style="color:var(--secondary)">K·∫æT QU·∫¢ C·ª¶A CON</h2>
        <div class="score-big" id="finalScore">0/9</div>
        <p id="praiseText" style="font-size: 1.2rem; margin-bottom: 20px;">L√†m t·ªët l·∫Øm!</p>
        <button class="btn-submit" style="margin: 0 auto; font-size: 1rem; padding: 10px 30px;" onclick="closePopup()">Xem l·∫°i b√†i</button>
    </div>
</div>

<script>
    let totalScore = 0;
    const totalQuestions = 8; // 5 vocab + 3 gap structure blocks = 8 points total
    let answered = {}; 

    // --- SOUND EFFECTS (Correct: Ding Dong / Wrong: Sad Trombone) ---
    const soundCorrect = new Audio('https://www.myinstants.com/media/sounds/ding-sound-effect.mp3');
    const soundWrong = new Audio('https://www.myinstants.com/media/sounds/sadtrombone.swf.mp3');

    function playSound(isCorrect) {
        if(isCorrect) {
            soundCorrect.currentTime = 0;
            soundCorrect.play().catch(e => console.log("Audio blocked"));
        } else {
            soundWrong.currentTime = 0;
            soundWrong.play().catch(e => console.log("Audio blocked"));
        }
    }

    // --- CHECK ANSWER FUNCTION ---
    function checkAnswer(qId, correctIndex, btn) {
        if(answered[qId]) return;
        answered[qId] = true;

        const parent = btn.parentElement;
        const buttons = parent.getElementsByClassName('option-btn');
        const selectedIndex = Array.from(buttons).indexOf(btn) + 1; // 1-based index
        const explanation = document.getElementById(`exp-${qId}`);
        const alertBox = document.getElementById(`alert-${qId}`);
        const correctText = buttons[correctIndex-1].innerText;

        if(selectedIndex === correctIndex) {
            btn.classList.add('correct');
            totalScore++;
            playSound(true);
            fireConfetti();
            
            alertBox.innerHTML = "üåü CH√çNH X√ÅC! GI·ªéI L·∫ÆM!";
            alertBox.className = "feedback-alert correct-alert";
        } else {
            btn.classList.add('wrong');
            buttons[correctIndex - 1].classList.add('correct'); 
            playSound(false);

            alertBox.innerHTML = `‚ö†Ô∏è SAI R·ªíI! ƒê√ÅP √ÅN ƒê√öNG L√Ä: <br>${correctText}`;
            alertBox.className = "feedback-alert wrong-alert";
        }

        explanation.classList.add('visible');
    }

    function checkGap(qId, selectedIndex, correctIndex, btn, labels) {
        if(answered[qId]) return;
        answered[qId] = true;

        const parent = btn.parentElement.parentElement.querySelector('div[style*="display:flex"]');
        // Correct selector for nested structure if needed, or simple traversal:
        // Actually btn.parentElement is the div with buttons
        const buttons = btn.parentElement.getElementsByClassName('mini-btn');
        
        const explanation = document.getElementById(`exp-${qId}`);
        const alertBox = document.getElementById(`alert-${qId}`);
        const correctLabel = labels[correctIndex];

        if(selectedIndex === correctIndex) {
            btn.classList.add('correct');
            totalScore++;
            playSound(true);
            fireConfetti();

            alertBox.innerHTML = "üåü CH√çNH X√ÅC!";
            alertBox.className = "feedback-alert correct-alert";
        } else {
            btn.classList.add('wrong');
            buttons[correctIndex].classList.add('correct');
            playSound(false);

            alertBox.innerHTML = `‚ö†Ô∏è SAI R·ªíI! ƒê√ÅP √ÅN L√Ä (${correctLabel})`;
            alertBox.className = "feedback-alert wrong-alert";
        }

        explanation.classList.add('visible');
    }

    function submitQuiz() {
        const scoreText = document.getElementById('finalScore');
        const praiseText = document.getElementById('praiseText');
        const maxScore = 8;
        
        scoreText.innerText = `${totalScore}/${maxScore}`;
        
        const percentage = (totalScore / maxScore) * 100;
        if(percentage === 100) praiseText.innerText = "Tuy·ªát v·ªùi! Con l√† nh√† th√°m hi·ªÉm t√†i ba! üåç‚úàÔ∏è";
        else if(percentage >= 80) praiseText.innerText = "Gi·ªèi qu√°! Con nh·ªõ ƒë∆∞·ªùng r·∫•t t·ªët! üó∫Ô∏è";
        else if(percentage >= 50) praiseText.innerText = "Kh√° t·ªët! Con ch√∫ √Ω lu·∫≠t giao th√¥ng h∆°n nh√©! üö¶";
        else praiseText.innerText = "C·ªë g·∫Øng l√™n! H√£y xem l·∫°i b·∫£n ƒë·ªì nh√©! ‚ù§Ô∏è";

        document.getElementById('scorePopup').style.display = 'flex';
        if(percentage >= 50) fireConfetti();
    }

    function closePopup() {
        document.getElementById('scorePopup').style.display = 'none';
    }

    // Confetti Effect
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let confetti = [];

    function fireConfetti() {
        for (let i = 0; i < 100; i++) {
            confetti.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: ['#FF9F43', '#54a0ff', '#5f27cd', '#1dd1a1', '#ff6b6b'][Math.floor(Math.random() * 5)],
                size: Math.random() * 8 + 4,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 4 - 2
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let active = false;
        confetti.forEach((p, i) => {
            p.y += p.speedY;
            p.x += p.speedX;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if (p.y < canvas.height) active = true;
        });
        if (active) requestAnimationFrame(animateConfetti);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
</script>

</body>
</html>