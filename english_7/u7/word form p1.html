<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Form Mastery - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-color: #F0F4F8;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c022 2px, transparent 2px);
            background-size: 30px 30px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            margin-top: 20px;
        }

        .header-info {
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 700;
            text-align: center;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            background: white;
            border-radius: 25px;
            box-shadow: 0 10px 0 #d1d9e6;
            padding: 30px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2d3436;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        .option-btn {
            width: 100%;
            text-align: left;
            padding: 15px 25px;
            margin-bottom: 15px;
            border: 3px solid #e2e8f0;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #4a5568;
            background: white;
            box-shadow: 0 5px 0 #e2e8f0;
            transition: all 0.2s ease;
            cursor: pointer;
            outline: none;
            display: flex;
            align-items: center;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 7px 0 #7342ac;
        }

        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #e2e8f0;
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            color: white !important;
            border-color: #00b35a !important;
            box-shadow: 0 5px 0 #00994d !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            color: white !important;
            border-color: #e63946 !important;
            box-shadow: 0 5px 0 #cc2e3b !important;
        }

        .explanation-box {
            display: none;
            background: #f8f0ff;
            border-left: 8px solid var(--primary);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake { animation: shake 0.3s ease-in-out; }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .score-badge {
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 800;
            box-shadow: 0 4px 0 #00a88b;
        }

        .btn-next {
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 800;
            box-shadow: 0 6px 0 #7342ac;
            transition: all 0.2s;
            margin-top: 15px;
            display: none;
        }

        .btn-next:hover { transform: scale(1.05); }

        #summary-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            width: 90%;
            max-width: 450px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .word-tag {
            display: inline-block;
            background: #eee;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.9em;
            margin-right: 10px;
            color: #555;
            min-width: 28px;
            text-align: center;
        }

        .step-title {
            color: var(--primary);
            font-weight: 800;
            margin-top: 15px;
            display: block;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div class="header-info">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-extrabold text-[#8854C0]">WORD FORM MASTERY üåü</h1>
            <div class="score-badge">ƒê√∫ng: <span id="current-score">0</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>

        <div id="quiz-area">
            <div class="card" id="question-card">
                <div id="question-container">
                    <p class="question-text" id="main-question">Loading...</p>
                    <div id="options-list"></div>
                </div>

                <div class="explanation-box" id="explanation-box">
                    <div id="explanation-content"></div>
                    <div class="flex justify-center">
                        <button class="btn-next" id="btn-next" onclick="nextQuestion()">TI·∫æP T·ª§C ‚ûî</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div id="summary-popup">
        <h2 class="text-3xl font-black mb-4 text-[#8854C0]">K·∫æT QU·∫¢ CU·ªêI C√ôNG!</h2>
        <div class="text-5xl font-black text-[#00C9A7] mb-4" id="final-score">0/0</div>
        <p class="text-lg text-gray-600 mb-6" id="feedback-msg"></p>
        <button class="btn-next" style="display:inline-block;" onclick="location.reload()">L√ÄM L·∫†I B√ÄI TEST</button>
    </div>

    <script>
        const rawData = [
            { q: "David Edward Hughes was the ________ of microphone.", word: "invent", options: ["inventor", "invention", "invent", "inventive"], correct: 0, steps: { s1: "David Edward Hughes l√† ng∆∞·ªùi ph√°t minh ra micr√¥.", s2: ["inventor (n): nh√† ph√°t minh (ng∆∞·ªùi)", "invention (n): s·ª± ph√°t minh (v·∫≠t/vi·ªác)", "invent (v): ph√°t minh", "inventive (adj): ƒë·∫ßy s√°ng t·∫°o"], s3: "Sau m·∫°o t·ª´ 'the' c·∫ßn m·ªôt danh t·ª´. V√¨ ch·ªß ng·ªØ l√† t√™n ng∆∞·ªùi n√™n c·∫ßn danh t·ª´ ch·ªâ ng∆∞·ªùi.", s4: "C√°c ph∆∞∆°ng √°n kh√°c kh√¥ng ph√π h·ª£p lo·∫°i t·ª´ ho·∫∑c ng·ªØ nghƒ©a ch·ªâ ng∆∞·ªùi." } },
            { q: "This film made a strong ________ on me.", word: "impress", options: ["impression", "impressive", "impress", "impressively"], correct: 0, steps: { s1: "B·ªô phim n√†y ƒë√£ g√¢y ·∫•n t∆∞·ª£ng m·∫°nh m·∫Ω v·ªõi t√¥i.", s2: ["impression (n): s·ª± ·∫•n t∆∞·ª£ng", "impressive (adj): ƒë·∫ßy ·∫•n t∆∞·ª£ng", "impress (v): g√¢y ·∫•n t∆∞·ª£ng", "impressively (adv): m·ªôt c√°ch ƒë·∫ßy ·∫•n t∆∞·ª£ng"], s3: "C·∫•u tr√∫c 'Make a/an impression on someone' (G√¢y ·∫•n t∆∞·ª£ng v·ªõi ai). Sau t√≠nh t·ª´ 'strong' c·∫ßn m·ªôt danh t·ª´.", s4: "C√°c t·ª´ kh√°c sai lo·∫°i t·ª´." } },
            { q: "He's well-known in the local ________.", word: "community", options: ["community", "communal", "communicate", "communication"], correct: 0, steps: { s1: "Anh ·∫•y r·∫•t n·ªïi ti·∫øng trong c·ªông ƒë·ªìng ƒë·ªãa ph∆∞∆°ng.", s2: ["community (n): c·ªông ƒë·ªìng", "communal (adj): thu·ªôc v·ªÅ chung", "communicate (v): giao ti·∫øp", "communication (n): s·ª± giao ti·∫øp"], s3: "Sau t√≠nh t·ª´ 'local' c·∫ßn m·ªôt danh t·ª´.", s4: "C√°c ƒë√°p √°n kh√°c kh√¥ng ph√π h·ª£p ng·ªØ c·∫£nh." } },
            { q: "Robots help humans explore the ________ world.", word: "SEA", options: ["undersea", "sea", "seaside", "overseas"], correct: 0, steps: { s1: "Robot gi√∫p con ng∆∞·ªùi kh√°m ph√° th·∫ø gi·ªõi d∆∞·ªõi ƒë·∫°i d∆∞∆°ng.", s2: ["undersea (adj): d∆∞·ªõi ƒë√°y bi·ªÉn", "sea (n): bi·ªÉn", "seaside (n): b·ªù bi·ªÉn", "overseas (adv/adj): n∆∞·ªõc ngo√†i"], s3: "C·∫ßn m·ªôt t√≠nh t·ª´ b·ªï nghƒ©a cho danh t·ª´ 'world'.", s4: "Undersea ph√π h·ª£p nh·∫•t ƒë·ªÉ n√≥i v·ªÅ vi·ªác robot l·∫∑n xu·ªëng kh√°m ph√°." } },
            { q: "What I like about festivals is that they show the ________ values of different communities.", word: "culture", options: ["cultural", "culture", "culturally", "cultured"], correct: 0, steps: { s1: "ƒêi·ªÅu t√¥i th√≠ch ·ªü c√°c l·ªÖ h·ªôi l√† ch√∫ng th·ªÉ hi·ªán nh·ªØng gi√° tr·ªã vƒÉn h√≥a c·ªßa c√°c c·ªông ƒë·ªìng kh√°c nhau.", s2: ["cultural (adj): thu·ªôc v·ªÅ vƒÉn h√≥a", "culture (n): vƒÉn h√≥a", "culturally (adv): v·ªÅ m·∫∑t vƒÉn h√≥a", "cultured (adj): c√≥ h·ªçc th·ª©c"], s3: "C·∫ßn t√≠nh t·ª´ ƒë·ª©ng tr∆∞·ªõc danh t·ª´ 'values' ƒë·ªÉ b·ªï nghƒ©a.", s4: "C√°c ƒë√°p √°n kh√°c kh√¥ng ƒë√∫ng lo·∫°i t·ª´." } },
            { q: "It costs 10 dollars to rent the ________ equipment.", word: "SAFE", options: ["safety", "safe", "safely", "save"], correct: 0, steps: { s1: "T·ªën 10 ƒë√¥ la ƒë·ªÉ thu√™ thi·∫øt b·ªã an to√†n.", s2: ["safety (n): s·ª± an to√†n", "safe (adj): an to√†n", "safely (adv): m·ªôt c√°ch an to√†n", "save (v): c·ª©u/ti·∫øt ki·ªám"], s3: "S·ª≠ d·ª•ng danh t·ª´ gh√©p 'Safety equipment' (thi·∫øt b·ªã b·∫£o h·ªô/an to√†n).", s4: "T√≠nh t·ª´ 'safe' √≠t khi d√πng ƒë·ªÉ gh√©p th√†nh c·ª•m t·ª´ chuy√™n d·ª•ng n√†y." } },
            { q: "All the ________ were taken so I had to stand.", word: "SIT", options: ["seats", "seat", "sit", "sitting"], correct: 0, steps: { s1: "T·∫•t c·∫£ c√°c ch·ªó ng·ªìi ƒë·ªÅu ƒë√£ k√≠n n√™n t√¥i ph·∫£i ƒë·ª©ng.", s2: ["seats (n-s·ªë nhi·ªÅu): ch·ªó ng·ªìi", "seat (n-s·ªë √≠t): ch·ªó ng·ªìi", "sit (v): ng·ªìi", "sitting (v-ing): vi·ªác ng·ªìi"], s3: "Sau 'All the' + danh t·ª´ s·ªë nhi·ªÅu. ƒê·ªông t·ª´ 'were' c≈©ng x√°c nh·∫≠n ch·ªß ng·ªØ s·ªë nhi·ªÅu.", s4: "Seat s·ªë √≠t kh√¥ng kh·ªõp v·ªõi 'were'." } },
            { q: "There are many tourist ________ in Vietnam, such as H·ªôi An Ancient Town...", word: "attract", options: ["attractions", "attractive", "attraction", "attract"], correct: 0, steps: { s1: "C√≥ r·∫•t nhi·ªÅu ƒëi·ªÉm tham quan du l·ªãch ·ªü Vi·ªát Nam...", s2: ["attractions (n-nhi·ªÅu): ƒëi·ªÉm thu h√∫t", "attractive (adj): h·∫•p d·∫´n", "attraction (n-√≠t): s·ª± thu h√∫t", "attract (v): thu h√∫t"], s3: "C·ª•m 'tourist attractions' (ƒëi·ªÉm tham quan). Sau 'many' d√πng danh t·ª´ s·ªë nhi·ªÅu.", s4: "C√°c t·ª´ c√≤n l·∫°i sai lo·∫°i t·ª´ ho·∫∑c s·ªë l∆∞·ª£ng." } },
            { q: "________ is a big country in the north America.", word: "Canadian", options: ["Canada", "Canadian", "Canadians", "Canadas"], correct: 0, steps: { s1: "Canada l√† m·ªôt qu·ªëc gia l·ªõn ·ªü B·∫Øc M·ªπ.", s2: ["Canada (n): n∆∞·ªõc Canada", "Canadian (adj/n): ng∆∞·ªùi Canada/thu·ªôc v·ªÅ Canada", "Canadians (n): ng∆∞·ªùi Canada s·ªë nhi·ªÅu", "Canadas: (Sai)"], s3: "ƒê·ª©ng ƒë·∫ßu c√¢u l√†m ch·ªß ng·ªØ ch·ªâ m·ªôt qu·ªëc gia (country).", s4: "Canadian ch·ªâ ng∆∞·ªùi ho·∫∑c t√≠nh t·ª´, kh√¥ng thay th·∫ø t√™n n∆∞·ªõc." } },
            { q: "Louisa never does any exercise. She's ________ and feels tired all the time.", word: "FIT", options: ["unfit", "fit", "fitness", "fitted"], correct: 0, steps: { s1: "Louisa kh√¥ng bao gi·ªù t·∫≠p th·ªÉ d·ª•c. C√¥ ·∫•y kh√¥ng kh·ªèe m·∫°nh v√† th·∫•y m·ªát m·ªèi.", s2: ["unfit (adj): kh√¥ng kh·ªèe m·∫°nh", "fit (adj): c√¢n ƒë·ªëi", "fitness (n): s·ª± kh·ªèe kho·∫Øn", "fitted (v): ƒë√£ v·ª´a"], s3: "D·ª±a v√†o ng·ªØ c·∫£nh 'never does exercise' v√† 'tired' -> C·∫ßn nghƒ©a ti√™u c·ª±c.", s4: "Ti·ªÅn t·ªë 'un-' t·∫°o nghƒ©a tr√°i ng∆∞·ª£c ph√π h·ª£p ng·ªØ c·∫£nh." } },
            { q: "The most popular after-school ________ in Viet Nam are football and badminton.", word: "act", options: ["activities", "active", "action", "act"], correct: 0, steps: { s1: "C√°c ho·∫°t ƒë·ªông sau gi·ªù h·ªçc ph·ªï bi·∫øn nh·∫•t l√†...", s2: ["activities (n-nhi·ªÅu): ho·∫°t ƒë·ªông", "active (adj): nƒÉng ƒë·ªông", "action (n): h√†nh ƒë·ªông", "act (v): di·ªÖn"], s3: "Sau c·ª•m t√≠nh t·ª´ c·∫ßn danh t·ª´. 'Are' v√† danh s√°ch c√°c m√¥n ch·ªâ s·ªë nhi·ªÅu.", s4: "C√°c t·ª´ kh√°c kh√¥ng ph√π h·ª£p s·ªë l∆∞·ª£ng ho·∫∑c ng·ªØ nghƒ©a." } },
            { q: "These modern cars are equipped with ________ computers.", word: "SPEED", options: ["high-speed", "speed", "speedy", "speeding"], correct: 0, steps: { s1: "Nh·ªØng chi·∫øc xe hi·ªán ƒë·∫°i n√†y ƒë∆∞·ª£c trang b·ªã m√°y t√≠nh t·ªëc ƒë·ªô cao.", s2: ["high-speed (adj): t·ªëc ƒë·ªô cao", "speed (n): t·ªëc ƒë·ªô", "speedy (adj): nhanh ch√≥ng", "speeding (v-ing): ch·∫°y qu√° t·ªëc ƒë·ªô"], s3: "C·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho 'computers'. C·ª•m 'high-speed' l√† thu·∫≠t ng·ªØ c√¥ng ngh·ªá.", s4: "Speedy th∆∞·ªùng d√πng cho h√†nh ƒë·ªông, kh√¥ng d√πng cho th√¥ng s·ªë k·ªπ thu·∫≠t m√°y t√≠nh." } },
            { q: "Although I prepared carefully, I got nervous when giving my ________.", word: "PRESENT", options: ["presentation", "presence", "present", "presenter"], correct: 0, steps: { s1: "M·∫∑c d√π chu·∫©n b·ªã k·ªπ, t√¥i v·∫´n lo l·∫Øng khi thuy·∫øt tr√¨nh.", s2: ["presentation (n): b√†i thuy·∫øt tr√¨nh", "presence (n): s·ª± hi·ªán di·ªán", "present (v): tr√¨nh b√†y", "presenter (n): ng∆∞·ªùi thuy·∫øt tr√¨nh"], s3: "Sau t√≠nh t·ª´ s·ªü h·ªØu 'my' c·∫ßn danh t·ª´. 'Give a presentation' l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh.", s4: "Presence mang nghƒ©a kh√°c h·∫≥n." } },
            { q: "Thong Nhat Palace is a ________ attraction in Ho Chi Minh city.", word: "tour", options: ["tourist", "tourism", "tour", "touring"], correct: 0, steps: { s1: "Dinh Th·ªëng Nh·∫•t l√† m·ªôt ƒëi·ªÉm thu h√∫t kh√°ch du l·ªãch.", s2: ["tourist (n): kh√°ch du l·ªãch", "tourism (n): ng√†nh du l·ªãch", "tour (n): chuy·∫øn ƒëi", "touring (v-ing): vi·ªác ƒëi du l·ªãch"], s3: "C·ª•m 'tourist attraction' (ƒëi·ªÉm tham quan).", s4: "Tourism attraction kh√¥ng d√πng ph·ªï bi·∫øn b·∫±ng." } },
            { q: "I saw so many ________ flowers when I attended the festival last year.", word: "beauty", options: ["beautiful", "beauty", "beautifully", "beautify"], correct: 0, steps: { s1: "T√¥i th·∫•y r·∫•t nhi·ªÅu hoa ƒë·∫πp t·∫°i l·ªÖ h·ªôi.", s2: ["beautiful (adj): ƒë·∫πp", "beauty (n): v·∫ª ƒë·∫πp", "beautifully (adv): m·ªôt c√°ch ƒë·∫πp ƒë·∫Ω", "beautify (v): l√†m ƒë·∫πp"], s3: "C·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho danh t·ª´ 'flowers'.", s4: "C√°c t·ª´ c√≤n l·∫°i sai lo·∫°i t·ª´." } },
            { q: "We help the ________ with housework and gardening.", word: "old", options: ["elderly", "old", "older", "oldness"], correct: 0, steps: { s1: "Ch√∫ng t√¥i gi√∫p ƒë·ª° nh·ªØng ng∆∞·ªùi cao tu·ªïi.", s2: ["elderly (adj): cao tu·ªïi", "old (adj): gi√†", "older (adj): gi√† h∆°n", "oldness (n): s·ª± gi√† nua"], s3: "C·∫•u tr√∫c 'The + adj' ch·ªâ nh√≥m ng∆∞·ªùi. 'The elderly' l√† c√°ch g·ªçi trang tr·ªçng cho ng∆∞·ªùi gi√†.", s4: "The older th∆∞·ªùng d√πng trong so s√°nh." } },
            { q: "‚ÄòSongkran‚Äô ‚Äì Thai New Year is ________ from Vietnamese Lunar New Year.", word: "DIFFER", options: ["different", "difference", "differ", "differently"], correct: 0, steps: { s1: "L·ªÖ h·ªôi Songkran kh√°c v·ªõi T·∫øt Vi·ªát Nam.", s2: ["different (adj): kh√°c bi·ªát", "difference (n): s·ª± kh√°c nhau", "differ (v): l√†m cho kh√°c", "differently (adv): m·ªôt c√°ch kh√°c bi·ªát"], s3: "C·∫•u tr√∫c 'be different from'. Sau ƒë·ªông t·ª´ to be 'is' c·∫ßn t√≠nh t·ª´.", s4: "C√°c t·ª´ kh√°c kh√¥ng ƒëi v·ªõi c·∫•u tr√∫c 'be ... from'." } },
            { q: "This cartoon has a very funny ________. We can't stop laughing.", word: "END", options: ["ending", "end", "endless", "ended"], correct: 0, steps: { s1: "B·ªô phim ho·∫°t h√¨nh c√≥ c√°i k·∫øt r·∫•t vui nh·ªôn.", s2: ["ending (n): c√°i k·∫øt", "end (n): ƒëi·ªÉm cu·ªëi", "endless (adj): v√¥ t·∫≠n", "ended (v): ƒë√£ k·∫øt th√∫c"], s3: "C·∫ßn danh t·ª´ ch·ªâ ph·∫ßn k·∫øt th√∫c c·ªßa m·ªôt t√°c ph·∫©m ngh·ªá thu·∫≠t.", s4: "End th∆∞·ªùng ch·ªâ gi·ªõi h·∫°n v·∫≠t l√Ω ho·∫∑c th·ªùi gian chung chung." } },
            { q: "On Thanksgiving Day, it is ________ for the Americans to share a family meal.", word: "TRADITION", options: ["traditional", "tradition", "traditionally", "traditionalist"], correct: 0, steps: { s1: "V√†o ng√†y L·ªÖ T·∫° ∆†n, theo truy·ªÅn th·ªëng ng∆∞·ªùi M·ªπ s·∫Ω d√πng b·ªØa c√πng gia ƒë√¨nh.", s2: ["traditional (adj): thu·ªôc v·ªÅ truy·ªÅn th·ªëng", "tradition (n): truy·ªÅn th·ªëng", "traditionally (adv): theo truy·ªÅn th·ªëng", "traditionalist (n): ng∆∞·ªùi th·ªß c·ª±u"], s3: "C·∫•u tr√∫c 'It is + adj + for someone to do something'.", s4: "C·∫ßn m·ªôt t√≠nh t·ª´ ·ªü v·ªã tr√≠ n√†y." } },
            { q: "In my English class, we have to give ________ about various topics.", word: "PRESENT", options: ["presentations", "presentation", "present", "presence"], correct: 0, steps: { s1: "Trong l·ªõp ti·∫øng Anh, ch√∫ng t√¥i ph·∫£i thuy·∫øt tr√¨nh v·ªÅ nhi·ªÅu ch·ªß ƒë·ªÅ.", s2: ["presentations (n-s·ªë nhi·ªÅu): b√†i thuy·∫øt tr√¨nh", "presentation (n-s·ªë √≠t): b√†i thuy·∫øt tr√¨nh", "present (v): tr√¨nh b√†y", "presence (n): s·ª± hi·ªán di·ªán"], s3: "C·ª•m 'give presentations'. V√¨ n√≥i v·ªÅ 'various topics' n√™n d√πng s·ªë nhi·ªÅu.", s4: "N·∫øu d√πng s·ªë √≠t ph·∫£i c√≥ 'a' (a presentation)." } },
            { q: "Cutting down trees destroys the environment of many ________ animals.", word: "DANGER", options: ["endangered", "dangerous", "danger", "endanger"], correct: 0, steps: { s1: "Vi·ªác ch·∫∑t c√¢y ph√° h·ªßy m√¥i tr∆∞·ªùng c·ªßa nhi·ªÅu lo√†i ƒë·ªông v·∫≠t c√≥ nguy c∆° tuy·ªát ch·ªßng.", s2: ["endangered (adj): c√≥ nguy c∆° tuy·ªát ch·ªßng", "dangerous (adj): nguy hi·ªÉm", "danger (n): s·ª± nguy hi·ªÉm", "endanger (v): g√¢y nguy hi·ªÉm"], s3: "C·ª•m t·ª´ c·ªë ƒë·ªãnh 'endangered animals'.", s4: "Dangerous animals l√† ƒë·ªông v·∫≠t hung d·ªØ, kh√¥ng h·ª£p ng·ªØ c·∫£nh b·∫£o v·ªá m√¥i tr∆∞·ªùng." } },
            { q: "Meats and fish are ________ used in all Vietnamese cooking.", word: "common", options: ["commonly", "common", "commonness", "uncommon"], correct: 0, steps: { s1: "Th·ªãt v√† c√° ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·ªï bi·∫øn trong n·∫•u ƒÉn Vi·ªát Nam.", s2: ["commonly (adv): m·ªôt c√°ch ph·ªï bi·∫øn", "common (adj): ph·ªï bi·∫øn", "commonness (n): s·ª± b√¨nh th∆∞·ªùng", "uncommon (adj): hi·∫øm th·∫•y"], s3: "C·∫ßn tr·∫°ng t·ª´ b·ªï nghƒ©a cho ƒë·ªông t·ª´ 'used'.", s4: "T√≠nh t·ª´ kh√¥ng ƒë·ª©ng tr∆∞·ªõc ph√¢n t·ª´ hai ƒë·ªÉ b·ªï nghƒ©a theo c√°ch n√†y." } },
            { q: "Make a ________ to charity projects.", word: "DONATE", options: ["donation", "donate", "donor", "donating"], correct: 0, steps: { s1: "H√£y th·ª±c hi·ªán m·ªôt kho·∫£n quy√™n g√≥p cho c√°c d·ª± √°n t·ª´ thi·ªán.", s2: ["donation (n): s·ª± quy√™n g√≥p", "donate (v): quy√™n g√≥p", "donor (n): ng∆∞·ªùi quy√™n g√≥p", "donating (v-ing): vi·ªác quy√™n g√≥p"], s3: "C·∫•u tr√∫c 'Make a donation' (Quy√™n g√≥p).", s4: "Donor l√† ng∆∞·ªùi, kh√¥ng ƒëi v·ªõi 'make a'." } },
            { q: "She's a professional ________.", word: "photograph", options: ["photographer", "photography", "photograph", "photographic"], correct: 0, steps: { s1: "C√¥ ·∫•y l√† m·ªôt nhi·∫øp ·∫£nh gia chuy√™n nghi·ªáp.", s2: ["photographer (n): nhi·∫øp ·∫£nh gia", "photography (n): ngh·ªÅ nhi·∫øp ·∫£nh", "photograph (n): b·ª©c ·∫£nh", "photographic (adj): thu·ªôc v·ªÅ ·∫£nh"], s3: "Sau m·∫°o t·ª´ v√† t√≠nh t·ª´ c·∫ßn danh t·ª´ ch·ªâ ng∆∞·ªùi nghi·ªáp nghi·ªáp.", s4: "C√°c t·ª´ kh√°c ch·ªâ v·∫≠t ho·∫∑c t√≠nh ch·∫•t." } },
            { q: "Wind will be used as an ________ friendly source of energy.", word: "environment", options: ["environmentally", "environmental", "environment", "environmentalist"], correct: 0, steps: { s1: "Gi√≥ s·∫Ω ƒë∆∞·ª£c d√πng nh∆∞ ngu·ªìn nƒÉng l∆∞·ª£ng th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng.", s2: ["environmentally (adv): v·ªÅ m·∫∑t m√¥i tr∆∞·ªùng", "environmental (adj): thu·ªôc v·ªÅ m√¥i tr∆∞·ªùng", "environment (n): m√¥i tr∆∞·ªùng", "environmentalist (n): nh√† m√¥i tr∆∞·ªùng"], s3: "C·ª•m t·ª´ 'environmentally friendly' (th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng).", s4: "Tr·∫°ng t·ª´ b·ªï nghƒ©a cho t√≠nh t·ª´ 'friendly'." } }
        ];

        let currentQIndex = 0;
        let score = 0;
        let shuffledQuestions = [];

        function playSound(type) {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = context.createOscillator();
            const gain = context.createGain();
            oscillator.connect(gain);
            gain.connect(context.destination);

            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, context.currentTime); 
                oscillator.frequency.exponentialRampToValueAtTime(880, context.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, context.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
            } else {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(200, context.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, context.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, context.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
            }
            oscillator.start();
            oscillator.stop(context.currentTime + 0.3);
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initQuiz() {
            // 1. Shuffle the main question list
            shuffledQuestions = shuffle([...rawData]);

            // 2. For each question, shuffle its options and update 'correct' index
            shuffledQuestions.forEach(q => {
                const correctAnswerText = q.options[q.correct];
                q.options = shuffle([...q.options]);
                q.correct = q.options.indexOf(correctAnswerText);
            });

            currentQIndex = 0;
            score = 0;
            document.getElementById('current-score').innerText = score;
            showQuestion();
        }

        function showQuestion() {
            const qData = shuffledQuestions[currentQIndex];
            const mainQ = document.getElementById('main-question');
            const optionsList = document.getElementById('options-list');
            const expBox = document.getElementById('explanation-box');
            const btnNext = document.getElementById('btn-next');

            expBox.style.display = 'none';
            btnNext.style.display = 'none';
            optionsList.innerHTML = '';
            
            mainQ.innerHTML = qData.q.replace("________", `<span class="text-[var(--primary)] border-b-4 border-dashed border-[var(--primary)] px-4">?</span>`) + 
                            `<br><small class="text-gray-400 italic">Word g·ªëc: (${qData.word})</small>`;

            qData.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span class="word-tag">${String.fromCharCode(65 + idx)}</span> ${opt}`;
                btn.onclick = () => checkAnswer(idx, btn);
                optionsList.appendChild(btn);
            });

            const progress = ((currentQIndex) / shuffledQuestions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        function checkAnswer(selectedIdx, btnElement) {
            const qData = shuffledQuestions[currentQIndex];
            const options = document.querySelectorAll('.option-btn');
            const expBox = document.getElementById('explanation-box');
            const expContent = document.getElementById('explanation-content');
            const btnNext = document.getElementById('btn-next');

            options.forEach(btn => btn.disabled = true);

            if (selectedIdx === qData.correct) {
                btnElement.classList.add('correct');
                score++;
                document.getElementById('current-score').innerText = score;
                playSound('correct');
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8854C0', '#00C9A7', '#FFD700']
                });
            } else {
                btnElement.classList.add('wrong');
                document.getElementById('question-card').classList.add('shake');
                setTimeout(() => document.getElementById('question-card').classList.remove('shake'), 500);
                playSound('wrong');
                options[qData.correct].classList.add('correct');
            }

            expBox.style.display = 'block';
            btnNext.style.display = 'inline-block';

            expContent.innerHTML = `
                <div class="text-[#2d3436]">
                    <span class="step-title">1. D·ªãch c√¢u h·ªèi:</span>
                    <p class="italic text-lg mb-2">"${qData.steps.s1}"</p>
                    
                    <span class="step-title">2. Ph√¢n t√≠ch 4 ƒë√°p √°n:</span>
                    <div class="bg-white rounded-xl p-4 my-2 border border-purple-100">
                        <ul class="space-y-1">
                            ${qData.options.map((opt, i) => {
                                // Find the original rationale for this specific word
                                let rationale = qData.steps.s2.find(r => r.startsWith(opt)) || "T·ª´ lo·∫°i kh√°c.";
                                return `<li class="${i === qData.correct ? 'font-bold text-green-600' : ''}">
                                            <span class="word-tag">${String.fromCharCode(65 + i)}</span> ${rationale}
                                        </li>`;
                            }).join('')}
                        </ul>
                    </div>

                    <span class="step-title">3. T·∫°i sao ch·ªçn ${String.fromCharCode(65 + qData.correct)}?</span>
                    <p class="bg-green-50 p-3 rounded-lg border-l-4 border-green-500">${qData.steps.s3}</p>

                    <span class="step-title">4. T·∫°i sao c√°c ƒë√°p √°n kh√°c sai?</span>
                    <p class="bg-red-50 p-3 rounded-lg border-l-4 border-red-400">${qData.steps.s4}</p>
                    
                    <div class="mt-6 pt-4 border-t border-purple-200 text-sm font-bold text-[var(--primary)] flex items-center">
                        <span class="text-2xl mr-2">üë©‚Äçüè´</span> Ms Mai An: H√£y nh·ªõ k·ªπ lo·∫°i t·ª´ c·∫ßn ƒëi·ªÅn d·ª±a v√†o c√°c t·ª´ ƒë·ª©ng tr∆∞·ªõc v√† sau ch·ªó tr·ªëng nh√©!
                    </div>
                </div>
            `;
            
            expBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < shuffledQuestions.length) {
                showQuestion();
            } else {
                showSummary();
            }
        }

        function showSummary() {
            const overlay = document.getElementById('overlay');
            const popup = document.getElementById('summary-popup');
            const finalScore = document.getElementById('final-score');
            const feedback = document.getElementById('feedback-msg');

            overlay.style.display = 'block';
            popup.style.display = 'block';
            finalScore.innerText = `${score}/${shuffledQuestions.length}`;

            const percent = (score / shuffledQuestions.length) * 100;
            if (percent === 100) feedback.innerText = "Tuy·ªát v·ªùi! Em l√† thi√™n t√†i Word Form r·ªìi ƒë·∫•y! üèÜ";
            else if (percent >= 80) feedback.innerText = "R·∫•t t·ªët! Em ch·ªâ sai m·ªôt ch√∫t th√¥i, c·ªë g·∫Øng ph√°t huy nh√©! ‚ú®";
            else if (percent >= 50) feedback.innerText = "Kh√° t·ªët! H√£y xem k·ªπ l·∫°i c√°c ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥ ƒë·ªÉ n·∫Øm v·ªØng h∆°n. üí™";
            else feedback.innerText = "ƒê·ª´ng bu·ªìn nh√©! H·ªçc ti·∫øng Anh l√† m·ªôt h√†nh tr√¨nh, h√£y l√†m l·∫°i ƒë·ªÉ nh·ªõ t·ª´ v·ª±ng h∆°n n√†o! ‚ù§Ô∏è";

            confetti({ particleCount: 200, spread: 160, origin: { y: 0.6 } });
        }

        window.onload = initQuiz;
    </script>
</body>
</html>
