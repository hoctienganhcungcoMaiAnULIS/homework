<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 12: Our Tet Holiday - Ms Mai An ULIS</title>
    <style>
        :root {
            --primary: #0056b3; /* Xanh dương đậm */
            --primary-light: #e7f1ff;
            --success: #28a745; /* Xanh lá */
            --danger: #dc3545; /* Đỏ */
            --warning: #ffc107; /* Vàng */
            --text: #333;
            --bg: #f4f6f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* Header */
        header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 3px solid var(--primary);
        }

        .header-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.2rem;
            margin: 0;
            color: var(--primary);
        }

        .teacher-name {
            font-size: 0.85rem;
            color: #666;
            font-weight: 600;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px 80px 15px; /* Bottom padding for sticky footer */
        }

        /* Section Title */
        .section-title {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Question Card */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 5px solid transparent;
            transition: all 0.3s ease;
        }

        .card.correct { border-left-color: var(--success); }
        .card.incorrect { border-left-color: var(--danger); }

        .question-number {
            font-weight: bold;
            color: var(--primary);
            margin-right: 5px;
        }

        .question-text {
            font-size: 1.05rem;
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            font-weight: 600;
        }

        .option-btn.correct-answer {
            border-color: var(--success);
            background: #d4edda;
            color: #155724;
        }

        .option-btn.wrong-answer {
            border-color: var(--danger);
            background: #f8d7da;
            color: #721c24;
        }

        /* Input for Reordering */
        .text-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .text-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Explanation Box */
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            display: none; /* Hidden by default */
            font-size: 0.95rem;
        }
        
        .explanation h4 {
            margin-top: 0;
            color: #856404;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .exp-detail p {
            margin: 5px 0;
        }
        
        .vocab-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        
        .vocab-list li {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        .vocab-list li::before {
            content: "•";
            color: var(--primary);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* Action Buttons */
        .check-btn {
            margin-top: 15px;
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        .check-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Sticky Footer */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 1000;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,86,179,0.3);
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            background: #004494;
        }

        .score-display {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary);
        }

        /* Result Popup */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal h2 { color: var(--primary); }
        .modal-score { font-size: 3rem; color: var(--success); margin: 10px 0; font-weight: bold; }
        .close-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 15px;
        }

        /* Helpers */
        .highlight { font-weight: bold; color: var(--primary); }
        .red-text { color: var(--danger); text-decoration: line-through; }
        .green-text { color: var(--success); font-weight: bold; }

    </style>
</head>
<body>

<header>
    <div class="header-content">
        <h1>BÀI KIỂM TRA: UNIT 12 - OUR TET HOLIDAY</h1>
        <span class="teacher-name">Giáo viên tạo: Ms Mai An ULIS</span>
    </div>
</header>

<div class="container" id="quiz-container">
    </div>

<div class="sticky-footer">
    <div id="live-score" class="score-display" style="display:none;">0/40</div>
    <button class="submit-btn" onclick="submitAll()">NỘP BÀI</button>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h2>KẾT QUẢ BÀI LÀM</h2>
        <p>Bạn đã hoàn thành bài kiểm tra!</p>
        <div class="modal-score" id="final-score">0/40</div>
        <p id="feedback-text">Hãy xem lại chi tiết lời giải bên dưới nhé.</p>
        <button class="close-btn" onclick="closeModal()">Xem chi tiết giải thích</button>
    </div>
</div>

<script>
    // Dữ liệu bài thi
    const quizData = [
        // --- PHẦN 1: ODD ONE OUT ---
        {
            id: 1, section: "PHẦN 1: CHỌN TỪ KHÁC LOẠI (ODD ONE OUT)", type: "mcq",
            question: "Chọn từ không cùng nhóm với các từ còn lại:",
            options: ["apricot blossom", "peach blossom", "rose", "fireworks"],
            answer: 3, // D
            explanation: `
                <strong>Đáp án: D. fireworks</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. apricot blossom (n): Hoa mai</li>
                    <li>B. peach blossom (n): Hoa đào</li>
                    <li>C. rose (n): Hoa hồng</li>
                    <li>D. fireworks (n): Pháo hoa</li>
                </ul>
                <span class="highlight">Giải thích:</span> A, B, C đều là tên các loài hoa. D là đồ vật/hoạt động giải trí (pháo hoa).
            `
        },
        {
            id: 2, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["decorate", "celebrate", "beautiful", "clean"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. beautiful</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. decorate (v): Trang trí</li>
                    <li>B. celebrate (v): Ăn mừng, kỷ niệm</li>
                    <li>C. beautiful (adj): Xinh đẹp</li>
                    <li>D. clean (v): Dọn dẹp</li>
                </ul>
                <span class="highlight">Giải thích:</span> C là Tính từ (Adjective), trong khi A, B, D đều là Động từ (Verb).
            `
        },
        {
            id: 3, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["pagoda", "temple", "countryside", "relative"],
            answer: 3, // D
            explanation: `
                <strong>Đáp án: D. relative</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. pagoda (n): Chùa</li>
                    <li>B. temple (n): Đền</li>
                    <li>C. countryside (n): Miền quê</li>
                    <li>D. relative (n): Họ hàng/Người thân</li>
                </ul>
                <span class="highlight">Giải thích:</span> D chỉ người. A, B, C là danh từ chỉ địa điểm (Places).
            `
        },
        {
            id: 4, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["delicious", "important", "lucky", "festival"],
            answer: 3, // D
            explanation: `
                <strong>Đáp án: D. festival</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. delicious (adj): Ngon miệng</li>
                    <li>B. important (adj): Quan trọng</li>
                    <li>C. lucky (adj): May mắn</li>
                    <li>D. festival (n): Lễ hội</li>
                </ul>
                <span class="highlight">Giải thích:</span> D là Danh từ. A, B, C là Tính từ miêu tả.
            `
        },
        {
            id: 5, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["banh chung", "spring rolls", "shopping", "seafood"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. shopping</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. banh chung (n): Bánh chưng</li>
                    <li>B. spring rolls (n): Nem rán</li>
                    <li>C. shopping (n/v): Việc mua sắm</li>
                    <li>D. seafood (n): Hải sản</li>
                </ul>
                <span class="highlight">Giải thích:</span> C là hoạt động. A, B, D là tên các loại đồ ăn (Food).
            `
        },
        {
            id: 6, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["always", "often", "usually", "will"],
            answer: 3, // D
            explanation: `
                <strong>Đáp án: D. will</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. always (adv): Luôn luôn</li>
                    <li>B. often (adv): Thường xuyên</li>
                    <li>C. usually (adv): Thường thường</li>
                    <li>D. will (modal verb): Sẽ</li>
                </ul>
                <span class="highlight">Giải thích:</span> D là trợ động từ chỉ tương lai. A, B, C là Trạng từ chỉ tần suất (Adverbs of Frequency).
            `
        },
        {
            id: 7, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["buy", "bring", "went", "plant"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. went</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. buy (v): Mua (nguyên mẫu)</li>
                    <li>B. bring (v): Mang (nguyên mẫu)</li>
                    <li>C. went (v): Đã đi (Quá khứ của 'go')</li>
                    <li>D. plant (v): Trồng (nguyên mẫu)</li>
                </ul>
                <span class="highlight">Giải thích:</span> C chia ở thì Quá khứ đơn (V2). A, B, D là động từ nguyên mẫu (V-inf).
            `
        },
        {
            id: 8, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["grandparents", "teacher", "cousins", "parents"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. teacher</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. grandparents (n): Ông bà</li>
                    <li>B. teacher (n): Giáo viên</li>
                    <li>C. cousins (n): Anh chị em họ</li>
                    <li>D. parents (n): Bố mẹ</li>
                </ul>
                <span class="highlight">Giải thích:</span> B là nghề nghiệp. A, C, D là các thành viên trong gia đình (Family members).
            `
        },
        {
            id: 9, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["summer", "Tet", "Christmas", "New Year"],
            answer: 0, // A
            explanation: `
                <strong>Đáp án: A. summer</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. summer (n): Mùa hè</li>
                    <li>B. Tet (n): Tết</li>
                    <li>C. Christmas (n): Giáng sinh</li>
                    <li>D. New Year (n): Năm mới</li>
                </ul>
                <span class="highlight">Giải thích:</span> A là một mùa trong năm. B, C, D là các lễ hội/dịp lễ (Holidays/Festivals).
            `
        },
        {
            id: 10, section: "PHẦN 1", type: "mcq",
            question: "Chọn từ không cùng nhóm:",
            options: ["cleaning", "decorating", "spring", "shopping"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. spring</strong><br>
                <em>Giải thích chi tiết:</em>
                <ul class="vocab-list">
                    <li>A. cleaning: Việc dọn dẹp</li>
                    <li>B. decorating: Việc trang trí</li>
                    <li>C. spring: Mùa xuân</li>
                    <li>D. shopping: Việc mua sắm</li>
                </ul>
                <span class="highlight">Giải thích:</span> C là danh từ chỉ mùa. A, B, D là danh động từ (V-ing) chỉ hoạt động.
            `
        },

        // --- PHẦN 2: MULTIPLE CHOICE ---
        {
            id: 11, section: "PHẦN 2: TRẮC NGHIỆM (MULTIPLE CHOICE)", type: "mcq",
            question: "My father buys a big ________ of apricot blossoms for Tet.",
            options: ["tree", "branch", "flower", "leaf"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. branch</strong><br>
                <em>Dịch câu:</em> Bố tôi mua một cành hoa mai lớn cho dịp Tết.<br>
                <em>Phân tích:</em>
                <ul class="vocab-list">
                    <li>A. tree: cây (cả cây to)</li>
                    <li>B. branch: cành/nhánh cây</li>
                    <li>C. flower: bông hoa</li>
                    <li>D. leaf: chiếc lá</li>
                </ul>
                <span class="highlight">Collocation:</span> Người ta thường dùng "a branch of apricot/peach blossoms" (một cành đào/mai) để chưng trong nhà.
            `
        },
        {
            id: 12, section: "PHẦN 2", type: "mcq",
            question: "We ________ our house with many red things to get good luck.",
            options: ["clean", "plant", "decorate", "make"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. decorate</strong><br>
                <em>Dịch câu:</em> Chúng tôi trang trí nhà cửa với nhiều đồ màu đỏ để lấy may.<br>
                <span class="highlight">Cấu trúc:</span> decorate something with something (trang trí cái gì bằng cái gì).
            `
        },
        {
            id: 13, section: "PHẦN 2", type: "mcq",
            question: "Will you ________ your relatives this holiday?",
            options: ["visit", "visiting", "visited", "visits"],
            answer: 0, // A
            explanation: `
                <strong>Đáp án: A. visit</strong><br>
                <em>Dịch câu:</em> Bạn sẽ đi thăm họ hàng vào kỳ nghỉ này chứ?<br>
                <span class="highlight">Ngữ pháp:</span> Sau "Will" luôn là động từ nguyên mẫu (V-infinitive).<br>
                Công thức: Will + S + V(nguyên thể)?
            `
        },
        {
            id: 14, section: "PHẦN 2", type: "mcq",
            question: "Tet is the most ________ festival in Vietnam.",
            options: ["delicious", "important", "cold", "small"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. important</strong><br>
                <em>Dịch câu:</em> Tết là lễ hội quan trọng nhất ở Việt Nam.<br>
                <em>Phân tích:</em>
                <ul>
                    <li>Delicious: ngon (dùng cho đồ ăn)</li>
                    <li>Important: quan trọng (phù hợp ngữ cảnh)</li>
                    <li>Cold: lạnh</li>
                    <li>Small: nhỏ</li>
                </ul>
            `
        },
        {
            id: 15, section: "PHẦN 2", type: "mcq",
            question: "My mother often makes ________ and banh chung at Tet.",
            options: ["fireworks", "spring rolls", "roses", "clothes"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. spring rolls</strong><br>
                <em>Dịch câu:</em> Mẹ tôi thường làm nem rán và bánh chưng vào dịp Tết.<br>
                <em>Giải thích:</em> "Make" (làm) đi với đồ ăn. Fireworks (pháo hoa), Roses (hoa), Clothes (quần áo) không hợp lý với động từ "make" trong ngữ cảnh món ăn ngày Tết.
            `
        },
        {
            id: 16, section: "PHẦN 2", type: "mcq",
            question: "\"Will you watch fireworks tonight?\" - \"No, I ________.\"",
            options: ["don't", "won't", "am not", "doesn't"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. won't</strong><br>
                <em>Giải thích:</em> Câu hỏi bắt đầu bằng "Will", câu trả lời ngắn phủ định là "No, S + will not (won't)".<br>
                A. don't (dùng cho thì hiện tại thường).<br>
                C. am not (dùng cho thì hiện tại tiếp diễn).
            `
        },
        {
            id: 17, section: "PHẦN 2", type: "mcq",
            question: "Where ________ you go at Tet? - I'll go to the pagoda.",
            options: ["do", "are", "will", "did"],
            answer: 2, // C
            explanation: `
                <strong>Đáp án: C. will</strong><br>
                <em>Dịch câu:</em> Bạn sẽ đi đâu vào dịp Tết? - Tôi sẽ đi chùa.<br>
                <em>Giải thích:</em> Câu trả lời dùng "I'll" (I will) -> Câu hỏi phải dùng thì tương lai với "Will".
            `
        },
        {
            id: 18, section: "PHẦN 2", type: "mcq",
            question: "It will bring good luck ________ your family.",
            options: ["to", "for", "with", "at"],
            answer: 0, // A
            explanation: `
                <strong>Đáp án: A. to</strong><br>
                <em>Dịch câu:</em> Nó sẽ mang lại may mắn cho gia đình bạn.<br>
                <span class="highlight">Cấu trúc:</span> Bring something TO somebody (Mang cái gì đến cho ai).
            `
        },
        {
            id: 19, section: "PHẦN 2", type: "mcq",
            question: "We often go to the ________ to pray for a happy new year.",
            options: ["market", "pagoda", "cinema", "school"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. pagoda</strong><br>
                <em>Dịch câu:</em> Chúng tôi thường đi chùa để cầu nguyện cho một năm mới hạnh phúc.<br>
                <em>Từ khóa:</em> "pray" (cầu nguyện) -> Địa điểm phù hợp nhất là chùa (pagoda).
            `
        },
        {
            id: 20, section: "PHẦN 2", type: "mcq",
            question: "People should ________ trees in the spring.",
            options: ["buy", "plant", "eat", "watch"],
            answer: 1, // B
            explanation: `
                <strong>Đáp án: B. plant</strong><br>
                <em>Dịch câu:</em> Mọi người nên trồng cây vào mùa xuân.<br>
                <span class="highlight">Collocation:</span> Plant trees (Trồng cây). Đây là phong tục "Tết trồng cây".
            `
        },

        // --- PHẦN 3: ERROR IDENTIFICATION ---
        {
            id: 21, section: "PHẦN 3: TÌM LỖI SAI (ERROR IDENTIFICATION)", type: "mcq",
            question: "Tìm từ bị sai trong câu sau: \"I <b>will going</b> to my grandparents' house next week.\"",
            options: ["I", "will", "going", "week"],
            answer: 2, // going
            explanation: `
                <strong>Lỗi sai: going</strong><br>
                <em>Sửa lại:</em> <strong>go</strong><br>
                <em>Giải thích:</em> Sau trợ động từ "will" phải là động từ nguyên thể (V-infinitive). Không dùng V-ing.
            `
        },
        {
            id: 22, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"My sister usually <b>do</b> the shopping before Tet.\"",
            options: ["My", "usually", "do", "before"],
            answer: 2, // do
            explanation: `
                <strong>Lỗi sai: do</strong><br>
                <em>Sửa lại:</em> <strong>does</strong><br>
                <em>Giải thích:</em> Chủ ngữ "My sister" là ngôi thứ 3 số ít, nên động từ "do" phải chia là "does" ở thì hiện tại đơn.
            `
        },
        {
            id: 23, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"My house has a branch <b>with</b> peach blossoms.\"",
            options: ["has", "branch", "with", "blossoms"],
            answer: 2, // with
            explanation: `
                <strong>Lỗi sai: with</strong><br>
                <em>Sửa lại:</em> <strong>of</strong><br>
                <em>Giải thích:</em> Cụm từ đúng là "A branch OF peach blossoms" (Một cành đào). Dùng 'of' để chỉ thành phần/chất liệu.
            `
        },
        {
            id: 24, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"We will have a party with a lot of <b>food delicious</b>.\"",
            options: ["will", "party", "food delicious", "lot"],
            answer: 2, // food delicious
            explanation: `
                <strong>Lỗi sai: food delicious</strong><br>
                <em>Sửa lại:</em> <strong>delicious food</strong><br>
                <em>Giải thích:</em> Trong tiếng Anh, Tính từ (Adjective) phải đứng TRƯỚC Danh từ (Noun) để bổ nghĩa. <br>Delicious (adj) + Food (n).
            `
        },
        {
            id: 25, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"Will you <b>watches</b> the fireworks show with me?\"",
            options: ["Will", "you", "watches", "show"],
            answer: 2, // watches
            explanation: `
                <strong>Lỗi sai: watches</strong><br>
                <em>Sửa lại:</em> <strong>watch</strong><br>
                <em>Giải thích:</em> Trong câu hỏi với "Will", động từ chính phải ở dạng nguyên thể. "Will you watch...?".
            `
        },
        {
            id: 26, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"They will visit their relatives <b>in</b> Tet holiday.\"",
            options: ["will", "visit", "in", "holiday"],
            answer: 2, // in
            explanation: `
                <strong>Lỗi sai: in</strong><br>
                <em>Sửa lại:</em> <strong>at</strong><br>
                <em>Giải thích:</em> Dùng giới từ "AT" cho các dịp lễ hội: At Tet, At Christmas.
            `
        },
        {
            id: 27, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"Does your brother <b>cleans</b> the house today?\"",
            options: ["Does", "brother", "cleans", "today"],
            answer: 2, // cleans
            explanation: `
                <strong>Lỗi sai: cleans</strong><br>
                <em>Sửa lại:</em> <strong>clean</strong><br>
                <em>Giải thích:</em> Trong câu hỏi thì hiện tại đơn đã mượn trợ động từ "Does", động từ chính phải trở về dạng nguyên thể (Clean).
            `
        },
        {
            id: 28, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"My mother will <b>buys</b> some new clothes for me.\"",
            options: ["mother", "will", "buys", "clothes"],
            answer: 2, // buys
            explanation: `
                <strong>Lỗi sai: buys</strong><br>
                <em>Sửa lại:</em> <strong>buy</strong><br>
                <em>Giải thích:</em> Sau "Will" không chia động từ (không thêm s/es). Phải dùng "Will buy".
            `
        },
        {
            id: 29, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"I am <b>go</b> shopping to buy things for Tet.\"",
            options: ["am", "go", "shopping", "things"],
            answer: 1, // go
            explanation: `
                <strong>Lỗi sai: go</strong><br>
                <em>Sửa lại:</em> <strong>going</strong><br>
                <em>Giải thích:</em> Cấu trúc thì hiện tại tiếp diễn: S + am/is/are + V-ing. -> "I am going..."
            `
        },
        {
            id: 30, section: "PHẦN 3", type: "mcq",
            question: "Tìm từ bị sai: \"Peach blossoms <b>brings</b> good luck to people.\"",
            options: ["Peach", "blossoms", "brings", "people"],
            answer: 2, // brings
            explanation: `
                <strong>Lỗi sai: brings</strong><br>
                <em>Sửa lại:</em> <strong>bring</strong><br>
                <em>Giải thích:</em> Chủ ngữ "Peach blossoms" (Hoa đào) là danh từ số nhiều (có s), nên động từ "bring" phải để nguyên thể, không thêm s.
            `
        },

        // --- PHẦN 4: SENTENCE REORDERING ---
        {
            id: 31, section: "PHẦN 4: SẮP XẾP CÂU (SENTENCE REORDERING)", type: "text",
            question: "Sắp xếp các từ sau thành câu hoàn chỉnh:<br><code>will / Where / you / go / Tet / at / ?</code>",
            validAnswers: ["where will you go at tet", "where will you go at tet?"],
            displayAnswer: "Where will you go at Tet?",
            explanation: `
                <strong>Đáp án: Where will you go at Tet?</strong><br>
                <em>Dịch:</em> Bạn sẽ đi đâu vào dịp Tết?<br>
                <span class="highlight">Cấu trúc:</span> Wh-word (Where) + will + S (you) + V (go) + ...?
            `
        },
        {
            id: 32, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>decorate / We / will / house / our / flowers / with / .</code>",
            validAnswers: ["we will decorate our house with flowers", "we will decorate our house with flowers."],
            displayAnswer: "We will decorate our house with flowers.",
            explanation: `
                <strong>Đáp án: We will decorate our house with flowers.</strong><br>
                <em>Dịch:</em> Chúng tôi sẽ trang trí nhà bằng hoa.<br>
                <span class="highlight">Cấu trúc:</span> S + will + V + O + with...
            `
        },
        {
            id: 33, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>often / My / mother / shopping / does / the / before / Tet / .</code>",
            validAnswers: ["my mother often does the shopping before tet", "my mother often does the shopping before tet."],
            displayAnswer: "My mother often does the shopping before Tet.",
            explanation: `
                <strong>Đáp án: My mother often does the shopping before Tet.</strong><br>
                <em>Dịch:</em> Mẹ tôi thường đi mua sắm trước Tết.<br>
                <span class="highlight">Lưu ý:</span> Trạng từ tần suất "often" đứng trước động từ thường "does".
            `
        },
        {
            id: 34, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>buy / Will / a / you / branch / of / blossoms / peach / ?</code>",
            validAnswers: ["will you buy a branch of peach blossoms", "will you buy a branch of peach blossoms?"],
            displayAnswer: "Will you buy a branch of peach blossoms?",
            explanation: `
                <strong>Đáp án: Will you buy a branch of peach blossoms?</strong><br>
                <em>Dịch:</em> Bạn sẽ mua một cành đào chứ?<br>
                <span class="highlight">Cụm từ:</span> a branch of peach blossoms.
            `
        },
        {
            id: 35, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>go / I / will / the / countryside / to / visit / to / my / grandparents / .</code>",
            validAnswers: ["i will go to the countryside to visit my grandparents", "i will go to the countryside to visit my grandparents."],
            displayAnswer: "I will go to the countryside to visit my grandparents.",
            explanation: `
                <strong>Đáp án: I will go to the countryside to visit my grandparents.</strong><br>
                <em>Dịch:</em> Tôi sẽ về quê để thăm ông bà.<br>
                <span class="highlight">Cấu trúc:</span> go to [place] to [verb] (đi đâu để làm gì).
            `
        },
        {
            id: 36, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>watch / we / fireworks / Will / show / a / New / Year's / Eve / on / ?</code>",
            validAnswers: ["will we watch a fireworks show on new year's eve", "will we watch a fireworks show on new year's eve?"],
            displayAnswer: "Will we watch a fireworks show on New Year's Eve?",
            explanation: `
                <strong>Đáp án: Will we watch a fireworks show on New Year's Eve?</strong><br>
                <em>Dịch:</em> Chúng ta sẽ xem pháo hoa vào đêm Giao thừa chứ?<br>
                <span class="highlight">Từ vựng:</span> New Year's Eve (Đêm Giao thừa).
            `
        },
        {
            id: 37, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>is / cleaning / Lisa / floor / the / now / .</code>",
            validAnswers: ["lisa is cleaning the floor now", "lisa is cleaning the floor now."],
            displayAnswer: "Lisa is cleaning the floor now.",
            explanation: `
                <strong>Đáp án: Lisa is cleaning the floor now.</strong><br>
                <em>Dịch:</em> Lisa đang lau nhà bây giờ.<br>
                <span class="highlight">Thì:</span> Hiện tại tiếp diễn (is + V-ing) vì có "now".
            `
        },
        {
            id: 38, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>important / Tet / the / is / most / festival / Vietnam / in / .</code>",
            validAnswers: ["tet is the most important festival in vietnam", "tet is the most important festival in vietnam."],
            displayAnswer: "Tet is the most important festival in Vietnam.",
            explanation: `
                <strong>Đáp án: Tet is the most important festival in Vietnam.</strong><br>
                <em>Dịch:</em> Tết là lễ hội quan trọng nhất ở Việt Nam.<br>
                <span class="highlight">So sánh nhất:</span> The most + adj dài (important).
            `
        },
        {
            id: 39, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>not / I / will / flowers / buy / plastic / .</code>",
            validAnswers: ["i will not buy plastic flowers", "i will not buy plastic flowers."],
            displayAnswer: "I will not buy plastic flowers.",
            explanation: `
                <strong>Đáp án: I will not buy plastic flowers.</strong><br>
                <em>Dịch:</em> Tôi sẽ không mua hoa nhựa.<br>
                <span class="highlight">Câu phủ định:</span> S + will + not + V.
            `
        },
        {
            id: 40, section: "PHẦN 4", type: "text",
            question: "Sắp xếp các từ sau:<br><code>bring / It / good / will / luck / your / to / family / .</code>",
            validAnswers: ["it will bring good luck to your family", "it will bring good luck to your family."],
            displayAnswer: "It will bring good luck to your family.",
            explanation: `
                <strong>Đáp án: It will bring good luck to your family.</strong><br>
                <em>Dịch:</em> Nó sẽ mang lại may mắn cho gia đình bạn.<br>
                <span class="highlight">Cấu trúc:</span> Bring good luck to...
            `
        }
    ];

    const quizContainer = document.getElementById('quiz-container');
    const liveScore = document.getElementById('live-score');
    let userAnswers = new Array(quizData.length).fill(null);

    // Render câu hỏi
    function renderQuiz() {
        let currentSection = "";
        
        quizData.forEach((item, index) => {
            // Thêm tiêu đề Section nếu thay đổi
            if (item.section !== currentSection) {
                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = item.section;
                quizContainer.appendChild(sectionTitle);
                currentSection = item.section;
            }

            const card = document.createElement('div');
            card.className = 'card';
            card.id = `q-card-${index}`;

            // Tạo nội dung câu hỏi
            let inputHTML = '';
            
            if (item.type === 'mcq') {
                inputHTML = `<div class="options-grid">
                    ${item.options.map((opt, i) => `
                        <div class="option-btn" onclick="selectOption(${index}, ${i}, this)">
                            <span style="font-weight:bold; margin-right:10px;">${String.fromCharCode(65+i)}.</span> ${opt}
                        </div>
                    `).join('')}
                </div>`;
            } else if (item.type === 'text') {
                inputHTML = `<input type="text" class="text-input" placeholder="Nhập câu trả lời của bạn..." id="input-${index}">`;
            }

            card.innerHTML = `
                <div class="question-text">
                    <span class="question-number">Câu ${item.id}:</span> ${item.question}
                </div>
                ${inputHTML}
                <button class="check-btn" onclick="checkAnswer(${index})">Kiểm tra ngay</button>
                <div class="explanation" id="exp-${index}">
                    <h4>GIẢI THÍCH CHI TIẾT (Ms Mai An):</h4>
                    <div class="exp-detail">${item.explanation}</div>
                </div>
            `;

            quizContainer.appendChild(card);
        });
    }

    // Xử lý chọn đáp án MCQ
    function selectOption(qIndex, optIndex, element) {
        // Lưu đáp án
        userAnswers[qIndex] = optIndex;
        
        // UI Update
        const card = document.getElementById(`q-card-${qIndex}`);
        const buttons = card.querySelectorAll('.option-btn');
        buttons.forEach(btn => btn.classList.remove('selected'));
        element.classList.add('selected');
    }

    // Kiểm tra từng câu lẻ
    function checkAnswer(index) {
        const item = quizData[index];
        const card = document.getElementById(`q-card-${index}`);
        const explanation = document.getElementById(`exp-${index}`);
        
        let isCorrect = false;

        if (item.type === 'mcq') {
            const selected = userAnswers[index];
            if (selected === null) {
                alert("Bạn chưa chọn đáp án!");
                return;
            }
            
            const buttons = card.querySelectorAll('.option-btn');
            // Reset colors
            buttons.forEach(btn => {
                btn.classList.remove('correct-answer', 'wrong-answer');
            });

            if (selected === item.answer) {
                isCorrect = true;
                buttons[selected].classList.add('correct-answer');
            } else {
                buttons[selected].classList.add('wrong-answer');
                buttons[item.answer].classList.add('correct-answer'); // Show correct one
            }

        } else if (item.type === 'text') {
            const inputVal = document.getElementById(`input-${index}`).value.trim().toLowerCase().replace(/\s+/g, ' '); // Normalize spaces
            // Check if input matches any valid answer (ignoring punctuation slightly if needed, but here simple normalize)
            // Remove punctuation for flexible checking
            const normalize = (str) => str.replace(/[.,?!]/g, "").toLowerCase().trim();
            
            const userNorm = normalize(inputVal);
            const validNorms = item.validAnswers.map(a => normalize(a));

            if (validNorms.includes(userNorm) && inputVal !== "") {
                isCorrect = true;
            } else {
                if(inputVal === "") {
                    alert("Bạn chưa nhập câu trả lời!");
                    return;
                }
                isCorrect = false;
            }
            // Save for final submission logic (1 for correct, 0 for wrong)
            userAnswers[index] = isCorrect ? 'correct' : 'wrong';
        }

        // Show Feedback
        explanation.style.display = 'block';
        if (isCorrect) {
            card.classList.add('correct');
            card.classList.remove('incorrect');
        } else {
            card.classList.add('incorrect');
            card.classList.remove('correct');
        }
    }

    // Nộp bài tổng
    function submitAll() {
        let score = 0;
        let unanswered = 0;

        quizData.forEach((item, index) => {
            let isCorrect = false;
            
            // Check MCQ
            if (item.type === 'mcq') {
                if (userAnswers[index] === item.answer) isCorrect = true;
                if (userAnswers[index] === null) unanswered++;
            } 
            // Check Text (Logic checked during input or simple validation here)
            else if (item.type === 'text') {
                const inputEl = document.getElementById(`input-${index}`);
                if (!inputEl.value.trim()) {
                    unanswered++;
                } else {
                    const normalize = (str) => str.replace(/[.,?!]/g, "").toLowerCase().trim();
                    const userNorm = normalize(inputEl.value);
                    const validNorms = item.validAnswers.map(a => normalize(a));
                    if (validNorms.includes(userNorm)) isCorrect = true;
                }
            }

            if (isCorrect) score++;

            // Force check UI for all
            // Simulate a click on check button if not already checked visualy
            const card = document.getElementById(`q-card-${index}`);
            if (!card.classList.contains('correct') && !card.classList.contains('incorrect')) {
                 // Nếu là Text input mà chưa check thì gọi checkAnswer
                 // Nếu là MCQ mà chưa chọn thì highlight vàng
                 if (item.type === 'mcq' && userAnswers[index] === null) {
                     card.style.borderLeft = "5px solid var(--warning)";
                     document.getElementById(`exp-${index}`).style.display = 'block';
                     // Show correct answer visually
                     const buttons = card.querySelectorAll('.option-btn');
                     buttons[item.answer].classList.add('correct-answer');
                 } else {
                     checkAnswer(index);
                 }
            }
        });

        // Show result modal
        const modal = document.getElementById('resultModal');
        const scoreText = document.getElementById('final-score');
        const feedback = document.getElementById('feedback-text');
        
        scoreText.innerText = `${score}/${quizData.length}`;
        
        if (score === quizData.length) feedback.innerText = "Tuyệt vời! Bạn đã làm đúng tất cả!";
        else if (score >= 30) feedback.innerText = "Rất tốt! Bạn nắm vững kiến thức.";
        else feedback.innerText = "Hãy xem lại các câu sai để rút kinh nghiệm nhé.";

        modal.style.display = 'flex';
        liveScore.style.display = 'block';
        liveScore.innerText = `Điểm: ${score}/${quizData.length}`;
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
        // Scroll to top
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    // Start
    renderQuiz();

</script>

</body>
</html>