<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 11: Electronic Devices - Ms Mai An ULIS</title>
    <style>
        :root {
            --primary: #0056b3;
            --secondary: #004494;
            --accent: #ffc107;
            --success: #28a745;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --radius: 8px;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
            margin: 0;
            padding-bottom: 80px; /* Space for sticky footer */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 20px;
            border-radius: 0 0 var(--radius) var(--radius);
            margin-bottom: 30px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        header h1 { margin: 0; font-size: 1.8rem; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 1rem; }
        .teacher-tag {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* CARD STYLES */
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
            position: relative;
        }

        .section-title {
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        /* DATA BOX (Reading Passages) */
        .data-box {
            background-color: #eef7ff;
            border: 1px solid #b8daff;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.05rem;
            color: #2c3e50;
        }

        .gap-fill-options {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            font-weight: 500;
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
            background: white;
        }
        .glossary-table th, .glossary-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .glossary-table th { background-color: var(--primary); color: white; }

        /* QUESTIONS */
        .question-text {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-label:hover { background: #e2e6ea; }
        
        .option-input {
            margin-right: 12px;
            accent-color: var(--primary);
            transform: scale(1.2);
        }

        /* FEEDBACK STATES */
        .option-label.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .option-label.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        /* EXPLANATION BOX */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding: 15px;
            background-color: #f1f8ff;
            border-left: 4px solid var(--accent);
            border-radius: 4px;
            font-size: 0.95rem;
        }
        .explanation.visible { display: block; animation: fadeIn 0.5s; }
        .expl-title { font-weight: bold; color: var(--secondary); margin-bottom: 5px; display: block; }
        .expl-trans { font-style: italic; color: #555; margin-bottom: 8px; display: block; border-bottom: 1px dashed #ccc; padding-bottom: 5px;}
        .expl-detail { color: #333; }
        .expl-detail strong { color: var(--danger); }
        .expl-detail u { text-decoration-color: var(--success); text-decoration-thickness: 2px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* BUTTONS */
        .btn-check {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 15px;
            transition: 0.2s;
        }
        .btn-check:hover { background: var(--primary); color: white; }

        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }
        
        .btn-submit {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,86,179,0.3);
            transition: transform 0.2s;
        }
        .btn-submit:hover { transform: translateY(-2px); background: var(--secondary); }

        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
        }

        /* CSS ART FOR IMAGES */
        .img-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        /* Q29 Parking Sign */
        .sign-parking {
            width: 200px;
            background-color: #014421;
            border: 3px solid #c5b358;
            border-radius: 10px 10px 5px 5px;
            padding: 15px 5px;
            text-align: center;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.3);
            font-family: serif;
        }
        .sign-parking h3 {
            color: #f0e68c;
            margin: 0;
            font-size: 1.4rem;
            border-bottom: 1px solid #f0e68c;
            padding-bottom: 5px;
        }
        .sign-parking h2 {
            color: white;
            margin: 5px 0;
            font-size: 1.6rem;
            text-transform: uppercase;
        }
        .sign-parking p {
            color: #f0e68c;
            font-size: 1rem;
            margin: 5px 0;
            font-weight: bold;
        }
        .sign-parking small {
            color: white;
            font-size: 0.6rem;
            display: block;
            margin-top: 10px;
        }

        /* Q30 Wet Floor Notice */
        .notice-wet {
            width: 100%;
            max-width: 500px;
            background: #fff;
            border: 2px solid blue;
            border-radius: 5px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .notice-wet .header {
            color: blue;
            font-weight: bold;
            padding: 5px 10px;
            font-size: 1.2rem;
        }
        .notice-wet .body {
            background-color: #ffffcc;
            color: red;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            font-size: 1.1rem;
        }

        /* Utility */
        u { text-decoration-thickness: 2px; text-underline-offset: 3px; }
    </style>
</head>
<body>

<header>
    <h1>UNIT 11 – ELECTRONIC DEVICES (TEST 01)</h1>
    <div class="teacher-tag">Teacher: Ms Mai An - ULIS</div>
    <p>Thời gian làm bài: 45 phút | Số câu hỏi: 40</p>
</header>

<div class="container" id="quiz-container">
    </div>

<div class="sticky-footer">
    <div class="score-display" id="score-area">Kết quả: --/40</div>
    <button class="btn-submit" id="btn-submit">NỘP BÀI</button>
</div>

<script>
const quizData = [
    // PHONETICS
    {
        id: 1, type: 'phonetics', section: 'Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.',
        question: 'Choose the word with different underlined pronunciation:',
        options: [
            { text: 'd<u>u</u>rable', clean: 'durable' },
            { text: 'r<u>u</u>bber', clean: 'rubber' },
            { text: 'n<u>u</u>mber', clean: 'number' },
            { text: 'pl<u>u</u>mber', clean: 'plumber' } // Prompt highlighted 'u' but prompt asked for difference. Let's check prompt again. Prompt: durable, rubber, number, plumber. Usually 'b' is the test in plumber. Or 'u'. 
            // Let's assume the prompt meant underlining 'b' (silent b in plumber). 
            // Wait, looking at the prompt image/text provided: "durable, rubber, number, plumber".
            // Option A: durable /djʊə/. Rubber /rʌ/. Number /nʌ/. Plumber /plʌ/.
            // If underlining is 'u': A=/jʊə/ or /ju/, B,C,D = /ʌ/. So A is correct.
            // If underlining is 'b': A, B, C have /b/. D (plumber) is silent /b/.
            // Given "Electronic Devices" unit, and typical questions: A is likely target for 'u'.
            // Let's underline 'u' based on standard pattern, or 'b'. 
            // Let's stick to the Text provided. It didn't specify underline. I will underline 'u' as it's the vowel.
        ],
        // Actually, looking at standard tests: Plumber (silent b) is a classic. But Durable (u) vs others (u) is also valid.
        // Let's check the options again. 1. durable 2. rubber 3. number 4. plumber.
        // If testing 'b': durable (b), rubber (b), number (b), plumber (silent). Answer D.
        // If testing 'u': durable (/jʊə/), rubber (/ʌ/), number (/ʌ/), plumber (/ʌ/). Answer A.
        // Let's assume it tests 'b' because 'plumber' is famous for silent b.
        // BUT, looking at the prompt text "underlined part". It's not visible.
        // I will implement "b" test as it's more definitive for "plumber".
        // RE-READING: Q1 typically vowels. Durable (/ju:/), Rubber (/^/), Number (/^/), Plumber (/^/). A is clearly different. 
        // Let's go with A (u).
        correct: 0,
        explanation: `
            <span class="expl-trans">A. durable /ˈdjʊərəbl/ (bền); B. rubber /ˈrʌbə(r)/ (cao su); C. number /ˈnʌmbə(r)/ (số); D. plumber /ˈplʌmə(r)/ (thợ sửa ống nước).</span>
            <div class="expl-detail">
                Phần gạch chân đáp án A phát âm là <strong>/jʊə/</strong> (hoặc /ju:/), các đáp án còn lại là <strong>/ʌ/</strong>.<br>
                Lưu ý: Từ <em>plumber</em> âm 'b' bị câm.
            </div>`
    },
    {
        id: 2, type: 'phonetics',
        question: 'Choose the word with different underlined pronunciation:',
        options: [
            { text: 'block<u>ed</u>', clean: 'blocked' },
            { text: 'connect<u>ed</u>', clean: 'connected' },
            { text: 'hatr<u>ed</u>', clean: 'hatred' },
            { text: 'decid<u>ed</u>', clean: 'decided' }
        ],
        correct: 0,
        explanation: `
            <span class="expl-trans">A. blocked /blɒkt/; B. connected /kəˈnektɪd/; C. hatred /ˈheɪtrɪd/ (lòng căm thù); D. decided /dɪˈsaɪdɪd/.</span>
            <div class="expl-detail">
                Quy tắc phát âm đuôi -ed:
                <ul>
                    <li>Đọc là <strong>/t/</strong> khi tận cùng là /k/, /p/, /s/, /f/, /ʃ/, /tʃ/. -> <em>blocked</em> tận cùng là /k/ nên đọc /t/.</li>
                    <li>Đọc là <strong>/id/</strong> khi tận cùng là /t/, /d/. -> <em>connected, decided</em>.</li>
                    <li><strong>Đặc biệt:</strong> <em>Hatred</em> (danh từ) luôn đọc là /id/ dù kết thúc bằng 'r' (gốc từ hate).</li>
                </ul>
                Vậy đáp án A khác biệt.
            </div>`
    },
    // STRESS
    {
        id: 3, type: 'stress', section: 'Mark the letter A, B, C or D to indicate the word that differs in the position of primary stress.',
        question: 'Choose the word with different stress pattern:',
        options: [
            { text: 'assist', clean: 'assist' },
            { text: 'virtual', clean: 'virtual' },
            { text: 'wireless', clean: 'wireless' },
            { text: 'touchscreen', clean: 'touchscreen' }
        ],
        correct: 0,
        explanation: `
            <span class="expl-trans">A. assist /əˈsɪst/ (v); B. virtual /ˈvɜːtʃuəl/ (adj); C. wireless /ˈwaɪələs/ (adj/n); D. touchscreen /ˈtʌtʃskriːn/ (n).</span>
            <div class="expl-detail">
                Đáp án A trọng âm rơi vào âm tiết thứ <strong>2</strong>.
                Các đáp án B, C, D trọng âm rơi vào âm tiết thứ <strong>1</strong>.
            </div>`
    },
    {
        id: 4, type: 'stress',
        question: 'Choose the word with different stress pattern:',
        options: [
            { text: 'education', clean: 'education' },
            { text: 'amusement', clean: 'amusement' },
            { text: 'electronic', clean: 'electronic' },
            { text: 'entertainment', clean: 'entertainment' }
        ],
        correct: 1,
        explanation: `
            <span class="expl-trans">A. education /ˌedʒuˈkeɪʃn/; B. amusement /əˈmjuːzmənt/; C. electronic /ɪˌlekˈtrɒnɪk/; D. entertainment /ˌentəˈteɪnmənt/.</span>
            <div class="expl-detail">
                Đáp án B trọng âm rơi vào âm tiết thứ <strong>2</strong>.
                Các đáp án A, C, D có hậu tố -tion, -ic, -ment (kết hợp) thường nhấn trọng âm phụ ở đầu và trọng âm chính ở âm tiết thứ <strong>3</strong> (từ dưới lên hoặc theo quy tắc). Cụ thể ở đây là âm tiết thứ 3 từ trái sang.
            </div>`
    },
    // GRAMMAR & VOCAB
    {
        id: 5, type: 'grammar', section: 'Mark the letter A, B, C or D to indicate the correct answer.',
        question: 'Elon Musk’s SpaceX sent NASA astronauts _________ orbit on May 30 2020.',
        options: [
            { text: 'To' }, { text: 'into' }, { text: 'around' }, { text: 'to' } // Note: options in prompt has duplicate 'to', usually 'into' orbit is the phrase.
        ],
        correct: 1,
        explanation: `
            <span class="expl-trans">Dịch: SpaceX của Elon Musk đã đưa các phi hành gia NASA vào quỹ đạo vào ngày 30/5/2020.</span>
            <div class="expl-detail">
                Collocation: <strong>send someone into orbit</strong> (đưa ai đó vào quỹ đạo).
                <br>Đáp án A, D: <em>To</em> chỉ hướng đi đến địa điểm cụ thể trên mặt đất hơn.
                <br>Đáp án C: <em>Around</em> (xung quanh) không đi với 'send' trong ngữ cảnh phóng tàu vũ trụ (orbit đã mang nghĩa quay quanh rồi).
            </div>`
    },
    {
        id: 6, type: 'vocab',
        question: 'The laptop’s lightweight and compact design makes it highly _______ for travel.',
        options: [ { text: 'portable' }, { text: 'wireless' }, { text: 'virtual' }, { text: 'durable' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Dịch: Thiết kế nhỏ gọn và nhẹ của máy tính xách tay khiến nó rất _______ cho việc đi lại.</span>
            <div class="expl-detail">
                A. <strong>portable</strong> (adj): dễ mang theo, xách tay (phù hợp với 'travel', 'lightweight').<br>
                B. wireless (adj): không dây.<br>
                C. virtual (adj): ảo.<br>
                D. durable (adj): bền (liên quan đến độ cứng, không hỏng).
            </div>`
    },
    {
        id: 7, type: 'grammar',
        question: 'Her phone, ______ she lost on the bus yesterday, had all her contacts on it.',
        options: [ { text: 'whose' }, { text: 'that' }, { text: 'which' }, { text: 'X' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Dịch: Điện thoại của cô ấy, cái mà cô ấy làm mất trên xe buýt hôm qua, có chứa tất cả danh bạ.</span>
            <div class="expl-detail">
                Đây là mệnh đề quan hệ không xác định (có dấu phẩy) thay thế cho vật "Her phone".
                <br>-> Dùng đại từ quan hệ <strong>which</strong>.
                <br>Lưu ý: <em>That</em> không dùng sau dấu phẩy. <em>Whose</em> dùng cho sở hữu.
            </div>`
    },
    {
        id: 8, type: 'grammar',
        question: 'Her teacher suggested she _________ more exercises to improve her English.',
        options: [ { text: 'practice' }, { text: 'practicing' }, { text: 'should practice' }, { text: 'to practice' } ],
        correct: 2, // Choosing 'should practice' as broadly accepted in VN schools, though 'practice' (A) is also correct (Subjunctive). Will expl both.
        explanation: `
            <span class="expl-trans">Dịch: Giáo viên gợi ý rằng cô ấy nên làm nhiều bài tập hơn...</span>
            <div class="expl-detail">
                Cấu trúc: <strong>Suggest + that + S + (should) + V_inf</strong> (Khuyên ai đó nên làm gì).
                <br>Đáp án C (should practice) là dạng đầy đủ.
                <br>Đáp án A (practice) là dạng Giả định cách (Subjunctive) - cũng đúng nhưng trong các bài thi THPT thường ưu tiên cấu trúc có 'should' hoặc coi cả 2 là đúng. Ở đây chọn C là phương án phổ biến nhất cho người học B1-B2.
                <br>Sai: B (Suggest + Ving chỉ dùng khi không có chủ ngữ cụ thể phía sau), D (Suggest không đi với to V).
            </div>`
    },
    {
        id: 9, type: 'grammar',
        question: 'I advise you _______ money for the rainy days.',
        options: [ { text: 'to save' }, { text: 'saving' }, { text: 'save' }, { text: 'should save' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Dịch: Tôi khuyên bạn nên tiết kiệm tiền cho những ngày khó khăn.</span>
            <div class="expl-detail">
                Cấu trúc: <strong>Advise + O + to V</strong> (Khuyên ai làm gì).
                <br>Thành ngữ: <em>for a rainy day</em> (để dành khi túng thiếu/cấp bách).
            </div>`
    },
    {
        id: 10, type: 'comms',
        question: '“Have a nice weekend!” – “_____________”',
        options: [ { text: 'I hope so' }, { text: 'The same to you!' }, { text: 'What about you?' }, { text: 'It’s very kind of you' } ],
        correct: 1,
        explanation: `
            <span class="expl-trans">Dịch: "Cuối tuần vui vẻ nhé!" - "Bạn cũng vậy nhé!"</span>
            <div class="expl-detail">
                Đáp án đúng: <strong>B. The same to you!</strong> (Đáp lại lời chúc).
                <br>A. Tôi hy vọng vậy (dùng cho dự đoán).
                <br>D. Bạn thật tốt bụng (dùng để cảm ơn khi được giúp đỡ).
            </div>`
    },
    {
        id: 11, type: 'grammar',
        question: 'The doctor _______ John to give up smoking because it harms his health.',
        options: [ { text: 'recommended' }, { text: 'talked' }, { text: 'advised' }, { text: 'suggested' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Dịch: Bác sĩ khuyên John bỏ thuốc lá...</span>
            <div class="expl-detail">
                Cấu trúc: <strong>Advise + O + to V</strong>.
                <br>A. Recommend + Ving / that clause (thường không dùng O + to V).
                <br>B. Talked to John (nói chuyện với, không mang nghĩa khuyên làm gì cụ thể bằng cấu trúc to V).
                <br>D. Suggested + Ving.
            </div>`
    },
    {
        id: 12, type: 'vocab',
        question: 'If I need a replacement part for a machine or device, I can use my _____ to create a new one that is a perfect fit.',
        options: [ { text: 'plastic machine' }, { text: 'smartwatch' }, { text: '3D printer' }, { text: 'copper' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Dịch: Nếu tôi cần phụ tùng thay thế..., tôi có thể dùng ___ để tạo ra cái mới vừa khít.</span>
            <div class="expl-detail">
                A. Máy nhựa (không có nghĩa).
                B. Đồng hồ thông minh.
                C. <strong>3D printer</strong> (Máy in 3D) - Chuyên dùng để tạo mẫu vật, phụ tùng thay thế chính xác.
                D. Đồng (kim loại).
            </div>`
    },
    // READING 1: WRITERS WANTED
    {
        id: 13, type: 'reading-cloze', section: 'Read the announcement and choose the correct option.',
        text_ref: 'reading1',
        question: 'Question 13:',
        options: [ { text: 'looking up' }, { text: 'looking on' }, { text: 'looking for' }, { text: 'looking at' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Wowee Magazine is (13) looking for writers... (Tạp chí Wowee đang tìm kiếm các nhà văn...)</span>
            <div class="expl-detail">
                Phrasal verb: <strong>look for</strong> = seek (tìm kiếm).
                <br>Look up: tra cứu; Look at: nhìn vào.
            </div>`
    },
    {
        id: 14, type: 'reading-cloze', text_ref: 'reading1',
        question: 'Question 14:',
        options: [ { text: 'on' }, { text: 'at' }, { text: 'for' }, { text: 'in' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Pay is based (14) on the number of people... (Tiền lương dựa trên số lượng người...)</span>
            <div class="expl-detail">
                Cấu trúc: <strong>be based on</strong> (được dựa trên/căn cứ vào).
            </div>`
    },
    {
        id: 15, type: 'reading-cloze', text_ref: 'reading1',
        question: 'Question 15:',
        options: [ { text: 'a' }, { text: 'an' }, { text: 'the' }, { text: 'X (no article)' } ],
        correct: 3,
        explanation: `
            <span class="expl-trans">You may also receive (15) ___ free tickets and products...</span>
            <div class="expl-detail">
                Danh từ "tickets" và "products" ở dạng <strong>số nhiều</strong> và được nhắc đến chung chung lần đầu -> Không dùng mạo từ (Zero article).
            </div>`
    },
    {
        id: 16, type: 'reading-cloze', text_ref: 'reading1',
        question: 'Question 16:',
        options: [ { text: 'valuable' }, { text: 'valuably' }, { text: 'valuated' }, { text: 'valuation' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">...get (16) valuable work experience. (...có được kinh nghiệm làm việc quý báu).</span>
            <div class="expl-detail">
                Cần một Tính từ (Adjective) để bổ nghĩa cho cụm danh từ "work experience".
                <br>A. <strong>valuable</strong> (adj): có giá trị/quý báu.
                <br>B. valuably (adv). D. valuation (n).
            </div>`
    },
    // SENTENCE ARRANGEMENT
    {
        id: 17, type: 'arrange', section: 'Sentence Arrangement & Ending',
        data_text: `
        (a) More than 300 students attended the fair and enjoyed Vietnamese dishes, songs and games.<br>
        (b) In my view, the day was a great success. All the attendees felt happy.<br>
        (c) There were 30 stalls where various activities were offered.<br>
        (d) Yesterday, our school organized the Spring Fair in the playground.<br>
        (e) However, it would be better if we could make Banh Chung during the night.`,
        question: 'Arrange the sentences to make a meaningful paragraph:',
        options: [ { text: 'd-a-c-b-e' }, { text: 'd-b-a-c-e' }, { text: 'b-d-a-e-c' }, { text: 'b-c-d-e-a' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Trật tự logic:</span>
            <div class="expl-detail">
                1. <strong>(d)</strong> Giới thiệu sự kiện (Thời gian, địa điểm): Yesterday... Spring Fair.<br>
                2. <strong>(a)</strong> Số lượng người tham gia và hoạt động chung: 300 students...<br>
                3. <strong>(c)</strong> Chi tiết cụ thể: 30 stalls (gian hàng)...<br>
                4. <strong>(b)</strong> Đánh giá/Cảm nhận tổng quan: Great success...<br>
                5. <strong>(e)</strong> Góp ý/Tiếc nuối (However): Better if make Banh Chung...<br>
                => Đáp án A (d-a-c-b-e) là hợp lý nhất.
            </div>`
    },
    {
        id: 18, type: 'logic',
        question: 'Choose the sentence that most appropriately ends the text (in question 17)',
        options: [
            { text: 'We were all looking forward to another Fair that will be held next month.' },
            { text: 'At the end of the fair, it rained and the Fair was postponed.' },
            { text: 'The playground was full of people' },
            { text: 'Although there was lots of fun, I lost my keys when wandering the stalls.' }
        ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Câu kết đoạn văn:</span>
            <div class="expl-detail">
                Đoạn văn mang sắc thái tích cực (great success) và đưa ra góp ý (make Banh Chung). Câu kết nên hướng tới tương lai hoặc tóm lại cảm xúc.<br>
                A. Chúng tôi đều mong chờ hội chợ tiếp theo... (Phù hợp nhất).<br>
                B. Mâu thuẫn (bị hoãn) với ý "thành công" ở trên.<br>
                C. Chi tiết miêu tả, nên nằm ở giữa đoạn.<br>
                D. Chi tiết tiêu cực cá nhân (mất chìa khóa), không hợp làm câu kết tổng kết.
            </div>`
    },
    // READING 2: SMART REFRIGERATOR
    {
        id: 19, type: 'reading-cloze', section: 'Read the passage about Smart Refrigerator.',
        text_ref: 'reading2',
        question: 'Question 19:',
        options: [ { text: 'replaces' }, { text: 'collaborates' }, { text: 'combines' }, { text: 'prolongs' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">A smart refrigerator (19) combines advanced technologies... (Tủ lạnh thông minh kết hợp các công nghệ tiên tiến...)</span>
            <div class="expl-detail">
                A. replaces (thay thế); B. collaborates (hợp tác); D. prolongs (kéo dài).
                <br><strong>Combine</strong> (kết hợp) là từ phù hợp nhất về nghĩa để mô tả việc tích hợp công nghệ vào chức năng cơ bản.
            </div>`
    },
    {
        id: 20, type: 'reading-cloze', text_ref: 'reading2',
        question: 'Question 20:',
        options: [ { text: 'features' }, { text: 'leaflets' }, { text: 'cases' }, { text: 'desktops' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">...includes many innovative (20) features... (...bao gồm nhiều tính năng đổi mới...)</span>
            <div class="expl-detail">
                A. <strong>features</strong> (tính năng) - từ vựng chuyên ngành thiết bị điện tử.<br>
                B. tờ rơi; C. trường hợp/vỏ; D. màn hình máy tính.
            </div>`
    },
    {
        id: 21, type: 'reading-cloze', text_ref: 'reading2',
        question: 'Question 21:',
        options: [ { text: 'blocking out' }, { text: 'logging out' }, { text: 'waking up' }, { text: 'picking up' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Imagine (21) waking up in the morning... (Hãy tưởng tượng thức dậy vào buổi sáng...)</span>
            <div class="expl-detail">
                Phù hợp ngữ cảnh sinh hoạt hàng ngày.
            </div>`
    },
    {
        id: 22, type: 'reading-cloze', text_ref: 'reading2',
        question: 'Question 22:',
        options: [ { text: 'text' }, { text: 'diagram' }, { text: 'news' }, { text: 'notification' } ],
        correct: 3,
        explanation: `
            <span class="expl-trans">...receiving a (22) notification that you’re running low on milk. (...nhận được một thông báo rằng bạn sắp hết sữa).</span>
            <div class="expl-detail">
                D. <strong>notification</strong> (thông báo - trên app/điện thoại).<br>
                A. tin nhắn văn bản (cụ thể từ người khác); B. biểu đồ.
            </div>`
    },
    {
        id: 23, type: 'reading-cloze', text_ref: 'reading2',
        question: 'Question 23:',
        options: [ { text: 'frequently' }, { text: 'effectively' }, { text: 'privately' }, { text: 'directly' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">...types of food you (23) frequently store... (loại thực phẩm bạn thường xuyên lưu trữ).</span>
            <div class="expl-detail">
                A. <strong>frequently</strong> = often (thường xuyên). Phù hợp với việc phân tích "thói quen" (habits).
            </div>`
    },
    {
        id: 24, type: 'reading-cloze', text_ref: 'reading2',
        question: 'Question 24:',
        options: [ { text: 'with' }, { text: 'on' }, { text: 'in' }, { text: 'at' } ],
        correct: 1,
        explanation: `
            <span class="expl-trans">...suggest recipes based (24) on the ingredients... (...gợi ý công thức nấu ăn dựa trên các nguyên liệu...)</span>
            <div class="expl-detail">
                Cấu trúc: <strong>based on</strong> (dựa trên).
            </div>`
    },
    // REWRITE SENTENCE
    {
        id: 25, type: 'rewrite', section: 'Mark the letter A, B, C or D to indicate the closest meaning.',
        question: '“Are you going to buy a new e-reader next month?”',
        options: [
            { text: 'Andy asked me whether was I going to buy a new e-reader the following month.' },
            { text: 'Andy asked me whether was I going to buy a new e-reader the following month?' },
            { text: 'Andy asked me whether I was going to buy a new e-reader next month' },
            { text: 'Andy asked me whether I was going to buy a new e-reader the following month.' }
        ],
        correct: 3,
        explanation: `
            <span class="expl-trans">Câu gốc: "Bạn có định mua máy đọc sách mới vào tháng sau không?"</span>
            <div class="expl-detail">
                Quy tắc chuyển câu tường thuật (Reported Speech) dạng câu hỏi Yes/No:
                1. Dùng <strong>if/whether</strong>.
                2. Lùi thì: are going to -> <strong>was/were going to</strong>.
                3. Đổi ngôi: you -> I.
                4. Đổi trạng từ thời gian: next month -> <strong>the following month / the next month</strong>.
                5. Trật tự từ: S + V (không đảo ngữ như câu hỏi).
                <br>-> Đáp án D đúng hoàn toàn.
                <br>A sai trật tự (was I); C chưa đổi trạng từ thời gian (next month).
            </div>`
    },
    {
        id: 26, type: 'rewrite',
        question: 'This high-end tablet was too expensive for me to buy.',
        options: [
            { text: 'I didn’t have enough money to buy this high-end tablet.' },
            { text: 'I didn’t have enough money for buying this high-end tablet' },
            { text: 'I have too much money to buy this high-end tablet.' },
            { text: 'I have too many money to buy this high-end tablet.' }
        ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Câu gốc: Chiếc máy tính bảng cao cấp này quá đắt để tôi mua.</span>
            <div class="expl-detail">
                Cấu trúc: <strong>Too + Adj + for sb + to V</strong> = <strong>Not + Adj (ngược nghĩa) + enough + for sb + to V</strong> hoặc <strong>Not have enough money to V</strong>.
                <br>A. Tôi không có đủ tiền để mua... (Đúng nghĩa).
                <br>B. Sai ngữ pháp (enough money for buying -> thường dùng to buy).
                <br>C. Tôi có quá nhiều tiền (Sai nghĩa).
            </div>`
    },
    {
        id: 27, type: 'combine', section: 'Mark the letter A, B, C or D to indicate the sentence made from given cues.',
        question: 'Cues: renewable energy/ gain/ popularity/ fossil fuels/ still/ dominate/ global energy use.',
        options: [
            { text: 'Renewable energy is gaining popularity because fossil fuels still dominate global energy use.' },
            { text: 'When renewable energy is gaining popularity, fossil fuels will dominate global energy use.' },
            { text: 'Renewable energy will gain popularity if fossil fuels still dominate global energy use.' },
            { text: 'Although renewable energy is gaining popularity, fossil fuels still dominate global energy use.' }
        ],
        correct: 3,
        explanation: `
            <span class="expl-trans">Hai vế câu mang nghĩa tương phản: Năng lượng tái tạo đang phổ biến NHƯNG nhiên liệu hóa thạch vẫn chiếm ưu thế.</span>
            <div class="expl-detail">
                Dùng liên từ chỉ sự nhượng bộ/đối lập: <strong>Although</strong>.
                <br>D. Mặc dù năng lượng tái tạo đang trở nên phổ biến, nhiên liệu hóa thạch vẫn thống trị... (Đúng).
                <br>A. Bởi vì (Sai nghĩa logic); C. Nếu (Sai nghĩa).
            </div>`
    },
    {
        id: 28, type: 'combine',
        question: 'Cues: So far/ three companies/ deny/ application/ the position/ software developer.',
        options: [
            { text: 'So far three companies denied my application for the position as software developer.' },
            { text: 'So far three companies denied my application to the position of software developer.' },
            { text: 'So far three companies have denied my application for the position of software developer.' },
            { text: 'So far three companies have denied my application to the position as software developer.' }
        ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Gợi ý: So far (cho đến nay) -> Dấu hiệu thì Hiện tại hoàn thành.</span>
            <div class="expl-detail">
                1. Thì: Present Perfect (have denied). Loại A, B (Past Simple).
                2. Collocation: application <strong>for</strong> the position <strong>of</strong>... (đơn ứng tuyển cho vị trí...).
                <br>-> Đáp án C đúng.
            </div>`
    },
    // IMAGES
    {
        id: 29, type: 'image', section: 'Read the sign/notice and answer.',
        question: 'Question 29: What does the sign say?',
        imageHTML: `
            <div class="img-container">
                <div class="sign-parking">
                    <h3>&#9749;&#9749;</h3>
                    <h2>RESERVED<br>PARKING</h2>
                    <p>Customers Only</p>
                    <small>Unauthorized Vehicles will be<br>Towed Away at Owner's Expense</small>
                </div>
            </div>`,
        options: [
            { text: 'Anyone can park here without any restrictions' },
            { text: 'Only customers are allowed to park in these spaces' },
            { text: 'Parking is not allowed in this area at all' },
            { text: 'There are no rules for parking; it is open for everyone' }
        ],
        correct: 1,
        explanation: `
            <span class="expl-trans">Biển báo: "Bãi đỗ xe dành riêng. Chỉ dành cho khách hàng".</span>
            <div class="expl-detail">
                Biển ghi rõ "Customers Only" -> Chỉ khách hàng mới được phép đỗ xe.
            </div>`
    },
    {
        id: 30, type: 'image',
        question: 'Question 30: What does the notice say?',
        imageHTML: `
            <div class="img-container">
                <div class="notice-wet">
                    <div class="header">Caution:</div>
                    <div class="body">The floor is wet. Please walk carefully to avoid slipping</div>
                </div>
            </div>`,
        options: [
            { text: 'There is no need to be careful on the floor.' },
            { text: 'The floor is wet, stand still and avoid moving' },
            { text: 'The floor is always wet and slippery' },
            { text: 'The floor is wet, walk carefully to avoid slipping' }
        ],
        correct: 3,
        explanation: `
            <span class="expl-trans">Thông báo: "Sàn ướt. Vui lòng đi cẩn thận để tránh trượt ngã".</span>
            <div class="expl-detail">
                Câu D (Sàn ướt, đi cẩn thận...) diễn giải chính xác nội dung thông báo.
            </div>`
    },
    // READING 3: KIDS AND PHONES
    {
        id: 31, type: 'reading', section: 'Read the passage about Kids and Cell Phones.',
        text_ref: 'reading3',
        question: 'Question 31: What is the main idea of the passage?',
        options: [
            { text: 'The pros and cons of children using cell phones' },
            { text: 'How to choose the best cell phone for your child' },
            { text: 'The importance of Internet safety for kids' },
            { text: 'The role of parental-control apps in protecting children' }
        ],
        correct: 1,
        explanation: `
            <span class="expl-trans">Ý chính: Cách chọn điện thoại phù hợp cho con.</span>
            <div class="expl-detail">
                Bài đọc đề cập đến việc cân nhắc tuổi tác, nhu cầu, độ an toàn và đưa ra các lời khuyên từ chuyên gia/khảo sát để tìm ra điện thoại tốt nhất ("To find the best cell phones for kids...").
            </div>`
    },
    {
        id: 32, type: 'reading', text_ref: 'reading3',
        question: 'Question 32: What should parents consider when buying a smartphone for their kids?',
        options: [ { text: 'Its material' }, { text: 'the child’s age' }, { text: 'its contact list' }, { text: 'its GPS' } ],
        correct: 1,
        explanation: `
            <span class="expl-trans">Dẫn chứng: "consider their age, the intended users of the phone..."</span>
            <div class="expl-detail">
                Cha mẹ nên cân nhắc tuổi tác (age) của trẻ.
            </div>`
    },
    {
        id: 33, type: 'reading', text_ref: 'reading3',
        question: 'Question 33: What does Titania Jordan suggest?',
        options: [
            { text: 'Technology is just another burden for parents' },
            { text: 'Parents should spend more time communicating to their children' },
            { text: 'Parents should beware of strangers using technology to locate their children' },
            { text: 'Children should only be allowed to use phone to text their parents' }
        ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Dẫn chứng: "...the ability of others to do so [locate children] can be frightening and dangerous."</span>
            <div class="expl-detail">
                Titania cảnh báo về việc người lạ (others) có thể định vị và liên lạc với trẻ -> Cần cảnh giác (Beware of strangers).
            </div>`
    },
    {
        id: 34, type: 'reading', text_ref: 'reading3',
        question: 'Question 34: These methods have been used to figure out the right cell phone for kids EXCEPT',
        options: [ { text: 'Internet safety experts' }, { text: 'guidance from AAP' }, { text: 'Survey of parents’ view' }, { text: 'cell phone companies' } ],
        correct: 3,
        explanation: `
            <span class="expl-trans">Các phương pháp được dùng ngoại trừ: Các công ty điện thoại.</span>
            <div class="expl-detail">
                Bài đọc liệt kê: surveyed parents (C), spoke to Internet safety experts (A), reviewed guidance from AAP (B). Không nhắc đến việc hỏi ý kiến các công ty điện thoại (D).
            </div>`
    },
    {
        id: 35, type: 'reading', text_ref: 'reading3',
        question: 'Question 35: The underlined phrase “in this day and age” is CLOSEST in meaning to _____.',
        options: [ { text: 'In the modern world' }, { text: 'in the past' }, { text: 'in due course' }, { text: 'recently' } ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Idiom: In this day and age = Trong thời đại ngày nay/Thế giới hiện đại.</span>
            <div class="expl-detail">
                Đồng nghĩa với A. In the modern world.
            </div>`
    },
    {
        id: 36, type: 'reading', text_ref: 'reading3',
        question: 'Question 36: The underlined phrase “incredible” is OPPOSITE in meaning to ________.',
        options: [ { text: 'Unbelievable' }, { text: 'untrusted' }, { text: 'believable' }, { text: 'implausible' } ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Incredible (adj): không thể tin được / tuyệt vời / phi thường.</span>
            <div class="expl-detail">
                Xét về cấu tạo từ, đối nghĩa (Opposite) của Incredible là <strong>Believable</strong> (có thể tin được/bình thường).
                <br>Lưu ý: Unbelievable và Implausible là từ đồng nghĩa.
            </div>`
    },
    // GAP FILL: COMPUTERS
    {
        id: 37, type: 'gapfill', section: 'Gap Fill: Choose the correct sentence to fill in the blanks.',
        text_ref: 'gapfill_comp',
        question: 'Question 37:',
        options: [
            { text: 'Computers are the most efficient servants man has ever had' },
            { text: 'Computers are capable of doing extremely complicated work in all kinds of learning.' },
            { text: 'Though computers are capable of learning from their mistakes and improving on their performance' },
            { text: 'Because they work accurately and at high speeds they save research workers years of hard work.' }
        ],
        // Logic: Text says "widely used... everyone use them. (37). They can solve complex problems...".
        // B fits best as intro to capability.
        correct: 1, 
        explanation: `
            <span class="expl-trans">Câu điền: Máy tính có khả năng làm những công việc cực kỳ phức tạp...</span>
            <div class="expl-detail">
                Câu sau đó: "They can solve the most complex mathematical problem..." (Chúng có thể giải các bài toán phức tạp nhất...).
                <br>-> Đáp án B (Computers are capable of doing extremely complicated work...) liên kết logic nhất.
            </div>`
    },
    {
        id: 38, type: 'gapfill', text_ref: 'gapfill_comp',
        question: 'Question 38:',
        options: [
            { text: 'Computers are the most efficient servants man has ever had' },
            { text: 'Computers are capable of doing extremely complicated work in all kinds of learning.' },
            { text: 'Though computers are capable of learning from their mistakes and improving on their performance' },
            { text: 'Because they work accurately and at high speeds they save research workers years of hard work.' }
        ],
        correct: 3,
        explanation: `
            <span class="expl-trans">Câu điền: Vì chúng làm việc chính xác và tốc độ cao, chúng tiết kiệm cho các nhà nghiên cứu hàng năm trời làm việc...</span>
            <div class="expl-detail">
                Đoạn trước liệt kê khả năng (put facts to order). Đoạn này tổng kết lợi ích (save years of hard work) trước khi chuyển sang đoạn 2 nói về sai lầm khi nghĩ máy tính biết nghĩ.
                <br>-> Đáp án D phù hợp.
            </div>`
    },
    {
        id: 39, type: 'gapfill', text_ref: 'gapfill_comp',
        question: 'Question 39:',
        options: [
            { text: 'Computers are the most efficient servants man has ever had' },
            { text: 'Computers are capable of doing extremely complicated work in all kinds of learning.' },
            { text: 'Though computers are capable of learning from their mistakes and improving on their performance' },
            { text: 'Because they work accurately and at high speeds they save research workers years of hard work.' }
        ],
        correct: 2,
        explanation: `
            <span class="expl-trans">Câu điền: Dù máy tính có khả năng học hỏi từ lỗi sai..., (nhưng) chúng cần hướng dẫn chi tiết...</span>
            <div class="expl-detail">
                Câu điền nằm trước mệnh đề ", they need detailed instructions".
                <br>Đáp án C bắt đầu bằng "Though" (Mặc dù) tạo thành một câu phức hoàn chỉnh: "Though [clause], [main clause]".
                <br>Các đáp án khác ghép vào sẽ bị sai ngữ pháp (comma splice).
            </div>`
    },
    {
        id: 40, type: 'gapfill', text_ref: 'gapfill_comp',
        question: 'Question 40:',
        options: [
            { text: 'Computers are the most efficient servants man has ever had' },
            { text: 'Computers are capable of doing extremely complicated work in all kinds of learning.' },
            { text: 'Though computers are capable of learning from their mistakes and improving on their performance' },
            { text: 'Because they work accurately and at high speeds they save research workers years of hard work.' }
        ],
        correct: 0,
        explanation: `
            <span class="expl-trans">Câu điền: Máy tính là những người đầy tớ hiệu quả nhất mà con người từng có...</span>
            <div class="expl-detail">
                Câu này kết hợp với vế sau "and there is no limit to the ways they can be used" tạo thành câu kết bài hoàn hảo, khẳng định vai trò công cụ (servants) của máy tính.
            </div>`
    }
];

const readingContent = {
    'reading1': `
        <h3>WRITERS WANTED</h3>
        <p>Wowee Magazine is (13) _____ writers for its website. Pay is based (14) _____ the number of people who read your articles. You may also receive (15) _____ free tickets and products to test. This is a great opportunity to get (16) _____ work experience.</p>
        <p>We want people who are: Chatty, Interesting, Passionate, Skilled.</p>
        <p>Contact us at info@wowee.com</p>
    `,
    'reading2': `
        <h3>SMART REFRIGERATOR</h3>
        <p>A smart refrigerator (19) _________________ advanced technologies and internet connectivity to the basic functions of a fridge. It does more than just keep your food fresh. It also includes many innovative (20) _________________ to make home and kitchen life easier and more efficient.</p>
        <p>One key functionality that smart refrigerators have is monitoring your food supply. Imagine (21) _________________ in the morning and receiving a (22) _________________ that you’re running low on milk. Then, you open the smart fridge app and add milk to your shopping list or have it delivered later that day.</p>
        <p>Smart refrigerators can also learn your preferences and habits over time. By analyzing the data it collects — such as the types of food you (23) _________________ store and consume — your smart refrigerator can assemble custom-made shopping recommendations or even suggest recipes based (24) _________________ the ingredients you have on hand.</p>
        
        <table class="glossary-table">
            <thead><tr><th>Word</th><th>Type</th><th>Meaning</th></tr></thead>
            <tbody>
                <tr><td>Innovative</td><td>Adj</td><td>Đổi mới, sáng tạo</td></tr>
                <tr><td>Connectivity</td><td>Noun</td><td>Khả năng kết nối</td></tr>
                <tr><td>Monitor</td><td>Verb</td><td>Giám sát, theo dõi</td></tr>
            </tbody>
        </table>
    `,
    'reading3': `
        <h3>KIDS AND CELL PHONES</h3>
        <p>In this day and age, it’s inevitable that your kid will need a cell phone at some point. Buying a phone for your kid is a big decision. Not only is it a financial investment, but you also need to consider Internet safety and how kids can use electronics in a healthy way. “Today’s parents are both blessed and cursed by technology options made available to their children,’’ says Titania Jordan, the chief parenting officer of parental-control app Bark. “While the ability to locate and communicate with your children in real-time is incredible, the ability of others to do so can be frightening and dangerous.”</p>
        <p>When considering which cell phone to buy for your child, consider their age, the intended users of the phone, and the parental control options. If your teen just started driving, a smartphone with a built in GPS and full calling abilities in case of emergency may be a good bet. For a younger kid, a simple phone with no internet access that lets them text their parents may be all they need. You may even decide they don’t need a phone quite yet but can instead use a smart watch to text you and make short phone calls with approved contacts. To find the best cell phones for kids, we surveyed nearly 500 parents to learn about the phones they have bought for their own kids, as well as how their families navigate technology use. We also spoke to the Internet safety experts that specialize in kids’ safe use of phones. Additionally, we reviewed guidance from the American Academy of Pediatrics (AAP) regarding when to give your child a cell phone.</p>
        
        <table class="glossary-table">
            <thead><tr><th>Word</th><th>Type</th><th>Meaning</th></tr></thead>
            <tbody>
                <tr><td>Inevitable</td><td>Adj</td><td>Không thể tránh khỏi</td></tr>
                <tr><td>Financial investment</td><td>NP</td><td>Khoản đầu tư tài chính</td></tr>
                <tr><td>Navigate</td><td>Verb</td><td>Định hướng, xoay sở</td></tr>
            </tbody>
        </table>
    `,
    'gapfill_comp': `
        <h3>COMPUTERS</h3>
        <div class="gap-fill-options">
            <strong>Options Box:</strong><br>
            A – Computers are the most efficient servants man has ever had<br>
            B – Computers are capable of doing extremely complicated work in all kinds of learning.<br>
            C – Though computers are capable of learning from their mistakes and improving on their performance<br>
            D – Because they work accurately and at high speeds they save research workers years of hard work.
        </div>
        <p>One of the greatest advances in modern technology has been the invention of computers. They are already widely used in industry and in universities and the time may come when it will be common for everyone to use them as well. <strong>(37) ____</strong>. They can solve the most complex mathematical problem and put thousands of unrelated facts to order. <strong>(38) _____</strong>.</p>
        <p>It is a mistake to believe that these machines could “think”. There is no possibility that human beings will be controlled by machines. <strong>(39) ____</strong>, they need detailed instructions from human beings in order to be able to operate. They can never, as it were, lead independent lives or rule the world by making decisions of their own. <strong>(40) _____</strong> and there is no limit to the ways they can be used to improve our lives.</p>
    `
};

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    let currentSection = '';

    quizData.forEach((item, index) => {
        // Render Section Header & Reading Passage if needed
        if (item.section && item.section !== currentSection) {
            currentSection = item.section;
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-title';
            sectionDiv.innerText = currentSection;
            container.appendChild(sectionDiv);
        }

        if (item.data_text) {
             const dataDiv = document.createElement('div');
             dataDiv.className = 'data-box';
             dataDiv.innerHTML = item.data_text;
             container.appendChild(dataDiv);
        }

        if (item.text_ref && !document.getElementById('ref-'+item.text_ref)) {
            // Check if this reference was already rendered recently? 
            // Better logic: Only render if it's the first question of that block
            // We check by looking back at previous item
            const prevItem = quizData[index-1];
            if (!prevItem || prevItem.text_ref !== item.text_ref) {
                const textDiv = document.createElement('div');
                textDiv.className = 'data-box';
                textDiv.id = 'ref-'+item.text_ref;
                textDiv.innerHTML = readingContent[item.text_ref];
                container.appendChild(textDiv);
            }
        }

        // Render Card
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `q-${item.id}`;

        // Question
        const qText = document.createElement('div');
        qText.className = 'question-text';
        qText.innerHTML = (item.type !== 'image') 
            ? `Question ${item.id}: ${item.question}` 
            : item.question;
        card.appendChild(qText);

        // Image (if any)
        if (item.imageHTML) {
            const imgDiv = document.createElement('div');
            imgDiv.innerHTML = item.imageHTML;
            card.appendChild(imgDiv);
        }

        // Options
        const grid = document.createElement('div');
        grid.className = 'options-grid';

        item.options.forEach((opt, optIndex) => {
            const label = document.createElement('label');
            label.className = 'option-label';
            
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `q${item.id}`;
            input.value = optIndex;
            input.className = 'option-input';
            
            // Add click listener for selection state
            input.addEventListener('change', () => {
                // Remove selected from siblings
                grid.querySelectorAll('.option-label').forEach(l => l.style.backgroundColor = '#f8f9fa');
                label.style.backgroundColor = '#e2e6ea';
            });

            const span = document.createElement('span');
            span.innerHTML = `${String.fromCharCode(65+optIndex)}. ${opt.text}`;

            label.appendChild(input);
            label.appendChild(span);
            grid.appendChild(label);
        });
        card.appendChild(grid);

        // Immediate Check Button
        const btnCheck = document.createElement('button');
        btnCheck.className = 'btn-check';
        btnCheck.innerText = '🔍 Xem giải thích ngay';
        btnCheck.onclick = () => checkQuestion(item.id);
        card.appendChild(btnCheck);

        // Explanation Box
        const explBox = document.createElement('div');
        explBox.className = 'explanation';
        explBox.id = `expl-${item.id}`;
        explBox.innerHTML = `
            <span class="expl-title">💡 Giải thích chi tiết:</span>
            ${item.explanation}
        `;
        card.appendChild(explBox);

        container.appendChild(card);
    });
}

function checkQuestion(qId) {
    const item = quizData.find(q => q.id === qId);
    const card = document.getElementById(`q-${qId}`);
    const selected = card.querySelector(`input[name="q${qId}"]:checked`);
    const labels = card.querySelectorAll('.option-label');
    const explBox = document.getElementById(`expl-${qId}`);

    if (!selected) {
        alert("Bạn vui lòng chọn một đáp án trước khi xem giải thích!");
        return;
    }

    const userAns = parseInt(selected.value);
    
    // Highlight Correct/Incorrect
    labels.forEach((label, idx) => {
        label.classList.remove('correct', 'incorrect');
        if (idx === item.correct) {
            label.classList.add('correct');
        } else if (idx === userAns && idx !== item.correct) {
            label.classList.add('incorrect');
        }
    });

    // Show Explanation
    explBox.classList.add('visible');
    
    // Disable inputs for this question
    card.querySelectorAll('input').forEach(inp => inp.disabled = true);
    // Hide check button
    card.querySelector('.btn-check').style.display = 'none';
}

function submitAll() {
    let score = 0;
    let unanswered = 0;

    quizData.forEach(item => {
        const card = document.getElementById(`q-${item.id}`);
        const selected = card.querySelector(`input[name="q${item.id}"]:checked`);
        const labels = card.querySelectorAll('.option-label');
        const explBox = document.getElementById(`expl-${item.id}`);

        // Reveal logic
        labels.forEach((label, idx) => {
            label.classList.remove('correct', 'incorrect');
            if (idx === item.correct) label.classList.add('correct');
        });

        if (selected) {
            if (parseInt(selected.value) === item.correct) {
                score++;
            } else {
                labels[parseInt(selected.value)].classList.add('incorrect');
            }
        } else {
            unanswered++;
            card.style.borderLeft = "5px solid var(--accent)"; // Mark unanswered
        }

        // Always show explanation on submit
        explBox.classList.add('visible');
        card.querySelectorAll('input').forEach(inp => inp.disabled = true);
        card.querySelector('.btn-check').style.display = 'none';
    });

    const scoreText = document.getElementById('score-area');
    scoreText.innerText = `Kết quả: ${score}/${quizData.length}`;
    
    let msg = `Bạn làm đúng ${score}/${quizData.length} câu.\n`;
    if (unanswered > 0) msg += `Bạn đã bỏ qua ${unanswered} câu. Hãy xem lại giải thích màu vàng nhé!`;
    alert(msg);
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

document.getElementById('btn-submit').addEventListener('click', submitAll);

// Init
renderQuiz();

</script>

</body>
</html>


