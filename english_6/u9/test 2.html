<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms. Mai An - English Test Unit 9</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 0.5px, transparent 0.5px), radial-gradient(#8854c0 0.5px, #f0f4f8 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 0 rgba(136, 84, 192, 0.2);
            border: 3px solid var(--primary-pink);
        }

        h1 {
            color: var(--primary-pink);
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
        }

        .subtitle {
            color: #636e72;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* QUESTION CARD */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 #dfe6e9;
            border: 2px solid #f1f2f6;
            position: relative;
            transition: transform 0.3s;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .question-text u {
            text-decoration: underline;
            text-decoration-thickness: 3px;
            text-decoration-color: var(--primary-pink);
            text-underline-offset: 3px;
        }

        /* OPTIONS */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #dfe6e9;
            border-radius: 15px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #dfe6e9;
            position: relative;
        }

        .option-btn:hover {
            transform: scale(1.02);
            border-color: var(--primary-teal);
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #dfe6e9;
        }

        .option-btn.correct {
            background-color: #d1fae5;
            border-color: var(--correct);
            box-shadow: 0 5px 0 #059669;
            color: #065f46;
        }

        .option-btn.wrong {
            background-color: #fee2e2;
            border-color: var(--wrong);
            box-shadow: 0 5px 0 #b91c1c;
            color: #991b1b;
            animation: shake 0.5s;
        }

        /* EXPLANATION BOX */
        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            border-radius: 10px;
            display: none; /* Hidden by default */
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .explanation.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .teacher-tag {
            font-weight: 800;
            color: var(--primary-pink);
            margin-bottom: 10px;
            display: block;
        }

        .expl-step {
            margin-bottom: 8px;
        }

        /* READING & GAP FILL STYLES */
        .reading-passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed var(--primary-teal);
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .glossary-table th {
            background: var(--primary-pink);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }

        /* GAP FILL SPECIAL LAYOUT (Q37-40) */
        .gap-fill-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .options-box {
            background: #e0f2f1;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid var(--primary-teal);
        }

        /* CUSTOM SIGNS (Q29, Q30) */
        .sign-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .stamp-sold-out {
            border: 5px double #D32F2F;
            color: #D32F2F;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 900;
            font-size: 2rem;
            padding: 10px 20px;
            text-transform: uppercase;
            transform: rotate(-10deg);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: inline-block;
        }

        .sign-no-grass {
            width: 120px;
            height: 120px;
            border: 10px solid #D32F2F;
            border-radius: 50%;
            position: relative;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .sign-no-grass::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 100%;
            background: #D32F2F;
            transform: rotate(-45deg);
        }

        .sign-content {
            font-size: 3.5rem;
            z-index: 1;
        }

        /* FOOTER & BUTTONS */
        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 0 #5f27cd;
            display: block;
            margin: 40px auto;
            transition: transform 0.2s;
        }

        .submit-btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #5f27cd;
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CONFETTI CANVAS */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: slideDown 0.5s;
            max-width: 400px;
            width: 90%;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-pink);
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>UNIT 9 ‚Äì CITIES OF THE WORLD</h1>
            <div class="subtitle">Test 02 | Teacher: Ms. Mai An ULIS</div>
        </header>

        <div id="quiz-container">
            </div>

        <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI (SUBMIT)</button>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2>K·∫øt Qu·∫£</h2>
            <div class="score-display" id="finalScore">0/40</div>
            <p id="feedbackText">L√†m t·ªët l·∫Øm!</p>
            <button class="submit-btn" style="margin-top:20px; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const quizData = [
            // PHONETICS
            {
                id: 1,
                type: 'mcq',
                question: "Choose the word whose underlined part differs from the other three in pronunciation.",
                text: "A. c<u>oa</u>ch &nbsp;&nbsp; B. s<u>oa</u>r &nbsp;&nbsp; C. s<u>oa</u>p &nbsp;&nbsp; D. l<u>oa</u>d",
                options: ["A", "B", "C", "D"],
                correct: 1, // Index of B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    1. <b>Ph√¢n t√≠ch phi√™n √¢m:</b><br>
                    - A. Coach /k…ô ät É/ (Xe kh√°ch)<br>
                    - B. Soar /s…îÀêr/ (Bay v√∫t l√™n) -> √Çm /…îÀê/<br>
                    - C. Soap /s…ô äp/ (X√† ph√≤ng)<br>
                    - D. Load /l…ô äd/ (Ch·∫•t t·∫£i)<br>
                    2. <b>K·∫øt lu·∫≠n:</b> Ch·ªçn ƒë√°p √°n B v√¨ ph√°t √¢m l√† /…îÀê/, c√°c t·ª´ c√≤n l·∫°i l√† /…ô ä/.
                `
            },
            {
                id: 2,
                type: 'mcq',
                question: "Choose the word whose underlined part differs from the other three in pronunciation.",
                text: "A. sn<u>ow</u> &nbsp;&nbsp; B. h<u>ow</u> &nbsp;&nbsp; C. all<u>ow</u> &nbsp;&nbsp; D. c<u>ow</u>",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    1. <b>Ph√¢n t√≠ch phi√™n √¢m:</b><br>
                    - A. Snow /sn…ô ä/ (Tuy·∫øt) -> √Çm /…ô ä/<br>
                    - B. How /ha ä/ (Nh∆∞ th·∫ø n√†o)<br>
                    - C. Allow /…ôÀàla ä/ (Cho ph√©p)<br>
                    - D. Cow /ka ä/ (Con b√≤)<br>
                    2. <b>K·∫øt lu·∫≠n:</b> Ch·ªçn ƒë√°p √°n A v√¨ ph√°t √¢m l√† /…ô ä/, c√°c t·ª´ c√≤n l·∫°i l√† /a ä/.
                `
            },
            // STRESS
            {
                id: 3,
                type: 'mcq',
                question: "Choose the word that differs from the other three in the position of primary stress.",
                text: "A. earthquake &nbsp;&nbsp; B. program &nbsp;&nbsp; C. courage &nbsp;&nbsp; D. prestige",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    1. <b>Ph√¢n t√≠ch tr·ªçng √¢m:</b><br>
                    - A. Earthquake /Àà…úÀêŒ∏.kwe…™k/ (Tr·ªçng √¢m 1)<br>
                    - B. Program /Ààpr…ô ä.…°r√¶m/ (Tr·ªçng √¢m 1)<br>
                    - C. Courage /Ààk år.…™d í/ (Tr·ªçng √¢m 1)<br>
                    - D. Prestige /presÀàtiÀê í/ (Tr·ªçng √¢m 2 - Quy t·∫Øc: t·ª´ vay m∆∞·ª£n ti·∫øng Ph√°p th∆∞·ªùng nh·∫•n √¢m cu·ªëi)<br>
                    2. <b>K·∫øt lu·∫≠n:</b> Ch·ªçn D.
                `
            },
            {
                id: 4,
                type: 'mcq',
                question: "Choose the word that differs from the other three in the position of primary stress.",
                text: "A. receive &nbsp;&nbsp; B. crowded &nbsp;&nbsp; C. helmet &nbsp;&nbsp; D. helpful",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    1. <b>Ph√¢n t√≠ch tr·ªçng √¢m:</b><br>
                    - A. Receive /r…™ÀàsiÀêv/ (Tr·ªçng √¢m 2)<br>
                    - B. Crowded /Ààkra ä.d…™d/ (Tr·ªçng √¢m 1)<br>
                    - C. Helmet /Ààhel.m…ôt/ (Tr·ªçng √¢m 1)<br>
                    - D. Helpful /Ààhelp.f…ôl/ (Tr·ªçng √¢m 1)<br>
                    2. <b>K·∫øt lu·∫≠n:</b> Ch·ªçn A.
                `
            },
            // GRAMMAR & VOCAB
            {
                id: 5,
                type: 'mcq',
                question: "Question 5: Quoc Tu Giam is regarded as the first national __________ of Viet Nam.",
                text: "A. Capital &nbsp;&nbsp; B. university &nbsp;&nbsp; C. temple &nbsp;&nbsp; D. school",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>D·ªãch c√¢u:</b> Qu·ªëc T·ª≠ Gi√°m ƒë∆∞·ª£c xem l√† tr∆∞·ªùng ƒë·∫°i h·ªçc qu·ªëc gia ƒë·∫ßu ti√™n c·ªßa Vi·ªát Nam.<br>
                    <b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b><br>
                    - A. Capital: Th·ªß ƒë√¥<br>
                    - B. University: Tr∆∞·ªùng ƒë·∫°i h·ªçc (ƒê√∫ng ki·∫øn th·ª©c th·ª±c t·∫ø)<br>
                    - C. Temple: ƒê·ªÅn<br>
                    - D. School: Tr∆∞·ªùng h·ªçc (chung chung)<br>
                    => Ch·ªçn <b>B</b> theo danh x∆∞ng l·ªãch s·ª≠ "The first national university".
                `
            },
            {
                id: 6,
                type: 'mcq',
                question: "Question 6: Asia is Earth‚Äôs largest and most populous ____________.",
                text: "A. Island &nbsp;&nbsp; B. country &nbsp;&nbsp; C. ocean &nbsp;&nbsp; D. continent",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>D·ªãch c√¢u:</b> Ch√¢u √Å l√† _____ l·ªõn nh·∫•t v√† ƒë√¥ng d√¢n nh·∫•t Tr√°i ƒê·∫•t.<br>
                    <b>Ph√¢n t√≠ch:</b><br>
                    - A. Island: ƒê·∫£o<br>
                    - B. Country: Qu·ªëc gia<br>
                    - C. Ocean: ƒê·∫°i d∆∞∆°ng<br>
                    - D. Continent: Ch√¢u l·ª•c<br>
                    => Ch√¢u √Å l√† m·ªôt ch√¢u l·ª•c. Ch·ªçn <b>D</b>.
                `
            },
            {
                id: 7,
                type: 'mcq',
                question: "Question 7: Young people ______obey their parents.",
                text: "A. Must &nbsp;&nbsp; B. may &nbsp;&nbsp; C. will &nbsp;&nbsp; D. ought to",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>D·ªãch c√¢u:</b> Ng∆∞·ªùi tr·∫ª _____ v√¢ng l·ªùi cha m·∫π.<br>
                    <b>Ng·ªØ ph√°p (Modal Verbs):</b><br>
                    - A. Must: Ph·∫£i (Mang t√≠nh b·∫Øt bu·ªôc c∆∞·ª°ng ch·∫ø)<br>
                    - B. May: C√≥ l·∫Ω<br>
                    - C. Will: S·∫Ω<br>
                    - D. Ought to (= Should): N√™n (Mang t√≠nh khuy√™n rƒÉn, b·ªïn ph·∫≠n ƒë·∫°o ƒë·ª©c)<br>
                    => Trong b·ªëi c·∫£nh n√†y, n√≥i v·ªÅ b·ªïn ph·∫≠n ƒë·∫°o ƒë·ª©c d√πng <b>ought to</b> l√† ph√π h·ª£p nh·∫•t. Ch·ªçn <b>D</b>.
                `
            },
            {
                id: 8,
                type: 'mcq',
                question: "Question 8: I ______ be delighted to show you round the factory.",
                text: "A. Ought to &nbsp;&nbsp; B. would &nbsp;&nbsp; C. might &nbsp;&nbsp; D. can",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>C·∫•u tr√∫c:</b> "I would be delighted to..." (T√¥i r·∫•t h√¢n h·∫°nh/vui l√≤ng ƒë∆∞·ª£c...)<br>
                    ƒê√¢y l√† c√¢u n√≥i l·ªãch s·ª± khi nh·∫≠n l·ªùi ho·∫∑c ƒë·ªÅ ngh·ªã l√†m g√¨ gi√∫p ai.<br>
                    => Ch·ªçn <b>B</b>.
                `
            },
            {
                id: 9,
                type: 'mcq',
                question: "Question 9: Our city is very crowded. How about ______?",
                text: "A. Yours &nbsp;&nbsp; B. you &nbsp;&nbsp; C. your &nbsp;&nbsp; D. me",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>Ng·ªØ c·∫£nh:</b> Th√†nh ph·ªë c·ªßa ch√∫ng t√¥i r·∫•t ƒë√¥ng. C√≤n [th√†nh ph·ªë c·ªßa b·∫°n] th√¨ sao?<br>
                    <b>Ng·ªØ ph√°p:</b> Ta c·∫ßn m·ªôt ƒê·∫°i t·ª´ s·ªü h·ªØu (Possessive Pronoun) ƒë·ªÉ thay th·∫ø cho c·ª•m danh t·ª´ "your city" ƒë√£ nh·∫Øc ƒë·∫øn ng·∫ßm √Ω.<br>
                    - A. Yours = Your city (ƒê√∫ng)<br>
                    - B. You: B·∫°n (Sai nghƒ©a)<br>
                    - C. Your: T√≠nh t·ª´ s·ªü h·ªØu (Ph·∫£i ƒëi k√®m danh t·ª´, v√≠ d·ª• "Your city")<br>
                    => Ch·ªçn <b>A</b>.
                `
            },
            {
                id: 10,
                type: 'mcq',
                question: "Question 10: He did not bring his briefcase, but I brought _________.",
                text: "A. My &nbsp;&nbsp; B. mine &nbsp;&nbsp; C. me &nbsp;&nbsp; D. I",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>Ng·ªØ c·∫£nh:</b> Anh ·∫•y kh√¥ng mang c·∫∑p, nh∆∞ng t√¥i ƒë√£ mang [c·∫∑p c·ªßa t√¥i].<br>
                    <b>Ng·ªØ ph√°p:</b> T∆∞∆°ng t·ª± c√¢u tr√™n, c·∫ßn ƒê·∫°i t·ª´ s·ªü h·ªØu thay th·∫ø cho "my briefcase".<br>
                    - A. My (+Noun)<br>
                    - B. Mine = My briefcase (ƒê√∫ng)<br>
                    => Ch·ªçn <b>B</b>.
                `
            },
            {
                id: 11,
                type: 'mcq',
                question: "Question 11: _______a lovely garden your cousin has!",
                text: "A. How &nbsp;&nbsp; B. Whose &nbsp;&nbsp; C. Who &nbsp;&nbsp; D. Which",
                options: ["A", "B", "C", "D"],
                correct: 0, // A (Based on prompt structure limitation, usually What)
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>D·ªãch c√¢u:</b> Em h·ªç b·∫°n c√≥ khu v∆∞·ªùn ƒë√°ng y√™u l√†m sao!<br>
                    <b>Ng·ªØ ph√°p (C√¢u c·∫£m th√°n):</b><br>
                    - C·∫•u tr√∫c chu·∫©n: <i>What + (a/an) + Adj + N + S + V!</i> (V√≠ d·ª•: What a lovely garden your cousin has!)<br>
                    - Tuy nhi√™n, ƒë·ªÅ b√†i kh√¥ng c√≥ "What". Trong c√°c ƒë√°p √°n c√≤n l·∫°i, "How" l√† t·ª´ ƒë·ªÉ h·ªèi/c·∫£m th√°n duy nh·∫•t ph√π h·ª£p v·ªÅ m·∫∑t ng·ªØ nghƒ©a (d√π c·∫•u tr√∫c <i>How a lovely garden...</i> l√† kh√¥ng chu·∫©n ng·ªØ ph√°p ti·∫øng Anh hi·ªán ƒë·∫°i, th∆∞·ªùng ph·∫£i l√† <i>How lovely a garden...</i>).<br>
                    - Lo·∫°i B, C, D v√¨ sai ho√†n to√†n nghƒ©a.<br>
                    => Trong khu√¥n kh·ªï b√†i thi n√†y, ch·ªçn <b>A</b>.
                `
            },
            {
                id: 12,
                type: 'mcq',
                question: "Question 12: ‚ÄúWhat would you like to drink now?‚Äù ‚Äì ‚Äú _________.‚Äù",
                text: "A. Yes, please &nbsp;&nbsp; B. Apple juice please &nbsp;&nbsp; C. No &nbsp;&nbsp; D. Thank you",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>D·ªãch c√¢u h·ªèi:</b> "B√¢y gi·ªù b·∫°n mu·ªën u·ªëng g√¨?" (C√¢u h·ªèi WH-question, kh√¥ng ph·∫£i Yes/No).<br>
                    <b>Ph√¢n t√≠ch:</b><br>
                    - A. V√¢ng, l√†m ∆°n (Tr·∫£ l·ªùi cho c√¢u m·ªùi)<br>
                    - B. N∆∞·ªõc t√°o, l√†m ∆°n (ƒê∆∞a ra l·ª±a ch·ªçn -> ƒê√∫ng)<br>
                    - C. Kh√¥ng (Tr·∫£ l·ªùi Yes/No)<br>
                    => Ch·ªçn <b>B</b>.
                `
            },
            // READING CLOZE (13-16)
            {
                id: 13,
                type: 'reading_group',
                readingText: `
                    <h3 style="color:var(--primary-pink); text-align:center;">GOLDEN TRAVEL OPPORTUNITY</h3>
                    We are thrilled to announce that after months of preparation, WORLD EXPLORER TOUR (13) ______ officially launched next summer. This is your chance to visit the most famous cities (14) ____ experience different cultures, breathtaking landmarks, and unique (15) _____. The journey will be (16) ______. Don‚Äôt miss out!
                `,
                glossary: [
                    {w: "Thrilled", t: "adj", m: "H√†o h·ª©ng/Vui s∆∞·ªõng"},
                    {w: "Launch", t: "v", m: "Ra m·∫Øt/Khai tr∆∞∆°ng"},
                    {w: "Breathtaking", t: "adj", m: "Ngo·∫°n m·ª•c"},
                    {w: "Landmark", t: "n", m: "Danh th·∫Øng"},
                    {w: "Unique", t: "adj", m: "ƒê·ªôc ƒë√°o"}
                ],
                questions: [
                    {
                        subId: 13,
                        question: "Question 13:",
                        text: "A. is &nbsp;&nbsp; B. are &nbsp;&nbsp; C. am &nbsp;&nbsp; D. be",
                        options: ["A", "B", "C", "D"],
                        correct: 0, // A
                        explanation: `Ch·ªß ng·ªØ "WORLD EXPLORER TOUR" l√† s·ªë √≠t. C·∫•u tr√∫c b·ªã ƒë·ªông ·ªü hi·ªán t·∫°i (ho·∫∑c t∆∞∆°ng lai g·∫ßn trong l·ªãch tr√¨nh): "is launched". Ch·ªçn <b>A</b>.`
                    },
                    {
                        subId: 14,
                        question: "Question 14:",
                        text: "A. so &nbsp;&nbsp; B. and &nbsp;&nbsp; C. but &nbsp;&nbsp; D. or",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `"Visit... AND experience..." (ThƒÉm quan V√Ä tr·∫£i nghi·ªám). Hai h√†nh ƒë·ªông song song b·ªï tr·ª£ nhau. Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 15,
                        question: "Question 15:",
                        text: "A. food &nbsp;&nbsp; B. cuisines &nbsp;&nbsp; C. drink &nbsp;&nbsp; D. drinking",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `C·ª•m t·ª´ "Unique cuisines" (Nh·ªØng n·ªÅn ·∫©m th·ª±c ƒë·ªôc ƒë√°o). "Cuisines" bao h√†m c·∫£ vƒÉn h√≥a ƒÉn u·ªëng, sang tr·ªçng h∆°n "food". Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 16,
                        question: "Question 16:",
                        text: "A. entertaining &nbsp;&nbsp; B. educational &nbsp;&nbsp; C. excited &nbsp;&nbsp; D. rewarding",
                        options: ["A", "B", "C", "D"],
                        correct: 3, // D (or B)
                        explanation: `Chuy·∫øn ƒëi tr·∫£i nghi·ªám vƒÉn h√≥a th∆∞·ªùng ƒë∆∞·ª£c m√¥ t·∫£ l√† "Rewarding" (ƒê√°ng gi√°/ƒêem l·∫°i nhi·ªÅu l·ª£i √≠ch) ho·∫∑c "Educational". Trong vƒÉn c·∫£nh qu·∫£ng c√°o du l·ªãch tr·∫£i nghi·ªám vƒÉn h√≥a, "Rewarding" l√† t·ª´ v·ª±ng ƒë·∫Øt gi√° nh·∫•t ƒë·ªÉ ch·ªâ s·ª± th·ªèa m√£n tr·ªçn v·∫πn. Ch·ªçn <b>D</b>.`
                    }
                ]
            },
            // JUMBLED SENTENCES (17-18)
            {
                id: 17,
                type: 'mcq',
                question: "Question 17: Rearrange the sentences to make a meaningful paragraph.",
                text: "a. The air was fresh and the scenery was breathtaking.<br>b. First, I enjoyed the peace and quiet away from the city.<br>c. Moreover, the animals were grazing in the fields.<br>d. Second, the local people were very welcoming.<br>e. Visiting countryside is quite rewarding.",
                options: ["A. e-b-c-d-a", "B. e-b-a-d-c", "C. e-a-d-b-c", "D. e-b-d-c-a"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>Logic s·∫Øp x·∫øp:</b><br>
                    1. <b>(e)</b> C√¢u ch·ªß ƒë·ªÅ: Visiting countryside is quite rewarding.<br>
                    2. <b>(b)</b> B·∫Øt ƒë·∫ßu lu·∫≠n ƒëi·ªÉm 1: First, I enjoyed peace...<br>
                    3. <b>(a)</b> B·ªï sung cho lu·∫≠n ƒëi·ªÉm 1 (Thi√™n nhi√™n): Air fresh, scenery...<br>
                    4. <b>(d)</b> Lu·∫≠n ƒëi·ªÉm 2 (Con ng∆∞·ªùi): Second, local people...<br>
                    5. <b>(c)</b> Th√™m m·ªôt chi ti·∫øt n·ªØa (Thi√™n nhi√™n/C·∫£nh v·∫≠t): Moreover, animals... (Ho·∫∑c c√¢u n√†y b·ªï sung cho √Ω c·∫£nh v·∫≠t).<br>
                    Trong c√°c ph∆∞∆°ng √°n, tr·∫≠t t·ª± <b>e-b-a-d-c</b> (Topic -> First -> Detail -> Second -> Moreover) l√† m·∫°ch l·∫°c nh·∫•t. Ch·ªçn <b>B</b>.
                `
            },
            {
                id: 18,
                type: 'mcq',
                question: "Question 18: Choose the sentence that can end the text (in Question 17) most suitably.",
                text: "A. I can‚Äôt wait to go back again someday.<br>B. The city is much more exciting<br>C. It was a very expensive trip.<br>D. I prefer the beach to the countryside.",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    ƒêo·∫°n vƒÉn ƒëang khen ng·ª£i v√πng qu√™ (rewarding, fresh air, welcoming).<br>
                    - C√¢u k·∫øt c·∫ßn mang t√≠nh t√≠ch c·ª±c t∆∞∆°ng ·ª©ng.<br>
                    - A. "T√¥i n√≥ng l√≤ng mu·ªën quay l·∫°i" -> T√≠ch c·ª±c (ƒê√∫ng).<br>
                    - C√°c c√¢u B, C, D ƒë·ªÅu mang nghƒ©a so s√°nh ti√™u c·ª±c ho·∫∑c kh√¥ng li√™n quan.<br>
                    => Ch·ªçn <b>A</b>.
                `
            },
            // READING CLOZE 2 (HOI AN)
            {
                id: 19,
                type: 'reading_group',
                readingText: `
                    Hoi An is one of the (19) _____ towns in Viet Nam. It (20) _____ on the lower section of the Thu Bon River. It is a very beautiful town with a lot of color fill (21) ____ which are hung around the town. Hoi An is famous for one (22) _____ tailoring. Customers order clothes in the morning and get them in (23) ___ evening. The price is not really expensive (24) ____ you want to find the place of the new time, Hoi An is a good choice.
                `,
                glossary: [
                    {w: "Lantern", t: "n", m: "ƒê√®n l·ªìng"},
                    {w: "Tailoring", t: "n", m: "May m·∫∑c"},
                    {w: "Lower section", t: "n", m: "H·∫° l∆∞u"},
                    {w: "Famous for", t: "phrase", m: "N·ªïi ti·∫øng v·ªÅ"}
                ],
                questions: [
                    {
                        subId: 19,
                        question: "Question 19:",
                        text: "A. newer &nbsp;&nbsp; B. newest &nbsp;&nbsp; C. oldest &nbsp;&nbsp; D. older",
                        options: ["A", "B", "C", "D"],
                        correct: 2, // C
                        explanation: `Ki·∫øn th·ª©c th·ª±c t·∫ø: H·ªôi An l√† "Ph·ªë c·ªï" -> Oldest towns. Ng·ªØ ph√°p: So s√°nh nh·∫•t "One of the oldest". Ch·ªçn <b>C</b>.`
                    },
                    {
                        subId: 20,
                        question: "Question 20:",
                        text: "A. are &nbsp;&nbsp; B. is &nbsp;&nbsp; C. are being &nbsp;&nbsp; D. be",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `Ch·ªß ng·ªØ "It" (H·ªôi An) s·ªë √≠t -> ƒë·ªông t·ª´ to be l√† "is" (n·∫±m ·ªü...). Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 21,
                        question: "Question 21:",
                        text: "A. lanterns &nbsp;&nbsp; B. pumpkins &nbsp;&nbsp; C. balloons &nbsp;&nbsp; D. stars",
                        options: ["A", "B", "C", "D"],
                        correct: 0, // A
                        explanation: `H·ªôi An n·ªïi ti·∫øng v·ªõi "Colorful lanterns" (ƒê√®n l·ªìng nhi·ªÅu m√†u s·∫Øc). Ch·ªçn <b>A</b>.`
                    },
                    {
                        subId: 22,
                        question: "Question 22:",
                        text: "A. day &nbsp;&nbsp; B. week &nbsp;&nbsp; C. month &nbsp;&nbsp; D. year",
                        options: ["A", "B", "C", "D"],
                        correct: 0, // A
                        explanation: `D·∫´n ch·ª©ng c√¢u sau: "Order in morning, get in evening" (S√°ng ƒë·∫∑t, t·ªëi l·∫•y) -> May ƒëo trong 1 ng√†y (One-day tailoring). Ch·ªçn <b>A</b>.`
                    },
                    {
                        subId: 23,
                        question: "Question 23:",
                        text: "A. a &nbsp;&nbsp; B. an &nbsp;&nbsp; C. the &nbsp;&nbsp; D. X",
                        options: ["A", "B", "C", "D"],
                        correct: 2, // C
                        explanation: `C·ª•m t·ª´ ch·ªâ th·ªùi gian trong ng√†y: "In THE evening". Ch·ªçn <b>C</b>.`
                    },
                    {
                        subId: 24,
                        question: "Question 24:",
                        text: "A. unless &nbsp;&nbsp; B. if &nbsp;&nbsp; C. or &nbsp;&nbsp; D. because",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `C√¢u ƒëi·ªÅu ki·ªán: "N·∫øu b·∫°n mu·ªën t√¨m...". Ch·ªçn <b>B (If)</b>.`
                    }
                ]
            },
            // TRANSFORMATION
            {
                id: 25,
                type: 'mcq',
                question: "Question 25: She plays the piano very skillfully!",
                text: "A. How skillfully she plays the piano!<br>B. What skillfully she plays the piano!<br>C. How skillfully does she play the piano!<br>D. How skillfully does she plays the piano!",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>C·∫•u tr√∫c c·∫£m th√°n v·ªõi HOW:</b><br>
                    <i>How + adv/adj + S + V!</i><br>
                    - A. ƒê√∫ng c·∫•u tr√∫c.<br>
                    - B. Sai (What + Noun phrase).<br>
                    - C, D. Sai (D∆∞ tr·ª£ ƒë·ªông t·ª´ "does" -> ƒë√¢y l√† c·∫•u tr√∫c c√¢u h·ªèi).<br>
                    => Ch·ªçn <b>A</b>.
                `
            },
            {
                id: 26,
                type: 'mcq',
                question: "Question 26: She dances very well!",
                text: "A. How well she dances!<br>B. How she dances very well<br>C. How well does she dance<br>D. How well does she dances!",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    T∆∞∆°ng t·ª± c√¢u 25. C·∫•u tr√∫c: <i>How + adv (well) + S (she) + V (dances)!</i><br>
                    => Ch·ªçn <b>A</b>.
                `
            },
            {
                id: 27,
                type: 'mcq',
                question: "Question 27: We/ begin/ eat/ when/ it/ start/ rain.",
                text: "A. We began eating when it started to rain.<br>B. We begin to eat when it started to rain.<br>C. We began eat when it started to rain.<br>D. We begin eat when it starts to rain.",
                options: ["A", "B", "C", "D"],
                correct: 0, // A
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>Ph√¢n t√≠ch:</b> H√†nh ƒë·ªông trong qu√° kh·ª© k·ªÉ l·∫°i.<br>
                    - D√πng qu√° kh·ª© ƒë∆°n (began, started).<br>
                    - C·∫•u tr√∫c: Begin + V-ing/To V.<br>
                    - A: Began eating... started to rain. (ƒê√∫ng th√¨, ƒë√∫ng c·∫•u tr√∫c).<br>
                    - B: Sai th√¨ (begin).<br>
                    - C: Sai c·∫•u tr√∫c (began eat).<br>
                    => Ch·ªçn <b>A</b>.
                `
            },
            {
                id: 28,
                type: 'mcq',
                question: "Question 28: Last time/ she/ call/ me/ be/ 5 months ago.",
                text: "A. Last time she called me is 5 months ago.<br>B. Last time she called me was 5 months ago.<br>C. Last time she calls me was 5 months ago.<br>D. Last time she is calling me was 5 months ago.",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>C·∫•u tr√∫c:</b> "The last time + S + V(ed) + was + time."<br>
                    - V√¨ s·ª± vi·ªác x·∫£y ra trong qu√° kh·ª© n√™n ƒë·ªông t·ª´ "call" chia "called" v√† ƒë·ªông t·ª´ to be chia "was".<br>
                    - A. Sai (is).<br>
                    - C. Sai (calls).<br>
                    => Ch·ªçn <b>B</b>.
                `
            },
            // IMAGES
            {
                id: 29,
                type: 'mcq',
                question: "Question 29: What does the sign mean?",
                imageHTML: `<div class="sign-container"><div class="stamp-sold-out">SOLD OUT</div></div>`,
                text: "A. Very much<br>B. No have anything<br>C. Only one thing<br>D. Still a few",
                options: ["A", "B", "C", "D"],
                correct: 1, // B
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    <b>Sold Out</b> nghƒ©a l√† "ƒê√£ b√°n h·∫øt".<br>
                    - B. "No have anything" (C√°ch di·ªÖn ƒë·∫°t kh√¥ng chu·∫©n ng·ªØ ph√°p nh∆∞ng √Ω l√† "Kh√¥ng c√≤n g√¨ c·∫£") -> T∆∞∆°ng ƒë·ªìng nghƒ©a nh·∫•t trong 4 ƒë√°p √°n.<br>
                    - C√°c ƒë√°p √°n kh√°c (Nhi·ªÅu, Ch·ªâ m·ªôt, C√≤n m·ªôt √≠t) ƒë·ªÅu sai nghƒ©a.<br>
                    => Ch·ªçn <b>B</b>.
                `
            },
            {
                id: 30,
                type: 'mcq',
                question: "Question 30: What does the sign mean?",
                imageHTML: `<div class="sign-container"><div class="sign-no-grass"><div class="sign-content">üëüüåø</div></div></div>`,
                text: "A. You can play here.<br>B. You can‚Äôt play here<br>C. You must walk on the grass<br>D. You mustn‚Äôt walk on the grass.",
                options: ["A", "B", "C", "D"],
                correct: 3, // D
                explanation: `
                    <span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>
                    Bi·ªÉn b√°o c√≥ v√≤ng tr√≤n ƒë·ªè g·∫°ch ch√©o ƒë√® l√™n ch√¢n v√† c·ªè -> C·∫•m d·∫´m l√™n c·ªè.<br>
                    - D. You mustn't walk on the grass (B·∫°n kh√¥ng ƒë∆∞·ª£c ph√©p ƒëi tr√™n c·ªè).<br>
                    => Ch·ªçn <b>D</b>.
                `
            },
            // READING DA NANG
            {
                id: 31,
                type: 'reading_group',
                readingText: `
                    Da Nang has a population of nearly 800,000 people. The Han River flows through the city. The city part on the east bank is the newest and more spacious. The city part on the west bank is more crowded. There are five bridges across the river. The Han River Bridge is the newest one now. The cost of living in Da Nang is the lowest in Central Viet Nam. Da Nang has many beaches. Among them, Non Nuoc Beach is one of the most beautiful beaches in the world. But walking in the street on a summer afternoon is not a good idea in Da Nang. There are not many trees are not many shadows. It is often very hot at noon.
                `,
                glossary: [
                    {w: "Population", t: "n", m: "D√¢n s·ªë"},
                    {w: "Spacious", t: "adj", m: "R·ªông r√£i"},
                    {w: "Crowded", t: "adj", m: "ƒê√¥ng ƒë√∫c"},
                    {w: "Cost of living", t: "n", m: "Chi ph√≠ s·ªëng"},
                    {w: "Shadow", t: "n", m: "B√≥ng r√¢m"}
                ],
                questions: [
                    {
                        subId: 31,
                        question: "Question 31: What is the main idea of the passage?",
                        text: "A. Da Nang is the largest city in Viet Nam.<br>B. Da Nang is a modern city with many tall buildings.<br>C. Da Nang is a city with a river, bridges, and beautiful beaches.<br>D. Da Nang has a very high cost of living.",
                        options: ["A", "B", "C", "D"],
                        correct: 2, // C
                        explanation: `B√†i ƒë·ªçc m√¥ t·∫£ t·ªïng quan: S√¥ng H√†n, c·∫ßu, v√† b√£i bi·ªÉn. Ch·ªçn <b>C</b>.`
                    },
                    {
                        subId: 32,
                        question: "Question 32: Which word has the CLOSEST meaning as ‚Äúspacious‚Äù?",
                        text: "A. Crowded &nbsp;&nbsp; B. Large &nbsp;&nbsp; C. Expensive &nbsp;&nbsp; D. Beautiful",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `Spacious (R·ªông r√£i) = Large (R·ªông l·ªõn). Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 33,
                        question: "Question 33: Which word is the OPPOSITE of ‚Äúlowest‚Äù?",
                        text: "A. Cheapest &nbsp;&nbsp; B. Newest &nbsp;&nbsp; C. Highest &nbsp;&nbsp; D. Coldest",
                        options: ["A", "B", "C", "D"],
                        correct: 2, // C
                        explanation: `Lowest (Th·∫•p nh·∫•t) >< Highest (Cao nh·∫•t). Ch·ªçn <b>C</b>.`
                    },
                    {
                        subId: 34,
                        question: "Question 34: Which of the following is NOT TRUE according to the passage?",
                        text: "A. The Han River Bridge is the newest bridge in Da Nang.<br>B. There are 6 bridges across the Han River.<br>C. The cost of living in Da Nang is the lowest in Central Viet Nam.<br>D. Non Nuoc Beach is one of the most beautiful beaches in the world.",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `D·∫´n ch·ª©ng trong b√†i: "There are FIVE bridges" (C√≥ 5 c√¢y c·∫ßu). C√¢u B n√≥i c√≥ 6 l√† sai. Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 35,
                        question: "Question 35: Why is walking in the street on a summer afternoon not a good idea in Da Nang?",
                        text: "A. Because there are many cars and motorbikes.<br>B. Because there are not many trees and it is very hot.<br>C. Because the streets are very small.<br>D. Because it often rains in the summer.",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `D·∫´n ch·ª©ng cu·ªëi b√†i: "There are not many trees are not many shadows. It is often very hot at noon." Ch·ªçn <b>B</b>.`
                    },
                    {
                        subId: 36,
                        question: "Question 36: How many bridges are there across the Han River?",
                        text: "A. Four &nbsp;&nbsp; B. Five &nbsp;&nbsp; C. Six &nbsp;&nbsp; D. Seven",
                        options: ["A", "B", "C", "D"],
                        correct: 1, // B
                        explanation: `D·∫´n ch·ª©ng: "There are five bridges". Ch·ªçn <b>B</b>.`
                    }
                ]
            },
            // GAP FILL SPECIAL (PARIS)
            {
                id: 37,
                type: 'gap_fill_special',
                optionsBox: [
                    "A ‚Äì It is the most crowded city in this country",
                    "B ‚Äì Summer days are usually warm and pleasant",
                    "C - Paris is the capital city of France",
                    "D - Paris has about 30 million foreign visitors every year."
                ],
                passage: "(37) _____. Paris is known as ‚ÄúThe City of Light‚Äù. (38) _____. It has an area of 105 square kilometers. The climate is mild and wet all year round. (39) ____. The average temperatures are between 15 and 25 degree Celsius. Paris is very well-known with the Eiffel Tower. It is the landmark of the city. There is a famous church named Notre Dame, and an art museum named The Louvre. For its beauty, (40) ____.",
                questions: [
                    {qId: 37, correct: 2, exp: "C√¢u m·ªü ƒë·∫ßu gi·ªõi thi·ªáu chung: Paris l√† th·ªß ƒë√¥ c·ªßa Ph√°p. (C)"},
                    {qId: 38, correct: 0, exp: "Sau khi gi·ªõi thi·ªáu t√™n, n√≥i v·ªÅ ƒë·∫∑c ƒëi·ªÉm d√¢n s·ªë/di·ªán t√≠ch. (A) It is the most crowded... -> It has an area..."},
                    {qId: 39, correct: 1, exp: "C√¢u tr∆∞·ªõc n√≥i v·ªÅ Climate (Kh√≠ h·∫≠u). C√¢u sau n√≥i v·ªÅ Temperature (Nhi·ªát ƒë·ªô). Ch·ªó tr·ªëng c·∫ßn ƒëi·ªÅn th√¥ng tin v·ªÅ th·ªùi ti·∫øt m√πa h√®. (B)"},
                    {qId: 40, correct: 3, exp: "K·∫øt b√†i: V√¨ v·∫ª ƒë·∫πp c·ªßa n√≥ (For its beauty) -> K·∫øt qu·∫£ l√† thu h√∫t 30 tri·ªáu kh√°ch du l·ªãch. (D)"}
                ],
                glossary: [
                    {w: "Capital", t: "n", m: "Th·ªß ƒë√¥"},
                    {w: "Climate", t: "n", m: "Kh√≠ h·∫≠u"},
                    {w: "Foreign", t: "adj", m: "N∆∞·ªõc ngo√†i"},
                    {w: "Square kilometer", t: "n", m: "Km vu√¥ng"}
                ]
            }
        ];

        let score = 0;
        const totalQuestions = 40;

        // --- AUDIO (Using Web Audio API for no external dependencies) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Ding sound (High pitch sine wave)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
                fireConfetti();
            } else {
                // Wrong sound (Low pitch saw wave)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- RENDER QUIZ ---
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            
            quizData.forEach(item => {
                if (item.type === 'mcq') {
                    container.innerHTML += createMCQCard(item);
                } else if (item.type === 'reading_group') {
                    container.innerHTML += createReadingGroup(item);
                } else if (item.type === 'gap_fill_special') {
                    container.innerHTML += createGapFillSpecial(item);
                }
            });
        }

        function createMCQCard(data) {
            let imagePart = data.imageHTML ? data.imageHTML : '';
            return `
                <div class="card" id="card-${data.id}">
                    <div class="question-text">${data.question}</div>
                    ${imagePart}
                    <div style="margin-bottom: 20px; font-size: 1.1rem;">${data.text}</div>
                    <div class="options-grid">
                        ${data.options.map((opt, index) => `
                            <button class="option-btn" onclick="checkMCQ(${data.id}, ${index}, this)">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                    <div class="explanation" id="expl-${data.id}">
                        ${data.explanation}
                    </div>
                </div>
            `;
        }

        function createReadingGroup(data) {
            let html = `
                <div class="card">
                    <div class="reading-passage">
                        ${data.readingText}
                        ${createGlossary(data.glossary)}
                    </div>
            `;

            data.questions.forEach(q => {
                html += `
                    <div style="margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px;" id="card-${q.subId}">
                        <div class="question-text">${q.question}</div>
                        <div style="margin-bottom: 15px;">${q.text}</div>
                        <div class="options-grid">
                            ${q.options.map((opt, index) => `
                                <button class="option-btn" onclick="checkReading(${q.subId}, ${index}, this, ${q.correct}, '${escapeHtml(q.explanation)}')">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                        <div class="explanation" id="expl-${q.subId}"></div>
                    </div>
                `;
            });

            html += `</div>`;
            return html;
        }

        function createGapFillSpecial(data) {
            let html = `
                <div class="card">
                     <div class="question-text">Fill in the blanks (37-40)</div>
                    <div class="gap-fill-container">
                        <div class="options-box">
                            <strong>OPTIONS:</strong><br>
                            ${data.optionsBox.join('<br>')}
                        </div>
                        <div class="reading-passage">
                            ${data.passage}
                            ${createGlossary(data.glossary)}
                        </div>
                        <div class="options-grid" style="grid-template-columns: 1fr;">
            `;
            
            data.questions.forEach(q => {
                html += `
                    <div id="gf-${q.qId}" style="margin-bottom: 10px;">
                        <strong>Question ${q.qId}:</strong>
                        <div style="display:flex; gap:10px; margin-top:5px;">
                            ${['A', 'B', 'C', 'D'].map((opt, idx) => `
                                <button class="option-btn" style="width:50px; text-align:center;" onclick="checkGapFill(${q.qId}, ${idx}, this, ${q.correct}, '${escapeHtml(q.exp)}')">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                        <div class="explanation" id="expl-${q.qId}"></div>
                    </div>
                `;
            });

            html += `</div></div></div>`;
            return html;
        }

        function createGlossary(list) {
            if (!list) return '';
            return `
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                    ${list.map(w => `<tr><td><b>${w.w}</b></td><td><i>${w.t}</i></td><td>${w.m}</td></tr>`).join('')}
                </table>
            `;
        }

        function escapeHtml(text) {
            return text.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
        }

        // --- LOGIC ---
        function checkMCQ(id, selectedIdx, btn) {
            const question = quizData.find(q => q.id === id);
            const parent = btn.parentElement;
            const expl = document.getElementById(`expl-${id}`);
            
            // Disable buttons
            Array.from(parent.children).forEach(b => b.disabled = true);

            if (selectedIdx === question.correct) {
                btn.classList.add('correct');
                playSound('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                parent.children[question.correct].classList.add('correct'); // Show correct
                playSound('wrong');
            }
            expl.classList.add('show');
        }

        function checkReading(id, selectedIdx, btn, correctIdx, explText) {
            const parent = btn.parentElement;
            const explDiv = document.getElementById(`expl-${id}`);
            
            Array.from(parent.children).forEach(b => b.disabled = true);

            if (selectedIdx === correctIdx) {
                btn.classList.add('correct');
                playSound('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                parent.children[correctIdx].classList.add('correct');
                playSound('wrong');
            }
            explDiv.innerHTML = `<span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>${explText}`;
            explDiv.classList.add('show');
        }

        function checkGapFill(id, selectedIdx, btn, correctIdx, explText) {
            const parent = btn.parentElement;
            const explDiv = document.getElementById(`expl-${id}`);
            
            Array.from(parent.children).forEach(b => b.disabled = true);

            if (selectedIdx === correctIdx) {
                btn.classList.add('correct');
                playSound('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                parent.children[correctIdx].classList.add('correct');
                playSound('wrong');
            }
            explDiv.innerHTML = `<span class="teacher-tag">C√¥ Mai An gi·∫£i th√≠ch:</span>${explText}`;
            explDiv.classList.add('show');
        }

        function finishQuiz() {
            document.getElementById('finalScore').innerText = `${score} / ${totalQuestions}`;
            
            let msg = "";
            const percentage = (score / totalQuestions) * 100;
            if (percentage === 100) msg = "Xu·∫•t s·∫Øc! C√¥ Mai An r·∫•t t·ª± h√†o!";
            else if (percentage >= 80) msg = "Gi·ªèi l·∫Øm! C·ªë th√™m ch√∫t n·ªØa l√† ho√†n h·∫£o!";
            else if (percentage >= 50) msg = "Kh√° t·ªët! √în l·∫°i b√†i m·ªôt ch√∫t nh√©.";
            else msg = "C·∫ßn c·ªë g·∫Øng nhi·ªÅu h∆°n nh√©!";
            
            document.getElementById('feedbackText').innerText = msg;
            document.getElementById('resultModal').style.display = 'flex';
            if (percentage >= 50) fireConfetti();
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // --- CONFETTI EFFECT ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speed: Math.random() * 5 + 2
                });
            }

            function animate() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.y += p.speed;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    if(p.y < canvas.height) active = true;
                });
                if(active) requestAnimationFrame(animate);
                else ctx.clearRect(0,0,canvas.width,canvas.height);
            }
            animate();
        }

        // Init
        renderQuiz();

    </script>
</body>
</html>