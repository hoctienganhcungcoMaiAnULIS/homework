<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Carrot and The Ring - Ms Mai An ULIS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-pastel: #fdf2f8; 
            --card-bg: #ffffff;
            --text-color: #4a4a4a;
        }

        * {
            box-sizing: border-box;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-pink) #f0f0f0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pastel);
            background-image: 
                radial-gradient(circle at 15% 15%, rgba(255, 183, 178, 0.4) 0%, transparent 20%),
                radial-gradient(circle at 85% 85%, rgba(166, 228, 208, 0.4) 0%, transparent 20%),
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><text x="20" y="40" font-size="20">ü•ï</text><text x="70" y="90" font-size="20">üíç</text></svg>');
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            color: var(--text-color);
        }

        /* --- Header & Timer --- */
        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index: 100;
            border-bottom: 3px solid var(--primary-pink);
        }

        .teacher-name {
            font-size: 0.9rem;
            color: var(--primary-pink);
            font-weight: 700;
            font-family: 'Quicksand', sans-serif;
        }

        .timer-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #timer-display {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-pink);
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 0 #e0e0e0;
            border: 2px solid var(--primary-pink);
        }

        .timer-btn {
            background: var(--primary-teal);
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 3px 0 #009e82;
            transition: transform 0.1s;
        }

        .timer-btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        /* --- Main Layout --- */
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 70px);
        }

        .split-pane {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .split-pane.left {
            border-right: 2px dashed var(--primary-pink);
            background: rgba(255, 255, 255, 0.6);
        }

        .split-pane.right {
            background: rgba(255, 255, 255, 0.3);
        }

        h2, h3 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-pink);
        }

        /* --- Reading Passage Styling --- */
        .passage-title {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            text-shadow: 2px 2px 0px #fff;
        }

        .paragraph {
            background: #fff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .gap-marker {
            display: inline-block;
            width: 45px;
            height: 25px;
            background: var(--primary-pink);
            color: white;
            text-align: center;
            border-radius: 5px;
            font-weight: bold;
            margin: 0 5px;
            line-height: 25px;
        }

        .trans-btn {
            display: block;
            margin-top: 10px;
            font-size: 0.8rem;
            color: var(--primary-teal);
            background: none;
            border: 2px solid var(--primary-teal);
            border-radius: 20px;
            padding: 5px 15px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s;
        }

        .trans-btn:hover {
            background: var(--primary-teal);
            color: white;
        }

        .translation-text {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dotted #ccc;
            color: #666;
            font-style: italic;
            font-size: 1rem;
        }

        .glossary-box {
            background: #eefcf9;
            border: 2px solid var(--primary-teal);
            border-radius: 15px;
            padding: 15px;
            margin-top: 30px;
        }

        .glossary-title {
            text-align: center;
            color: var(--primary-teal);
            margin-top: 0;
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
        }

        .glossary-table th, .glossary-table td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid rgba(0, 201, 167, 0.2);
        }

        /* --- Question Styling --- */
        .question-card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }

        .question-header {
            font-weight: 800;
            color: var(--primary-pink);
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .question-header::before {
            content: '‚ùì';
            margin-right: 10px;
        }

        .options-grid {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 15px;
            text-align: left;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #e0e0e0;
        }

        .option-btn:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--primary-pink);
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(4px);
            box-shadow: none;
        }

        .option-btn.correct {
            background: var(--correct-green);
            color: white;
            border-color: #00a855;
            box-shadow: 0 4px 0 #00a855;
        }

        .option-btn.wrong {
            background: var(--wrong-red);
            color: white;
            border-color: #d6303e;
            box-shadow: 0 4px 0 #d6303e;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            cursor: default;
            opacity: 0.7;
        }

        .feedback-panel {
            display: none;
            margin-top: 15px;
            background: #f8f0ff;
            border-radius: 15px;
            padding: 15px;
            border: 2px dashed var(--primary-pink);
            animation: slideDown 0.3s ease-out;
        }

        .feedback-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .fb-tab {
            font-size: 0.8rem;
            padding: 5px 10px;
            background: #eee;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .fb-tab.active {
            background: var(--primary-pink);
            color: white;
        }

        .fb-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .teacher-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-pink);
            vertical-align: middle;
            margin-right: 10px;
            background-color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* Submit Button */
        .submit-section {
            text-align: center;
            margin: 40px 0;
        }

        .submit-btn {
            background: linear-gradient(45deg, var(--primary-pink), #a26bdb);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 8px 0 #6a3da1, 0 15px 20px rgba(136, 84, 192, 0.4);
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05) translateY(-5px);
        }

        /* Modal Result */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 5px solid var(--primary-teal);
        }

        .score-circle {
            width: 150px;
            height: 150px;
            background: var(--primary-teal);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 0 auto 20px;
            box-shadow: 0 10px 0 #009e82;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .main-container { flex-direction: column; height: auto; }
            .split-pane { width: 100%; height: auto; max-height: 50vh; }
            .timer-container { position: relative; left: 0; transform: none; }
            header { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>

    <canvas id="confetti" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999;"></canvas>

    <header>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS üë©‚Äçüè´</div>
        <div class="timer-container">
            <button class="timer-btn" id="start-btn" onclick="toggleTimer()">B·∫ÆT ƒê·∫¶U</button>
            <div id="timer-display">10:00</div>
        </div>
        <div></div>
    </header>

    <div class="main-container">
        <div class="split-pane left">
            <h2 class="passage-title">ü•ï The Story of The Carrot and The Ring üíç</h2>
            <p><strong>Five sentences have been removed from the text below. For each question, choose the correct answer. There are three extra sentences which you do not need to use.</strong></p>

            <div class="paragraph">
                Have you ever lost something that was precious to you, and thought you‚Äôd never see it again? That‚Äôs what happened to Mary Grams from Canada.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">B·∫°n ƒë√£ bao gi·ªù ƒë√°nh m·∫•t th·ª© g√¨ ƒë√≥ qu√Ω gi√° ƒë·ªëi v·ªõi m√¨nh v√† nghƒ© r·∫±ng m√¨nh s·∫Ω kh√¥ng bao gi·ªù g·∫∑p l·∫°i n√≥ ch∆∞a? ƒê√≥ l√† nh·ªØng g√¨ ƒë√£ x·∫£y ra v·ªõi Mary Grams ƒë·∫øn t·ª´ Canada.</div>
            </div>

            <div class="paragraph">
                Mary had worn her engagement ring for more than half a century when she suddenly lost it. She was working in her garden on the family farm one day, pulling out a plant. <span class="gap-marker">(1)</span> ......... When she discovered it was missing, she searched everywhere for it for days, before finally giving up.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">Mary ƒë√£ ƒëeo chi·∫øc nh·∫´n ƒë√≠nh h√¥n c·ªßa m√¨nh h∆°n n·ª≠a th·∫ø k·ª∑ th√¨ ƒë·ªôt nhi√™n ƒë√°nh m·∫•t n√≥. M·ªôt ng√†y n·ªç, b√† ƒëang l√†m v∆∞·ªùn ·ªü trang tr·∫°i gia ƒë√¨nh, nh·ªï m·ªôt c√°i c√¢y. (1)......... Khi ph√°t hi·ªán chi·∫øc nh·∫´n b·ªã m·∫•t, b√† ƒë√£ t√¨m ki·∫øm kh·∫Øp n∆°i trong nhi·ªÅu ng√†y tr∆∞·ªõc khi b·ªè cu·ªôc.</div>
            </div>

            <div class="paragraph">
                Mary realised she probably wasn‚Äôt going to find the ring again. So she decided not to tell anyone about what had happened, apart from her son. Instead, she thought she would replace it with a much cheaper ring from a jeweller‚Äôs. <span class="gap-marker">(2)</span> ......... In fact, it was so similar that no-one else in her family even knew her original ring was missing.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">Mary nh·∫≠n ra r·∫±ng c√≥ l·∫Ω b√† s·∫Ω kh√¥ng t√¨m l·∫°i ƒë∆∞·ª£c chi·∫øc nh·∫´n n·ªØa. V√¨ v·∫≠y, b√† quy·∫øt ƒë·ªãnh kh√¥ng n√≥i v·ªõi b·∫•t k·ª≥ ai v·ªÅ chuy·ªán ƒë√£ x·∫£y ra, ngo·∫°i tr·ª´ con trai m√¨nh. Thay v√†o ƒë√≥, b√† nghƒ© m√¨nh s·∫Ω thay th·∫ø n√≥ b·∫±ng m·ªôt chi·∫øc nh·∫´n r·∫ª h∆°n nhi·ªÅu t·ª´ m·ªôt ti·ªám kim ho√†n. (2)......... Tr√™n th·ª±c t·∫ø, n√≥ gi·ªëng ƒë·∫øn n·ªói kh√¥ng ai kh√°c trong gia ƒë√¨nh b√† bi·∫øt chi·∫øc nh·∫´n ban ƒë·∫ßu c·ªßa b√† b·ªã m·∫•t.</div>
            </div>

            <div class="paragraph">
                But the story has a happy ending. Mary eventually got her engagement ring back ‚Äì 13 years after it was lost! One day Mary‚Äôs daughter-in-law Colleen was working in the same garden where Mary had been all those years ago.
                <span class="gap-marker">(3)</span> ......... But this time it looked a bit different ‚Äì because there was a carrot growing right through the middle of it!
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">Nh∆∞ng c√¢u chuy·ªán c√≥ m·ªôt c√°i k·∫øt c√≥ h·∫≠u. Mary cu·ªëi c√πng ƒë√£ l·∫•y l·∫°i ƒë∆∞·ª£c chi·∫øc nh·∫´n ƒë√≠nh h√¥n c·ªßa m√¨nh ‚Äì 13 nƒÉm sau khi n√≥ b·ªã m·∫•t! M·ªôt ng√†y n·ªç, con d√¢u c·ªßa Mary l√† Colleen ƒëang l√†m vi·ªác trong ch√≠nh khu v∆∞·ªùn m√† Mary ƒë√£ ·ªü ƒë√≥ bao nhi√™u nƒÉm tr∆∞·ªõc. (3)......... Nh∆∞ng l·∫ßn n√†y n√≥ tr√¥ng h∆°i kh√°c m·ªôt ch√∫t ‚Äì b·ªüi v√¨ c√≥ m·ªôt c·ªß c√† r·ªët m·ªçc xuy√™n qua gi·ªØa n√≥!</div>
            </div>

            <div class="paragraph">
                As soon as Colleen saw the ring, she knew immediately who the owner was. The farm had been in the family for over 100 years. <span class="gap-marker">(4)</span> ......... So when Colleen discovered the story of the lost ring, it became clear there was only one person it could possibly have belonged to, and the ring was returned to Mary.
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">Ngay khi Colleen nh√¨n th·∫•y chi·∫øc nh·∫´n, c√¥ bi·∫øt ngay ch·ªß nh√¢n l√† ai. Trang tr·∫°i ƒë√£ thu·ªôc v·ªÅ gia ƒë√¨nh trong h∆°n 100 nƒÉm. (4)......... V√¨ v·∫≠y, khi Colleen kh√°m ph√° ra c√¢u chuy·ªán v·ªÅ chi·∫øc nh·∫´n b·ªã m·∫•t, r√µ r√†ng l√† ch·ªâ c√≥ m·ªôt ng∆∞·ªùi m√† n√≥ c√≥ th·ªÉ thu·ªôc v·ªÅ, v√† chi·∫øc nh·∫´n ƒë√£ ƒë∆∞·ª£c tr·∫£ l·∫°i cho Mary.</div>
            </div>

            <div class="paragraph">
                Mary decided to remove her ring from the carrot and wear it again. <span class="gap-marker">(5)</span> ......... Then the ring was washed, and Mary put it back on her finger ‚Äì and it still fitted perfectly!
                <button class="trans-btn" onclick="toggleTrans(this)">B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text">Mary quy·∫øt ƒë·ªãnh l·∫•y chi·∫øc nh·∫´n ra kh·ªèi c·ªß c√† r·ªët v√† ƒëeo l·∫°i. (5)......... Sau ƒë√≥, chi·∫øc nh·∫´n ƒë∆∞·ª£c r·ª≠a s·∫°ch, v√† Mary ƒëeo l·∫°i v√†o ng√≥n tay ‚Äì v√† n√≥ v·∫´n v·ª´a v·∫∑n ho√†n h·∫£o!</div>
            </div>

            <div class="glossary-box">
                <h3 class="glossary-title">üìö Glossary - T·ª´ V·ª±ng Hay</h3>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                    <tr><td>Precious</td><td>(adj)</td><td>Qu√Ω gi√°</td></tr>
                    <tr><td>Engagement ring</td><td>(n)</td><td>Nh·∫´n ƒë√≠nh h√¥n</td></tr>
                    <tr><td>Discover</td><td>(v)</td><td>Kh√°m ph√°, ph√°t hi·ªán</td></tr>
                    <tr><td>Replace</td><td>(v)</td><td>Thay th·∫ø</td></tr>
                    <tr><td>Jeweller's</td><td>(n)</td><td>Ti·ªám kim ho√†n</td></tr>
                    <tr><td>Eventually</td><td>(adv)</td><td>Cu·ªëi c√πng</td></tr>
                    <tr><td>Daughter-in-law</td><td>(n)</td><td>Con d√¢u</td></tr>
                    <tr><td>Original</td><td>(adj)</td><td>Nguy√™n b·∫£n, g·ªëc</td></tr>
                    <tr><td>Remove</td><td>(v)</td><td>Lo·∫°i b·ªè, th√°o ra</td></tr>
                    <tr><td>Fit</td><td>(v)</td><td>V·ª´a v·∫∑n</td></tr>
                </table>
            </div>
            <br><br><br>
        </div>

        <div class="split-pane right">
            <h2 style="text-align:center;">üß© Exercises</h2>
            
            <div id="quiz-container">
                </div>

            <div class="submit-section">
                <button class="submit-btn" onclick="showResults()">N·ªòP B√ÄI üìù</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
            <div class="score-circle" id="final-score">0/5</div>
            <p id="feedback-msg" style="font-size: 1.2rem; margin-bottom: 20px;">...</p>
            <button class="timer-btn" onclick="closeModal()">Xem l·∫°i b√†i</button>
        </div>
    </div>

<script>
    // --- DATA ---
    const questions = [
        {
            id: 1,
            correct: "C",
            options: "SAME",
            explanation: "<b>D·∫´n ch·ª©ng:</b> C√¢u tr∆∞·ªõc: '...pulling out a plant' (ƒëang nh·ªï c√¢y). C√¢u sau: 'When she discovered it was missing...' (Khi b√† ph√°t hi·ªán n√≥ b·ªã m·∫•t).<br><b>Gi·∫£i th√≠ch:</b> H√†nh ƒë·ªông 'nh·ªï c√¢y' l√† nguy√™n nh√¢n khi·∫øn chi·∫øc nh·∫´n b·ªã tu·ªôt ra. C√¢u C ('V√† ƒë√≥ c√≥ l·∫Ω l√† l√∫c chi·∫øc nh·∫´n tu·ªôt kh·ªèi ng√≥n tay b√†') n·ªëi k·∫øt h√†nh ƒë·ªông v√† k·∫øt qu·∫£ m·ªôt c√°ch h·ª£p l√Ω nh·∫•t.",
            translateQ: "Ch·ªçn c√¢u ƒëi·ªÅn v√†o ch·ªó tr·ªëng (1).",
            translateA: "ƒê√°p √°n C: V√† ƒë√≥ c√≥ l·∫Ω l√† l√∫c chi·∫øc nh·∫´n tu·ªôt kh·ªèi ng√≥n tay b√†."
        },
        {
            id: 2,
            correct: "H",
            options: "SAME",
            explanation: "<b>D·∫´n ch·ª©ng:</b> C√¢u tr∆∞·ªõc n√≥i b√† mu·ªën thay th·∫ø b·∫±ng 'cheaper ring' (nh·∫´n r·∫ª h∆°n). C√¢u sau: 'In fact, it was so similar...' (Th·ª±c t·∫ø, n√≥ gi·ªëng ƒë·∫øn n·ªói...).<br><b>Gi·∫£i th√≠ch:</b> C√¢u H ('May m·∫Øn thay, b√† ƒë√£ t√¨m ƒë∆∞·ª£c m·ªôt chi·∫øc kh√°c tr√¥ng gi·ªëng h·ªát n√≥') gi·∫£i th√≠ch t·∫°i sao c√¢u sau l·∫°i n√≥i l√† 'n√≥ r·∫•t gi·ªëng' (similar).",
            translateA: "ƒê√°p √°n H: May m·∫Øn thay, b√† ƒë√£ t√¨m ƒë∆∞·ª£c m·ªôt chi·∫øc kh√°c tr√¥ng gi·ªëng h·ªát n√≥."
        },
        {
            id: 3,
            correct: "A",
            options: "SAME",
            explanation: "<b>D·∫´n ch·ª©ng:</b> C√¢u tr∆∞·ªõc gi·ªõi thi·ªáu c√¥ con d√¢u Colleen ƒëang l√†m v∆∞·ªùn. C√¢u sau: 'But this time it looked a bit different' (Nh∆∞ng l·∫ßn n√†y n√≥ tr√¥ng h∆°i kh√°c).<br><b>Gi·∫£i th√≠ch:</b> C√¢u A ('C√¥ ·∫•y ƒëang ƒë√†o rau ·ªü ƒë√≥ th√¨ ph√°t hi·ªán ra chi·∫øc nh·∫´n') m√¥ t·∫£ h√†nh ƒë·ªông t√¨m th·∫•y chi·∫øc nh·∫´n, d·∫´n ƒë·∫øn vi·ªác mi√™u t·∫£ chi·∫øc nh·∫´n tr√¥ng nh∆∞ th·∫ø n√†o ·ªü c√¢u sau.",
            translateA: "ƒê√°p √°n A: C√¥ ·∫•y ƒëang ƒë√†o rau ·ªü ƒë√≥ th√¨ ph√°t hi·ªán ra chi·∫øc nh·∫´n."
        },
        {
            id: 4,
            correct: "F",
            options: "SAME",
            explanation: "<b>D·∫´n ch·ª©ng:</b> C√¢u tr∆∞·ªõc: 'Farm... in the family for over 100 years' (Trang tr·∫°i c·ªßa gia ƒë√¨nh h∆°n 100 nƒÉm). C√¢u sau: '...clear there was only one person it could possibly have belonged to' (R√µ r√†ng ch·ªâ c√≥ m·ªôt ng∆∞·ªùi c√≥ th·ªÉ l√† ch·ªß nh√¢n).<br><b>Gi·∫£i th√≠ch:</b> C√¢u F ('V√† ch·ªâ c√≥ hai ng∆∞·ªùi ph·ª• n·ªØ s·ªëng ·ªü ƒë√≥ trong su·ªët th·ªùi gian ƒë√≥') cung c·∫•p d·ªØ ki·ªán logic: 100 nƒÉm nh∆∞ng ch·ªâ c√≥ 2 ng∆∞·ªùi ph·ª• n·ªØ, n√™n vi·ªác x√°c ƒë·ªãnh ch·ªß nh√¢n r·∫•t d·ªÖ d√†ng.",
            translateA: "ƒê√°p √°n F: V√† ch·ªâ c√≥ hai ng∆∞·ªùi ph·ª• n·ªØ s·ªëng ·ªü ƒë√≥ trong su·ªët th·ªùi gian ƒë√≥."
        },
        {
            id: 5,
            correct: "D",
            options: "SAME",
            explanation: "<b>D·∫´n ch·ª©ng:</b> C√¢u tr∆∞·ªõc: '...remove her ring from the carrot' (th√°o nh·∫´n ra kh·ªèi c·ªß c√† r·ªët). C√† r·ªët m·ªçc xuy√™n qua nh·∫´n n√™n kh√¥ng th·ªÉ r√∫t ra b√¨nh th∆∞·ªùng.<br><b>Gi·∫£i th√≠ch:</b> C√¢u D ('V√¨ v·∫≠y b√† c·∫©n th·∫≠n c·∫Øt ƒë√¥i c·ªß c√† r·ªët') l√† h√†nh ƒë·ªông c·∫ßn thi·∫øt ƒë·ªÉ l·∫•y chi·∫øc nh·∫´n ra.",
            translateA: "ƒê√°p √°n D: V√¨ v·∫≠y b√† c·∫©n th·∫≠n c·∫Øt ƒë√¥i c·ªß c√† r·ªët."
        }
    ];

    const optionsListGlobal = [
        {id: "A", text: "She was digging up vegetables there when she discovered the ring."},
        {id: "B", text: "That gave her a very good idea about what to do with the carrot."},
        {id: "C", text: "And that was probably when the ring came off her finger."},
        {id: "D", text: "So she carefully cut the carrot in half."},
        {id: "E", text: "She had never seen anything like it before."},
        {id: "F", text: "And only two women had lived there in all that time."},
        {id: "G", text: "It was tiring work, as some of them were very big."},
        {id: "H", text: "Luckily, she managed to find another one that looked just like it."}
    ];

    // --- SOUND ENGINE ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- CONFETTI ENGINE ---
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];
    function fireConfetti() {
        for(let i=0; i<100; i++) {
            particles.push({
                x: window.innerWidth / 2, y: window.innerHeight / 2,
                vx: (Math.random() - 0.5) * 20, vy: (Math.random() - 0.5) * 20,
                color: `hsl(${Math.random()*360}, 100%, 50%)`, life: 100
            });
        }
        animateConfetti();
    }
    function animateConfetti() {
        if(particles.length === 0) return;
        ctx.clearRect(0,0, canvas.width, canvas.height);
        for(let i=0; i<particles.length; i++) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life--;
            ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 8, 8);
        }
        particles = particles.filter(p => p.life > 0);
        if(particles.length > 0) requestAnimationFrame(animateConfetti);
        else ctx.clearRect(0,0, canvas.width, canvas.height);
    }

    // --- APP LOGIC ---
    let timeLeft = 600;
    let timerInterval;
    let isTimerRunning = false;
    let userScore = 0;

    function init() {
        const container = document.getElementById('quiz-container');
        questions.forEach((q, index) => {
            const options = (q.options === "SAME") ? optionsListGlobal : q.options;
            let html = `
                <div class="question-card" id="q-card-${index}">
                    <div class="question-header">C√¢u h·ªèi ${index + 1}: ƒêi·ªÅn v√†o ch·ªó tr·ªëng (${index + 1})</div>
                    <div class="options-grid">
                        ${options.map(opt => `
                            <button class="option-btn" onclick="checkAnswer(${index}, '${opt.id}', this)">
                                <b>${opt.id}.</b> ${opt.text}
                            </button>
                        `).join('')}
                    </div>
                    <div class="feedback-panel" id="feedback-${index}">
                        <div class="feedback-tabs">
                            <div class="fb-tab active" onclick="switchTab(${index}, 'explain')">Gi·∫£i th√≠ch</div>
                            <div class="fb-tab" onclick="switchTab(${index}, 'trans')">D·ªãch</div>
                        </div>
                        <div class="fb-content" id="fb-content-${index}"></div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function toggleTimer() {
        const btn = document.getElementById('start-btn');
        if (isTimerRunning) {
            clearInterval(timerInterval);
            btn.textContent = "TI·∫æP T·ª§C ‚ñ∂Ô∏è";
            btn.style.background = "#FFC107";
        } else {
            timerInterval = setInterval(updateTimer, 1000);
            btn.textContent = "T·∫†M D·ª™NG ‚è∏Ô∏è";
            btn.style.background = "#FF4757";
        }
        isTimerRunning = !isTimerRunning;
    }

    function updateTimer() {
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m.");
            return;
        }
        timeLeft--;
        const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const s = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('timer-display').innerText = `${m}:${s}`;
    }

    function checkAnswer(qIndex, selectedId, btnElement) {
        const card = document.getElementById(`q-card-${qIndex}`);
        if (card.classList.contains('answered')) return;
        card.classList.add('answered');

        const q = questions[qIndex];
        const allBtns = card.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.classList.add('disabled'));

        card.dataset.explanation = `<span class="teacher-avatar">üë©‚Äçüè´</span> ${q.explanation}`;
        card.dataset.translation = `<b>C√¢u h·ªèi:</b> ${q.translateQ} <br><br> <b>ƒê√°p √°n:</b> ${q.translateA}`;

        if (selectedId === q.correct) {
            btnElement.classList.add('correct');
            playSound('correct');
            fireConfetti();
            userScore++;
        } else {
            btnElement.classList.add('wrong');
            playSound('wrong');
            allBtns.forEach(b => {
                if(b.innerText.startsWith(q.correct + ".")) b.classList.add('correct');
            });
        }
        
        document.getElementById(`feedback-${qIndex}`).style.display = 'block';
        switchTab(qIndex, 'explain');
    }

    function switchTab(qIndex, type) {
        const card = document.getElementById(`q-card-${qIndex}`);
        const contentDiv = document.getElementById(`fb-content-${qIndex}`);
        const tabs = document.querySelectorAll(`#feedback-${qIndex} .fb-tab`);
        tabs.forEach(t => t.classList.remove('active'));
        if(type === 'explain') {
            tabs[0].classList.add('active');
            contentDiv.innerHTML = card.dataset.explanation;
        } else {
            tabs[1].classList.add('active');
            contentDiv.innerHTML = card.dataset.translation;
        }
    }

    function toggleTrans(btn) {
        const text = btn.nextElementSibling;
        if (text.style.display === "block") {
            text.style.display = "none";
            btn.textContent = "B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶";
        } else {
            text.style.display = "block";
            btn.textContent = "·∫®N B·∫¢N D·ªäCH";
        }
    }

    function showResults() {
        const modal = document.getElementById('result-modal');
        const scoreDiv = document.getElementById('final-score');
        const feedbackMsg = document.getElementById('feedback-msg');
        scoreDiv.innerText = `${userScore}/5`;
        if (userScore === 5) feedbackMsg.innerText = "üåü XU·∫§T S·∫ÆC! Em l√† thi√™n t√†i ti·∫øng Anh!";
        else if (userScore >= 3) feedbackMsg.innerText = "üëè L√ÄM T·ªêT L·∫ÆM! C·ªë g·∫Øng ch√∫t n·ªØa l√† ƒëi·ªÉm tuy·ªát ƒë·ªëi r·ªìi!";
        else feedbackMsg.innerText = "üí™ C·ªê L√äN NH√â! H√£y xem k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu b√†i h∆°n.";
        modal.style.display = 'flex';
        playSound('correct');
        fireConfetti();
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
    }

    init();
</script>
</body>
</html>