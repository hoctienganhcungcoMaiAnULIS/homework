<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Gi·ªõi T·ª´ Ch·ªâ V·ªã Tr√≠ - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--primary-purple) 1px, transparent 1px), radial-gradient(var(--primary-teal) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary-purple);
        }

        h1 {
            color: var(--primary-purple);
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 2rem;
            text-transform: uppercase;
        }

        .sub-header {
            font-size: 1rem;
            color: #777;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Question Card Style */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 6px 0 #e0e0e0, 0 10px 10px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s ease;
            border: 2px solid #eee;
        }

        .question-number {
            display: inline-block;
            background: var(--primary-purple);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            box-shadow: 0 4px 0 #ccc;
            color: var(--text-color);
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-teal);
            background-color: #f0fffa;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #ccc;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-green) !important;
            color: white !important;
            border-color: var(--correct-green) !important;
            box-shadow: 0 4px 0 #008f48 !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red) !important;
            color: white !important;
            border-color: var(--wrong-red) !important;
            box-shadow: 0 4px 0 #b3202d !important;
            animation: shake 0.5s;
        }

        /* Explanation Section */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 20px;
            animation: slideDown 0.4s ease-out;
        }

        .explanation-box.visible {
            display: block;
        }

        .exp-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            color: #d35400;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .exp-content {
            font-size: 1rem;
            line-height: 1.6;
        }

        .exp-step {
            margin-bottom: 10px;
        }

        .exp-label {
            font-weight: 700;
            color: var(--primary-purple);
            text-decoration: underline;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Submit Button */
        #submit-btn {
            display: block;
            width: 100%;
            background: var(--primary-teal);
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 20px;
            box-shadow: 0 6px 0 #00917c;
            cursor: pointer;
            margin-top: 40px;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
        }

        #submit-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        #submit-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #00917c;
        }

        /* Result Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 5px solid var(--primary-purple);
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-teal);
            margin: 20px 0;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Phonetics Underline */
        u {
            text-decoration: none;
            border-bottom: 2px solid var(--primary-purple);
            padding-bottom: 2px;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="sub-header">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
            <h1>B√ÄI T·∫¨P GI·ªöI T·ª™ (IN/ON/AT)</h1>
        </header>

        <div id="quiz-container">
            </div>

        <button id="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI üöÄ</button>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ C·ª¶A CON</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p id="feedback-text" style="font-size: 1.2rem; color: #555;">...</p>
            <button class="option-btn" style="background: var(--primary-purple); color: white; border-color: #6c429c; margin-top: 20px; width: 100%; text-align: center;" onclick="location.reload()">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

<script>
    // --- DATABASE: 30 Questions based on provided theory ---
    const quizData = [
        // GROUP 1: IN (Th√†nh ph·ªë, qu·ªëc gia, ph√≤ng, kh√¥ng gian k√≠n)
        {
            question: "We are spending our summer holiday _____ Vietnam.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. in", type: "prep", meaning: "trong/·ªü" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 2, // Index of C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Ch√∫ng t√¥i ƒëang tr·∫£i qua k·ª≥ ngh·ªâ h√® ·ªü Vi·ªát Nam.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong>
                    <br>A. on (gi·ªõi t·ª´): tr√™n (b·ªÅ m·∫∑t).
                    <br>B. at (gi·ªõi t·ª´): t·∫°i (ƒëi·ªÉm c·ª• th·ªÉ).
                    <br>C. in (gi·ªõi t·ª´): trong/·ªü (khu v·ª±c r·ªông l·ªõn).
                    <br>D. to (gi·ªõi t·ª´): t·ªõi (ph∆∞∆°ng h∆∞·ªõng).
                </div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> "Vietnam" l√† t√™n m·ªôt <strong>qu·ªëc gia</strong>. Theo quy t·∫Øc, tr∆∞·ªõc t√™n qu·ªëc gia, ch√¢u l·ª•c, th√†nh ph·ªë l·ªõn ta d√πng gi·ªõi t·ª´ <strong>"in"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> C√°c gi·ªõi t·ª´ c√≤n l·∫°i kh√¥ng ƒëi v·ªõi t√™n qu·ªëc gia ƒë·ªÉ ch·ªâ v·ªã tr√≠ ƒë·ªãa l√Ω t·ªïng qu√°t.</div>
            `
        },
        {
            question: "My father is working _____ the garden.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. between", type: "prep", meaning: "·ªü gi·ªØa" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> B·ªë t√¥i ƒëang l√†m vi·ªác trong v∆∞·ªùn.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong>
                    <br>A. at: t·∫°i (ƒëi·ªÉm).
                    <br>B. in: trong (kh√¥ng gian bao quanh).
                    <br>C. on: tr√™n (b·ªÅ m·∫∑t).
                    <br>D. between: ·ªü gi·ªØa.
                </div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> "The garden" (khu v∆∞·ªùn) ƒë∆∞·ª£c xem l√† m·ªôt <strong>kh√¥ng gian k√≠n/c√≥ ph·∫°m vi</strong> bao quanh. Ta d√πng <strong>"in"</strong> ƒë·ªÉ ch·ªâ vi·ªác ·ªü b√™n trong kh√¥ng gian ƒë√≥.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "On the garden" sai v√¨ kh√¥ng ƒë·ª©ng tr√™n b·ªÅ m·∫∑t khu v∆∞·ªùn; "At" th∆∞·ªùng d√πng cho ƒë·ªãa ƒëi·ªÉm c√¥ng c·ªông ho·∫∑c s·ªë nh√† c·ª• th·ªÉ h∆°n.</div>
            `
        },
        {
            question: "There are many beautiful islands _____ Asia.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. in", type: "prep", meaning: "trong/·ªü" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. of", type: "prep", meaning: "c·ªßa" }
            ],
            correct: 1,
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> C√≥ r·∫•t nhi·ªÅu h√≤n ƒë·∫£o xinh ƒë·∫πp ·ªü ch√¢u √Å.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong>
                   <br>Asia (Ch√¢u √Å) l√† danh t·ª´ ch·ªâ <strong>ch√¢u l·ª•c</strong>.
                </div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Tr∆∞·ªõc t√™n c√°c ch√¢u l·ª•c (Asia, Europe, Africa...), ta lu√¥n d√πng gi·ªõi t·ª´ <strong>"in"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Kh√¥ng d√πng "on Asia" hay "at Asia".</div>
            `
        },
        {
            question: "Put your toys _____ the box, please!",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. in", type: "prep", meaning: "trong" },
                { text: "D. above", type: "prep", meaning: "ph√≠a tr√™n" }
            ],
            correct: 2,
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> L√†m ∆°n c·∫•t ƒë·ªì ch∆°i c·ªßa con v√†o trong h·ªôp ƒëi!</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The box" (c√°i h·ªôp) l√† v·∫≠t th·ªÉ ch·ª©a ƒë·ª±ng (container).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> D√πng <strong>"in"</strong> cho c√°c v·∫≠t c√≥ l√≤ng ch·ª©a nh∆∞ h·ªôp, t√∫i, ngƒÉn k√©o...</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "On the box" nghƒ©a l√† ƒë·ªÉ l√™n n·∫Øp h·ªôp (b·ªÅ m·∫∑t), kh√¥ng ƒë√∫ng √Ω nghƒ©a c·∫•t g·ªçn ƒë·ªì ch∆°i v√†o trong.</div>
            `
        },
        {
            question: "Hanoi is located _____ the North of Vietnam.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. from", type: "prep", meaning: "t·ª´" },
                { text: "D. in", type: "prep", meaning: "trong/·ªü" }
            ],
            correct: 3,
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> H√† N·ªôi n·∫±m ·ªü ph√≠a B·∫Øc c·ªßa Vi·ªát Nam.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> C·ª•m t·ª´ ch·ªâ ph∆∞∆°ng h∆∞·ªõng (The North, The South, The East, The West).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (D):</strong> V·ªõi ph∆∞∆°ng h∆∞·ªõng, ta d√πng c·∫•u tr√∫c: <strong>in + the + h∆∞·ªõng</strong> (in the North).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Kh√¥ng d√πng "on the North" (tr·ª´ khi n√≥i 'on the north coast' - b·ªù bi·ªÉn ph√≠a b·∫Øc).</div>
            `
        },

        // GROUP 2: ON (B·ªÅ m·∫∑t, t√™n ƒë∆∞·ªùng, s·ªë trang, ƒë·∫£o)
        {
            question: "The clock is hanging _____ the wall.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. under", type: "prep", meaning: "d∆∞·ªõi" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Chi·∫øc ƒë·ªìng h·ªì ƒëang treo tr√™n t∆∞·ªùng.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The wall" (b·ª©c t∆∞·ªùng) l√† m·ªôt <strong>b·ªÅ m·∫∑t</strong> (surface).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> B·∫•t c·ª© th·ª© g√¨ ti·∫øp x√∫c v·ªõi b·ªÅ m·∫∑t (d√π l√† m·∫∑t ngang hay m·∫∑t ƒë·ª©ng), ta ƒë·ªÅu d√πng <strong>"on"</strong>. (on the wall, on the floor, on the ceiling).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In the wall" l√† n·∫±m s√¢u b√™n trong k·∫øt c·∫•u t∆∞·ªùng; "At the wall" l√† ƒë·ª©ng c·∫°nh t∆∞·ªùng.</div>
            `
        },
        {
            question: "Her house is _____ Le Loi Street.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. by", type: "prep", meaning: "b·ªüi/c·∫°nh" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Nh√† c√¥ ·∫•y ·ªü tr√™n ƒë∆∞·ªùng L√™ L·ª£i.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "Le Loi Street" l√† <strong>t√™n ƒë∆∞·ªùng</strong> (kh√¥ng c√≥ s·ªë nh√† c·ª• th·ªÉ).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Quy t·∫Øc: Tr∆∞·ªõc t√™n ƒë∆∞·ªùng/ph·ªë (Street, Road, Avenue...), ta d√πng <strong>"on"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "At" ch·ªâ d√πng khi c√≥ s·ªë nh√† c·ª• th·ªÉ (V√≠ d·ª•: At 10 Le Loi Street). "In" d√πng cho th√†nh ph·ªë/qu·ªëc gia.</div>
            `
        },
        {
            question: "Please open your book _____ page 33.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> H√£y m·ªü s√°ch c·ªßa b·∫°n ·ªü trang 33.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "Page 33" l√† ch·ªâ s·ªë trang.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> C·ª•m c·ªë ƒë·ªãnh: <strong>on page + s·ªë</strong>. Ch√∫ng ta coi trang gi·∫•y l√† m·ªôt b·ªÅ m·∫∑t ch·ª©a th√¥ng tin.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "At page" hay "in page" ƒë·ªÅu sai collocations trong tr∆∞·ªùng h·ª£p n√†y.</div>
            `
        },
        {
            question: "We had a wonderful vacation _____ Phu Quoc Island.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. into", type: "prep", meaning: "v√†o trong" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Ch√∫ng t√¥i ƒë√£ c√≥ m·ªôt k·ª≥ ngh·ªâ tuy·ªát v·ªùi tr√™n ƒë·∫£o Ph√∫ Qu·ªëc.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "Phu Quoc Island" l√† m·ªôt h√≤n ƒë·∫£o.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Tr∆∞·ªõc t√™n c√°c h√≤n ƒë·∫£o (island), ta d√πng gi·ªõi t·ª´ <strong>"on"</strong>. (Nghƒ©a l√† s·ªëng tr√™n b·ªÅ m·∫∑t h√≤n ƒë·∫£o ƒë√≥).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In" th∆∞·ªùng d√πng cho qu·ªëc gia ho·∫∑c th√†nh ph·ªë l·ªõn trong ƒë·∫•t li·ªÅn h∆°n.</div>
            `
        },
        {
            question: "Don't leave your phone _____ the table.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. to", type: "prep", meaning: "t·ªõi" },
                { text: "D. on", type: "prep", meaning: "tr√™n" }
            ],
            correct: 3, // D
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> ƒê·ª´ng ƒë·ªÉ ƒëi·ªán tho·∫°i c·ªßa b·∫°n tr√™n b√†n.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The table" l√† m·ªôt m·∫∑t ph·∫≥ng.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (D):</strong> V·∫≠t n·∫±m tr√™n b·ªÅ m·∫∑t b√†n -> D√πng <strong>"on"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In the table" (trong ngƒÉn b√†n - ph·∫£i n√≥i r√µ l√† drawer), "At the table" (ng·ªìi t·∫°i b√†n ƒë·ªÉ ƒÉn/l√†m vi·ªác). Ng·ªØ c·∫£nh "ƒë·ªÉ ƒëi·ªán tho·∫°i" h·ª£p l√Ω nh·∫•t l√† "on".</div>
            `
        },

        // GROUP 3: AT (ƒêi·ªÉm c·ª• th·ªÉ, ƒë·ªãa ch·ªâ nh√†, t√≤a nh√†, s·ª± ki·ªán)
        {
            question: "She lives _____ 25 Tran Phu Street.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. from", type: "prep", meaning: "t·ª´" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> C√¥ ·∫•y s·ªëng t·∫°i s·ªë 25 ƒë∆∞·ªùng Tr·∫ßn Ph√∫.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> ƒê√¢y l√† m·ªôt <strong>ƒë·ªãa ch·ªâ c·ª• th·ªÉ</strong> (c√≥ s·ªë nh√† + t√™n ƒë∆∞·ªùng).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> Quy t·∫Øc: C√≥ s·ªë nh√† -> D√πng <strong>"at"</strong>. Ch·ªâ c√≥ t√™n ƒë∆∞·ªùng -> D√πng "on".</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> R·∫•t nhi·ªÅu b·∫°n ch·ªçn B (on) v√¨ th·∫•y "Street", nh∆∞ng nh·ªõ l√† c√≥ "25" (s·ªë nh√†) th√¨ "at" m·ªõi ch√≠nh x√°c nh·∫•t v√¨ n√≥ l√† m·ªôt ƒëi·ªÉm ch√≠nh x√°c.</div>
            `
        },
        {
            question: "I will meet you _____ the cinema.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> T·ªõ s·∫Ω g·∫∑p c·∫≠u ·ªü r·∫°p chi·∫øu phim.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> R·∫°p chi·∫øu phim (Cinema) l√† m·ªôt ƒë·ªãa ƒëi·ªÉm c√¥ng c·ªông, m·ªôt ƒëi·ªÉm h·∫πn.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> D√πng <strong>"at"</strong> khi n√≥i v·ªÅ m·ªôt ƒë·ªãa ƒëi·ªÉm nh∆∞ m·ªôt ƒëi·ªÉm m·ªëc/n∆°i g·∫∑p g·ª° ho·∫∑c n√≥i v·ªÅ ch·ª©c nƒÉng c·ªßa t√≤a nh√† ƒë√≥.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> D√πng "in" khi mu·ªën nh·∫•n m·∫°nh ƒëang ·ªü <em>b√™n trong</em> t√≤a nh√† (tr√∫ m∆∞a, tr·ªën t√¨m). Nh∆∞ng ƒë·ªÉ h·∫πn g·∫∑p th√¥ng th∆∞·ªùng, "at" ph·ªï bi·∫øn h∆°n.</div>
            `
        },
        {
            question: "Rania isn't here. She is _____ a party.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. with", type: "prep", meaning: "v·ªõi" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Rania kh√¥ng ·ªü ƒë√¢y. C√¥ ·∫•y ƒëang ·ªü m·ªôt b·ªØa ti·ªác.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "A party" l√† m·ªôt <strong>s·ª± ki·ªán/ho·∫°t ƒë·ªông</strong> (event/activity).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Tr∆∞·ªõc c√°c s·ª± ki·ªán x√£ h·ªôi (party, concert, meeting, conference...), ta lu√¥n d√πng <strong>"at"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Kh√¥ng d√πng "in a party".</div>
            `
        },
        {
            question: "My mother is a teacher. She is _____ school now.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. to", type: "prep", meaning: "t·ªõi" },
                { text: "C. in", type: "prep", meaning: "trong" },
                { text: "D. at", type: "prep", meaning: "t·∫°i" }
            ],
            correct: 3, // D
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> M·∫π t√¥i l√† gi√°o vi√™n. B√† ·∫•y ƒëang ·ªü tr∆∞·ªùng b√¢y gi·ªù.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "School" (tr∆∞·ªùng h·ªçc) ch·ªâ n∆°i l√†m vi·ªác/h·ªçc t·∫≠p.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (D):</strong> C·ª•m c·ªë ƒë·ªãnh <strong>"at school"</strong> (·ªü tr∆∞·ªùng), <strong>"at work"</strong> (·ªü ch·ªó l√†m), <strong>"at home"</strong> (·ªü nh√†). N√≥ ch·ªâ tr·∫°ng th√°i ƒëang l√†m vi·ªác/h·ªçc t·∫≠p t·∫°i ƒë√≥.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In the school" th∆∞·ªùng √°m ch·ªâ v·ªã tr√≠ v·∫≠t l√Ω b√™n trong t√≤a nh√† tr∆∞·ªùng h·ªçc h∆°n l√† ch·ª©c nƒÉng ƒëi d·∫°y/ƒëi h·ªçc.</div>
            `
        },
        {
            question: "What is the weather like _____ the North Pole?",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. from", type: "prep", meaning: "t·ª´" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Th·ªùi ti·∫øt ·ªü B·∫Øc C·ª±c nh∆∞ th·∫ø n√†o?</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The North Pole" (C·ª±c B·∫Øc) ƒë∆∞·ª£c coi l√† m·ªôt ƒëi·ªÉm c·ª±c (a specific point) tr√™n b·∫£n ƒë·ªì Tr√°i ƒê·∫•t.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> V·ªõi c√°c ƒëi·ªÉm c·ª±c (Top, Bottom, North Pole...), ta d√πng <strong>"at"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> N·∫øu n√≥i v·ªÅ v√πng c·ª±c r·ªông l·ªõn (Arctic), c√≥ th·ªÉ d√πng "in". Nh∆∞ng "Pole" l√† m·ªôt ƒëi·ªÉm ch·∫•m -> d√πng "at".</div>
            `
        },

        // GROUP 4: TRANSPORT (Ph∆∞∆°ng ti·ªán giao th√¥ng)
        {
            question: "We usually go to school _____ the bus.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. by", type: "prep", meaning: "b·∫±ng" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Ch√∫ng t√¥i th∆∞·ªùng ƒëi h·ªçc tr√™n xe bu√Ωt.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The bus" l√† ph∆∞∆°ng ti·ªán giao th√¥ng c√¥ng c·ªông, c√≥ s√†n ƒë·ªÉ ƒëi l·∫°i (walk).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Quy t·∫Øc: <strong>on + bus/train/plane/ship</strong> (c√°c ph∆∞∆°ng ti·ªán l·ªõn, c√≥ th·ªÉ ƒë·ª©ng d·∫≠y ƒëi l·∫°i ƒë∆∞·ª£c) ho·∫∑c <strong>on + bike/horse</strong> (ng·ªìi tr√™n y√™n).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> N·∫øu kh√¥ng c√≥ m·∫°o t·ª´ "the", ta d√πng "by bus". Nh∆∞ng ·ªü ƒë√¢y c√≥ "the" -> ph·∫£i d√πng gi·ªõi t·ª´ ch·ªâ v·ªã tr√≠ "on".</div>
            `
        },
        {
            question: "Hurry up! Get _____ the car.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. in", type: "prep", meaning: "trong" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Nhanh l√™n! V√†o trong xe ƒëi.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The car" l√† ph∆∞∆°ng ti·ªán c√° nh√¢n nh·ªè, ph·∫£i c√∫i ng∆∞·ªùi khi v√†o.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> Quy t·∫Øc: <strong>in + car/taxi</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Kh√¥ng d√πng "on the car" (tr·ª´ khi ng·ªìi tr√™n n√≥c xe!).</div>
            `
        },
        {
            question: "I saw her sitting _____ a taxi.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. in", type: "prep", meaning: "trong" },
                { text: "D. over", type: "prep", meaning: "bƒÉng qua" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> T√¥i th·∫•y c√¥ ·∫•y ƒëang ng·ªìi trong m·ªôt chi·∫øc taxi.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Taxi t∆∞∆°ng t·ª± nh∆∞ Car.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> D√πng <strong>"in"</strong> v·ªõi taxi/car.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "On a taxi" l√† sai ng·ªØ ph√°p c∆° b·∫£n v·ªÅ gi·ªõi t·ª´ ch·ªâ ph∆∞∆°ng ti·ªán.</div>
            `
        },
        {
            question: "There were too many passengers _____ the plane.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. from", type: "prep", meaning: "t·ª´" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> C√≥ qu√° nhi·ªÅu h√†nh kh√°ch tr√™n m√°y bay.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Plane (m√°y bay) l√† ph∆∞∆°ng ti·ªán l·ªõn.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> D√πng <strong>"on"</strong> cho m√°y bay (on a plane).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In the plane" c√≥ th·ªÉ d√πng nh∆∞ng r·∫•t √≠t ph·ªï bi·∫øn, "on" l√† chu·∫©n m·ª±c cho ph∆∞∆°ng ti·ªán c√¥ng c·ªông.</div>
            `
        },
        {
            question: "He goes to work _____ his bike.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. by", type: "prep", meaning: "b·∫±ng" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. at", type: "prep", meaning: "t·∫°i" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Anh ·∫•y ƒëi l√†m tr√™n chi·∫øc xe ƒë·∫°p c·ªßa m√¨nh.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Bike (xe ƒë·∫°p) l√† ph∆∞∆°ng ti·ªán ng·ªìi tr√™n y√™n (kh√¥ng c√≥ m√°i che bao quanh).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> D√πng <strong>"on"</strong> cho xe ƒë·∫°p, xe m√°y, ng·ª±a. (on a bike, on a motorbike, on a horse).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> N·∫øu d√πng "by" th√¨ ph·∫£i l√† "by bike" (kh√¥ng c√≥ "his"). Khi c√≥ t√≠nh t·ª´ s·ªü h·ªØu "his" ho·∫∑c m·∫°o t·ª´ "a/the", b·∫Øt bu·ªôc d√πng gi·ªõi t·ª´ v·ªã tr√≠ "on".</div>
            `
        },

        // GROUP 5: ARRIVE IN vs ARRIVE AT
        {
            question: "We arrived _____ Paris late at night.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. in", type: "prep", meaning: "trong" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Ch√∫ng t√¥i ƒë√£ ƒë·∫øn Paris v√†o ƒë√™m mu·ªôn.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Paris l√† m·ªôt th√†nh ph·ªë l·ªõn/th·ªß ƒë√¥.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> C·∫•u tr√∫c: <strong>Arrive in + Th√†nh ph·ªë/Qu·ªëc gia</strong>. (ƒê·ªãa ƒëi·ªÉm l·ªõn).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Arrive kh√¥ng ƒëi v·ªõi "to". Arrive at ch·ªâ d√πng cho ƒë·ªãa ƒëi·ªÉm nh·ªè.</div>
            `
        },
        {
            question: "The train arrived _____ the station at 7 a.m.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> T√†u ƒë√£ ƒë·∫øn nh√† ga l√∫c 7 gi·ªù s√°ng.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The station" (nh√† ga) l√† m·ªôt ƒë·ªãa ƒëi·ªÉm nh·ªè, c·ª• th·ªÉ (point).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> C·∫•u tr√∫c: <strong>Arrive at + ƒë·ªãa ƒëi·ªÉm nh·ªè</strong> (airport, station, school, hotel...).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "Arrive in" d√πng cho v√πng ƒë·ªãa l√Ω r·ªông l·ªõn.</div>
            `
        },
        {
            question: "When did they arrive _____ England?",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. to", type: "prep", meaning: "t·ªõi" },
                { text: "D. in", type: "prep", meaning: "trong" }
            ],
            correct: 3, // D
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> H·ªç ƒë√£ ƒë·∫øn n∆∞·ªõc Anh khi n√†o?</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> England (N∆∞·ªõc Anh) l√† qu·ªëc gia.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (D):</strong> Qu·ªëc gia l√† ƒë·ªãa ƒëi·ªÉm l·ªõn -> D√πng <strong>"Arrive in"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Sai l·ªói ph·ªï bi·∫øn "arrive to" (kh√¥ng t·ªìn t·∫°i trong ti·∫øng Anh chu·∫©n).</div>
            `
        },
        {
            question: "She arrived _____ the hotel safely.",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. into", type: "prep", meaning: "v√†o trong" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> C√¥ ·∫•y ƒë√£ ƒë·∫øn kh√°ch s·∫°n an to√†n.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The hotel" l√† m·ªôt t√≤a nh√†/ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> T√≤a nh√†, kh√°ch s·∫°n l√† ƒëi·ªÉm ƒë·∫øn nh·ªè -> D√πng <strong>"Arrive at"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> D√πng "in" l√† sai quy t·∫Øc ph√¢n lo·∫°i ƒë·ªãa ƒëi·ªÉm l·ªõn/nh·ªè c·ªßa ƒë·ªông t·ª´ Arrive.</div>
            `
        },
        {
            question: "President Obama arrived _____ Hanoi in 2016.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> T·ªïng th·ªëng Obama ƒë√£ ƒë·∫øn H√† N·ªôi v√†o nƒÉm 2016.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> H√† N·ªôi l√† th√†nh ph·ªë.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Th√†nh ph·ªë -> ƒê·ªãa ƒëi·ªÉm l·ªõn -> <strong>"Arrive in"</strong>.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "Arrive at" ch·ªâ d√πng cho s√¢n bay N·ªôi B√†i (Noi Bai Airport) ch·ª© kh√¥ng d√πng cho c·∫£ th√†nh ph·ªë H√† N·ªôi.</div>
            `
        },

        // GROUP 6: MIXED & TRICKY (N√¢ng cao/T·ªïng h·ª£p)
        {
            question: "I read about the news _____ the newspaper.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. to", type: "prep", meaning: "t·ªõi" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> T√¥i ƒë·ªçc tin t·ª©c ƒë√≥ tr√™n b√°o.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> L∆∞u √Ω ƒë·∫∑c bi·ªát! V·ªõi "Book" v√† "Newspaper" (s√°ch/b√°o gi·∫•y).</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> Ta d√πng <strong>"in a newspaper"</strong> (trong t·ªù b√°o) v√¨ coi t·ªù b√°o ch·ª©a ƒë·ª±ng th√¥ng tin b√™n trong.</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Ta d√πng "on" v·ªõi thi·∫øt b·ªã ƒëi·ªán t·ª≠ (on the internet, on TV, on a computer) ho·∫∑c b·ªÅ m·∫∑t trang gi·∫•y (on page 3). Nh∆∞ng n√≥i v·ªÅ t·ªù b√°o n√≥i chung th√¨ d√πng "in".</div>
            `
        },
        {
            question: "He is sitting _____ the armchair.",
            options: [
                { text: "A. on", type: "prep", meaning: "tr√™n" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. with", type: "prep", meaning: "v·ªõi" }
            ],
            correct: 1, // B
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Anh ·∫•y ƒëang ng·ªìi tr√™n gh·∫ø b√†nh.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Armchair l√† gh·∫ø c√≥ tay v·ªãn, ng∆∞·ªùi ng·ªìi l·ªçt th·ªèm v√†o trong.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (B):</strong> V·ªõi gh·∫ø b√†nh (armchair), ta d√πng <strong>"in"</strong> (ng·ªìi l·ªçt v√†o trong).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> V·ªõi gh·∫ø ƒë·∫©u (stool) ho·∫∑c gh·∫ø bƒÉng (bench), gh·∫ø d·ª±a th∆∞·ªùng (chair) ta m·ªõi d√πng "on".</div>
            `
        },
        {
            question: "Is there anything interesting _____ TV tonight?",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. at", type: "prep", meaning: "t·∫°i" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. from", type: "prep", meaning: "t·ª´" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> C√≥ g√¨ th√∫ v·ªã tr√™n TV t·ªëi nay kh√¥ng?</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> TV, Radio, Internet.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> V·ªõi c√°c ph∆∞∆°ng ti·ªán truy·ªÅn th√¥ng ƒëi·ªán t·ª≠, ta d√πng <strong>"on"</strong>. (On TV, on the radio, on the Internet).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In TV" l√† sai collocations.</div>
            `
        },
        {
            question: "My office is _____ the tenth floor.",
            options: [
                { text: "A. at", type: "prep", meaning: "t·∫°i" },
                { text: "B. in", type: "prep", meaning: "trong" },
                { text: "C. on", type: "prep", meaning: "tr√™n" },
                { text: "D. above", type: "prep", meaning: "ph√≠a tr√™n" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> VƒÉn ph√≤ng c·ªßa t√¥i ·ªü t·∫ßng 10.</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> Floor (t·∫ßng c·ªßa t√≤a nh√†) ƒë∆∞·ª£c xem l√† m·ªôt b·ªÅ m·∫∑t.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> Lu√¥n d√πng <strong>"on"</strong> v·ªõi s·ªë t·∫ßng (on the first floor, on the top floor).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> Kh√¥ng d√πng "in/at" v·ªõi s·ªë t·∫ßng.</div>
            `
        },
        {
            question: "Who is that man standing _____ the door?",
            options: [
                { text: "A. in", type: "prep", meaning: "trong" },
                { text: "B. on", type: "prep", meaning: "tr√™n" },
                { text: "C. at", type: "prep", meaning: "t·∫°i" },
                { text: "D. through", type: "prep", meaning: "xuy√™n qua" }
            ],
            correct: 2, // C
            explanation: `
                <div class="exp-step"><strong>1. D·ªãch c√¢u:</strong> Ng∆∞·ªùi ƒë√†n √¥ng ƒëang ƒë·ª©ng ·ªü c·ª≠a l√† ai v·∫≠y?</div>
                <div class="exp-step"><strong>2. Ph√¢n t√≠ch:</strong> "The door" (c√°nh c·ª≠a) ·ªü ƒë√¢y ƒë∆∞·ª£c xem l√† m·ªôt v·ªã tr√≠/ƒëi·ªÉm m·ªëc.</div>
                <div class="exp-step"><strong>3. T·∫°i sao ƒê√öNG (C):</strong> D√πng <strong>"at the door"</strong> ƒë·ªÉ ch·ªâ v·ªã tr√≠ ƒë·ª©ng ngay c·∫°nh c·ª≠a (v√≠ d·ª• khi ai ƒë√≥ g√µ c·ª≠a).</div>
                <div class="exp-step"><strong>4. T·∫°i sao SAI:</strong> "In the door" nghƒ©a l√† b·ªã k·∫πt b√™n trong g·ªó c·ªßa c√°nh c·ª≠a; "On the door" l√† v·∫≠t g√¨ d√°n tr√™n m·∫∑t c·ª≠a.</div>
            `
        }
    ];

    // --- GAME LOGIC ---

    let currentScore = 0;
    const totalQuestions = quizData.length;
    let answeredCount = 0;

    // Shuffle Array Function
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // Audio Context for Sounds (Single File Safe)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High pitch, decays)
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        } else {
            // Wrong sound (Low pitch, wobble)
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
            oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Render Quiz
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        shuffleArray(quizData); // Shuffle questions

        quizData.forEach((item, index) => {
            // Create Card
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${index}`;

            // Create original indices array to track correct answer after shuffle
            let optionIndices = [0, 1, 2, 3];
            shuffleArray(optionIndices); // Shuffle options

            // Store the mapped correct index for this specific card
            let mappedCorrectIndex = optionIndices.indexOf(item.correct);
            
            let optionsHtml = '';
            optionIndices.forEach((originalIndex, displayIndex) => {
                const opt = item.options[originalIndex];
                optionsHtml += `
                    <button class="option-btn" onclick="checkAnswer(${index}, ${displayIndex}, ${mappedCorrectIndex}, this)">
                        ${opt.text} <br> <span style="font-size:0.8rem; color:#666; font-weight:normal;">(${opt.type} - ${opt.meaning})</span>
                    </button>
                `;
            });

            card.innerHTML = `
                <div class="question-number">C√¢u ${index + 1}</div>
                <div class="question-text">${item.question}</div>
                <div class="options-grid">
                    ${optionsHtml}
                </div>
                <div class="explanation-box" id="exp-${index}">
                    <div class="exp-header">
                        <span>üí° GI·∫¢I TH√çCH CHI TI·∫æT (C√¥ Mai An)</span>
                    </div>
                    <div class="exp-content">
                        ${item.explanation}
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // Check Answer Logic
    window.checkAnswer = function(qIndex, selectedIndex, correctIndex, btnElement) {
        // Prevent re-answering
        const card = document.getElementById(`q-${qIndex}`);
        const buttons = card.querySelectorAll('.option-btn');
        if (card.getAttribute('data-answered') === 'true') return;

        card.setAttribute('data-answered', 'true');
        answeredCount++;

        // Show Explanation immediately
        document.getElementById(`exp-${qIndex}`).classList.add('visible');

        if (selectedIndex === correctIndex) {
            // CORRECT
            btnElement.classList.add('correct');
            currentScore++;
            playSound('correct');
            triggerConfetti(btnElement);
        } else {
            // WRONG
            btnElement.classList.add('wrong');
            // Highlight the correct one
            buttons[correctIndex].classList.add('correct');
            playSound('wrong');
        }

        // Disable all buttons in this card
        buttons.forEach(btn => btn.disabled = true);
    };

    // Submit & Result
    window.submitQuiz = function() {
        const modal = document.getElementById('result-modal');
        const scoreText = document.getElementById('final-score');
        const feedback = document.getElementById('feedback-text');

        modal.style.display = 'flex';
        scoreText.innerText = `${currentScore}/${totalQuestions}`;

        if (currentScore === totalQuestions) {
            feedback.innerText = "üåü Xu·∫•t s·∫Øc! Con l√† b·∫≠c th·∫ßy gi·ªõi t·ª´ r·ªìi!";
            startConfettiLoop();
        } else if (currentScore >= totalQuestions * 0.8) {
            feedback.innerText = "üëè R·∫•t gi·ªèi! Con ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i.";
        } else if (currentScore >= totalQuestions * 0.5) {
            feedback.innerText = "üí™ C·ªë l√™n! Con c·∫ßn √¥n l·∫°i l√Ω thuy·∫øt In/On/At nh√©.";
        } else {
            feedback.innerText = "üìö Con h√£y xem k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch v√† l√†m l·∫°i nh√©!";
        }
    };

    // --- CONFETTI EFFECT (Canvas) ---
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particles = [];
    const colors = ['#8854C0', '#00C9A7', '#FF4757', '#FFD700', '#00D26A'];

    function triggerConfetti(element) {
        const rect = element.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;

        for (let i = 0; i < 30; i++) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10 - 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 8 + 4,
                life: 100
            });
        }
        requestAnimationFrame(updateConfetti);
    }

    function startConfettiLoop() {
        setInterval(() => {
            const x = Math.random() * canvas.width;
            const y = -10;
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 5,
                    vy: Math.random() * 5 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    life: 200
                });
            }
        }, 100);
        updateConfetti();
    }

    function updateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        for (let i = 0; i < particles.length; i++) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.2; // gravity
            p.life--;
            p.size *= 0.98;

            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);

            if (p.life <= 0) {
                particles.splice(i, 1);
                i--;
            }
        }

        if (particles.length > 0) {
            requestAnimationFrame(updateConfetti);
        }
    }

    // Init
    window.onload = renderQuiz;

</script>
</body>
</html>