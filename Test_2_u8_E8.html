<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 8: Shopping - Interactive Test</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1, h2 {
            text-align: center;
            color: var(--primary-color);
        }

        .header-info {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        /* Reading/Data Boxes */
        .content-box {
            background-color: #eef2ff;
            border: 2px solid #c7d2fe;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.05em;
            position: relative;
        }

        .content-box h3 {
            margin-top: 0;
            color: #3730a3;
            font-size: 1.1em;
            text-transform: uppercase;
        }

        .options-box {
            background-color: #fff7ed;
            border: 2px solid #fed7aa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        /* Question Styles */
        .question-card {
            background: var(--card-bg);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary-color);
            transition: transform 0.2s;
        }

        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .question-text {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .question-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px auto;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
            .full-width-options .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-label {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-label:hover {
            background-color: #f9fafb;
            border-color: var(--primary-color);
        }

        input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        /* Feedback Styles */
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            background-color: #f8fafc;
            border-left: 4px solid #64748b;
        }

        .feedback.correct {
            border-left-color: var(--success-color);
            background-color: #f0fdf4;
        }

        .feedback.incorrect {
            border-left-color: var(--error-color);
            background-color: #fef2f2;
        }

        .explanation-text {
            margin-top: 10px;
            font-size: 0.95em;
        }

        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
        }
        .tag.n { background: #dbeafe; color: #1e40af; } /* Noun */
        .tag.v { background: #dcfce7; color: #166534; } /* Verb */
        .tag.adj { background: #ffedd5; color: #9a3412; } /* Adj */
        .tag.adv { background: #f3e8ff; color: #6b21a8; } /* Adv */

        /* Buttons */
        .btn-check {
            margin-top: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-check:hover {
            background-color: #1d4ed8;
        }

        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 100;
        }

        .btn-submit-all {
            background-color: #059669;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn-submit-all:hover {
            background-color: #047857;
        }

        /* Result Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        /* Underline utilities */
        .u { text-decoration: underline; text-underline-offset: 4px; }
        .highlight-correct { background-color: #dcfce7 !important; border-color: #22c55e !important; }
        .highlight-wrong { background-color: #fee2e2 !important; border-color: #ef4444 !important; }
        
        .gap-fill-input {
            display: inline-block;
            width: 40px;
            border-bottom: 2px solid #333;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
        }

    </style>
</head>
<body>

<div class="container">
    <div class="header-info">
        <h1>ENGLISH TEST - UNIT 8: SHOPPING</h1>
        <p><strong>Master English Teacher & Web Expert</strong></p>
        <p><em>Hãy hoàn thành 40 câu hỏi bên dưới. Nhấn "Check" để xem giải thích chi tiết từng câu hoặc "Nộp bài" để xem tổng điểm.</em></p>
    </div>

    <form id="quiz-form">
        </form>

    <div style="height: 100px;"></div> </div>

<div class="sticky-footer">
    <button type="button" class="btn-submit-all" onclick="submitAll()">NỘP BÀI & XEM ĐIỂM</button>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h2>Kết Quả Của Bạn</h2>
        <div class="score-circle" id="scoreDisplay">0/40</div>
        <p id="scoreMessage">Hãy cố gắng hơn nhé!</p>
        <button class="btn-check" onclick="closeModal()">Xem lại bài làm</button>
    </div>
</div>

<script>
    // DATA STORE
    const quizData = [
        // PRONUNCIATION
        {
            id: 1,
            type: "normal",
            question: "Choose the word whose underlined part differs from the other three in pronunciation.",
            text: "A. br<u>a</u>nd &nbsp; B. r<u>a</u>nge &nbsp; C. s<u>a</u>le &nbsp; D. b<u>a</u>ke",
            options: ["brand", "range", "sale", "bake"],
            correct: 0, // brand (æ) vs others (eɪ)
            explanation: `
                <p><strong>Đáp án A (brand)</strong> phát âm là <strong>/æ/</strong>.</p>
                <p>Các đáp án còn lại phát âm là <strong>/eɪ/</strong>:</p>
                <ul>
                    <li>B. range /reɪndʒ/</li>
                    <li>C. sale /seɪl/</li>
                    <li>D. bake /beɪk/</li>
                </ul>
            `
        },
        {
            id: 2,
            type: "normal",
            question: "Choose the word whose underlined part differs from the other three in pronunciation.",
            text: "A. s<u>t</u>adium &nbsp; B. of<u>t</u>en &nbsp; C. cas<u>t</u>le &nbsp; D. whis<u>t</u>le",
            options: ["stadium", "often", "castle", "whistle"],
            correct: 0,
            explanation: `
                <p><strong>Đáp án A (stadium)</strong> chữ 't' được phát âm rõ là <strong>/t/</strong> (/ˈsteɪ.di.əm/).</p>
                <p>Các đáp án còn lại là âm câm (silent t) hoặc thường bị lược bỏ:</p>
                <ul>
                    <li>B. often /ˈɒf.ən/ (chữ t thường câm)</li>
                    <li>C. castle /ˈkɑː.səl/ (t câm)</li>
                    <li>D. whistle /ˈwɪs.əl/ (t câm)</li>
                </ul>
            `
        },
        // STRESS
        {
            id: 3,
            type: "normal",
            question: "Choose the word that differs from the other three in the position of primary stress.",
            text: "A. episode &nbsp; B. addicted &nbsp; C. excitement &nbsp; D. assistant",
            options: ["episode", "addicted", "excitement", "assistant"],
            correct: 0,
            explanation: `
                <p><strong>Đáp án A (episode)</strong> trọng âm rơi vào âm tiết thứ <strong>1</strong> (/ˈep.ɪ.səʊd/).</p>
                <p>Các từ còn lại trọng âm rơi vào âm tiết thứ <strong>2</strong>:</p>
                <ul>
                    <li>B. addicted /əˈdɪk.tɪd/</li>
                    <li>C. excitement /ɪkˈsaɪt.mənt/</li>
                    <li>D. assistant /əˈsɪs.tənt/</li>
                </ul>
            `
        },
        {
            id: 4,
            type: "normal",
            question: "Choose the word that differs from the other three in the position of primary stress.",
            text: "A. receive &nbsp; B. repeat &nbsp; C. private &nbsp; D. provide",
            options: ["receive", "repeat", "private", "provide"],
            correct: 2,
            explanation: `
                <p><strong>Đáp án C (private)</strong> trọng âm rơi vào âm tiết thứ <strong>1</strong> (/ˈpraɪ.vət/).</p>
                <p>Các từ còn lại là động từ 2 âm tiết, trọng âm thường rơi vào âm tiết thứ <strong>2</strong>:</p>
                <ul>
                    <li>A. receive /rɪˈsiːv/</li>
                    <li>B. repeat /rɪˈpiːt/</li>
                    <li>D. provide /prəˈvaɪd/</li>
                </ul>
            `
        },
        // GRAMMAR & VOCAB
        {
            id: 5,
            type: "normal",
            question: "The responsibility of a _____ is to provide customers with help and sell goods.",
            options: ["Shop assistant", "dealer", "customer service", "cashier"],
            correct: 0,
            explanation: `
                <p><strong>Dịch:</strong> Trách nhiệm của một <em>nhân viên bán hàng</em> là giúp đỡ khách hàng và bán hàng hóa.</p>
                <ul>
                    <li><span class="tag n">Noun</span> <strong>Shop assistant</strong>: Nhân viên bán hàng (người trực tiếp bán và tư vấn).</li>
                    <li><span class="tag n">Noun</span> Dealer: Người buôn bán (thường là số lượng lớn hoặc xe cộ).</li>
                    <li><span class="tag n">Noun</span> Customer service: Dịch vụ chăm sóc khách hàng (bộ phận, không chỉ 1 người).</li>
                    <li><span class="tag n">Noun</span> Cashier: Thu ngân (người chỉ lo tính tiền).</li>
                </ul>
            `
        },
        {
            id: 6,
            type: "normal",
            question: "I don’t know how to ______ for lower prices so I shop in supermarkets as they have fixed prices.",
            options: ["bargain", "negotiate", "discuss", "beg"],
            correct: 0,
            explanation: `
                <p><strong>Dịch:</strong> Tôi không biết cách <em>mặc cả</em> để có giá thấp hơn nên tôi mua ở siêu thị vì họ có giá niêm yết.</p>
                <ul>
                    <li><span class="tag v">Verb</span> <strong>Bargain</strong>: Mặc cả, trả giá (thông dụng nhất khi mua sắm).</li>
                    <li><span class="tag v">Verb</span> Negotiate: Đàm phán (thường dùng trong kinh doanh, hợp đồng).</li>
                    <li><span class="tag v">Verb</span> Discuss: Thảo luận.</li>
                    <li><span class="tag v">Verb</span> Beg: Cầu xin.</li>
                </ul>
            `
        },
        {
            id: 7,
            type: "normal",
            question: "The factory outlets ______ a special offer for all items next week as planned.",
            options: ["will give", "give", "are giving", "are going to give"],
            correct: 2,
            explanation: `
                <p><strong>Dịch:</strong> Các cửa hàng đại lý sẽ đưa ra ưu đãi đặc biệt cho tất cả mặt hàng vào tuần tới như đã lên kế hoạch.</p>
                <p><strong>Giải thích:</strong> Cụm từ "as planned" (như đã lên kế hoạch) và thời gian cụ thể trong tương lai thường dùng <strong>Present Continuous</strong> (Hiện tại tiếp diễn) để diễn tả một sự sắp xếp cố định (arrangement) hoặc kế hoạch chắc chắn.</p>
                <ul>
                    <li>A. Will give: Tương lai đơn (quyết định tức thời).</li>
                    <li>B. Give: Hiện tại đơn (lịch trình tàu xe).</li>
                    <li>C. <strong>Are giving</strong>: Tương lai gần (kế hoạch đã định sẵn).</li>
                    <li>D. Are going to give: Dự định (Intention). Tuy nhiên "are giving" tự nhiên hơn với "arrangement".</li>
                </ul>
            `
        },
        {
            id: 8,
            type: "normal",
            question: "The Community Fair _______ this Spring, and we have all decided to attend it.",
            options: ["is held", "will be held", "will take place", "is taking place"],
            correct: 1,
            explanation: `
                <p><strong>Dịch:</strong> Hội chợ Cộng đồng sẽ được tổ chức vào mùa xuân này, và chúng tôi đều đã quyết định tham gia.</p>
                <p><strong>Giải thích:</strong> Chủ ngữ "The Community Fair" là vật -> Cần dùng bị động (Passive Voice) với động từ "hold" (tổ chức) hoặc chủ động với "take place" (diễn ra).</p>
                <ul>
                    <li>A. is held: Hiện tại đơn (chỉ thói quen/sự thật hiển nhiên). Ở đây nói về sự kiện cụ thể sắp tới.</li>
                    <li>B. <strong>will be held</strong>: Tương lai đơn bị động (sẽ được tổ chức). Phù hợp ngữ cảnh.</li>
                    <li>C. will take place: Sẽ diễn ra (đúng ngữ pháp nhưng B phổ biến hơn khi nói về việc được tổ chức bởi ai đó).</li>
                    <li>D. is taking place: Đang diễn ra (hoặc sắp diễn ra - arrangement).</li>
                </ul>
                <p><em>Lưu ý:</em> Trong trắc nghiệm, "will be held" là đáp án an toàn nhất cho cấu trúc bị động tương lai.</p>
            `
        },
        {
            id: 9,
            type: "normal",
            question: "________ they took their laptops to the shop, they asked for their receipts.",
            options: ["If", "When", "Since", "Because"],
            correct: 1,
            explanation: `
                <p><strong>Dịch:</strong> <em>Khi</em> họ mang laptop đến cửa hàng, họ đã hỏi lấy hóa đơn.</p>
                <ul>
                    <li>B. <strong>When</strong>: Khi (diễn tả trình tự thời gian).</li>
                    <li>A. If: Nếu (câu điều kiện, sai nghĩa).</li>
                    <li>C. Since/Because: Bởi vì (nguyên nhân - kết quả). Việc mang laptop không phải là nguyên nhân trực tiếp của việc hỏi hóa đơn mà là bối cảnh thời gian.</li>
                </ul>
            `
        },
        {
            id: 10,
            type: "normal",
            question: "Tom: 'Do you ever drink coffee?' – Lan: 'Yes, but only _____, not often. Just a few times a week.'",
            options: ["usually", "sometimes", "rarely", "never"],
            correct: 1,
            explanation: `
                <p><strong>Dịch:</strong> Lan: 'Có, nhưng chỉ <em>thỉnh thoảng</em> thôi, không thường xuyên. Chỉ vài lần một tuần.'</p>
                <ul>
                    <li>"Just a few times a week" (vài lần 1 tuần) tương đương với mức độ trung bình thấp.</li>
                    <li>"Not often" (không thường xuyên) loại bỏ Usually.</li>
                    <li>B. <strong>Sometimes</strong>: Thỉnh thoảng (phù hợp nhất).</li>
                    <li>C. Rarely: Hiếm khi (gần như không bao giờ, mâu thuẫn với "vài lần một tuần").</li>
                </ul>
            `
        },
        {
            id: 11,
            type: "normal",
            question: "I went through about 4 years of being addicted ________ video games.",
            options: ["play", "to play", "to playing", "playing"],
            correct: 2,
            explanation: `
                <p><strong>Cấu trúc:</strong> to be addicted to + V-ing/Noun (nghiện cái gì/làm gì).</p>
                <ul>
                    <li>Ví dụ: He is addicted to smoking.</li>
                    <li>Đáp án đúng: <strong>C. to playing</strong>.</li>
                </ul>
            `
        },
        {
            id: 12,
            type: "normal",
            question: "You are still responsible _____ paying the shipping costs if you return an item.",
            options: ["on", "off", "for", "in"],
            correct: 2,
            explanation: `
                <p><strong>Cấu trúc:</strong> to be responsible for + V-ing/Noun (chịu trách nhiệm về việc gì).</p>
                <ul>
                    <li>Đáp án đúng: <strong>C. for</strong>.</li>
                </ul>
            `
        },
        // CLOZE 1
        {
            id: "cloze1",
            type: "cloze-group",
            text: `
                <h3>YEAR-END PARTY</h3>
                <p>You are invited to <strong>(13)</strong> ____ us. January 09, 2024. 17:00 P.M School Hall.</p>
                <p>Ho! Ho! Ho! It’s that time of year <strong>(14)</strong> ____.</p>
                <p>We’re so excited <strong>(15)</strong> ____ no one will be absent.</p>
                <p>Please contact if you <strong>(16)</strong> _____ your friends to the party.</p>
            `,
            questions: [
                {
                    id: 13,
                    question: "Question 13:",
                    options: ["enjoy", "join", "participate", "take part"],
                    correct: 1,
                    explanation: "<p><strong>Join us:</strong> Tham gia cùng chúng tôi (thường dùng khi mời). Participate/Take part in cần giới từ 'in'.</p>"
                },
                {
                    id: 14,
                    question: "Question 14:",
                    options: ["about", "above", "alike", "again"],
                    correct: 3,
                    explanation: "<p><strong>It's that time of year again:</strong> Lại đến thời điểm đó trong năm rồi (cụm từ cố định chỉ các dịp lễ tết lặp lại).</p>"
                },
                {
                    id: 15,
                    question: "Question 15:",
                    options: ["why", "if", "that", "whether"],
                    correct: 2,
                    explanation: "<p><strong>So + Adj + that + Clause:</strong> Quá... đến nỗi mà... (Chúng tôi hào hứng đến mức mong không ai vắng mặt).</p>"
                },
                {
                    id: 16,
                    question: "Question 16:",
                    options: ["brings", "bringing", "bring", "to bring"],
                    correct: 2,
                    explanation: "<p><strong>Câu điều kiện loại 1 (If + S + V_hientai):</strong> If you bring... (Nếu bạn mang theo bạn bè...).</p>"
                }
            ]
        },
        // SENTENCE ARRANGEMENT
        {
            id: 17,
            type: "normal",
            question: "Arrange the sentences to make a meaningful paragraph.",
            extraContent: `
                <div class="content-box">
                    <strong>Sentences:</strong><br>
                    (a) Then, destinations include the Grand Canyon, the Great Barrier Reef, Mount Everest, and Victoria Falls.<br>
                    (b) Finally, to join the trip, please register by June 15th.<br>
                    (c) First, an upcoming trip will take you to see some of the world’s most incredible natural wonders.<br>
                    (d) Next, the trip starts on July 1st and lasts for two weeks. Moreover, you will enjoy both guided tours and free time to explore.<br>
                    <em>(Note: Some versions include an 'Additionally' sentence, but based on logic flow: First -> Next -> Then -> Finally)</em>
                </div>
            `,
            options: ["c-d-a-b", "c-a-d-b", "a-c-d-b", "c-d-b-a"],
            correct: 0,
            explanation: `
                <p><strong>Trật tự logic:</strong></p>
                <ol>
                    <li><strong>(c) First...:</strong> Giới thiệu chung về chuyến đi (upcoming trip).</li>
                    <li><strong>(d) Next...:</strong> Thông tin chi tiết về thời gian (starts on July 1st) và hoạt động.</li>
                    <li><strong>(a) Then...:</strong> Liệt kê địa điểm cụ thể (destinations include...).</li>
                    <li><strong>(b) Finally...:</strong> Hướng dẫn đăng ký (call to action).</li>
                </ol>
                <p>Đáp án: <strong>A. c-d-a-b</strong></p>
            `
        },
        {
            id: 18,
            type: "normal",
            question: "Arrange the sentences to make a meaningful paragraph.",
            extraContent: `
                <div class="content-box">
                    <strong>Sentences:</strong><br>
                    (a) More than 300 students attended the fair and enjoyed Vietnamese dishes, songs and games.<br>
                    (b) In my view, the day was a great success. All the attendees felt happy.<br>
                    (c) There were 30 stalls where various activities were offered.<br>
                    (d) Yesterday, our school organized the Spring Fair in the playground.<br>
                    (e) However, it would be better if we could make Banh Chung during the night.
                </div>
            `,
            options: ["d-a-c-b-e", "d-b-a-c-e", "b-d-a-e-c", "b-c-d-e-a"],
            correct: 0,
            explanation: `
                <p><strong>Trật tự logic:</strong></p>
                <ol>
                    <li><strong>(d) Yesterday...:</strong> Giới thiệu bối cảnh thời gian/sự kiện (Mở bài).</li>
                    <li><strong>(a) More than 300 students...:</strong> Số lượng người tham gia và hoạt động chung.</li>
                    <li><strong>(c) There were 30 stalls...:</strong> Chi tiết cụ thể hơn về các gian hàng.</li>
                    <li><strong>(b) In my view...:</strong> Nhận xét tổng quan (Thành công).</li>
                    <li><strong>(e) However...:</strong> Một chút nuối tiếc/góp ý (thường đứng sau nhận xét hoặc cuối cùng để chốt ý kiến cá nhân).</li>
                </ol>
                <p>Hoặc: d (Mở) -> a (Chi tiết người) -> c (Chi tiết vật) -> b (Tổng kết: thành công) -> e (Góp ý thêm). </p>
                <p>Đáp án A (d-a-c-b-e) là hợp lý nhất về mạch văn kể chuyện.</p>
            `
        },
        // CLOZE 2
        {
            id: "cloze2",
            type: "cloze-group",
            text: `
                <h3>READING PASSAGE</h3>
                <p>The most important <strong>(19)</strong> _____ that influences a person to go shopping is the needs or wants of the individual or people related <strong>(20)</strong> ____ him/ her. For example, everyone goes to the mall to buy basic necessities like food, clothes, health supplies and others. Irrespective of the age being 16 or 60, the person will have to go to the shop or buy it only. They will ship less if they have <strong>(21)</strong> ____ mouth to feed and shop more if the number of dependents is <strong>(22)</strong> _____. Secondly, a person cannot purchase anything <strong>(23)</strong> _____ he/ she has the monetary means to do so. This means that if one has more money, one will spend equally on luxury items and fundamental needs. On the other hand, a person with less <strong>(24)</strong> _____ stability will focus more on vital merchandise.</p>
            `,
            questions: [
                {
                    id: 19,
                    question: "Question 19:",
                    options: ["effect", "factor", "reaction", "person"],
                    correct: 1,
                    explanation: "<p><strong>Factor:</strong> Yếu tố. (Yếu tố quan trọng nhất ảnh hưởng đến việc mua sắm...).</p>"
                },
                {
                    id: 20,
                    question: "Question 20:",
                    options: ["to", "with", "about", "within"],
                    correct: 0,
                    explanation: "<p><strong>Related to:</strong> Liên quan đến.</p>"
                },
                {
                    id: 21,
                    question: "Question 21:",
                    options: ["less", "more", "much", "many"],
                    correct: 0,
                    explanation: "<p>Logic: Mua sắm ít hơn (shop less) nếu có <strong>ít</strong> miệng ăn hơn. Dùng <strong>less</strong> (thực tế ngữ pháp chuẩn là 'fewer mouths' nhưng trong các đáp án này 'less' đối lập với ý sau).</p>"
                },
                {
                    id: 22,
                    question: "Question 22:",
                    options: ["least", "less", "many", "more"],
                    correct: 3,
                    explanation: "<p>Logic: Mua sắm nhiều hơn (shop more) nếu số lượng người phụ thuộc <strong>nhiều hơn (more)</strong>.</p>"
                },
                {
                    id: 23,
                    question: "Question 23:",
                    options: ["when", "if", "unless", "whether"],
                    correct: 2,
                    explanation: "<p><strong>Unless:</strong> Trừ khi. (Người ta không thể mua gì <em>trừ khi</em> họ có tiền). = If... not.</p>"
                },
                {
                    id: 24,
                    question: "Question 24:",
                    options: ["finance", "financial", "financials", "financially"],
                    correct: 1,
                    explanation: "<p>Cần tính từ bổ nghĩa cho danh từ 'stability'. -> <strong>Financial stability</strong> (Sự ổn định tài chính).</p>"
                }
            ]
        },
        // TRANSFORMATION
        {
            id: 25,
            type: "normal",
            question: "Choose the sentence closest in meaning: 'I like spending time with my sister over the weekend to browse instead of buying.'",
            options: [
                "I enjoy getting out with my sister on the weekends to browse and buy.",
                "I prefer getting out with my sister on the weekends to buy something.",
                "I’m interested in spending time with my sister to browse",
                "On the weekends, I like to spend time with my sister to browse instead of making purchases."
            ],
            correct: 3,
            explanation: `
                <p><strong>Câu gốc:</strong> Tôi thích dành thời gian với chị gái cuối tuần để đi xem đồ (browse) thay vì mua (instead of buying).</p>
                <ul>
                    <li>A. Sai (browse and buy).</li>
                    <li>B. Sai (prefer... to buy).</li>
                    <li>D. <strong>Correct:</strong> "making purchases" đồng nghĩa với "buying". Cấu trúc giữ nguyên ý nghĩa xem chứ không mua.</li>
                </ul>
            `
        },
        {
            id: 26,
            type: "normal",
            question: "Choose the sentence closest in meaning: 'Due to the supermarket’s set prices, I am unable to bargain there.'",
            options: [
                "Because the fixed prices at supermarkets, I can never haggle there.",
                "Since grocery pricing are set, I can never haggle there.",
                "I can never bargain at a supermarket because the prices is fixed.",
                "Since grocery pricing are fixed, I never can haggle there."
            ],
            correct: 1,
            explanation: `
                <p><strong>Câu gốc:</strong> Do giá niêm yết của siêu thị, tôi không thể mặc cả.</p>
                <ul>
                    <li>A. Sai ngữ pháp: "Because" + mệnh đề (không được dùng cụm danh từ thiếu động từ). Phải là "Because of".</li>
                    <li>C. Sai ngữ pháp: "prices is" (số nhiều đi với tobe số ít).</li>
                    <li>D. Sai trật tự từ: "never can" (thường là "can never"). Và lỗi "pricing are".</li>
                    <li>B. <strong>Chấp nhận được nhất:</strong> Dù "pricing" (việc định giá) thường là không đếm được (dùng 'is'), nhưng trong văn cảnh bài thi này, người ra đề có thể coi "pricing" tương đương "prices". Cấu trúc "Since + clause" (Vì giá đã được ấn định...) là đúng ngữ pháp câu phức.</li>
                </ul>
            `
        },
        // SENTENCE BUILDING
        {
            id: 27,
            type: "normal",
            question: "Build sentence: They/ often/ spend/ hours/ bargain/ shop/ for discounts.",
            options: [
                "They often spend hours bargaining and shopping for discounts.",
                "They often spend hours to bargain and shopping for discounts.",
                "They often spend hours to bargain and shop for discounts.",
                "They often spend hours bargain and shop for discounts."
            ],
            correct: 0,
            explanation: `
                <p><strong>Cấu trúc:</strong> Spend + time + V-ing (Dành thời gian làm gì).</p>
                <p>Đáp án A: <em>spend hours bargaining and shopping</em> là chính xác.</p>
            `
        },
        {
            id: 28,
            type: "normal",
            question: "Build sentence: Online shopping/ convenient/ it/ sometimes/ disappoint/ quality.",
            options: [
                "Online shopping is convenient, but it sometimes disappoints in quality.",
                "Online shopping is convenient, but it sometimes disappoint in quality.",
                "Online shopping is convenient, it sometimes disappoints in quality.",
                "Online shopping is convenient, and it sometimes disappoint in quality."
            ],
            correct: 0,
            explanation: `
                <p><strong>Phân tích:</strong></p>
                <ul>
                    <li>Chủ ngữ "it" (số ít) -> động từ "disappoints" (thêm s). -> Loại B, D.</li>
                    <li>Cần liên từ nối hai mệnh đề đối lập (convenient >< disappoint). -> Dùng "but".</li>
                    <li>Đáp án C sai vì lỗi "comma splice" (dấu phẩy nối 2 mệnh đề độc lập mà không có liên từ).</li>
                    <li><strong>Đáp án A</strong> là chính xác.</li>
                </ul>
            `
        },
        // SIGN & NOTICE
        {
            id: 29,
            type: "normal",
            question: "What does the sign mean?",
            extraContent: `<img src="image_14122c.png" alt="CAUTION: USE OTHER DOOR sign with arrow" class="question-image" onerror="this.src='https://via.placeholder.com/300x150?text=CAUTION:+USE+OTHER+DOOR'; this.alt='Image Placeholder';">
                           <p style="text-align:center; font-style:italic; font-size:0.8em; color:red;">(Lưu ý: Nếu không thấy ảnh, biển báo ghi: "CAUTION - USE OTHER DOOR" kèm mũi tên)</p>`,
            options: [
                "You should use this door if you want to enter",
                "Please use a different door to go inside the building",
                "This door can only be used for emergencies and is not for general use",
                "This door cannot be opened because it is blocked."
            ],
            correct: 1,
            explanation: `
                <p>Biển báo ghi: <strong>"USE OTHER DOOR"</strong> (Sử dụng cửa khác).</p>
                <p>Đáp án B: "Please use a different door..." (Vui lòng dùng cửa khác) là đúng nghĩa nhất.</p>
            `
        },
        {
            id: 30,
            type: "normal",
            question: "What does the notice say?",
            extraContent: `
                <div class="content-box" style="text-align:center; font-weight:bold; color:red; border: 2px solid red;">
                    The parking lot will be full on Saturday due to a big event. Please park on the street.
                </div>
            `,
            options: [
                "Please don’t park on Saturday, we have an event.",
                "You can park in the parking lot on Saturday without any problems.",
                "There will be more parking on Saturday.",
                "There will be more cars in the parking lot on Saturday, park on the street."
            ],
            correct: 3,
            explanation: `
                <p><strong>Nội dung:</strong> Bãi đậu xe sẽ đầy (full) vào thứ 7 do sự kiện lớn. Vui lòng đậu xe ngoài đường (park on the street).</p>
                <ul>
                    <li>D. "There will be more cars... park on the street" (Sẽ có nhiều xe... hãy đậu ngoài đường). Đúng ý nghĩa nhất.</li>
                    <li>A sai vì không cấm đậu hoàn toàn, chỉ bảo đậu chỗ khác.</li>
                </ul>
            `
        },
        // READING COMPREHENSION
        {
            id: "reading_comp",
            type: "cloze-group",
            text: `
                <h3>ONLINE SHOPPING</h3>
                <p>My name is Sara, and I love shopping online. I prefer mobile phone apps, but sometimes I use my computer. The phone is more convenient for me, and I can even do my shopping from bed.</p>
                <p>I love shopping so much that I buy everything I need at home. I get food, electronics, books, and even large pieces of furniture like my sofa and bookshelves all online! But I still prefer getting clothes from a store so I can try them on to be sure they fit me fine.</p>
                <p>Yesterday, I bought a birthday present for my mother, and it arrived today! That saves me a lot of time. I am a very busy person, and I am a little forgetful too. If I think of something I need, then it is wonderful that I can buy it that moment.</p>
                <p>My friends aren't as comfortable with buying things online as I am because they think that it can be dangerous. Of course, bad things sometimes happen, but I am very careful with all of my personal details. I think the biggest fear that people have with using their credit cards online is that someone will steal their number. It is important to be sure that the web page is secure. You can see this if the address has got an "s" in it, like https://. That "s" means it is safe.</p>
                <p>People should not be afraid of shopping online. I think it will be the only way we will do our shopping in the future!</p>
            `,
            questions: [
                {
                    id: 31,
                    question: "Question 31: What is Sara’s favorite way of shopping?",
                    options: ["On her computer", "On her phone", "In a shop", "In an open-air market"],
                    correct: 1,
                    explanation: "<p>Dẫn chứng đoạn 1: 'I prefer mobile phone apps... The phone is more convenient for me'. (Tôi thích ứng dụng điện thoại hơn).</p>"
                },
                {
                    id: 32,
                    question: "Question 32: What doesn’t Sara buy online?",
                    options: ["Books", "Clothes", "Furniture", "Electronics"],
                    correct: 1,
                    explanation: "<p>Dẫn chứng đoạn 2: 'But I still prefer getting <strong>clothes</strong> from a store so I can try them on'. (Tôi vẫn thích mua quần áo ở cửa hàng hơn).</p>"
                },
                {
                    id: 33,
                    question: "Question 33: Why does Sara think online shopping is very convenient?",
                    options: ["It’s cheap", "It’s slow", "It’s fast", "It’s beautiful"],
                    correct: 2,
                    explanation: "<p>Dẫn chứng đoạn 3: '...it arrived today! That saves me a lot of time.' (Tiết kiệm thời gian = Nhanh).</p>"
                },
                {
                    id: 34,
                    question: "Question 34: What does “Steal” mean in paragraph 4?",
                    options: ["To shop online", "To use something that is not yours", "To make public", "To take without permission"],
                    correct: 3,
                    explanation: "<p><strong>Steal (Ăn trộm):</strong> To take without permission (Lấy mà không được phép).</p>"
                },
                {
                    id: 35,
                    question: "Question 35: Sara thinks that shopping online _____",
                    options: ["is complex", "is often dangerous", "is always safe", "is safe if you are careful"],
                    correct: 3,
                    explanation: "<p>Dẫn chứng đoạn 4: '...bad things sometimes happen, but I am very careful... It is important to be sure that the web page is secure.' (Nó an toàn nếu bạn cẩn thận).</p>"
                },
                {
                    id: 36,
                    question: "Question 36: Sara thinks that in the future ________.",
                    options: ["Everybody will only shop online", "Nobody will shop online", "Only shopping will be safer", "A lot of people will shop online"],
                    correct: 0,
                    explanation: "<p>Dẫn chứng câu cuối: 'I think it will be the <strong>only way</strong> we will do our shopping in the future!' (Tôi nghĩ đó sẽ là cách duy nhất chúng ta mua sắm - tức là ai cũng sẽ mua online).</p>"
                }
            ]
        },
        // GAP FILL READING
        {
            id: "gap_fill",
            type: "cloze-group",
            text: `
                <h3>GAP FILLING</h3>
                <div class="options-box">
                    <strong>A</strong> - especially when selecting gifts for others on special occasions<br>
                    <strong>B</strong> - Online shopping is a popular choice for those with busy schedules<br>
                    <strong>C</strong> - but they can cause frustration when technical issues arise and assistance is unavailable<br>
                    <strong>D</strong> - leading to disappointment and the need to return items at the customer’s expense
                </div>
                <div class="content-box">
                    Shopping can sometimes be a challenging experience, <strong>(37)</strong> ______. Many people choose to give gift vouchers, allowing recipients to shop at their convenience. <strong>(38)</strong> _____ , as it lets them purchase essential or luxury items from home or while on the go. Deliveries are often free, and prices are usually lower than those in physical stores. However, the description or quality of online products may differ from expectations, <strong>(39)</strong> _____. For in-store shopping, self-service payment machines are commonly used to save time by avoiding long queues, <strong>(40)</strong> _____.
                </div>
            `,
            questions: [
                { id: 37, question: "Question 37:", options: ["A", "B", "C", "D"], correct: 0, explanation: "Đoạn trước nói về 'challenging experience' (trải nghiệm khó khăn), đoạn sau nói về 'give gift vouchers' (tặng phiếu quà). A khớp nghĩa: đặc biệt khi chọn quà cho người khác." },
                { id: 38, question: "Question 38:", options: ["A", "B", "C", "D"], correct: 1, explanation: "Đầu câu cần chủ ngữ. Đoạn sau giải thích lợi ích (purchase form home). B khớp: Mua sắm online là lựa chọn phổ biến..." },
                { id: 39, question: "Question 39:", options: ["A", "B", "C", "D"], correct: 3, explanation: "Trước đó nói 'quality... differ from expectations' (chất lượng khác kỳ vọng). D là hệ quả: dẫn đến thất vọng (disappointment)." },
                { id: 40, question: "Question 40:", options: ["A", "B", "C", "D"], correct: 2, explanation: "Trước đó nói lợi ích máy thanh toán tự động (save time). C là mặt trái (tương phản): nhưng chúng có thể gây ức chế khi lỗi kỹ thuật." }
            ]
        }
    ];

    // RENDER FUNCTIONS
    const form = document.getElementById('quiz-form');

    function renderQuiz() {
        quizData.forEach(item => {
            if (item.type === 'normal') {
                renderNormalQuestion(item);
            } else if (item.type === 'cloze-group') {
                renderClozeGroup(item);
            }
        });
    }

    function renderNormalQuestion(item) {
        const div = document.createElement('div');
        div.className = 'question-card';
        div.id = `q-card-${item.id}`;
        
        let html = `<div class="question-text">Question ${item.id}: ${item.question}</div>`;
        if (item.extraContent) html += item.extraContent;
        if (item.text) html += `<div style="margin-bottom:15px; font-size:1.1em;">${item.text}</div>`;
        
        html += `<div class="options-grid ${item.options[0].length > 20 ? 'full-width-options' : ''}">`;
        
        item.options.forEach((opt, index) => {
            html += `
                <label class="option-label" id="label-${item.id}-${index}">
                    <input type="radio" name="q${item.id}" value="${index}">
                    <span>${["A", "B", "C", "D"][index]}. ${opt}</span>
                </label>
            `;
        });
        
        html += `</div>
            <button type="button" class="btn-check" onclick="checkQuestion(${item.id})">Check Answer</button>
            <div class="feedback" id="feedback-${item.id}"></div>
        `;
        
        div.innerHTML = html;
        form.appendChild(div);
    }

    function renderClozeGroup(group) {
        const div = document.createElement('div');
        div.className = 'question-card';
        
        let html = `${group.text}`;
        
        group.questions.forEach(q => {
            html += `
                <div style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px;" id="q-block-${q.id}">
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid">
            `;
            q.options.forEach((opt, index) => {
                html += `
                    <label class="option-label" id="label-${q.id}-${index}">
                        <input type="radio" name="q${q.id}" value="${index}">
                        <span>${["A", "B", "C", "D"][index]}. ${opt}</span>
                    </label>
                `;
            });
            html += `</div>
                <div class="feedback" id="feedback-${q.id}"></div>
            </div>`;
        });

        // Add a "Check Group" button is tricky logically, so we append Check buttons per sub-question or rely on the main "Submit All".
        // But the prompt asks for "Check" functionality. I will modify the loop to add check buttons individually or just rely on Submit All for groups? 
        // Prompt says: "Người dùng chọn đáp án -> Bấm 'Check'". Let's add Check button for each sub-question for best interactivity.
        
        // RE-WRITING loop to inject buttons
        div.innerHTML = group.text; // Text first
        
        group.questions.forEach(q => {
            const qDiv = document.createElement('div');
            qDiv.style.marginTop = "20px";
            qDiv.style.borderTop = "1px dashed #ccc";
            qDiv.style.paddingTop = "15px";
            qDiv.id = `q-card-${q.id}`; // Reuse ID naming convention for logic
            
            let qHtml = `<div class="question-text">${q.question}</div><div class="options-grid">`;
            q.options.forEach((opt, index) => {
                qHtml += `
                    <label class="option-label" id="label-${q.id}-${index}">
                        <input type="radio" name="q${q.id}" value="${index}">
                        <span>${["A", "B", "C", "D"][index]}. ${opt}</span>
                    </label>
                `;
            });
            qHtml += `</div>
                <button type="button" class="btn-check" onclick="checkQuestion(${q.id})">Check</button>
                <div class="feedback" id="feedback-${q.id}"></div>
            `;
            qDiv.innerHTML = qHtml;
            div.appendChild(qDiv);
        });

        form.appendChild(div);
    }

    // LOGIC FUNCTIONS
    
    // Flatten data for easier searching
    let allQuestions = [];
    quizData.forEach(item => {
        if (item.type === 'normal') allQuestions.push(item);
        else if (item.questions) allQuestions = allQuestions.concat(item.questions);
    });

    function getQuestionById(id) {
        return allQuestions.find(q => q.id === id);
    }

    function checkQuestion(id) {
        const q = getQuestionById(id);
        const selected = document.querySelector(`input[name="q${id}"]:checked`);
        const feedback = document.getElementById(`feedback-${id}`);
        
        if (!selected) {
            alert("Vui lòng chọn một đáp án!");
            return;
        }

        const val = parseInt(selected.value);
        const labels = document.querySelectorAll(`#q-card-${id} .option-label`); // Note: Selector might need tweak for cloze
        // Fix selector for cloze groups which don't have q-card-id on the parent properly sometimes?
        // Actually I set id="q-card-${q.id}" in the loop above, so it works.

        // Reset styles
        document.querySelectorAll(`input[name="q${id}"]`).forEach(input => {
            const label = document.getElementById(`label-${id}-${input.value}`);
            label.classList.remove('highlight-correct', 'highlight-wrong');
        });

        feedback.style.display = 'block';
        
        if (val === q.correct) {
            feedback.className = 'feedback correct';
            feedback.innerHTML = `<strong>Correct! (Chính xác)</strong><hr>${q.explanation}`;
            document.getElementById(`label-${id}-${val}`).classList.add('highlight-correct');
        } else {
            feedback.className = 'feedback incorrect';
            feedback.innerHTML = `<strong>Incorrect! (Sai rồi)</strong><br>Đáp án đúng là: <strong>${["A", "B", "C", "D"][q.correct]}</strong>.<hr>${q.explanation}`;
            document.getElementById(`label-${id}-${val}`).classList.add('highlight-wrong');
            document.getElementById(`label-${id}-${q.correct}`).classList.add('highlight-correct');
        }
    }

    function submitAll() {
        let score = 0;
        let total = allQuestions.length;
        let unanswered = 0;

        allQuestions.forEach(q => {
            const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
            const feedback = document.getElementById(`feedback-${q.id}`);
            
            // Show explanation for all
            feedback.style.display = 'block';
            
            if (selected) {
                const val = parseInt(selected.value);
                if (val === q.correct) {
                    score++;
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = `<strong>Correct!</strong><hr>${q.explanation}`;
                    document.getElementById(`label-${q.id}-${val}`).classList.add('highlight-correct');
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `<strong>Incorrect!</strong> Đáp án đúng: ${["A", "B", "C", "D"][q.correct]}.<hr>${q.explanation}`;
                    document.getElementById(`label-${q.id}-${val}`).classList.add('highlight-wrong');
                    document.getElementById(`label-${q.id}-${q.correct}`).classList.add('highlight-correct');
                }
            } else {
                unanswered++;
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `<strong>Chưa làm!</strong> Đáp án đúng: ${["A", "B", "C", "D"][q.correct]}.<hr>${q.explanation}`;
                document.getElementById(`label-${q.id}-${q.correct}`).classList.add('highlight-correct');
            }
        });

        // Show Modal
        document.getElementById('scoreDisplay').innerText = `${score}/${total}`;
        const msg = document.getElementById('scoreMessage');
        if (score === total) msg.innerText = "Tuyệt vời! Bạn là thiên tài!";
        else if (score >= total * 0.8) msg.innerText = "Làm rất tốt!";
        else if (score >= total * 0.5) msg.innerText = "Khá tốt, hãy cố gắng thêm!";
        else msg.innerText = "Cần ôn tập thêm nhé!";

        document.getElementById('resultModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
        // Scroll to top or first error could be added here
    }

    // Initialize
    renderQuiz();

</script>

</body>
</html>