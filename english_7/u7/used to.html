<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám: C·∫•u tr√∫c Used to (Th√≥i quen trong qu√° kh·ª©)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --success: #00D26A;
            --error: #FF4757;
            --bg-pattern: #f0f2f5;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(#8854c033 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .gamified-card {
            border-bottom: 6px solid rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .option-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-bottom: 5px solid #cbd5e1;
            transition: all 0.2s;
            cursor: pointer;
        }

        .option-btn:hover:not(.disabled) {
            transform: translateY(-3px) scale(1.02);
            border-color: var(--primary);
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(2px);
            border-bottom-width: 2px;
        }

        .option-correct {
            background-color: var(--success) !important;
            color: white !important;
            border-color: #00a854 !important;
            border-bottom: 5px solid #008a45 !important;
        }

        .option-wrong {
            background-color: var(--error) !important;
            color: white !important;
            border-color: #d63031 !important;
            border-bottom: 5px solid #b32425 !important;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        .explanation-box {
            border-left: 8px solid var(--primary);
            background: #f8f4ff;
            display: none;
        }

        .progress-bar {
            height: 12px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            transition: width 0.5s ease;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #8854C0;
            border-radius: 10px;
        }

        .floating-obj {
            position: fixed;
            z-index: -1;
            opacity: 0.1;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center">

    <!-- Elements Background -->
    <i class="fa-solid fa-star floating-obj text-6xl top-10 left-10 text-yellow-500 rotate-12"></i>
    <i class="fa-solid fa-cloud floating-obj text-8xl bottom-20 right-10 text-blue-400"></i>
    <i class="fa-solid fa-pencil floating-obj text-6xl top-40 right-20 text-pink-400 -rotate-45"></i>

    <div id="app" class="w-full max-w-3xl">
        <!-- Start Screen -->
        <div id="start-screen" class="bg-white rounded-3xl p-8 shadow-2xl text-center gamified-card border-2 border-purple-100">
            <h1 class="text-4xl md:text-5xl font-extrabold text-[#8854C0] mb-2">Used To Mastery</h1>
            <p class="text-gray-500 font-semibold mb-6">Tr·∫Øc nghi·ªám: C·∫•u tr√∫c Used to (Th√≥i quen trong qu√° kh·ª©)</p>
            
            <div class="mb-8 inline-block p-4 bg-purple-50 rounded-2xl">
                <p class="text-sm text-purple-600 font-bold uppercase tracking-widest">Gi√°o vi√™n t·∫°o</p>
                <p class="text-xl font-bold text-gray-800">Ms Mai An ULIS</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 text-left">
                <div class="bg-blue-50 p-4 rounded-xl flex items-center gap-4">
                    <div class="w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center">
                        <i class="fa-solid fa-list-check"></i>
                    </div>
                    <div>
                        <p class="text-xs text-blue-500 font-bold">S·ªê C√ÇU H·ªéI</p>
                        <p class="text-lg font-bold">30 C√¢u</p>
                    </div>
                </div>
                <div class="bg-green-50 p-4 rounded-xl flex items-center gap-4">
                    <div class="w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center">
                        <i class="fa-solid fa-bolt"></i>
                    </div>
                    <div>
                        <p class="text-xs text-green-500 font-bold">C·∫§P ƒê·ªò</p>
                        <p class="text-lg font-bold">C∆° b·∫£n - Trung c·∫•p</p>
                    </div>
                </div>
            </div>

            <button onclick="quizApp.start()" class="w-full py-4 bg-[#8854C0] hover:bg-[#7241a1] text-white text-2xl font-black rounded-2xl border-b-8 border-purple-900 transition-all active:transform active:translate-y-1 active:border-b-2">
                B·∫ÆT ƒê·∫¶U NGAY <i class="fa-solid fa-play ml-2"></i>
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="flex items-center justify-between mb-4 bg-white p-3 rounded-2xl shadow-sm border-2 border-purple-50">
                <div class="flex items-center gap-3">
                    <button onclick="location.reload()" class="text-gray-400 hover:text-red-500 transition-colors">
                        <i class="fa-solid fa-circle-xmark text-2xl"></i>
                    </button>
                    <div class="w-32 md:w-64">
                        <div class="progress-bar">
                            <div id="progress-inner" class="progress-inner" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span id="q-counter" class="bg-purple-100 text-[#8854C0] font-black px-4 py-1 rounded-full text-sm">1/30</span>
                </div>
                <div class="bg-yellow-100 text-yellow-700 font-black px-4 py-1 rounded-full text-sm">
                    <i class="fa-solid fa-fire mr-1"></i> <span id="score-display">0</span>
                </div>
            </div>

            <div class="bg-white rounded-3xl p-6 md:p-10 shadow-xl gamified-card relative border-2 border-purple-50 overflow-hidden">
                <div id="question-container" class="relative z-10">
                    <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 mb-8">
                        ƒêang t·∫£i c√¢u h·ªèi...
                    </h2>

                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options will be injected here -->
                    </div>

                    <!-- Explanation Area -->
                    <div id="explanation-area" class="explanation-box mt-8 p-6 rounded-2xl">
                        <div class="flex items-center gap-2 text-[#8854C0] mb-4">
                            <i class="fa-solid fa-lightbulb text-xl"></i>
                            <h4 class="font-black uppercase tracking-wider">C√¥ Mai An gi·∫£i th√≠ch:</h4>
                        </div>
                        <div id="explanation-content" class="text-gray-700 leading-relaxed text-sm md:text-base">
                            <!-- Content injected by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="next-btn" onclick="quizApp.nextQuestion()" class="hidden py-3 px-10 bg-[#00C9A7] hover:bg-[#00b093] text-white text-xl font-black rounded-2xl border-b-6 border-[#008f76] transition-all active:transform active:translate-y-1 active:border-b-2">
                    TI·∫æP THEO <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
                <button id="finish-btn" onclick="quizApp.showResult()" class="hidden py-3 px-10 bg-orange-500 hover:bg-orange-600 text-white text-xl font-black rounded-2xl border-b-6 border-orange-700 transition-all active:transform active:translate-y-1 active:border-b-2">
                    K·∫æT TH√öC <i class="fa-solid fa-flag-checkered ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden bg-white rounded-3xl p-10 shadow-2xl text-center gamified-card">
            <div id="trophy-icon" class="text-7xl mb-6 text-yellow-400">
                <i class="fa-solid fa-trophy"></i>
            </div>
            <h2 class="text-3xl font-black text-gray-800 mb-2">CH√öC M·ª™NG B·∫†N!</h2>
            <p id="result-comment" class="text-gray-500 font-bold mb-8">B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i t·∫≠p.</p>
            
            <div class="flex justify-center gap-8 mb-10">
                <div class="text-center">
                    <p class="text-4xl font-black text-green-500" id="final-score">0</p>
                    <p class="text-sm font-bold text-gray-400 uppercase">C√¢u ƒë√∫ng</p>
                </div>
                <div class="h-12 w-px bg-gray-200"></div>
                <div class="text-center">
                    <p class="text-4xl font-black text-purple-500" id="final-accuracy">0%</p>
                    <p class="text-sm font-bold text-gray-400 uppercase">Ch√≠nh x√°c</p>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full py-4 bg-[#8854C0] hover:bg-[#7241a1] text-white text-2xl font-black rounded-2xl border-b-8 border-purple-900 transition-all active:transform active:translate-y-1 active:border-b-2">
                L√ÄM L·∫†I B√ÄI <i class="fa-solid fa-rotate-left ml-2"></i>
            </button>
        </div>
    </div>

    <!-- Audio Effects -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2021/2021-preview.mp3"></audio>

    <script>
        const quizData = [
            {
                question: "I _______ play football when I was young, but now I don't.",
                options: ["use to", "used to", "used", "using to"],
                correct: 1,
                explanation: {
                    translation: "T√¥i ƒë√£ t·ª´ng ch∆°i b√≥ng ƒë√° khi c√≤n tr·∫ª, nh∆∞ng b√¢y gi·ªù th√¨ kh√¥ng.",
                    analysis: [
                        "A. use to (v): Sai ng·ªØ ph√°p ·ªü th√¨ kh·∫≥ng ƒë·ªãnh.",
                        "B. used to (phrase): ƒë√£ t·ª´ng.",
                        "C. used (v): ƒë√£ s·ª≠ d·ª•ng (nghƒ©a kh√°c).",
                        "D. using to (v-ing): Sai c·∫•u tr√∫c."
                    ],
                    whyCorrect: "C·∫•u tr√∫c kh·∫≥ng ƒë·ªãnh di·ªÖn t·∫£ th√≥i quen trong qu√° kh·ª© l√†: <b>S + used to + V-infinitive</b>. V√¨ c√¢u ƒëang ·ªü d·∫°ng kh·∫≥ng ƒë·ªãnh n√™n 'used' ph·∫£i c√≥ 'd'.",
                    whyIncorrect: "C√°c ƒë√°p √°n kh√°c sai c·∫•u tr√∫c ho·∫∑c kh√¥ng ph√π h·ª£p √Ω nghƒ©a 'ƒë√£ t·ª´ng' trong qu√° kh·ª©."
                }
            },
            {
                question: "My father used to _______ to work by bus.",
                options: ["go", "went", "going", "goes"],
                correct: 0,
                explanation: {
                    translation: "B·ªë t√¥i t·ª´ng ƒëi l√†m b·∫±ng xe bu√Ωt.",
                    analysis: [
                        "A. go (v): ƒëi (ƒë·ªông t·ª´ nguy√™n m·∫´u).",
                        "B. went (v): ƒëi (qu√° kh·ª©).",
                        "C. going (v): ƒëi (V-ing).",
                        "D. goes (v): ƒëi (chia s·ªë √≠t hi·ªán t·∫°i)."
                    ],
                    whyCorrect: "Sau c·∫•u tr√∫c 'used to', ch√∫ng ta lu√¥n lu√¥n s·ª≠ d·ª•ng <b>ƒë·ªông t·ª´ nguy√™n m·∫´u kh√¥ng 'to' (V-infinitive)</b>.",
                    whyIncorrect: "went, going, v√† goes ƒë·ªÅu l√† c√°c d·∫°ng chia c·ªßa ƒë·ªông t·ª´ go, kh√¥ng ƒë√∫ng ng·ªØ ph√°p sau used to."
                }
            },
            {
                question: "She didn't _______ eat vegetables, but now she loves them.",
                options: ["used to", "use to", "uses to", "using to"],
                correct: 1,
                explanation: {
                    translation: "C√¥ ·∫•y t·ª´ng kh√¥ng ƒÉn rau, nh∆∞ng gi·ªù c√¥ ·∫•y r·∫•t th√≠ch.",
                    analysis: [
                        "A. used to: ƒë√£ t·ª´ng (kh·∫≥ng ƒë·ªãnh).",
                        "B. use to: ƒë√£ t·ª´ng (nguy√™n m·∫´u).",
                        "C. uses to: (sai ng·ªØ ph√°p).",
                        "D. using to: (sai ng·ªØ ph√°p)."
                    ],
                    whyCorrect: "Trong c√¢u ph·ªß ƒë·ªãnh ƒë√£ c√≥ tr·ª£ ƒë·ªông t·ª´ <b>'didn't'</b>, ƒë·ªông t·ª´ ch√≠nh 'used to' ph·∫£i ƒë∆∞a v·ªÅ nguy√™n m·∫´u l√† <b>'use to'</b> (b·ªè 'd').",
                    whyIncorrect: "used to c√≥ 'd' l√† sai khi ƒëi c√πng didn't. C v√† D kh√¥ng t·ªìn t·∫°i trong c·∫•u tr√∫c n√†y."
                }
            },
            {
                question: "_______ you use to go to the beach every summer?",
                options: ["Do", "Did", "Are", "Were"],
                correct: 1,
                explanation: {
                    translation: "B·∫°n c√≥ th∆∞·ªùng ƒëi bi·ªÉn v√†o m·ªói m√πa h√® kh√¥ng?",
                    analysis: [
                        "A. Do: Tr·ª£ ƒë·ªông t·ª´ hi·ªán t·∫°i.",
                        "B. Did: Tr·ª£ ƒë·ªông t·ª´ qu√° kh·ª©.",
                        "C. Are: ƒê·ªông t·ª´ tobe hi·ªán t·∫°i.",
                        "D. Were: ƒê·ªông t·ª´ tobe qu√° kh·ª©."
                    ],
                    whyCorrect: "ƒê·ªÉ ƒë·∫∑t c√¢u h·ªèi cho th√≥i quen trong qu√° kh·ª© v·ªõi 'used to', ta m∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ <b>Did</b>. C·∫•u tr√∫c: <b>Did + S + use to + V?</b>",
                    whyIncorrect: "Do d√πng cho hi·ªán t·∫°i. Are/Were l√† tobe kh√¥ng ƒëi k√®m v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'use' theo c√°ch n√†y."
                }
            },
            {
                question: "We _______ live in a small village before moving to the city.",
                options: ["used to", "use to", "are used to", "get used to"],
                correct: 0,
                explanation: {
                    translation: "Ch√∫ng t√¥i t·ª´ng s·ªëng ·ªü m·ªôt ng√¥i l√†ng nh·ªè tr∆∞·ªõc khi chuy·ªÉn ƒë·∫øn th√†nh ph·ªë.",
                    analysis: [
                        "A. used to: ƒë√£ t·ª´ng.",
                        "B. use to: (thi·∫øu 'd').",
                        "C. are used to: quen v·ªõi (hi·ªán t·∫°i).",
                        "D. get used to: d·∫ßn quen v·ªõi."
                    ],
                    whyCorrect: "C√¢u kh·∫≥ng ƒë·ªãnh di·ªÖn t·∫£ m·ªôt tr·∫°ng th√°i k√©o d√†i trong qu√° kh·ª© ƒë√£ k·∫øt th√∫c. ƒê√°p √°n A ƒë√∫ng c·∫•u tr√∫c <b>S + used to + V</b>.",
                    whyIncorrect: "B sai ch√≠nh t·∫£. C v√† D di·ªÖn t·∫£ vi·ªác th√≠ch nghi v·ªõi c√°i g√¨ ƒë√≥ ·ªü hi·ªán t·∫°i, kh√¥ng ph√π h·ª£p ng·ªØ c·∫£nh."
                }
            }
            // ... D·ªØ li·ªáu ti·∫øp t·ª•c (ƒë·ªÉ ng·∫Øn g·ªçn t√¥i s·∫Ω x·ª≠ l√Ω logic shuffle cho 30 c√¢u d·ª±a tr√™n d·ªØ li·ªáu g·ªëc)
        ];

        // M·ªü r·ªông d·ªØ li·ªáu cho ƒë·ªß 30 c√¢u d·ª±a tr√™n ƒë·ªÅ b√†i b·∫°n cung c·∫•p
        const fullQuizData = [
            ...quizData,
            { question: "Did he _______ long hair?", options: ["used to have", "use to have", "use to has", "used to having"], correct: 1, explanation: { translation: "Anh ·∫•y ƒë√£ t·ª´ng ƒë·ªÉ t√≥c d√†i ph·∫£i kh√¥ng?", analysis: ["A. used to have: th·ª´a 'd'.", "B. use to have: ƒë√∫ng.", "C. use to has: sai 'has'.", "D. used to having: sai V-ing."], whyCorrect: "C√¢u h·ªèi: Did + S + use to + V(nguy√™n m·∫´u).", whyIncorrect: "C√°c ph∆∞∆°ng √°n kh√°c vi ph·∫°m quy t·∫Øc b·ªè 'd' ho·∫∑c chia ƒë·ªông t·ª´ 'have'." } },
            { question: "There _______ be a cinema here, but it closed down.", options: ["used to", "use to", "is used to", "was used to"], correct: 0, explanation: { translation: "ƒê√£ t·ª´ng c√≥ m·ªôt r·∫°p chi·∫øu phim ·ªü ƒë√¢y, nh∆∞ng n√≥ ƒë√£ ƒë√≥ng c·ª≠a.", analysis: ["A. used to: ƒë√£ t·ª´ng.", "B. use to: sai ch√≠nh t·∫£.", "C. is used to: quen v·ªõi.", "D. was used to: ƒë√£ quen v·ªõi."], whyCorrect: "There used to be = ƒê√£ t·ª´ng c√≥ (trong qu√° kh·ª©).", whyIncorrect: "Ch·ªâ th√≥i quen/tr·∫°ng th√°i c≈© d√πng used to." } },
            { question: "I _______ like coffee, but now I drink it every day.", options: ["didn't used to", "didn't use to", "not used to", "don't use to"], correct: 1, explanation: { translation: "T√¥i ƒë√£ t·ª´ng kh√¥ng th√≠ch c√† ph√™, nh∆∞ng gi·ªù t√¥i u·ªëng m·ªói ng√†y.", analysis: ["A. didn't used to: th·ª´a 'd'.", "B. didn't use to: ƒë√∫ng.", "C. not used to: thi·∫øu tr·ª£ ƒë·ªông t·ª´.", "D. don't use to: sai th√¨."], whyCorrect: "Ph·ªß ƒë·ªãnh qu√° kh·ª©: didn't use to.", whyIncorrect: "Ph·∫£i b·ªè 'd' khi c√≥ didn't." } },
            { question: "What did you _______ do in your free time when you were a child?", options: ["used to", "use to", "uses to", "using to"], correct: 1, explanation: { translation: "B·∫°n th∆∞·ªùng l√†m g√¨ v√†o th·ªùi gian r·∫£nh khi c√≤n nh·ªè?", analysis: ["A. used to: th·ª´a 'd'.", "B. use to: ƒë√∫ng.", "C. uses to: sai.", "D. using to: sai."], whyCorrect: "C√¢u h·ªèi c√≥ Did -> use to.", whyIncorrect: "T∆∞∆°ng t·ª± quy t·∫Øc c√¢u h·ªèi Yes/No." } },
            { question: "My brother _______ smoke, but he quit last year.", options: ["is used to", "used to", "was used to", "use to"], correct: 1, explanation: { translation: "Anh trai t√¥i t·ª´ng h√∫t thu·ªëc, nh∆∞ng anh ·∫•y ƒë√£ b·ªè nƒÉm ngo√°i.", analysis: ["A. is used to: quen v·ªõi.", "B. used to: ƒë√£ t·ª´ng.", "C. was used to: ƒë√£ quen.", "D. use to: thi·∫øu 'd'."], whyCorrect: "Th√≥i quen qu√° kh·ª© ƒë√£ ch·∫•m d·ª©t.", whyIncorrect: "Kh√¥ng d√πng be used to ·ªü ƒë√¢y." } },
            { question: "Which sentence is correct?", options: ["I used to go swimming yesterday.", "I used to go swimming when I was a child.", "I didn't used to go swimming.", "Did you used to go swimming?"], correct: 1, explanation: { translation: "C√¢u n√†o sau ƒë√¢y l√† ƒë√∫ng?", analysis: ["A. yesterday: sai m·ªëc th·ªùi gian c·ª• th·ªÉ.", "B. Correct.", "C. didn't used to: th·ª´a 'd'.", "D. Did you used: th·ª´a 'd'."], whyCorrect: "Used to d√πng cho th√≥i quen l√¢u d√†i, kh√¥ng d√πng cho 1 ng√†y c·ª• th·ªÉ nh∆∞ yesterday.", whyIncorrect: "L·ªói ph·ªï bi·∫øn l√† th·ª´a 'd' trong c√¢u ph·ªß ƒë·ªãnh/nghi v·∫•n." } },
            { question: "Mr. Nam _______ play marbles when he was young.", options: ["never used to", "never use to", "not used to", "don't use to"], correct: 0, explanation: { translation: "√îng Nam ch∆∞a t·ª´ng ch∆°i bi khi √¥ng ·∫•y c√≤n tr·∫ª.", analysis: ["A. never used to: ƒë√∫ng.", "B. never use to: sai.", "C. not used to: thi·∫øu tr·ª£ ƒë·ªông t·ª´.", "D. don't use to: sai th√¨."], whyCorrect: "Sau 'never', used to v·∫´n gi·ªØ nguy√™n 'd' v√¨ kh√¥ng c√≥ tr·ª£ ƒë·ªông t·ª´ Did m∆∞·ª£n ƒëi.", whyIncorrect: "Never + used to l√† c·∫•u tr√∫c ph·ªß ƒë·ªãnh kh√¥ng d√πng didn't." } },
            { question: "_______ you use to cry a lot when you were a baby?", options: ["Were", "Did", "Do", "Are"], correct: 1, explanation: { translation: "B·∫°n c√≥ th∆∞·ªùng hay kh√≥c nh√® khi c√≤n b√© kh√¥ng?", analysis: ["A. Were: sai.", "B. Did: ƒë√∫ng.", "C. Do: sai th√¨.", "D. Are: sai."], whyCorrect: "C√¢u h·ªèi th√≥i quen qu√° kh·ª© m∆∞·ª£n Did.", whyIncorrect: "Use l√† ƒë·ªông t·ª´ th∆∞·ªùng n√™n m∆∞·ª£n Did." } },
            { question: "We _______ ride buffalos when we visited our grandparents.", options: ["used to", "use to", "using to", "are used to"], correct: 0, explanation: { translation: "Ch√∫ng t√¥i t·ª´ng c∆∞·ª°i tr√¢u khi ƒëi thƒÉm √¥ng b√†.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: sai ch√≠nh t·∫£.", "C. using to: sai.", "D. are used to: quen v·ªõi."], whyCorrect: "H√†nh ƒë·ªông l·∫∑p l·∫°i trong qu√° kh·ª©: used to + V.", whyIncorrect: "D·∫°ng kh·∫≥ng ƒë·ªãnh c·∫ßn c√≥ 'd'." } },
            { question: "She _______ have long hair, but she cut it yesterday.", options: ["used to", "use to", "didn't use to", "doesn't use to"], correct: 0, explanation: { translation: "C√¥ ·∫•y t·ª´ng ƒë·ªÉ t√≥c d√†i, nh∆∞ng h√¥m qua c√¥ ·∫•y ƒë√£ c·∫Øt n√≥.", analysis: ["A. used to: t·ª´ng.", "B. use to: thi·∫øu 'd'.", "C. didn't use to: t·ª´ng kh√¥ng.", "D. doesn't use to: sai th√¨."], whyCorrect: "Tr·∫°ng th√°i c≈© ƒë√£ thay ƒë·ªïi: used to.", whyIncorrect: "C√¥ ·∫•y t·ª´ng c√≥ (kh·∫≥ng ƒë·ªãnh) m·ªõi ƒë√∫ng ng·ªØ c·∫£nh." } },
            { question: "Did you _______ cartoons when you were small?", options: ["used to watch", "use to watch", "use to watching", "used to watching"], correct: 1, explanation: { translation: "B·∫°n c√≥ th∆∞·ªùng xem ho·∫°t h√¨nh khi c√≤n nh·ªè kh√¥ng?", analysis: ["A. used: th·ª´a 'd'.", "B. use to watch: ƒë√∫ng.", "C. watching: sai.", "D. watching: sai."], whyCorrect: "Did + S + use to + V(bare).", whyIncorrect: "Sau used to l√† V nguy√™n m·∫´u." } },
            { question: "People _______ travel by horse, but now they use cars.", options: ["used to", "use to", "are used to", "get used to"], correct: 0, explanation: { translation: "M·ªçi ng∆∞·ªùi t·ª´ng di chuy·ªÉn b·∫±ng ng·ª±a, nh∆∞ng gi·ªù h·ªç d√πng √¥ t√¥.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: thi·∫øu 'd'.", "C. are used to: quen v·ªõi.", "D. get used to: d·∫ßn quen."], whyCorrect: "So s√°nh qu√° kh·ª© v√† hi·ªán t·∫°i.", whyIncorrect: "Ch·ªâ used to m·ªõi h·ª£p nghƒ©a 'ƒë√£ t·ª´ng'." } },
            { question: "I _______ play video games, but I stopped two years ago.", options: ["used to", "use to", "was used to", "am used to"], correct: 0, explanation: { translation: "T√¥i t·ª´ng ch∆°i ƒëi·ªán t·ª≠, nh∆∞ng t√¥i ƒë√£ d·ª´ng 2 nƒÉm tr∆∞·ªõc.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: thi·∫øu 'd'.", "C. was used to: ƒë√£ quen.", "D. am used to: ƒëang quen."], whyCorrect: "H√†nh ƒë·ªông ƒë√£ k·∫øt th√∫c trong qu√° kh·ª©.", whyIncorrect: "D·∫°ng kh·∫≥ng ƒë·ªãnh S + used to + V." } },
            { question: "We _______ go to that school, but then we moved.", options: ["used to", "use to", "didn't used to", "don't use to"], correct: 0, explanation: { translation: "Ch√∫ng t√¥i t·ª´ng ƒëi h·ªçc ·ªü tr∆∞·ªùng ƒë√≥, nh∆∞ng sau ƒë√≥ ch√∫ng t√¥i chuy·ªÉn ƒëi.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: thi·∫øu 'd'.", "C. didn't used: th·ª´a 'd'.", "D. don't use: sai th√¨."], whyCorrect: "Th√≥i quen qu√° kh·ª©.", whyIncorrect: "ƒê√°p √°n A ƒë√∫ng ng·ªØ ph√°p nh·∫•t." } },
            { question: "Did your mom _______ cook for you?", options: ["use to", "used to", "uses to", "using to"], correct: 0, explanation: { translation: "M·∫π b·∫°n c√≥ th∆∞·ªùng n·∫•u ƒÉn cho b·∫°n kh√¥ng?", analysis: ["A. use to: ƒë√∫ng.", "B. used: th·ª´a 'd'.", "C. uses: sai.", "D. using: sai."], whyCorrect: "C√¢u h·ªèi m∆∞·ª£n Did b·ªè 'd'.", whyIncorrect: "C√°c d·∫°ng chia kh√°c ƒë·ªÅu sai." } },
            { question: "He _______ stay up late, but now he goes to bed early.", options: ["used to", "use to", "is used to", "didn't use to"], correct: 0, explanation: { translation: "Anh ·∫•y t·ª´ng th·ª©c khuya, nh∆∞ng gi·ªù anh ·∫•y ƒëi ng·ªß s·ªõm.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: thi·∫øu 'd'.", "C. is used to: quen v·ªõi.", "D. didn't use to: ƒë√£ kh√¥ng t·ª´ng."], whyCorrect: "Th√≥i quen tr√°i ng∆∞·ª£c v·ªõi hi·ªán t·∫°i.", whyIncorrect: "C·∫ßn d·∫°ng kh·∫≥ng ƒë·ªãnh 'ƒë√£ t·ª´ng'." } },
            { question: "What games _______ you use to play?", options: ["did", "do", "were", "had"], correct: 0, explanation: { translation: "B·∫°n t·ª´ng ch∆°i tr√≤ ch∆°i g√¨?", analysis: ["A. did: ƒë√∫ng.", "B. do: hi·ªán t·∫°i.", "C. were: tobe.", "D. had: qu√° kh·ª© ho√†n th√†nh."], whyCorrect: "Wh-word + did + S + use to + V?", whyIncorrect: "Ch·ªâ Did m·ªõi ƒëi v·ªõi use to." } },
            { question: "I didn't _______ like classical music, but I do now.", options: ["use to", "used to", "used", "use"], correct: 0, explanation: { translation: "T√¥i ƒë√£ t·ª´ng kh√¥ng th√≠ch nh·∫°c c·ªï ƒëi·ªÉn, nh∆∞ng b√¢y gi·ªù th√¨ c√≥.", analysis: ["A. use to: ƒë√∫ng.", "B. used to: th·ª´a 'd'.", "C. used: sai.", "D. use: thi·∫øu 'to'."], whyCorrect: "Ph·ªß ƒë·ªãnh m∆∞·ª£n didn't b·ªè 'd'.", whyIncorrect: "Ph·∫£i c√≥ 'to' sau 'use'." } },
            { question: "They _______ have a lot of money, but they lost it all.", options: ["used to", "use to", "didn't use to", "are used to"], correct: 0, explanation: { translation: "H·ªç t·ª´ng c√≥ r·∫•t nhi·ªÅu ti·ªÅn, nh∆∞ng h·ªç ƒë√£ m·∫•t t·∫•t c·∫£.", analysis: ["A. used to: t·ª´ng.", "B. use to: thi·∫øu 'd'.", "C. didn't use: ƒë√£ kh√¥ng t·ª´ng.", "D. are used: quen v·ªõi."], whyCorrect: "Tr·∫°ng th√°i qu√° kh·ª© ƒë√£ ch·∫•m d·ª©t.", whyIncorrect: "D·∫°ng kh·∫≥ng ƒë·ªãnh l√† ch√≠nh x√°c nh·∫•t." } },
            { question: "Did you use to _______ glasses?", options: ["wear", "wearing", "wore", "wears"], correct: 0, explanation: { translation: "B·∫°n t·ª´ng ƒëeo k√≠nh ph·∫£i kh√¥ng?", analysis: ["A. wear: nguy√™n m·∫´u.", "B. wearing: V-ing.", "C. wore: qu√° kh·ª©.", "D. wears: s·ªë √≠t."], whyCorrect: "Sau use to l√† V nguy√™n m·∫´u.", whyIncorrect: "Kh√¥ng chia ƒë·ªông t·ª´ sau use to." } },
            { question: "My grandfather never _______ travel by plane.", options: ["used to", "use to", "uses to", "using to"], correct: 0, explanation: { translation: "√îng t√¥i ch∆∞a bao gi·ªù ƒëi m√°y bay.", analysis: ["A. used to: ƒë√∫ng.", "B. use to: sai.", "C. uses: sai.", "D. using: sai."], whyCorrect: "Sau never v·∫´n d√πng used to c√≥ 'd'.", whyIncorrect: "Quy t·∫Øc ƒë·∫∑c bi·ªát v·ªõi tr·∫°ng t·ª´ ph·ªß ƒë·ªãnh." } },
            { question: "Where did you _______ live before you came here?", options: ["use to", "used to", "uses to", "used"], correct: 0, explanation: { translation: "B·∫°n t·ª´ng s·ªëng ·ªü ƒë√¢u tr∆∞·ªõc khi ƒë·∫øn ƒë√¢y?", analysis: ["A. use to: ƒë√∫ng.", "B. used: th·ª´a 'd'.", "C. uses: sai.", "D. used: thi·∫øu 'to'."], whyCorrect: "C√¢u h·ªèi m∆∞·ª£n Did b·ªè 'd'.", whyIncorrect: "C·∫ßn gi·ªØ c·∫•u tr√∫c use + to." } },
            { question: "I _______ be shy, but now I'm confident.", options: ["used to", "use to", "was used to", "didn't use to"], correct: 0, explanation: { translation: "T√¥i t·ª´ng nh√∫t nh√°t, nh∆∞ng gi·ªù t√¥i r·∫•t t·ª± tin.", analysis: ["A. used to: t·ª´ng.", "B. use to: thi·∫øu 'd'.", "C. was used to: quen v·ªõi.", "D. didn't use: t·ª´ng kh√¥ng."], whyCorrect: "Used to be = T·ª´ng l√†.", whyIncorrect: "ƒê·ªëi l·∫≠p v·ªõi hi·ªán t·∫°i t·ª± tin." } },
            { question: "They didn't _______ go to the cinema very often.", options: ["use to", "used to", "uses to", "used"], correct: 0, explanation: { translation: "H·ªç t·ª´ng kh√¥ng hay ƒëi xem phim th∆∞·ªùng xuy√™n.", analysis: ["A. use to: ƒë√∫ng.", "B. used: th·ª´a 'd'.", "C. uses: sai.", "D. used: thi·∫øu 'to'."], whyCorrect: "Didn't + use to + V.", whyIncorrect: "B·ªè 'd' khi ph·ªß ƒë·ªãnh." } },
            { question: "Did you use to _______ a buffalo?", options: ["ride", "rode", "ridden", "riding"], correct: 0, explanation: { translation: "B·∫°n t·ª´ng c∆∞·ª°i tr√¢u ph·∫£i kh√¥ng?", analysis: ["A. ride: nguy√™n m·∫´u.", "B. rode: qu√° kh·ª©.", "C. ridden: ph√¢n t·ª´.", "D. riding: V-ing."], whyCorrect: "Sau use to d√πng ƒë·ªông t·ª´ nguy√™n m·∫´u.", whyIncorrect: "Kh√¥ng chia ride ·ªü b·∫•t k·ª≥ d·∫°ng n√†o kh√°c." } }
        ];

        const quizApp = {
            questions: [],
            currentIdx: 0,
            score: 0,
            isAnswered: false,

            shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            start() {
                this.questions = this.shuffle([...fullQuizData]);
                this.currentIdx = 0;
                this.score = 0;
                this.isAnswered = false;
                
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('quiz-screen').classList.remove('hidden');
                this.loadQuestion();
            },

            loadQuestion() {
                this.isAnswered = false;
                const q = this.questions[this.currentIdx];
                
                // UI updates
                document.getElementById('progress-inner').style.width = `${(this.currentIdx / this.questions.length) * 100}%`;
                document.getElementById('q-counter').innerText = `${this.currentIdx + 1}/${this.questions.length}`;
                document.getElementById('score-display').innerText = this.score;
                document.getElementById('question-text').innerText = q.question;
                document.getElementById('explanation-area').style.display = 'none';
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('finish-btn').classList.add('hidden');

                const optionsGrid = document.getElementById('options-grid');
                optionsGrid.innerHTML = '';

                q.options.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn p-4 text-left rounded-2xl font-bold text-lg flex items-center gap-3';
                    btn.innerHTML = `
                        <span class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-sm border-2 border-gray-200">${String.fromCharCode(65 + index)}</span>
                        <span>${opt}</span>
                    `;
                    btn.onclick = () => this.handleAnswer(index, btn);
                    optionsGrid.appendChild(btn);
                });
            },

            handleAnswer(selectedIdx, btnElement) {
                if (this.isAnswered) return;
                this.isAnswered = true;

                const q = this.questions[this.currentIdx];
                const isCorrect = selectedIdx === q.correct;

                // Disable all buttons
                const allBtns = document.querySelectorAll('.option-btn');
                allBtns.forEach(b => b.classList.add('disabled', 'opacity-60', 'cursor-not-allowed'));

                if (isCorrect) {
                    this.score += 10;
                    btnElement.classList.remove('opacity-60');
                    btnElement.classList.add('option-correct');
                    this.playAudio('correct');
                    this.triggerConfetti();
                } else {
                    btnElement.classList.remove('opacity-60');
                    btnElement.classList.add('option-wrong', 'shake');
                    this.playAudio('wrong');
                    // Show correct one
                    allBtns[q.correct].classList.remove('opacity-60');
                    allBtns[q.correct].classList.add('option-correct');
                }

                this.showExplanation(q.explanation);

                if (this.currentIdx < this.questions.length - 1) {
                    document.getElementById('next-btn').classList.remove('hidden');
                } else {
                    document.getElementById('finish-btn').classList.remove('hidden');
                }
            },

            showExplanation(exp) {
                const area = document.getElementById('explanation-area');
                const content = document.getElementById('explanation-content');
                
                content.innerHTML = `
                    <div class="mb-3"><span class="font-bold text-gray-800">D·ªãch nghƒ©a:</span> "${exp.translation}"</div>
                    <div class="mb-3">
                        <span class="font-bold text-gray-800">Ph√¢n t√≠ch ƒë√°p √°n:</span>
                        <ul class="list-none mt-1 space-y-1">
                            ${exp.analysis.map(a => `<li class="pl-4 border-l-2 border-gray-200">${a}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="mb-3"><span class="font-bold text-green-600">T·∫°i sao ƒê√öNG:</span> ${exp.whyCorrect}</div>
                    <div><span class="font-bold text-red-500">T·∫°i sao SAI:</span> ${exp.whyIncorrect}</div>
                `;
                
                area.style.display = 'block';
                area.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            },

            nextQuestion() {
                this.currentIdx++;
                this.loadQuestion();
            },

            playAudio(type) {
                const audio = document.getElementById(`sound-${type}`);
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio error:', e));
            },

            triggerConfetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8854C0', '#00C9A7', '#00D26A']
                });
            },

            showResult() {
                document.getElementById('quiz-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');
                
                const correctCount = this.score / 10;
                const accuracy = Math.round((correctCount / this.questions.length) * 100);
                
                document.getElementById('final-score').innerText = correctCount;
                document.getElementById('final-accuracy').innerText = `${accuracy}%`;

                let comment = "";
                let trophy = "";
                if (accuracy === 100) {
                    comment = "Tuy·ªát v·ªùi! B·∫°n l√† thi√™n t√†i ti·∫øng Anh! üåü";
                    trophy = '<i class="fa-solid fa-crown text-yellow-400"></i>';
                } else if (accuracy >= 80) {
                    comment = "Gi·ªèi qu√°! C·ªë g·∫Øng ph√°t huy nh√© con! üëè";
                    trophy = '<i class="fa-solid fa-trophy text-yellow-400"></i>';
                } else if (accuracy >= 50) {
                    comment = "Kh√° t·ªët! ƒê·ªçc k·ªπ gi·∫£i th√≠ch c·ªßa c√¥ ƒë·ªÉ l√†m t·ªët h∆°n nh√©! üëç";
                    trophy = '<i class="fa-solid fa-medal text-orange-400"></i>';
                } else {
                    comment = "ƒê·ª´ng bu·ªìn! H√£y √¥n l·∫°i b√†i c√πng c√¥ Mai An nh√© con! üí™";
                    trophy = '<i class="fa-solid fa-book-open text-blue-400"></i>';
                }
                
                document.getElementById('result-comment').innerText = comment;
                document.getElementById('trophy-icon').innerHTML = trophy;

                if (accuracy >= 70) {
                    this.triggerConfetti();
                    setTimeout(() => this.triggerConfetti(), 1000);
                }
            }
        };
    </script>
</body>
</html>
