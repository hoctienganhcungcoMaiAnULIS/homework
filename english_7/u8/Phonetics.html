<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ti·∫øng Anh 7: Pronunciation Challenge - Ms Mai An</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #F0F4F8;
            --main-pink: #FF9FF3;
            --main-purple: #8854C0;
            --main-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --text-color: #2C3A47;
            --card-shadow: 0 10px 25px rgba(136, 84, 192, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none; /* NgƒÉn b√¥i ƒëen ƒë·ªÉ tr·∫£i nghi·ªám gi·ªëng App */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e0f7fa;
            background-image: 
                radial-gradient(#00C9A7 15%, transparent 16%),
                radial-gradient(#8854C0 15%, transparent 16%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text-color);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            border: 4px solid #fff;
            position: relative;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--main-purple), #a29bfe);
            padding: 20px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 6px 0 #5f27cd;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-weight: 800;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 800;
            color: var(--main-purple);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 100;
            border: 2px solid var(--main-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Question Card */
        .question-card {
            background: white;
            border-radius: 20px;
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #eee;
            transition: all 0.3s ease;
        }

        .question-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--main-purple);
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .question-number {
            background: var(--main-teal);
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 0 #d1d1d1;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            border-color: var(--main-purple);
            color: var(--main-purple);
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #d1d1d1;
        }

        /* States */
        .option-btn.correct {
            background: var(--correct-green);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #009e4f;
            animation: pop 0.4s ease;
        }

        .option-btn.wrong {
            background: var(--wrong-red);
            color: white;
            border-color: #ff3344;
            box-shadow: 0 4px 0 #d63031;
            animation: shake 0.5s ease;
        }

        .option-btn.disabled {
            cursor: default;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Explanation Box */
        .explanation-box {
            display: none;
            margin-top: 20px;
            background: #fff0f6; /* H·ªìng r·∫•t nh·∫°t */
            border: 2px dashed var(--main-pink);
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .explanation-header {
            font-weight: 800;
            color: var(--main-purple);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-header i {
            font-size: 1.5rem;
        }

        .explanation-content {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .vocab-list {
            list-style: none;
            margin: 10px 0;
            background: white;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ffdde1;
        }

        .vocab-item {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding: 5px 0;
        }
        .vocab-item:last-child { border-bottom: none; }
        .vocab-word { font-weight: 700; color: var(--main-purple); }
        .vocab-mean { color: #555; font-style: italic; }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Underline style for Phonetics */
        u {
            text-decoration: none;
            border-bottom: 3px solid var(--main-purple);
            padding-bottom: 2px;
        }

        /* Submit Section */
        .submit-section {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px dashed #ddd;
        }

        .btn-submit {
            background: var(--main-purple);
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #5f27cd;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 0 #5f27cd;
        }
        
        .btn-submit:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #5f27cd;
        }

        /* Popup Result */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--main-teal);
        }

        .final-score {
            font-size: 4rem;
            font-weight: 900;
            color: var(--main-purple);
            margin: 20px 0;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <div class="score-board">
        <span>‚≠ê ƒêi·ªÉm:</span>
        <span id="current-score">0</span>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>English 7: Phonetics Master</h1>
            <p>Gi√°o vi√™n: Ms Mai An (ULIS)</p>
            <p style="margin-top: 10px; font-size: 0.9rem; background: rgba(255,255,255,0.2); display: inline-block; padding: 5px 15px; border-radius: 20px;">
                Ch·ªß ƒë·ªÅ: Nguy√™n √¢m ƒë√¥i /…™…ô/ v√† /e…ô/
            </p>
        </header>

        <div id="quiz-container">
            <!-- Questions will be injected here via JS -->
        </div>

        <div class="submit-section">
            <button class="btn-submit" onclick="showFinalResult()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
        </div>
    </div>

    <!-- Modal Result -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--main-teal)">K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
            <div class="final-score" id="final-score-display">0/15</div>
            <p id="final-feedback" style="font-size: 1.2rem; color: #555; margin-bottom: 20px;"></p>
            <button class="btn-submit" style="font-size: 1rem; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i</button>
        </div>
    </div>

<script>
    // DATA SOURCE
    const quizData = [
        {
            id: 1,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "c<u>are</u>", ipa: "/ke…ô(r)/", mean: "quan t√¢m/chƒÉm s√≥c (v)", type: "e…ô" },
                { id: "B", text: "b<u>are</u>", ipa: "/be…ô(r)/", mean: "tr·∫ßn tr·ª•i (adj)", type: "e…ô" },
                { id: "C", text: "<u>are</u>", ipa: "/…ëÀê(r)/", mean: "th√¨/l√†/·ªü (v)", type: "…ëÀê", correct: true },
                { id: "D", text: "sh<u>are</u>", ipa: "/ Ée…ô(r)/", mean: "chia s·∫ª (v)", type: "e…ô" }
            ],
            hint: "Ch√∫ √Ω √¢m 'are'. Ba t·ª´ c√≥ √¢m /e…ô/, m·ªôt t·ª´ c√≥ √¢m /…ëÀê/."
        },
        {
            id: 2,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "th<u>ei</u>r", ipa: "/√∞e…ô(r)/", mean: "c·ªßa h·ªç (det)", type: "e…ô" },
                { id: "B", text: "h<u>ei</u>r", ipa: "/e…ô(r)/", mean: "ng∆∞·ªùi th·ª´a k·∫ø (n)", type: "e…ô" },
                { id: "C", text: "th<u>e</u>re", ipa: "/√∞e…ô(r)/", mean: "·ªü ƒë√≥ (adv)", type: "e…ô" },
                { id: "D", text: "h<u>e</u>re", ipa: "/h…™…ô(r)/", mean: "·ªü ƒë√¢y (adv)", type: "…™…ô", correct: true }
            ],
            hint: "Ph√¢n bi·ªát gi·ªØa √¢m /e…ô/ (nh∆∞ air) v√† /…™…ô/ (nh∆∞ ear)."
        },
        {
            id: 3,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "ch<u>ee</u>r", ipa: "/t É…™…ô(r)/", mean: "c·ªï v≈©/vui v·∫ª (v/n)", type: "…™…ô", correct: true },
                { id: "B", text: "wh<u>ee</u>l", ipa: "/wiÀêl/", mean: "b√°nh xe (n)", type: "iÀê" },
                { id: "C", text: "k<u>ee</u>n", ipa: "/kiÀên/", mean: "th√≠ch th√∫/s·∫Øc s·∫£o (adj)", type: "iÀê" },
                { id: "D", text: "kn<u>ee</u>", ipa: "/niÀê/", mean: "ƒë·∫ßu g·ªëi (n)", type: "iÀê" }
            ],
            hint: "Ph√¢n bi·ªát √¢m /i:/ (y d√†i) v√† /…™…ô/."
        },
        {
            id: 4,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "h<u>ea</u>r", ipa: "/h…™…ô(r)/", mean: "nghe (v)", type: "…™…ô", correct: true },
                { id: "B", text: "s<u>ea</u>t", ipa: "/siÀêt/", mean: "ch·ªó ng·ªìi (n)", type: "iÀê" },
                { id: "C", text: "b<u>ea</u>ch", ipa: "/biÀêt É/", mean: "b√£i bi·ªÉn (n)", type: "iÀê" },
                { id: "D", text: "p<u>ea</u>ch", ipa: "/piÀêt É/", mean: "qu·∫£ ƒë√†o (n)", type: "iÀê" }
            ],
            hint: "Ph√¢n bi·ªát √¢m /i:/ v√† /…™…ô/."
        },
        {
            id: 5,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "p<u>ee</u>r", ipa: "/p…™…ô(r)/", mean: "nh√¨n chƒÉm ch√∫ (v) / b·∫°n ƒë·ªìng trang l·ª©a (n)", type: "…™…ô" },
                { id: "B", text: "y<u>ea</u>r", ipa: "/j…™…ô(r)/", mean: "nƒÉm (n)", type: "…™…ô" },
                { id: "C", text: "r<u>a</u>re", ipa: "/re…ô(r)/", mean: "hi·∫øm (adj)", type: "e…ô", correct: true },
                { id: "D", text: "s<u>ee</u>r", ipa: "/s…™…ô(r)/", mean: "nh√† ti√™n tri (n)", type: "…™…ô" }
            ],
            hint: "Ch√∫ √Ω s·ª± kh√°c bi·ªát gi·ªØa /…™…ô/ v√† /e…ô/."
        },
        {
            id: 6,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "b<u>ea</u>r", ipa: "/be…ô(r)/", mean: "con g·∫•u (n) / ch·ªãu ƒë·ª±ng (v)", type: "e…ô" },
                { id: "B", text: "w<u>ea</u>r", ipa: "/we…ô(r)/", mean: "m·∫∑c (v)", type: "e…ô" },
                { id: "C", text: "sw<u>ea</u>r", ipa: "/swe…ô(r)/", mean: "th·ªÅ (v)", type: "e…ô" },
                { id: "D", text: "f<u>ea</u>r", ipa: "/f…™…ô(r)/", mean: "n·ªói s·ª£ (n)", type: "…™…ô", correct: true }
            ],
            hint: "M·ªôt t·ª´ mang nghƒ©a 'n·ªói s·ª£ h√£i' c√≥ c√°ch ph√°t √¢m kh√°c."
        },
        {
            id: 7,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "h<u>ai</u>r", ipa: "/he…ô(r)/", mean: "t√≥c (n)", type: "e…ô" },
                { id: "B", text: "f<u>ai</u>r", ipa: "/fe…ô(r)/", mean: "c√¥ng b·∫±ng / h·ªôi ch·ª£ (adj/n)", type: "e…ô" },
                { id: "C", text: "ch<u>ai</u>n", ipa: "/t Ée…™n/", mean: "chu·ªói, x√≠ch (n)", type: "e…™", correct: true },
                { id: "D", text: "ch<u>ai</u>r", ipa: "/t Ée…ô(r)/", mean: "c√°i gh·∫ø (n)", type: "e…ô" }
            ],
            hint: "Ch√∫ √Ω nguy√™n √¢m: m·ªôt t·ª´ c√≥ √¢m /e…™/."
        },
        {
            id: 8,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "b<u>ee</u>", ipa: "/biÀê/", mean: "con ong (n)", type: "iÀê" },
                { id: "B", text: "b<u>ee</u>n", ipa: "/biÀên/", mean: "th√¨, l√† (V3 of be)", type: "iÀê" },
                { id: "C", text: "s<u>ee</u>n", ipa: "/siÀên/", mean: "nh√¨n th·∫•y (V3 of see)", type: "iÀê" },
                { id: "D", text: "d<u>ee</u>r", ipa: "/d…™…ô(r)/", mean: "con h∆∞∆°u (n)", type: "…™…ô", correct: true }
            ],
            hint: "Con h∆∞∆°u (deer) c√≥ ph√°t √¢m kh√°c c√°c t·ª´ c√≤n l·∫°i."
        },
        {
            id: 9,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "id<u>ea</u>", ipa: "/a…™Ààd…™…ô/", mean: "√Ω t∆∞·ªüng (n)", type: "…™…ô" },
                { id: "B", text: "p<u>ea</u>", ipa: "/piÀê/", mean: "h·∫°t ƒë·∫≠u (n)", type: "iÀê", correct: true },
                { id: "C", text: "n<u>ea</u>r", ipa: "/n…™…ô(r)/", mean: "g·∫ßn (adj)", type: "…™…ô" },
                { id: "D", text: "g<u>ea</u>r", ipa: "/g…™…ô(r)/", mean: "b√°nh rƒÉng / s·ªë xe (n)", type: "…™…ô" }
            ],
            hint: "T√¨m t·ª´ c√≥ √¢m /i:/ trong nh√≥m /…™…ô/."
        },
        {
            id: 10,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "t<u>ea</u>r", ipa: "/te…ô(r)/", mean: "x√© r√°ch (v) [L∆∞u √Ω: N·∫øu l√† n∆∞·ªõc m·∫Øt th√¨ ƒë·ªçc l√† /t…™…ô/, nh∆∞ng ·ªü ƒë√¢y l√† ƒë·ªông t·ª´]", type: "e…ô", correct: true },
                { id: "B", text: "app<u>ea</u>r", ipa: "/…ôÀàp…™…ô(r)/", mean: "xu·∫•t hi·ªán (v)", type: "…™…ô" },
                { id: "C", text: "th<u>ea</u>ter", ipa: "/ÀàŒ∏…™…ôt…ô(r)/", mean: "nh√† h√°t (n)", type: "…™…ô" },
                { id: "D", text: "sh<u>ea</u>r", ipa: "/ É…™…ô(r)/", mean: "c·∫Øt l√¥ng c·ª´u (v)", type: "…™…ô" }
            ],
            hint: "T·ª´ 'tear' c√≥ 2 c√°ch ƒë·ªçc. H√£y x√©t c√°c ƒë√°p √°n c√≤n l·∫°i ƒë·ªÉ suy ra c√°ch ƒë·ªçc ƒë√∫ng trong c√¢u n√†y."
        },
        {
            id: 11,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "ea<u>r</u>th", ipa: "/…úÀêŒ∏/", mean: "tr√°i ƒë·∫•t (n)", type: "…úÀê" },
                { id: "B", text: "lea<u>r</u>n", ipa: "/l…úÀên/", mean: "h·ªçc (v)", type: "…úÀê" },
                { id: "C", text: "clea<u>r</u>", ipa: "/kl…™…ô(r)/", mean: "r√µ r√†ng (adj)", type: "…™…ô", correct: true },
                { id: "D", text: "sea<u>r</u>ch", ipa: "/s…úÀêt É/", mean: "t√¨m ki·∫øm (v)", type: "…úÀê" }
            ],
            hint: "Ph√¢n bi·ªát √¢m /…úÀê/ v√† /…™…ô/."
        },
        {
            id: 12,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "decl<u>are</u>", ipa: "/d…™Ààkle…ô(r)/", mean: "tuy√™n b·ªë (v)", type: "e…ô" },
                { id: "B", text: "<u>air</u>port", ipa: "/Ààe…ôp…îÀêt/", mean: "s√¢n bay (n)", type: "e…ô" },
                { id: "C", text: "wh<u>ere</u>", ipa: "/we…ô(r)/", mean: "·ªü ƒë√¢u (adv)", type: "e…ô" },
                { id: "D", text: "engin<u>eer</u>", ipa: "/Àåend í…™Ààn…™…ô(r)/", mean: "k·ªπ s∆∞ (n)", type: "…™…ô", correct: true }
            ],
            hint: "K·ªπ s∆∞ (engineer) c√≥ √¢m ƒëu√¥i l√† /…™…ô/."
        },
        {
            id: 13,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "e<u>a</u>r", ipa: "/…™…ô(r)/", mean: "c√°i tai (n)", type: "…™…ô" },
                { id: "B", text: "d<u>ea</u>r", ipa: "/d…™…ô(r)/", mean: "th√¢n m·∫øn (adj)", type: "…™…ô" },
                { id: "C", text: "p<u>ea</u>r", ipa: "/pe…ô(r)/", mean: "qu·∫£ l√™ (n)", type: "e…ô", correct: true },
                { id: "D", text: "cl<u>ea</u>r", ipa: "/kl…™…ô(r)/", mean: "r√µ r√†ng (adj)", type: "…™…ô" }
            ],
            hint: "Qu·∫£ l√™ (pear) c√≥ ph√°t √¢m gi·ªëng 'bear' hay 'wear' (/e…ô/)."
        },
        {
            id: 14,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "s<u>ee</u>", ipa: "/siÀê/", mean: "nh√¨n th·∫•y (v)", type: "iÀê", correct: true },
                { id: "B", text: "s<u>ee</u>r", ipa: "/s…™…ô(r)/", mean: "nh√† ti√™n tri (n)", type: "…™…ô" },
                { id: "C", text: "l<u>ee</u>r", ipa: "/l…™…ô(r)/", mean: "li·∫øc nh√¨n (v)", type: "…™…ô" },
                { id: "D", text: "b<u>ee</u>r", ipa: "/b…™…ô(r)/", mean: "bia (n)", type: "…™…ô" }
            ],
            hint: "Ph√¢n bi·ªát /i:/ v√† /…™…ô/."
        },
        {
            id: 15,
            question: "Choose the word with the underlined part pronounced differently:",
            options: [
                { id: "A", text: "<u>a</u>rea", ipa: "/Ààe…ôri…ô/", mean: "khu v·ª±c (n)", type: "e…ô" },
                { id: "B", text: "<u>a</u>rena", ipa: "/…ôÀàriÀên…ô/", mean: "ƒë·∫•u tr∆∞·ªùng (n)", type: "…ô", correct: true },
                { id: "C", text: "p<u>a</u>rent", ipa: "/Ààpe…ôr…ônt/", mean: "cha m·∫π (n)", type: "e…ô" },
                { id: "D", text: "v<u>a</u>rious", ipa: "/Ààve…ôri…ôs/", mean: "ƒëa d·∫°ng (adj)", type: "e…ô" }
            ],
            hint: "Ch√∫ √Ω t·ª´ 'arena' c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2."
        }
    ];

    let currentScore = 0;
    const totalQuestions = quizData.length;
    const answeredQuestions = new Set();

    // AUDIO CONTEXT & SYNTH SOUNDS (No external files needed)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High sine wave)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            // Buzz sound (Low saw wave)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // CONFETTI EFFECT
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];

    function createParticles(x, y) {
        for(let i=0; i<30; i++) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 1) * 10,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                life: 100
            });
        }
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, index) => {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.2; // Gravity
            p.life--;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 6, 6);
            if(p.life <= 0) particles.splice(index, 1);
        });
        requestAnimationFrame(animateConfetti);
    }
    animateConfetti();

    // RENDER QUIZ
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        
        quizData.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-${index}`;

            // Header of Card
            const title = document.createElement('div');
            title.className = 'question-title';
            title.innerHTML = `
                <span class="question-number">Question ${index + 1}</span>
                <span>${q.question}</span>
            `;

            // Options Grid
            const grid = document.createElement('div');
            grid.className = 'options-grid';

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `${opt.id}. ${opt.text}`;
                btn.onclick = (e) => checkAnswer(index, opt, btn, e);
                grid.appendChild(btn);
            });

            // Explanation Box
            const expl = document.createElement('div');
            expl.className = 'explanation-box';
            expl.id = `expl-${index}`;
            
            // Build Explanation Content (Ms Mai An Style)
            let vocabListHTML = `<ul class="vocab-list">`;
            q.options.forEach(o => {
                vocabListHTML += `
                    <li class="vocab-item">
                        <div><span class="vocab-word">${o.id}. ${o.text.replace(/<\/?u>/g, '')}</span> <small>${o.ipa}</small></div>
                        <span class="vocab-mean">${o.mean}</span>
                    </li>
                `;
            });
            vocabListHTML += `</ul>`;

            const correctOpt = q.options.find(o => o.correct);
            const othersType = q.options.find(o => !o.correct).type; // Assuming other 3 are same

            expl.innerHTML = `
                <div class="explanation-header">
                    <i>üë©‚Äçüè´</i> <span>C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</span>
                </div>
                <div class="explanation-content">
                    <p><strong>1. Ph√¢n t√≠ch t·ª´ v·ª±ng & Phi√™n √¢m:</strong></p>
                    ${vocabListHTML}
                    <p style="margin-top: 10px;"><strong>2. T·∫°i sao ch·ªçn ƒë√°p √°n ${correctOpt.id}?</strong></p>
                    <p>ƒê√°p √°n <strong>${correctOpt.text}</strong> c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m l√† <strong style="color:var(--correct-green); font-size:1.2em">/${correctOpt.type}/</strong>.</p>
                    <p>Trong khi ƒë√≥, 3 ƒë√°p √°n c√≤n l·∫°i ƒë·ªÅu ph√°t √¢m l√† <strong style="color:var(--wrong-red)">/${othersType}/</strong>.</p>
                    <p><em>üí° M·∫πo nh·ªè: ${q.hint}</em></p>
                </div>
            `;

            card.appendChild(title);
            card.appendChild(grid);
            card.appendChild(expl);
            container.appendChild(card);
        });
    }

    // CHECK ANSWER LOGIC
    function checkAnswer(qIndex, selectedOpt, btnElement, event) {
        if (answeredQuestions.has(qIndex)) return; // Prevent re-answering
        answeredQuestions.add(qIndex);

        const card = document.getElementById(`q-${qIndex}`);
        const allBtns = card.querySelectorAll('.option-btn');
        const explanation = document.getElementById(`expl-${qIndex}`);

        // Disable all buttons
        allBtns.forEach(btn => btn.classList.add('disabled'));

        if (selectedOpt.correct) {
            // CORRECT
            btnElement.classList.add('correct');
            currentScore++;
            playSound('correct');
            createParticles(event.clientX, event.clientY); // Confetti at click
            document.getElementById('current-score').innerText = currentScore;
        } else {
            // WRONG
            btnElement.classList.add('wrong');
            playSound('wrong');
            // Highlight the correct one automatically
            const correctBtn = Array.from(allBtns).find(btn => 
                btn.innerText.includes(quizData[qIndex].options.find(o => o.correct).text.replace(/<\/?u>/g, ''))
            );
            if(correctBtn) correctBtn.classList.add('correct'); // Show correct answer even if wrong
        }

        // Show Explanation with animation
        explanation.style.display = 'block';
        explanation.animate([
            { opacity: 0, transform: 'translateY(-10px)' },
            { opacity: 1, transform: 'translateY(0)' }
        ], { duration: 300 });
    }

    // SHOW FINAL RESULT
    function showFinalResult() {
        const modal = document.getElementById('result-modal');
        const scoreDisplay = document.getElementById('final-score-display');
        const feedback = document.getElementById('final-feedback');

        scoreDisplay.innerText = `${currentScore} / ${totalQuestions}`;
        
        const percentage = (currentScore / totalQuestions) * 100;
        if (percentage === 100) {
            feedback.innerText = "üèÜ Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng·ªØ √¢m!";
            playSound('correct');
            createParticles(window.innerWidth/2, window.innerHeight/2);
        } else if (percentage >= 80) {
            feedback.innerText = "üéâ R·∫•t t·ªët! Ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i.";
        } else if (percentage >= 50) {
            feedback.innerText = "üí™ C·ªë g·∫Øng l√™n! Em c·∫ßn √¥n l·∫°i c√°c t·ª´ v·ª±ng nh√©.";
        } else {
            feedback.innerText = "üìö C·∫ßn luy·ªán t·∫≠p th√™m nhi·ªÅu nha!";
        }

        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
    }

    // Initialize
    renderQuiz();

</script>
</body>
</html>
