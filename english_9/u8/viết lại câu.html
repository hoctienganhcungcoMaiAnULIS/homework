<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms. Mai An ULIS - Relative Clauses Mastery</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8854C0; /* T√≠m h·ªìng */
            --secondary-color: #00C9A7; /* Xanh ng·ªçc */
            --correct-color: #00D26A; /* Xanh l√° */
            --wrong-color: #FF4757; /* ƒê·ªè cam */
            --bg-color: #F0F4F8;
            --card-bg: #FFFFFF;
            --text-color: #2D3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #fff0f5;
            background-image: 
                radial-gradient(#8854C0 15%, transparent 16%),
                radial-gradient(#00C9A7 15%, transparent 16%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header Styles */
        header {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 4px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 2rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            color: #666;
            font-size: 1.1rem;
            margin-top: 10px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
        }

        .badge {
            background: var(--secondary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            display: inline-block;
            margin-top: 5px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* Question Card Styles */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border: 3px solid #e0e0e0;
            transition: transform 0.3s ease;
            position: relative;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
        }

        .question-number {
            background: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            position: absolute;
            top: -15px;
            left: -15px;
            box-shadow: 0 4px 0 #5e35b1;
            z-index: 2;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: #2d3436;
            line-height: 1.5;
            padding-left: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 5px 0 #ddd;
            position: relative;
            color: #555;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            background-color: #f9f9f9;
            border-color: var(--primary-color);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: 0 0 0 #ddd;
        }

        .option-letter {
            background: #eee;
            color: #555;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 800;
            flex-shrink: 0;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: #d1fae5;
            border-color: var(--correct-color);
            color: #065f46;
            box-shadow: 0 5px 0 #059669;
        }
        .option-btn.correct .option-letter {
            background: var(--correct-color);
            color: white;
        }

        .option-btn.wrong {
            background-color: #fee2e2;
            border-color: var(--wrong-color);
            color: #991b1b;
            box-shadow: 0 5px 0 #b91c1c;
        }
        .option-btn.wrong .option-letter {
            background: var(--wrong-color);
            color: white;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
            transform: none !important;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 20px;
            background: #fff8e1;
            border: 2px dashed #ffc107;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-box.show {
            display: block;
        }

        .explanation-header {
            display: flex;
            align-items: center;
            font-weight: 800;
            color: #d97706;
            margin-bottom: 10px;
            border-bottom: 2px solid #ffecb3;
            padding-bottom: 5px;
        }

        .explanation-header span {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #4b5563;
            white-space: pre-line; /* Preserves newlines from JSON */
        }

        /* Footer / Submit */
        .footer-controls {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--primary-color);
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #5e35b1;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
            background: #9b6bd6;
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #5e35b1;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake-element {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Result Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 5px solid var(--secondary-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--secondary-color);
        }

        .result-message {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Ms. Mai An ULIS</h1>
            <div class="badge">English Master Class</div>
            <p>Rewrite Sentences: Relative Clauses Mastery üè∞</p>
            <p style="font-size: 0.9rem; margin-top: 5px; color: #888;">H√£y ch·ªçn c√¢u vi·∫øt l·∫°i ƒë√∫ng nh·∫•t nh√©!</p>
        </header>

        <div id="quiz-container">
            <!-- Questions will be injected here via JavaScript -->
        </div>

        <div class="footer-controls">
            <button class="submit-btn" onclick="finishQuiz()">N·ªôp B√†i (Submit)</button>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay" id="resultModal">
        <div class="result-card">
            <div class="score-circle" id="finalScore">0/0</div>
            <div class="result-message" id="resultMessage">Tuy·ªát v·ªùi!</div>
            <p style="color: #666; margin-bottom: 20px;">C·∫£m ∆°n em ƒë√£ ho√†n th√†nh b√†i t·∫≠p!</p>
            <button class="submit-btn" onclick="location.reload()">L√†m L·∫°i (Replay)</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <script>
        // === D·ªÆ LI·ªÜU B√ÄI T·∫¨P (DATA) ===
        const quizData = [
            {
                "questionNumber": 1,
                "question": "The tourist got lost in the city. The tourist didn‚Äôt speak English. (who)\n‚Üí Rewrite: _____________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "The tourist who didn‚Äôt speak English got lost in the city.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'who' (pronoun - ƒë·∫°i t·ª´ quan h·ªá): ng∆∞·ªùi m√†. M·ªánh ƒë·ªÅ quan h·ªá b·ªï nghƒ©a cho 'The tourist'.\n\nGi·∫£i th√≠ch: \n- 'The tourist' l√† danh t·ª´ ch·ªâ ng∆∞·ªùi -> d√πng 'who'.\n- M·ªánh ƒë·ªÅ 'who didn't speak English' ƒë∆∞·ª£c l·ªìng v√†o gi·ªØa ƒë·ªÉ b·ªï nghƒ©a r√µ r√†ng cho ch·ªß ng·ªØ.\n- C√¢u ƒë√∫ng ng·ªØ ph√°p v√† gi·ªØ nguy√™n nghƒ©a g·ªëc.\n\nD·ªãch c√¢u: Ng∆∞·ªùi du kh√°ch, ng∆∞·ªùi m√† kh√¥ng n√≥i ti·∫øng Anh, ƒë√£ b·ªã l·∫°c trong th√†nh ph·ªë.",
                        "isCorrect": true
                    },
                    {
                        "text": "The tourist which didn‚Äôt speak English got lost in the city.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'which' (pronoun): c√°i m√† (d√πng cho v·∫≠t).\n\nGi·∫£i th√≠ch: Sai v√¨ 'The tourist' l√† ng∆∞·ªùi, kh√¥ng th·ªÉ d√πng 'which'.\n\nD·ªãch c√¢u (sai): Ng∆∞·ªùi du kh√°ch c√°i m√† kh√¥ng n√≥i ti·∫øng Anh ƒë√£ b·ªã l·∫°c trong th√†nh ph·ªë.",
                        "isCorrect": false
                    },
                    {
                        "text": "The tourist got lost in the city who didn‚Äôt speak English.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. V·ªã tr√≠ m·ªánh ƒë·ªÅ sai.\n\nGi·∫£i th√≠ch: Sai c·∫•u tr√∫c. M·ªánh ƒë·ªÅ quan h·ªá 'who didn't speak English' ph·∫£i ƒë·ª©ng ngay sau danh t·ª´ n√≥ b·ªï nghƒ©a ('The tourist'). ƒê·∫∑t ·ªü cu·ªëi c√¢u khi·∫øn ng∆∞·ªùi ƒë·ªçc hi·ªÉu nh·∫ßm l√† 'the city' kh√¥ng bi·∫øt n√≥i ti·∫øng Anh.\n\nD·ªãch c√¢u (sai): Ng∆∞·ªùi du kh√°ch b·ªã l·∫°c trong th√†nh ph·ªë ng∆∞·ªùi m√† kh√¥ng n√≥i ti·∫øng Anh.",
                        "isCorrect": false
                    },
                    {
                        "text": "The tourist whom didn‚Äôt speak English got lost in the city.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. 'whom' (pronoun): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n\nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. ·ªû ƒë√¢y c·∫ßn ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'speak', n√™n ph·∫£i d√πng 'who'. 'Whom' ch·ªâ d√πng l√†m t√¢n ng·ªØ.\n\nD·ªãch c√¢u (sai): Ng∆∞·ªùi du kh√°ch ng∆∞·ªùi m√† (t√¢n ng·ªØ) kh√¥ng n√≥i ti·∫øng Anh ƒë√£ b·ªã l·∫°c...",
                        "isCorrect": false
                    }
                ]
            },
            {
                "questionNumber": 2,
                "question": "Mount Fuji is a dormant volcano in Japan. It‚Äôs a popular destination for hikers. (which)\n‚Üí Rewrite: Mount Fuji, ____________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "which is a popular destination for hikers, is a dormant volcano in Japan.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'which' (pronoun): c√°i m√†/n∆°i m√†.\n\nGi·∫£i th√≠ch: \n- 'Mount Fuji' l√† t√™n ri√™ng (ƒë·ªãa danh c·ª• th·ªÉ) -> D√πng m·ªánh ƒë·ªÅ quan h·ªá kh√¥ng x√°c ƒë·ªãnh (c√≥ d·∫•u ph·∫©y).\n- 'Which' thay th·∫ø cho 'It' ƒë·ªÉ l√†m ch·ªß ng·ªØ cho m·ªánh ƒë·ªÅ ph·ª•.\n- C·∫•u tr√∫c: Subject + , which + clause , + main verb...\n\nD·ªãch c√¢u: N√∫i Ph√∫ Sƒ©, n∆°i l√† m·ªôt ƒëi·ªÉm ƒë·∫øn ph·ªï bi·∫øn cho ng∆∞·ªùi leo n√∫i, l√† m·ªôt ng·ªçn n√∫i l·ª≠a ƒë√£ t·∫Øt ·ªü Nh·∫≠t B·∫£n.",
                        "isCorrect": true
                    },
                    {
                        "text": "that is a popular destination for hikers, is a dormant volcano in Japan.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'that' (pronoun): c√°i m√†.\n\nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. Kh√¥ng ƒë∆∞·ª£c d√πng 'that' trong m·ªánh ƒë·ªÅ quan h·ªá c√≥ d·∫•u ph·∫©y (non-defining relative clause).\n\nD·ªãch c√¢u (sai): D√πng 'that' sau d·∫•u ph·∫©y l√† l·ªói ng·ªØ ph√°p.",
                        "isCorrect": false
                    },
                    {
                        "text": "which is a popular destination for hikers is a dormant volcano in Japan.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. Thi·∫øu d·∫•u ph·∫©y.\n\nGi·∫£i th√≠ch: Sai l·ªói ch√≠nh t·∫£/ng·ªØ ph√°p. V√¨ 'Mount Fuji' l√† t√™n ri√™ng, b·∫Øt bu·ªôc ph·∫£i c√≥ d·∫•u ph·∫©y ngƒÉn c√°ch m·ªánh ƒë·ªÅ quan h·ªá.\n\nD·ªãch c√¢u (sai): Thi·∫øu d·∫•u ph·∫©y ngƒÉn c√°ch.",
                        "isCorrect": false
                    },
                    {
                        "text": "who is a popular destination for hikers, is a dormant volcano in Japan.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. 'who' (pronoun): ng∆∞·ªùi m√†.\n\nGi·∫£i th√≠ch: Sai v√¨ 'Mount Fuji' l√† v·∫≠t/ƒë·ªãa danh, kh√¥ng ph·∫£i ng∆∞·ªùi.\n\nD·ªãch c√¢u (sai): N√∫i Ph√∫ Sƒ© ng∆∞·ªùi m√†...",
                        "isCorrect": false
                    }
                ]
            },
            {
                "questionNumber": 3,
                "question": "Tourists flock to the Taj Mahal in India. It‚Äôs made from white marble. (which)\n‚Üí Rewrite: Tourists flock ___________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "to the Taj Mahal in India, which is made from white marble.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'which' (pronoun): c√°i m√†.\n\nGi·∫£i th√≠ch: \n- 'The Taj Mahal' l√† danh t·ª´ ƒë·ª©ng tr∆∞·ªõc. \n- M·ªánh ƒë·ªÅ 'which is made from white marble' b·ªï sung th√¥ng tin th√™m v·ªÅ Taj Mahal.\n- D√πng d·∫•u ph·∫©y v√¨ Taj Mahal l√† ƒë·ªãa danh x√°c ƒë·ªãnh duy nh·∫•t.\n\nD·ªãch c√¢u: Du kh√°ch ƒë·ªï x√¥ ƒë·∫øn ƒë·ªÅn Taj Mahal ·ªü ·∫§n ƒê·ªô, n∆°i ƒë∆∞·ª£c l√†m t·ª´ ƒë√° c·∫©m th·∫°ch tr·∫Øng.",
                        "isCorrect": true
                    },
                    {
                        "text": "to the Taj Mahal in India, where is made from white marble.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'where' (adverb): n∆°i m√†.\n\nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. 'Where' = 'in which', sau 'where' ph·∫£i l√† m·ªôt m·ªánh ƒë·ªÅ ƒë·∫ßy ƒë·ªß (S + V). ·ªû ƒë√¢y 'is made' l√† ƒë·ªông t·ª´, thi·∫øu ch·ªß ng·ªØ, n√™n ph·∫£i d√πng 'which' l√†m ch·ªß ng·ªØ.\n\nD·ªãch c√¢u (sai): D√πng 'where' l√†m ch·ªß ng·ªØ l√† sai.",
                        "isCorrect": false
                    },
                    {
                        "text": "to the Taj Mahal in India which is made from white marble.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. Thi·∫øu d·∫•u ph·∫©y.\n\nGi·∫£i th√≠ch: Taj Mahal l√† t√™n ri√™ng, n√™n m·ªánh ƒë·ªÅ quan h·ªá ƒëi sau n√≥ mang t√≠nh b·ªï sung (non-defining), c·∫ßn c√≥ d·∫•u ph·∫©y.\n\nD·ªãch c√¢u (sai): Thi·∫øu d·∫•u ph·∫©y.",
                        "isCorrect": false
                    },
                    {
                        "text": "to the Taj Mahal in India, who is made from white marble.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. 'who' (pronoun): ng∆∞·ªùi m√†.\n\nGi·∫£i th√≠ch: Sai v√¨ Taj Mahal l√† v·∫≠t/ƒë·ªãa ƒëi·ªÉm.\n\nD·ªãch c√¢u (sai): Taj Mahal ng∆∞·ªùi m√†...",
                        "isCorrect": false
                    }
                ]
            },
            {
                "questionNumber": 4,
                "question": "The chef won a food competition. He prepared the dish with fresh ingredients. (who)\n‚Üí Rewrite: The chef _______________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "who prepared the dish with fresh ingredients won a food competition.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'who' (pronoun): ng∆∞·ªùi m√†.\n\nGi·∫£i th√≠ch: \n- 'The chef' l√† danh t·ª´ ch·ªâ ng∆∞·ªùi.\n- D√πng 'who' thay th·∫ø cho 'He' trong c√¢u th·ª© hai ƒë·ªÉ t·∫°o th√†nh m·ªánh ƒë·ªÅ quan h·ªá 'who prepared...'.\n- M·ªánh ƒë·ªÅ n√†y b·ªï nghƒ©a cho 'The chef'.\n\nD·ªãch c√¢u: Ng∆∞·ªùi ƒë·∫ßu b·∫øp, ng∆∞·ªùi m√† ƒë√£ chu·∫©n b·ªã m√≥n ƒÉn v·ªõi c√°c nguy√™n li·ªáu t∆∞∆°i ngon, ƒë√£ chi·∫øn th·∫Øng cu·ªôc thi ·∫©m th·ª±c.",
                        "isCorrect": true
                    },
                    {
                        "text": "which prepared the dish with fresh ingredients won a food competition.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'which' (pronoun): c√°i m√†.\n\nGi·∫£i th√≠ch: Sai v√¨ 'The chef' l√† ng∆∞·ªùi.\n\nD·ªãch c√¢u (sai): Ng∆∞·ªùi ƒë·∫ßu b·∫øp c√°i m√†...",
                        "isCorrect": false
                    },
                    {
                        "text": "whom prepared the dish with fresh ingredients won a food competition.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. 'whom' (pronoun): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n\nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. ·ªû ƒë√¢y c·∫ßn ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'prepared', n√™n ph·∫£i d√πng 'who'.\n\nD·ªãch c√¢u (sai): D√πng 'whom' l√†m ch·ªß ng·ªØ l√† sai.",
                        "isCorrect": false
                    },
                    {
                        "text": "won a food competition who prepared the dish with fresh ingredients.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. Sai v·ªã tr√≠.\n\nGi·∫£i th√≠ch: M·ªánh ƒë·ªÅ quan h·ªá 'who...' ƒëang ƒë·ª©ng qu√° xa danh t·ª´ 'The chef', g√¢y kh√≥ hi·ªÉu ho·∫∑c sai nghƒ©a.\n\nD·ªãch c√¢u (sai): S·∫Øp x·∫øp l·ªôn x·ªôn.",
                        "isCorrect": false
                    }
                ]
            },
            {
                "questionNumber": 5,
                "question": "The Philippines has incredible biodiversity. It‚Äôs home to many unique species of plants and animals. (which)\n‚Üí Rewrite: The Philippines, ________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "which is home to many unique species of plants and animals, has incredible biodiversity.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'which' (pronoun): c√°i m√†/n∆°i m√†.\n\nGi·∫£i th√≠ch: \n- 'The Philippines' l√† t√™n ri√™ng -> c·∫ßn d·∫•u ph·∫©y.\n- 'Which' thay th·∫ø cho 'It' l√†m ch·ªß ng·ªØ trong m·ªánh ƒë·ªÅ quan h·ªá.\n- C√¢u ch√≠nh: The Philippines has incredible biodiversity.\n\nD·ªãch c√¢u: Philippines, n∆°i l√† nh√† c·ªßa nhi·ªÅu lo√†i ƒë·ªông th·ª±c v·∫≠t ƒë·ªôc ƒë√°o, c√≥ s·ª± ƒëa d·∫°ng sinh h·ªçc ƒë√°ng kinh ng·∫°c.",
                        "isCorrect": true
                    },
                    {
                        "text": "where is home to many unique species of plants and animals, has incredible biodiversity.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'where' (adverb): n∆°i m√†.\n\nGi·∫£i th√≠ch: Sai ng·ªØ ph√°p. 'Where' kh√¥ng l√†m ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'is'. (N·∫øu mu·ªën d√πng where, c√¢u ph·∫£i l√† 'where many unique species live').\n\nD·ªãch c√¢u (sai): D√πng 'where' sai ch·ª©c nƒÉng ng·ªØ ph√°p.",
                        "isCorrect": false
                    },
                    {
                        "text": "that is home to many unique species of plants and animals, has incredible biodiversity.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. 'that' (pronoun).\n\nGi·∫£i th√≠ch: Sai v√¨ kh√¥ng d√πng 'that' sau d·∫•u ph·∫©y (m·ªánh ƒë·ªÅ kh√¥ng x√°c ƒë·ªãnh).\n\nD·ªãch c√¢u (sai): D√πng 'that' trong m·ªánh ƒë·ªÅ c√≥ d·∫•u ph·∫©y.",
                        "isCorrect": false
                    },
                    {
                        "text": "who is home to many unique species of plants and animals, has incredible biodiversity.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. 'who' (pronoun).\n\nGi·∫£i th√≠ch: Sai v√¨ Philippines l√† t√™n n∆∞·ªõc (v·∫≠t/n∆°i ch·ªën), kh√¥ng d√πng 'who'.\n\nD·ªãch c√¢u (sai): D√πng sai ƒë·∫°i t·ª´ quan h·ªá.",
                        "isCorrect": false
                    }
                ]
            },
            {
                "questionNumber": 6,
                "question": "Ha Long Bay is famous for stunning scenery. Its limestone formations rise out of the emerald water. (whose)\n‚Üí Rewrite: Ha Long Bay, ___________________________________________________________________________________",
                "answerOptions": [
                    {
                        "text": "whose limestone formations rise out of the emerald water, is famous for stunning scenery.",
                        "rationale": "D·ªãch chi ti·∫øt:\nA. 'whose' (pronoun): c·ªßa... (s·ªü h·ªØu).\n\nGi·∫£i th√≠ch: \n- Thay 'Its' (c·ªßa n√≥) b·∫±ng 'whose'.\n- 'Ha Long Bay' l√† t√™n ri√™ng -> d√πng d·∫•u ph·∫©y.\n- C·∫•u tr√∫c: T√™n ri√™ng + , whose + danh t·ª´ + V..., + V ch√≠nh...\n\nD·ªãch c√¢u: V·ªãnh H·∫° Long, n∆°i c√≥ nh·ªØng kh·ªëi ƒë√° v√¥i nh√¥ l√™n kh·ªèi m·∫∑t n∆∞·ªõc xanh ng·ªçc b√≠ch, n·ªïi ti·∫øng v·ªõi phong c·∫£nh tuy·ªát ƒë·∫πp.",
                        "isCorrect": true
                    },
                    {
                        "text": "which limestone formations rise out of the emerald water, is famous for stunning scenery.",
                        "rationale": "D·ªãch chi ti·∫øt:\nB. 'which' (pronoun).\n\nGi·∫£i th√≠ch: Sai. 'Which' kh√¥ng ch·ªâ s·ª± s·ªü h·ªØu. Ph·∫£i d√πng 'whose' ƒë·ªÉ thay cho 'Its'.\n\nD·ªãch c√¢u (sai): Kh√¥ng th·ªÉ hi·ªán ƒë∆∞·ª£c √Ω 'c·ªßa V·ªãnh H·∫° Long'.",
                        "isCorrect": false
                    },
                    {
                        "text": "whose limestone formations rise out of the emerald water is famous for stunning scenery.",
                        "rationale": "D·ªãch chi ti·∫øt:\nC. Thi·∫øu d·∫•u ph·∫©y.\n\nGi·∫£i th√≠ch: Sai l·ªói ng·ªØ ph√°p. Thi·∫øu d·∫•u ph·∫©y th·ª© hai tr∆∞·ªõc ƒë·ªông t·ª´ ch√≠nh 'is famous'. M·ªánh ƒë·ªÅ quan h·ªá kh√¥ng x√°c ƒë·ªãnh ph·∫£i ƒë∆∞·ª£c t√°ch bi·ªát ho√†n to√†n b·∫±ng 2 d·∫•u ph·∫©y.\n\nD·ªãch c√¢u (sai): Thi·∫øu d·∫•u ph·∫©y ng·∫Øt c√¢u.",
                        "isCorrect": false
                    },
                    {
                        "text": "that limestone formations rise out of the emerald water, is famous for stunning scenery.",
                        "rationale": "D·ªãch chi ti·∫øt:\nD. 'that' (pronoun).\n\nGi·∫£i th√≠ch: Sai ho√†n to√†n v·ªÅ c·∫•u tr√∫c s·ªü h·ªØu v√† quy t·∫Øc d√πng 'that' sau d·∫•u ph·∫©y.\n\nD·ªãch c√¢u (sai): Sai c·∫•u tr√∫c.",
                        "isCorrect": false
                    }
                ]
            }
        ];

        // Shuffle logic
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Shuffle the questions for variety
        shuffleArray(quizData);

        // State tracking
        let score = 0;
        let answeredCount = 0;
        const totalQuestions = quizData.length;

        // === RENDER B√ÄI T·∫¨P ===
        const container = document.getElementById('quiz-container');

        quizData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.id = `card-${index}`;

            // Format question text (replace newlines)
            const questionText = item.question.replace(/\n/g, '<br>');

            // Generate Options HTML
            let optionsHtml = '';
            item.answerOptions.forEach((opt, optIndex) => {
                const letters = ['A', 'B', 'C', 'D'];
                optionsHtml += `
                    <button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, ${opt.isCorrect}, this)">
                        <div class="option-letter">${letters[optIndex]}</div>
                        <div>${opt.text}</div>
                    </button>
                `;
            });

            // Find the correct rationale to display
            const correctOption = item.answerOptions.find(opt => opt.isCorrect);
            // Construct full rationale explanation combining all rationales for comparison
            let fullRationale = "";
            item.answerOptions.forEach((opt, idx) => {
                fullRationale += `<b>Ph∆∞∆°ng √°n ${['A','B','C','D'][idx]}:</b>\n${opt.rationale}\n\n-----------------\n\n`;
            });


            card.innerHTML = `
                <div class="question-number">${index + 1}</div>
                <div class="question-text">${questionText}</div>
                <div class="options-grid" id="options-${index}">
                    ${optionsHtml}
                </div>
                <div class="explanation-box" id="explanation-${index}">
                    <div class="explanation-header">
                        <span>üë©‚Äçüè´</span> Gi·∫£i th√≠ch chi ti·∫øt b·ªüi Ms. Mai An:
                    </div>
                    <div class="explanation-content">${fullRationale}</div>
                </div>
            `;
            container.appendChild(card);
        });

        // === X·ª¨ L√ù S·ª∞ KI·ªÜN ===

        // Sound Effects (Using standard URLs for reliability)
        const soundCorrect = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3');
        const soundWrong = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3'); 
        const soundClap = new Audio('https://www.soundjay.com/human/sounds/applause-01.mp3');

        function checkAnswer(cardIndex, optionIndex, isCorrect, btnElement) {
            const card = document.getElementById(`card-${cardIndex}`);
            const optionsDiv = document.getElementById(`options-${cardIndex}`);
            const explanationBox = document.getElementById(`explanation-${cardIndex}`);
            const buttons = optionsDiv.getElementsByClassName('option-btn');

            // Prevent re-clicking
            if (btnElement.disabled) return;

            // Disable all buttons in this card
            for (let btn of buttons) {
                btn.disabled = true;
                // Highlight the correct answer anyway if user chose wrong
                // Find data-correct logic? We passed isCorrect in onclick, need to find the correct button text
                // Simpler: We loop through quizData
                const qData = quizData[cardIndex];
                // Check if this button corresponds to a correct option
                // Since we rendered sequentially, button index matches option index
            }
            
            // Highlight Correct Answer visually even if wrong picked
            const correctBtnIndex = quizData[cardIndex].answerOptions.findIndex(o => o.isCorrect);
            buttons[correctBtnIndex].classList.add('correct');

            if (isCorrect) {
                score++;
                // Play sound
                soundCorrect.currentTime = 0;
                soundCorrect.play();
                // Confetti
                fireConfetti(btnElement.getBoundingClientRect());
            } else {
                btnElement.classList.add('wrong');
                // Play sound
                soundWrong.currentTime = 0;
                soundWrong.play();
                // Shake animation
                card.classList.add('shake-element');
                setTimeout(() => card.classList.remove('shake-element'), 500);
            }

            // Show explanation
            explanationBox.classList.add('show');
            
            answeredCount++;
        }

        function finishQuiz() {
            if (answeredCount < totalQuestions) {
                if(!confirm(`Em m·ªõi l√†m ${answeredCount}/${totalQuestions} c√¢u. Em c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?`)) {
                    return;
                }
            }

            const modal = document.getElementById('resultModal');
            const scoreDisplay = document.getElementById('finalScore');
            const msgDisplay = document.getElementById('resultMessage');

            scoreDisplay.innerText = `${score}/${totalQuestions}`;
            
            const percentage = (score / totalQuestions) * 100;
            if (percentage === 100) {
                msgDisplay.innerText = "Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i! üåü";
                soundClap.play();
                fireGlobalConfetti();
            } else if (percentage >= 80) {
                msgDisplay.innerText = "Gi·ªèi l·∫Øm! C·ªë ch√∫t n·ªØa l√† ƒëi·ªÉm 10! üí™";
            } else if (percentage >= 50) {
                msgDisplay.innerText = "Kh√° t·ªët! C·∫ßn √¥n l·∫°i b√†i m·ªôt ch√∫t nh√©! üìö";
            } else {
                msgDisplay.innerText = "ƒê·ª´ng bu·ªìn! H√£y xem l·∫°i gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nha! ‚ù§Ô∏è";
            }

            modal.style.display = 'flex';
        }

        // === CONFETTI EFFECT ===
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];

        function fireConfetti(rect) {
            // Origin at center of clicked button
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;

            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5, // Upwards bias
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    gravity: 0.5,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10,
                    life: 100
                });
            }
            animateConfetti();
        }

        function fireGlobalConfetti() {
             for (let i = 0; i < 200; i++) {
                particles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    vx: (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 0.5) * 20 - 10,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    gravity: 0.5,
                    rotation: Math.random() * 360,
                    rotationSpeed: (Math.random() - 0.5) * 10,
                    life: 150
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if (particles.length === 0) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += p.gravity;
                p.rotation += p.rotationSpeed;
                p.life--;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                ctx.restore();
            }

            particles = particles.filter(p => p.life > 0);

            if (particles.length > 0) {
                requestAnimationFrame(animateConfetti);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

    </script>
</body>
</html>
