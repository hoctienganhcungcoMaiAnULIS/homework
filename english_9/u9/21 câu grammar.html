<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán t·∫≠p Ti·∫øng Anh 9 - Ms Mai An ULIS</title>
    
    <!-- Google Fonts: Nunito & Quicksand -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #8854C0; /* Purple */
            --primary-dark: #6c429c;
            --secondary: #00C9A7; /* Teal */
            --secondary-dark: #009e82;
            --correct: #00D26A;
            --correct-dark: #00a855;
            --wrong: #FF4757;
            --wrong-dark: #d6303e;
            --bg-color: #f0f4f8;
            --text-color: #2d3436;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevent text selection for app-like feel */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dfe6e9 15%, transparent 16%), radial-gradient(#dfe6e9 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-color);
            margin: 0;
            padding-bottom: 80px; /* Space for footer */
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .header p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Question Card */
        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05), 0 10px 20px rgba(0,0,0,0.05);
            border: 2px solid #fff;
            position: relative;
            transition: transform 0.3s ease;
        }

        .question-number {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 var(--primary-dark);
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr; /* Stack on mobile */
            }
        }

        /* Option Button Styling (3D Effect) */
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-bottom: 5px solid #e0e0e0; /* 3D effect */
            border-radius: 15px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            position: relative;
            display: flex;
            align-items: center;
        }

        .option-btn:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }
        
        .option-btn:hover:not(:disabled) {
            background-color: #f9f9f9;
            transform: scale(1.02);
        }

        .option-circle {
            width: 30px;
            height: 30px;
            background: #eee;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 800;
            font-size: 0.9rem;
            color: #777;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct);
            border-color: var(--correct-dark);
            color: white;
        }
        .option-btn.correct .option-circle {
            background-color: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            border-color: var(--wrong-dark);
            color: white;
        }
        .option-btn.wrong .option-circle {
            background-color: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }
        
        .option-btn:disabled:hover {
            transform: none;
        }

        /* Animation Classes */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background-color: #e3f2fd;
            border: 2px solid #bbdefb;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-box.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .exp-header {
            font-family: 'Quicksand', sans-serif;
            color: #1565c0;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .exp-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap; /* Preserve line breaks from JSON */
        }
        
        /* Highlight sections in explanation */
        .exp-content b {
            color: var(--primary);
        }

        /* Footer / Submit Bar */
        .footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 99;
        }

        .score-display {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .submit-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-bottom: 5px solid var(--secondary-dark);
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
        }

        .submit-btn:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .result-card {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .result-card {
            transform: scale(1);
        }

        .final-score {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary);
            margin: 10px 0;
        }

        .cheer-msg {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 25px;
        }
        
        .restart-btn {
            background: var(--primary);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            border-bottom: 4px solid var(--primary-dark);
        }

    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <h1>Ms Mai An ULIS</h1>
        <p>Luy·ªán t·∫≠p Ti·∫øng Anh 9: M·ªánh ƒë·ªÅ quan h·ªá & Gi·ªõi t·ª´</p>
    </header>

    <!-- Main Content -->
    <div class="container" id="quiz-container">
        <!-- Quiz items will be injected here via JS -->
    </div>

    <!-- Footer Bar -->
    <div class="footer-bar">
        <div class="score-display">
            ƒêi·ªÉm: <span id="current-score">0</span>/<span id="total-questions">0</span>
        </div>
        <button class="submit-btn" onclick="finishQuiz()">
            N·ªôp B√†i <i class="fas fa-flag-checkered"></i>
        </button>
    </div>

    <!-- Result Modal -->
    <div class="modal-overlay" id="result-modal">
        <div class="result-card">
            <h2 style="color: var(--secondary);">K·∫øt Qu·∫£</h2>
            <div class="final-score" id="final-score-display">0/0</div>
            <p class="cheer-msg" id="cheer-msg">B·∫°n l√†m t·ªët l·∫Øm!</p>
            <button class="restart-btn" onclick="location.reload()">L√†m l·∫°i b√†i <i class="fas fa-redo"></i></button>
        </div>
    </div>

    <script>
        // --- SOUND ENGINE (Web Audio API - No external files needed) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Ding sound (High pitch, fast decay)
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Buzz sound (Low pitch, saw)
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- DATA (From User Input) ---
        const rawData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "31. Please copy the important information ______ a separate document for easy reference.",
              "answerOptions": [
                { "text": "into", "isCorrect": true, "id": "A" },
                { "text": "from", "isCorrect": false, "id": "B" },
                { "text": "over", "isCorrect": false, "id": "C" },
                { "text": "up", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. into (prep): v√†o trong, v√†o.\n- B. from (prep): t·ª´.\n- C. over (prep): qua, tr√πm l√™n.\n- D. up (prep): l√™n.\n\n2. D·ªãch nghƒ©a: Vui l√≤ng sao ch√©p th√¥ng tin quan tr·ªçng v√†o m·ªôt t√†i li·ªáu ri√™ng ƒë·ªÉ d·ªÖ tham kh·∫£o.\n\n3. Gi·∫£i th√≠ch:\n- C·∫•u tr√∫c: 'copy something into something' (sao ch√©p c√°i g√¨ v√†o c√°i g√¨).\n- Ta c·∫ßn gi·ªõi t·ª´ ch·ªâ s·ª± chuy·ªÉn ƒë·ªïi v·ªã tr√≠ v√†o b√™n trong m·ªôt t√†i li·ªáu kh√°c -> Ch·ªçn 'into'."
            },
            {
              "questionNumber": 2,
              "question": "32. The teacher ______ students love English is very kind.",
              "answerOptions": [
                { "text": "whose", "isCorrect": true, "id": "A" },
                { "text": "what", "isCorrect": false, "id": "B" },
                { "text": "who", "isCorrect": false, "id": "C" },
                { "text": "which", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. whose (ƒë·∫°i t·ª´ quan h·ªá): c·ªßa ai (ch·ªâ s·ªü h·ªØu).\n- B. what (t·ª´ ƒë·ªÉ h·ªèi/quan h·ªá): c√°i g√¨.\n- C. who (ƒë·∫°i t·ª´ quan h·ªá): ng∆∞·ªùi m√† (l√†m ch·ªß ng·ªØ/t√¢n ng·ªØ).\n- D. which (ƒë·∫°i t·ª´ quan h·ªá): c√°i m√† (ch·ªâ v·∫≠t).\n\n2. D·ªãch nghƒ©a: Ng∆∞·ªùi gi√°o vi√™n m√† c√≥ nh·ªØng h·ªçc sinh y√™u th√≠ch Ti·∫øng Anh th√¨ r·∫•t t·ªët b·ª•ng.\n\n3. Gi·∫£i th√≠ch:\n- Danh t·ª´ ƒë·ª©ng tr∆∞·ªõc l√† 'The teacher' (ng∆∞·ªùi).\n- Danh t·ª´ ƒë·ª©ng sau l√† 'students' (h·ªçc sinh).\n- M·ªëi quan h·ªá ·ªü ƒë√¢y l√† s·ªü h·ªØu: H·ªçc sinh 'c·ªßa' gi√°o vi√™n ƒë√≥ -> C·∫ßn d√πng ƒë·∫°i t·ª´ quan h·ªá ch·ªâ s·ªü h·ªØu 'whose'."
            },
            {
              "questionNumber": 3,
              "question": "33. Let‚Äôs visit a museum ______ most famous paintings are displayed.",
              "answerOptions": [
                { "text": "whom", "isCorrect": false, "id": "A" },
                { "text": "whose", "isCorrect": false, "id": "B" },
                { "text": "where", "isCorrect": true, "id": "C" },
                { "text": "which", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. whom (ƒë·∫°i t·ª´ quan h·ªá): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n- B. whose (ƒë·∫°i t·ª´ quan h·ªá): c·ªßa ai/c·ªßa c√°i g√¨.\n- C. where (tr·∫°ng t·ª´ quan h·ªá): n∆°i m√†.\n- D. which (ƒë·∫°i t·ª´ quan h·ªá): c√°i m√†.\n\n2. D·ªãch nghƒ©a: H√£y ƒëi thƒÉm m·ªôt b·∫£o t√†ng n∆°i m√† nh·ªØng b·ª©c tranh n·ªïi ti·∫øng nh·∫•t ƒë∆∞·ª£c tr∆∞ng b√†y.\n\n3. Gi·∫£i th√≠ch:\n- Danh t·ª´ 'museum' ch·ªâ ƒë·ªãa ƒëi·ªÉm.\n- V·∫ø sau 'most famous paintings are displayed' l√† m·ªôt h√†nh ƒë·ªông di·ªÖn ra T·∫†I ƒë·ªãa ƒëi·ªÉm ƒë√≥.\n- Where = In which (t·∫°i n∆°i m√†). -> Ch·ªçn 'where'."
            },
            {
              "questionNumber": 4,
              "question": "34. The man ______ house is located on the hill is very friendly.",
              "answerOptions": [
                { "text": "whose", "isCorrect": true, "id": "A" },
                { "text": "who", "isCorrect": false, "id": "B" },
                { "text": "which", "isCorrect": false, "id": "C" },
                { "text": "when", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. whose (ƒë·∫°i t·ª´ quan h·ªá): c·ªßa ai.\n- B. who (ƒë·∫°i t·ª´ quan h·ªá): ng∆∞·ªùi m√†.\n- C. which (ƒë·∫°i t·ª´ quan h·ªá): c√°i m√†.\n- D. when (tr·∫°ng t·ª´ quan h·ªá): khi m√†.\n\n2. D·ªãch nghƒ©a: Ng∆∞·ªùi ƒë√†n √¥ng m√† c√≥ ng√¥i nh√† n·∫±m tr√™n ƒë·ªìi th√¨ r·∫•t th√¢n thi·ªán.\n\n3. Gi·∫£i th√≠ch:\n- 'The man' (ng∆∞·ªùi) v√† 'house' (v·∫≠t).\n- Ng√¥i nh√† thu·ªôc s·ªü h·ªØu c·ªßa ng∆∞·ªùi ƒë√†n √¥ng -> D√πng 'whose' ƒë·ªÉ ch·ªâ s·ªü h·ªØu."
            },
            {
              "questionNumber": 5,
              "question": "35. The countries ______ speak English as a first language are a minority.",
              "answerOptions": [
                { "text": "that", "isCorrect": false, "id": "A" },
                { "text": "who", "isCorrect": false, "id": "B" },
                { "text": "which", "isCorrect": true, "id": "C" },
                { "text": "where", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. that (ƒë·∫°i t·ª´ quan h·ªá): c√°i m√†/ng∆∞·ªùi m√†.\n- B. who (ƒë·∫°i t·ª´ quan h·ªá): ng∆∞·ªùi m√†.\n- C. which (ƒë·∫°i t·ª´ quan h·ªá): c√°i m√†.\n- D. where (tr·∫°ng t·ª´ quan h·ªá): n∆°i m√†.\n\n2. D·ªãch nghƒ©a: Nh·ªØng qu·ªëc gia n√≥i Ti·∫øng Anh nh∆∞ ng√¥n ng·ªØ m·∫π ƒë·∫ª l√† thi·ªÉu s·ªë.\n\n3. Gi·∫£i th√≠ch:\n- 'Countries' l√† danh t·ª´ ch·ªâ v·∫≠t (qu·ªëc gia).\n- ƒê·ªông t·ª´ theo sau l√† 'speak' (n√≥i), n√™n c·∫ßn ƒë·∫°i t·ª´ quan h·ªá ƒë√≥ng vai tr√≤ ch·ªß ng·ªØ.\n- 'Which' l√† ƒë·∫°i t·ª´ quan h·ªá d√πng cho v·∫≠t l√†m ch·ªß ng·ªØ (ƒë√°p √°n C ∆∞u ti√™n h∆°n that trong tr·∫Øc nghi·ªám chuy√™n s√¢u)."
            },
            {
              "questionNumber": 6,
              "question": "36. All the students ______ participated in the exchange program improved their English skills.",
              "answerOptions": [
                { "text": "when", "isCorrect": false, "id": "A" },
                { "text": "whom", "isCorrect": false, "id": "B" },
                { "text": "that", "isCorrect": true, "id": "C" },
                { "text": "whose", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. when (tr·∫°ng t·ª´): khi m√†.\n- B. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n- C. that (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†/c√°i m√†.\n- D. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n\n2. D·ªãch nghƒ©a: T·∫•t c·∫£ nh·ªØng h·ªçc sinh tham gia ch∆∞∆°ng tr√¨nh trao ƒë·ªïi ƒë√£ c·∫£i thi·ªán k·ªπ nƒÉng Ti·∫øng Anh.\n\n3. Gi·∫£i th√≠ch:\n- 'Students' l√† danh t·ª´ ch·ªâ ng∆∞·ªùi.\n- C·∫ßn m·ªôt ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'participated'.\n- Trong c√°c ƒë√°p √°n, 'who' kh√¥ng c√≥, n√™n 'that' l√† l·ª±a ch·ªçn ƒë√∫ng nh·∫•t. Ngo√†i ra, sau l∆∞·ª£ng t·ª´ 'All', ng∆∞·ªùi ta ∆∞u ti√™n d√πng 'that'."
            },
            {
              "questionNumber": 7,
              "question": "37. The biggest challenge ______ English learners face is pronunciation.",
              "answerOptions": [
                { "text": "which", "isCorrect": false, "id": "A" },
                { "text": "whose", "isCorrect": false, "id": "B" },
                { "text": "that", "isCorrect": true, "id": "C" },
                { "text": "who", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. which (ƒë·∫°i t·ª´): c√°i m√†.\n- B. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- C. that (ƒë·∫°i t·ª´): c√°i m√†.\n- D. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n\n2. D·ªãch nghƒ©a: Th·ª≠ th√°ch l·ªõn nh·∫•t m√† ng∆∞·ªùi h·ªçc Ti·∫øng Anh ph·∫£i ƒë·ªëi m·∫∑t l√† ph√°t √¢m.\n\n3. Gi·∫£i th√≠ch:\n- Danh t·ª´ 'challenge' ƒëi k√®m v·ªõi so s√°nh nh·∫•t 'The biggest'.\n- Quy t·∫Øc: Sau so s√°nh nh·∫•t (superlatives), d√πng 'that' thay v√¨ 'which' ho·∫∑c 'who'."
            },
            {
              "questionNumber": 8,
              "question": "38. Some of the reasons ______ people learn English are for work or travel.",
              "answerOptions": [
                { "text": "where", "isCorrect": false, "id": "A" },
                { "text": "which", "isCorrect": false, "id": "B" },
                { "text": "when", "isCorrect": false, "id": "C" },
                { "text": "why", "isCorrect": true, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. where (tr·∫°ng t·ª´): n∆°i m√†.\n- B. which (ƒë·∫°i t·ª´): c√°i m√†.\n- C. when (tr·∫°ng t·ª´): khi m√†.\n- D. why (tr·∫°ng t·ª´): t·∫°i sao.\n\n2. D·ªãch nghƒ©a: M·ªôt v√†i l√Ω do t·∫°i sao m·ªçi ng∆∞·ªùi h·ªçc Ti·∫øng Anh l√† v√¨ c√¥ng vi·ªác ho·∫∑c du l·ªãch.\n\n3. Gi·∫£i th√≠ch:\n- Danh t·ª´ 'reasons' (l√Ω do) lu√¥n ƒëi v·ªõi tr·∫°ng t·ª´ quan h·ªá 'why' (ho·∫∑c 'for which').\n- C·ª•m 'the reasons why' (l√Ω do t·∫°i sao) l√† c·ª•m c·ªë ƒë·ªãnh."
            },
            {
              "questionNumber": 9,
              "question": "39. He‚Äôs the guy ______ helped me learn Italian as a second language.",
              "answerOptions": [
                { "text": "what", "isCorrect": false, "id": "A" },
                { "text": "whom", "isCorrect": false, "id": "B" },
                { "text": "who", "isCorrect": true, "id": "C" },
                { "text": "whose", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. what (t·ª´ ƒë·ªÉ h·ªèi/quan h·ªá): c√°i g√¨.\n- B. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n- C. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√† (ch·ªß ng·ªØ).\n- D. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n\n2. D·ªãch nghƒ©a: Anh ·∫•y l√† ch√†ng trai ng∆∞·ªùi m√† ƒë√£ gi√∫p t√¥i h·ªçc ti·∫øng √ù nh∆∞ ng√¥n ng·ªØ th·ª© hai.\n\n3. Gi·∫£i th√≠ch:\n- 'The guy' l√† danh t·ª´ ch·ªâ ng∆∞·ªùi.\n- ƒê·ªông t·ª´ 'helped' c·∫ßn m·ªôt ch·ªß ng·ªØ.\n- 'Who' l√† ƒë·∫°i t·ª´ quan h·ªá ch·ªâ ng∆∞·ªùi l√†m ch·ªß ng·ªØ."
            },
            {
              "questionNumber": 10,
              "question": "40. He was wearing the same suit _____ he‚Äôd worn to the party.",
              "answerOptions": [
                { "text": "that", "isCorrect": true, "id": "A" },
                { "text": "whom", "isCorrect": false, "id": "B" },
                { "text": "whose", "isCorrect": false, "id": "C" },
                { "text": "what", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. that (ƒë·∫°i t·ª´): c√°i m√†.\n- B. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- C. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- D. what (t·ª´ ƒë·ªÉ h·ªèi): c√°i g√¨.\n\n2. D·ªãch nghƒ©a: Anh ·∫•y ƒëang m·∫∑c b·ªô vest gi·ªëng h·ªát b·ªô m√† anh ·∫•y ƒë√£ m·∫∑c t·ªõi b·ªØa ti·ªác.\n\n3. Gi·∫£i th√≠ch:\n- C·ª•m t·ª´ 'the same' (gi·ªëng h·ªát) ƒëi tr∆∞·ªõc danh t·ª´.\n- Quy t·∫Øc: Sau 'the same', 'the only', 'the first/last'..., ta ∆∞u ti√™n d√πng 'that' l√†m ƒë·∫°i t·ª´ quan h·ªá."
            },
            {
              "questionNumber": 11,
              "question": "41. We need more resources ______ can help students learn English effectively.",
              "answerOptions": [
                { "text": "whom", "isCorrect": false, "id": "A" },
                { "text": "whose", "isCorrect": false, "id": "B" },
                { "text": "where", "isCorrect": false, "id": "C" },
                { "text": "which", "isCorrect": true, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- B. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- C. where (tr·∫°ng t·ª´): n∆°i m√†.\n- D. which (ƒë·∫°i t·ª´): c√°i m√†.\n\n2. D·ªãch nghƒ©a: Ch√∫ng ta c·∫ßn nhi·ªÅu t√†i nguy√™n c√°i m√† c√≥ th·ªÉ gi√∫p h·ªçc sinh h·ªçc Ti·∫øng Anh hi·ªáu qu·∫£.\n\n3. Gi·∫£i th√≠ch:\n- 'Resources' l√† danh t·ª´ ch·ªâ v·∫≠t.\n- C·∫ßn ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'can help'.\n- 'Which' d√πng cho v·∫≠t l√†m ch·ªß ng·ªØ."
            },
            {
              "questionNumber": 12,
              "question": "42. The car ______ I bought yesterday is red.",
              "answerOptions": [
                { "text": "who", "isCorrect": false, "id": "A" },
                { "text": "whom", "isCorrect": false, "id": "B" },
                { "text": "whose", "isCorrect": false, "id": "C" },
                { "text": "which", "isCorrect": true, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- B. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- C. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- D. which (ƒë·∫°i t·ª´): c√°i m√†.\n\n2. D·ªãch nghƒ©a: Chi·∫øc xe √¥ t√¥ c√°i m√† t√¥i mua h√¥m qua th√¨ m√†u ƒë·ªè.\n\n3. Gi·∫£i th√≠ch:\n- 'The car' l√† danh t·ª´ ch·ªâ v·∫≠t.\n- ƒê√≥ng vai tr√≤ t√¢n ng·ªØ cho 'bought'.\n- 'Which' d√πng cho v·∫≠t."
            },
            {
              "questionNumber": 13,
              "question": "43. Ms. Janet is one of the teachers ______ help me to practice speaking English.",
              "answerOptions": [
                { "text": "who", "isCorrect": true, "id": "A" },
                { "text": "whom", "isCorrect": false, "id": "B" },
                { "text": "whose", "isCorrect": false, "id": "C" },
                { "text": "with whom", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√† (ch·ªß ng·ªØ).\n- B. whom (ƒë·∫°i t·ª´): ng∆∞·ªùi m√† (t√¢n ng·ªØ).\n- C. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- D. with whom (c·ª•m gi·ªõi t·ª´): v·ªõi ng∆∞·ªùi m√†.\n\n2. D·ªãch nghƒ©a: C√¥ Janet l√† m·ªôt trong nh·ªØng gi√°o vi√™n ng∆∞·ªùi m√† gi√∫p t√¥i luy·ªán n√≥i Ti·∫øng Anh.\n\n3. Gi·∫£i th√≠ch:\n- 'Teachers' l√† danh t·ª´ ch·ªâ ng∆∞·ªùi.\n- ƒê·ªông t·ª´ 'help' c·∫ßn ch·ªß ng·ªØ.\n- 'Who' l√† ƒë·∫°i t·ª´ quan h·ªá ch·ªâ ng∆∞·ªùi l√†m ch·ªß ng·ªØ."
            },
            {
              "questionNumber": 14,
              "question": "44. The publishing company _____ introduced many English books had recently been renovated.",
              "answerOptions": [
                { "text": "what", "isCorrect": false, "id": "A" },
                { "text": "who", "isCorrect": false, "id": "B" },
                { "text": "which", "isCorrect": true, "id": "C" },
                { "text": "where", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. what (t·ª´ ƒë·ªÉ h·ªèi): c√°i g√¨.\n- B. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- C. which (ƒë·∫°i t·ª´): c√°i m√†.\n- D. where (tr·∫°ng t·ª´): n∆°i m√†.\n\n2. D·ªãch nghƒ©a: C√¥ng ty xu·∫•t b·∫£n c√°i m√† ƒë√£ gi·ªõi thi·ªáu nhi·ªÅu s√°ch Ti·∫øng Anh v·ª´a m·ªõi ƒë∆∞·ª£c c·∫£i t·∫°o g·∫ßn ƒë√¢y.\n\n3. Gi·∫£i th√≠ch:\n- 'The publishing company' l√† danh t·ª´ ch·ªâ v·∫≠t.\n- C·∫ßn ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'introduced'.\n- 'Which' l√† ƒë√°p √°n ƒë√∫ng."
            },
            {
              "questionNumber": 15,
              "question": "45. The book ______ I am reading is very interesting.",
              "answerOptions": [
                { "text": "who", "isCorrect": false, "id": "A" },
                { "text": "whose", "isCorrect": false, "id": "B" },
                { "text": "which", "isCorrect": true, "id": "C" },
                { "text": "when", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- B. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- C. which (ƒë·∫°i t·ª´): c√°i m√†.\n- D. when (tr·∫°ng t·ª´): khi m√†.\n\n2. D·ªãch nghƒ©a: Cu·ªën s√°ch m√† t√¥i ƒëang ƒë·ªçc r·∫•t th√∫ v·ªã.\n\n3. Gi·∫£i th√≠ch:\n- 'The book' l√† v·∫≠t.\n- 'Which' l√† ƒë·∫°i t·ª´ quan h·ªá ch·ªâ v·∫≠t (l√†m t√¢n ng·ªØ cho 'reading')."
            },
            {
              "questionNumber": 16,
              "question": "46. The person ______ won the award is my sister.",
              "answerOptions": [
                { "text": "why", "isCorrect": false, "id": "A" },
                { "text": "whose", "isCorrect": false, "id": "B" },
                { "text": "who", "isCorrect": true, "id": "C" },
                { "text": "which", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. why (tr·∫°ng t·ª´): t·∫°i sao.\n- B. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- C. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- D. which (ƒë·∫°i t·ª´): c√°i m√†.\n\n2. D·ªãch nghƒ©a: Ng∆∞·ªùi ƒë√£ gi√†nh gi·∫£i th∆∞·ªüng l√† ch·ªã g√°i t√¥i.\n\n3. Gi·∫£i th√≠ch:\n- 'The person' l√† ng∆∞·ªùi.\n- C·∫ßn ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'won'.\n- 'Who' l√† ƒë√°p √°n ƒë√∫ng."
            },
            {
              "questionNumber": 17,
              "question": "47. There‚Äôs nothing ______ can‚Äôt be achieved with hard work and practice.",
              "answerOptions": [
                { "text": "of which", "isCorrect": false, "id": "A" },
                { "text": "that", "isCorrect": true, "id": "B" },
                { "text": "who", "isCorrect": false, "id": "C" },
                { "text": "which", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. of which (c·ª•m ƒë·∫°i t·ª´): c·ªßa c√°i m√†.\n- B. that (ƒë·∫°i t·ª´): c√°i m√†.\n- C. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- D. which (ƒë·∫°i t·ª´): c√°i m√†.\n\n2. D·ªãch nghƒ©a: Kh√¥ng c√≥ g√¨ l√† kh√¥ng th·ªÉ ƒë·∫°t ƒë∆∞·ª£c v·ªõi s·ª± chƒÉm ch·ªâ v√† luy·ªán t·∫≠p.\n\n3. Gi·∫£i th√≠ch:\n- 'Nothing' l√† ƒë·∫°i t·ª´ b·∫•t ƒë·ªãnh.\n- Quy t·∫Øc: Sau c√°c ƒë·∫°i t·ª´ b·∫•t ƒë·ªãnh nh∆∞ 'everything', 'nothing', 'anything', 'all', b·∫Øt bu·ªôc (ho·∫∑c ∆∞u ti√™n tuy·ªát ƒë·ªëi) d√πng 'that'."
            },
            {
              "questionNumber": 18,
              "question": "48. That‚Äôs the woman _____ husband works as our company‚Äôs interpreter.",
              "answerOptions": [
                { "text": "who", "isCorrect": false, "id": "A" },
                { "text": "what", "isCorrect": false, "id": "B" },
                { "text": "whose", "isCorrect": true, "id": "C" },
                { "text": "how", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n- B. what (t·ª´ ƒë·ªÉ h·ªèi): c√°i g√¨.\n- C. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- D. how (tr·∫°ng t·ª´): nh∆∞ th·∫ø n√†o.\n\n2. D·ªãch nghƒ©a: ƒê√≥ l√† ng∆∞·ªùi ph·ª• n·ªØ m√† ch·ªìng c·ªßa c√¥ ·∫•y l√†m th√¥ng d·ªãch vi√™n cho c√¥ng ty ch√∫ng t√¥i.\n\n3. Gi·∫£i th√≠ch:\n- 'The woman' (ng∆∞·ªùi) v√† 'husband' (ch·ªìng).\n- M·ªëi quan h·ªá v·ª£ ch·ªìng (s·ªü h·ªØu) -> Ch·ªìng 'c·ªßa' ng∆∞·ªùi ph·ª• n·ªØ ƒë√≥.\n- D√πng 'whose'."
            },
            {
              "questionNumber": 19,
              "question": "49. There‚Äôs nothing ______ I can‚Äôt do with a good dictionary by my side.",
              "answerOptions": [
                { "text": "whose", "isCorrect": false, "id": "A" },
                { "text": "that", "isCorrect": true, "id": "B" },
                { "text": "which", "isCorrect": false, "id": "C" },
                { "text": "who", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- B. that (ƒë·∫°i t·ª´): c√°i m√†.\n- C. which (ƒë·∫°i t·ª´): c√°i m√†.\n- D. who (ƒë·∫°i t·ª´): ng∆∞·ªùi m√†.\n\n2. D·ªãch nghƒ©a: Kh√¥ng c√≥ g√¨ m√† t√¥i kh√¥ng th·ªÉ l√†m ƒë∆∞·ª£c v·ªõi m·ªôt cu·ªën t·ª´ ƒëi·ªÉn t·ªët b√™n c·∫°nh.\n\n3. Gi·∫£i th√≠ch:\n- T∆∞∆°ng t·ª± c√¢u 47, 'nothing' l√† ƒë·∫°i t·ª´ b·∫•t ƒë·ªãnh.\n- Quy t·∫Øc: Sau 'nothing' b·∫Øt bu·ªôc/∆∞u ti√™n d√πng 'that'."
            },
            {
              "questionNumber": 20,
              "question": "50. The internet platform on ______ I learned English is fantastic.",
              "answerOptions": [
                { "text": "which", "isCorrect": true, "id": "A" },
                { "text": "that", "isCorrect": false, "id": "B" },
                { "text": "where", "isCorrect": false, "id": "C" },
                { "text": "whose", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. which (ƒë·∫°i t·ª´): c√°i m√†.\n- B. that (ƒë·∫°i t·ª´): c√°i m√†.\n- C. where (tr·∫°ng t·ª´): n∆°i m√†.\n- D. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n\n2. D·ªãch nghƒ©a: N·ªÅn t·∫£ng internet m√† tr√™n ƒë√≥ t√¥i h·ªçc Ti·∫øng Anh th√¨ th·∫≠t tuy·ªát v·ªùi.\n\n3. Gi·∫£i th√≠ch:\n- C√≥ gi·ªõi t·ª´ 'on' ƒë·ª©ng tr∆∞·ªõc.\n- Quy t·∫Øc: Sau gi·ªõi t·ª´ ch·ªâ c√≥ th·ªÉ d√πng 'which' (cho v·∫≠t) ho·∫∑c 'whom' (cho ng∆∞·ªùi). Kh√¥ng bao gi·ªù d√πng 'that' ho·∫∑c 'where' ngay sau gi·ªõi t·ª´.\n- 'Platform' l√† v·∫≠t -> D√πng 'on which'."
            },
            {
              "questionNumber": 21,
              "question": "51. The language center _____ we learn English is next to the park.",
              "answerOptions": [
                { "text": "where", "isCorrect": true, "id": "A" },
                { "text": "that", "isCorrect": false, "id": "B" },
                { "text": "whose", "isCorrect": false, "id": "C" },
                { "text": "what", "isCorrect": false, "id": "D" }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- A. that (ƒë·∫°i t·ª´): c√°i m√†.\n- B. where (tr·∫°ng t·ª´): n∆°i m√†.\n- C. whose (ƒë·∫°i t·ª´): c·ªßa ai.\n- D. what (t·ª´ ƒë·ªÉ h·ªèi): c√°i g√¨.\n\n2. D·ªãch nghƒ©a: Trung t√¢m ng√¥n ng·ªØ n∆°i ch√∫ng t√¥i h·ªçc Ti·∫øng Anh th√¨ n·∫±m c·∫°nh c√¥ng vi√™n.\n\n3. Gi·∫£i th√≠ch:\n- 'Language center' l√† danh t·ª´ ch·ªâ n∆°i ch·ªën.\n- M·ªánh ƒë·ªÅ sau 'we learn English' l√† h√†nh ƒë·ªông di·ªÖn ra T·∫†I n∆°i ƒë√≥ v√† ƒë√£ ƒë·∫ßy ƒë·ªß ch·ªß ng·ªØ - ƒë·ªông t·ª´.\n- D√πng 'where' (t∆∞∆°ng ƒë∆∞∆°ng 'at which')."
            }
          ]
        };

        // --- GAME STATE ---
        let questions = [...rawData.questions];
        let score = 0;
        let answeredCount = 0;
        const totalQuestions = questions.length;

        // --- SHUFFLE FUNCTION (Fisher-Yates) ---
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // Initialize Quiz
        function initQuiz() {
            // Shuffle questions
            questions = shuffle(questions);
            
            // Update counts
            document.getElementById('total-questions').textContent = totalQuestions;
            
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            questions.forEach((q, index) => {
                // Clone options and assign original label based on index (A, B, C, D) before shuffling
                let currentOptions = q.answerOptions.map((opt, originalIndex) => ({
                    ...opt,
                    originalLabel: String.fromCharCode(65 + originalIndex) // 'A' + 0 = 'A', 'A' + 1 = 'B'
                }));
                
                // Shuffle the options
                currentOptions = shuffle(currentOptions);

                const card = document.createElement('div');
                card.className = 'quiz-card';
                card.innerHTML = `
                    <div class="question-number">C√¢u ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid" id="options-${index}">
                        ${currentOptions.map((opt) => {
                            return `
                                <button class="option-btn" 
                                    onclick="checkAnswer(this, ${opt.isCorrect}, ${index})" 
                                    data-index="${index}"
                                    data-is-correct="${opt.isCorrect}">
                                    <div class="option-circle">${opt.originalLabel}</div>
                                    ${opt.text}
                                </button>
                            `;
                        }).join('')}
                    </div>
                    <div class="explanation-box" id="exp-${index}">
                        <div class="exp-header">
                            <i class="fas fa-lightbulb"></i> Ms Mai An gi·∫£i th√≠ch chi ti·∫øt:
                        </div>
                        <div class="exp-content">${q.rationale}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Check Answer Function
        function checkAnswer(btn, isCorrect, questionIndex) {
            const parentGrid = document.getElementById(`options-${questionIndex}`);
            const buttons = parentGrid.querySelectorAll('.option-btn');
            
            // Disable all buttons in this question
            buttons.forEach(b => b.disabled = true);

            if (isCorrect) {
                // Handle Correct
                btn.classList.add('correct');
                score++;
                playSound('correct');
                
                // Confetti Effect
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#00D26A', '#8854C0', '#00C9A7']
                });
            } else {
                // Handle Wrong
                btn.classList.add('wrong');
                btn.classList.add('shake');
                playSound('wrong');
                
                // Highlight the correct answer automatically by checking the data attribute
                const correctButton = Array.from(buttons).find(b => b.getAttribute('data-is-correct') === 'true');
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }

            // Update Score
            answeredCount++;
            document.getElementById('current-score').textContent = score;

            // Show Explanation
            const expBox = document.getElementById(`exp-${questionIndex}`);
            expBox.classList.add('show');
        }

        // Finish Quiz
        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const finalScoreEl = document.getElementById('final-score-display');
            const cheerMsg = document.getElementById('cheer-msg');

            finalScoreEl.textContent = `${score}/${totalQuestions}`;

            // Generate cheer message
            const percentage = (score / totalQuestions) * 100;
            if (percentage === 100) {
                cheerMsg.textContent = "Xu·∫•t s·∫Øc! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em! üåü";
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (percentage >= 80) {
                cheerMsg.textContent = "L√†m t·ªët l·∫Øm! C·ªë g·∫Øng gi·ªØ phong ƒë·ªô nh√©! üî•";
            } else if (percentage >= 50) {
                cheerMsg.textContent = "Kh√° t·ªët! √în l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu s√¢u h∆°n nh√©. üí™";
            } else {
                cheerMsg.textContent = "ƒê·ª´ng bu·ªìn nh√©! H√£y ƒë·ªçc k·ªπ gi·∫£i th√≠ch v√† th·ª≠ l·∫°i n√†o. üå±";
            }

            modal.classList.add('active');
            playSound('correct'); // Positive sound at end
        }

        // Start
        window.onload = initQuiz;

    </script>
</body>
</html>
