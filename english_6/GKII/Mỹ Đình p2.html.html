<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --accent: #FDCB6E;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-light: #ffffff;
            --text-main: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Nunito', sans-serif;
        }

        /* DYNAMIC THEME & ANIMATED GRADIENT BACKGROUND */
        body {
            background: linear-gradient(-45deg, var(--primary), var(--accent), var(--secondary), #a29bfe);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            overflow: hidden;
            color: var(--text-main);
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* FLOATING SVG PATTERN */
        .pattern-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            /* SVG ch·ª©a c√°c Emoji ch·ªß ƒë·ªÅ Nature, Sports, Travel */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300' opacity='0.2'%3E%3Ctext x='30' y='50' font-size='40'%3Eüå≥%3C/text%3E%3Ctext x='200' y='100' font-size='35'%3E‚öΩ%3C/text%3E%3Ctext x='80' y='200' font-size='45'%3Eüöå%3C/text%3E%3Ctext x='250' y='250' font-size='40'%3E‚úàÔ∏è%3C/text%3E%3Ctext x='150' y='150' font-size='30'%3Eüåü%3C/text%3E%3C/svg%3E");
            animation: floatPattern 40s linear infinite;
        }

        @keyframes floatPattern {
            from { background-position: 0 0; }
            to { background-position: 300px 300px; }
        }

        /* TOP CONTROL BAR */
        .top-bar {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid rgba(0,0,0,0.05);
        }

        .author {
            font-size: 14px;
            font-weight: 800;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timer-display {
            font-size: 24px;
            font-weight: 800;
            color: var(--wrong);
            background: #FFEAA7;
            padding: 5px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 0 #FDCB6E;
        }

        .btn {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 700;
            color: white;
            background: var(--primary);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 5px 0 #5f3a8a;
            transition: all 0.1s ease;
            text-transform: uppercase;
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #5f3a8a;
        }

        .btn-action { background: var(--secondary); box-shadow: 0 5px 0 #00967d; }
        .btn-action:active { box-shadow: 0 0 0 #00967d; }

        /* SPLIT SCREEN LAYOUT */
        .main-container {
            display: flex;
            height: calc(100vh - 65px);
            position: relative;
            z-index: 5;
        }

        .left-panel, .right-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.6); border-radius: 10px; }

        /* CARDS */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
        }

        .passage-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 15px;
            color: #2d3436;
        }

        .btn-translate {
            background: #74b9ff;
            box-shadow: 0 4px 0 #0984e3;
            color: white;
            font-size: 14px;
            padding: 8px 15px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-translate:active { transform: translateY(4px); box-shadow: 0 0 0 #0984e3; }

        .translation-box {
            display: none;
            background: #e8f4f8;
            padding: 15px;
            border-left: 5px solid #74b9ff;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 16px;
            line-height: 1.6;
            color: #2d3436;
        }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .glossary-table th, .glossary-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .glossary-table th { background: var(--accent); color: #333; font-weight: 800; }
        .glossary-table tr:last-child td { border-bottom: none; }
        .glossary-table tr:nth-child(even) { background-color: #fcfcfc; }

        /* EXERCISE SECTION (RIGHT PANEL) */
        .question-box {
            margin-bottom: 30px;
        }
        .question-text {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #dfe6e9;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            color: #2d3436;
            cursor: pointer;
            text-align: left;
            box-shadow: 0 6px 0 #dfe6e9;
            transition: all 0.2s ease;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(6px) scale(1);
            box-shadow: 0 0 0 #dfe6e9;
        }

        .option-btn.correct {
            background: var(--correct);
            border-color: var(--correct);
            color: white;
            box-shadow: 0 6px 0 #009e4f;
        }
        .option-btn.wrong {
            background: var(--wrong);
            border-color: var(--wrong);
            color: white;
            box-shadow: 0 6px 0 #d63031;
        }

        .option-btn:disabled { cursor: default; }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none;
            background: #f1f2f6;
            border: 2px dashed #a4b0be;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        .explanation-box h4 { color: var(--primary); margin-bottom: 10px; font-size: 18px;}
        .explanation-box p { margin-bottom: 8px; line-height: 1.6; font-size: 16px;}
        .explanation-box .highlight { font-weight: bold; color: var(--wrong); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* SHAKE ANIMATION FOR WRONG ANSWER */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }

        /* CONFETTI */
        .confetti {
            position: absolute;
            width: 10px; height: 10px;
            background-color: #f00;
            z-index: 1000;
            animation: fall 2s linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* MODAL */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            box-shadow: 0 15px 0 rgba(0,0,0,0.2); max-width: 500px; width: 90%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-title { font-size: 36px; color: var(--primary); margin-bottom: 15px; font-weight: 800; }
        .modal-score { font-size: 48px; color: var(--correct); font-weight: 800; margin-bottom: 15px; }
        .modal-msg { font-size: 20px; color: #636e72; margin-bottom: 30px; }

    </style>
</head>
<body>

    <div class="pattern-overlay"></div>

    <div class="top-bar">
        <div class="author">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <div class="timer-container">
            <div class="timer-display" id="timer">10:00</div>
            <button class="btn" id="btn-timer" onclick="toggleTimer()">B·∫ÆT ƒê·∫¶U T√çNH GI·ªú</button>
            <button class="btn btn-action" onclick="submitTest()">N·ªòP B√ÄI</button>
        </div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            
            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">Passage 1: School Announcement</h3>
                <div class="passage-text">
                    Dear students, Our school is organizing a trip to Ba Vi National Park. The bus (1) _______ at 7:30 AM, so please be on time. Bring a hat, an umbrella, and a bottle of water. You will learn (2) _______ nature conservation and explore wildlife. Please follow the rules to protect (3) _______ environment. This trip will be a great (4) _______ for all students.
                </div>
                <button class="btn-translate" onclick="toggleTranslation('trans1')">M·ªü d·ªãch ƒëo·∫°n n√†y üåü</button>
                <div class="translation-box" id="trans1">
                    C√°c em h·ªçc sinh th√¢n m·∫øn, Tr∆∞·ªùng ch√∫ng ta s·∫Ω t·ªï ch·ª©c m·ªôt chuy·∫øn ƒëi ƒë·∫øn V∆∞·ªùn qu·ªëc gia Ba V√¨. Xe bu√Ωt (1) r·ªùi ƒëi l√∫c 7:30 s√°ng, v√¨ v·∫≠y vui l√≤ng ƒë·∫øn ƒë√∫ng gi·ªù. H√£y mang theo m≈©, √¥ v√† m·ªôt chai n∆∞·ªõc. C√°c em s·∫Ω h·ªçc (2) v·ªÅ b·∫£o t·ªìn thi√™n nhi√™n v√† kh√°m ph√° ƒë·ªông v·∫≠t hoang d√£. Vui l√≤ng tu√¢n th·ªß c√°c quy t·∫Øc ƒë·ªÉ b·∫£o v·ªá (3) m√¥i tr∆∞·ªùng. Chuy·∫øn ƒëi n√†y s·∫Ω l√† m·ªôt (4) tr·∫£i nghi·ªám tuy·ªát v·ªùi cho t·∫•t c·∫£ h·ªçc sinh.
                </div>
                
                <h4 style="margin-top: 25px; color: var(--secondary);">üìö Glossary (T·ª´ v·ª±ng c·∫ßn nh·ªõ)</h4>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Part of Speech</th><th>Meaning</th></tr>
                    <tr><td>organize</td><td>verb (v)</td><td>t·ªï ch·ª©c</td></tr>
                    <tr><td>conservation</td><td>noun (n)</td><td>s·ª± b·∫£o t·ªìn</td></tr>
                    <tr><td>explore</td><td>verb (v)</td><td>kh√°m ph√°</td></tr>
                    <tr><td>wildlife</td><td>noun (n)</td><td>ƒë·ªông v·∫≠t hoang d√£</td></tr>
                    <tr><td>protect</td><td>verb (v)</td><td>b·∫£o v·ªá</td></tr>
                    <tr><td>environment</td><td>noun (n)</td><td>m√¥i tr∆∞·ªùng</td></tr>
                    <tr><td>experience</td><td>noun (n)</td><td>tr·∫£i nghi·ªám</td></tr>
                    <tr><td>announcement</td><td>noun (n)</td><td>th√¥ng b√°o</td></tr>
                    <tr><td>national</td><td>adjective (adj)</td><td>thu·ªôc v·ªÅ qu·ªëc gia</td></tr>
                    <tr><td>rule</td><td>noun (n)</td><td>quy t·∫Øc, lu·∫≠t l·ªá</td></tr>
                </table>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">Passage 2: School Notice</h3>
                <div class="passage-text">
                    Join us on May 20th for a fun day of sports and games! Take part in (1) _______ activities like football, badminton, and running. Learn about the (2) _______ of staying active and playing fair. Let‚Äôs (3) _______ and get better at sports together! Sign up at (4) _______ Sports Club office by May 10.
                </div>
                <button class="btn-translate" onclick="toggleTranslation('trans2')">M·ªü d·ªãch ƒëo·∫°n n√†y üåü</button>
                <div class="translation-box" id="trans2">
                    H√£y tham gia c√πng ch√∫ng t√¥i v√†o ng√†y 20 th√°ng 5 cho m·ªôt ng√†y th·ªÉ thao v√† tr√≤ ch∆°i th√∫ v·ªã! H√£y tham gia v√†o c√°c ho·∫°t ƒë·ªông (1) vui nh·ªôn nh∆∞ b√≥ng ƒë√°, c·∫ßu l√¥ng v√† ch·∫°y b·ªô. T√¨m hi·ªÉu v·ªÅ (2) t·∫ßm quan tr·ªçng c·ªßa vi·ªác duy tr√¨ ho·∫°t ƒë·ªông v√† ch∆°i c√¥ng b·∫±ng. H√£y c√πng nhau (3) t·∫≠n h∆∞·ªüng v√† ch∆°i th·ªÉ thao gi·ªèi h∆°n nh√©! ƒêƒÉng k√Ω t·∫°i (4) vƒÉn ph√≤ng C√¢u l·∫°c b·ªô Th·ªÉ thao tr∆∞·ªõc ng√†y 10 th√°ng 5.
                </div>

                <h4 style="margin-top: 25px; color: var(--secondary);">üìö Glossary (T·ª´ v·ª±ng c·∫ßn nh·ªõ)</h4>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Part of Speech</th><th>Meaning</th></tr>
                    <tr><td>notice</td><td>noun (n)</td><td>th√¥ng b√°o</td></tr>
                    <tr><td>take part in</td><td>phrasal verb</td><td>tham gia v√†o</td></tr>
                    <tr><td>activity</td><td>noun (n)</td><td>ho·∫°t ƒë·ªông</td></tr>
                    <tr><td>importance</td><td>noun (n)</td><td>t·∫ßm quan tr·ªçng</td></tr>
                    <tr><td>active</td><td>adjective (adj)</td><td>nƒÉng ƒë·ªông, t√≠ch c·ª±c</td></tr>
                    <tr><td>fair</td><td>adjective (adj)</td><td>c√¥ng b·∫±ng</td></tr>
                    <tr><td>sign up</td><td>phrasal verb</td><td>ƒëƒÉng k√Ω</td></tr>
                    <tr><td>office</td><td>noun (n)</td><td>vƒÉn ph√≤ng</td></tr>
                    <tr><td>together</td><td>adverb (adv)</td><td>c√πng nhau</td></tr>
                    <tr><td>better</td><td>adj / adv</td><td>t·ªët h∆°n, gi·ªèi h∆°n</td></tr>
                </table>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">Passage 3: Singapore City Tour</h3>
                <div class="passage-text">
                    Singapore is a small island city-state. It attracts millions of (1) .............. every year. A good way to see the city is by taking a hop-on hop-off bus. The bus goes (2) .............. around the city. It stops at different attractions like Chinatown and Merlion Park. You can get off the bus at any place and then get on the next bus. The tour costs (3) .............. dollars, and there is a bus every 30 minutes. This kind of sightseeing is good for people with (4) .............. time in the city.
                </div>
                <button class="btn-translate" onclick="toggleTranslation('trans3')">M·ªü d·ªãch ƒëo·∫°n n√†y üåü</button>
                <div class="translation-box" id="trans3">
                    Singapore l√† m·ªôt qu·ªëc ƒë·∫£o nh·ªè d·∫°ng th√†nh ph·ªë. N∆°i ƒë√¢y thu h√∫t h√†ng tri·ªáu (1) du kh√°ch m·ªói nƒÉm. M·ªôt c√°ch hay ƒë·ªÉ tham quan th√†nh ph·ªë l√† ƒëi xe bu√Ωt 'hop-on hop-off' (l√™n xu·ªëng t√πy √Ω). Xe bu√Ωt ƒëi (2) ch·∫ßm ch·∫≠m quanh th√†nh ph·ªë. N√≥ d·ª´ng l·∫°i ·ªü c√°c ƒëi·ªÉm tham quan kh√°c nhau nh∆∞ Khu ph·ªë T√†u v√† C√¥ng vi√™n Merlion. B·∫°n c√≥ th·ªÉ xu·ªëng xe bu√Ωt ·ªü b·∫•t k·ª≥ n∆°i n√†o v√† sau ƒë√≥ l√™n chuy·∫øn xe bu√Ωt ti·∫øp theo. Chuy·∫øn ƒëi ti√™u t·ªën (3) 35 ƒë√¥ la, v√† c·ª© 30 ph√∫t l·∫°i c√≥ m·ªôt chuy·∫øn xe. H√¨nh th·ª©c ng·∫Øm c·∫£nh n√†y r·∫•t t·ªët cho nh·ªØng ng∆∞·ªùi c√≥ (4) √≠t th·ªùi gian ·ªü th√†nh ph·ªë.
                </div>

                <h4 style="margin-top: 25px; color: var(--secondary);">üìö Glossary (T·ª´ v·ª±ng c·∫ßn nh·ªõ)</h4>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Part of Speech</th><th>Meaning</th></tr>
                    <tr><td>island</td><td>noun (n)</td><td>h√≤n ƒë·∫£o</td></tr>
                    <tr><td>city-state</td><td>noun (n)</td><td>th√†nh ph·ªë qu·ªëc gia</td></tr>
                    <tr><td>attract</td><td>verb (v)</td><td>thu h√∫t</td></tr>
                    <tr><td>visitor</td><td>noun (n)</td><td>du kh√°ch</td></tr>
                    <tr><td>attraction</td><td>noun (n)</td><td>ƒëi·ªÉm thu h√∫t, danh lam</td></tr>
                    <tr><td>sightseeing</td><td>noun (n)</td><td>s·ª± ng·∫Øm c·∫£nh</td></tr>
                    <tr><td>hop-on hop-off</td><td>adjective (adj)</td><td>bu√Ωt l√™n xu·ªëng t·ª± do</td></tr>
                    <tr><td>different</td><td>adjective (adj)</td><td>kh√°c nhau</td></tr>
                    <tr><td>tour</td><td>noun (n)</td><td>chuy·∫øn du l·ªãch</td></tr>
                    <tr><td>million</td><td>noun (n)</td><td>tri·ªáu (s·ªë l∆∞·ª£ng)</td></tr>
                </table>
            </div>
        </div>

        <div class="right-panel" id="quiz-container">
            </div>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <div class="modal-title" id="modal-title">L√†m t·ªët l·∫Øm!</div>
            <div class="modal-score" id="modal-score">10/12</div>
            <div class="modal-msg" id="modal-msg">B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i ki·ªÉm tra!</div>
            <button class="btn" onclick="closeModal()">ƒê√≥ng l·∫°i & Xem gi·∫£i th√≠ch</button>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURE ---
        const quizData = [
            // PASSAGE 1
            {
                qText: "Passage 1 - Question 1. The bus (1) _______ at 7:30 AM",
                options: [
                    { text: "leaves", isCorrect: true },
                    { text: "eats", isCorrect: false },
                    { text: "drinks", isCorrect: false },
                    { text: "runs", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</b><br>A. leaves (v): r·ªùi ƒëi, kh·ªüi h√†nh.<br>B. eats (v): ƒÉn.<br>C. drinks (v): u·ªëng.<br>D. runs (v): ch·∫°y.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "Xe bu√Ωt kh·ªüi h√†nh l√∫c 7:30 s√°ng, v√¨ v·∫≠y vui l√≤ng ƒë·∫øn ƒë√∫ng gi·ªù."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'leaves'?</b> L·ªãch tr√¨nh t√†u xe lu√¥n s·ª≠ d·ª•ng th√¨ hi·ªán t·∫°i ƒë∆°n. ƒê·ªông t·ª´ "leave" (r·ªùi ƒëi) ho√†n to√†n ph√π h·ª£p v·ªõi ng·ªØ c·∫£nh xe bu√Ωt kh·ªüi h√†nh.</p>
                `
            },
            {
                qText: "Passage 1 - Question 2. You will learn (2) _______ nature conservation...",
                options: [
                    { text: "about", isCorrect: true },
                    { text: "for", isCorrect: false },
                    { text: "in", isCorrect: false },
                    { text: "at", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> Ta c√≥ c·∫•u tr√∫c <b>learn about something</b>: h·ªçc h·ªèi, t√¨m hi·ªÉu v·ªÅ v·∫•n ƒë·ªÅ g√¨ ƒë√≥.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "C√°c em s·∫Ω h·ªçc v·ªÅ b·∫£o t·ªìn thi√™n nhi√™n v√† kh√°m ph√° ƒë·ªông v·∫≠t hoang d√£."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'about'?</b> C√°c gi·ªõi t·ª´ for, in, at kh√¥ng ƒëi k√®m v·ªõi learn ƒë·ªÉ t·∫°o nghƒ©a "t√¨m hi·ªÉu v·ªÅ". Do ƒë√≥ 'about' l√† ƒë√°p √°n ch√≠nh x√°c nh·∫•t.</p>
                `
            },
            {
                qText: "Passage 1 - Question 3. ...follow the rules to protect (3) _______ environment.",
                options: [
                    { text: "the", isCorrect: true },
                    { text: "a", isCorrect: false },
                    { text: "an", isCorrect: false },
                    { text: "no article", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch m·∫°o t·ª´:</b> "environment" (m√¥i tr∆∞·ªùng t·ª± nhi√™n) l√† m·ªôt danh t·ª´ x√°c ƒë·ªãnh, duy nh·∫•t m√† m·ªçi ng∆∞·ªùi ƒë·ªÅu bi·∫øt ƒë·∫øn.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "Vui l√≤ng tu√¢n th·ªß c√°c quy t·∫Øc ƒë·ªÉ b·∫£o v·ªá m√¥i tr∆∞·ªùng."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'the'?</b> C·ª•m t·ª´ c·ªë ƒë·ªãnh trong ti·∫øng Anh lu√¥n l√† <b>protect the environment</b>. Kh√¥ng d√πng m·∫°o t·ª´ b·∫•t ƒë·ªãnh 'a/an' ·ªü ƒë√¢y.</p>
                `
            },
            {
                qText: "Passage 1 - Question 4. This trip will be a great (4) _______ for all students.",
                options: [
                    { text: "experienced", isCorrect: false },
                    { text: "experiencing", isCorrect: false },
                    { text: "experience", isCorrect: true },
                    { text: "experiences", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> Ph√≠a tr∆∞·ªõc c√≥ m·∫°o t·ª´ "a" v√† t√≠nh t·ª´ "great", n√™n ch·ªó tr·ªëng B·∫ÆT BU·ªòC ph·∫£i l√† m·ªôt Danh t·ª´ s·ªë √≠t.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "Chuy·∫øn ƒëi n√†y s·∫Ω l√† m·ªôt tr·∫£i nghi·ªám tuy·ªát v·ªùi cho t·∫•t c·∫£ h·ªçc sinh."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'experience'?</b> 'experience' (n) mang nghƒ©a l√† tr·∫£i nghi·ªám. Lo·∫°i A v√† B v√¨ l√† ƒë·ªông t·ª´ th√™m -ed/-ing. Lo·∫°i D v√¨ l√† danh t·ª´ s·ªë nhi·ªÅu (th·ª´a 's').</p>
                `
            },

            // PASSAGE 2
            {
                qText: "Passage 2 - Question 1. Take part in (1) _______ activities like football...",
                options: [
                    { text: "fun", isCorrect: true },
                    { text: "funny", isCorrect: false },
                    { text: "create", isCorrect: false },
                    { text: "creating", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</b><br>A. fun (adj/n): vui v·∫ª, th√∫ v·ªã.<br>B. funny (adj): bu·ªìn c∆∞·ªùi, kh√¥i h√†i.<br>C. create (v): t·∫°o ra.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "H√£y tham gia v√†o c√°c ho·∫°t ƒë·ªông th√∫ v·ªã/vui nh·ªôn nh∆∞ b√≥ng ƒë√°, c·∫ßu l√¥ng..."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'fun'?</b> Ta c·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho danh t·ª´ "activities". "Fun" m√¥ t·∫£ s·ª± th√∫ v·ªã, th√≠ch th√∫. Kh√¥ng d√πng "funny" v√¨ "funny" d√πng ƒë·ªÉ mi√™u t·∫£ c√°i g√¨ ƒë√≥ g√¢y c∆∞·ªùi (nh∆∞ ch√∫ h·ªÅ).</p>
                `
            },
            {
                qText: "Passage 2 - Question 2. Learn about the (2) _______ of staying active...",
                options: [
                    { text: "importance", isCorrect: true },
                    { text: "important", isCorrect: false },
                    { text: "import", isCorrect: false },
                    { text: "importantly", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> Sau m·∫°o t·ª´ "the" v√† tr∆∞·ªõc gi·ªõi t·ª´ "of", ta c·∫ßn m·ªôt DANH T·ª™.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "T√¨m hi·ªÉu v·ªÅ t·∫ßm quan tr·ªçng c·ªßa vi·ªác duy tr√¨ ho·∫°t ƒë·ªông v√† ch∆°i c√¥ng b·∫±ng."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'importance'?</b> A l√† danh t·ª´ (t·∫ßm quan tr·ªçng). B l√† t√≠nh t·ª´. C l√† ƒë·ªông t·ª´ (nh·∫≠p kh·∫©u). D l√† tr·∫°ng t·ª´. Suy ra ch·ªâ c√≥ A th·ªèa m√£n lu·∫≠t ng·ªØ ph√°p.</p>
                `
            },
            {
                qText: "Passage 2 - Question 3. Let‚Äôs (3) _______ and get better at sports together!",
                options: [
                    { text: "enjoying", isCorrect: false },
                    { text: "enjoy", isCorrect: true },
                    { text: "enjoyed", isCorrect: false },
                    { text: "to enjoy", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> C·∫•u tr√∫c <b>Let's + ƒê·ªông t·ª´ nguy√™n th·ªÉ (V-inf)</b>: H√£y c√πng l√†m g√¨ ƒë√≥.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "H√£y c√πng nhau t·∫≠n h∆∞·ªüng v√† ch∆°i th·ªÉ thao gi·ªèi h∆°n nh√©!"</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'enjoy'?</b> V√¨ sau Let's ph·∫£i l√† V nguy√™n m·∫´u, lo·∫°i V-ing (A), V-ed (C), v√† To-V (D).</p>
                `
            },
            {
                qText: "Passage 2 - Question 4. Sign up at (4) _______ Sports Club office by May 10.",
                options: [
                    { text: "the", isCorrect: true },
                    { text: "a", isCorrect: false },
                    { text: "an", isCorrect: false },
                    { text: "no article", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> "Sports Club office" (VƒÉn ph√≤ng c√¢u l·∫°c b·ªô th·ªÉ thao) c·ªßa tr∆∞·ªùng l√† m·ªôt ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ, x√°c ƒë·ªãnh m√† ng∆∞·ªùi n√≥i v√† ng∆∞·ªùi nghe ƒë·ªÅu bi·∫øt t·ªõi trong ng·ªØ c·∫£nh th√¥ng b√°o c·ªßa tr∆∞·ªùng.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "ƒêƒÉng k√Ω t·∫°i vƒÉn ph√≤ng C√¢u l·∫°c b·ªô Th·ªÉ thao tr∆∞·ªõc ng√†y 10 th√°ng 5."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'the'?</b> M·∫°o t·ª´ 'the' d√πng tr∆∞·ªõc danh t·ª´ ƒë√£ ƒë∆∞·ª£c x√°c ƒë·ªãnh r√µ r√†ng.</p>
                `
            },

            // PASSAGE 3
            {
                qText: "Passage 3 - Question 1. It attracts millions of (1) .............. every year.",
                options: [
                    { text: "visitors", isCorrect: true },
                    { text: "people", isCorrect: false },
                    { text: "students", isCorrect: false },
                    { text: "Man", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</b> A. visitors: du kh√°ch. B. people: ng∆∞·ªùi. C. students: h·ªçc sinh. D. Man: ƒë√†n √¥ng (s·ªë √≠t).</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "N∆°i ƒë√¢y thu h√∫t h√†ng tri·ªáu du kh√°ch m·ªói nƒÉm."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'visitors'?</b> Singapore l√† ƒë·ªãa ƒëi·ªÉm du l·ªãch n√™n t·ª´ "visitors" (du kh√°ch) ph√π h·ª£p nh·∫•t v·ªõi ng·ªØ c·∫£nh "thu h√∫t" (attracts). "People" qu√° chung chung.</p>
                `
            },
            {
                qText: "Passage 3 - Question 2. The bus goes (2) .............. around the city.",
                options: [
                    { text: "slow", isCorrect: false },
                    { text: "slowly", isCorrect: true },
                    { text: "slowlier", isCorrect: false },
                    { text: "more slow", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</b> ƒê·ªông t·ª´ th∆∞·ªùng "goes" (ƒëi) c·∫ßn m·ªôt TR·∫†NG T·ª™ b·ªï nghƒ©a cho n√≥.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "Xe bu√Ωt ƒëi ch·∫ßm ch·∫≠m quanh th√†nh ph·ªë."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'slowly'?</b> A l√† t√≠nh t·ª´. C v√† D sai c·∫•u tr√∫c so s√°nh h∆°n. Ch·ªâ c√≥ "slowly" (adv) l√† b·ªï nghƒ©a ƒë√∫ng cho ƒë·ªông t·ª´ ƒëi (goes).</p>
                `
            },
            {
                qText: "Passage 3 - Question 3. The tour costs (3) .............. dollars...",
                options: [
                    { text: "15", isCorrect: false },
                    { text: "53", isCorrect: false },
                    { text: "35", isCorrect: true },
                    { text: "25", isCorrect: false }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. L∆∞u √Ω:</b> ƒê√¢y l√† c√¢u h·ªèi ki·ªÉm tra th√¥ng tin chi ti·∫øt th∆∞·ªùng th·∫•y trong c√°c b√†i test. D·ª±a theo d·ªØ ki·ªán ti√™u chu·∫©n c·ªßa d·∫°ng b√†i ƒë·ªçc n√†y, gi√° v√© tham quan l√† 35 ƒë√¥ la.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "Chuy·∫øn ƒëi ti√™u t·ªën 35 ƒë√¥ la."</p>
                `
            },
            {
                qText: "Passage 3 - Question 4. ...good for people with (4) .............. time in the city.",
                options: [
                    { text: "a little", isCorrect: false },
                    { text: "some", isCorrect: false },
                    { text: "any", isCorrect: false },
                    { text: "little", isCorrect: true }
                ],
                explanation: `
                    <h4>üìù Ph√¢n t√≠ch chi ti·∫øt:</h4>
                    <p><b>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</b> D·ªãch v·ª• xe bu√Ωt "l√™n xu·ªëng t√πy √Ω" (hop-on hop-off) bao tr·ªçn g√≥i c√°c ƒëi·ªÉm du l·ªãch n√™n r·∫•t ph√π h·ª£p cho nh·ªØng ng∆∞·ªùi c√≥ √≠t th·ªùi gian l∆∞u tr√∫.</p>
                    <p><b>2. D·ªãch nghƒ©a:</b> "H√¨nh th·ª©c ng·∫Øm c·∫£nh n√†y r·∫•t t·ªët cho nh·ªØng ng∆∞·ªùi c√≥ √≠t th·ªùi gian ·ªü th√†nh ph·ªë."</p>
                    <p><b>3. T·∫°i sao ch·ªçn 'little'?</b> "time" l√† danh t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c. "little time" mang nghƒ©a l√† "c√≥ r·∫•t √≠t th·ªùi gian" (h·∫ßu nh∆∞ kh√¥ng c√≥), ph√π h·ª£p v·ªõi vi·ªác c·∫ßn gi·∫£i ph√°p tham quan nhanh g·ªçn. "a little" mang nghƒ©a t√≠ch c·ª±c h∆°n (v·∫´n c√≤n m·ªôt √≠t).</p>
                `
            }
        ];

        let score = 0;
        let answeredQuestions = 0;

        // --- AUDIO SYSTEM (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playDing() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(1, audioCtx.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }

        function playWrongNote(freq, startTime, duration) {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.type = 'square';
            osc.frequency.value = freq;
            gainNode.gain.setValueAtTime(0.1, startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
            osc.start(startTime);
            osc.stop(startTime + duration);
        }

        function playWrong() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            playWrongNote(300, now, 0.2);       // T√©o
            playWrongNote(250, now + 0.2, 0.2); // t√®o
            playWrongNote(200, now + 0.4, 0.4); // t√®o
        }

        // --- CONFETTI ---
        function triggerConfetti() {
            const colors = ['#FF4757', '#00D26A', '#FDCB6E', '#8854C0', '#0984e3'];
            for(let i=0; i<40; i++) {
                let confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = (Math.random() * 1 + 1) + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        // --- RENDER QUIZ DYNAMICALLY ---
        const quizContainer = document.getElementById('quiz-container');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        quizData.forEach((q, qIndex) => {
            // Shuffle options
            let optionsCopy = [...q.options];
            shuffleArray(optionsCopy);

            // Create HTML structure
            const qDiv = document.createElement('div');
            qDiv.className = 'card question-box';
            
            let htmlStr = `<div class="question-text">${q.qText}</div><div class="options-grid" id="grid-${qIndex}">`;
            
            const labels = ['A', 'B', 'C', 'D'];
            optionsCopy.forEach((opt, optIndex) => {
                htmlStr += `<button class="option-btn" id="btn-${qIndex}-${optIndex}" onclick="checkAnswer(${qIndex}, ${optIndex}, ${opt.isCorrect})">${labels[optIndex]}. ${opt.text}</button>`;
            });

            htmlStr += `</div>
                        <div class="explanation-box" id="exp-${qIndex}">
                            ${q.explanation}
                        </div>`;
            
            qDiv.innerHTML = htmlStr;
            quizContainer.appendChild(qDiv);

            // Save shuffled state for logic
            q.shuffledOptions = optionsCopy;
        });

        // --- INTERACTION LOGIC ---
        function checkAnswer(qIndex, optIndex, isCorrect) {
            const grid = document.getElementById(`grid-${qIndex}`);
            const buttons = grid.querySelectorAll('.option-btn');
            const expBox = document.getElementById(`exp-${qIndex}`);

            // Disable all buttons in this question
            buttons.forEach(btn => btn.disabled = true);
            answeredQuestions++;

            if (isCorrect) {
                document.getElementById(`btn-${qIndex}-${optIndex}`).classList.add('correct');
                playDing();
                triggerConfetti();
                score++;
            } else {
                const clickedBtn = document.getElementById(`btn-${qIndex}-${optIndex}`);
                clickedBtn.classList.add('wrong');
                clickedBtn.classList.add('shake');
                playWrong();
                
                // Highlight correct answer immediately
                const correctOptIndex = quizData[qIndex].shuffledOptions.findIndex(o => o.isCorrect);
                document.getElementById(`btn-${qIndex}-${correctOptIndex}`).classList.add('correct');
            }

            // Show explanation
            expBox.style.display = 'block';
        }

        // --- TRANSLATION TOGGLE ---
        function toggleTranslation(id) {
            const box = document.getElementById(id);
            if(box.style.display === 'block') {
                box.style.display = 'none';
            } else {
                box.style.display = 'block';
            }
        }

        // --- TIMER LOGIC ---
        let timerInterval;
        let timeRemaining = 600; // 10 minutes
        let isRunning = false;

        function updateTimerDisplay() {
            let m = Math.floor(timeRemaining / 60);
            let s = timeRemaining % 60;
            document.getElementById('timer').innerText = `${m < 10 ? '0':''}${m}:${s < 10 ? '0':''}${s}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('btn-timer');
            if(audioCtx.state === 'suspended') audioCtx.resume(); // Kh·ªüi t·∫°o AudioContext khi user t∆∞∆°ng t√°c

            if(isRunning) {
                clearInterval(timerInterval);
                btn.innerText = "TI·∫æP T·ª§C T√çNH GI·ªú";
                isRunning = false;
            } else {
                btn.innerText = "T·∫†M D·ª™NG";
                isRunning = true;
                timerInterval = setInterval(() => {
                    timeRemaining--;
                    updateTimerDisplay();
                    if(timeRemaining <= 0) {
                        clearInterval(timerInterval);
                        alert("ƒê√£ h·∫øt gi·ªù l√†m b√†i. B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m, nh∆∞ng nh·ªõ l√† trong ph√≤ng thi th·∫≠t, b·∫°n ch·ªâ n√™n l√†m m·ªôt b√†i nh∆∞ th·∫ø n√†y trong 10 ph√∫t th√¥i nha.");
                        btn.innerText = "H·∫æT GI·ªú";
                        btn.disabled = true;
                    }
                }, 1000);
            }
        }

        // --- SUBMIT LOGIC ---
        function submitTest() {
            clearInterval(timerInterval);
            const modal = document.getElementById('result-modal');
            const titleStr = document.getElementById('modal-title');
            const scoreStr = document.getElementById('modal-score');
            const msgStr = document.getElementById('modal-msg');

            const total = quizData.length;
            scoreStr.innerText = `${score} / ${total}`;

            if (score === total) {
                titleStr.innerText = "üèÜ THI√äN T√ÄI!";
                msgStr.innerText = "Tuy·ªát ƒë·ªânh! B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng t·∫•t c·∫£ c√°c c√¢u h·ªèi!";
                triggerConfetti();
                triggerConfetti(); // Double confetti
            } else if (score >= total * 0.7) {
                titleStr.innerText = "üåü L√ÄM T·ªêT L·∫ÆM!";
                msgStr.innerText = "B·∫°n c√≥ ki·∫øn th·ª©c r·∫•t v·ªØng. H√£y xem l·∫°i c√°c c√¢u sai ·ªü ph·∫ßn gi·∫£i th√≠ch nh√©!";
            } else {
                titleStr.innerText = "üí™ C·ªê L√äN NH√â!";
                msgStr.innerText = "Kh√¥ng sao c·∫£, h·ªçc t·∫≠p l√† m·ªôt qu√° tr√¨nh. H√£y ƒë·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øn b·ªô h∆°n!";
            }

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

    </script>
</body>
</html>
