<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - Communication Exchange Exercise 1</title>
    <!-- Google Fonts: Nunito for friendly look -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#d7d7d7 1px, transparent 1px), radial-gradient(#d7d7d7 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            color: var(--primary-purple);
            font-weight: 800;
            font-size: 2.2rem;
            margin: 0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .teacher-name {
            font-size: 1rem;
            color: #666;
            background: #fff;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 10px;
            font-weight: 700;
        }

        #quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* Question Card */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #eee;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .question-number {
            background: var(--primary-purple);
            color: white;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #333;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 5px 0 #cccccc;
            text-align: left;
            position: relative;
            outline: none;
        }

        .option-btn:active {
            box-shadow: 0 0 0 #cccccc;
            transform: translateY(5px);
        }

        .option-btn:hover:not(:disabled) {
            background-color: #f9f9f9;
            transform: scale(1.02);
            border-color: var(--primary-purple);
        }

        /* Status Styles */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b85b;
            box-shadow: 0 5px 0 #008f47;
        }
        
        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #e63b49;
            box-shadow: 0 5px 0 #c22f3d;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
            transform: none !important;
        }

        /* Explanation Box */
        .explanation-box {
            background: #f0fdf4; /* Light green bg */
            border: 2px solid var(--primary-teal);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
            text-align: left;
        }

        .explanation-box.show {
            display: block;
        }

        .exp-header {
            font-weight: 800;
            color: var(--primary-teal);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .exp-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
            white-space: pre-line; /* Respect line breaks from data */
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer / Submit */
        .quiz-footer {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary-purple);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 8px 0 #6c429c;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
        }

        .submit-btn:hover {
            transform: scale(1.05);
            background: #9a6ad6;
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #6c429c;
        }

        /* Score Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            position: relative;
            border: 5px solid var(--primary-purple);
            animation: zoomIn 0.3s;
        }

        @keyframes zoomIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .final-score {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-purple);
            margin: 20px 0;
        }

        .final-message {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #555;
        }

        .close-btn {
            background: var(--primary-teal);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 5px 0 #009e82;
            font-size: 1.1rem;
        }
        
        .close-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* Glossary Table Styles for Reading (Generic support) */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .glossary-table th {
            background-color: var(--primary-purple);
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
            color: #333;
        }

    </style>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="teacher-name"><i class="fas fa-chalkboard-teacher"></i> Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <h1>Exercise 1: Communication Exchanges</h1>
        <p style="color: #666; font-weight: 600;">Good Luck Wishes & Requests</p>
    </div>

    <!-- Quiz Area -->
    <div id="quiz-container">
        <!-- Questions will be injected here via JS -->
    </div>

    <!-- Submit Button -->
    <div class="quiz-footer">
        <button id="submit-btn" class="submit-btn" onclick="finishQuiz()">
            <i class="fas fa-flag-checkered"></i> N·ªôp b√†i
        </button>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-teal);">K·∫øt qu·∫£ c·ªßa con</h2>
            <div class="final-score" id="score-display">0/10</div>
            <p class="final-message" id="message-display">C·ªë g·∫Øng l√™n nh√©!</p>
            <button class="close-btn" onclick="closeModal()">L√†m l·∫°i b√†i n√†y</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <!-- S·ª≠ d·ª•ng √¢m thanh base64 ng·∫Øn g·ªçn ƒë·ªÉ ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông offline/single file -->
    <script>
        // √Çm thanh Ding (ƒê√∫ng) v√† Buzz (Sai) gi·∫£ l·∫≠p
        const correctSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
        const wrongSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
        const completeSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
        
        // ƒêi·ªÅu ch·ªânh √¢m l∆∞·ª£ng
        correctSound.volume = 0.5;
        wrongSound.volume = 0.4;
        completeSound.volume = 0.6;
    </script>

    <script>
        // D·ªØ li·ªáu c√¢u h·ªèi t·ª´ file g·ªëc (Gi·ªØ nguy√™n 100% n·ªôi dung)
        const rawData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "\"Wishing you good luck on your exam today!\" - \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thank you! I've been studying hard.", "isCorrect": true },
                { "text": "Of course! I'll try my best.", "isCorrect": false },
                { "text": "That's fine. I will certainly do.", "isCorrect": false },
                { "text": "I don't know how to prepare for it.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Thank you (phrase): C·∫£m ∆°n b·∫°n.\n- Study hard (verb phrase): H·ªçc chƒÉm ch·ªâ.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n b·∫°n! M√¨nh ƒë√£ h·ªçc r·∫•t chƒÉm ch·ªâ.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ng∆∞·ªùi n√≥i A ch√∫c may m·∫Øn (\"Wishing you good luck\").\n- ƒê√°p l·∫°i l·ªùi ch√∫c may m·∫Øn, ta c·∫ßn n√≥i \"C·∫£m ∆°n\" (Thank you). V·∫ø sau \"I've been studying hard\" th·ªÉ hi·ªán s·ª± chu·∫©n b·ªã k·ªπ c√†ng, r·∫•t h·ª£p l√Ω trong ng·ªØ c·∫£nh ƒëi thi."
            },
            {
              "questionNumber": 2,
              "question": "\"Good luck with your presentation at the conference!\" - \"______________‚Äù",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thank you! I hope I can captivate the audience.", "isCorrect": true },
                { "text": "I'm sorry. I can't do that.", "isCorrect": false },
                { "text": "No worries. I know what to do.", "isCorrect": false },
                { "text": "Thank you. I wish to see you again.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Captivate (verb): Thu h√∫t, l√¥i cu·ªën.\n- Audience (noun): Kh√°n gi·∫£.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n b·∫°n! M√¨nh hy v·ªçng c√≥ th·ªÉ thu h√∫t ƒë∆∞·ª£c kh√°n gi·∫£.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ng∆∞·ªùi A ch√∫c may m·∫Øn cho b√†i thuy·∫øt tr√¨nh (presentation). Ng∆∞·ªùi B c·∫£m ∆°n v√† b√†y t·ªè hy v·ªçng v·ªÅ k·∫øt qu·∫£ t·ªët ƒë·∫πp (thu h√∫t kh√°n gi·∫£). ƒê√¢y l√† c·∫∑p tho·∫°i chu·∫©n x√°c."
            },
            {
              "questionNumber": 3,
              "question": "\"Best of luck in your music performance tonight!\" - \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thanks! I hope I hit all the right notes.", "isCorrect": true },
                { "text": "I'll try next time. Thank you.", "isCorrect": false },
                { "text": "Sure. Let's go to the concert.", "isCorrect": false },
                { "text": "Not at all. I'll listen to the music now.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Hit the right notes (idiom/collocation): Ch∆°i ƒë√∫ng nh·∫°c/ƒë√°nh tr√∫ng n·ªët nh·∫°c (nghƒ©a b√≥ng: l√†m ƒë√∫ng √Ω).\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n! M√¨nh hy v·ªçng m√¨nh s·∫Ω ch∆°i ƒë√∫ng t·∫•t c·∫£ c√°c n·ªët nh·∫°c.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- L·ªùi ch√∫c li√™n quan ƒë·∫øn \"music performance\" (bi·ªÉu di·ªÖn √¢m nh·∫°c). C√¢u tr·∫£ l·ªùi c·∫£m ∆°n v√† nh·∫Øc ƒë·∫øn \"hit the right notes\" (ƒë√°nh ƒë√∫ng n·ªët) l√† ho√†n to√†n kh·ªõp ng·ªØ c·∫£nh."
            },
            {
              "questionNumber": 4,
              "question": "\"Good luck on your job interview tomorrow!\" - \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thank you! I'll do my best to impress them.", "isCorrect": true },
                { "text": "Not at all. I'll tell you about the interview later.", "isCorrect": false },
                { "text": "I'm so glad you ask me this question.", "isCorrect": false },
                { "text": "Sure. Thanks for interviewing me.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Impress (verb): G√¢y ·∫•n t∆∞·ª£ng.\n- Do my best (phrase): C·ªë g·∫Øng h·∫øt s·ª©c.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n b·∫°n! M√¨nh s·∫Ω c·ªë h·∫øt s·ª©c ƒë·ªÉ g√¢y ·∫•n t∆∞·ª£ng v·ªõi h·ªç.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- ƒê√°p l·∫°i l·ªùi ch√∫c ph·ªèng v·∫•n xin vi·ªác (job interview). \"Impress them\" (g√¢y ·∫•n t∆∞·ª£ng v·ªõi nh√† tuy·ªÉn d·ª•ng) l√† m·ª•c ti√™u ch√≠nh c·ªßa ph·ªèng v·∫•n."
            },
            {
              "questionNumber": 5,
              "question": "\"Best of luck on your overseas adventure!\" - \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thanks! I'm excited to explore new places.", "isCorrect": true },
                { "text": "Sure. I'm going to Australia next week.", "isCorrect": false },
                { "text": "No worries. I'll try my best.", "isCorrect": false },
                { "text": "Thank you. I hope to see you in my place.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Overseas (adj/adv): N∆∞·ªõc ngo√†i.\n- Adventure (noun): Cu·ªôc phi√™u l∆∞u.\n- Explore (verb): Kh√°m ph√°.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n! M√¨nh r·∫•t h√†o h·ª©ng ƒë∆∞·ª£c kh√°m ph√° nh·ªØng v√πng ƒë·∫•t m·ªõi.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- L·ªùi ch√∫c li√™n quan ƒë·∫øn ƒëi n∆∞·ªõc ngo√†i (overseas) v√† phi√™u l∆∞u. ƒê√°p √°n n√†y th·ªÉ hi·ªán s·ª± h√†o h·ª©ng v√† h√†nh ƒë·ªông ph√π h·ª£p (explore new places)."
            },
            {
              "questionNumber": 6,
              "question": "- A: I heard you have a big presentation tomorrow. \"______________\" \n- B: Thank you so much.",
              "imageUrl": "",
              "answerOptions": [
                { "text": "I wish you all the best of luck!", "isCorrect": true },
                { "text": "I promise I'll try my best.", "isCorrect": false },
                { "text": "I appreciate your effort.", "isCorrect": false },
                { "text": "Don't worn about me.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Wish (verb): Ch√∫c.\n- All the best of luck (phrase): M·ªçi s·ª± may m·∫Øn nh·∫•t.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"M√¨nh ch√∫c b·∫°n g·∫∑p nhi·ªÅu may m·∫Øn nh√©!\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ng∆∞·ªùi B n√≥i \"Thank you\" (C·∫£m ∆°n), suy ra ng∆∞·ªùi A ph·∫£i ƒë∆∞a ra m·ªôt l·ªùi ch√∫c ho·∫∑c l·ªùi khen. Trong ng·ªØ c·∫£nh s·∫Øp c√≥ b√†i thuy·∫øt tr√¨nh, ch√∫c may m·∫Øn l√† h·ª£p l√Ω nh·∫•t."
            },
            {
              "questionNumber": 7,
              "question": "- A: Good luck with your IELTS exam next week! \n- B: \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thanks. I‚Äôll try my best.", "isCorrect": true },
                { "text": "I‚Äôm not taking anything.", "isCorrect": false },
                { "text": "I‚Äôd love to. Thanks a lot.", "isCorrect": false },
                { "text": "Yes, I agree with you.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Thanks (noun): C·∫£m ∆°n.\n- Try my best (phrase): C·ªë g·∫Øng h·∫øt s·ª©c.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n nha. M√¨nh s·∫Ω c·ªë g·∫Øng h·∫øt s·ª©c.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- ƒê√¢y l√† c√¢u tr·∫£ l·ªùi ti√™u chu·∫©n v√† l·ªãch s·ª± nh·∫•t khi nh·∫≠n ƒë∆∞·ª£c l·ªùi ch√∫c thi t·ªët."
            },
            {
              "questionNumber": 8,
              "question": "- A: I need to finish this report by tomorrow. \n- B: \"______________\" The deadline is really close.",
              "imageUrl": "",
              "answerOptions": [
                { "text": "You must start working on it now.", "isCorrect": true },
                { "text": "Let‚Äôs take a small break.", "isCorrect": false },
                { "text": "I‚Äôm sorry about everything.", "isCorrect": false },
                { "text": "Don‚Äôt worry about me.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Must (modal verb): Ph·∫£i.\n- Start working (phrase): B·∫Øt ƒë·∫ßu l√†m vi·ªác.\n- Deadline (noun): H·∫°n ch√≥t.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"B·∫°n ph·∫£i b·∫Øt ƒë·∫ßu l√†m ngay ƒëi. H·∫°n ch√≥t ƒë·∫øn r·∫•t g·∫ßn r·ªìi.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- Ng∆∞·ªùi A ƒëang v·ªôi (by tomorrow). Ng∆∞·ªùi B ƒë∆∞a ra l·ªùi khuy√™n c·∫•p thi·∫øt ph√π h·ª£p v·ªõi v·∫ø sau \"The deadline is really close\" (H·∫°n ch√≥t r·∫•t g·∫ßn r·ªìi)."
            },
            {
              "questionNumber": 9,
              "question": "- A: I know you enter an English contest this week. Break a leg! \n- B: \"______________\"",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Thanks a bunch.", "isCorrect": true },
                { "text": "I like that contest a lot.", "isCorrect": false },
                { "text": "Welcome to the contest!", "isCorrect": false },
                { "text": "My leg is better now.", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Break a leg (idiom): Ch√∫c may m·∫Øn (th∆∞·ªùng d√πng trong bi·ªÉu di·ªÖn/thi c·ª≠).\n- Thanks a bunch (idiom): C·∫£m ∆°n nhi·ªÅu.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"C·∫£m ∆°n nhi·ªÅu nha.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- \"Break a leg\" l√† th√†nh ng·ªØ ƒë·ªìng nghƒ©a v·ªõi \"Good luck\". V√¨ v·∫≠y, B c·∫ßn ƒë√°p l·∫°i b·∫±ng l·ªùi c·∫£m ∆°n."
            },
            {
              "questionNumber": 10,
              "question": "- A: \"______________\" I have a doctor‚Äôs appointment. \n- B: Sure. You can leave at 3 p.m.",
              "imageUrl": "",
              "answerOptions": [
                { "text": "Can I leave early today?", "isCorrect": true },
                { "text": "Could you do me a favour?", "isCorrect": false },
                { "text": "May I go out right now?", "isCorrect": false },
                { "text": "Would you mind leaving now?", "isCorrect": false }
              ],
              "rationale": "1. Ph√¢n t√≠ch t·ª´ v·ª±ng:\n- Leave early (phrase): V·ªÅ s·ªõm.\n- Appointment (noun): Cu·ªôc h·∫πn.\n\n2. D·ªãch nghƒ©a to√†n c√¢u: \"H√¥m nay t√¥i v·ªÅ s·ªõm ƒë∆∞·ª£c kh√¥ng? T√¥i c√≥ h·∫πn b√°c sƒ©.\"\n\n3. Gi·∫£i th√≠ch chi ti·∫øt:\n- C√¢u tr·∫£ l·ªùi c·ªßa B l√† \"Sure. You can leave at 3 p.m.\" (ƒê∆∞·ª£c, b·∫°n c√≥ th·ªÉ v·ªÅ l√∫c 3 gi·ªù). ƒêi·ªÅu n√†y kh·ªõp ho√†n to√†n v·ªõi c√¢u h·ªèi xin ph√©p v·ªÅ s·ªõm (leave early)."
            }
          ]
        };

        // State variables
        let quizData = [];
        let score = 0;
        let answeredCount = 0;

        // Shuffle Function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize Quiz
        function initQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            score = 0;
            answeredCount = 0;
            
            // Clone data to avoid modifying original rawData during shuffling
            quizData = JSON.parse(JSON.stringify(rawData.questions));
            
            // 1. Shuffle Order of Questions
            shuffleArray(quizData);

            // 2. Shuffle Order of Answers (Options) within each question
            quizData.forEach(q => {
                 shuffleArray(q.answerOptions);
            });

            quizData.forEach((q, index) => {
                const card = createQuestionCard(q, index);
                container.appendChild(card);
            });
        }

        // Create Card Element
        function createQuestionCard(q, index) {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${index}`;

            // Header: Question Number & Hint Icon
            const headerHtml = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div class="question-number">Question ${index + 1}</div>
                    ${q.hint ? `<i class="fas fa-lightbulb" style="color:#f1c40f; cursor:pointer;" title="${q.hint}"></i>` : ''}
                </div>
            `;

            // Question Text
            const textHtml = `<div class="question-text">${q.question.replace(/\n/g, '<br>')}</div>`;

            // Options
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-grid';
            
            // Map original options to include their original index for tracking (though we don't shuffle options here to keep A,B,C,D order consistent with potential text references)
            q.answerOptions.forEach((opt, optIndex) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                // Add A, B, C, D labels
                const label = String.fromCharCode(65 + optIndex); // 65 is 'A'
                btn.innerHTML = `<span style="color:var(--primary-purple); font-weight:800; margin-right:8px;">${label}.</span> ${opt.text}`;
                
                btn.onclick = () => handleAnswer(index, optIndex, opt.isCorrect, btn);
                optionsDiv.appendChild(btn);
            });

            // Explanation Section
            const expDiv = document.createElement('div');
            expDiv.className = 'explanation-box';
            expDiv.id = `exp-${index}`;
            expDiv.innerHTML = `
                <div class="exp-header"><i class="fas fa-glasses"></i> Gi·∫£i th√≠ch chi ti·∫øt c·ªßa c√¥ Mai An:</div>
                <div class="exp-content">${formatRationale(q.rationale)}</div>
            `;

            card.innerHTML = headerHtml + textHtml;
            card.appendChild(optionsDiv);
            card.appendChild(expDiv);

            return card;
        }

        // Format Rationale Text
        function formatRationale(text) {
            if (!text) return "Ch∆∞a c√≥ gi·∫£i th√≠ch.";
            // Bold key sections
            let formatted = text.replace(/\n/g, '<br>');
            formatted = formatted.replace(/(Ph√¢n t√≠ch t·ª´ v·ª±ng:)/g, '<strong>$1</strong>');
            formatted = formatted.replace(/(D·ªãch nghƒ©a to√†n c√¢u:)/g, '<strong>$1</strong>');
            formatted = formatted.replace(/(Gi·∫£i th√≠ch chi ti·∫øt:)/g, '<strong>$1</strong>');
            return formatted;
        }

        // Handle Answer Click
        function handleAnswer(qIndex, optIndex, isCorrect, btnElement) {
            const card = document.getElementById(`q-card-${qIndex}`);
            const buttons = card.querySelectorAll('.option-btn');
            const expBox = document.getElementById(`exp-${qIndex}`);

            // Prevent re-answering
            if (card.getAttribute('data-answered') === 'true') return;
            card.setAttribute('data-answered', 'true');
            answeredCount++;

            // Highlight chosen answer
            if (isCorrect) {
                btnElement.classList.add('correct');
                correctSound.play();
                score++;
                // Confetti for correct answer (small burst)
                confetti({
                    particleCount: 50,
                    spread: 60,
                    origin: { y: 0.7 },
                    colors: ['#00D26A', '#8854C0']
                });
            } else {
                btnElement.classList.add('wrong');
                wrongSound.play();
                // Find and highlight the correct answer
                quizData[qIndex].answerOptions.forEach((opt, i) => {
                    if (opt.isCorrect) {
                        buttons[i].classList.add('correct');
                    }
                });
            }

            // Disable all buttons
            buttons.forEach(b => b.disabled = true);

            // Show explanation immediately
            expBox.classList.add('show');
        }

        // Finish Quiz
        function finishQuiz() {
            if (answeredCount < quizData.length) {
                if(!confirm(`Con m·ªõi l√†m ${answeredCount}/${quizData.length} c√¢u. Con c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`)) {
                    return;
                }
            }

            const modal = document.getElementById('result-modal');
            const scoreDisplay = document.getElementById('score-display');
            const msgDisplay = document.getElementById('message-display');

            scoreDisplay.textContent = `${score}/${quizData.length}`;

            // Messages based on score
            const percentage = (score / quizData.length) * 100;
            if (percentage === 100) {
                msgDisplay.textContent = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i ti·∫øng Anh! üåüüèÜ";
                completeSound.play();
                // Big confetti
                var duration = 3000;
                var end = Date.now() + duration;
                (function frame() {
                    confetti({
                        particleCount: 5,
                        angle: 60,
                        spread: 55,
                        origin: { x: 0 }
                    });
                    confetti({
                        particleCount: 5,
                        angle: 120,
                        spread: 55,
                        origin: { x: 1 }
                    });
                    if (Date.now() < end) {
                        requestAnimationFrame(frame);
                    }
                }());
            } else if (percentage >= 80) {
                msgDisplay.textContent = "Gi·ªèi l·∫Øm! Ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i. üí™";
                completeSound.play();
            } else if (percentage >= 50) {
                msgDisplay.textContent = "Kh√° t·ªët, nh∆∞ng c·∫ßn √¥n l·∫°i t·ª´ v·ª±ng nha con. üìö";
            } else {
                msgDisplay.textContent = "C·ªë g·∫Øng h∆°n l·∫ßn sau nh√©! C√¥ tin con l√†m ƒë∆∞·ª£c. ‚ù§Ô∏è";
            }

            modal.style.display = "flex";
        }

        // Close Modal & Reset
        function closeModal() {
            document.getElementById('result-modal').style.display = "none";
            // Scroll to top
            window.scrollTo(0,0);
            initQuiz();
        }

        // Start
        window.onload = initQuiz;

    </script>
</body>
</html>
