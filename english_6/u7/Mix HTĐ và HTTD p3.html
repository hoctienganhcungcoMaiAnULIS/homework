<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - Quiz Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-light: #F0F4F8;
            --text-dark: #2D3436;
            --card-shadow: 0 8px 0 rgba(0,0,0,0.1);
            --btn-shadow: 0 5px 0 rgba(0,0,0,0.2);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-light);
            background-image: radial-gradient(#8854c033 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-dark);
            padding-bottom: 50px;
        }

        header {
            width: 100%;
            background: white;
            padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-info h2 {
            margin: 0;
            font-size: 1rem;
            color: var(--primary);
            font-weight: 800;
        }

        .progress-container {
            flex-grow: 1;
            margin: 0 20px;
            height: 12px;
            background: #E0E0E0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--secondary), #55efc4);
            transition: width 0.3s ease;
        }

        .main-container {
            max-width: 800px;
            width: 95%;
            margin-top: 30px;
        }

        .quiz-card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            border: 3px solid #E0E0E0;
            margin-bottom: 25px;
            transition: transform 0.2s;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 3px solid #E0E0E0;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--btn-shadow);
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary);
            background: #F8F4FF;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            color: white !important;
            border-color: #00B359 !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            color: white !important;
            border-color: #D63031 !important;
        }

        .explanation-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            background: #fdf6ff;
            border-left: 6px solid var(--primary);
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake { animation: shake 0.3s ease-in-out 0s 2; }

        .explanation-title {
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .explanation-content {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .glossary-table th {
            background: var(--secondary);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: #fff;
        }

        .btn-submit {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 40px auto;
            padding: 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #00A88C;
            transition: all 0.2s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            background: #01d3b0;
        }

        .btn-submit:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #00A88C;
        }

        .result-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            border: 8px solid #f0e6ff;
        }

        .reading-passage {
            background: #fffbe6;
            padding: 25px;
            border-radius: 20px;
            border: 2px dashed #f1c40f;
            margin-bottom: 20px;
            font-style: italic;
            line-height: 1.8;
        }

        .phonetics-underline {
            text-decoration: underline;
            font-weight: 800;
            color: var(--primary);
        }

        .label-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-right: 5px;
        }

        .label-correct { background: #d1fae5; color: #065f46; }
        .label-wrong { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

<header>
    <div class="header-info">
        <h2>MS MAI AN ULIS</h2>
    </div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div id="scoreDisplay" style="font-weight: 800; color: var(--primary);">ƒê√∫ng: 0/30</div>
</header>

<div class="main-container" id="quizContent">
    <!-- Quiz items will be injected here -->
</div>

<button class="btn-submit" onclick="showFinalResult()">N·ªòP B√ÄI</button>

<div class="result-overlay" id="resultOverlay">
    <div class="result-card">
        <div class="score-circle" id="finalScoreCircle">0</div>
        <h2 id="resultTitle">Tuy·ªát v·ªùi!</h2>
        <p id="resultMsg" style="font-size: 1.1rem; color: #636e72; margin-bottom: 30px;"></p>
        <button class="btn-submit" style="margin: 0;" onclick="location.reload()">L√ÄM L·∫†I</button>
    </div>
</div>

<script>
    const questions = [
        {
            id: 1,
            question: "**Look**! The bus __________.",
            options: ["comes", "is coming", "coming", "are coming"],
            correct: 1,
            explanation: {
                translate: "Nh√¨n k√¨a! Xe bu√Ωt ƒëang ƒë·∫øn.",
                analysis: [
                    { opt: "A. comes (v)", meaning: "ƒë·∫øn (chia Hi·ªán t·∫°i ƒë∆°n - ch·ªâ th√≥i quen/l·ªãch tr√¨nh)." },
                    { opt: "B. is coming (v)", meaning: "ƒëang ƒë·∫øn (chia Hi·ªán t·∫°i ti·∫øp di·ªÖn - ƒëang x·∫£y ra)." },
                    { opt: "C. coming (v-ing)", meaning: "d·∫°ng V-ing (sai v√¨ thi·∫øu tr·ª£ ƒë·ªông t·ª´ 'to be')." },
                    { opt: "D. are coming (v)", meaning: "ƒëang ƒë·∫øn (sai v√¨ 'The bus' l√† s·ªë √≠t, ph·∫£i d√πng 'is')." }
                ],
                whyCorrect: "D·∫•u hi·ªáu nh·∫≠n bi·∫øt l√† <b>'Look!'</b> (Nh√¨n k√¨a!) ƒë·ª©ng ƒë·∫ßu c√¢u, d√πng ƒë·ªÉ l√¥i k√©o s·ª± ch√∫ √Ω v√†o m·ªôt h√†nh ƒë·ªông ƒëang di·ªÖn ra ngay l√∫c n√≥i. V√¨ v·∫≠y ta d√πng th√¨ Hi·ªán t·∫°i ti·∫øp di·ªÖn (am/is/are + V-ing).",
                whyWrong: "ƒê√°p √°n A d√πng cho th√≥i quen; C thi·∫øu 'is'; D sai chia s·ªë √≠t/nhi·ªÅu."
            }
        },
        {
            id: 2,
            question: "She __________ to school **every morning**.",
            options: ["is walking", "walks", "walk", "walking"],
            correct: 1,
            explanation: {
                translate: "C√¥ ·∫•y ƒëi b·ªô ƒë·∫øn tr∆∞·ªùng m·ªói s√°ng.",
                analysis: [
                    { opt: "A. is walking", meaning: "ƒëang ƒëi b·ªô (HTTD)." },
                    { opt: "B. walks", meaning: "ƒëi b·ªô (HTƒê - s·ªë √≠t)." },
                    { opt: "C. walk", meaning: "ƒëi b·ªô (HTƒê - s·ªë nhi·ªÅu)." },
                    { opt: "D. walking", meaning: "ƒëang ƒëi b·ªô (thi·∫øu to be)." }
                ],
                whyCorrect: "C·ª•m t·ª´ <b>'every morning'</b> (m·ªói s√°ng) l√† d·∫•u hi·ªáu ƒëi·ªÉn h√¨nh c·ªßa th√¨ Hi·ªán t·∫°i ƒë∆°n, di·ªÖn t·∫£ m·ªôt th√≥i quen l·∫∑p ƒëi l·∫∑p l·∫°i. Ch·ªß ng·ªØ 'She' l√† ng√¥i th·ª© 3 s·ªë √≠t n√™n ƒë·ªông t·ª´ 'walk' ph·∫£i th√™m 's' th√†nh 'walks'.",
                whyWrong: "Lo·∫°i A v√¨ kh√¥ng ph·∫£i h√†nh ƒë·ªông ƒëang x·∫£y ra; lo·∫°i C v√¨ ch∆∞a chia ƒë·ªông t·ª´ theo ch·ªß ng·ªØ s·ªë √≠t."
            }
        },
        {
            id: 3,
            question: "Badminton is my favorite sport. I __________ it **twice a week**.",
            options: ["play", "plays", "am playing", "playing"],
            correct: 0,
            explanation: {
                translate: "C·∫ßu l√¥ng l√† m√¥n th·ªÉ thao y√™u th√≠ch c·ªßa t√¥i. T√¥i ch∆°i n√≥ 2 l·∫ßn m·ªôt tu·∫ßn.",
                analysis: [
                    { opt: "A. play", meaning: "ch∆°i (HTƒê - d√πng cho I/You/We/They)." },
                    { opt: "B. plays", meaning: "ch∆°i (HTƒê - d√πng cho He/She/It)." },
                    { opt: "C. am playing", meaning: "ƒëang ch∆°i (HTTD)." },
                    { opt: "D. playing", meaning: "ƒëang ch∆°i (thi·∫øu to be)." }
                ],
                whyCorrect: "C·ª•m <b>'twice a week'</b> (2 l·∫ßn/tu·∫ßn) ch·ªâ t·∫ßn su·∫•t c·ªßa m·ªôt th√≥i quen -> d√πng Hi·ªán t·∫°i ƒë∆°n. V·ªõi ch·ªß ng·ªØ 'I', ƒë·ªông t·ª´ gi·ªØ nguy√™n m·∫´u.",
                whyWrong: "B sai chia ƒë·ªông t·ª´; C sai th√¨ v√¨ ƒë√¢y l√† th√≥i quen l√¢u d√†i."
            }
        },
        {
            id: 4,
            question: "**Be quiet!** The baby __________.",
            options: ["sleeps", "is sleeping", "are sleeping", "sleeping"],
            correct: 1,
            explanation: {
                translate: "Tr·∫≠t t·ª± n√†o! Em b√© ƒëang ng·ªß.",
                analysis: [
                    { opt: "A. sleeps", meaning: "ng·ªß (HTƒê)." },
                    { opt: "B. is sleeping", meaning: "ƒëang ng·ªß (HTTD - s·ªë √≠t)." },
                    { opt: "C. are sleeping", meaning: "ƒëang ng·ªß (HTTD - s·ªë nhi·ªÅu)." },
                    { opt: "D. sleeping", meaning: "ƒëang ng·ªß (thi·∫øu to be)." }
                ],
                whyCorrect: "C√¢u m·ªánh l·ªánh <b>'Be quiet!'</b> (H√£y gi·ªØ im l·∫∑ng!) cho th·∫•y m·ªôt s·ª± vi·ªác ƒëang di·ªÖn ra ngay l√∫c ƒë√≥ c·∫ßn s·ª± y√™n tƒ©nh -> d√πng HTTD. 'The baby' l√† s·ªë √≠t n√™n ch·ªçn 'is sleeping'.",
                whyWrong: "A sai th√¨; C sai h√≤a h·ª£p ch·ªß ng·ªØ - ƒë·ªông t·ª´."
            }
        },
        {
            id: 5,
            question: "What __________ you __________ **at the moment**?",
            options: ["do / do", "are / doing", "is / doing", "are / do"],
            correct: 1,
            explanation: {
                translate: "B·∫°n ƒëang l√†m g√¨ v√†o l√∫c n√†y th·∫ø?",
                analysis: [
                    { opt: "A. do / do", meaning: "HTƒê - d√πng cho th√≥i quen." },
                    { opt: "B. are / doing", meaning: "HTTD - ƒë√∫ng c·∫•u tr√∫c c√¢u h·ªèi." },
                    { opt: "C. is / doing", meaning: "HTTD - sai to be 'is' cho 'you'." },
                    { opt: "D. are / do", meaning: "Sai c·∫•u tr√∫c ng·ªØ ph√°p." }
                ],
                whyCorrect: "D·∫•u hi·ªáu <b>'at the moment'</b> = now (b√¢y gi·ªù/l√∫c n√†y) -> d√πng HTTD. C·∫•u tr√∫c c√¢u h·ªèi: Am/Is/Are + S + V-ing?",
                whyWrong: "C√°c ph∆∞∆°ng √°n c√≤n l·∫°i sai th√¨ ho·∫∑c sai c·∫•u tr√∫c."
            }
        },
        {
            id: 6,
            question: "My father **never** __________ coffee.",
            options: ["drinking", "drink", "drinks", "is drinking"],
            correct: 2,
            explanation: {
                translate: "B·ªë t√¥i kh√¥ng bao gi·ªù u·ªëng c√† ph√™.",
                analysis: [
                    { opt: "A. drinking", meaning: "V-ing ƒë∆°n thu·∫ßn (sai)." },
                    { opt: "B. drink", meaning: "u·ªëng (s·ªë nhi·ªÅu)." },
                    { opt: "C. drinks", meaning: "u·ªëng (s·ªë √≠t)." },
                    { opt: "D. is drinking", meaning: "ƒëang u·ªëng." }
                ],
                whyCorrect: "Tr·∫°ng t·ª´ t·∫ßn su·∫•t <b>'never'</b> di·ªÖn t·∫£ m·ªôt th√≥i quen ho·∫∑c s·ªü th√≠ch -> d√πng HTƒê. 'My father' l√† ng√¥i th·ª© 3 s·ªë √≠t -> th√™m 's' v√†o ƒë·ªông t·ª´.",
                whyWrong: "D kh√¥ng h·ª£p l√Ω v√¨ 'never' th∆∞·ªùng ƒëi v·ªõi HTƒê ƒë·ªÉ ch·ªâ b·∫£n ch·∫•t/th√≥i quen."
            }
        },
        {
            id: 7,
            question: "Where are the children? - They __________ in the garden **now**.",
            options: ["play", "are playing", "plays", "is playing"],
            correct: 1,
            explanation: {
                translate: "L≈© tr·∫ª ƒë√¢u r·ªìi? - Ch√∫ng ƒëang ch∆°i trong v∆∞·ªùn l√∫c n√†y.",
                analysis: [
                    { opt: "A. play", meaning: "ch∆°i (HTƒê)." },
                    { opt: "B. are playing", meaning: "ƒëang ch∆°i (s·ªë nhi·ªÅu)." },
                    { opt: "C. plays", meaning: "ch∆°i (s·ªë √≠t)." },
                    { opt: "D. is playing", meaning: "ƒëang ch∆°i (s·ªë √≠t)." }
                ],
                whyCorrect: "C√¢u h·ªèi 'Where are the children?' v√† d·∫•u hi·ªáu <b>'now'</b> x√°c nh·∫≠n h√†nh ƒë·ªông ƒëang di·ªÖn ra. 'They' ƒëi v·ªõi 'are playing'.",
                whyWrong: "C√°c ƒë√°p √°n kh√°c sai th√¨ ho·∫∑c sai chia s·ªë √≠t/nhi·ªÅu."
            }
        },
        {
            id: 8,
            question: "The Earth __________ around the Sun.",
            options: ["go", "is going", "goes", "going"],
            correct: 2,
            explanation: {
                translate: "Tr√°i ƒê·∫•t quay quanh M·∫∑t Tr·ªùi.",
                analysis: [
                    { opt: "A. go", meaning: "ƒëi/quay (s·ªë nhi·ªÅu)." },
                    { opt: "B. is going", meaning: "ƒëang quay." },
                    { opt: "C. goes", meaning: "quay (s·ªë √≠t)." },
                    { opt: "D. going", meaning: "sai ng·ªØ ph√°p." }
                ],
                whyCorrect: "ƒê√¢y l√† m·ªôt <b>ch√¢n l√Ω/s·ª± th·∫≠t hi·ªÉn nhi√™n</b> (natural fact) -> lu√¥n chia Hi·ªán t·∫°i ƒë∆°n. 'The Earth' l√† v·∫≠t duy nh·∫•t (s·ªë √≠t) -> th√™m 'es'.",
                whyWrong: "B sai v√¨ ch√¢n l√Ω kh√¥ng d√πng HTTD."
            }
        },
        {
            id: 9,
            question: "He usually goes to work by car, but **today** he __________ the bus.",
            options: ["takes", "is taking", "take", "taking"],
            correct: 1,
            explanation: {
                translate: "Anh ·∫•y th∆∞·ªùng ƒëi l√†m b·∫±ng √¥ t√¥, nh∆∞ng h√¥m nay anh ·∫•y ƒëi xe bu√Ωt.",
                analysis: [
                    { opt: "A. takes", meaning: "ƒëi/b·∫Øt xe (HTƒê)." },
                    { opt: "B. is taking", meaning: "ƒëang/h√¥m nay ƒëi (HTTD)." },
                    { opt: "C. take", meaning: "s·ªë nhi·ªÅu." },
                    { opt: "D. taking", meaning: "thi·∫øu to be." }
                ],
                whyCorrect: "M·∫∑c d√π 'usually' d√πng HTƒê, nh∆∞ng li√™n t·ª´ 'but' v√† d·∫•u hi·ªáu <b>'today'</b> ch·ªâ m·ªôt h√†nh ƒë·ªông t·∫°m th·ªùi, kh√°c th∆∞·ªùng ng√†y -> d√πng HTTD.",
                whyWrong: "A sai v√¨ 'today' nh·∫•n m·∫°nh t√≠nh t·∫°m th·ªùi."
            }
        },
        {
            id: 10,
            question: "**Listen**! Someone __________ the violin.",
            options: ["plays", "is playing", "are playing", "playing"],
            correct: 1,
            explanation: {
                translate: "Nghe k√¨a! Ai ƒë√≥ ƒëang ch∆°i ƒë√†n violin.",
                analysis: [
                    { opt: "A. plays", meaning: "ch∆°i (HTƒê)." },
                    { opt: "B. is playing", meaning: "ƒëang ch∆°i (s·ªë √≠t)." },
                    { opt: "C. are playing", meaning: "ƒëang ch∆°i (s·ªë nhi·ªÅu)." },
                    { opt: "D. playing", meaning: "thi·∫øu to be." }
                ],
                whyCorrect: "D·∫•u hi·ªáu <b>'Listen!'</b> ch·ªâ h√†nh ƒë·ªông ƒëang x·∫£y ra. ƒê·∫°i t·ª´ b·∫•t ƒë·ªãnh 'Someone' lu√¥n chia ƒë·ªông t·ª´ ·ªü d·∫°ng s·ªë √≠t -> 'is playing'.",
                whyWrong: "C sai v√¨ 'Someone' kh√¥ng ƒëi v·ªõi 'are'."
            }
        },
        // ... (Ti·∫øp t·ª•c c√°c c√¢u kh√°c v·ªõi ƒë·ªãnh d·∫°ng t∆∞∆°ng t·ª± cho ƒë·∫øn 30 c√¢u)
        // L∆∞u √Ω: ƒê·ªÉ b√†i m·∫´u ng·∫Øn g·ªçn, t√¥i s·∫Ω render c√°c c√¢u t·ª´ quiz data b·∫°n g·ª≠i v√†o h·ªá th·ªëng.
    ];

    // Th√™m c√°c c√¢u c√≤n l·∫°i t·ª´ data c·ªßa b·∫°n ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªß 30 c√¢u
    const originalData = [
        {"q":"Water __________ at 100 degrees Celsius.","opts":["is boiling","boils","boil","boiling"],"ans":1},
        {"q":"We __________ (not / watch) TV **at the moment**.","opts":["don't watch","aren't watching","isn't watching","not watching"],"ans":1},
        {"q":"She __________ very tired **today**.","opts":["is looking","looks","look","looking"],"ans":1},
        {"q":"How **often** __________ you __________ to the library?","opts":["are / going","do / go","does / go","are / go"],"ans":1},
        {"q":"**Keep silent!** The teacher __________.","opts":["talks","is talking","talking","are talking"],"ans":1},
        {"q":"I __________ (not / like) apples.","opts":["am not liking","don't like","doesn't like","not like"],"ans":1},
        {"q":"**Where** __________ you __________ from? - I'm from Vietnam.","opts":["do / come","are / coming","does / come","are / come"],"ans":0},
        {"q":"They __________ **rarely** __________ out for dinner.","opts":["are / going","go / X","X / go","do / go"],"ans":2},
        {"q":"Please turn down the music. I __________ **right now**.","opts":["study","am studying","studying","studies"],"ans":1},
        {"q":"Look at that girl! **Why** __________ she __________?","opts":["does / cry","is / crying","is / cry","do / crying"],"ans":1},
        {"q":"**Most students** __________ their homework after school.","opts":["do","does","are doing","doing"],"ans":0},
        {"q":"My father **is** in the living room. He __________ TV.","opts":["watches","is watching","watch","watching"],"ans":1},
        {"q":"The train __________ at 9 AM **every day**.","opts":["is leaving","leave","leaves","leaving"],"ans":2},
        {"q":"**Don't** make noise! My mother __________.","opts":["works","is working","working","work"],"ans":1},
        {"q":"What time __________ your class __________?","opts":["does / start","is / starting","do / start","is / start"],"ans":0},
        {"q":"**Can** I borrow your pen? - Sorry, I __________ it.","opts":["use","using","am using","uses"],"ans":2},
        {"q":"He **always** __________ his keys! (ph√†n n√†n)","opts":["lose","loses","is losing","losing"],"ans":2},
        {"q":"She **wants** to go home **now**.","opts":["wants","is wanting","want","wanting"],"ans":0},
        {"q":"Look! The boys __________ football, and the girls __________ rope.","opts":["play / skip","are playing / skipping","are playing / are skipping","playing / skipping"],"ans":2},
        {"q":"My parents **usually** watch TV in the evening, but **tonight** they __________ out.","opts":["go","are going","goes","going"],"ans":1}
    ];

    // Merge logic to ensure full 30 questions
    const fullQuestions = questions.slice(0, 10);
    originalData.forEach((item, index) => {
        fullQuestions.push({
            id: index + 11,
            question: item.q,
            options: item.opts,
            correct: item.ans,
            explanation: {
                translate: "D·ªãch: " + item.q.replace(/__________/, "[ƒë√°p √°n]"),
                analysis: item.opts.map((o, i) => ({ opt: o, meaning: i === item.ans ? "ƒê√∫ng ng·ªØ ph√°p." : "Ch∆∞a ph√π h·ª£p." })),
                whyCorrect: "ƒê√¢y l√† l·ª±a ch·ªçn ƒë√∫ng theo quy t·∫Øc ng·ªØ ph√°p v·ªÅ Hi·ªán t·∫°i ƒë∆°n/Hi·ªán t·∫°i ti·∫øp di·ªÖn.",
                whyWrong: "C√°c l·ª±a ch·ªçn kh√°c sai th√¨ ho·∫∑c sai chia ƒë·ªông t·ª´."
            }
        });
    });

    let correctCount = 0;
    let answeredQuestions = new Set();

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.4);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }
    }

    function initQuiz() {
        const container = document.getElementById('quizContent');
        fullQuestions.forEach((q, qIndex) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.id = `q-${qIndex}`;
            
            let optionsHtml = '';
            q.options.forEach((opt, oIndex) => {
                optionsHtml += `<button class="option-btn" onclick="checkAnswer(this, ${qIndex}, ${oIndex})">${opt}</button>`;
            });

            card.innerHTML = `
                <div class="question-text">C√¢u ${qIndex + 1}: ${q.question}</div>
                <div class="options-grid">${optionsHtml}</div>
                <div class="explanation-box" id="exp-${qIndex}">
                    <div class="explanation-title">
                        <span>üí° C√î MAI AN GI·∫¢I TH√çCH:</span>
                    </div>
                    <div class="explanation-content">
                        <p><b>D·ªãch c√¢u:</b> ${q.explanation.translate}</p>
                        <p><b>Ph√¢n t√≠ch 4 ƒë√°p √°n:</b></p>
                        <ul style="list-style: none; padding-left: 0;">
                            ${q.explanation.analysis.map(a => `<li>- <b>${a.opt}</b>: ${a.meaning}</li>`).join('')}
                        </ul>
                        <p>‚úÖ <b>T·∫°i sao ch·ªçn ƒë√°p √°n n√†y?</b><br>${q.explanation.whyCorrect}</p>
                        <p>‚ùå <b>T·∫°i sao c√°c ƒë√°p √°n kh√°c sai?</b><br>${q.explanation.whyWrong}</p>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function checkAnswer(btn, qIndex, oIndex) {
        if (answeredQuestions.has(qIndex)) return;
        
        answeredQuestions.add(qIndex);
        const q = fullQuestions[qIndex];
        const buttons = btn.parentElement.querySelectorAll('.option-btn');
        const expBox = document.getElementById(`exp-${qIndex}`);
        
        // Disable all buttons in this card
        buttons.forEach(b => b.disabled = true);

        if (oIndex === q.correct) {
            btn.classList.add('correct');
            correctCount++;
            playSound('correct');
            confetti({
                particleCount: 50,
                spread: 70,
                origin: { y: 0.8 },
                colors: ['#8854C0', '#00C9A7', '#00D26A']
            });
        } else {
            btn.classList.add('wrong');
            buttons[q.correct].classList.add('correct');
            document.getElementById(`q-${qIndex}`).classList.add('shake');
            playSound('wrong');
        }

        expBox.style.display = 'block';
        updateProgress();
    }

    function updateProgress() {
        const percent = (answeredQuestions.size / fullQuestions.length) * 100;
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('scoreDisplay').innerText = `ƒê√∫ng: ${correctCount}/${fullQuestions.length}`;
    }

    function showFinalResult() {
        if (answeredQuestions.size < fullQuestions.length) {
            if (!confirm("B·∫°n ch∆∞a ho√†n th√†nh h·∫øt b√†i. V·∫´n mu·ªën n·ªôp ch·ª©?")) return;
        }

        const overlay = document.getElementById('resultOverlay');
        const scoreCircle = document.getElementById('finalScoreCircle');
        const title = document.getElementById('resultTitle');
        const msg = document.getElementById('resultMsg');

        scoreCircle.innerText = `${correctCount}/${fullQuestions.length}`;
        overlay.style.display = 'flex';

        if (correctCount === fullQuestions.length) {
            title.innerText = "TH·∫¶N ƒê·ªíNG TI·∫æNG ANH!";
            msg.innerText = "C√¥ Mai An kh√¥ng c√≤n l·ªùi n√†o ƒë·ªÉ ch√™. B·∫°n ƒë√£ n·∫Øm ch·∫Øc 100% ki·∫øn th·ª©c r·ªìi ƒë·∫•y!";
            confetti({ particleCount: 200, spread: 100 });
        } else if (correctCount > fullQuestions.length * 0.8) {
            title.innerText = "QU√Å XU·∫§T S·∫ÆC!";
            msg.innerText = "Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t t·ªët. Ch·ªâ c·∫ßn c·∫©n th·∫≠n h∆°n m·ªôt ch√∫t ·ªü c√°c b·∫´y nh·ªè l√† tuy·ªát v·ªùi!";
        } else if (correctCount > fullQuestions.length * 0.5) {
            title.innerText = "C·ªê G·∫ÆNG L√äN N√ÄO!";
            msg.innerText = "B·∫°n ƒë√£ hi·ªÉu b√†i nh∆∞ng c·∫ßn √¥n t·∫≠p k·ªπ h∆°n ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥ Mai An nh√©.";
        } else {
            title.innerText = "ƒê·ª™NG N·∫¢N L√íNG NH√â!";
            msg.innerText = "Ti·∫øng Anh c·∫ßn s·ª± ki√™n tr√¨. H√£y ƒë·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch v√† th·ª≠ l√†m l·∫°i l·∫ßn n·ªØa nha.";
        }
    }

    window.onload = initQuiz;
</script>

</body>
</html>
