<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiếng Anh 9 - Mệnh đề quan hệ | Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* Tím Pastel */
            --secondary: #00C9A7; /* Xanh ngọc */
            --accent: #FF9F43; /* Cam nhấn */
            --correct: #00D26A; /* Xanh lá */
            --wrong: #FF4757; /* Đỏ cam */
            --bg-pattern: #f0f3f8;
            --text-main: #2f3542;
            --card-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Chống bôi đen để trải nghiệm giống App */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(var(--primary) 15%, transparent 16%),
                              radial-gradient(var(--secondary) 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary);
            font-weight: 800;
            font-size: 2.2rem;
            text-shadow: 2px 2px 0px #fff;
            margin: 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 8px 16px rgba(136, 84, 192, 0.2);
        }

        .teacher-name {
            font-size: 1rem;
            color: #57606f;
            margin-top: 5px;
            font-weight: 700;
            background: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        /* Quiz Container */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 80px; /* Space for submit button */
        }

        /* Question Card */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .question-card:hover {
            transform: translateY(-5px);
        }

        .question-number {
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 700;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #2f3542;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Option Buttons (3D Effect) */
        .option-btn {
            background: white;
            border: 2px solid #e1e1e1;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #57606f;
            cursor: pointer;
            position: relative;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #dfe4ea;
            text-align: left;
            outline: none;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--secondary);
            color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #dfe4ea;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #dfe4ea;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #00b85c;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #ff2e40;
            box-shadow: 0 4px 0 #ff2e40;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.8;
        }
        
        /* Style for correct answer when user chose wrong */
        .option-btn.reveal-correct {
            background-color: #ffffff;
            border-color: var(--correct);
            color: var(--correct);
            box-shadow: 0 4px 0 #00b85c;
            font-weight: 800;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 20px;
            background: #f1fbf7;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
            position: relative;
        }
        
        .explanation-box.wrong-state {
            background: #fff0f1;
            border-color: var(--wrong);
        }

        .explanation-header {
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expl-content {
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap; /* Keeps formatting from JSON */
            color: #2f3542;
        }
        
        .expl-content strong {
            color: var(--primary);
        }

        /* Floating Submit Button */
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            z-index: 100;
        }

        .btn-submit {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 5px 0 #e58e26;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #e58e26;
        }

        .btn-submit:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #e58e26;
        }

        /* Modal/Popup */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            width: 450px;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .modal-score {
            font-size: 4rem;
            font-weight: 800;
            color: var(--secondary);
            margin: 20px 0;
        }

        .modal-message {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 30px;
        }
        
        .modal-close {
            background: #a4b0be;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <header>
        <h1>Tiếng Anh 9 - Mệnh đề quan hệ</h1>
        <br>
        <span class="teacher-name">Giáo viên tạo: Ms. Mai An ULIS</span>
    </header>

    <div class="quiz-container" id="quiz-container">
        <!-- Questions will be injected here via JavaScript -->
    </div>

    <div class="submit-container">
        <button class="btn-submit" onclick="finishQuiz()">Nộp bài</button>
    </div>

    <!-- Score Modal -->
    <div class="modal-overlay" id="score-modal">
        <div class="modal-content">
            <h2>KẾT QUẢ</h2>
            <div class="modal-score" id="final-score">0/0</div>
            <div class="modal-message" id="final-message">Bạn làm tốt lắm!</div>
            <button class="modal-close" onclick="closeModal()">Xem lại bài</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <script>
        // 1. DATA FROM FILE (Không chỉnh sửa, giữ nguyên toàn vẹn)
        const quizData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "The Amazon Rainforest, __________________ is often called the “lungs of the Earth”, is home to numerous species of flora and fauna.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà (chủ ngữ).\n- which (đại từ): cái mà (vật/sự việc).\n- whom (đại từ): người mà (tân ngữ).\n- whose (đại từ): của... (sở hữu).\n2. Dịch nghĩa: \"Rừng mưa Amazon, nơi thường được gọi là 'lá phổi của Trái đất', là nhà của vô số loài động thực vật.\"\n3. Giải thích: Danh từ đứng trước (Tiền ngữ) là \"The Amazon Rainforest\" (chỉ vật/địa danh). Mệnh đề quan hệ không xác định (có dấu phẩy), đóng vai trò chủ ngữ cho động từ \"is often called\". Do đó dùng \"which\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Rừng mưa Amazon...\"\n3. Giải thích: \"Who\" chỉ dùng cho người, không dùng cho rừng mưa.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người/vật mà.\n2. Dịch nghĩa: \"Rừng mưa Amazon...\"\n3. Giải thích: Không bao giờ dùng \"that\" trong mệnh đề quan hệ không xác định (sau dấu phẩy).",
                  "isCorrect": false
                },
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của... (sở hữu).\n2. Dịch nghĩa: \"Rừng mưa Amazon...\"\n3. Giải thích: Ở đây cần một chủ ngữ cho mệnh đề phụ, không cần chỉ sự sở hữu.",
                  "isCorrect": false
                }
              ],
              "hint": "Danh từ phía trước chỉ sự vật, mệnh đề có dấu phẩy."
            },
            {
              "questionNumber": 2,
              "question": "Bill Clinton, __________________ wife is a brilliant lawyer, became the President of the US in 1993.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- whom (đại từ): người mà (tân ngữ).\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà (sở hữu).\n2. Dịch nghĩa: \"Bill Clinton, người có vợ là một luật sư xuất sắc, đã trở thành Tổng thống Mỹ năm 1993.\"\n3. Giải thích: Mối quan hệ giữa \"Bill Clinton\" và \"wife\" là quan hệ sở hữu (vợ CỦA Bill Clinton). Ta dùng \"whose\" để chỉ sự sở hữu.",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Bill Clinton...\"\n3. Giải thích: \"Who\" làm chủ ngữ, nhưng ở đây danh từ \"wife\" theo sau cần một từ chỉ sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Bill Clinton...\"\n3. Giải thích: \"Whom\" dùng làm tân ngữ, không chỉ sự sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Bill Clinton...\"\n3. Giải thích: \"Which\" chỉ dùng cho vật.",
                  "isCorrect": false
                }
              ],
              "hint": "Vợ CỦA ông ấy."
            },
            {
              "questionNumber": 3,
              "question": "Mrs Smith, __________________ has a lot of teaching experience at junior level, will be joining the school in September.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà (chủ ngữ).\n- whom (đại từ): người mà (tân ngữ).\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Bà Smith, người có nhiều kinh nghiệm giảng dạy ở cấp trung học cơ sở, sẽ gia nhập trường vào tháng Chín.\"\n3. Giải thích: Tiền ngữ là \"Mrs Smith\" (người). Chỗ trống cần một Chủ ngữ cho động từ \"has\". Do đó dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Bà Smith...\"\n3. Giải thích: \"Whom\" chỉ làm tân ngữ, không thể làm chủ ngữ cho động từ \"has\".",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Bà Smith...\"\n3. Giải thích: \"Which\" không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người/vật mà.\n2. Dịch nghĩa: \"Bà Smith...\"\n3. Giải thích: Không dùng \"that\" trong mệnh đề quan hệ có dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Cần chủ ngữ chỉ người."
            },
            {
              "questionNumber": 4,
              "question": "Sydney, __________________ has a population of more than three million, is Australia’s largest city.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n- which (đại từ): cái mà (vật/địa danh).\n- who (đại từ): người mà.\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Sydney, nơi có dân số hơn 3 triệu người, là thành phố lớn nhất nước Úc.\"\n3. Giải thích: Tiền ngữ là \"Sydney\" (vật/địa danh). Mệnh đề sau dấu phẩy cần một Chủ ngữ cho động từ \"has\". Dùng \"which\".",
                  "isCorrect": true
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Sydney...\"\n3. Giải thích: \"Where\" = \"in which\", dùng làm trạng ngữ chỉ nơi chốn, không thể làm chủ ngữ cho động từ \"has\". (Không nói: \"In Sydney has a population...\").",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Sydney...\"\n3. Giải thích: Không dùng cho địa danh.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Sydney...\"\n3. Giải thích: Không dùng \"that\" sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Chủ ngữ chỉ vật/địa danh cho động từ 'has'."
            },
            {
              "questionNumber": 5,
              "question": "Darwin, __________________ views changed our view of the world, travelled to a lot of countries.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- whose (đại từ): của... (sở hữu).\n- whom (đại từ): người mà (tân ngữ).\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Darwin, người mà những quan điểm của ông đã thay đổi cái nhìn của chúng ta về thế giới, đã đi du lịch đến rất nhiều quốc gia.\"\n3. Giải thích: \"Views\" (quan điểm) thuộc về \"Darwin\". Mối quan hệ sở hữu -> dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Darwin...\"\n3. Giải thích: Không thể hiện được sự sở hữu với danh từ \"views\" phía sau.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Darwin...\"\n3. Giải thích: Darwin là người, không dùng \"which\".",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người/vật mà.\n2. Dịch nghĩa: \"Darwin...\"\n3. Giải thích: Không dùng sau dấu phẩy và không chỉ sở hữu.",
                  "isCorrect": false
                }
              ],
              "hint": "Quan điểm CỦA Darwin."
            },
            {
              "questionNumber": 6,
              "question": "The hijacker gave himself up to police, __________________ are now questioning him.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n- who (đại từ): người mà.\n- whom (đại từ): người mà.\n- whose (đại từ): của...\n2. Dịch nghĩa: \"Kẻ không tặc đã đầu hàng cảnh sát, những người hiện đang thẩm vấn hắn.\"\n3. Giải thích: Tiền ngữ là \"police\" (cảnh sát - danh từ tập hợp chỉ người). Động từ phía sau là \"are\". Cần chủ ngữ chỉ người -> dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Cảnh sát...\"\n3. Giải thích: Cảnh sát là người, không dùng \"which\".",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Cảnh sát...\"\n3. Giải thích: Cần chủ ngữ cho động từ \"are\", không phải tân ngữ.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Cảnh sát...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Cảnh sát là danh từ chỉ nhóm người."
            },
            {
              "questionNumber": 7,
              "question": "We are going to see the new Tom Carter film, __________________ was released on Friday.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- which (đại từ): cái mà.\n- that (đại từ): cái mà.\n- when (trạng từ): khi mà.\n2. Dịch nghĩa: \"Chúng tôi định đi xem bộ phim mới của Tom Carter, cái mà đã được phát hành vào thứ Sáu.\"\n3. Giải thích: Tiền ngữ là \"film\" (vật). Mệnh đề có dấu phẩy -> dùng \"which\".",
                  "isCorrect": true
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Bộ phim...\"\n3. Giải thích: Không dùng \"that\" sau dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Bộ phim...\"\n3. Giải thích: Phim là vật, không dùng \"who\".",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Bộ phim...\"\n3. Giải thích: Cần chủ ngữ cho động từ \"was released\", không phải trạng từ chỉ nơi chốn.",
                  "isCorrect": false
                }
              ],
              "hint": "Bộ phim (vật), mệnh đề không xác định."
            },
            {
              "questionNumber": 8,
              "question": "Mr Sheldon, __________________ has devoted his time to cleaning up beaches, helps protect the marine ecosystems.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà (chủ ngữ).\n- whom (đại từ): người mà (tân ngữ).\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Ông Sheldon, người đã dành thời gian của mình để làm sạch các bãi biển, giúp bảo vệ hệ sinh thái biển.\"\n3. Giải thích: Tiền ngữ \"Mr Sheldon\" (người). Cần chủ ngữ cho động từ \"has devoted\". Dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Ông Sheldon...\"\n3. Giải thích: \"Whom\" là tân ngữ, không thể làm chủ ngữ.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Ông Sheldon...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Ông Sheldon...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Chủ ngữ chỉ người."
            },
            {
              "questionNumber": 9,
              "question": "Tina got very good marks in the exam, __________________ pleased her parents and teachers.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n- who (đại từ): người mà.\n- which (đại từ): điều mà (thay thế cả mệnh đề).\n- what (đại từ): điều gì.\n2. Dịch nghĩa: \"Tina đạt điểm rất cao trong kỳ thi, điều này làm hài lòng cha mẹ và thầy cô của cô ấy.\"\n3. Giải thích: Đây là trường hợp dùng \"which\" để thay thế cho cả một mệnh đề phía trước (việc Tina đạt điểm cao).",
                  "isCorrect": true
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Điều này...\"\n3. Giải thích: Không dùng \"that\" sau dấu phẩy và để thay thế cả mệnh đề.",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Điều này...\"\n3. Giải thích: Không dùng cho sự việc.",
                  "isCorrect": false
                },
                {
                  "text": "what",
                  "rationale": "1. Phân tích từ vựng:\n- what (đại từ): cái gì.\n2. Dịch nghĩa: \"Điều này...\"\n3. Giải thích: \"What\" không dùng làm đại từ quan hệ nối hai mệnh đề theo cách này.",
                  "isCorrect": false
                }
              ],
              "hint": "Thay thế cho cả sự việc 'Tina đạt điểm cao'."
            },
            {
              "questionNumber": 10,
              "question": "Charles Darwin, __________________ is best known for his theory of evolution, was an English biologist.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- whom (đại từ): người mà.\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Charles Darwin, người nổi tiếng nhất với thuyết tiến hóa của mình, là một nhà sinh học người Anh.\"\n3. Giải thích: Tiền ngữ \"Charles Darwin\" (người). Cần chủ ngữ cho động từ \"is\". Dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không làm chủ ngữ.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                }
              ],
              "hint": "Chủ ngữ chỉ người."
            },
            {
              "questionNumber": 11,
              "question": "The endangered sea turtles, __________________ nesting grounds are threatened by humans, face an uncertain future.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- which (đại từ): cái mà.\n- that (đại từ): cái mà.\n- whose (đại từ): của... (sở hữu).\n2. Dịch nghĩa: \"Những con rùa biển có nguy cơ tuyệt chủng, mà bãi đẻ trứng của chúng bị đe dọa bởi con người, đang đối mặt với một tương lai bất định.\"\n3. Giải thích: \"Nesting grounds\" (bãi đẻ) là nơi thuộc về \"sea turtles\". Quan hệ sở hữu -> dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Rùa biển...\"\n3. Giải thích: Không chỉ sự sở hữu. Nếu dùng \"which\" phải là \"the nesting grounds of which\" (cấu trúc phức tạp ít dùng hơn).",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Rùa biển...\"\n3. Giải thích: Thường không dùng cho động vật (trừ khi nhân cách hóa) và không chỉ sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Rùa biển...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Bãi đẻ trứng CỦA rùa biển."
            },
            {
              "questionNumber": 12,
              "question": "The Himalayas, __________________ peaks are known as the “Roof of the World”, are a mountain range in Asia.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n- where (trạng từ): nơi mà.\n- whose (đại từ): của... (sở hữu).\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Dãy Himalaya, nơi có những đỉnh núi được mệnh danh là 'Nóc nhà thế giới', là một dãy núi ở châu Á.\"\n3. Giải thích: \"Peaks\" (đỉnh núi) thuộc về \"The Himalayas\". Quan hệ sở hữu -> dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Dãy Himalaya...\"\n3. Giải thích: Không chỉ sở hữu. (Không thể nói: \"Himalayas which peaks...\").",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Dãy Himalaya...\"\n3. Giải thích: \"Where\" không đi kèm ngay với danh từ \"peaks\" để chỉ sở hữu. (\"Where peaks are...\" nghĩa là \"nơi mà các đỉnh núi là...\" thì đúng ngữ pháp nhưng sai nghĩa sở hữu của dãy núi).",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Dãy Himalaya...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Đỉnh núi CỦA dãy Himalaya."
            },
            {
              "questionNumber": 13,
              "question": "Marie Curie, (whom / who) discovered radioactivity, was a brilliant scientist.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà (chủ ngữ).\n- whom (đại từ): người mà (tân ngữ).\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Marie Curie, người đã khám phá ra phóng xạ, là một nhà khoa học lỗi lạc.\"\n3. Giải thích: Cần Chủ ngữ cho động từ \"discovered\". Dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Marie Curie...\"\n3. Giải thích: \"Whom\" là tân ngữ, không thể làm chủ ngữ.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Marie Curie...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Marie Curie...\"\n3. Giải thích: Không có danh từ bị sở hữu theo sau.",
                  "isCorrect": false
                }
              ],
              "hint": "Chủ ngữ chỉ người."
            },
            {
              "questionNumber": 14,
              "question": "The giant sequoia, (which / that) can live for thousands of years, is the largest living tree on Earth.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n- that (đại từ): cái mà.\n- who (đại từ): người mà.\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Cây sequoia khổng lồ, loài có thể sống hàng nghìn năm, là loài cây sống lớn nhất trên Trái đất.\"\n3. Giải thích: Mệnh đề quan hệ không xác định (có dấu phẩy), chỉ vật. Bắt buộc dùng \"which\", không dùng \"that\".",
                  "isCorrect": true
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Cây sequoia...\"\n3. Giải thích: Sai quy tắc dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Cây sequoia...\"\n3. Giải thích: Không dùng cho cây cối.",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Cây sequoia...\"\n3. Giải thích: Cần chủ ngữ cho động từ \"can live\", không phải trạng từ nơi chốn.",
                  "isCorrect": false
                }
              ],
              "hint": "Mệnh đề chỉ vật có dấu phẩy."
            },
            {
              "questionNumber": 15,
              "question": "Jane Goodall, (whose / who) work with chimpanzees is famous, is a passionate advocate for animal welfare.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của người mà (sở hữu).\n- who (đại từ): người mà.\n- whom (đại từ): người mà.\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Jane Goodall, người có công trình nghiên cứu với tinh tinh rất nổi tiếng, là một người ủng hộ nhiệt thành cho phúc lợi động vật.\"\n3. Giải thích: \"Work\" (công trình/công việc) là danh từ thuộc sở hữu của Jane Goodall. Dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Jane Goodall...\"\n3. Giải thích: Không chỉ sự sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà.\n2. Dịch nghĩa: \"Jane Goodall...\"\n3. Giải thích: Là tân ngữ, không chỉ sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Jane Goodall...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Công việc CỦA bà ấy."
            },
            {
              "questionNumber": 16,
              "question": "The solar panels, (which / whom) we installed last year, have significantly reduced our electricity bill.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n- whom (đại từ): người mà.\n- who (đại từ): người mà.\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Những tấm pin năng lượng mặt trời, cái mà chúng tôi đã lắp đặt năm ngoái, đã giảm đáng kể hóa đơn tiền điện.\"\n3. Giải thích: \"Solar panels\" là vật. Đóng vai trò tân ngữ cho \"installed\". Dùng \"which\".",
                  "isCorrect": true
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà.\n2. Dịch nghĩa: \"Tấm pin...\"\n3. Giải thích: \"Whom\" chỉ dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Tấm pin...\"\n3. Giải thích: Không dùng cho vật.",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Tấm pin...\"\n3. Giải thích: Không chỉ nơi chốn trong ngữ cảnh này.",
                  "isCorrect": false
                }
              ],
              "hint": "Tân ngữ chỉ vật."
            },
            {
              "questionNumber": 17,
              "question": "The ozone layer, (which / whose) depletion is linked to climate change, protects Earth from harmful ultraviolet radiation.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của... (sở hữu).\n- which (đại từ): cái mà.\n- that (đại từ): cái mà.\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Tầng ozone, nơi mà sự suy giảm của nó liên quan đến biến đổi khí hậu, bảo vệ Trái đất khỏi bức xạ cực tím có hại.\"\n3. Giải thích: \"Depletion\" (sự suy giảm) là danh từ thuộc về \"The ozone layer\". Quan hệ sở hữu -> dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Tầng ozone...\"\n3. Giải thích: Không chỉ sự sở hữu. (Không nói \"which depletion\").",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Tầng ozone...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Tầng ozone...\"\n3. Giải thích: Không phù hợp ngữ pháp.",
                  "isCorrect": false
                }
              ],
              "hint": "Sự suy giảm CỦA tầng ozone."
            },
            {
              "questionNumber": 18,
              "question": "Oceanographers, (that / who) study the world’s oceans, are crucial for understanding marine life.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- that (đại từ): người mà.\n- which (đại từ): cái mà.\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Các nhà hải dương học, những người nghiên cứu các đại dương trên thế giới, rất quan trọng để hiểu về sinh vật biển.\"\n3. Giải thích: \"Oceanographers\" là người. Mệnh đề có dấu phẩy -> dùng \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Nhà hải dương học...\"\n3. Giải thích: Không dùng \"that\" sau dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Nhà hải dương học...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà (tân ngữ).\n2. Dịch nghĩa: \"Nhà hải dương học...\"\n3. Giải thích: Cần chủ ngữ cho động từ \"study\".",
                  "isCorrect": false
                }
              ],
              "hint": "Chủ ngữ chỉ người, mệnh đề có dấu phẩy."
            },
            {
              "questionNumber": 19,
              "question": "The very first man (who / that) walked on the moon, Neil Armstrong, became an international symbol of exploration.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà (thường dùng sau so sánh nhất/số thứ tự).\n- who (đại từ): người mà.\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Người đàn ông đầu tiên đi bộ trên mặt trăng, Neil Armstrong, đã trở thành biểu tượng quốc tế của sự thám hiểm.\"\n3. Giải thích: Sau các từ chỉ thứ tự như \"the first\", \"the last\", \"the only\"... người ta ưu tiên dùng \"that\" hơn là \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Người đàn ông đầu tiên...\"\n3. Giải thích: Tuy có thể dùng trong giao tiếp, nhưng về ngữ pháp chuẩn mực, \"that\" được ưu tiên hơn sau \"the very first\".",
                  "isCorrect": false
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Người đàn ông đầu tiên...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Người đàn ông đầu tiên...\"\n3. Giải thích: Không chỉ sở hữu.",
                  "isCorrect": false
                }
              ],
              "hint": "Sau 'The very first', ưu tiên dùng 'that'."
            },
            {
              "questionNumber": 20,
              "question": "Charles Darwin, (who / whose) theory of evolution revolutionized biology, studied finches in the Galapagos Islands.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của người mà (sở hữu).\n- who (đại từ): người mà.\n- whom (đại từ): người mà.\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Charles Darwin, người mà thuyết tiến hóa của ông đã cách mạng hóa sinh học, đã nghiên cứu loài chim sẻ trên quần đảo Galapagos.\"\n3. Giải thích: \"Theory\" (lý thuyết) thuộc về Darwin. Quan hệ sở hữu -> dùng \"whose\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không chỉ sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà.\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không chỉ sở hữu.",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): người mà.\n2. Dịch nghĩa: \"Charles Darwin...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                }
              ],
              "hint": "Lý thuyết CỦA ông ấy."
            },
            {
              "questionNumber": 21,
              "question": "Many species of whales, (who / which) communicate through complex songs, are facing extinction.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà (dùng cho vật/động vật).\n- who (đại từ): người mà.\n- that (đại từ): cái mà.\n- whom (đại từ): người mà.\n2. Dịch nghĩa: \"Nhiều loài cá voi, loài giao tiếp qua những bài hát phức tạp, đang đối mặt với sự tuyệt chủng.\"\n3. Giải thích: Cá voi là động vật. Mệnh đề có dấu phẩy. Dùng \"which\".",
                  "isCorrect": true
                },
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n2. Dịch nghĩa: \"Cá voi...\"\n3. Giải thích: Thường chỉ dùng cho con người. (Trừ khi nhân cách hóa mạnh mẽ trong văn học, nhưng ngữ pháp chuẩn dùng \"which\").",
                  "isCorrect": false
                },
                {
                  "text": "that",
                  "rationale": "1. Phân tích từ vựng:\n- that (đại từ): cái mà.\n2. Dịch nghĩa: \"Cá voi...\"\n3. Giải thích: Không dùng sau dấu phẩy.",
                  "isCorrect": false
                },
                {
                  "text": "whom",
                  "rationale": "1. Phân tích từ vựng:\n- whom (đại từ): người mà.\n2. Dịch nghĩa: \"Cá voi...\"\n3. Giải thích: Dùng cho người.",
                  "isCorrect": false
                }
              ],
              "hint": "Động vật, mệnh đề có dấu phẩy."
            },
            {
              "questionNumber": 22,
              "question": "We need more scientists (who / which) are passionate about finding solutions to environmental problems.",
              "imageUrl": "",
              "answerOptions": [
                {
                  "text": "who",
                  "rationale": "1. Phân tích từ vựng:\n- who (đại từ): người mà.\n- which (đại từ): cái mà.\n- whose (đại từ): của người mà.\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Chúng ta cần nhiều nhà khoa học hơn, những người đam mê tìm kiếm giải pháp cho các vấn đề môi trường.\"\n3. Giải thích: \"Scientists\" là người. Cần chủ ngữ cho \"are\". Dùng \"who\" (hoặc \"that\" - nếu có). Trong ngoặc chỉ cho chọn \"who\" hoặc \"which\", nên chọn \"who\".",
                  "isCorrect": true
                },
                {
                  "text": "which",
                  "rationale": "1. Phân tích từ vựng:\n- which (đại từ): cái mà.\n2. Dịch nghĩa: \"Nhà khoa học...\"\n3. Giải thích: Không dùng cho người.",
                  "isCorrect": false
                },
                {
                  "text": "whose",
                  "rationale": "1. Phân tích từ vựng:\n- whose (đại từ): của người mà.\n2. Dịch nghĩa: \"Nhà khoa học...\"\n3. Giải thích: Không chỉ sở hữu ở đây.",
                  "isCorrect": false
                },
                {
                  "text": "where",
                  "rationale": "1. Phân tích từ vựng:\n- where (trạng từ): nơi mà.\n2. Dịch nghĩa: \"Nhà khoa học...\"\n3. Giải thích: Không chỉ nơi chốn.",
                  "isCorrect": false
                }
              ],
              "hint": "Nhà khoa học là người."
            }
          ]
        };

        // Global State
        let correctCount = 0;
        let answeredQuestions = new Set();
        
        // Audio Context for sound generation (No external files needed)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // Ding sound (Sine wave, high pitch, short decay)
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else {
                // Buzz sound (Sawtooth, low pitch, wobbly)
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // 2. RENDER FUNCTIONS
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            
            quizData.questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                questionDiv.id = `q-${index}`;

                // Image logic
                const imgHtml = q.imageUrl ? `<div style="text-align:center; margin-bottom:15px;"><img src="${q.imageUrl}" style="max-width:100%; border-radius:10px;"></div>` : '';

                // Options HTML
                let optionsHtml = '<div class="options-grid">';
                q.answerOptions.forEach((opt, optIndex) => {
                    optionsHtml += `
                        <button class="option-btn" 
                                id="btn-${index}-${optIndex}"
                                onclick="checkAnswer(${index}, ${optIndex}, ${opt.isCorrect})">
                            ${String.fromCharCode(65 + optIndex)}. ${opt.text}
                        </button>
                    `;
                });
                optionsHtml += '</div>';

                // Explanation HTML (Formatted for new lines)
                // We find the correct rationale from the correct option
                const correctOption = q.answerOptions.find(opt => opt.isCorrect);
                const rationaleText = correctOption.rationale.replace(/\n/g, '<br>');

                const explanationHtml = `
                    <div class="explanation-box" id="expl-${index}">
                        <div class="explanation-header" id="expl-header-${index}">
                            <span>💡</span> <span>Giải thích chi tiết của Ms. Mai An:</span>
                        </div>
                        <div class="expl-content">
                            ${rationaleText}
                        </div>
                    </div>
                `;

                questionDiv.innerHTML = `
                    <div class="question-number">Câu ${q.questionNumber}</div>
                    ${imgHtml}
                    <div class="question-text">${q.question}</div>
                    ${optionsHtml}
                    ${explanationHtml}
                `;

                container.appendChild(questionDiv);
            });
        }

        // 3. INTERACTION LOGIC
        function checkAnswer(questionIndex, optionIndex, isCorrect) {
            // Prevent re-answering
            if (answeredQuestions.has(questionIndex)) return;
            answeredQuestions.add(questionIndex);

            const btn = document.getElementById(`btn-${questionIndex}-${optionIndex}`);
            const explBox = document.getElementById(`expl-${questionIndex}`);
            const explHeader = document.getElementById(`expl-header-${questionIndex}`);

            // Disable all buttons in this question
            const allBtns = document.querySelectorAll(`#q-${questionIndex} .option-btn`);
            allBtns.forEach(b => b.disabled = true);

            if (isCorrect) {
                // Correct Logic
                btn.classList.add('correct');
                correctCount++;
                playSound('correct');
                explHeader.style.color = 'var(--correct)';
                triggerConfetti();
            } else {
                // Wrong Logic
                btn.classList.add('wrong');
                playSound('wrong');
                explBox.classList.add('wrong-state');
                explHeader.style.color = 'var(--wrong)';
                
                // Highlight the correct answer automatically
                const question = quizData.questions[questionIndex];
                question.answerOptions.forEach((opt, idx) => {
                    if (opt.isCorrect) {
                        document.getElementById(`btn-${questionIndex}-${idx}`).classList.add('reveal-correct');
                    }
                });
            }

            // Show explanation immediately
            explBox.style.display = 'block';
        }

        function finishQuiz() {
            const total = quizData.questions.length;
            const scoreElement = document.getElementById('final-score');
            const msgElement = document.getElementById('final-message');
            const modal = document.getElementById('score-modal');

            scoreElement.innerText = `${correctCount}/${total}`;
            
            // Funny messages based on score
            const percentage = correctCount / total;
            if (percentage === 1) msgElement.innerText = "Tuyệt vời! Bạn là thiên tài Tiếng Anh! 🏆";
            else if (percentage >= 0.8) msgElement.innerText = "Làm tốt lắm! Gần đạt điểm tuyệt đối rồi! 🌟";
            else if (percentage >= 0.5) msgElement.innerText = "Khá lắm, nhưng cần cố gắng thêm nhé! 💪";
            else msgElement.innerText = "Đừng buồn, hãy xem kỹ lại phần giải thích nhé! 📚";

            modal.style.display = 'flex';
            playSound('correct'); // Celebration sound
            if (percentage > 0.5) triggerConfetti();
        }

        function closeModal() {
            document.getElementById('score-modal').style.display = 'none';
        }

        // 4. CONFETTI LOGIC (Simplified Version)
        function triggerConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const particleCount = 100;
            const colors = ['#8854C0', '#00C9A7', '#FF9F43', '#FF4757', '#00D26A'];

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 15,
                    vy: (Math.random() - 0.5) * 15,
                    size: Math.random() * 8 + 4,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    life: 100
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let activeParticles = false;

                particles.forEach(p => {
                    if (p.life > 0) {
                        activeParticles = true;
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.5; // Gravity
                        p.life--;
                        p.size *= 0.95;

                        ctx.fillStyle = p.color;
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });

                if (activeParticles) requestAnimationFrame(animate);
                else ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            animate();
        }

        // Initialize
        window.onload = renderQuiz;

    </script>
</body>
</html>
