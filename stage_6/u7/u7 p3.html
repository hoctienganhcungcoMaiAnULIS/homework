<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Th√¨ Qu√° Kh·ª© Ti·∫øp Di·ªÖn - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* H·ªìng t√≠m pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f3f5;
            --card-bg: #ffffff;
            --text-color: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(#d1d8e0 2px, transparent 2px), radial-gradient(#d1d8e0 2px, transparent 2px);
            background-size: 32px 32px;
            background-position: 0 0, 16px 16px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .header-gv {
            text-align: center;
            font-family: 'Quicksand', sans-serif;
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(255, 255, 255, 0.9);
            display: inline-block;
            padding: 5px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* THEORY SECTION */
        .theory-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 #e0e0e0;
            border: 2px solid #f1f1f1;
        }

        .theory-card h2 {
            color: var(--primary);
            border-bottom: 3px dashed var(--secondary);
            padding-bottom: 10px;
        }

        .theory-card h3 {
            color: var(--secondary);
            margin-top: 20px;
        }

        .theory-content {
            font-size: 1rem;
            line-height: 1.6;
        }

        .example-box {
            background: #f0fcf9;
            border-left: 5px solid var(--secondary);
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        /* QUIZ SECTION */
        .quiz-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid #eee;
        }

        .question-number {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: block;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            position: relative;
            box-shadow: 0 4px 0 #e0e0e0;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .option-btn:hover {
            transform: scale(1.02);
            background-color: #f9f9f9;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #e0e0e0;
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #009e4f;
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            color: white;
            border-color: #ff2e40;
            box-shadow: 0 4px 0 #d61c2d;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        /* EXPLANATION BOX */
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fff5f7;
            border: 2px solid var(--primary);
            border-radius: 15px;
            animation: fadeIn 0.5s ease;
        }

        .explanation h4 {
            color: var(--primary);
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
        }

        .explanation h4::before {
            content: "üí°";
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .exp-step {
            margin-bottom: 10px;
            padding-left: 15px;
            border-left: 3px solid #ddd;
        }

        .exp-title {
            font-weight: 800;
            color: #555;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .exp-content {
            color: #333;
        }

        .vocab-list {
            list-style: none;
            padding: 0;
        }

        .vocab-list li {
            background: rgba(255,255,255,0.6);
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 5px;
        }

        /* CONTROLS */
        .controls {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 6px 0 #009e82;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            transition: all 0.2s;
        }

        .submit-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 3rem;
            color: var(--secondary);
            font-weight: 800;
            margin: 20px 0;
        }

        /* CONFETTI */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        u {
            text-decoration: underline;
            text-underline-offset: 3px;
            text-decoration-thickness: 2px;
            text-decoration-color: var(--primary);
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <div style="text-align: center;">
            <div class="header-gv">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        </div>

        <div class="theory-card">
            <h2>L√ù THUY·∫æT: TH√å QU√Å KH·ª® TI·∫æP DI·ªÑN</h2>
            <div class="theory-content">
                <h3>1. C·∫•u tr√∫c</h3>
                <p><strong>1.1. Kh·∫≥ng ƒë·ªãnh:</strong> S + was/were + V-ing</p>
                <div class="example-box">
                    ‚Ä¢ She <b>was cooking</b> dinner at 5 p.m yesterday.<br>
                    ‚Ä¢ They <b>were playing</b> badminton when I came yesterday.
                </div>

                <p><strong>1.2. Ph·ªß ƒë·ªãnh:</strong> S + wasn‚Äôt/ weren‚Äôt + V-ing</p>
                <div class="example-box">
                    ‚Ä¢ He <b>wasn‚Äôt working</b> when his boss came yesterday.<br>
                    ‚Ä¢ We <b>weren‚Äôt watching</b> TV at 9 p.m yesterday.
                </div>

                <p><strong>1.3. C√¢u h·ªèi:</strong> Was/ Were + S + V-ing?</p>
                <div class="example-box">
                    ‚Ä¢ <b>Was</b> your mother <b>going</b> to the market at 7 a.m yesterday?<br>
                    ‚Ä¢ <b>Were</b> they <b>staying</b> with you when I called you yesterday?
                </div>

                <h3>2. C√°ch s·ª≠ d·ª•ng</h3>
                <p><strong>2.1. H√†nh ƒë·ªông ƒëang x·∫£y ra t·∫°i th·ªùi ƒëi·ªÉm x√°c ƒë·ªãnh trong qu√° kh·ª©:</strong></p>
                <div class="example-box">At 12 o‚Äôclock yesterday, we were having lunch.</div>

                <p><strong>2.2. H√†nh ƒë·ªông ƒëang x·∫£y ra (QKTD) th√¨ h√†nh ƒë·ªông kh√°c xen v√†o (QKƒê):</strong></p>
                <p>D√πng "When" ho·∫∑c "As":</p>
                <div class="example-box">
                    ‚Ä¢ I <b>was watching</b> TV when he <b>phoned</b> me.<br>
                    ‚Ä¢ As we <b>were playing</b> football, the bell <b>rang</b>.
                </div>
                <p><i>M·∫πo: H√†nh ƒë·ªông d√†i -> QKTD (was/were Ving). H√†nh ƒë·ªông ng·∫Øn -> QKƒê (Ved/V2).</i></p>

                <p><strong>2.3. Hai h√†nh ƒë·ªông x·∫£y ra song song:</strong></p>
                <p>D√πng "While":</p>
                <div class="example-box">
                    ‚Ä¢ While Ellen <b>was reading</b>, Tim <b>was watching</b> television.
                </div>

                <h3>3. D·∫•u hi·ªáu nh·∫≠n bi·∫øt</h3>
                <ul>
                    <li>at + gi·ªù + th·ªùi gian qu√° kh·ª© (at 8 p.m last night)</li>
                    <li>at this time + th·ªùi gian qu√° kh·ª© (at this time yesterday)</li>
                    <li>all day yesterday, all yesterday morning</li>
                    <li>Khi c√≥ <b>When, While, As</b> trong c√¢u k·ªÉ v·ªÅ qu√° kh·ª©.</li>
                </ul>
            </div>
        </div>

        <div id="quiz-container">
            </div>

        <div class="controls">
            <button class="submit-btn" onclick="showResult()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
        </div>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ C·ª¶A CON</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p id="feedback-msg" style="font-size: 1.2rem; color: #555;">Con l√†m t·ªët l·∫Øm!</p>
            <button class="submit-btn" onclick="closeModal()" style="font-size: 1rem; padding: 10px 30px; margin-top: 15px;">ƒê√≥ng</button>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu c√¢u h·ªèi (30 c√¢u - Generated based on provided theory)
        const questions = [
            {
                q: "At 8 p.m. last night, I ______ my homework.",
                options: ["A. did", "B. was doing", "C. do", "D. am doing"],
                correct: 1, // B
                exp: {
                    vi: "V√†o l√∫c 8 gi·ªù t·ªëi qua, t√¥i ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√†.",
                    vocab: [
                        "A. did (v - qu√° kh·ª© ƒë∆°n): ƒë√£ l√†m",
                        "B. was doing (v - qu√° kh·ª© ti·∫øp di·ªÖn): ƒëang l√†m",
                        "C. do (v - hi·ªán t·∫°i): l√†m",
                        "D. am doing (v - hi·ªán t·∫°i ti·∫øp di·ªÖn): ƒëang l√†m"
                    ],
                    why: "C√≥ 'At 8 p.m. last night' (gi·ªù c·ª• th·ªÉ trong qu√° kh·ª©) -> D√πng th√¨ Qu√° kh·ª© ti·∫øp di·ªÖn. C·∫•u tr√∫c: I + was + V-ing.",
                    wrong: "A l√† qu√° kh·ª© ƒë∆°n (d√πng cho h√†nh ƒë·ªông ƒë√£ xong). C, D sai th√¨."
                }
            },
            {
                q: "They ______ football when it started to rain.",
                options: ["A. played", "B. are playing", "C. were playing", "D. play"],
                correct: 2,
                exp: {
                    vi: "H·ªç ƒëang ch∆°i b√≥ng ƒë√° th√¨ tr·ªùi b·∫Øt ƒë·∫ßu m∆∞a.",
                    vocab: [
                        "A. played (v - QKƒê): ƒë√£ ch∆°i",
                        "B. are playing (v - HTTD): ƒëang ch∆°i",
                        "C. were playing (v - QKTD): ƒëang ch∆°i (trong qu√° kh·ª©)",
                        "D. play (v - HTƒê): ch∆°i"
                    ],
                    why: "H√†nh ƒë·ªông 'ch∆°i b√≥ng' l√† h√†nh ƒë·ªông d√†i ƒëang x·∫£y ra (QKTD) th√¨ h√†nh ƒë·ªông 'm∆∞a' (started - QKƒê) xen v√†o. C·∫•u tr√∫c: They + were + V-ing.",
                    wrong: "A ch·ªâ h√†nh ƒë·ªông ƒë√£ k·∫øt th√∫c. B, D sai th√¨ v√¨ s·ª± vi·ªác ·ªü qu√° kh·ª©."
                }
            },
            {
                q: "While my mother ______ dinner, my father was reading the newspaper.",
                options: ["A. cooked", "B. was cooking", "C. is cooking", "D. cooks"],
                correct: 1,
                exp: {
                    vi: "Trong khi m·∫π t√¥i ƒëang n·∫•u b·ªØa t·ªëi, b·ªë t√¥i ƒëang ƒë·ªçc b√°o.",
                    vocab: [
                        "A. cooked (v): ƒë√£ n·∫•u",
                        "B. was cooking (v): ƒëang n·∫•u",
                        "C. is cooking (v): ƒëang n·∫•u (hi·ªán t·∫°i)",
                        "D. cooks (v): n·∫•u"
                    ],
                    why: "D√πng 'While' di·ªÖn t·∫£ 2 h√†nh ƒë·ªông x·∫£y ra song song c√πng l√∫c trong qu√° kh·ª©. C·∫£ 2 v·∫ø ƒë·ªÅu d√πng Qu√° kh·ª© ti·∫øp di·ªÖn.",
                    wrong: "A d√πng cho h√†nh ƒë·ªông ng·∫Øn/ƒë√£ xong. C, D sai th√¨."
                }
            },
            {
                q: "What ______ you ______ at this time yesterday?",
                options: ["A. did / do", "B. were / doing", "C. was / doing", "D. do / do"],
                correct: 1,
                exp: {
                    vi: "B·∫°n ƒëang l√†m g√¨ v√†o th·ªùi ƒëi·ªÉm n√†y ng√†y h√¥m qua?",
                    vocab: [
                        "A. did/do (QKƒê)",
                        "B. were/doing (QKTD - You)",
                        "C. was/doing (QKTD - I/He/She)",
                        "D. do/do (HTƒê)"
                    ],
                    why: "D·∫•u hi·ªáu 'at this time yesterday' -> Qu√° kh·ª© ti·∫øp di·ªÖn. Ch·ªß ng·ªØ l√† 'you' n√™n ƒëi v·ªõi 'were'.",
                    wrong: "A l√† QKƒê. C sai tobe (you ƒëi v·ªõi were). D sai th√¨."
                }
            },
            {
                q: "He ______ working when his boss came yesterday.",
                options: ["A. wasn't", "B. weren't", "C. didn't", "D. isn't"],
                correct: 0,
                exp: {
                    vi: "Anh ·∫•y ƒëang kh√¥ng l√†m vi·ªác khi s·∫øp anh ·∫•y ƒë·∫øn h√¥m qua.",
                    vocab: [
                        "A. wasn't (tobe - QKTD s·ªë √≠t)",
                        "B. weren't (tobe - QKTD s·ªë nhi·ªÅu)",
                        "C. didn't (tr·ª£ t·ª´ - QKƒê)",
                        "D. isn't (tobe - HTTD)"
                    ],
                    why: "C·∫•u tr√∫c ph·ªß ƒë·ªãnh QKTD: S + wasn't/weren't + V-ing. Ch·ªß ng·ªØ 'He' (s·ªë √≠t) d√πng 'wasn't'.",
                    wrong: "B d√πng cho s·ªë nhi·ªÅu. C ƒëi v·ªõi V nguy√™n th·ªÉ (kh√¥ng c√≥ working). D sai th√¨."
                }
            },
            {
                q: "I ______ down the street when I saw her.",
                options: ["A. walked", "B. am walking", "C. was walking", "D. walk"],
                correct: 2,
                exp: {
                    vi: "T√¥i ƒëang ƒëi b·ªô xu·ªëng ph·ªë th√¨ nh√¨n th·∫•y c√¥ ·∫•y.",
                    vocab: [
                        "A. walked (ƒë√£ ƒëi)", "B. am walking (ƒëang ƒëi - HT)", "C. was walking (ƒëang ƒëi - QK)", "D. walk (ƒëi)"
                    ],
                    why: "H√†nh ƒë·ªông 'ƒëi b·ªô' ƒëang di·ªÖn ra (QKTD) th√¨ h√†nh ƒë·ªông 'nh√¨n th·∫•y' (saw) xen v√†o. I + was + walking.",
                    wrong: "A l√† QKƒê. B sai th√¨ hi·ªán t·∫°i. D sai th√¨."
                }
            },
            {
                q: "While we were playing in the garden, it ______ to rain.",
                options: ["A. start", "B. starting", "C. was starting", "D. started"],
                correct: 3,
                exp: {
                    vi: "Trong khi ch√∫ng t√¥i ƒëang ch∆°i trong v∆∞·ªùn, tr·ªùi b·∫Øt ƒë·∫ßu m∆∞a.",
                    vocab: [
                        "A. start (v)", "B. starting (Ving)", "C. was starting (QKTD)", "D. started (QKƒê)"
                    ],
                    why: "H√†nh ƒë·ªông 'ch∆°i' l√† d√†i (QKTD), h√†nh ƒë·ªông 'b·∫Øt ƒë·∫ßu m∆∞a' l√† ng·∫Øn, xen v√†o -> Chia Qu√° kh·ª© ƒë∆°n (Started). L∆∞u √Ω: Start √≠t khi chia ti·∫øp di·ªÖn.",
                    wrong: "C sai v√¨ start l√† h√†nh ƒë·ªông x·∫£y ra t·ª©c th√¨/ng·∫Øn."
                }
            },
            {
                q: "______ she sleeping when you called her?",
                options: ["A. Was", "B. Were", "C. Did", "D. Is"],
                correct: 0,
                exp: {
                    vi: "C√¥ ·∫•y c√≥ ƒëang ng·ªß khi b·∫°n g·ªçi c√¥ ·∫•y kh√¥ng?",
                    vocab: [
                        "A. Was (QKTD - s·ªë √≠t)", "B. Were (QKTD - s·ªë nhi·ªÅu)", "C. Did (QKƒê)", "D. Is (HT)"
                    ],
                    why: "C√¢u h·ªèi QKTD: Was/Were + S + V-ing? Ch·ªß ng·ªØ 'she' d√πng 'Was'.",
                    wrong: "B d√πng cho You/We/They. C ƒëi v·ªõi V nguy√™n th·ªÉ. D sai th√¨."
                }
            },
            {
                q: "At 10 a.m. yesterday, we ______ English.",
                options: ["A. learn", "B. were learning", "C. learned", "D. are learning"],
                correct: 1,
                exp: {
                    vi: "V√†o l√∫c 10 gi·ªù s√°ng h√¥m qua, ch√∫ng t√¥i ƒëang h·ªçc ti·∫øng Anh.",
                    vocab: [
                        "A. learn (v)", "B. were learning (QKTD)", "C. learned (QKƒê)", "D. are learning (HTTD)"
                    ],
                    why: "D·∫•u hi·ªáu 'At + gi·ªù + yesterday' -> QKTD. Ch·ªß ng·ªØ 'We' d√πng 'were learning'.",
                    wrong: "C l√† QKƒê (kh√¥ng c√≥ gi·ªù c·ª• th·ªÉ). D sai th√¨."
                }
            },
            {
                q: "Someone took my bag while I ______.",
                options: ["A. was not looking", "B. am not looking", "C. didn't look", "D. don't look"],
                correct: 0,
                exp: {
                    vi: "Ai ƒë√≥ ƒë√£ l·∫•y t√∫i c·ªßa t√¥i trong khi t√¥i kh√¥ng ƒë·ªÉ √Ω.",
                    vocab: [
                        "A. was not looking (QKTD)", "B. am not looking (HTTD)", "C. didn't look (QKƒê)", "D. don't look (HTƒê)"
                    ],
                    why: "Sau 'While' l√† h√†nh ƒë·ªông k√©o d√†i (ƒëang kh√¥ng nh√¨n) -> QKTD. I + was not + Ving.",
                    wrong: "C l√† h√†nh ƒë·ªông ng·∫Øn. B, D sai th√¨."
                }
            },
            // Questions 11-20
            {
                q: "The children ______ hide and seek in the park at 4 p.m. last Sunday.",
                options: ["A. played", "B. were playing", "C. play", "D. are playing"],
                correct: 1,
                exp: {
                    vi: "B·ªçn tr·∫ª ƒëang ch∆°i tr·ªën t√¨m trong c√¥ng vi√™n l√∫c 4 gi·ªù chi·ªÅu Ch·ªß nh·∫≠t tu·∫ßn tr∆∞·ªõc.",
                    vocab: ["A. played (QKƒê)", "B. were playing (QKTD)", "C. play (HTƒê)", "D. are playing (HTTD)"],
                    why: "Th·ªùi gian x√°c ƒë·ªãnh trong qu√° kh·ª© 'at 4 p.m last Sunday' -> QKTD. The children (s·ªë nhi·ªÅu) -> were playing.",
                    wrong: "A d√πng cho h√†nh ƒë·ªông ƒë√£ xong. C, D sai th√¨."
                }
            },
            {
                q: "As I ______ the road, I stepped on a banana skin.",
                options: ["A. was crossing", "B. crossed", "C. cross", "D. am crossing"],
                correct: 0,
                exp: {
                    vi: "Khi t√¥i ƒëang bƒÉng qua ƒë∆∞·ªùng, t√¥i gi·∫´m ph·∫£i v·ªè chu·ªëi.",
                    vocab: ["A. was crossing (ƒëang bƒÉng qua)", "B. crossed (ƒë√£ bƒÉng qua)", "C. cross (bƒÉng qua)", "D. am crossing (ƒëang bƒÉng qua - HT)"],
                    why: "H√†nh ƒë·ªông bƒÉng qua ƒë∆∞·ªùng ƒëang di·ªÖn ra (QKTD) th√¨ h√†nh ƒë·ªông gi·∫´m ph·∫£i v·ªè chu·ªëi xen v√†o. As = When.",
                    wrong: "B l√† h√†nh ƒë·ªông ng·∫Øn. C, D sai th√¨."
                }
            },
            {
                q: "They ______ to music when the lights went out.",
                options: ["A. listened", "B. are listening", "C. were listening", "D. listen"],
                correct: 2,
                exp: {
                    vi: "H·ªç ƒëang nghe nh·∫°c th√¨ ƒë√®n t·∫Øt.",
                    vocab: ["A. listened (QKƒê)", "B. are listening (HTTD)", "C. were listening (QKTD)", "D. listen (HTƒê)"],
                    why: "H√†nh ƒë·ªông nghe nh·∫°c l√† d√†i (QKTD), ƒë√®n t·∫Øt l√† ng·∫Øn (QKƒê - went). They -> were listening.",
                    wrong: "A sai v√¨ h√†nh ƒë·ªông b·ªã gi√°n ƒëo·∫°n. B, D sai th√¨."
                }
            },
            {
                q: "______ Tom ______ a book while his sister was drawing?",
                options: ["A. Did / read", "B. Was / reading", "C. Were / reading", "D. Is / reading"],
                correct: 1,
                exp: {
                    vi: "C√≥ ph·∫£i Tom ƒëang ƒë·ªçc s√°ch trong khi em g√°i c·∫≠u ·∫•y ƒëang v·∫Ω kh√¥ng?",
                    vocab: ["A. Did/read (QKƒê)", "B. Was/reading (QKTD - √≠t)", "C. Were/reading (QKTD - nhi·ªÅu)", "D. Is/reading (HT)"],
                    why: "Hai h√†nh ƒë·ªông song song trong qu√° kh·ª© (While). Tom (s·ªë √≠t) -> Was.",
                    wrong: "A sai c·∫•u tr√∫c v·ªõi while song song. C sai ng√¥i. D sai th√¨."
                }
            },
            {
                q: "It ______ heavily when we left the house.",
                options: ["A. rain", "B. rained", "C. was raining", "D. is raining"],
                correct: 2,
                exp: {
                    vi: "Tr·ªùi ƒëang m∆∞a to khi ch√∫ng t√¥i r·ªùi kh·ªèi nh√†.",
                    vocab: ["A. rain (v)", "B. rained (QKƒê)", "C. was raining (QKTD)", "D. is raining (HTTD)"],
                    why: "M∆∞a l√† h√†nh ƒë·ªông ƒëang di·ªÖn ra (b·ªëi c·∫£nh), r·ªùi nh√† l√† h√†nh ƒë·ªông xen v√†o. It -> was raining.",
                    wrong: "B ch·ªâ s·ª± vi·ªác ƒë√£ xong. D sai th√¨."
                }
            },
            {
                q: "What was she doing ______ you visited her?",
                options: ["A. while", "B. when", "C. at", "D. so"],
                correct: 1,
                exp: {
                    vi: "C√¥ ·∫•y ƒëang l√†m g√¨ KHI b·∫°n ƒë·∫øn thƒÉm c√¥ ·∫•y?",
                    vocab: ["A. while (trong khi)", "B. when (khi - xen v√†o)", "C. at (t·∫°i)", "D. so (n√™n)"],
                    why: "D√πng 'When' tr∆∞·ªõc h√†nh ƒë·ªông ng·∫Øn xen v√†o (visited - QKƒê).",
                    wrong: "While th∆∞·ªùng ƒëi v·ªõi QKTD (h√†nh ƒë·ªông d√†i). At l√† gi·ªõi t·ª´."
                }
            },
            {
                q: "We ______ dinner when the phone rang.",
                options: ["A. having", "B. are having", "C. were having", "D. had"],
                correct: 2,
                exp: {
                    vi: "Ch√∫ng t√¥i ƒëang ƒÉn t·ªëi th√¨ ƒëi·ªán tho·∫°i reo.",
                    vocab: ["A. having (Ving thi·∫øu tobe)", "B. are having (HTTD)", "C. were having (QKTD)", "D. had (QKƒê)"],
                    why: "ƒêang ƒÉn (d√†i) -> QKTD. We -> were having.",
                    wrong: "A thi·∫øu tobe 'were'. D l√† ƒë√£ ƒÉn xong r·ªìi (kh√¥ng di·ªÖn t·∫£ s·ª± gi√°n ƒëo·∫°n)."
                }
            },
            {
                q: "I saw him while I ______ for the bus.",
                options: ["A. waited", "B. was waiting", "C. am waiting", "D. wait"],
                correct: 1,
                exp: {
                    vi: "T√¥i nh√¨n th·∫•y anh ·∫•y trong khi t√¥i ƒëang ƒë·ª£i xe bu√Ωt.",
                    vocab: ["A. waited (QKƒê)", "B. was waiting (QKTD)", "C. am waiting (HTTD)", "D. wait (HTƒê)"],
                    why: "Sau 'While' l√† h√†nh ƒë·ªông d√†i ƒëang di·ªÖn ra -> QKTD. I -> was waiting.",
                    wrong: "A l√† h√†nh ƒë·ªông ng·∫Øn. C sai th√¨."
                }
            },
            {
                q: "My dad ______ the car at this time yesterday.",
                options: ["A. washed", "B. washes", "C. was washing", "D. is washing"],
                correct: 2,
                exp: {
                    vi: "B·ªë t√¥i ƒëang r·ª≠a xe v√†o gi·ªù n√†y h√¥m qua.",
                    vocab: ["A. washed (QKƒê)", "B. washes (HTƒê)", "C. was washing (QKTD)", "D. is washing (HTTD)"],
                    why: "'At this time yesterday' -> QKTD. My dad -> was washing.",
                    wrong: "A thi·∫øu t√≠nh ch·∫•t ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm c·ª• th·ªÉ."
                }
            },
            {
                q: "Were they talking about the movie? - No, they ______.",
                options: ["A. weren't", "B. wasn't", "C. didn't", "D. aren't"],
                correct: 0,
                exp: {
                    vi: "H·ªç c√≥ ƒëang n√≥i v·ªÅ b·ªô phim kh√¥ng? - Kh√¥ng, h·ªç kh√¥ng.",
                    vocab: ["A. weren't", "B. wasn't", "C. didn't", "D. aren't"],
                    why: "C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng 'Were they...?' -> Tr·∫£ l·ªùi 'No, they weren't'.",
                    wrong: "B d√πng cho s·ªë √≠t. C d√πng cho c√¢u h·ªèi Did. D d√πng cho hi·ªán t·∫°i."
                }
            },
            // Questions 21-30
            {
                q: "The sun ______ when I woke up this morning.",
                options: ["A. shone", "B. was shining", "C. shines", "D. is shining"],
                correct: 1,
                exp: {
                    vi: "M·∫∑t tr·ªùi ƒëang chi·∫øu s√°ng khi t√¥i th·ª©c d·∫≠y s√°ng nay.",
                    vocab: ["A. shone (QKƒê)", "B. was shining (QKTD)", "C. shines (HTƒê)", "D. is shining (HTTD)"],
                    why: "M·∫∑t tr·ªùi chi·∫øu s√°ng l√† b·ªëi c·∫£nh (ƒëang x·∫£y ra) -> QKTD. Th·ª©c d·∫≠y l√† h√†nh ƒë·ªông ng·∫Øn -> QKƒê.",
                    wrong: "A ch·ªâ h√†nh ƒë·ªông ƒë√£ k·∫øt th√∫c. C, D sai th√¨."
                }
            },
            {
                q: "While the teacher ______ the lesson, the students were listening carefully.",
                options: ["A. explained", "B. explains", "C. was explaining", "D. is explaining"],
                correct: 2,
                exp: {
                    vi: "Trong khi gi√°o vi√™n ƒëang gi·∫£ng b√†i, h·ªçc sinh ƒëang l·∫Øng nghe chƒÉm ch√∫.",
                    vocab: ["A. explained (QKƒê)", "B. explains (HTƒê)", "C. was explaining (QKTD)", "D. is explaining (HTTD)"],
                    why: "Hai h√†nh ƒë·ªông song song (While). Teacher -> was explaining.",
                    wrong: "A l√† h√†nh ƒë·ªông ng·∫Øn. B, D sai th√¨."
                }
            },
            {
                q: "I ______ computer games all yesterday afternoon.",
                options: ["A. played", "B. was playing", "C. am playing", "D. play"],
                correct: 1,
                exp: {
                    vi: "T√¥i ƒëang ch∆°i ƒëi·ªán t·ª≠ su·ªët c·∫£ bu·ªïi chi·ªÅu h√¥m qua.",
                    vocab: ["A. played (QKƒê)", "B. was playing (QKTD)", "C. am playing (HTTD)", "D. play (HTƒê)"],
                    why: "'All yesterday afternoon' nh·∫•n m·∫°nh t√≠nh li√™n t·ª•c trong qu√° kh·ª© -> QKTD.",
                    wrong: "A ch·ªâ k·ªÉ l·∫°i s·ª± vi·ªác, kh√¥ng nh·∫•n m·∫°nh qu√° tr√¨nh ƒëang di·ªÖn ra."
                }
            },
            {
                q: "When we saw them, they ______ hands.",
                options: ["A. shook", "B. are shaking", "C. were shaking", "D. shake"],
                correct: 2,
                exp: {
                    vi: "Khi ch√∫ng t√¥i nh√¨n th·∫•y h·ªç, h·ªç ƒëang b·∫Øt tay nhau.",
                    vocab: ["A. shook (QKƒê)", "B. are shaking (HTTD)", "C. were shaking (QKTD)", "D. shake (HTƒê)"],
                    why: "H√†nh ƒë·ªông b·∫Øt tay ƒëang di·ªÖn ra khi b·ªã nh√¨n th·∫•y. They -> were shaking.",
                    wrong: "A l√† h√†nh ƒë·ªông ƒë√£ xong. B, D sai th√¨."
                }
            },
            {
                q: "He fell asleep while he ______ TV.",
                options: ["A. watched", "B. was watching", "C. is watching", "D. watches"],
                correct: 1,
                exp: {
                    vi: "Anh ·∫•y ng·ªß thi·∫øp ƒëi trong khi ƒëang xem TV.",
                    vocab: ["A. watched (QKƒê)", "B. was watching (QKTD)", "C. is watching (HTTD)", "D. watches (HTƒê)"],
                    why: "Sau While l√† h√†nh ƒë·ªông d√†i (xem TV) -> QKTD. He -> was watching.",
                    wrong: "A l√† h√†nh ƒë·ªông ng·∫Øn. C, D sai th√¨."
                }
            },
            {
                q: "At 9 o'clock last Sunday, my sister ______ piano.",
                options: ["A. practised", "B. was practising", "C. practise", "D. is practising"],
                correct: 1,
                exp: {
                    vi: "L√∫c 9 gi·ªù Ch·ªß nh·∫≠t tr∆∞·ªõc, ch·ªã t√¥i ƒëang luy·ªán ƒë√†n piano.",
                    vocab: ["A. practised (QKƒê)", "B. was practising (QKTD)", "C. practise (HTƒê)", "D. is practising (HTTD)"],
                    why: "Gi·ªù c·ª• th·ªÉ trong qu√° kh·ª© -> QKTD. Sister -> was practising.",
                    wrong: "A thi·∫øu t√≠nh ti·∫øp di·ªÖn t·∫°i th·ªùi ƒëi·ªÉm c·ª• th·ªÉ."
                }
            },
            {
                q: "My brother ______ his room when I got home.",
                options: ["A. didn't clean", "B. wasn't cleaning", "C. isn't cleaning", "D. doesn't clean"],
                correct: 1,
                exp: {
                    vi: "Anh trai t√¥i ƒëang KH√îNG d·ªçn ph√≤ng khi t√¥i v·ªÅ nh√†.",
                    vocab: ["A. didn't clean (QKƒê)", "B. wasn't cleaning (QKTD)", "C. isn't cleaning (HTTD)", "D. doesn't clean (HTƒê)"],
                    why: "H√†nh ƒë·ªông 'kh√¥ng d·ªçn' ƒëang di·ªÖn ra t·∫°i th·ªùi ƒëi·ªÉm t√¥i v·ªÅ -> QKTD ph·ªß ƒë·ªãnh. Brother -> wasn't.",
                    wrong: "A ch·ªâ h√†nh ƒë·ªông ƒë√£ kh√¥ng x·∫£y ra (k·∫øt qu·∫£). C, D sai th√¨."
                }
            },
            {
                q: "What were you doing when the accident ______?",
                options: ["A. happened", "B. was happening", "C. happens", "D. is happening"],
                correct: 0,
                exp: {
                    vi: "B·∫°n ƒëang l√†m g√¨ khi tai n·∫°n x·∫£y ra?",
                    vocab: ["A. happened (QKƒê)", "B. was happening (QKTD)", "C. happens (HTƒê)", "D. is happening (HTTD)"],
                    why: "Tai n·∫°n l√† s·ª± vi·ªác x·∫£y ra b·∫•t ng·ªù, ng·∫Øn g·ªçn (xen v√†o) -> QKƒê (happened).",
                    wrong: "B d√πng n·∫øu tai n·∫°n di·ªÖn ra t·ª´ t·ª´ (√≠t d√πng). C, D sai th√¨."
                }
            },
            {
                q: "The baby ______ while her mother was cooking.",
                options: ["A. slept", "B. was sleeping", "C. sleeps", "D. is sleeping"],
                correct: 1,
                exp: {
                    vi: "Em b√© ƒëang ng·ªß trong khi m·∫π ƒëang n·∫•u ƒÉn.",
                    vocab: ["A. slept (QKƒê)", "B. was sleeping (QKTD)", "C. sleeps (HTƒê)", "D. is sleeping (HTTD)"],
                    why: "Hai h√†nh ƒë·ªông song song (While). Baby -> was sleeping.",
                    wrong: "A sai v√¨ b·ªëi c·∫£nh song song ti·∫øp di·ªÖn h·ª£p l√Ω h∆°n."
                }
            },
            {
                q: "We ______ (not / cycle) all day yesterday.",
                options: ["A. didn't cycle", "B. weren't cycling", "C. don't cycle", "D. aren't cycling"],
                correct: 1,
                exp: {
                    vi: "Ch√∫ng t√¥i ƒë√£ kh√¥ng ƒë·∫°p xe su·ªët c·∫£ ng√†y h√¥m qua.",
                    vocab: ["A. didn't cycle (QKƒê)", "B. weren't cycling (QKTD)", "C. don't cycle (HTƒê)", "D. aren't cycling (HTTD)"],
                    why: "'All day yesterday' -> QKTD. We -> weren't cycling.",
                    wrong: "A kh√¥ng nh·∫•n m·∫°nh t√≠nh li√™n t·ª•c c·∫£ ng√†y."
                }
            }
        ];

        // X√°o tr·ªôn c√¢u h·ªèi
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // Shuffle questions on load
        shuffleArray(questions);

        // Render Quiz
        const quizContainer = document.getElementById('quiz-container');
        
        questions.forEach((item, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'quiz-card';
            questionDiv.id = `q-${index}`;
            
            let optionsHTML = '';
            item.options.forEach((opt, optIndex) => {
                optionsHTML += `<button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, this)">${opt}</button>`;
            });

            questionDiv.innerHTML = `
                <span class="question-number">Question ${index + 1}</span>
                <div class="question-text">${item.q}</div>
                <div class="options-grid">
                    ${optionsHTML}
                </div>
                <div class="explanation" id="exp-${index}">
                    <h4>GI·∫¢I TH√çCH CHI TI·∫æT:</h4>
                    <div class="exp-step">
                        <div class="exp-title">1. D·ªãch c√¢u h·ªèi:</div>
                        <div class="exp-content">"${item.exp.vi}"</div>
                    </div>
                    <div class="exp-step">
                        <div class="exp-title">2. Ph√¢n t√≠ch t·ª´ v·ª±ng:</div>
                        <ul class="vocab-list">
                            ${item.exp.vocab.map(v => `<li>${v}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="exp-step">
                        <div class="exp-title" style="color:var(--correct)">3. T·∫°i sao ch·ªçn ƒë√°p √°n ƒë√∫ng?</div>
                        <div class="exp-content">${item.exp.why}</div>
                    </div>
                    <div class="exp-step">
                        <div class="exp-title" style="color:var(--wrong)">4. T·∫°i sao c√°c ƒë√°p √°n kia sai?</div>
                        <div class="exp-content">${item.exp.wrong}</div>
                    </div>
                    <div style="margin-top:10px; font-style:italic; color:var(--primary); font-weight:bold;">
                        C√¥ Mai An nh·∫Øn: C·ªë l√™n con nh√©! ‚ù§Ô∏è
                    </div>
                </div>
            `;
            quizContainer.appendChild(questionDiv);
        });

        // √Çm thanh (Base64 ng·∫Øn g·ªçn)
        const audioDing = new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"); // Fallback URL
        const audioBuzz = new Audio("https://actions.google.com/sounds/v1/cartoon/clank_car_crash.ogg"); // Fallback URL
        
        // Logic check ƒë√°p √°n
        let score = 0;
        let answeredCount = 0;

        function checkAnswer(qIndex, optIndex, btnElement) {
            // NgƒÉn ch·ªçn l·∫°i
            const parent = btnElement.parentElement;
            if (parent.classList.contains('locked')) return;
            parent.classList.add('locked');

            const question = questions[qIndex];
            const expBox = document.getElementById(`exp-${qIndex}`);
            const allBtns = parent.getElementsByClassName('option-btn');

            if (optIndex === question.correct) {
                // ƒê√∫ng
                btnElement.classList.add('correct');
                score++;
                playSound(true);
                triggerConfetti(btnElement);
            } else {
                // Sai
                btnElement.classList.add('wrong');
                // Hi·ªán ƒë√°p √°n ƒë√∫ng
                allBtns[question.correct].classList.add('correct');
                playSound(false);
            }

            answeredCount++;
            // Hi·ªán gi·∫£i th√≠ch
            expBox.style.display = 'block';
        }

        function playSound(isCorrect) {
            if (isCorrect) {
                audioDing.currentTime = 0;
                audioDing.play().catch(e => console.log("Audio play failed"));
            } else {
                audioBuzz.currentTime = 0;
                audioBuzz.play().catch(e => console.log("Audio play failed"));
            }
        }

        // Confetti Effect
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];

        function triggerConfetti(element) {
            const rect = element.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;

            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    life: 100
                });
            }
            requestAnimationFrame(updateConfetti);
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                p.vy += 0.2; // Gravity

                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) particles.splice(index, 1);
            });

            if (particles.length > 0) requestAnimationFrame(updateConfetti);
        }

        // K·∫øt qu·∫£
        function showResult() {
            const modal = document.getElementById('result-modal');
            const scoreText = document.getElementById('final-score');
            const feedback = document.getElementById('feedback-msg');

            scoreText.innerText = `${score}/30`;
            
            if (score === 30) feedback.innerText = "Tuy·ªát ƒë·ªëi! Con l√† thi√™n t√†i ng·ªØ ph√°p! üåü";
            else if (score >= 25) feedback.innerText = "Xu·∫•t s·∫Øc! Con n·∫Øm b√†i r·∫•t ch·∫Øc! üî•";
            else if (score >= 15) feedback.innerText = "L√†m t·ªët l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
            else feedback.innerText = "ƒê·ª´ng bu·ªìn, xem l·∫°i gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nh√©! üçÄ";

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }
    </script>
</body>
</html>