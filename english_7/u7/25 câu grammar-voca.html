<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám Ti·∫øng Anh - Unit 7: Traffic (Ms Mai An ULIS)</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8854C0; /* H·ªìng t√≠m nh·∫°t */
            --secondary-color: #00C9A7; /* Xanh ng·ªçc */
            --accent-color: #FF9F43; /* Cam */
            --text-color: #2d3436;
            --correct-color: #00D26A; /* Xanh l√° */
            --wrong-color: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f3f5;
            --card-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none; /* NgƒÉn b√¥i ƒëen ƒë·ªÉ tr·∫£i nghi·ªám gi·ªëng app */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(#dcdde1 15%, transparent 16%), radial-gradient(#dcdde1 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 20px;
            background: white;
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-color);
            position: relative;
            z-index: 10;
        }

        h2 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-color);
            font-weight: 900;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- Main Game Container --- */
        .game-container {
            background: var(--card-bg);
            width: 100%;
            max-width: 800px;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-bottom: 8px solid #dfe6e9;
            position: relative;
            transition: transform 0.3s;
        }

        /* --- Progress Bar --- */
        .progress-wrapper {
            width: 100%;
            height: 20px;
            background-color: #dfe6e9;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--secondary-color);
            width: 0%;
            border-radius: 15px;
            transition: width 0.5s ease-in-out;
            box-shadow: inset 0 -3px 5px rgba(0,0,0,0.1);
        }

        .question-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
            font-weight: 800;
            color: #636e72;
        }

        /* --- Question --- */
        .question-box {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.5;
        }

        /* --- Options Grid --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: var(--text-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 5px 0 #b2bec3; /* 3D effect */
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #b2bec3;
        }

        .option-circle {
            width: 30px;
            height: 30px;
            background: #f1f2f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 800;
            color: #a4b0be;
            flex-shrink: 0;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
            box-shadow: 0 5px 0 #00944a;
        }
        .option-btn.correct .option-circle {
            background: white;
            color: var(--correct-color);
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
            box-shadow: 0 5px 0 #c23616;
            animation: shake 0.5s;
        }
        .option-btn.wrong .option-circle {
            background: white;
            color: var(--wrong-color);
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
        }
        
        .option-btn.dimmed {
            opacity: 0.5;
        }

        /* --- Explanation Box --- */
        .explanation-box {
            margin-top: 30px;
            background: #f8f9fa;
            border: 2px dashed var(--primary-color);
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .explanation-header {
            color: var(--primary-color);
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #2d3436;
            white-space: pre-wrap; /* Preserve line breaks */
        }
        
        .explanation-content strong {
            color: #d63031;
        }

        /* --- Next Button --- */
        .next-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #e58e26;
            margin-top: 25px;
            display: none; /* Hidden */
            width: 100%;
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .next-btn:hover {
            transform: scale(1.02);
            background-color: #ffaf40;
        }
        
        .next-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #e58e26;
        }

        /* --- Result Modal --- */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: zoomIn 0.5s;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--primary-color);
        }

        .message {
            font-size: 1.5rem;
            color: var(--text-color);
            margin-bottom: 20px;
        }
        
        .restart-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #00944a;
        }
        
        .restart-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 transparent;
        }

        /* --- Animations --- */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* --- Confetti Canvas --- */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 99;
        }
    </style>
</head>
<body>

    <header>
        <h2>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h2>
    </header>

    <div class="game-container">
        <div class="progress-wrapper">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="question-count" id="question-count">1/25</div>
        </div>

        <div class="question-box" id="question-text">
            Loading Question...
        </div>

        <div class="options-grid" id="options-container">
            <!-- Options will be generated here -->
        </div>

        <div class="explanation-box" id="explanation-box">
            <div class="explanation-header">
                <span>üí° Gi·∫£i th√≠ch chi ti·∫øt (Ms Mai An)</span>
            </div>
            <div class="explanation-content" id="explanation-text">
                <!-- Explanation text -->
            </div>
        </div>

        <button class="next-btn" id="next-btn" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
    </div>

    <!-- Result Modal -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-card">
            <div class="score-circle" id="final-score">0/25</div>
            <h2 id="final-title" style="color:var(--primary-color); margin-bottom:10px;">Ho√†n th√†nh!</h2>
            <p class="message" id="final-message">B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
            <button class="restart-btn" onclick="restartGame()">L√†m l·∫°i b√†i thi ‚Ü∫</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <script>
        // --- DATA SOURCE (From User Context) ---
        const rawData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "Drivers have to __________ their seatbelt whenever they drive.",
              "answerOptions": [
                { "text": "put", "rationale": "Ph√¢n t√≠ch:\n- A. put (v): ƒë·∫∑t, ƒë·ªÉ\n- B. tie (v): bu·ªôc, th·∫Øt (d√¢y gi√†y, c√† v·∫°t)\n- C. fasten (v): th·∫Øt, c√†i (d√¢y an to√†n)\n- D. put on (v): m·∫∑c v√†o (qu·∫ßn √°o)\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ c·ªë ƒë·ªãnh 'fasten one's seatbelt' nghƒ©a l√† th·∫Øt d√¢y an to√†n.\n\nD·ªãch c√¢u: C√°c t√†i x·∫ø ph·∫£i th·∫Øt d√¢y an to√†n b·∫•t c·ª© khi n√†o h·ªç l√°i xe.", "isCorrect": false },
                { "text": "tie", "rationale": "", "isCorrect": false },
                { "text": "fasten", "rationale": "Ph√¢n t√≠ch:\n- A. put (v): ƒë·∫∑t, ƒë·ªÉ\n- B. tie (v): bu·ªôc, th·∫Øt (d√¢y gi√†y, c√† v·∫°t)\n- C. fasten (v): th·∫Øt, c√†i (d√¢y an to√†n)\n- D. put on (v): m·∫∑c v√†o (qu·∫ßn √°o)\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ c·ªë ƒë·ªãnh 'fasten one's seatbelt' nghƒ©a l√† th·∫Øt d√¢y an to√†n.\n\nD·ªãch c√¢u: C√°c t√†i x·∫ø ph·∫£i th·∫Øt d√¢y an to√†n b·∫•t c·ª© khi n√†o h·ªç l√°i xe.", "isCorrect": true },
                { "text": "put on", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 2,
              "question": "We should wait for the traffic lights __________ before we cross the street.",
              "answerOptions": [
                { "text": "turn green", "rationale": "", "isCorrect": false },
                { "text": "to turn green", "rationale": "Ph√¢n t√≠ch:\n- A. turn green (v): chuy·ªÉn xanh\n- B. to turn green (to v): chuy·ªÉn xanh\n- C. turn yellow (v): chuy·ªÉn v√†ng\n- D. to turn yellow (to v): chuy·ªÉn v√†ng\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c 'wait for sb/sth to do sth' (ch·ªù ai/c√°i g√¨ l√†m g√¨). ƒê·ªÉ qua ƒë∆∞·ªùng an to√†n th√¨ ƒë√®n ph·∫£i chuy·ªÉn xanh.\n\nD·ªãch c√¢u: Ch√∫ng ta n√™n ch·ªù ƒë√®n giao th√¥ng chuy·ªÉn sang m√†u xanh tr∆∞·ªõc khi bƒÉng qua ƒë∆∞·ªùng.", "isCorrect": true },
                { "text": "turn yellow", "rationale": "", "isCorrect": false },
                { "text": "to turn yellow", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 3,
              "question": "All of us have to obey __________ strictly.",
              "answerOptions": [
                { "text": "traffic rules", "rationale": "Ph√¢n t√≠ch:\n- A. traffic rules (n): lu·∫≠t giao th√¥ng\n- B. traffic (n): giao th√¥ng\n- C. traffic jam (n): t·∫Øc ƒë∆∞·ªùng\n- D. regular (adj): th∆∞·ªùng xuy√™n/ƒë·ªÅu ƒë·∫∑n\n\nGi·∫£i th√≠ch: ƒê·ªông t·ª´ 'obey' (tu√¢n th·ªß) th∆∞·ªùng ƒëi v·ªõi lu·∫≠t l·ªá.\n\nD·ªãch c√¢u: T·∫•t c·∫£ ch√∫ng ta ƒë·ªÅu ph·∫£i tu√¢n th·ªß lu·∫≠t giao th√¥ng m·ªôt c√°ch nghi√™m ng·∫∑t.", "isCorrect": true },
                { "text": "traffic", "rationale": "", "isCorrect": false },
                { "text": "traffic jam", "rationale": "", "isCorrect": false },
                { "text": "regular", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 4,
              "question": "Cyclists and motorists have to wear a __________ when they ride a motorbike.",
              "answerOptions": [
                { "text": "hard hat", "rationale": "", "isCorrect": false },
                { "text": "cap", "rationale": "", "isCorrect": false },
                { "text": "mask", "rationale": "", "isCorrect": false },
                { "text": "helmet", "rationale": "Ph√¢n t√≠ch:\n- A. hard hat (n): m≈© b·∫£o h·ªô (c√¥ng tr∆∞·ªùng)\n- B. cap (n): m≈© l∆∞·ª°i trai\n- C. mask (n): kh·∫©u trang/m·∫∑t n·∫°\n- D. helmet (n): m≈© b·∫£o hi·ªÉm\n\nGi·∫£i th√≠ch: Khi ƒëi xe m√°y/xe ƒë·∫°p, v·∫≠t d·ª•ng b·∫£o v·ªá ƒë·∫ßu b·∫Øt bu·ªôc l√† 'helmet'.\n\nD·ªãch c√¢u: Ng∆∞·ªùi ƒëi xe ƒë·∫°p v√† ng∆∞·ªùi ƒëi xe m√°y ph·∫£i ƒë·ªôi m≈© b·∫£o hi·ªÉm khi h·ªç l√°i xe.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 5,
              "question": "He forgot to give a __________ before he turned left and got a ticket.",
              "answerOptions": [
                { "text": "signal", "rationale": "Ph√¢n t√≠ch:\n- A. signal (n): t√≠n hi·ªáu (xi nhan)\n- B. sign (n): bi·ªÉn b√°o/k√Ω hi·ªáu\n- C. light (n): ƒë√®n\n- D. hand (n): b√†n tay\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ 'give a signal' nghƒ©a l√† ra t√≠n hi·ªáu (xi nhan) xin ƒë∆∞·ªùng.\n\nD·ªãch c√¢u: Anh ·∫•y qu√™n ra t√≠n hi·ªáu tr∆∞·ªõc khi r·∫Ω tr√°i v√† ƒë√£ b·ªã ph·∫°t.", "isCorrect": true },
                { "text": "sign", "rationale": "", "isCorrect": false },
                { "text": "light", "rationale": "", "isCorrect": false },
                { "text": "hand", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 6,
              "question": "__________ does it take you to get to Ho Chi Minh City by plane? - About 2 hours.",
              "answerOptions": [
                { "text": "How far", "rationale": "", "isCorrect": false },
                { "text": "How much", "rationale": "", "isCorrect": false },
                { "text": "How long", "rationale": "Ph√¢n t√≠ch:\n- A. How far (adv): Bao xa (h·ªèi kho·∫£ng c√°ch)\n- B. How much (adv): Bao nhi√™u (h·ªèi gi√°/s·ªë l∆∞·ª£ng)\n- C. How long (adv): Bao l√¢u (h·ªèi th·ªùi gian)\n- D. How many (adv): Bao nhi√™u (ƒë·∫øm ƒë∆∞·ª£c)\n\nGi·∫£i th√≠ch: C√¢u tr·∫£ l·ªùi l√† 'About 2 hours' (kho·∫£ng 2 ti·∫øng) -> H·ªèi v·ªÅ th·ªùi gian.\n\nD·ªãch c√¢u: B·∫°n m·∫•t bao l√¢u ƒë·ªÉ ƒë·∫øn TP. H·ªì Ch√≠ Minh b·∫±ng m√°y bay? - Kho·∫£ng 2 ti·∫øng.", "isCorrect": true },
                { "text": "How many", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 7,
              "question": "There __________ a bus station in the city centre, but it has been moved to the suburbs.",
              "answerOptions": [
                { "text": "used to be", "rationale": "Ph√¢n t√≠ch:\n- A. used to be: ƒë√£ t·ª´ng c√≥ (ƒë·ªông t·ª´ be)\n- B. used to have: ƒë√£ t·ª´ng c√≥ (ƒë·ªông t·ª´ have)\n- C. use to have: sai ng·ªØ ph√°p\n- D. were: ƒë√£ l√† (s·ªë nhi·ªÅu, sai v√¨ bus station l√† s·ªë √≠t)\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c 'There used to be...' (ƒê√£ t·ª´ng c√≥...). Kh√¥ng d√πng 'There used to have'.\n\nD·ªãch c√¢u: ƒê√£ t·ª´ng c√≥ m·ªôt b·∫øn xe bu√Ωt ·ªü trung t√¢m th√†nh ph·ªë, nh∆∞ng n√≥ ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ra ngo·∫°i √¥.", "isCorrect": true },
                { "text": "used to have", "rationale": "", "isCorrect": false },
                { "text": "use to have", "rationale": "", "isCorrect": false },
                { "text": "were", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 8,
              "question": "I __________ marbles when I was young, but now I don‚Äôt.",
              "answerOptions": [
                { "text": "play", "rationale": "", "isCorrect": false },
                { "text": "used to play", "rationale": "Ph√¢n t√≠ch:\n- A. play (v): ch∆°i (hi·ªán t·∫°i)\n- B. used to play (v): ƒë√£ t·ª´ng ch∆°i (qu√° kh·ª©)\n- C. have played (v): ƒë√£ ch∆°i (hi·ªán t·∫°i ho√†n th√†nh)\n- D. didn‚Äôt use to play (v): ƒë√£ kh√¥ng th∆∞·ªùng ch∆°i\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c 'used to + V' ch·ªâ m·ªôt th√≥i quen trong qu√° kh·ª© kh√¥ng c√≤n ·ªü hi·ªán t·∫°i.\n\nD·ªãch c√¢u: T√¥i ƒë√£ t·ª´ng ch∆°i b·∫Øn bi khi c√≤n nh·ªè, nh∆∞ng b√¢y gi·ªù th√¨ kh√¥ng.", "isCorrect": true },
                { "text": "have played", "rationale": "", "isCorrect": false },
                { "text": "didn‚Äôt use to play", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 9,
              "question": "‚Äú__________ is it from your house to the nearest bus stop?‚Äù - ‚ÄúAbout 50 meters‚Äù",
              "answerOptions": [
                { "text": "How far", "rationale": "Ph√¢n t√≠ch:\n- A. How far (adv): Bao xa (h·ªèi kho·∫£ng c√°ch)\n- B. How long (adv): Bao l√¢u (h·ªèi th·ªùi gian)\n- C. How often (adv): Bao l√¢u m·ªôt l·∫ßn (h·ªèi t·∫ßn su·∫•t)\n- D. How much (adv): Bao nhi√™u (gi√° c·∫£)\n\nGi·∫£i th√≠ch: C√¢u tr·∫£ l·ªùi l√† 'About 50 meters' (kho·∫£ng 50 m√©t) -> H·ªèi v·ªÅ kho·∫£ng c√°ch.\n\nD·ªãch c√¢u: T·ª´ nh√† b·∫°n ƒë·∫øn tr·∫°m xe bu√Ωt g·∫ßn nh·∫•t l√† bao xa? - Kho·∫£ng 50 m√©t.", "isCorrect": true },
                { "text": "How long", "rationale": "", "isCorrect": false },
                { "text": "How often", "rationale": "", "isCorrect": false },
                { "text": "How much", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 10,
              "question": "We should __________ the street at the zebra crossing.",
              "answerOptions": [
                { "text": "walk", "rationale": "", "isCorrect": false },
                { "text": "walk on", "rationale": "", "isCorrect": false },
                { "text": "walk through", "rationale": "", "isCorrect": false },
                { "text": "walk across", "rationale": "Ph√¢n t√≠ch:\n- A. walk (v): ƒëi b·ªô\n- B. walk on (v): ƒëi tr√™n\n- C. walk through (v): ƒëi xuy√™n qua\n- D. walk across (v): ƒëi bƒÉng qua (ƒë∆∞·ªùng)\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông ƒëi t·ª´ b√™n n√†y sang b√™n kia ƒë∆∞·ªùng d√πng 'walk across' ho·∫∑c 'cross'.\n\nD·ªãch c√¢u: Ch√∫ng ta n√™n ƒëi bƒÉng qua ƒë∆∞·ªùng t·∫°i v·∫°ch k·∫ª d√†nh cho ng∆∞·ªùi ƒëi b·ªô.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 11,
              "question": "John used to go to school __________.",
              "answerOptions": [
                { "text": "with bicycle", "rationale": "", "isCorrect": false },
                { "text": "by foot", "rationale": "", "isCorrect": false },
                { "text": "in car", "rationale": "", "isCorrect": false },
                { "text": "by bus", "rationale": "Ph√¢n t√≠ch:\n- A. with bicycle (Sai gi·ªõi t·ª´): ph·∫£i d√πng 'by bicycle'\n- B. by foot (Sai gi·ªõi t·ª´): ph·∫£i d√πng 'on foot'\n- C. in car (Sai gi·ªõi t·ª´): th∆∞·ªùng d√πng 'by car' ho·∫∑c 'in a car'\n- D. by bus: b·∫±ng xe bu√Ωt (ƒê√∫ng)\n\nGi·∫£i th√≠ch: Ch·ªâ ph∆∞∆°ng ti·ªán ƒëi l·∫°i d√πng gi·ªõi t·ª´ 'by' + ph∆∞∆°ng ti·ªán (by bus, by car, by plane).\n\nD·ªãch c√¢u: John ƒë√£ t·ª´ng ƒëi h·ªçc b·∫±ng xe bu√Ωt.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 12,
              "question": "Public __________ in my town is good and cheap.",
              "answerOptions": [
                { "text": "transport", "rationale": "Ph√¢n t√≠ch:\n- A. transport (n): giao th√¥ng/v·∫≠n t·∫£i\n- B. tour (n): chuy·∫øn tham quan\n- C. journey (n): cu·ªôc h√†nh tr√¨nh\n- D. travel (n/v): du l·ªãch\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ 'Public transport' nghƒ©a l√† Giao th√¥ng c√¥ng c·ªông.\n\nD·ªãch c√¢u: Giao th√¥ng c√¥ng c·ªông ·ªü th·ªã tr·∫•n c·ªßa t√¥i r·∫•t t·ªët v√† r·∫ª.", "isCorrect": true },
                { "text": "tour", "rationale": "", "isCorrect": false },
                { "text": "journey", "rationale": "", "isCorrect": false },
                { "text": "travel", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 13,
              "question": "_______ is not very far from here to the city center.",
              "answerOptions": [
                { "text": "That", "rationale": "", "isCorrect": false },
                { "text": "This", "rationale": "", "isCorrect": false },
                { "text": "It", "rationale": "Ph√¢n t√≠ch:\n- A. That (ƒë·∫°i t·ª´): Kia\n- B. This (ƒë·∫°i t·ª´): ƒê√¢y\n- C. It (ƒë·∫°i t·ª´ gi·∫£): N√≥\n- D. There (tr·∫°ng t·ª´): ·ªû ƒë√≥\n\nGi·∫£i th√≠ch: D√πng ch·ªß ng·ªØ gi·∫£ 'It' ƒë·ªÉ n√≥i v·ªÅ kho·∫£ng c√°ch: 'It is + (not) + far...'\n\nD·ªãch c√¢u: T·ª´ ƒë√¢y ƒë·∫øn trung t√¢m th√†nh ph·ªë kh√¥ng xa l·∫Øm.", "isCorrect": true },
                { "text": "There", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 14,
              "question": "When there is a traffic jam, it __________ me a very long time to go home.",
              "answerOptions": [
                { "text": "costs", "rationale": "", "isCorrect": false },
                { "text": "takes", "rationale": "Ph√¢n t√≠ch:\n- A. costs (v): t·ªën (ti·ªÅn)\n- B. takes (v): t·ªën (th·ªùi gian)\n- C. lasts (v): k√©o d√†i\n- D. spends (v): d√†nh (th·ªùi gian/ti·ªÅn) - Ch·ªß ng·ªØ ph·∫£i l√† ng∆∞·ªùi\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c 'It takes sb + time + to V' (Ai ƒë√≥ m·∫•t bao l√¢u ƒë·ªÉ l√†m g√¨).\n\nD·ªãch c√¢u: Khi b·ªã t·∫Øc ƒë∆∞·ªùng, t√¥i m·∫•t r·∫•t nhi·ªÅu th·ªùi gian ƒë·ªÉ v·ªÅ nh√†.", "isCorrect": true },
                { "text": "lasts", "rationale": "", "isCorrect": false },
                { "text": "spends", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 15,
              "question": "Mai‚Äôs dad usually drives her to school __________ her school is very far from her house.",
              "answerOptions": [
                { "text": "but", "rationale": "", "isCorrect": false },
                { "text": "though", "rationale": "", "isCorrect": false },
                { "text": "because", "rationale": "Ph√¢n t√≠ch:\n- A. but (li√™n t·ª´): nh∆∞ng\n- B. though (li√™n t·ª´): m·∫∑c d√π\n- C. because (li√™n t·ª´): b·ªüi v√¨\n- D. or (li√™n t·ª´): ho·∫∑c\n\nGi·∫£i th√≠ch: V·∫ø sau 'very far' l√† nguy√™n nh√¢n cho vi·ªác b·ªë ch·ªü ƒëi h·ªçc -> d√πng 'because'.\n\nD·ªãch c√¢u: B·ªë c·ªßa Mai th∆∞·ªùng ch·ªü c√¥ ·∫•y ƒë·∫øn tr∆∞·ªùng v√¨ tr∆∞·ªùng c·ªßa c√¥ ·∫•y r·∫•t xa nh√†.", "isCorrect": true },
                { "text": "or", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 16,
              "question": "Yesterday Hoa and Lan __________ round West Lake. It took them an hour.",
              "answerOptions": [
                { "text": "cycle", "rationale": "", "isCorrect": false },
                { "text": "cycles", "rationale": "", "isCorrect": false },
                { "text": "cycling", "rationale": "", "isCorrect": false },
                { "text": "cycled", "rationale": "Ph√¢n t√≠ch:\n- A. cycle (v): ƒë·∫°p xe (hi·ªán t·∫°i)\n- B. cycles (v): ƒë·∫°p xe (ng√¥i 3 s·ªë √≠t)\n- C. cycling (V-ing): ƒëang ƒë·∫°p xe\n- D. cycled (v-ed): ƒë√£ ƒë·∫°p xe\n\nGi·∫£i th√≠ch: C√≥ tr·∫°ng t·ª´ 'Yesterday' (H√¥m qua) -> d√πng th√¨ Qu√° kh·ª© ƒë∆°n (V-ed).\n\nD·ªãch c√¢u: H√¥m qua Hoa v√† Lan ƒë√£ ƒë·∫°p xe quanh H·ªì T√¢y. H·ªç m·∫•t m·ªôt ti·∫øng ƒë·ªìng h·ªì.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 17,
              "question": "Minh used to __________ his homework late in the evening.",
              "answerOptions": [
                { "text": "does", "rationale": "", "isCorrect": false },
                { "text": "do", "rationale": "Ph√¢n t√≠ch:\n- A. does (v): l√†m (ng√¥i 3 s·ªë √≠t)\n- B. do (v): l√†m (nguy√™n th·ªÉ)\n- C. doing (V-ing): ƒëang l√†m\n- D. did (v): ƒë√£ l√†m (qu√° kh·ª©)\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c 'used to + V(infinitive)' (ƒë√£ t·ª´ng l√†m g√¨).\n\nD·ªãch c√¢u: Minh ƒë√£ t·ª´ng l√†m b√†i t·∫≠p v·ªÅ nh√† mu·ªôn v√†o bu·ªïi t·ªëi.", "isCorrect": true },
                { "text": "doing", "rationale": "", "isCorrect": false },
                { "text": "did", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 18,
              "question": "If people __________ the rules, there are no more accidents.",
              "answerOptions": [
                { "text": "follow", "rationale": "", "isCorrect": false },
                { "text": "take care of", "rationale": "", "isCorrect": false },
                { "text": "obey", "rationale": "Ph√¢n t√≠ch:\n- A. follow (v): l√†m theo\n- B. take care of (v): chƒÉm s√≥c\n- C. obey (v): tu√¢n th·ªß\n- D. remember (v): nh·ªõ\n\nGi·∫£i th√≠ch: 'Obey the rules' l√† c·ª•m t·ª´ chu·∫©n nh·∫•t mang nghƒ©a tu√¢n th·ªß lu·∫≠t l·ªá nghi√™m ng·∫∑t (m·∫°nh h∆°n follow). Tuy nhi√™n, 'follow' c≈©ng d√πng ƒë∆∞·ª£c nh∆∞ng 'obey' th∆∞·ªùng d√πng cho lu·∫≠t ph√°p/quy ƒë·ªãnh giao th√¥ng.\n\nD·ªãch c√¢u: N·∫øu m·ªçi ng∆∞·ªùi tu√¢n th·ªß lu·∫≠t l·ªá, s·∫Ω kh√¥ng c√≤n tai n·∫°n n·ªØa.", "isCorrect": true },
                { "text": "remember", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 19,
              "question": "You should __________ right and left when you go across the roads.",
              "answerOptions": [
                { "text": "see", "rationale": "", "isCorrect": false },
                { "text": "look", "rationale": "Ph√¢n t√≠ch:\n- A. see (v): nh√¨n th·∫•y (th·ª• ƒë·ªông)\n- B. look (v): nh√¨n (ch·ªß ƒë·ªông)\n- C. be (v): th√¨, l√†\n- D. take (v): c·∫ßm, l·∫•y\n\nGi·∫£i th√≠ch: 'Look right and left' (Nh√¨n tr√°i nh√¨n ph·∫£i) l√† h√†nh ƒë·ªông ch·ªß ƒë·ªông quan s√°t.\n\nD·ªãch c√¢u: B·∫°n n√™n nh√¨n b√™n ph·∫£i v√† b√™n tr√°i khi bƒÉng qua ƒë∆∞·ªùng.", "isCorrect": true },
                { "text": "be", "rationale": "", "isCorrect": false },
                { "text": "take", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 20,
              "question": "Hurry up or we can‚Äôt __________ the last bus home.",
              "answerOptions": [
                { "text": "keep", "rationale": "", "isCorrect": false },
                { "text": "follow", "rationale": "", "isCorrect": false },
                { "text": "go", "rationale": "", "isCorrect": false },
                { "text": "catch", "rationale": "Ph√¢n t√≠ch:\n- A. keep (v): gi·ªØ\n- B. follow (v): theo d√µi\n- C. go (v): ƒëi\n- D. catch (v): b·∫Øt (xe)\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ 'catch the bus' (b·∫Øt xe bu√Ωt).\n\nD·ªãch c√¢u: Nhanh l√™n n·∫øu kh√¥ng ch√∫ng ta kh√¥ng th·ªÉ b·∫Øt chuy·∫øn xe bu√Ωt cu·ªëi c√πng v·ªÅ nh√†.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 21,
              "question": "There used to be fewer people and __________ on the roads.",
              "answerOptions": [
                { "text": "roofs", "rationale": "", "isCorrect": false },
                { "text": "helmets", "rationale": "", "isCorrect": false },
                { "text": "helicopters", "rationale": "", "isCorrect": false },
                { "text": "vehicles", "rationale": "Ph√¢n t√≠ch:\n- A. roofs (n): m√°i nh√†\n- B. helmets (n): m≈© b·∫£o hi·ªÉm\n- C. helicopters (n): tr·ª±c thƒÉng\n- D. vehicles (n): ph∆∞∆°ng ti·ªán giao th√¥ng\n\nGi·∫£i th√≠ch: Trong ng·ªØ c·∫£nh giao th√¥ng tr√™n ƒë∆∞·ªùng (on the roads), ƒëi k√®m v·ªõi 'people' (ng∆∞·ªùi) l√† 'vehicles' (xe c·ªô).\n\nD·ªãch c√¢u: ƒê√£ t·ª´ng c√≥ √≠t ng∆∞·ªùi v√† ph∆∞∆°ng ti·ªán h∆°n tr√™n ƒë∆∞·ªùng.", "isCorrect": true }
              ]
            },
            {
              "questionNumber": 22,
              "question": "Do you know the __________ in the UK is to keep to the left?",
              "answerOptions": [
                { "text": "traffic rule", "rationale": "Ph√¢n t√≠ch:\n- A. traffic light (n): ƒë√®n giao th√¥ng\n- B. traffic rule (n): lu·∫≠t giao th√¥ng\n- C. traffic jam (n): t·∫Øc ƒë∆∞·ªùng\n- D. speed limit (n): gi·ªõi h·∫°n t·ªëc ƒë·ªô\n\nGi·∫£i th√≠ch: Quy ƒë·ªãnh 'ƒëi b√™n tr√°i' (keep to the left) l√† m·ªôt lu·∫≠t giao th√¥ng.\n\nD·ªãch c√¢u: B·∫°n c√≥ bi·∫øt lu·∫≠t giao th√¥ng ·ªü Anh l√† ƒëi b√™n tr√°i kh√¥ng?", "isCorrect": true },
                { "text": "traffic light", "rationale": "", "isCorrect": false },
                { "text": "traffic jam", "rationale": "", "isCorrect": false },
                { "text": "speed limit", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 23,
              "question": "It is dangerous to ride a motorbike without a __________",
              "answerOptions": [
                { "text": "helmet", "rationale": "Ph√¢n t√≠ch:\n- A. helmet (n): m≈© b·∫£o hi·ªÉm\n- B. triangle (n): h√¨nh tam gi√°c\n- C. tricycle (n): xe ba b√°nh\n- D. circle (n): h√¨nh tr√≤n\n\nGi·∫£i th√≠ch: L√°i xe m√°y c·∫ßn ƒë·ªôi m≈© b·∫£o hi·ªÉm ƒë·ªÉ an to√†n.\n\nD·ªãch c√¢u: Th·∫≠t nguy hi·ªÉm khi l√°i xe m√°y m√† kh√¥ng c√≥ m≈© b·∫£o hi·ªÉm.", "isCorrect": true },
                { "text": "triangle", "rationale": "", "isCorrect": false },
                { "text": "tricycle", "rationale": "", "isCorrect": false },
                { "text": "circle", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 24,
              "question": "In Hanoi, during rush hour, some road users ride their motorbikes on the __________",
              "answerOptions": [
                { "text": "pavement", "rationale": "Ph√¢n t√≠ch:\n- A. driving licence (n): b·∫±ng l√°i xe\n- B. lane (n): l√†n ƒë∆∞·ªùng\n- C. pavement (n): v·ªâa h√®\n- D. seat belt (n): d√¢y an to√†n\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông sai tr√°i th∆∞·ªùng th·∫•y khi t·∫Øc ƒë∆∞·ªùng l√† ƒëi xe l√™n v·ªâa h√® (pavement).\n\nD·ªãch c√¢u: ·ªû H√† N·ªôi, trong gi·ªù cao ƒëi·ªÉm, m·ªôt s·ªë ng∆∞·ªùi tham gia giao th√¥ng l√°i xe m√°y l√™n v·ªâa h√®.", "isCorrect": true },
                { "text": "driving licence", "rationale": "", "isCorrect": false },
                { "text": "lane", "rationale": "", "isCorrect": false },
                { "text": "seat belt", "rationale": "", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 25,
              "question": "Traffic is terrible during the __________ when everyone is in a hurry to get to work or come back home.",
              "answerOptions": [
                { "text": "rush hour", "rationale": "Ph√¢n t√≠ch:\n- A. traffic light (n): ƒë√®n giao th√¥ng\n- B. road sign (n): bi·ªÉn b√°o giao th√¥ng\n- C. traffic rule (n): lu·∫≠t giao th√¥ng\n- D. rush hour (n): gi·ªù cao ƒëi·ªÉm\n\nGi·∫£i th√≠ch: Kho·∫£ng th·ªùi gian m·ªçi ng∆∞·ªùi v·ªôi v√£ ƒëi l√†m ho·∫∑c v·ªÅ nh√† g·ªçi l√† 'rush hour'.\n\nD·ªãch c√¢u: Giao th√¥ng r·∫•t t·ªá trong gi·ªù cao ƒëi·ªÉm khi m·ªçi ng∆∞·ªùi v·ªôi v√£ ƒëi l√†m ho·∫∑c tr·ªü v·ªÅ nh√†.", "isCorrect": true },
                { "text": "traffic light", "rationale": "", "isCorrect": false },
                { "text": "road sign", "rationale": "", "isCorrect": false },
                { "text": "traffic rule", "rationale": "", "isCorrect": false }
              ]
            }
          ]
        };

        // --- GAME LOGIC ---
        let currentQuestionIndex = 0;
        let score = 0;
        let shuffledQuestions = [];
        let audioCtx;

        // Initialize Audio Context (Standard Web Audio API for internal sounds)
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Sound Synthesis Functions (No external files needed)
        function playSound(type) {
            initAudio();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                // High pitch Ding
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Low pitch Buzz
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'end') {
                // Celebration melody
                const now = audioCtx.currentTime;
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    const osc = audioCtx.createOscillator();
                    const gn = audioCtx.createGain();
                    osc.connect(gn);
                    gn.connect(audioCtx.destination);
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    gn.gain.setValueAtTime(0.1, now + i*0.1);
                    gn.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.4);
                    osc.start(now + i*0.1);
                    osc.stop(now + i*0.1 + 0.4);
                });
            }
        }

        // Shuffle Function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame() {
            // Clone and shuffle questions
            shuffledQuestions = JSON.parse(JSON.stringify(rawData.questions));
            shuffleArray(shuffledQuestions);
            
            // Shuffle options within each question
            shuffledQuestions.forEach(q => {
                shuffleArray(q.answerOptions);
            });

            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('result-overlay').style.display = 'none';
            renderQuestion();
        }

        function renderQuestion() {
            const currentQ = shuffledQuestions[currentQuestionIndex];
            
            // Update UI text
            document.getElementById('question-count').innerText = `${currentQuestionIndex + 1}/${shuffledQuestions.length}`;
            document.getElementById('progress-bar').style.width = `${((currentQuestionIndex) / shuffledQuestions.length) * 100}%`;
            document.getElementById('question-text').innerText = currentQ.question;
            
            // Reset Explanation & Next Button
            document.getElementById('explanation-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';

            // Generate Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            const letters = ['A', 'B', 'C', 'D'];
            
            currentQ.answerOptions.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-circle">${letters[index]}</div>
                    <span>${opt.text}</span>
                `;
                btn.onclick = () => checkAnswer(opt, btn, currentQ);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(selectedOpt, btnElement, currentQData) {
            // Disable all buttons
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            // Find correct answer data for explanation logic
            // Note: The structure has 'rationale' in specific items. 
            // We need to find the item that HAS the explanation or aggregate them.
            // In the provided JSON, only the correct answer or the first option usually carries the full rationale text.
            // We will look for the non-empty rationale from the original question set (before shuffle options logic might have moved it).
            
            // Actually, in the provided JSON, usually only ONE option has the big text block, or they share it.
            // Let's find the rationale text from the options.
            let explanationText = "";
            const correctOption = currentQData.answerOptions.find(o => o.isCorrect);
            const explanationOption = currentQData.answerOptions.find(o => o.rationale && o.rationale.length > 10); // Find the one with text
            
            if (explanationOption) {
                explanationText = explanationOption.rationale;
            } else {
                 explanationText = "ƒêang c·∫≠p nh·∫≠t gi·∫£i th√≠ch...";
            }

            // Highlighting logic
            if (selectedOpt.isCorrect) {
                score++;
                btnElement.classList.add('correct');
                playSound('correct');
                fireConfetti();
            } else {
                btnElement.classList.add('wrong');
                playSound('wrong');
                // Find and highlight correct button
                buttons.forEach(b => {
                    if (b.innerText.includes(correctOption.text)) { // Simple check
                        b.classList.add('correct');
                    } else {
                        b.classList.add('dimmed');
                    }
                });
            }

            // Show Explanation
            const expBox = document.getElementById('explanation-box');
            const expText = document.getElementById('explanation-text');
            
            // Formatting text for better readability
            let formattedExp = explanationText
                .replace(/\n/g, '<br>')
                .replace(/(Ph√¢n t√≠ch:)/g, '<strong>$1</strong>')
                .replace(/(Gi·∫£i th√≠ch:)/g, '<br><strong>$1</strong>')
                .replace(/(D·ªãch c√¢u:)/g, '<br><strong>$1</strong>');

            expText.innerHTML = formattedExp;
            expBox.style.display = 'block';

            // Show Next Button
            document.getElementById('next-btn').style.display = 'block';
            
            // Scroll to explanation on mobile
            if(window.innerWidth < 600) {
                setTimeout(() => expBox.scrollIntoView({behavior: "smooth"}), 100);
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuestions.length) {
                renderQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            playSound('end');
            const overlay = document.getElementById('result-overlay');
            const scoreEl = document.getElementById('final-score');
            const messageEl = document.getElementById('final-message');
            const titleEl = document.getElementById('final-title');
            
            scoreEl.innerText = `${score}/${shuffledQuestions.length}`;
            
            const percentage = (score / shuffledQuestions.length) * 100;
            if (percentage === 100) {
                titleEl.innerText = "TUY·ªÜT V·ªúI!";
                messageEl.innerText = "B·∫°n l√† thi√™n t√†i Ti·∫øng Anh! ƒêi·ªÉm tuy·ªát ƒë·ªëi!";
                fireConfetti();
            } else if (percentage >= 80) {
                titleEl.innerText = "R·∫§T T·ªêT!";
                messageEl.innerText = "Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t v·ªØng ch·∫Øc!";
            } else if (percentage >= 50) {
                titleEl.innerText = "C·ªê L√äN NH√â!";
                messageEl.innerText = "B·∫°n ƒë√£ v∆∞·ª£t qua b√†i ki·ªÉm tra, h√£y √¥n t·∫≠p th√™m nh√©.";
            } else {
                titleEl.innerText = "C·∫¶N C·ªê G·∫ÆNG!";
                messageEl.innerText = "ƒê·ª´ng n·∫£n l√≤ng, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nh√©!";
            }
            
            overlay.style.display = 'flex';
        }

        function restartGame() {
            initGame();
        }

        // --- CONFETTI LOGIC (Simple implementation) ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let confetti = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti() {
            for (let i = 0; i < 100; i++) {
                confetti.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 4 - 2,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            confetti.forEach((p, index) => {
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += p.rotationSpeed;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
                ctx.restore();

                if (p.y > canvas.height) {
                    confetti.splice(index, 1);
                }
            });

            if (confetti.length > 0) {
                requestAnimationFrame(animateConfetti);
            }
        }

        // --- START ---
        window.onload = initGame;

    </script>
</body>
</html>
