<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <style>
        /* --- C·∫§U H√åNH CHUNG --- */
        :root {
            --primary: #0056b3; /* Xanh ƒë·∫≠m ch·ªß ƒë·∫°o */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --correct: #28a745;
            --wrong: #dc3545;
            --warning: #ffc107;
            --text-main: #333;
            --text-light: #666;
            --shadow: 0 4px 10px rgba(0,0,0,0.08);
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            padding-bottom: 80px; /* ƒê·ªÉ ch·ªó cho n√∫t Submit Sticky */
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--primary), #004494);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* --- CONTAINER --- */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* --- CARD STYLES --- */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        h2.section-title {
            color: var(--primary);
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        /* --- WORD BANK (BOX) --- */
        .word-bank {
            background: #eef5fa;
            border: 1px dashed var(--primary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .word-tag {
            background: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* --- QUESTION STYLES --- */
        .question-item {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .q-text {
            font-weight: 500;
            margin-bottom: 10px;
            display: block;
        }

        /* Inputs & Selects */
        input[type="text"], select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-family: var(--font-main);
            font-size: 1rem;
            width: 200px;
            max-width: 100%;
            transition: border-color 0.3s;
        }
        
        .full-width-select {
            width: 100%;
            max-width: 400px;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.1);
        }

        /* Check Button per Question */
        .btn-check-single {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-left: 10px;
            transition: background 0.3s;
        }

        .btn-check-single:hover {
            background-color: #5a6268;
        }

        /* --- EXPLANATION BOX (HIDDEN DEFAULT) --- */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #17a2b8;
            font-size: 0.95rem;
        }
        
        .explanation.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .exp-header {
            font-weight: bold;
            color: #17a2b8;
            margin-bottom: 5px;
            display: block;
        }

        .exp-trans {
            font-style: italic;
            color: #555;
            margin-bottom: 8px;
            display: block;
        }

        .exp-detail {
            color: #333;
        }
        
        .highlight-vocab {
            font-weight: bold;
            color: #d63384;
        }

        /* --- FEEDBACK STATES --- */
        .correct-input {
            border-color: var(--correct) !important;
            background-color: #d4edda;
        }

        .wrong-input {
            border-color: var(--wrong) !important;
            background-color: #f8d7da;
        }
        
        .feedback-icon {
            margin-left: 5px;
            font-weight: bold;
        }
        .icon-correct { color: var(--correct); }
        .icon-wrong { color: var(--wrong); }

        /* --- GLOSSARY TABLE --- */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .glossary-table th, .glossary-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .glossary-table th {
            background-color: var(--primary);
            color: white;
        }

        .glossary-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* --- FOOTER (STICKY SUBMIT) --- */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
            text-align: center;
            z-index: 1000;
        }

        .btn-submit {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .btn-submit:hover {
            background-color: #004494;
            transform: scale(1.05);
        }

        /* --- MODAL RESULT --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            animation: slideDown 0.4s;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .btn-close {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Responsive */
        @media (max-width: 600px) {
            .word-bank { justify-content: flex-start; }
            input[type="text"], select { width: 100%; margin-bottom: 5px; }
            .btn-check-single { width: 100%; margin-left: 0; margin-top: 5px; }
        }
    </style>
</head>
<body>

<header>
    <h1>B√†i T·∫≠p Ti·∫øng Anh T∆∞∆°ng T√°c</h1>
    <p>Gi√°o vi√™n: Ms Mai An ULIS | L·ªõp Th·∫°c sƒ© L√Ω lu·∫≠n & PPDH</p>
</header>

<div class="container">

    <div class="card" id="ex6">
        <h2 class="section-title">Exercise 6: Fill each blank with a word from the box.</h2>
        
        <div class="word-bank">
            <span class="word-tag">religious</span>
            <span class="word-tag">celebrate</span>
            <span class="word-tag">parade</span>
            <span class="word-tag">went</span>
            <span class="word-tag">attend</span>
            <span class="word-tag">decorate</span>
            <span class="word-tag">lunar</span>
            <span class="word-tag">festival</span>
            <span class="word-tag">performers</span>
            <span class="word-tag">music</span>
        </div>

        <div id="ex6-questions">
            </div>
    </div>

    <div class="card" id="ex7">
        <h2 class="section-title">Exercise 7: Complete the answers for the Yes/No questions.</h2>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">(ƒêi·ªÅn ch·ªß ng·ªØ v√† tr·ª£ ƒë·ªông t·ª´ ph√π h·ª£p. V√≠ d·ª•: I do, he didn't...)</p>
        <div id="ex7-questions">
            </div>
    </div>

    <div class="card" id="ex8">
        <h2 class="section-title">Exercise 8: Fill in the blanks with: Am, Is, Are, Do, or Does.</h2>
        <div id="ex8-questions">
            </div>
    </div>

    <div class="card" id="ex9">
        <h2 class="section-title">Exercise 9: Match the questions (A) with responses (B).</h2>
        <div id="ex9-questions">
            </div>
    </div>

    <div class="card" id="ex2">
        <h2 class="section-title">Exercise 2: Complete the conversation (1-5).</h2>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffecb5;">
            <strong>Options:</strong><br>
            a. That‚Äôs great. What did you see and do at the festival?<br>
            b. Sounds interesting. Was there any special event in Bac Giang?<br>
            c. And did you like the festival?<br>
            d. I guess it was exciting. Did your family do any home activities then?<br>
            e. Did you go anywhere last weekend, Trang?
        </div>

        <div id="ex2-questions">
            </div>
    </div>

    <div class="card">
        <h2 class="section-title">üìö Glossary (T·ª´ v·ª±ng n√¢ng cao)</h2>
        <table class="glossary-table">
            <thead>
                <tr>
                    <th>Word (T·ª´ v·ª±ng)</th>
                    <th>Type (T·ª´ lo·∫°i)</th>
                    <th>Meaning (Nghƒ©a)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Carnival</td><td>(n)</td><td>L·ªÖ h·ªôi h√≥a trang (th∆∞·ªùng c√≥ di·ªÖu h√†nh)</td></tr>
                <tr><td>Parade</td><td>(v/n)</td><td>Di·ªÖu h√†nh / Cu·ªôc di·ªÖu h√†nh</td></tr>
                <tr><td>Costume</td><td>(n)</td><td>Trang ph·ª•c h√≥a trang</td></tr>
                <tr><td>Extended family</td><td>(np)</td><td>ƒê·∫°i gia ƒë√¨nh (nhi·ªÅu th·∫ø h·ªá s·ªëng chung/t·ª• h·ªçp)</td></tr>
                <tr><td>Feast</td><td>(n)</td><td>B·ªØa ti·ªác l·ªõn, y·∫øn ti·ªác</td></tr>
                <tr><td>Lunar month</td><td>(np)</td><td>Th√°ng √¢m l·ªãch</td></tr>
                <tr><td>Decorate</td><td>(v)</td><td>Trang tr√≠ (nh√† c·ª≠a, c√¢y c·ªëi)</td></tr>
                <tr><td>Religious</td><td>(adj)</td><td>Thu·ªôc v·ªÅ t√¥n gi√°o, t√≠n ng∆∞·ª°ng</td></tr>
            </tbody>
        </table>
    </div>

</div>

<div class="sticky-footer">
    <button class="btn-submit" onclick="submitAll()">N·ªòP B√ÄI (SUBMIT)</button>
</div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h3>K·∫øt Qu·∫£ B√†i L√†m</h3>
        <div class="score-circle" id="scoreDisplay">0/0</div>
        <p id="scoreMessage">H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt b√™n d∆∞·ªõi nh√©!</p>
        <button class="btn-close" onclick="closeModal()">ƒê√≥ng & Xem L·ªùi Gi·∫£i</button>
    </div>
</div>

<script>
    // --- DATA ---
    
    // Exercise 6 Data
    const ex6Data = [
        {
            q: "1. Carnival is a popular _________________ in many countries in South America.",
            a: "festival",
            exp: "<b>D·ªãch:</b> Carnival l√† m·ªôt l·ªÖ h·ªôi ph·ªï bi·∫øn ·ªü nhi·ªÅu n∆∞·ªõc Nam M·ªπ.<br><b>Gi·∫£i th√≠ch:</b> Sau t√≠nh t·ª´ 'popular' c·∫ßn m·ªôt Danh t·ª´ s·ªë √≠t. 'Carnival' b·∫£n ch·∫•t l√† m·ªôt l·ªÖ h·ªôi. <br><b>C√°c t·ª´ kh√°c:</b> music (√¢m nh·∫°c), parade (di·ªÖu h√†nh - th∆∞·ªùng l√† ƒë·ªông t·ª´ ho·∫∑c danh t·ª´ ch·ªâ h√†nh ƒë·ªông ƒëi l·∫°i)."
        },
        {
            q: "2. South American people _________________ Carnival in different ways.",
            a: "celebrate",
            exp: "<b>D·ªãch:</b> Ng∆∞·ªùi d√¢n Nam M·ªπ t·ªï ch·ª©c ƒÉn m·ª´ng Carnival theo nhi·ªÅu c√°ch kh√°c nhau.<br><b>Gi·∫£i th√≠ch:</b> C·∫•u tr√∫c 'celebrate + Festival' (t·ªï ch·ª©c ƒÉn m·ª´ng l·ªÖ h·ªôi). C·∫ßn ƒë·ªông t·ª´ nguy√™n th·ªÉ v√¨ ch·ªß ng·ªØ 'South American people' l√† s·ªë nhi·ªÅu."
        },
        {
            q: "3. At Carnival, people wear costumes and _________________ through the streets...",
            a: "parade",
            exp: "<b>D·ªãch:</b> T·∫°i l·ªÖ h·ªôi, m·ªçi ng∆∞·ªùi m·∫∑c trang ph·ª•c h√≥a trang v√† di·ªÖu h√†nh qua c√°c con ph·ªë...<br><b>Gi·∫£i th√≠ch:</b> C·∫ßn ƒë·ªông t·ª´ song song v·ªõi 'wear'. 'Parade' (v): di·ªÖu h√†nh."
        },
        {
            q: "4. She is going to Rio Carnival to watch _________________ dance.",
            a: "performers",
            exp: "<b>D·ªãch:</b> C√¥ ·∫•y s·∫Ω ƒë·∫øn Rio Carnival ƒë·ªÉ xem c√°c ngh·ªá sƒ© bi·ªÉu di·ªÖn nh·∫£y m√∫a.<br><b>Gi·∫£i th√≠ch:</b> C·∫ßn danh t·ª´ ch·ªâ ng∆∞·ªùi l√†m ch·ªß ng·ªØ cho h√†nh ƒë·ªông 'dance'. 'Performers' (ng∆∞·ªùi bi·ªÉu di·ªÖn)."
        },
        {
            q: "5. A lot of dancers go to Rio de Janeiro to _________________ the Rio Carnival.",
            a: "attend",
            exp: "<b>D·ªãch:</b> R·∫•t nhi·ªÅu v≈© c√¥ng ƒë·∫øn Rio ƒë·ªÉ tham d·ª± l·ªÖ h·ªôi Rio Carnival.<br><b>Gi·∫£i th√≠ch:</b> 'Attend' (v): tham d·ª±. Sau 'to' c·∫ßn ƒë·ªông t·ª´ nguy√™n th·ªÉ ch·ªâ m·ª•c ƒë√≠ch."
        },
        {
            q: "6. I think nobody is at home now because they have gone to the _________________ festival.",
            a: "music",
            exp: "<b>D·ªãch:</b> T√¥i nghƒ© kh√¥ng ai ·ªü nh√† v√¨ h·ªç ƒë√£ ƒëi ƒë·∫øn l·ªÖ h·ªôi √¢m nh·∫°c r·ªìi.<br><b>Gi·∫£i th√≠ch:</b> 'Music festival' l√† c·ª•m danh t·ª´ gh√©p ph·ªï bi·∫øn (l·ªÖ h·ªôi √¢m nh·∫°c). Ng·ªØ c·∫£nh 'gone' (ƒë√£ ƒëi) h·ª£p l√Ω."
        },
        {
            q: "7. We _________________ to the Flower Festival in Da Lat last year.",
            a: "went",
            exp: "<b>D·ªãch:</b> Ch√∫ng t√¥i ƒë√£ ƒëi ƒë·∫øn L·ªÖ h·ªôi Hoa ƒê√† L·∫°t nƒÉm ngo√°i.<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'last year' (qu√° kh·ª© ƒë∆°n). ƒê·ªông t·ª´ 'go' chuy·ªÉn th√†nh 'went'."
        },
        {
            q: "8. During Tet, the Vietnamese _________________ their houses with many beautiful flowers.",
            a: "decorate",
            exp: "<b>D·ªãch:</b> V√†o d·ªãp T·∫øt, ng∆∞·ªùi Vi·ªát Nam trang tr√≠ nh√† c·ª≠a v·ªõi nhi·ªÅu hoa ƒë·∫πp.<br><b>Gi·∫£i th√≠ch:</b> C·∫•u tr√∫c 'decorate sth with sth' (trang tr√≠ c√°i g√¨ b·∫±ng c√°i g√¨)."
        },
        {
            q: "9. Thanksgiving is a _________________ festival only held in the USA.",
            a: "religious",
            exp: "<b>D·ªãch:</b> L·ªÖ T·∫° ∆†n l√† m·ªôt l·ªÖ h·ªôi mang t√≠nh t√¥n gi√°o/t√≠n ng∆∞·ª°ng ch·ªâ t·ªï ch·ª©c ·ªü M·ªπ.<br><b>Gi·∫£i th√≠ch:</b> C·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho 'festival'. Trong c√°c t·ª´ c√≤n l·∫°i, 'religious' (thu·ªôc v·ªÅ t√≠n ng∆∞·ª°ng) l√† ph√π h·ª£p nh·∫•t (d√π ng√†y nay n√≥ mang t√≠nh vƒÉn h√≥a nhi·ªÅu h∆°n, nh∆∞ng ngu·ªìn g·ªëc l√† religious)."
        },
        {
            q: "10. The Lantern Festival is celebrated on the 15th day of the first _________________ month?",
            a: "lunar",
            exp: "<b>D·ªãch:</b> L·ªÖ h·ªôi L·ªìng ƒë√®n ƒë∆∞·ª£c t·ªï ch·ª©c v√†o ng√†y 15 c·ªßa th√°ng √Çm l·ªãch ƒë·∫ßu ti√™n.<br><b>Gi·∫£i th√≠ch:</b> 'Lunar month' (th√°ng √¢m l·ªãch). T·∫øt v√† c√°c l·ªÖ h·ªôi ph∆∞∆°ng ƒê√¥ng th∆∞·ªùng t√≠nh theo l·ªãch √¢m."
        }
    ];

    // Exercise 7 Data
    // Note: Answers handles fuzzy logic in JS function below
    const ex7Data = [
        { q: "1. Do you want to build a dollhouse? - Yes,", hint: "I do", sub: "you -> I", aux: "do" },
        { q: "2. Do we need two eggs to make pancake? - No,", hint: "we don't", sub: "we", aux: "don't" },
        { q: "3. Was she so sad yesterday? - Yes,", hint: "she was", sub: "she", aux: "was" },
        { q: "4. Did Nam have breakfast with his grandfather? - Yes,", hint: "he did", sub: "Nam -> he", aux: "did" },
        { q: "5. Are you and your friends in the hall? - No,", hint: "we aren't", sub: "you and your friends -> we", aux: "aren't" },
        { q: "6. Is he your English teacher? - Yes,", hint: "he is", sub: "he", aux: "is" },
        { q: "7. Were they going to the festival at that time? - No,", hint: "they weren't", sub: "they", aux: "weren't" },
        { q: "8. Did you and your sister visit the museum last Saturday? - No,", hint: "we didn't", sub: "you and your sister -> we", aux: "didn't" },
        { q: "9. Should I go out at midnight? - No,", hint: "you shouldn't", sub: "I -> you", aux: "shouldn't" },
        { q: "10. Can I borrow your pen? - Yes,", hint: "you can", sub: "I -> you", aux: "can" }
    ];

    // Exercise 8 Data
    const ex8Data = [
        { q: "1. _________ you have a brother?", a: "Do", type: "V-infinitive (have)" },
        { q: "2. _________ you a teacher?", a: "Are", type: "Noun (a teacher)" },
        { q: "3. _________ your sister live with you?", a: "Does", type: "V-infinitive (live), Singular Subject" },
        { q: "4. _________ she your friend?", a: "Is", type: "Noun (your friend), Singular Subject" },
        { q: "5. _________ Mary work on Friday?", a: "Does", type: "V-infinitive (work), Singular Subject" },
        { q: "6. _________ you like pizza?", a: "Do", type: "V-infinitive (like)" },
        { q: "7. _________ you tired today?", a: "Are", type: "Adjective (tired)" },
        { q: "8. _________ your parents from Egypt?", a: "Are", type: "Preposition/Origin (from), Plural Subject" },
        { q: "9. _________ this your watch?", a: "Is", type: "Noun (your watch), Singular" },
        { q: "10. _________ she in this class?", a: "Is", type: "Preposition/Place (in)" },
        { q: "11. _________ we need a computer?", a: "Do", type: "V-infinitive (need)" },
        { q: "12. _________ the chair broken?", a: "Is", type: "Adjective (broken), Singular" },
        { q: "13. _________ it work without the cable?", a: "Does", type: "V-infinitive (work), Singular" },
        { q: "14. _________ the pasta have salt in it?", a: "Does", type: "V-infinitive (have), Singular (pasta)" },
        { q: "15. _________ your sister at your house?", a: "Is", type: "Preposition/Place (at)" }
    ];

    // Exercise 9 Data (Matching)
    const ex9Data = [
        { q: "1. Where did you take the photos?", a: "E", text: "E. I took them at the Tulip Festival last month.", exp: "H·ªèi 'Where' (·ªü ƒë√¢u) -> Tr·∫£ l·ªùi ƒë·ªãa ƒëi·ªÉm 'at the Tulip Festival'." },
        { q: "2. What did you do at the festival?", a: "F", text: "F. We ate mooncakes and watched lion dances.", exp: "H·ªèi 'What did you do' (l√†m g√¨) -> Tr·∫£ l·ªùi h√†nh ƒë·ªông 'ate mooncakes...' (ƒÉn b√°nh trung thu)." },
        { q: "3. Do people prepare candy apples for Halloween?", a: "B", text: "B. Yes, they do.", exp: "C√¢u h·ªèi Yes/No 'Do people...?' -> Tr·∫£ l·ªùi 'Yes, they do'." },
        { q: "4. How was the concert last night?", a: "A", text: "A. It was disappointing!", exp: "H·ªèi 'How' (nh∆∞ th·∫ø n√†o/c·∫£m nh·∫≠n) -> Tr·∫£ l·ªùi t√≠nh t·ª´ 'disappointing' (th·∫•t v·ªçng)." },
        { q: "5. When is Christmas?", a: "D", text: "D. It's on the 25th of December.", exp: "H·ªèi 'When' (khi n√†o) -> Tr·∫£ l·ªùi ng√†y th√°ng '25th of December'." },
        { q: "6. Can your brother join the festival with us?", a: "C", text: "C. No, he can't.", exp: "C√¢u h·ªèi 'Can...?' -> Tr·∫£ l·ªùi 'No, he can't'." }
    ];

    // Exercise 2 Data (Conversation)
    const ex2Data = [
        { 
            id: 1, 
            prev: "Mark: ____________________________", 
            next: "Trang: Yes. I went to my uncle‚Äôs house in Bac Giang Province.", 
            a: "e", 
            full: "e. Did you go anywhere last weekend, Trang?",
            exp: "C√¢u tr·∫£ l·ªùi l√† 'Yes. I went...' (C√≥, t·ªõ ƒë√£ ƒëi...) n√™n c√¢u h·ªèi ph·∫£i l√† c√¢u nghi v·∫•n Yes/No h·ªèi v·ªÅ vi·ªác ƒëi ƒë√¢u ƒë√≥ trong qu√° kh·ª©."
        },
        { 
            id: 2, 
            prev: "Mark: ____________________________", 
            next: "Trang: Yes, there was a festival going on in the village...", 
            a: "b", 
            full: "b. Sounds interesting. Was there any special event in Bac Giang?",
            exp: "Trang tr·∫£ l·ªùi 'Yes, there was a festival...' (C√≥ l·ªÖ h·ªôi) -> Mark h·ªèi 'Was there any special event?' (C√≥ s·ª± ki·ªán g√¨ ƒë·∫∑c bi·ªát kh√¥ng?)."
        },
        { 
            id: 3, 
            prev: "Mark: ____________________________", 
            next: "Trang: Well, I saw people sing traditional songs and dance...", 
            a: "a", 
            full: "a. That‚Äôs great. What did you see and do at the festival?",
            exp: "Trang li·ªát k√™ h√†nh ƒë·ªông (saw people sing, watch a play) -> Mark ph·∫£i h·ªèi 'What did you see and do?' (B·∫°n ƒë√£ th·∫•y v√† l√†m g√¨?)."
        },
        { 
            id: 4, 
            prev: "Mark: ____________________________", 
            next: "Trang: Yes, of course. My extended family gathered...", 
            a: "d", 
            full: "d. I guess it was exciting. Did your family do any home activities then?",
            exp: "Trang k·ªÉ v·ªÅ gia ƒë√¨nh (extended family gathered) -> Mark h·ªèi 'Did your family do any home activities?' (Gia ƒë√¨nh c√≥ ho·∫°t ƒë·ªông g√¨ ·ªü nh√† kh√¥ng?)."
        },
        { 
            id: 5, 
            prev: "Mark: ____________________________", 
            next: "Trang: Yes, very much because it was a lot of fun.", 
            a: "c", 
            full: "c. And did you like the festival?",
            exp: "Trang tr·∫£ l·ªùi 'Yes, very much' (R·∫•t th√≠ch) -> Mark h·ªèi c·∫£m nh·∫≠n 'Did you like the festival?'."
        }
    ];

    // --- RENDER FUNCTIONS ---

    function renderEx6() {
        const container = document.getElementById('ex6-questions');
        ex6Data.forEach((item, index) => {
            const html = `
                <div class="question-item">
                    <label class="q-text">${item.q}</label>
                    <div style="display:flex; align-items:center;">
                        <select id="ex6_q${index}" class="ex6-select">
                            <option value="">-- Choose word --</option>
                            <option value="religious">religious</option>
                            <option value="celebrate">celebrate</option>
                            <option value="parade">parade</option>
                            <option value="went">went</option>
                            <option value="attend">attend</option>
                            <option value="decorate">decorate</option>
                            <option value="lunar">lunar</option>
                            <option value="festival">festival</option>
                            <option value="performers">performers</option>
                            <option value="music">music</option>
                        </select>
                        <button class="btn-check-single" onclick="checkEx6(${index})">Check</button>
                    </div>
                    <div id="ex6_exp${index}" class="explanation">
                        <span class="exp-header">ƒê√°p √°n ƒë√∫ng: ${item.a}</span>
                        <span class="exp-detail">${item.exp}</span>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkEx6(index) {
        const select = document.getElementById(`ex6_q${index}`);
        const expBox = document.getElementById(`ex6_exp${index}`);
        const userVal = select.value;
        const correctVal = ex6Data[index].a;

        if (userVal === correctVal) {
            select.classList.remove('wrong-input');
            select.classList.add('correct-input');
        } else {
            select.classList.remove('correct-input');
            select.classList.add('wrong-input');
        }
        expBox.classList.add('show');
    }

    function renderEx7() {
        const container = document.getElementById('ex7-questions');
        ex7Data.forEach((item, index) => {
            const html = `
                <div class="question-item">
                    <label class="q-text">${item.q}</label>
                    <div style="display:flex; align-items:center;">
                        <input type="text" id="ex7_q${index}" placeholder="...">
                        <button class="btn-check-single" onclick="checkEx7(${index})">Check</button>
                    </div>
                    <div id="ex7_exp${index}" class="explanation">
                        <span class="exp-header">ƒê√°p √°n ƒë√∫ng: ${item.hint}</span>
                        <div class="exp-detail">
                            <ul>
                                <li><b>Quy ƒë·ªïi ch·ªß ng·ªØ:</b> ${item.sub}</li>
                                <li><b>Tr·ª£ ƒë·ªông t·ª´:</b> ${item.aux}</li>
                            </ul>
                            <i>L∆∞u √Ω: C√≥ th·ªÉ vi·∫øt t·∫Øt (don't) ho·∫∑c ƒë·∫ßy ƒë·ªß (do not).</i>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkEx7(index) {
        const input = document.getElementById(`ex7_q${index}`);
        const expBox = document.getElementById(`ex7_exp${index}`);
        // Normalize: lowercase, trim, remove punctuation
        let userVal = input.value.toLowerCase().trim().replace('.', '');
        let correctVal = ex7Data[index].hint.toLowerCase().replace('.', '');
        
        // Handle "we aren't" vs "we are not" logic simply by checking main keywords or exact match variants
        // For simplicity in this demo, strict match or known variants
        let isValid = false;
        
        // Expanded check for contractions
        const map = {
            "don't": "do not",
            "doesn't": "does not",
            "didn't": "did not",
            "weren't": "were not",
            "aren't": "are not",
            "isn't": "is not",
            "can't": "cannot",
            "shouldn't": "should not"
        };
        
        // Check if userVal matches correctVal OR the uncontracted version
        let correctExpanded = correctVal;
        for (let k in map) {
            if (correctVal.includes(k)) {
                correctExpanded = correctVal.replace(k, map[k]);
                break;
            }
        }

        if (userVal === correctVal || userVal === correctExpanded) {
            isValid = true;
        }

        if (isValid) {
            input.classList.remove('wrong-input');
            input.classList.add('correct-input');
        } else {
            input.classList.remove('correct-input');
            input.classList.add('wrong-input');
        }
        expBox.classList.add('show');
    }

    function renderEx8() {
        const container = document.getElementById('ex8-questions');
        ex8Data.forEach((item, index) => {
            const html = `
                <div class="question-item">
                    <label class="q-text">${item.q}</label>
                    <div style="display:flex; align-items:center;">
                        <select id="ex8_q${index}" class="ex8-select">
                            <option value="">-- Select --</option>
                            <option value="Am">Am</option>
                            <option value="Is">Is</option>
                            <option value="Are">Are</option>
                            <option value="Do">Do</option>
                            <option value="Does">Does</option>
                        </select>
                        <button class="btn-check-single" onclick="checkEx8(${index})">Check</button>
                    </div>
                    <div id="ex8_exp${index}" class="explanation">
                        <span class="exp-header">ƒê√°p √°n ƒë√∫ng: ${item.a}</span>
                        <span class="exp-detail"><b>L√Ω do:</b> ${item.type}.<br>
                        - D√πng <b>Do/Does</b> cho c√¢u h·ªèi c√≥ ƒë·ªông t·ª´ th∆∞·ªùng.<br>
                        - D√πng <b>Am/Is/Are</b> cho c√¢u h·ªèi v·ªõi T√≠nh t·ª´/Danh t·ª´/Gi·ªõi t·ª´.</span>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkEx8(index) {
        const select = document.getElementById(`ex8_q${index}`);
        const expBox = document.getElementById(`ex8_exp${index}`);
        if (select.value === ex8Data[index].a) {
            select.classList.remove('wrong-input');
            select.classList.add('correct-input');
        } else {
            select.classList.remove('correct-input');
            select.classList.add('wrong-input');
        }
        expBox.classList.add('show');
    }

    function renderEx9() {
        const container = document.getElementById('ex9-questions');
        ex9Data.forEach((item, index) => {
            const html = `
                <div class="question-item">
                    <label class="q-text">${item.q}</label>
                    <div style="display:flex; align-items:center;">
                        <select id="ex9_q${index}" class="ex9-select">
                            <option value="">-- Match Response --</option>
                            <option value="A">A. It was disappointing!</option>
                            <option value="B">B. Yes, they do.</option>
                            <option value="C">C. No, he can't.</option>
                            <option value="D">D. It's on the 25th of December.</option>
                            <option value="E">E. I took them at the Tulip Festival...</option>
                            <option value="F">F. We ate mooncakes...</option>
                        </select>
                        <button class="btn-check-single" onclick="checkEx9(${index})">Check</button>
                    </div>
                    <div id="ex9_exp${index}" class="explanation">
                        <span class="exp-header">ƒê√°p √°n ƒë√∫ng: ${item.text}</span>
                        <span class="exp-detail"><b>Gi·∫£i th√≠ch:</b> ${item.exp}</span>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkEx9(index) {
        const select = document.getElementById(`ex9_q${index}`);
        const expBox = document.getElementById(`ex9_exp${index}`);
        if (select.value === ex9Data[index].a) {
            select.classList.remove('wrong-input');
            select.classList.add('correct-input');
        } else {
            select.classList.remove('correct-input');
            select.classList.add('wrong-input');
        }
        expBox.classList.add('show');
    }

    function renderEx2() {
        const container = document.getElementById('ex2-questions');
        ex2Data.forEach((item, index) => {
            const html = `
                <div class="question-item">
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                        <p style="margin:0; color:#555;">${item.prev}</p>
                        <p style="margin:5px 0 0 20px; font-weight:bold;">${item.next}</p>
                    </div>
                    <div style="display:flex; align-items:center;">
                        <select id="ex2_q${index}" class="full-width-select">
                            <option value="">-- Choose sentence --</option>
                            <option value="a">a. That‚Äôs great. What did you see...?</option>
                            <option value="b">b. Sounds interesting. Was there any special...?</option>
                            <option value="c">c. And did you like the festival?</option>
                            <option value="d">d. I guess it was exciting. Did your family...?</option>
                            <option value="e">e. Did you go anywhere last weekend...?</option>
                        </select>
                        <button class="btn-check-single" onclick="checkEx2(${index})">Check</button>
                    </div>
                    <div id="ex2_exp${index}" class="explanation">
                        <span class="exp-header">ƒê√°p √°n ƒë√∫ng: ${item.full}</span>
                        <span class="exp-detail"><b>Logic h·ªôi tho·∫°i:</b> ${item.exp}</span>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function checkEx2(index) {
        const select = document.getElementById(`ex2_q${index}`);
        const expBox = document.getElementById(`ex2_exp${index}`);
        if (select.value === ex2Data[index].a) {
            select.classList.remove('wrong-input');
            select.classList.add('correct-input');
        } else {
            select.classList.remove('correct-input');
            select.classList.add('wrong-input');
        }
        expBox.classList.add('show');
    }

    // --- MAIN SUBMIT FUNCTION ---
    function submitAll() {
        let score = 0;
        let total = ex6Data.length + ex7Data.length + ex8Data.length + ex9Data.length + ex2Data.length;

        // Auto check Ex 6
        ex6Data.forEach((item, i) => {
            checkEx6(i);
            const val = document.getElementById(`ex6_q${i}`).value;
            if(val === item.a) score++;
        });

        // Auto check Ex 7
        ex7Data.forEach((item, i) => {
            checkEx7(i);
            const input = document.getElementById(`ex7_q${i}`);
            // Re-verify strictly for score count (reusing logic inside would be cleaner but this works)
            if(input.classList.contains('correct-input')) score++;
        });

        // Auto check Ex 8
        ex8Data.forEach((item, i) => {
            checkEx8(i);
            const val = document.getElementById(`ex8_q${i}`).value;
            if(val === item.a) score++;
        });

        // Auto check Ex 9
        ex9Data.forEach((item, i) => {
            checkEx9(i);
            const val = document.getElementById(`ex9_q${i}`).value;
            if(val === item.a) score++;
        });

        // Auto check Ex 2
        ex2Data.forEach((item, i) => {
            checkEx2(i);
            const val = document.getElementById(`ex2_q${i}`).value;
            if(val === item.a) score++;
        });

        // Show Modal
        const modal = document.getElementById('resultModal');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const scoreMessage = document.getElementById('scoreMessage');

        scoreDisplay.textContent = `${score}/${total}`;
        
        const percentage = (score / total) * 100;
        if(percentage >= 90) scoreMessage.textContent = "Xu·∫•t s·∫Øc! B·∫°n l√† b·∫≠c th·∫ßy ng·ªØ ph√°p!";
        else if(percentage >= 70) scoreMessage.textContent = "L√†m t·ªët l·∫Øm! Ch·ªâ c√≤n v√†i l·ªói nh·ªè th√¥i.";
        else scoreMessage.textContent = "C·ªë g·∫Øng h∆°n nh√©! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch.";

        modal.style.display = "flex";
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = "none";
        // Scroll to top or specific error? Let's just stay where we are so they can review.
    }

    // --- INITIALIZE ---
    window.onload = function() {
        renderEx6();
        renderEx7();
        renderEx8();
        renderEx9();
        renderEx2();
    };

</script>

</body>
</html>


