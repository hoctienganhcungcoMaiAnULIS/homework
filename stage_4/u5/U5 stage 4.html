<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 5: Adventures - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng ch·ªß ƒë·∫°o */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --accent: #FF9F43; /* Cam nh·∫•n */
            --correct: #00D26A; /* Xanh l√° ƒë√∫ng */
            --wrong: #FF4757; /* ƒê·ªè sai */
            --bg-color: #f0f3ff;
            --card-bg: #ffffff;
            --text-color: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 0.5px, transparent 0.5px), radial-gradient(#8854c0 0.5px, #f0f3ff 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            user-select: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(136, 84, 192, 0.2);
            border: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 2.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .teacher-name {
            color: var(--secondary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 5px;
            background: #e0fffa;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 50px;
        }

        /* CARD STYLES */
        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 #e1e1e1;
            border: 2px solid #d1d8e0;
            transition: transform 0.3s;
        }

        h2 {
            color: var(--primary);
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
            margin-top: 0;
            font-family: 'Quicksand', sans-serif;
        }

        /* QUESTIONS & OPTIONS */
        .question-block {
            margin-bottom: 40px;
        }

        .question-text {
            font-weight: 800;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
            transition: all 0.1s;
            box-shadow: 0 6px 0 #bdc3c7;
            position: relative;
            color: #57606f;
        }

        .option-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #bdc3c7;
        }

        /* STATES: CORRECT / WRONG */
        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 6px 0 #009e82;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: #e03e4d;
            box-shadow: 0 6px 0 #c23616;
            opacity: 0.7;
        }

        /* FEEDBACK ALERT BOX */
        .feedback-alert {
            display: none;
            padding: 15px;
            margin-top: 15px;
            border-radius: 12px;
            font-weight: 800;
            text-align: center;
            font-size: 1.1rem;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .feedback-alert.wrong-alert {
            display: block;
            background: var(--wrong);
            animation: shake 0.5s;
            border: 2px solid #d63031;
        }

        .feedback-alert.correct-alert {
            display: block;
            background: var(--correct);
            animation: pop 0.3s;
            border: 2px solid #00b894;
        }

        /* EXPLANATION BOX */
        .explanation {
            display: none;
            margin-top: 15px;
            background: #e8fbf4;
            border: 2px solid var(--correct);
            border-radius: 15px;
            padding: 20px;
            animation: slideDown 0.3s ease-out;
            text-align: left;
        }

        .explanation.visible { display: block; }
        
        .exp-header {
            font-weight: 800;
            color: var(--correct);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .exp-content p { margin: 5px 0; font-size: 1rem; }
        
        /* GAP FILL LAYOUT */
        .gap-fill-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .options-box {
            background: #fff4e6;
            border: 2px solid var(--accent);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .word-tag {
            background: white;
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            font-weight: bold;
            color: var(--accent);
            box-shadow: 0 3px 0 #ffeaa7;
        }

        .reading-text {
            background: #f1f2f6;
            padding: 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            line-height: 1.8;
            border-left: 5px solid var(--secondary);
        }

        .gap-blank {
            display: inline-block;
            width: 40px;
            height: 30px;
            border-bottom: 2px solid #333;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        .answer-group {
            background: white;
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 4px 0 #ddd;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid #eee;
            margin-bottom: 10px;
        }

        .mini-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .mini-btn:hover { background: #eee; }
        .mini-btn.correct { background: var(--correct); color: white; border-color: var(--correct); }
        .mini-btn.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }

        /* GLOSSARY */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 0 #eee;
        }
        .glossary-table th { background: var(--primary); color: white; padding: 10px; }
        .glossary-table td { padding: 10px; border-bottom: 1px solid #eee; }
        .word-type { color: #888; font-style: italic; font-size: 0.8rem; }

        /* ANIMATIONS */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* POPUP SCORE */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            max-width: 400px; width: 90%;
            border: 5px solid var(--primary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: slideDown 0.5s;
        }

        .score-big { font-size: 4rem; font-weight: 800; color: var(--correct); margin: 10px 0; }
        
        .btn-submit {
            background: var(--secondary); color: white; border: none;
            padding: 15px 40px; font-size: 1.5rem; border-radius: 50px;
            font-weight: 800; cursor: pointer; box-shadow: 0 8px 0 #009e82;
            display: block; margin: 40px auto; transition: 0.2s;
        }
        .btn-submit:active { transform: translateY(6px); box-shadow: 0 2px 0 #009e82; }

        #confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>Unit 5 - Adventures</h1>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
    </header>

    <div class="card">
        <h2>Part 1: Hero Qualities & Traits (Ph·∫©m ch·∫•t Ng∆∞·ªùi h√πng)</h2>
        <p style="text-align: center; color: #666; font-style: italic;">Ch·ªçn t·ª´ ƒë√∫ng nh·∫•t d·ª±a tr√™n ƒë·ªãnh nghƒ©a trong h√¨nh.</p>

        <div class="question-block" id="q1-block">
            <div class="question-text">1. She is very ________; she can solve difficult puzzles easily.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">A. Brave</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">B. Intelligent</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">C. Powerful</button>
                <button class="option-btn" onclick="checkAnswer('q1', 2, this)">D. Athletic</button>
            </div>
            <div id="alert-q1" class="feedback-alert"></div>
            <div class="explanation" id="exp-q1">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> C√¥ ·∫•y r·∫•t _______; c√¥ ·∫•y c√≥ th·ªÉ gi·∫£i nh·ªØng c√¢u ƒë·ªë kh√≥ m·ªôt c√°ch d·ªÖ d√†ng.</p>
                    <p><strong>T·∫°i sao ch·ªçn B?</strong> D·ª±a v√†o c·ª•m t·ª´ "solve difficult puzzles" (gi·∫£i c√¢u ƒë·ªë kh√≥) -> ƒê√¢y l√† bi·ªÉu hi·ªán c·ªßa tr√≠ th√¥ng minh (Intelligent).</p>
                    <p><strong>Ph√¢n t√≠ch sai:</strong> Brave (D≈©ng c·∫£m), Powerful (M·∫°nh m·∫Ω), Athletic (Kh·ªèe kho·∫Øn) kh√¥ng li√™n quan ƒë·∫øn gi·∫£i ƒë·ªë.</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q2-block">
            <div class="question-text">2. A ________ friend always helps you when you need it.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q2', 3, this)">A. Honest</button>
                <button class="option-btn" onclick="checkAnswer('q2', 3, this)">B. Athletic</button>
                <button class="option-btn" onclick="checkAnswer('q2', 3, this)">C. Loyal</button>
                <button class="option-btn" onclick="checkAnswer('q2', 3, this)">D. Brave</button>
            </div>
            <div id="alert-q2" class="feedback-alert"></div>
            <div class="explanation" id="exp-q2">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> M·ªôt ng∆∞·ªùi b·∫°n _______ lu√¥n gi√∫p ƒë·ª° khi b·∫°n c·∫ßn.</p>
                    <p><strong>T·∫°i sao ch·ªçn C?</strong> Theo ƒë·ªãnh nghƒ©a trong b√†i h·ªçc: "A loyal friend always helps you when you need it." (M·ªôt ng∆∞·ªùi b·∫°n trung th√†nh lu√¥n gi√∫p ƒë·ª° khi b·∫°n c·∫ßn).</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q3-block">
            <div class="question-text">3. Which word means "runs fast and jump high"?</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q3', 1, this)">A. Athletic</button>
                <button class="option-btn" onclick="checkAnswer('q3', 1, this)">B. Powerful</button>
                <button class="option-btn" onclick="checkAnswer('q3', 1, this)">C. Intelligent</button>
                <button class="option-btn" onclick="checkAnswer('q3', 1, this)">D. Honest</button>
            </div>
            <div id="alert-q3" class="feedback-alert"></div>
            <div class="explanation" id="exp-q3">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> T·ª´ n√†o c√≥ nghƒ©a l√† "ch·∫°y nhanh v√† nh·∫£y cao"?</p>
                    <p><strong>T·∫°i sao ch·ªçn A?</strong> ƒê·ªãnh nghƒ©a trong h√¨nh: "He is athletic; he can run fast and jump high."</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Part 2: Creating a Hero & Art (V·∫Ω v√† S√°ng t·∫°o)</h2>
        
        <div class="question-block" id="q4-block">
            <div class="question-text">4. What do you use to "rub out" the mistakes?</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q4', 2, this)">A. A pencil</button>
                <button class="option-btn" onclick="checkAnswer('q4', 2, this)">B. An eraser</button>
                <button class="option-btn" onclick="checkAnswer('q4', 2, this)">C. A cape</button>
                <button class="option-btn" onclick="checkAnswer('q4', 2, this)">D. A mask</button>
            </div>
            <div id="alert-q4" class="feedback-alert"></div>
            <div class="explanation" id="exp-q4">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> B·∫°n d√πng c√°i g√¨ ƒë·ªÉ "x√≥a" (rub out) nh·ªØng l·ªói sai?</p>
                    <p><strong>T·∫°i sao ch·ªçn B?</strong> C·ª•m t·ª´ "Use an eraser to rub out the mistakes" (D√πng t·∫©y ƒë·ªÉ x√≥a l·ªói sai) c√≥ trong c·ªôt 2 c·ªßa b√†i.</p>
                </div>
            </div>
        </div>

        <div class="question-block" id="q5-block">
            <div class="question-text">5. You should draw light ________ to help shape the body.</div>
            <div class="options-grid">
                <button class="option-btn" onclick="checkAnswer('q5', 3, this)">A. descriptions</button>
                <button class="option-btn" onclick="checkAnswer('q5', 3, this)">B. powers</button>
                <button class="option-btn" onclick="checkAnswer('q5', 3, this)">C. guidelines</button>
                <button class="option-btn" onclick="checkAnswer('q5', 3, this)">D. masks</button>
            </div>
            <div id="alert-q5" class="feedback-alert"></div>
            <div class="explanation" id="exp-q5">
                <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                <div class="exp-content">
                    <p><strong>D·ªãch c√¢u h·ªèi:</strong> B·∫°n n√™n v·∫Ω nh·ªØng ƒë∆∞·ªùng ________ m·ªù ƒë·ªÉ gi√∫p t·∫°o d√°ng c∆° th·ªÉ.</p>
                    <p><strong>T·∫°i sao ch·ªçn C?</strong> D·ª±a v√†o h∆∞·ªõng d·∫´n trong b√†i: "Draw light guidelines to help shape the body".</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Part 3: Adventure Story Elements (C√¢u chuy·ªán phi√™u l∆∞u)</h2>
        <p style="margin-bottom: 20px;"><em>Read the story and choose the correct words to fill in the blanks.</em></p>

        <div class="options-box">
            <div class="word-tag">A. campsite</div>
            <div class="word-tag">B. dilemma</div>
            <div class="word-tag">C. sniff</div>
            <div class="word-tag">D. setting</div>
        </div>

        <div class="reading-text">
            The <strong>(6)</strong> <span class="gap-blank">___</span> of our story was a dark forest. We set up a tent at the <strong>(7)</strong> <span class="gap-blank">___</span> near a large tree. Suddenly, a big black bear came out of the bush! It started to <strong>(8)</strong> <span class="gap-blank">___</span> the air to find food. The hero faced a difficult <strong>(9)</strong> <span class="gap-blank">___</span>: should he fight the bear or hide behind the tree?
        </div>

        <table class="glossary-table">
            <thead>
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>Setting</strong></td><td>(n)</td><td>B·ªëi c·∫£nh (n∆°i di·ªÖn ra c√¢u chuy·ªán)</td></tr>
                <tr><td><strong>Campsite</strong></td><td>(n)</td><td>Khu c·∫Øm tr·∫°i</td></tr>
                <tr><td><strong>Sniff</strong></td><td>(v)</td><td>Ng·ª≠i, h√≠t ng·ª≠i</td></tr>
                <tr><td><strong>Dilemma</strong></td><td>(n)</td><td>T√¨nh th·∫ø ti·∫øn tho√°i l∆∞·ª°ng nan (t√¨nh hu·ªëng kh√≥ x·ª≠)</td></tr>
            </tbody>
        </table>

        <div class="gap-fill-container" style="margin-top: 20px;">
            <div>
                <div class="answer-group">
                    <label>6.</label>
                    <button class="mini-btn" onclick="checkGap('q6', 0, 3, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q6', 1, 3, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q6', 2, 3, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q6', 3, 3, this, ['A','B','C','D'])">D</button>
                </div>
                <div id="alert-q6" class="feedback-alert"></div>
                <div class="explanation" id="exp-q6">
                    <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-content">
                        <p><strong>ƒê√°p √°n ƒë√∫ng: D. setting</strong></p>
                        <p>V√¨ c√¢u nh·∫Øc ƒë·∫øn "dark forest" (khu r·ª´ng t·ªëi) -> ƒê√¢y l√† n∆°i ch·ªën/b·ªëi c·∫£nh (Setting).</p>
                    </div>
                </div>
            </div>

            <div>
                <div class="answer-group">
                    <label>7.</label>
                    <button class="mini-btn" onclick="checkGap('q7', 0, 0, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q7', 1, 0, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q7', 2, 0, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q7', 3, 0, this, ['A','B','C','D'])">D</button>
                </div>
                <div id="alert-q7" class="feedback-alert"></div>
                <div class="explanation" id="exp-q7">
                    <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-content">
                        <p><strong>ƒê√°p √°n ƒë√∫ng: A. campsite</strong></p>
                        <p>Key word: "set up a tent" (d·ª±ng l·ªÅu) -> Ph·∫£i d·ª±ng ·ªü "campsite" (khu c·∫Øm tr·∫°i).</p>
                    </div>
                </div>
            </div>

            <div>
                <div class="answer-group">
                    <label>8.</label>
                    <button class="mini-btn" onclick="checkGap('q8', 0, 2, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q8', 1, 2, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q8', 2, 2, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q8', 3, 2, this, ['A','B','C','D'])">D</button>
                </div>
                <div id="alert-q8" class="feedback-alert"></div>
                <div class="explanation" id="exp-q8">
                    <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-content">
                        <p><strong>ƒê√°p √°n ƒë√∫ng: C. sniff</strong></p>
                        <p>Key word: "find food" (t√¨m th·ª©c ƒÉn) v√† h√†nh ƒë·ªông c·ªßa con g·∫•u -> Sniff (ng·ª≠i).</p>
                    </div>
                </div>
            </div>

            <div>
                <div class="answer-group">
                    <label>9.</label>
                    <button class="mini-btn" onclick="checkGap('q9', 0, 1, this, ['A','B','C','D'])">A</button>
                    <button class="mini-btn" onclick="checkGap('q9', 1, 1, this, ['A','B','C','D'])">B</button>
                    <button class="mini-btn" onclick="checkGap('q9', 2, 1, this, ['A','B','C','D'])">C</button>
                    <button class="mini-btn" onclick="checkGap('q9', 3, 1, this, ['A','B','C','D'])">D</button>
                </div>
                <div id="alert-q9" class="feedback-alert"></div>
                <div class="explanation" id="exp-q9">
                    <div class="exp-header">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-content">
                        <p><strong>ƒê√°p √°n ƒë√∫ng: B. dilemma</strong></p>
                        <p>C√¢u h·ªèi "Should he... or...?" th·ªÉ hi·ªán m·ªôt s·ª± l·ª±a ch·ªçn kh√≥ khƒÉn -> Dilemma.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
</div>

<div class="popup-overlay" id="scorePopup">
    <div class="popup-content">
        <h2 style="color:var(--primary)">K·∫æT QU·∫¢ C·ª¶A CON</h2>
        <div class="score-big" id="finalScore">0/9</div>
        <p id="praiseText" style="font-size: 1.2rem; margin-bottom: 20px;">L√†m t·ªët l·∫Øm!</p>
        <button class="btn-submit" style="margin: 0 auto; font-size: 1rem; padding: 10px 30px;" onclick="closePopup()">Xem l·∫°i b√†i</button>
    </div>
</div>

<script>
    let totalScore = 0;
    const totalQuestions = 9;
    let answered = {}; // To prevent double scoring

    // --- NEW SOUND EFFECTS ---
    // Correct: "Ding" sound
    const soundCorrect = new Audio('https://www.myinstants.com/media/sounds/ding-sound-effect.mp3');
    // Wrong: "T√©o teo t√®o teo" sound (Sad Trombone)
    const soundWrong = new Audio('https://www.myinstants.com/media/sounds/sadtrombone.swf.mp3');

    function playSound(isCorrect) {
        if(isCorrect) {
            soundCorrect.currentTime = 0;
            soundCorrect.play().catch(e => console.log("Audio blocked"));
        } else {
            soundWrong.currentTime = 0;
            soundWrong.play().catch(e => console.log("Audio blocked"));
        }
    }

    // --- MCQ CHECKER ---
    function checkAnswer(qId, correctIndex, btn) {
        if(answered[qId]) return;
        answered[qId] = true;

        const parent = btn.parentElement;
        const buttons = parent.getElementsByClassName('option-btn');
        const selectedIndex = Array.from(buttons).indexOf(btn) + 1; // 1-based index
        const explanation = document.getElementById(`exp-${qId}`);
        const alertBox = document.getElementById(`alert-${qId}`);
        const correctText = buttons[correctIndex-1].innerText;

        if(selectedIndex === correctIndex) {
            btn.classList.add('correct');
            totalScore++;
            playSound(true);
            fireConfetti();
            
            // Alert Correct
            alertBox.innerHTML = "üåü CH√çNH X√ÅC! GI·ªéI L·∫ÆM!";
            alertBox.className = "feedback-alert correct-alert";
        } else {
            btn.classList.add('wrong');
            buttons[correctIndex - 1].classList.add('correct'); // Show correct answer
            playSound(false);

            // Alert Wrong (RED WARNING)
            alertBox.innerHTML = `‚ö†Ô∏è SAI R·ªíI! ƒê√ÅP √ÅN ƒê√öNG L√Ä: <br>${correctText}`;
            alertBox.className = "feedback-alert wrong-alert";
        }

        explanation.classList.add('visible');
    }

    // --- GAP FILL CHECKER ---
    function checkGap(qId, selectedIndex, correctIndex, btn, labels) {
        if(answered[qId]) return;
        answered[qId] = true;

        const parent = btn.parentElement;
        const buttons = parent.getElementsByClassName('mini-btn');
        const explanation = document.getElementById(`exp-${qId}`);
        const alertBox = document.getElementById(`alert-${qId}`);
        const correctLabel = labels[correctIndex];

        if(selectedIndex === correctIndex) {
            btn.classList.add('correct');
            totalScore++;
            playSound(true);
            fireConfetti();

            // Alert Correct
            alertBox.innerHTML = "üåü CH√çNH X√ÅC!";
            alertBox.className = "feedback-alert correct-alert";
        } else {
            btn.classList.add('wrong');
            buttons[correctIndex].classList.add('correct');
            playSound(false);

            // Alert Wrong (RED WARNING)
            alertBox.innerHTML = `‚ö†Ô∏è R·∫§T TI·∫æC! ƒê√ÅP √ÅN ƒê√öNG L√Ä (${correctLabel})`;
            alertBox.className = "feedback-alert wrong-alert";
        }

        explanation.classList.add('visible');
    }

    function submitQuiz() {
        const scoreText = document.getElementById('finalScore');
        const praiseText = document.getElementById('praiseText');
        
        scoreText.innerText = `${totalScore}/${totalQuestions}`;
        
        const percentage = (totalScore / totalQuestions) * 100;
        if(percentage === 100) praiseText.innerText = "Xu·∫•t s·∫Øc! Con l√† si√™u anh h√πng ti·∫øng Anh! ü¶∏‚Äç‚ôÇÔ∏èü¶∏‚Äç‚ôÄÔ∏è";
        else if(percentage >= 80) praiseText.innerText = "Gi·ªèi l·∫Øm! Con nh·ªõ t·ª´ v·ª±ng r·∫•t t·ªët! üåü";
        else if(percentage >= 50) praiseText.innerText = "Kh√° t·ªët! Con h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üí™";
        else praiseText.innerText = "C·ªë g·∫Øng l√™n nh√©! C√¥ Mai An tin con l√†m ƒë∆∞·ª£c! ‚ù§Ô∏è";

        document.getElementById('scorePopup').style.display = 'flex';
        if(percentage >= 50) fireConfetti();
    }

    function closePopup() {
        document.getElementById('scorePopup').style.display = 'none';
    }

    // Confetti Effect
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let confetti = [];

    function fireConfetti() {
        for (let i = 0; i < 100; i++) {
            confetti.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: ['#8854C0', '#00C9A7', '#FF9F43', '#FF4757', '#2e86de'][Math.floor(Math.random() * 5)],
                size: Math.random() * 8 + 4,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 4 - 2
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let active = false;
        confetti.forEach((p, i) => {
            p.y += p.speedY;
            p.x += p.speedX;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if (p.y < canvas.height) active = true;
        });
        if (active) requestAnimationFrame(animateConfetti);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
</script>

</body>
</html>