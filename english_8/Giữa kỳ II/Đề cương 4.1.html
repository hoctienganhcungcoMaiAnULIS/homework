<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #FFD166;
            --tertiary: #00C9A7;
            --correct: #00D26A;
            --correct-shadow: #00a854;
            --wrong: #FF4757;
            --wrong-shadow: #d63031;
            --text-main: #2d3436;
            --btn-bg: #ffffff;
            --btn-shadow: #e0e0e0;
        }

        * { box-sizing: border-box; font-family: 'Quicksand', sans-serif; }

        body {
            margin: 0; padding: 20px;
            background: 
                url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 20 L25 10 L30 20 L40 25 L30 30 L25 40 L20 30 L10 25 Z" fill="%23ffffff" opacity="0.4"/><circle cx="80" cy="80" r="8" fill="%23ffffff" opacity="0.4"/><path d="M70 20 Q80 10 90 20 Q80 30 70 20" fill="%23ffffff" opacity="0.4"/><circle cx="30" cy="80" r="5" fill="%23ffffff" opacity="0.4"/></svg>'),
                linear-gradient(135deg, var(--primary), var(--secondary), var(--tertiary));
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
        }

        .header {
            text-align: center; background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px; border-radius: 20px; margin: 0 auto 30px;
            max-width: 800px; box-shadow: 0 8px 0 rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 1.2rem; color: var(--primary); margin: 0; font-weight: 900; }

        .container { max-width: 800px; margin: 0 auto; }

        .section-title {
            background: var(--btn-bg); padding: 15px 25px; border-radius: 20px;
            font-size: 1.5rem; font-weight: 900; color: var(--primary);
            margin-bottom: 20px; box-shadow: 0 6px 0 rgba(0,0,0,0.1);
            text-transform: uppercase; text-align: center;
        }

        .card {
            background: #ffffff; border-radius: 20px; padding: 25px;
            margin-bottom: 30px; box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            transition: transform 0.2s; position: relative;
        }

        .question-text { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; line-height: 1.5; }
        .question-text u { color: var(--wrong); text-decoration: underline; text-decoration-thickness: 3px; }

        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        .option-btn {
            background: var(--btn-bg); border: 2px solid #f1f2f6; border-radius: 15px;
            padding: 15px; font-size: 1.1rem; font-weight: 700; color: var(--text-main);
            cursor: pointer; box-shadow: 0 6px 0 var(--btn-shadow);
            transition: all 0.1s ease-in-out; text-align: left; display: flex; align-items: center;
        }

        .option-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); box-shadow: 0 9px 0 var(--btn-shadow); }
        .option-btn:active:not(:disabled) { transform: translateY(4px); box-shadow: 0 2px 0 var(--btn-shadow); }
        .option-btn.correct { background: var(--correct); border-color: var(--correct-shadow); box-shadow: 0 6px 0 var(--correct-shadow); color: white; animation: pop 0.3s; }
        .option-btn.wrong { background: var(--wrong); border-color: var(--wrong-shadow); box-shadow: 0 6px 0 var(--wrong-shadow); color: white; animation: shake 0.4s; }

        .explanation {
            display: none; margin-top: 20px; padding: 20px; background: #f8f9fa;
            border-left: 6px solid var(--tertiary); border-radius: 15px;
            font-size: 1rem; line-height: 1.6; animation: slideDown 0.3s ease-out;
        }
        .explanation.show { display: block; }
        .explanation h4 { margin: 0 0 10px 0; color: var(--primary); font-size: 1.1rem; }
        .step-title { font-weight: 900; color: #d63031; }

        .gap-fill {
            display: inline-block; min-width: 100px; padding: 5px 15px; background: #f1f2f6;
            border: 2px dashed var(--primary); border-radius: 10px; cursor: pointer;
            font-weight: bold; color: var(--primary); text-align: center; transition: 0.2s;
        }
        .gap-fill:hover { background: #eccc68; color: #fff; }
        .gap-fill.answered-correct { background: var(--correct); border-color: var(--correct-shadow); color: white; border-style: solid; }
        .gap-fill.answered-wrong { background: var(--wrong); border-color: var(--wrong-shadow); color: white; border-style: solid; }

        .submit-btn {
            display: block; width: 100%; background: var(--tertiary); color: white;
            border: none; border-radius: 20px; padding: 20px; font-size: 1.5rem;
            font-weight: 900; cursor: pointer; box-shadow: 0 8px 0 #009980;
            transition: all 0.2s; margin-top: 40px; margin-bottom: 50px; text-transform: uppercase;
        }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 11px 0 #009980; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-8px); } 50% { transform: translateX(8px); } }
        @keyframes pop { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal { background: white; padding: 30px; border-radius: 25px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 15px 0 rgba(0,0,0,0.2); animation: pop 0.4s; }
        .modal h2 { color: var(--primary); font-size: 2rem; margin-top: 0;}
        .modal p { font-size: 1.2rem; font-weight: 700;}
        
        .gap-popup { display: none; position: absolute; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 100; border: 2px solid var(--primary); flex-direction: column; gap: 10px; width: max-content; }
        .gap-popup button { background: white; border: 2px solid #e0e0e0; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .gap-popup button:hover { background: var(--secondary); border-color: #f1c40f; }

        canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9999; }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>

    <div class="header">
        <h1>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h1>
    </div>

    <div class="container" id="quiz-container">
        </div>

    <div class="container">
        <button class="submit-btn" onclick="submitQuiz()">N·ªôp B√†i L·∫•y ƒêi·ªÉm!</button>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal">
            <h2>Tuy·ªát V·ªùi! üéâ</h2>
            <p id="score-text"></p>
            <p id="praise-text" style="color: var(--tertiary); font-size: 1.5rem;"></p>
            <button class="submit-btn" style="margin-top:20px; padding: 10px; font-size: 1.2rem;" onclick="location.reload()">Ch∆°i L·∫°i N√†o!</button>
        </div>
    </div>

<script>
// WEB AUDIO API
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq, type, duration, vol=0.1) {
    const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
    osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(vol, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration);
}
function playCorrect() { if(audioCtx.state === 'suspended') audioCtx.resume(); playTone(600, 'sine', 0.1); setTimeout(() => playTone(800, 'sine', 0.2), 100); fireConfetti(); }
function playWrong() { if(audioCtx.state === 'suspended') audioCtx.resume(); playTone(300, 'sawtooth', 0.2, 0.2); setTimeout(() => playTone(250, 'sawtooth', 0.3, 0.2), 150); }

// CONFETTI
const canvas = document.getElementById('confetti-canvas'); const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight; let particles = [];
function fireConfetti() {
    for (let i=0; i<100; i++) particles.push({ x: canvas.width/2, y: canvas.height/2, r: Math.random()*6+2, dx: Math.random()*10-5, dy: Math.random()*-10-5, color: `hsl(${Math.random()*360}, 100%, 50%)`, tilt: Math.floor(Math.random()*10)-10, tiltAngle: 0, tiltAngleInc: (Math.random()*0.07)+0.05 });
}
function renderConfetti() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, index) => {
        p.tiltAngle += p.tiltAngleInc; p.y += (Math.cos(p.tiltAngle) + 1 + p.r/2)/2; p.x += Math.sin(p.tiltAngle)*2;
        if (p.y > canvas.height) particles.splice(index, 1);
        ctx.beginPath(); ctx.lineWidth = p.r; ctx.strokeStyle = p.color; ctx.moveTo(p.x+p.tilt+p.r, p.y); ctx.lineTo(p.x+p.tilt, p.y+p.tilt+p.r); ctx.stroke();
    });
    requestAnimationFrame(renderConfetti);
}
renderConfetti();

// DATA PREPARATION
function buildExp(qTrans, ops, correctOp, correctReason, wrongReason) {
    return `
        <span class="step-title">B∆∞·ªõc 1: D·ªãch c√¢u h·ªèi:</span> ${qTrans}<br><br>
        <span class="step-title">B∆∞·ªõc 2: Ph√¢n t√≠ch ƒë√°p √°n:</span><br>${ops.join('<br>')}<br><br>
        <span class="step-title">B∆∞·ªõc 3: T·∫°i sao ƒë√°p √°n ƒë√∫ng?</span><br><b>ƒê√°p √°n ${correctOp}:</b> ${correctReason}<br><br>
        <span class="step-title">B∆∞·ªõc 4: T·∫°i sao c√°c ƒë√°p √°n c√≤n l·∫°i sai?</span><br>${wrongReason}
    `;
}

const quizData = [
    // --- PHONETICS 1 ---
    {
        section: "PHONETICS - Exercise 1. Choose the word whose underlined part is pronounced differently.",
        q: "1. A. <u>st</u>all &nbsp; B. <u>st</u>orm &nbsp; C. ca<u>st</u>le &nbsp; D. wa<u>st</u>e", type: "mcq",
        options: [ { text: "A. stall", isCorrect: false }, { text: "B. storm", isCorrect: false }, { text: "C. castle", isCorrect: true }, { text: "D. waste", isCorrect: false } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. stall /st…îÀêl/", "B. storm /st…îÀêm/", "C. castle /Ààk…ëÀê.sl/", "D. waste /we…™st/"], "C", "Trong 'castle', √¢m 't' b·ªã c√¢m (silent t), ph√°t √¢m l√† /sl/.", "A, B, D ƒë·ªÅu gi·ªØ nguy√™n ch√πm ph·ª• √¢m /st/.")
    },
    {
        q: "2. A. poi<u>s</u>on &nbsp; B. di<u>s</u>aster &nbsp; C. di<u>s</u>ease &nbsp; D. <u>s</u>upermarket", type: "mcq",
        options: [ { text: "A. poison", isCorrect: false }, { text: "B. disaster", isCorrect: false }, { text: "C. disease", isCorrect: false }, { text: "D. supermarket", isCorrect: true } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. poison (z)", "B. disaster (z)", "C. disease (z)", "D. supermarket (s)"], "D", "Ch·ªØ 's' ƒë·∫ßu t·ª´ ph√°t √¢m l√† /s/.", "A, B, C ph√°t √¢m l√† /z/.")
    },
    {
        q: "3. A. tr<u>e</u>mble &nbsp; B. <u>e</u>cosystem &nbsp; C. pr<u>e</u>dict &nbsp; D. s<u>e</u>vere", type: "mcq",
        options: [ { text: "A. tremble", isCorrect: true }, { text: "B. ecosystem", isCorrect: false }, { text: "C. predict", isCorrect: false }, { text: "D. severe", isCorrect: false } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. tremble /e/", "B. ecosystem /iÀê/", "C. predict /…™/", "D. severe /…™/"], "A", "Ph√°t √¢m l√† √¢m /e/ ng·∫Øn.", "C√°c ƒë√°p √°n c√≤n l·∫°i ph√°t √¢m l√† √¢m /i/ ho·∫∑c /…™/.")
    },
    {
        q: "4. A. flood<u>ed</u> &nbsp; B. happen<u>ed</u> &nbsp; C. rescu<u>ed</u> &nbsp; D. chang<u>ed</u>", type: "mcq",
        options: [ { text: "A. flooded", isCorrect: true }, { text: "B. happened", isCorrect: false }, { text: "C. rescued", isCorrect: false }, { text: "D. changed", isCorrect: false } ],
        exp: buildExp("Quy t·∫Øc ph√°t √¢m ƒëu√¥i -ed.", ["A. flooded /…™d/", "B. happened /d/", "C. rescued /d/", "D. changed /d/"], "A", "T·∫≠n c√πng l√† √¢m /d/ n√™n +ed ƒë·ªçc l√† /…™d/.", "C√°c t·ª´ c√≤n l·∫°i c√≥ t·∫≠n c√πng h·ªØu thanh n√™n ƒë·ªçc l√† /d/.")
    },
    {
        q: "5. A. l<u>ou</u>d &nbsp; B. neighb<u>ou</u>r &nbsp; C. h<u>ou</u>r &nbsp; D. disc<u>ou</u>nt", type: "mcq",
        options: [ { text: "A. loud", isCorrect: false }, { text: "B. neighbour", isCorrect: true }, { text: "C. hour", isCorrect: false }, { text: "D. discount", isCorrect: false } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. loud /a ä/", "B. neighbour /…ô/", "C. hour /a ä/", "D. discount /a ä/"], "B", "√Çm ou trong neighbour ƒë·ªçc l√† √¢m ∆° ng·∫Øn /…ô/.", "C√≤n l·∫°i ƒë·ªçc l√† /a ä/.")
    },
    {
        q: "6. A. d<u>a</u>mage &nbsp; B. sh<u>a</u>ke &nbsp; C. torn<u>a</u>do &nbsp; D. s<u>a</u>fe", type: "mcq",
        options: [ { text: "A. damage", isCorrect: true }, { text: "B. shake", isCorrect: false }, { text: "C. tornado", isCorrect: false }, { text: "D. safe", isCorrect: false } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. damage /√¶/", "B. shake /e…™/", "C. tornado /e…™/", "D. safe /e…™/"], "A", "Ch·ªØ a ƒë·ªçc l√† /√¶/ (a b·∫πt).", "C√≤n l·∫°i ƒë·ªçc l√† /e…™/.")
    },
    {
        q: "7. A. vol<u>c</u>anic &nbsp; B. emergen<u>c</u>y &nbsp; C. res<u>c</u>ue &nbsp; D. vi<u>c</u>tim", type: "mcq",
        options: [ { text: "A. volcanic", isCorrect: false }, { text: "B. emergency", isCorrect: true }, { text: "C. rescue", isCorrect: false }, { text: "D. victim", isCorrect: false } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. volcanic /k/", "B. emergency /s/", "C. rescue /k/", "D. victim /k/"], "B", "Ch·ªØ c tr∆∞·ªõc y, i, e ƒë·ªçc l√† /s/.", "C√≤n l·∫°i ch·ªØ c ƒë·ªçc l√† /k/.")
    },
    {
        q: "8. A. b<u>a</u>rgain &nbsp; B. m<u>a</u>rket &nbsp; C. l<u>a</u>rge &nbsp; D. r<u>a</u>nge", type: "mcq",
        options: [ { text: "A. bargain", isCorrect: false }, { text: "B. market", isCorrect: false }, { text: "C. large", isCorrect: false }, { text: "D. range", isCorrect: true } ],
        exp: buildExp("Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c.", ["A. bargain /…ëÀê/", "B. market /…ëÀê/", "C. large /…ëÀê/", "D. range /e…™/"], "D", "Ch·ªØ a trong range ƒë·ªçc l√† /e…™/.", "C√≤n l·∫°i ƒë·ªçc l√† /…ëÀê/ d√†i.")
    },

    // --- PHONETICS 2 ---
    {
        section: "PHONETICS - Exercise 2. Choose the word which has a different stress pattern.",
        q: "1. A. rescue &nbsp; B. carbon &nbsp; C. erupt &nbsp; D. damage", type: "mcq",
        options: [ { text: "A. rescue", isCorrect: false }, { text: "B. carbon", isCorrect: false }, { text: "C. erupt", isCorrect: true }, { text: "D. damage", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. RE-scue (1)", "B. CAR-bon (1)", "C. e-RUPT (2)", "D. DA-mage (1)"], "C", "e-RUPT l√† ƒë·ªông t·ª´ 2 √¢m ti·∫øt n√™n nh·∫•n √¢m 2.", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },
    {
        q: "2. A. landslide &nbsp; B. earthquake &nbsp; C. typhoon &nbsp; D. warning", type: "mcq",
        options: [ { text: "A. landslide", isCorrect: false }, { text: "B. earthquake", isCorrect: false }, { text: "C. typhoon", isCorrect: true }, { text: "D. warning", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. LAND-slide (1)", "B. EARTH-quake (1)", "C. ty-PHOON (2)", "D. WARN-ing (1)"], "C", "ƒêu√¥i -oon nh·∫≠n tr·ªçng √¢m v√†o ch√≠nh n√≥ (√¢m 2).", "C√°c t·ª´ c√≤n l·∫°i l√† danh t·ª´ gh√©p/danh t·ª´ nh·∫•n √¢m 1.")
    },
    {
        q: "3. A. hurricane &nbsp; B. tornado &nbsp; C. volcano &nbsp; D. eruption", type: "mcq",
        options: [ { text: "A. hurricane", isCorrect: true }, { text: "B. tornado", isCorrect: false }, { text: "C. volcano", isCorrect: false }, { text: "D. eruption", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. HUR-ri-cane (1)", "B. tor-NA-do (2)", "C. vol-CA-no (2)", "D. e-RUP-tion (2)"], "A", "Nh·∫•n √¢m 1.", "C√°c t·ª´ c√≤n l·∫°i c√≥ ƒëu√¥i -tion nh·∫•n tr∆∞·ªõc n√≥ ho·∫∑c quy t·∫Øc nh·∫•n √¢m 2.")
    },
    {
        q: "4. A. tropical &nbsp; B. humorous &nbsp; C. terrible &nbsp; D. destruction", type: "mcq",
        options: [ { text: "A. tropical", isCorrect: false }, { text: "B. humorous", isCorrect: false }, { text: "C. terrible", isCorrect: false }, { text: "D. destruction", isCorrect: true } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. TRO-pi-cal (1)", "B. HU-mo-rous (1)", "C. TER-ri-ble (1)", "D. de-STRUC-tion (2)"], "D", "ƒêu√¥i -tion l√†m tr·ªçng √¢m r∆°i v√†o √¢m tr∆∞·ªõc n√≥ (√¢m 2).", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },
    {
        q: "6. A. pollute &nbsp; B. special &nbsp; C. property &nbsp; D. dangerous", type: "mcq",
        options: [ { text: "A. pollute", isCorrect: true }, { text: "B. special", isCorrect: false }, { text: "C. property", isCorrect: false }, { text: "D. dangerous", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. pol-LUTE (2)", "B. SPE-cial (1)", "C. PRO-per-ty (1)", "D. DAN-ge-rous (1)"], "A", "ƒê·ªông t·ª´ 2 √¢m ti·∫øt th∆∞·ªùng nh·∫•n √¢m 2.", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },
    {
        q: "7. A. voucher &nbsp; B. mountainous &nbsp; C. avoid &nbsp; D. various", type: "mcq",
        options: [ { text: "A. voucher", isCorrect: false }, { text: "B. mountainous", isCorrect: false }, { text: "C. avoid", isCorrect: true }, { text: "D. various", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. VOU-cher (1)", "B. MOUN-tain-ous (1)", "C. a-VOID (2)", "D. VA-ri-ous (1)"], "C", "ƒê·ªông t·ª´ 2 √¢m ti·∫øt nh·∫•n √¢m 2.", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },
    {
        q: "8. A. protect &nbsp; B. local &nbsp; C. global &nbsp; D. magical", type: "mcq",
        options: [ { text: "A. protect", isCorrect: true }, { text: "B. local", isCorrect: false }, { text: "C. global", isCorrect: false }, { text: "D. magical", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. pro-TECT (2)", "B. LO-cal (1)", "C. GLO-bal (1)", "D. MA-gi-cal (1)"], "A", "ƒê·ªông t·ª´ nh·∫•n √¢m 2.", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },
    {
        q: "9. A. natural &nbsp; B. dangerous &nbsp; C. historical &nbsp; D. poisonous", type: "mcq",
        options: [ { text: "A. natural", isCorrect: false }, { text: "B. dangerous", isCorrect: false }, { text: "C. historical", isCorrect: true }, { text: "D. poisonous", isCorrect: false } ],
        exp: buildExp("T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c.", ["A. NA-tu-ral (1)", "B. DAN-ge-rous (1)", "C. his-TO-ri-cal (2)", "D. POI-so-nous (1)"], "C", "ƒêu√¥i -ical l√†m tr·ªçng √¢m nh·∫•n v√†o √¢m ngay tr∆∞·ªõc n√≥ (√¢m 2).", "C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.")
    },

    // --- VOCABULARY AND GRAMMAR 1 ---
    {
        section: "VOCABULARY AND GRAMMAR - Exercise 1. Choose the best answer.",
        q: "1. The field trip to Con Dao aims to ________ the awareness of local students about environmental protection.", type: "mcq",
        options: [ { text: "A. contain", isCorrect: false }, { text: "B. rise", isCorrect: false }, { text: "C. cover", isCorrect: false }, { text: "D. raise", isCorrect: true } ],
        exp: buildExp("Chuy·∫øn ƒëi th·ª±c t·∫ø nh·∫±m m·ª•c ƒë√≠ch ______ nh·∫≠n th·ª©c c·ªßa h·ªçc sinh.", ["A. contain (v): ch·ª©a", "B. rise (v): t·ª± tƒÉng", "C. cover (v): bao ph·ªß", "D. raise (v): n√¢ng cao"], "D", "C·ª•m t·ª´ c·ªë ƒë·ªãnh: <b>raise the awareness</b> (n√¢ng cao nh·∫≠n th·ª©c).", "Sai collocation.")
    },
    {
        q: "2. In this shop, there is a wide ________ of decorative products that customers can buy before Christmas.", type: "mcq",
        options: [ { text: "A. range", isCorrect: true }, { text: "B. sale", isCorrect: false }, { text: "C. convenience", isCorrect: false }, { text: "D. access", isCorrect: false } ],
        exp: buildExp("C·ª≠a h√†ng c√≥ m·ªôt ______ r·ªông c√°c s·∫£n ph·∫©m trang tr√≠.", ["A. range (n): ph·∫°m vi, s·ª± ƒëa d·∫°ng", "B. sale (n): doanh thu", "C. convenience (n): s·ª± ti·ªán l·ª£i", "D. access (n): s·ª± ti·∫øp c·∫≠n"], "A", "C·ª•m t·ª´ c·ªë ƒë·ªãnh: <b>a wide range of + N(s/es)</b> (m·ªôt lo·∫°t/s·ª± ƒëa d·∫°ng c√°c...).", "Sai ng·ªØ c·∫£nh v√† collocation.")
    },
    {
        q: "3. The giant panda faces a high risk of ________ due to habitat loss.", type: "mcq",
        options: [ { text: "A. homeless", isCorrect: false }, { text: "B. increase", isCorrect: false }, { text: "C. awareness", isCorrect: false }, { text: "D. extinction", isCorrect: true } ],
        exp: buildExp("G·∫•u tr√∫c ƒë·ªëi m·∫∑t nguy c∆° ______ do m·∫•t m√¥i tr∆∞·ªùng s·ªëng.", ["A. homeless (adj): v√¥ gia c∆∞", "B. increase (n): gia tƒÉng", "C. awareness (n): nh·∫≠n th·ª©c", "D. extinction (n): tuy·ªát ch·ªßng"], "D", "Ng·ªØ c·∫£nh m·∫•t m√¥i tr∆∞·ªùng s·ªëng d·∫´n ƒë·∫øn r·ªßi ro tuy·ªát ch·ªßng (risk of extinction).", "Sau gi·ªõi t·ª´ 'of' c·∫ßn Danh t·ª´, lo·∫°i A. B, C sai nghƒ©a.")
    },
    {
        q: "4. ________ disasters can cause serious damage to human life.", type: "mcq",
        options: [ { text: "A. Nature", isCorrect: false }, { text: "B. Naturally", isCorrect: false }, { text: "C. Naturalism", isCorrect: false }, { text: "D. Natural", isCorrect: true } ],
        exp: buildExp("Th·∫£m h·ªça ______ c√≥ th·ªÉ g√¢y thi·ªát h·∫°i nghi√™m tr·ªçng.", ["A. Nature (n): Thi√™n nhi√™n", "B. Naturally (adv): M·ªôt c√°ch t·ª± nhi√™n", "C. Naturalism (n): Ch·ªß nghƒ©a t·ª± nhi√™n", "D. Natural (adj): Thu·ªôc v·ªÅ t·ª± nhi√™n"], "D", "ƒê·ª©ng tr∆∞·ªõc danh t·ª´ 'disasters' c·∫ßn m·ªôt T√≠nh t·ª´ ƒë·ªÉ b·ªï nghƒ©a. C·ª•m: natural disasters (th·∫£m h·ªça thi√™n nhi√™n).", "Sai t·ª´ lo·∫°i.")
    },
    {
        q: "5. We need to properly dispose of plastic ________ to prevent environmental harm.", type: "mcq",
        options: [ { text: "A. rubbish", isCorrect: true }, { text: "B. species", isCorrect: false }, { text: "C. activities", isCorrect: false }, { text: "D. plant", isCorrect: false } ],
        exp: buildExp("Ch√∫ng ta c·∫ßn x·ª≠ l√Ω ______ nh·ª±a ƒë√∫ng c√°ch.", ["A. rubbish (n): r√°c th·∫£i", "B. species (n): gi·ªëng lo√†i", "C. activities (n): ho·∫°t ƒë·ªông", "D. plant (n): th·ª±c v·∫≠t"], "A", "C·ª•m t·ª´ h·ª£p ng·ªØ c·∫£nh: plastic rubbish (r√°c th·∫£i nh·ª±a).", "Sai nghƒ©a ho√†n to√†n.")
    },
    {
        q: "6. We sometimes go round and look at things ________ display.", type: "mcq",
        options: [ { text: "A. on", isCorrect: true }, { text: "B. for", isCorrect: false }, { text: "C. at", isCorrect: false }, { text: "D. in", isCorrect: false } ],
        exp: buildExp("Ch√∫ng t√¥i th·ªânh tho·∫£ng ƒëi v√≤ng quanh v√† nh√¨n c√°c th·ª© ƒë∆∞·ª£c ______ b√†y b√°n.", ["A. on", "B. for", "C. at", "D. in"], "A", "C·ª•m gi·ªõi t·ª´ c·ªë ƒë·ªãnh: <b>on display</b> (ƒë∆∞·ª£c tr∆∞ng b√†y).", "Sai gi·ªõi t·ª´.")
    },
    {
        q: "7. We can ________ bargain at a supermarket.", type: "mcq",
        options: [ { text: "A. always", isCorrect: false }, { text: "B. never", isCorrect: true }, { text: "C. sometimes", isCorrect: false }, { text: "D. rarely", isCorrect: false } ],
        exp: buildExp("Ch√∫ng ta c√≥ th·ªÉ ______ m·∫∑c c·∫£ ·ªü si√™u th·ªã.", ["A. always: lu√¥n lu√¥n", "B. never: kh√¥ng bao gi·ªù", "C. sometimes: th·ªânh tho·∫£ng", "D. rarely: hi·∫øm khi"], "B", "ƒê·∫∑c ƒëi·ªÉm c·ªßa si√™u th·ªã (supermarket) l√† b√°n h√†ng gi√° ni√™m y·∫øt (fixed price), kh√¥ng th·ªÉ m·∫∑c c·∫£.", "Sai ki·∫øn th·ª©c th·ª±c t·∫ø.")
    },
    {
        q: "8. You should shop online for electrical goods because they ________", type: "mcq",
        options: [ { text: "A. often are cheaper", isCorrect: false }, { text: "B. are cheaper often", isCorrect: false }, { text: "C. often cheaper", isCorrect: false }, { text: "D. are often cheaper", isCorrect: true } ],
        exp: buildExp("B·∫°n n√™n mua ƒë·ªì ƒëi·ªán t·ª≠ online v√¨ ch√∫ng ______.", ["A, B, C: Sai v·ªã tr√≠ tr·∫°ng t·ª´ ho·∫∑c thi·∫øu tobe.", "D. are often cheaper"], "D", "Quy t·∫Øc v·ªã tr√≠ tr·∫°ng t·ª´ ch·ªâ t·∫ßn su·∫•t (often): <b>ƒê·ª©ng sau tobe (are) v√† ƒë·ª©ng tr∆∞·ªõc t√≠nh t·ª´/ƒë·ªông t·ª´ th∆∞·ªùng</b>.", "Sai ng·ªØ ph√°p v·ªã tr√≠ tr·∫°ng t·ª´.")
    },
    {
        q: "9. Bob will come soon. When Bob ________ we will see him.", type: "mcq",
        options: [ { text: "A. come", isCorrect: false }, { text: "B. will come", isCorrect: false }, { text: "C. are coming", isCorrect: false }, { text: "D. comes", isCorrect: true } ],
        exp: buildExp("Bob s·∫Ω ƒë·∫øn s·ªõm. Khi Bob ______, ch√∫ng ta s·∫Ω g·∫∑p anh ·∫•y.", ["A. come (sai ng√¥i)", "B. will come (sai m·ªánh ƒë·ªÅ th·ªùi gian)", "C. are coming (ti·∫øp di·ªÖn)", "D. comes (hi·ªán t·∫°i ƒë∆°n)"], "D", "M·ªánh ƒë·ªÅ th·ªùi gian b·∫Øt ƒë·∫ßu b·∫±ng When kh√¥ng d√πng th√¨ T∆∞∆°ng lai. C·∫•u tr√∫c: <b>When + S + V(HTƒê), S + V(TLƒê)</b>. 'Bob' s·ªë √≠t n√™n chia 'comes'.", "Sai th√¨ ho·∫∑c sai chia ƒë·ªông t·ª´.")
    },
    {
        q: "10. As soon as the taxi ________ we will be able to leave for the airport.", type: "mcq",
        options: [ { text: "A. arrives", isCorrect: true }, { text: "B. arrive", isCorrect: false }, { text: "C. will arrive", isCorrect: false }, { text: "D. arrived", isCorrect: false } ],
        exp: buildExp("Ngay khi taxi ______, ch√∫ng ta s·∫Ω c√≥ th·ªÉ r·ªùi ƒëi ra s√¢n bay.", ["A. arrives (HTƒê)", "B. arrive (sai ng√¥i)", "C. will arrive (sai m·ªánh ƒë·ªÅ th·ªùi gian)", "D. arrived (Qu√° kh·ª©)"], "A", "T∆∞∆°ng t·ª± c√¢u tr√™n. As soon as + S + V(HTƒê) di·ªÖn t·∫£ m·ªôt h√†nh ƒë·ªông s·∫Ω x·∫£y ra trong t∆∞∆°ng lai. 'Taxi' s·ªë √≠t n√™n chia 'arrives'.", "Sai th√¨ ho·∫∑c sai d·∫°ng ƒë·ªông t·ª´.")
    },
    {
        q: "11. ________ I get to school, I will show you my writing about the habitat of polar bear.", type: "mcq",
        options: [ { text: "A. As soon as", isCorrect: true }, { text: "B. While", isCorrect: false }, { text: "C. Until", isCorrect: false }, { text: "D. Till", isCorrect: false } ],
        exp: buildExp("______ t·ªõ ƒë·∫øn tr∆∞·ªùng, t·ªõ s·∫Ω cho c·∫≠u xem b√†i vi·∫øt c·ªßa t·ªõ.", ["A. As soon as: Ngay khi", "B. While: Trong khi", "C. Until: Cho ƒë·∫øn khi", "D. Till: Cho ƒë·∫øn khi"], "A", "H·ª£p logic nghƒ©a nh·∫•t: Ngay khi ƒë·∫øn tr∆∞·ªùng th√¨ s·∫Ω ƒë∆∞a cho xem li·ªÅn.", "Sai logic ng·ªØ nghƒ©a.")
    },
    {
        q: "12. She often ________ home-grown vegetables online when they are excessive.", type: "mcq",
        options: [ { text: "A. sell", isCorrect: false }, { text: "B. sells", isCorrect: true }, { text: "C. selling", isCorrect: false }, { text: "D. sold", isCorrect: false } ],
        exp: buildExp("C√¥ ·∫•y th∆∞·ªùng ______ rau c·ªß nh√† tr·ªìng tr√™n m·∫°ng khi b·ªã th·ª´a.", ["A. sell", "B. sells", "C. selling", "D. sold"], "B", "D·∫•u hi·ªáu 'often' -> Th√¨ Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'She' s·ªë √≠t n√™n ƒë·ªông t·ª´ th√™m 's'.", "Sai th√¨ ho·∫∑c sai d·∫°ng ƒë·ªông t·ª´.")
    },
    {
        q: "13. I am going to wait right here until Jessica ________", type: "mcq",
        options: [ { text: "A. comes", isCorrect: true }, { text: "B. will have come", isCorrect: false }, { text: "C. is coming", isCorrect: false }, { text: "D. came", isCorrect: false } ],
        exp: buildExp("T√¥i s·∫Ω ƒë·ª£i ngay ·ªü ƒë√¢y cho ƒë·∫øn khi Jessica ______.", ["A. comes (HTƒê)", "B. will have come", "C. is coming", "D. came"], "A", "M·ªánh ƒë·ªÅ tr·∫°ng ng·ªØ ch·ªâ th·ªùi gian v·ªõi 'until' di·ªÖn t·∫£ t∆∞∆°ng lai s·∫Ω d√πng th√¨ Hi·ªán t·∫°i ƒë∆°n.", "Kh√¥ng d√πng th√¨ T∆∞∆°ng lai trong m·ªánh ƒë·ªÅ Until.")
    },
    {
        q: "14. - ________ you ________ in Paris when I called you last week? - Yes, I was.", type: "mcq",
        options: [ { text: "A. Are/travelling", isCorrect: false }, { text: "B. Did/travel", isCorrect: false }, { text: "C. Were/travel", isCorrect: false }, { text: "D. Were/travelling", isCorrect: true } ],
        exp: buildExp("C√≥ ph·∫£i b·∫°n ƒëang ƒëi du l·ªãch ·ªü Paris khi t√¥i g·ªçi cho b·∫°n tu·∫ßn tr∆∞·ªõc kh√¥ng?", ["A. Are (sai th√¨)", "B. Did (kh√¥ng kh·ªõp c√¢u tr·∫£ l·ªùi Yes, I was)", "C. Were/travel (sai ng·ªØ ph√°p c·∫•u tr√∫c ti·∫øp di·ªÖn)", "D. Were/travelling"], "D", "M·ªôt h√†nh ƒë·ªông ƒëang x·∫£y ra trong qu√° kh·ª© (Qu√° kh·ª© ti·∫øp di·ªÖn) th√¨ c√≥ h√†nh ƒë·ªông kh√°c xen v√†o (Qu√° kh·ª© ƒë∆°n).", "Sai c·∫•u tr√∫c QKTD (Was/Were + V-ing).")
    },
    {
        q: "15. You'd better go to bed early tonight. The plane ________ at 6 o'clock tomorrow morning so we'll have to be up by 4.30!", type: "mcq",
        options: [ { text: "A. will leave", isCorrect: false }, { text: "B. leaves", isCorrect: true }, { text: "C. leave", isCorrect: false }, { text: "D. is leaving", isCorrect: false } ],
        exp: buildExp("M√°y bay ______ l√∫c 6 gi·ªù s√°ng mai n√™n ch√∫ng ta ph·∫£i d·∫≠y l√∫c 4 r∆∞·ª°i!", ["A. will leave", "B. leaves (HTƒê)", "C. leave", "D. is leaving"], "B", "N√≥i v·ªÅ <b>l·ªãch tr√¨nh c·ªë ƒë·ªãnh</b> (t√†u, xe, m√°y bay) mang nghƒ©a t∆∞∆°ng lai, ta b·∫Øt bu·ªôc ph·∫£i d√πng th√¨ <b>Hi·ªán t·∫°i ƒë∆°n</b>.", "C√°c th√¨ T∆∞∆°ng lai ho·∫∑c Ti·∫øp di·ªÖn kh√¥ng d√πng cho l·ªãch tr√¨nh chung.")
    },
    {
        q: "16. Let's go to ________ shops to buy something as presents for our relatives after the trip.", type: "mcq",
        options: [ { text: "A. specialize", isCorrect: false }, { text: "B. speciality", isCorrect: true }, { text: "C. special", isCorrect: false }, { text: "D. specially", isCorrect: false } ],
        exp: buildExp("H√£y ƒë·∫øn c√°c c·ª≠a h√†ng ______ ƒë·ªÉ mua qu√† cho h·ªç h√†ng.", ["A. specialize (v)", "B. speciality (n): ƒë·∫∑c s·∫£n", "C. special (adj)", "D. specially (adv)"], "B", "C·ª•m danh t·ª´ gh√©p: <b>speciality shops</b> (c·ª≠a h√†ng b√°n ƒë·∫∑c s·∫£n).", "Sai t·ª´ lo·∫°i v√† c·ª•m c·ªë ƒë·ªãnh.")
    },
    {
        q: "17. There was a ________ , so we couldn't go to Ha Giang.", type: "mcq",
        options: [ { text: "A. drought", isCorrect: false }, { text: "B. landslide", isCorrect: true }, { text: "C. tsunami", isCorrect: false }, { text: "D. volcano", isCorrect: false } ],
        exp: buildExp("C√≥ m·ªôt tr·∫≠n ______, n√™n ch√∫ng t√¥i kh√¥ng th·ªÉ ƒëi H√† Giang.", ["A. drought (n): h·∫°n h√°n", "B. landslide (n): s·∫°t l·ªü ƒë·∫•t", "C. tsunami (n): s√≥ng th·∫ßn", "D. volcano (n): n√∫i l·ª≠a"], "B", "H√† Giang l√† v√πng n√∫i, hi·ªán t∆∞·ª£ng thi√™n tai c·∫£n tr·ªü giao th√¥ng ph·ªï bi·∫øn l√† s·∫°t l·ªü ƒë·∫•t (landslide).", "S√≥ng th·∫ßn (C) kh√¥ng x·∫£y ra tr√™n n√∫i. H·∫°n h√°n (A) kh√¥ng c·∫£n tr·ªü ƒëi l·∫°i.")
    },
    {
        q: "18. What ________ you ________ at 8 p.m. yesterday?", type: "mcq",
        options: [ { text: "A. was-doing", isCorrect: false }, { text: "B. were-doing", isCorrect: true }, { text: "C. did-do", isCorrect: false }, { text: "D. do-do", isCorrect: false } ],
        exp: buildExp("B·∫°n ƒëang l√†m g√¨ l√∫c 8 gi·ªù t·ªëi qua?", ["A. was doing", "B. were doing", "C. did do", "D. do do"], "B", "Gi·ªù ch√≠nh x√°c trong qu√° kh·ª© -> Qu√° kh·ª© ti·∫øp di·ªÖn. 'you' ƒëi v·ªõi 'were'.", "Sai th√¨ ho·∫∑c sai tobe.")
    },
    {
        q: "19. The pilot suddenly saw a volcanic eruption while he ________ across Stromboli, Italy.", type: "mcq",
        options: [ { text: "A. was flying", isCorrect: true }, { text: "B. is flying", isCorrect: false }, { text: "C. flew", isCorrect: false }, { text: "D. flies", isCorrect: false } ],
        exp: buildExp("Phi c√¥ng b·∫•t ng·ªù th·∫•y n√∫i l·ª≠a phun trong khi anh ·∫•y ______ ngang qua √ù.", ["A. was flying (QKTD)", "B. is flying", "C. flew", "D. flies"], "A", "C·∫•u tr√∫c While: H√†nh ƒë·ªông ƒëang x·∫£y ra (QKTD) th√¨ h√†nh ƒë·ªông kh√°c xen v√†o (QKƒê - saw).", "Sai th√¨.")
    },
    {
        q: "20. Anita: 'Kate, what does extinction mean?' - Kate: '________'", type: "mcq",
        options: [ { text: "A. It means 'completely disappear'.", isCorrect: true }, { text: "B. I don't think extinction will happen.", isCorrect: false }, { text: "C. I don't like extinction.", isCorrect: false }, { text: "D. Can you name some extinct species?", isCorrect: false } ],
        exp: buildExp("Tuy·ªát ch·ªßng nghƒ©a l√† g√¨? - N√≥ c√≥ nghƒ©a l√†...", ["A. Ho√†n to√†n bi·∫øn m·∫•t.", "B. T·ªõ kh√¥ng nghƒ© n√≥ s·∫Ω x·∫£y ra.", "C. T·ªõ kh√¥ng th√≠ch n√≥.", "D. B·∫°n c√≥ th·ªÉ k·ªÉ t√™n lo√†i kh√¥ng?"], "A", "Tr·∫£ l·ªùi tr·ª±c ti·∫øp cho c√¢u h·ªèi ƒë·ªãnh nghƒ©a (What does it mean).", "Sai ng·ªØ c·∫£nh giao ti·∫øp.")
    },
    {
        q: "21. Nga: 'A flood destroyed our home town last week.' - Linh: '________'", type: "mcq",
        options: [ { text: "A. That's a relief.", isCorrect: false }, { text: "B. How interesting!", isCorrect: false }, { text: "C. Glad to hear.", isCorrect: false }, { text: "D. I'm sorry to hear that", isCorrect: true } ],
        exp: buildExp("L≈© l·ª•t ƒë√£ ph√° h·ªßy qu√™ t√¥i tu·∫ßn tr∆∞·ªõc. - ______", ["A. Th·∫≠t nh·∫π nh√µm.", "B. Th·∫≠t th√∫ v·ªã!", "C. Vui khi nghe v·∫≠y.", "D. R·∫•t ti·∫øc khi nghe ƒëi·ªÅu ƒë√≥."], "D", "Th·ªÉ hi·ªán s·ª± chia bu·ªìn, ƒë·ªìng c·∫£m khi nghe tin x·∫•u.", "A, B, C mang √Ω nghƒ©a vui m·ª´ng, v√¥ duy√™n v·ªõi tin bu·ªìn.")
    },

    // --- GAP FILL ---
    {
        section: "VOCABULARY AND GRAMMAR - Exercise 2. Complete the sentences with the correct form of the verbs.",
        q: "1. Look! The concert (start) <span class='gap-fill' data-answer='starts' data-wrong='start,is starting,will start'>[ ________ ]</span> at 7 P.M. and (end) <span class='gap-fill' data-answer='ends' data-wrong='end,will end,is ending'>[ ________ ]</span> at 9 P.M.", type: "gap",
        exp: buildExp("Bu·ªïi h√≤a nh·∫°c b·∫Øt ƒë·∫ßu l√∫c 7h v√† k·∫øt th√∫c l√∫c 9h.", ["S·ª≠ d·ª•ng hi·ªán t·∫°i ƒë∆°n cho l·ªãch tr√¨nh."], "starts / ends", "H√†nh ƒë·ªông theo l·ªãch tr√¨nh c·ªë ƒë·ªãnh d√πng th√¨ Hi·ªán t·∫°i ƒë∆°n d√π mang nghƒ©a t∆∞∆°ng lai.", "Kh√¥ng d√πng t∆∞∆°ng lai ƒë∆°n hay ti·∫øp di·ªÖn.")
    },
    {
        q: "2. The government (send) <span class='gap-fill' data-answer='will send' data-wrong='sends,sent,is sending'>[ ________ ]</span> medical supplies, food and rescue equipment to Nghe An soon.", type: "gap",
        exp: buildExp("Ch√≠nh ph·ªß s·∫Ω g·ª≠i v·∫≠t t∆∞ y t·∫ø ƒë·∫øn Ngh·ªá An s·ªõm th√¥i.", ["C√≥ d·∫•u hi·ªáu 'soon' (s·ªõm th√¥i)"], "will send", "Ch·ªâ m·ªôt h√†nh ƒë·ªông s·∫Ω x·∫£y ra trong t∆∞∆°ng lai g·∫ßn.", "Kh√¥ng d√πng qu√° kh·ª© hay hi·ªán t·∫°i ƒë∆°n.")
    },
    {
        q: "3. <span class='gap-fill' data-answer='Were' data-wrong='Did,Are,Was'>[ ________ ]</span> the flood victims still (wait) <span class='gap-fill' data-answer='waiting' data-wrong='wait,waited'>[ ________ ]</span> when the rescuers (arrive) <span class='gap-fill' data-answer='arrived' data-wrong='arrive,were arriving'>[ ________ ]</span>?", type: "gap",
        exp: buildExp("C√≥ ph·∫£i c√°c n·∫°n nh√¢n v·∫´n ƒëang ch·ªù khi ƒë·ªôi c·ª©u h·ªô ƒë·∫øn kh√¥ng?", ["H√†nh ƒë·ªông ƒëang x·∫£y ra v√† h√†nh ƒë·ªông xen v√†o."], "Were / waiting / arrived", "C·∫•u tr√∫c: H√†nh ƒë·ªông ƒëang x·∫£y ra (QKTD - Were waiting) th√¨ h√†nh ƒë·ªông kh√°c xen v√†o (QKƒê - arrived).", "Sai c·∫•u tr√∫c ph·ªëi h·ª£p th√¨.")
    },
    {
        q: "4. Thu (talk) <span class='gap-fill' data-answer='was talking' data-wrong='talked,is talking,talks'>[ ________ ]</span> to her friend, Hoa, on the phone at 8 o'clock last night.", type: "gap",
        exp: buildExp("Thu ƒëang n√≥i chuy·ªán v·ªõi b·∫°n v√†o l√∫c 8h t·ªëi qua.", ["C√≥ gi·ªù ch√≠nh x√°c trong qu√° kh·ª©."], "was talking", "H√†nh ƒë·ªông ƒëang x·∫£y ra t·∫°i th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong qu√° kh·ª© -> Qu√° kh·ª© ti·∫øp di·ªÖn.", "Sai th√¨.")
    },
    {
        q: "5. Lan (practise) <span class='gap-fill' data-answer='was practising' data-wrong='practised,is practising'>[ ________ ]</span> the piano while her brothers (read) <span class='gap-fill' data-answer='were reading' data-wrong='read,are reading'>[ ________ ]</span> comics at 7 o'clock last night.", type: "gap",
        exp: buildExp("Lan ƒëang t·∫≠p ƒë√†n trong khi c√°c anh trai ƒëang ƒë·ªçc truy·ªán v√†o l√∫c 7h t·ªëi qua.", ["2 h√†nh ƒë·ªông x·∫£y ra song song trong qu√° kh·ª©."], "was practising / were reading", "C·∫•u tr√∫c 'while' di·ªÖn t·∫£ 2 h√†nh ƒë·ªông c√πng l√∫c ·ªü qu√° kh·ª© ti·∫øp di·ªÖn.", "Sai c·∫•u tr√∫c song song.")
    },
    {
        q: "6. Linh (study) <span class='gap-fill' data-answer='is studying' data-wrong='studies,studied'>[ ________ ]</span> hard these days. She (have) <span class='gap-fill' data-answer='is having' data-wrong='has,had'>[ ________ ]</span> her exam next Saturday.", type: "gap",
        exp: buildExp("D·∫°o n√†y Linh ƒëang h·ªçc r·∫•t chƒÉm. C√¥ ·∫•y s·∫Ω thi v√†o th·ª© B·∫£y t·ªõi.", ["these days -> Hi·ªán t·∫°i ti·∫øp di·ªÖn; k·∫ø ho·∫°ch t∆∞∆°ng lai c·ªë ƒë·ªãnh -> Hi·ªán t·∫°i ti·∫øp di·ªÖn"], "is studying / is having", "'these days' ch·ªâ s·ª± vi·ªác t·∫°m th·ªùi (hi·ªán t·∫°i ti·∫øp di·ªÖn). K·∫ø ho·∫°ch 100% x·∫£y ra c≈©ng d√πng hi·ªán t·∫°i ti·∫øp di·ªÖn mang nghƒ©a t∆∞∆°ng lai.", "Sai c√°ch d√πng th√¨ HTTD.")
    }
];

// RENDER FUNCTION
let totalQuestions = quizData.length; let correctCount = 0; let answeredCards = new Set();
function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    let html = ''; let currentSection = '';

    quizData.forEach((item, qIndex) => {
        if (item.section && item.section !== currentSection) { html += `<div class="section-title">${item.section}</div>`; currentSection = item.section; }
        html += `<div class="card" id="card-${qIndex}">`;
        
        if (item.type === 'mcq') {
            html += `<div class="question-text">${item.q}</div><div class="options-grid">`;
            let opts = [...item.options]; shuffleArray(opts);
            opts.forEach(opt => { html += `<button class="option-btn" onclick="checkMCQ(${qIndex}, this, ${opt.isCorrect})">${opt.text}</button>`; });
            html += `</div>`;
        } else if (item.type === 'gap') { html += `<div class="question-text">${item.q}</div>`; }

        html += `<div class="explanation" id="exp-${qIndex}"><h4>üí° Gi·∫£i th√≠ch chi ti·∫øt:</h4>${item.exp}</div></div>`;
    });
    container.innerHTML = html; setupGapFills();
}

function checkMCQ(qIndex, btnElement, isCorrect) {
    const card = document.getElementById(`card-${qIndex}`); const buttons = card.querySelectorAll('.option-btn'); const expBox = document.getElementById(`exp-${qIndex}`);
    if (btnElement.classList.contains('correct') || btnElement.classList.contains('wrong') || Array.from(buttons).some(b => b.disabled)) return;
    buttons.forEach(btn => btn.disabled = true);
    answeredCards.add(qIndex);

    if (isCorrect) { btnElement.classList.add('correct'); playCorrect(); correctCount++; } 
    else {
        btnElement.classList.add('wrong'); playWrong();
        buttons.forEach(btn => { if(btn.getAttribute('onclick').includes('true')) btn.style.border = "3px solid var(--correct)"; });
    }
    expBox.classList.add('show');
}

// GAP FILL LOGIC
let activeGap = null;
function setupGapFills() {
    const gaps = document.querySelectorAll('.gap-fill');
    const popup = document.createElement('div'); popup.className = 'gap-popup'; document.body.appendChild(popup);

    gaps.forEach(gap => {
        gap.addEventListener('click', (e) => {
            if (gap.classList.contains('answered-correct') || gap.classList.contains('answered-wrong')) return;
            activeGap = gap; const ans = gap.getAttribute('data-answer'); const wrongs = gap.getAttribute('data-wrong').split(',');
            let opts = [{text: ans, correct: true}, ...wrongs.map(w => ({text: w, correct: false}))]; shuffleArray(opts);
            popup.innerHTML = '';
            opts.forEach(opt => { const btn = document.createElement('button'); btn.innerText = opt.text; btn.onclick = () => selectGap(opt); popup.appendChild(btn); });
            const rect = gap.getBoundingClientRect(); popup.style.top = (window.scrollY + rect.bottom + 10) + 'px'; popup.style.left = rect.left + 'px'; popup.style.display = 'flex';
        });
    });
    document.addEventListener('click', (e) => { if (!e.target.classList.contains('gap-fill') && !e.target.closest('.gap-popup')) popup.style.display = 'none'; });
}

function selectGap(opt) {
    if (!activeGap) return; const popup = document.querySelector('.gap-popup'); popup.style.display = 'none';
    activeGap.innerText = opt.text; const card = activeGap.closest('.card'); const qIndex = card.id.split('-')[1];

    if (opt.correct) { activeGap.classList.add('answered-correct'); playCorrect(); correctCount++; } 
    else { activeGap.classList.add('answered-wrong'); activeGap.style.animation = 'shake 0.4s'; playWrong(); }
    
    const gapsInCard = card.querySelectorAll('.gap-fill');
    const allAnswered = Array.from(gapsInCard).every(g => g.classList.contains('answered-correct') || g.classList.contains('answered-wrong'));
    if (allAnswered) { document.getElementById(`exp-${qIndex}`).classList.add('show'); answeredCards.add(qIndex); }
}

function submitQuiz() {
    const modal = document.getElementById('result-modal'); const scoreText = document.getElementById('score-text'); const praiseText = document.getElementById('praise-text');
    let totalScore = quizData.reduce((acc, curr) => curr.type === 'gap' ? acc + (curr.q.match(/gap-fill/g) || []).length : acc + 1, 0);
    scoreText.innerText = `B·∫°n ƒë√£ l√†m ƒë√∫ng ${correctCount}/${totalScore} √Ω.`;
    
    let ratio = correctCount / totalScore; let praise = "";
    if (ratio === 1) praise = "Th·∫≠t xu·∫•t s·∫Øc! ƒêi·ªÉm 10 kh√¥ng c√≥ nh∆∞ng! üèÜ";
    else if (ratio >= 0.7) praise = "Gi·ªèi l·∫Øm! C·ªë g·∫Øng ch√∫t n·ªØa l√† ho√†n h·∫£o! üåü";
    else if (ratio >= 0.5) praise = "L√†m t·ªët l·∫Øm! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üëç";
    else praise = "ƒê·ª´ng n·∫£n ch√≠! H·ªçc k·ªπ l·ªói sai s·∫Ω gi√∫p em ti·∫øn b·ªô! üí™";

    praiseText.innerText = praise; modal.style.display = 'flex';
    playCorrect(); fireConfetti(); fireConfetti(); 
}
window.onload = renderQuiz;
</script>
</body>
</html>