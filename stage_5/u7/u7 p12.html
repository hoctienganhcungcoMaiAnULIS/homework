<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p C√¢u M·ªánh L·ªánh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8854C0; /* T√≠m H·ªìng */
            --secondary: #00C9A7; /* Xanh Ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f2f5;
            --text-color: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e3f2fd;
            background-image: radial-gradient(#8854C0 0.5px, transparent 0.5px), radial-gradient(#8854C0 0.5px, #e3f2fd 0.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 2rem;
            text-transform: uppercase;
        }

        .sub-header {
            font-size: 0.9rem;
            color: #747d8c;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Theory Box */
        .theory-box {
            background: linear-gradient(135deg, #fff, #f3e5f5);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 8px solid var(--secondary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .theory-box h3 {
            color: var(--secondary);
            margin-top: 0;
        }

        /* Question Card */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            position: relative;
            transition: transform 0.3s;
            border: 2px solid transparent;
        }

        .question-number {
            background: var(--primary);
            color: white;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 rgba(108, 64, 155, 0.5);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2f3542;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe4ea;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            color: #57606f;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 6px 0 #dfe4ea;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #dfe4ea;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00b85b;
            box-shadow: 0 6px 0 #00b85b;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #e03847;
            box-shadow: 0 6px 0 #e03847;
            animation: shake 0.5s;
        }

        /* Explanation Box */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 20px;
            background: #f1f2f6;
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed var(--primary);
        }

        .explanation-title {
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expl-step {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .expl-label {
            font-weight: bold;
            color: var(--secondary);
            display: block;
            margin-bottom: 4px;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        /* Footer / Submit */
        .footer-controls {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #009e82;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #009e82;
        }

        /* Popup Score */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary);
        }

        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 1.2rem;
            color: #57606f;
            margin-bottom: 30px;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="sub-header">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
            <h1>B√ÄI T·∫¨P C√ÇU M·ªÜNH L·ªÜNH</h1>
        </header>

        <div class="theory-box">
            <h3>üìñ √în t·∫≠p ki·∫øn th·ª©c: C√¢u M·ªánh L·ªánh</h3>
            <p><strong>1. Kh·∫≥ng ƒë·ªãnh (Y√™u c·∫ßu l√†m g√¨):</strong><br>
            C√¥ng th·ª©c: <code>V (nguy√™n th·ªÉ) + ...!</code><br>
            V√≠ d·ª•: <em>Stand up! (ƒê·ª©ng l√™n!)</em></p>
            <p><strong>2. Ph·ªß ƒë·ªãnh (C·∫•m l√†m g√¨):</strong><br>
            C√¥ng th·ª©c: <code>Don't + V (nguy√™n th·ªÉ) + ...!</code><br>
            V√≠ d·ª•: <em>Don't talk! (ƒê·ª´ng n√≥i chuy·ªán!)</em></p>
            <p><em>*Th√™m "Please" ƒë·ªÉ l·ªãch s·ª± h∆°n nh√©!</em></p>
        </div>

        <div id="quiz-container">
            </div>

        <div class="footer-controls">
            <button class="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI üèÜ</button>
        </div>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ C·ª¶A CON</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p class="feedback-text" id="feedback-msg">C·ªë g·∫Øng l√™n nh√©!</p>
            <button class="submit-btn" onclick="location.reload()">L√†m l·∫°i b√†i üîÑ</button>
        </div>
    </div>

    <script>
        // --- DATA B√ÄI T·∫¨P (30 C√¢u - ƒê·∫ßy ƒë·ªß ki·∫øn th·ª©c) ---
        const rawQuestions = [
            {
                question: "______ your book to page 10, please.",
                options: ["Opens", "Opening", "Open", "To open"],
                answer: 2, // Index of correct answer (0-3)
                explanation: {
                    vocab: "A. Opens (chia s/es); B. Opening (V-ing); C. Open (V nguy√™n - M·ªü); D. To open (To V).",
                    trans: "Vui l√≤ng m·ªü s√°ch c·ªßa c√°c em ra trang s·ªë 10.",
                    correct: "ƒê√¢y l√† c√¢u m·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh. C√¥ng th·ª©c: V (nguy√™n th·ªÉ) + ...! N√™n ta ch·ªçn 'Open'.",
                    wrong: "C√°c ƒë√°p √°n A, B, D sai v√¨ c√¢u m·ªánh l·ªánh b·∫Øt ƒë·∫ßu b·∫±ng ƒë·ªông t·ª´ nguy√™n th·ªÉ, kh√¥ng chia, kh√¥ng th√™m ing, kh√¥ng c√≥ to."
                }
            },
            {
                question: "______ talk during the exam!",
                options: ["Not", "Don't", "Doesn't", "No"],
                answer: 1,
                explanation: {
                    vocab: "A. Not (kh√¥ng); B. Don't (ƒê·ª´ng/Kh√¥ng ƒë∆∞·ª£c - vi·∫øt t·∫Øt c·ªßa Do not); C. Doesn't (tr·ª£ ƒë·ªông t·ª´ chia ng√¥i 3); D. No (kh√¥ng).",
                    trans: "Kh√¥ng ƒë∆∞·ª£c n√≥i chuy·ªán trong gi·ªù ki·ªÉm tra!",
                    correct: "C√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh (C·∫•m ƒëo√°n) lu√¥n b·∫Øt ƒë·∫ßu b·∫±ng 'Don't' + V nguy√™n th·ªÉ.",
                    wrong: "A, D kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh. C sai v√¨ c√¢u m·ªánh l·ªánh lu√¥n d√πng 'Don't', kh√¥ng d√πng 'Doesn't'."
                }
            },
            {
                question: "Please ______ quiet. The baby is sleeping.",
                options: ["be", "is", "are", "am"],
                answer: 0,
                explanation: {
                    vocab: "A. be (nguy√™n th·ªÉ); B. is; C. are; D. am (ƒë·ªông t·ª´ to be chia theo ng√¥i).",
                    trans: "L√†m ∆°n h√£y gi·ªØ im l·∫∑ng. Em b√© ƒëang ng·ªß.",
                    correct: "Trong c√¢u m·ªánh l·ªánh, ƒë·ªông t·ª´ ph·∫£i ·ªü d·∫°ng nguy√™n th·ªÉ. Nguy√™n th·ªÉ c·ªßa 'is/am/are' ch√≠nh l√† 'be'.",
                    wrong: "B, C, D l√† d·∫°ng ƒë√£ chia ng√¥i, kh√¥ng d√πng trong c√¢u m·ªánh l·ªánh."
                }
            },
            {
                question: "______ up! It's time to go to school.",
                options: ["Getting", "Gets", "Get", "To get"],
                answer: 2,
                explanation: {
                    vocab: "A. Getting (ƒëang l·∫•y/d·∫≠y); B. Gets (chia s); C. Get (nguy√™n th·ªÉ); D. To get.",
                    trans: "Th·ª©c d·∫≠y n√†o! ƒê√£ ƒë·∫øn gi·ªù ƒëi h·ªçc r·ªìi.",
                    correct: "C·ª•m t·ª´ 'Get up' (th·ª©c d·∫≠y). C√¢u m·ªánh l·ªánh b·∫Øt ƒë·∫ßu b·∫±ng V nguy√™n th·ªÉ 'Get'.",
                    wrong: "Sai ng·ªØ ph√°p c√¢u m·ªánh l·ªánh (kh√¥ng d√πng V-ing, V-s hay To V)."
                }
            },
            {
                question: "______ on the grass!",
                options: ["Not step", "Don't step", "No step", "Step not"],
                answer: 1,
                explanation: {
                    vocab: "Step (d·∫´m/b∆∞·ªõc l√™n).",
                    trans: "ƒê·ª´ng d·∫´m l√™n c·ªè!",
                    correct: "C·∫•u tr√∫c c·∫•m ƒëo√°n: Don't + V nguy√™n th·ªÉ. -> Don't step.",
                    wrong: "A, C, D sai c·∫•u tr√∫c ng·ªØ ph√°p ho√†n to√†n."
                }
            },
            {
                question: "______ me your pen, please.",
                options: ["Lends", "Lending", "Lend", "To lend"],
                answer: 2,
                explanation: {
                    vocab: "Lend (v): cho m∆∞·ª£n.",
                    trans: "L√†m ∆°n cho t·ªõ m∆∞·ª£n c√°i b√∫t c·ªßa c·∫≠u.",
                    correct: "C√¢u c·∫ßu khi·∫øn/m·ªánh l·ªánh d√πng V nguy√™n th·ªÉ ƒë·ª©ng ƒë·∫ßu -> Lend.",
                    wrong: "A (chia s), B (V-ing), D (To V) ƒë·ªÅu sai quy t·∫Øc c√¢u m·ªánh l·ªánh."
                }
            },
            {
                question: "______ close the window. It's hot inside.",
                options: ["Don't", "Not", "No", "Doesn't"],
                answer: 0,
                explanation: {
                    vocab: "Close (ƒë√≥ng). Hot (n√≥ng).",
                    trans: "ƒê·ª´ng ƒë√≥ng c·ª≠a s·ªï. Trong n√†y n√≥ng l·∫Øm.",
                    correct: "Ng·ªØ c·∫£nh l√† 'n√≥ng' th√¨ 'ƒë·ª´ng ƒë√≥ng c·ª≠a'. C·∫•u tr√∫c ph·ªß ƒë·ªãnh: Don't + V.",
                    wrong: "A, C, D sai ng·ªØ ph√°p ph·ªß ƒë·ªãnh c·ªßa c√¢u m·ªánh l·ªánh."
                }
            },
            {
                question: "______ careful! The floor is wet.",
                options: ["Is", "Are", "Be", "Do"],
                answer: 2,
                explanation: {
                    vocab: "Careful (t√≠nh t·ª´): c·∫©n th·∫≠n.",
                    trans: "H√£y c·∫©n th·∫≠n! S√†n nh√† ƒëang ∆∞·ªõt.",
                    correct: "Tr∆∞·ªõc t√≠nh t·ª´ (careful) ta c·∫ßn ƒë·ªông t·ª´ 'to be'. Trong c√¢u m·ªánh l·ªánh, ta d√πng d·∫°ng nguy√™n th·ªÉ l√† 'Be'.",
                    wrong: "A, B sai v√¨ ƒë√£ chia ng√¥i. D sai v√¨ 'Do' kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi t√≠nh t·ª´."
                }
            },
            {
                question: "______ your homework before watching TV.",
                options: ["Doing", "Do", "Does", "Did"],
                answer: 1,
                explanation: {
                    vocab: "A. Doing; B. Do (l√†m); C. Does; D. Did (qu√° kh·ª©).",
                    trans: "H√£y l√†m b√†i t·∫≠p v·ªÅ nh√† tr∆∞·ªõc khi xem TV.",
                    correct: "ƒê·ªông t·ª´ ch√≠nh 'Do' (l√†m) ·ªü d·∫°ng nguy√™n th·ªÉ ƒë·ª©ng ƒë·∫ßu c√¢u m·ªánh l·ªánh.",
                    wrong: "Sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                question: "______ late for school!",
                options: ["Don't be", "Not be", "Don't is", "Be not"],
                answer: 0,
                explanation: {
                    vocab: "Late (t√≠nh t·ª´): mu·ªôn.",
                    trans: "Kh√¥ng ƒë∆∞·ª£c ƒëi h·ªçc mu·ªôn!",
                    correct: "C·∫•u tr√∫c c·∫•m ƒëo√°n v·ªõi t√≠nh t·ª´: Don't + be + Adj. -> Don't be late.",
                    wrong: "B, D sai c·∫•u tr√∫c. C sai v√¨ sau Don't ph·∫£i l√† nguy√™n th·ªÉ (be) ch·ª© kh√¥ng ph·∫£i (is)."
                }
            },
            {
                question: "______ the messy room, please.",
                options: ["Clean", "Cleans", "Cleaning", "Cleaned"],
                answer: 0,
                explanation: {
                    vocab: "Clean (d·ªçn d·∫πp). Messy (b·ª´a b·ªôn).",
                    trans: "Vui l√≤ng d·ªçn d·∫πp cƒÉn ph√≤ng b·ª´a b·ªôn n√†y.",
                    correct: "C√¢u y√™u c·∫ßu l·ªãch s·ª± (c√≥ please) v·∫´n d√πng V nguy√™n th·ªÉ -> Clean.",
                    wrong: "Sai th√¨ v√† d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                question: "______ touch that! It's dangerous.",
                options: ["Doesn't", "Don't", "Not", "No"],
                answer: 1,
                explanation: {
                    vocab: "Touch (ch·∫°m v√†o). Dangerous (nguy hi·ªÉm).",
                    trans: "ƒê·ª´ng ch·∫°m v√†o ƒë√≥! N√≥ nguy hi·ªÉm ƒë·∫•y.",
                    correct: "C·∫•m ƒëo√°n -> D√πng 'Don't'.",
                    wrong: "Ch·ªâ c√≥ Don't m·ªõi ƒë·ª©ng ƒë·∫ßu c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh."
                }
            },
            {
                question: "______ nice to your friends.",
                options: ["Be", "Is", "Do", "Does"],
                answer: 0,
                explanation: {
                    vocab: "Nice (t√≠nh t·ª´): t·ªët b·ª•ng/t·ª≠ t·∫ø.",
                    trans: "H√£y ƒë·ªëi x·ª≠ t·ªët v·ªõi b·∫°n b√®.",
                    correct: "Tr∆∞·ªõc t√≠nh t·ª´ 'nice' c·∫ßn 'Be'.",
                    wrong: "Is (chia ng√¥i), Do/Does (tr·ª£ ƒë·ªông t·ª´) kh√¥ng ƒëi v·ªõi t√≠nh t·ª´ trong tr∆∞·ªùng h·ª£p n√†y."
                }
            },
            {
                question: "______ write on the wall!",
                options: ["Not", "No", "Don't", "Doesn't"],
                answer: 2,
                explanation: {
                    vocab: "Write (vi·∫øt). Wall (t∆∞·ªùng).",
                    trans: "Kh√¥ng ƒë∆∞·ª£c vi·∫øt l√™n t∆∞·ªùng!",
                    correct: "C√¢u c·∫•m ƒëo√°n -> Don't + V.",
                    wrong: "Sai c·∫•u tr√∫c c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh."
                }
            },
            {
                question: "______ left at the corner.",
                options: ["Turn", "Turns", "Turning", "To turn"],
                answer: 0,
                explanation: {
                    vocab: "Turn (r·∫Ω). Left (tr√°i).",
                    trans: "H√£y r·∫Ω tr√°i ·ªü g√≥c ƒë∆∞·ªùng.",
                    correct: "Ch·ªâ ƒë∆∞·ªùng (h∆∞·ªõng d·∫´n) d√πng c√¢u m·ªánh l·ªánh -> V nguy√™n th·ªÉ (Turn).",
                    wrong: "Sai d·∫°ng ƒë·ªông t·ª´ (chia s, ing, to)."
                }
            },
            {
                question: "______ forget to bring your umbrella.",
                options: ["No", "Not", "Don't", "Doesn't"],
                answer: 2,
                explanation: {
                    vocab: "Forget (qu√™n). Umbrella (c√°i √¥).",
                    trans: "ƒê·ª´ng qu√™n mang theo √¥ nh√©.",
                    correct: "L·ªùi nh·∫Øc nh·ªü ph·ªß ƒë·ªãnh -> Don't + V.",
                    wrong: "C√°c t·ª´ kh√°c kh√¥ng t·∫°o th√†nh c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh ƒë√∫ng."
                }
            },
            {
                question: "______ your hands before eating.",
                options: ["Washes", "Washing", "To wash", "Wash"],
                answer: 3,
                explanation: {
                    vocab: "Wash (r·ª≠a). Hands (tay).",
                    trans: "H√£y r·ª≠a tay tr∆∞·ªõc khi ƒÉn.",
                    correct: "Y√™u c·∫ßu v·ªá sinh -> M·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh -> Wash (nguy√™n th·ªÉ).",
                    wrong: "Washes, Washing, To wash ƒë·ªÅu kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u m·ªánh l·ªánh."
                }
            },
            {
                question: "______ play soccer in the street.",
                options: ["Don't", "Not", "No", "Aren't"],
                answer: 0,
                explanation: {
                    vocab: "Play (ch∆°i). Street (ƒë∆∞·ªùng ph·ªë).",
                    trans: "ƒê·ª´ng ch∆°i ƒë√° b√≥ng d∆∞·ªõi l√≤ng ƒë∆∞·ªùng.",
                    correct: "C·∫•m ƒëo√°n -> Don't + Play.",
                    wrong: "Not/No kh√¥ng ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ th∆∞·ªùng ƒë·ªÉ t·∫°o m·ªánh l·ªánh. Aren't l√† to be."
                }
            },
            {
                question: "Please ______ for me!",
                options: ["waiting", "wait", "waits", "to wait"],
                answer: 1,
                explanation: {
                    vocab: "Wait (ch·ªù ƒë·ª£i).",
                    trans: "L√†m ∆°n h√£y ƒë·ª£i m√¨nh v·ªõi!",
                    correct: "Sau 'Please' trong c√¢u m·ªánh l·ªánh v·∫´n l√† V nguy√™n th·ªÉ -> Wait.",
                    wrong: "Sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                question: "______ listen to the teacher.",
                options: ["Does", "Do", "Is", "√ò (Kh√¥ng ƒëi·ªÅn g√¨)"], // Trick: 'Do' can emphasize but standard is pure V. Let's make it simpler. Replaced with 'Always' context or standard. Let's stick to standard V start.
                // Adjusted question:
                question: "______ careful when you cross the road.",
                options: ["Be", "Do", "Make", "Have"],
                answer: 0,
                explanation: {
                    vocab: "A. Be; B. Do; C. Make (l√†m); D. Have (c√≥).",
                    trans: "H√£y c·∫©n th·∫≠n khi qua ƒë∆∞·ªùng.",
                    correct: "Careful l√† t√≠nh t·ª´ -> D√πng 'Be'.",
                    wrong: "Do/Make/Have kh√¥ng ƒëi v·ªõi t√≠nh t·ª´ 'careful' trong ng·ªØ c·∫£nh n√†y."
                }
            },
            {
                question: "______ make noise in the library.",
                options: ["Doesn't", "Don't", "Not", "No"],
                answer: 1,
                explanation: {
                    vocab: "Make noise (l√†m ·ªìn). Library (th∆∞ vi·ªán).",
                    trans: "Kh√¥ng l√†m ·ªìn trong th∆∞ vi·ªán.",
                    correct: "Quy ƒë·ªãnh c·∫•m -> Don't + V.",
                    wrong: "Sai c·∫•u tr√∫c ph·ªß ƒë·ªãnh."
                }
            },
            {
                question: "______ this coat. It looks great on you.",
                options: ["Try on", "Tries on", "Trying on", "To try on"],
                answer: 0,
                explanation: {
                    vocab: "Try on (th·ª≠ ƒë·ªì).",
                    trans: "H√£y th·ª≠ chi·∫øc √°o kho√°c n√†y ƒëi. N√≥ tr√¥ng r·∫•t h·ª£p v·ªõi b·∫°n.",
                    correct: "L·ªùi khuy√™n/ƒë·ªÅ ngh·ªã -> M·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh -> V nguy√™n th·ªÉ (Try on).",
                    wrong: "Sai d·∫°ng chia ƒë·ªông t·ª´."
                }
            },
            {
                question: "______ the door, please.",
                options: ["Shutting", "Shut", "Shuts", "To shut"],
                answer: 1,
                explanation: {
                    vocab: "Shut (ƒë√≥ng/kh√©p).",
                    trans: "L√†m ∆°n ƒë√≥ng c·ª≠a l·∫°i.",
                    correct: "M·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh -> Shut (nguy√™n th·ªÉ).",
                    wrong: "Sai ng·ªØ ph√°p c√¢u m·ªánh l·ªánh."
                }
            },
            {
                question: "______ run in the corridors.",
                options: ["Not", "Don't", "No", "Doesn't"],
                answer: 1,
                explanation: {
                    vocab: "Corridors (h√†nh lang).",
                    trans: "Kh√¥ng ch·∫°y ·ªü h√†nh lang.",
                    correct: "N·ªôi quy nh√† tr∆∞·ªùng (C·∫•m) -> Don't + V.",
                    wrong: "A, C, D kh√¥ng ƒë√∫ng ng·ªØ ph√°p."
                }
            },
            {
                question: "______ your teeth twice a day.",
                options: ["Brushes", "Brushing", "Brush", "To brush"],
                answer: 2,
                explanation: {
                    vocab: "Brush (ch·∫£i/ƒë√°nh rƒÉng).",
                    trans: "H√£y ƒë√°nh rƒÉng hai l·∫ßn m·ªôt ng√†y.",
                    correct: "L·ªùi khuy√™n s·ª©c kh·ªèe (M·ªánh l·ªánh) -> V nguy√™n th·ªÉ (Brush).",
                    wrong: "Sai d·∫°ng t·ª´."
                }
            },
            {
                question: "______ give up! Try again.",
                options: ["Don't", "Not", "No", "Doesn't"],
                answer: 0,
                explanation: {
                    vocab: "Give up (b·ªè cu·ªôc).",
                    trans: "ƒê·ª´ng b·ªè cu·ªôc! H√£y th·ª≠ l·∫°i l·∫ßn n·ªØa.",
                    correct: "L·ªùi ƒë·ªông vi√™n (Ph·ªß ƒë·ªãnh) -> Don't + V.",
                    wrong: "Sai t·ª´ ph·ªß ƒë·ªãnh."
                }
            },
            {
                question: "______ polite to the elderly.",
                options: ["Do", "Are", "Be", "Is"],
                answer: 2,
                explanation: {
                    vocab: "Polite (t√≠nh t·ª´ - l·ªÖ ph√©p). Elderly (ng∆∞·ªùi gi√†).",
                    trans: "H√£y l·ªÖ ph√©p v·ªõi ng∆∞·ªùi l·ªõn tu·ªïi.",
                    correct: "Polite l√† t√≠nh t·ª´ -> D√πng Be.",
                    wrong: "Sai ƒë·ªông t·ª´."
                }
            },
            {
                question: "______ the vegetables before cooking.",
                options: ["Washed", "Washing", "Wash", "Washes"],
                answer: 2,
                explanation: {
                    vocab: "Vegetables (rau).",
                    trans: "H√£y r·ª≠a rau tr∆∞·ªõc khi n·∫•u.",
                    correct: "H∆∞·ªõng d·∫´n n·∫•u ƒÉn -> V nguy√™n th·ªÉ (Wash).",
                    wrong: "Sai th√¨/d·∫°ng."
                }
            },
            {
                question: "______ go outside. It is raining.",
                options: ["Doesn't", "Don't", "Not", "Aren't"],
                answer: 1,
                explanation: {
                    vocab: "Go outside (ra ngo√†i). Raining (m∆∞a).",
                    trans: "ƒê·ª´ng ra ngo√†i. Tr·ªùi ƒëang m∆∞a ƒë·∫•y.",
                    correct: "C·∫£nh b√°o/C·∫•m -> Don't + V.",
                    wrong: "Sai ng·ªØ ph√°p."
                }
            },
            {
                question: "______ quiet, please!",
                options: ["Keep", "Keeps", "Keeping", "To keep"],
                answer: 0,
                explanation: {
                    vocab: "Keep quiet (gi·ªØ tr·∫≠t t·ª±).",
                    trans: "L√†m ∆°n gi·ªØ tr·∫≠t t·ª±!",
                    correct: "C√¢u m·ªánh l·ªánh d√πng V nguy√™n th·ªÉ -> Keep.",
                    wrong: "Sai d·∫°ng ƒë·ªông t·ª´."
                }
            }
        ];

        // --- GAME LOGIC ---
        let currentScore = 0;
        let answeredCount = 0;
        const totalQuestions = rawQuestions.length;
        let shuffledQuestions = [];

        // Audio Context for generating sounds (No external files needed)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Ding sound (High pitch sine wave)
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else {
                // Buzz sound (Low pitch sawtooth)
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Shuffle Function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize Quiz
        function initQuiz() {
            // Shuffle questions but keep their internal structure intact
            shuffledQuestions = shuffleArray([...rawQuestions]); 
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            shuffledQuestions.forEach((q, index) => {
                const qCard = document.createElement('div');
                qCard.className = 'question-card';
                qCard.id = `q-card-${index}`;

                // Question Text
                let html = `
                    <div class="question-number">C√¢u ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid" id="options-${index}">
                `;

                // Options
                q.options.forEach((opt, optIndex) => {
                    html += `<button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, ${q.answer}, this)">${String.fromCharCode(65 + optIndex)}. ${opt}</button>`;
                });

                html += `</div>`; // Close grid

                // Detailed Explanation Section
                html += `
                    <div class="explanation-box" id="expl-${index}">
                        <div class="explanation-title">üìù C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</div>
                        
                        <div class="expl-step">
                            <span class="expl-label">1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</span>
                            ${q.explanation.vocab}
                        </div>
                        
                        <div class="expl-step">
                            <span class="expl-label">2. D·ªãch nghƒ©a:</span>
                            "${q.explanation.trans}"
                        </div>
                        
                        <div class="expl-step">
                            <span class="expl-label">3. T·∫°i sao ƒê√öNG?</span>
                            <span style="color: var(--correct); font-weight: bold;">${q.explanation.correct}</span>
                        </div>
                        
                        <div class="expl-step">
                            <span class="expl-label">4. T·∫°i sao SAI?</span>
                            ${q.explanation.wrong}
                        </div>
                    </div>
                `;

                qCard.innerHTML = html;
                container.appendChild(qCard);
            });
        }

        function checkAnswer(qIndex, optIndex, correctIndex, btn) {
            // Prevent re-answering
            const optionsDiv = document.getElementById(`options-${qIndex}`);
            if (optionsDiv.classList.contains('answered')) return;
            optionsDiv.classList.add('answered');

            const allBtns = optionsDiv.querySelectorAll('.option-btn');
            
            // Show Explanation immediately
            document.getElementById(`expl-${qIndex}`).style.display = 'block';

            if (optIndex === correctIndex) {
                // CORRECT
                btn.classList.add('correct');
                playSound('correct');
                triggerConfetti(btn);
                currentScore++;
            } else {
                // WRONG
                btn.classList.add('wrong');
                playSound('wrong');
                // Highlight the correct one
                allBtns[correctIndex].classList.add('correct');
            }
            
            answeredCount++;
            
            // Disable all buttons in this question
            allBtns.forEach(b => b.disabled = true);
        }

        function triggerConfetti(element) {
            const rect = element.getBoundingClientRect();
            // Normalized coordinates (0 to 1)
            const x = (rect.left + rect.width / 2) / window.innerWidth;
            const y = (rect.top + rect.height / 2) / window.innerHeight;

            confetti({
                particleCount: 60,
                spread: 70,
                origin: { x: x, y: y },
                colors: ['#8854C0', '#00C9A7', '#FF4757', '#F1C40F']
            });
        }

        function submitQuiz() {
            const modal = document.getElementById('result-modal');
            const scoreText = document.getElementById('final-score');
            const feedback = document.getElementById('feedback-msg');

            scoreText.innerText = `${currentScore}/${totalQuestions}`;

            const percentage = (currentScore / totalQuestions) * 100;
            if (percentage === 100) {
                feedback.innerText = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i Ti·∫øng Anh! üåü";
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (percentage >= 80) {
                feedback.innerText = "Gi·ªèi l·∫Øm! Con n·∫Øm b√†i r·∫•t ch·∫Øc! üéâ";
            } else if (percentage >= 50) {
                feedback.innerText = "Kh√° l·∫Øm! C·ªë g·∫Øng √¥n l·∫°i ph·∫ßn sai nh√©! üí™";
            } else {
                feedback.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y xem k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥. ‚ù§";
            }

            modal.style.display = 'flex';
        }

        // Start the game
        initQuiz();

    </script>
</body>
</html>