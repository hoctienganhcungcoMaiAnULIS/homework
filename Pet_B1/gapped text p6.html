<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - Reading Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Dynamic Palette: Ch·ªß ƒë·ªÅ Energy/Technology */
            --primary-color: #2D9CDB; /* Electric Blue */
            --secondary-color: #F2C94C; /* Energy Yellow */
            --accent-color: #27AE60; /* Eco Green */
            --wrong-color: #EB5757;
            --text-dark: #2c3e50;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --shadow-3d: 0 5px 0 #1a6fa0;
            --shadow-3d-active: 0 2px 0 #1a6fa0;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            color: var(--text-dark);
            /* Dynamic SVG Background */
            background-color: #e0f7fa;
            background-image: radial-gradient(circle at center, rgba(255,255,255,0.8), rgba(224,247,250,0.8)), 
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='10' y='30' font-size='20'%3E‚ö°%3C/text%3E%3Ctext x='50' y='70' font-size='20'%3Eüë£%3C/text%3E%3Ctext x='80' y='20' font-size='20'%3Eüîã%3C/text%3E%3C/svg%3E");
        }

        /* Top Control Bar */
        .top-bar {
            height: 60px;
            background: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 100;
            position: relative;
        }

        .teacher-brand {
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-box {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--wrong-color);
            background: #ffecec;
            padding: 5px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .timer-box:hover { transform: scale(1.05); }

        /* Split Screen Layout */
        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Left Column: Reading Passage */
        .reading-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            border-right: 2px solid #e0e0e0;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(5px);
        }

        .passage-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .paragraph {
            margin-bottom: 25px;
            line-height: 1.8;
            font-size: 1.1rem;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
        }

        .gap-placeholder {
            display: inline-block;
            width: 40px;
            height: 30px;
            background: var(--secondary-color);
            color: #fff;
            text-align: center;
            line-height: 30px;
            border-radius: 8px;
            font-weight: bold;
            margin: 0 5px;
            cursor: help;
        }

        .translate-btn {
            display: block;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--primary-color);
            background: none;
            border: 2px dashed var(--primary-color);
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
        }

        .translate-btn:hover { background: #e3f2fd; }

        .translation-text {
            display: none;
            margin-top: 10px;
            font-style: italic;
            color: #555;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--secondary-color);
        }

        /* Right Column: Exercises */
        .exercise-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f4f6f8;
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            transition: 0.3s;
        }

        .question-card.correct { border-color: var(--accent-color); }
        .question-card.wrong { border-color: var(--wrong-color); }

        .q-header {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 15px;
            text-align: left;
            cursor: pointer;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            transition: 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #e0e0e0;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .option-btn:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        .option-btn.correct {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            box-shadow: 0 4px 0 #1e8449;
        }

        .option-btn.wrong {
            background: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
            box-shadow: 0 4px 0 #c0392b;
            animation: shake 0.5s;
        }

        /* Explanation Section */
        .explanation-box {
            display: none;
            margin-top: 20px;
            animation: slideDown 0.5s ease;
        }

        .support-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }

        .btn-explain { background: #9b59b6; }
        .btn-trans { background: #3498db; }
        .btn-vocab { background: #e67e22; }

        .detail-content {
            margin-top: 15px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .teacher-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 10px;
        }

        /* Glossary */
        .glossary-section {
            margin-top: 40px;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            border-top: 5px solid var(--secondary-color);
        }
        
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
        }
        .glossary-table th, .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .glossary-table th { color: var(--primary-color); }
        
        /* Submit Button */
        .submit-container {
            text-align: center;
            padding: 20px;
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #FF512F, #DD2476);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(221, 36, 118, 0.4);
            transition: 0.3s;
            font-weight: 800;
        }
        .submit-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 25px rgba(221, 36, 118, 0.5); }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            animation: bounceIn 0.8s;
            position: relative;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="top-bar">
        <div class="teacher-brand">
            <span>üë©‚Äçüè´</span> Gi√°o vi√™n t·∫°o: Ms Mai An ULIS
        </div>
        <div class="timer-box" id="timer" onclick="toggleTimer()">10:00</div>
    </div>

    <div class="container">
        <div class="reading-panel">
            <h1 class="passage-title">A New Way of Making Electricity ‚ö°</h1>
            
            <div class="paragraph">
                Ever since the 19th century, when people were developing different ways of creating electricity, companies have looked for improved ways of producing power, using cleaner and more efficient methods.
                <button class="translate-btn" onclick="toggleTrans('p1')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p1" class="translation-text">
                    K·ªÉ t·ª´ th·∫ø k·ª∑ 19, khi con ng∆∞·ªùi ph√°t tri·ªÉn c√°c c√°ch kh√°c nhau ƒë·ªÉ t·∫°o ra ƒëi·ªán, c√°c c√¥ng ty ƒë√£ t√¨m ki·∫øm nh·ªØng ph∆∞∆°ng ph√°p c·∫£i ti·∫øn ƒë·ªÉ s·∫£n xu·∫•t nƒÉng l∆∞·ª£ng, s·ª≠ d·ª•ng c√°c ph∆∞∆°ng ph√°p s·∫°ch h∆°n v√† hi·ªáu qu·∫£ h∆°n.
                </div>
            </div>

            <div class="paragraph">
                Now a UK company called Pavegen has been working on technology that could be widely used in the future to produce electricity. <span class="gap-placeholder">(1)</span> The company has developed a special type of floor, made of square tiles. Underneath each square, there‚Äôs a system that can produce a certain amount of electricity very cheaply ‚Äì from the energy created every time someone steps on it!
                <button class="translate-btn" onclick="toggleTrans('p2')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p2" class="translation-text">
                    Hi·ªán nay, m·ªôt c√¥ng ty c·ªßa Anh t√™n l√† Pavegen ƒëang nghi√™n c·ª©u c√¥ng ngh·ªá c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i trong t∆∞∆°ng lai ƒë·ªÉ s·∫£n xu·∫•t ƒëi·ªán. (1) ... C√¥ng ty ƒë√£ ph√°t tri·ªÉn m·ªôt lo·∫°i s√†n ƒë·∫∑c bi·ªát, ƒë∆∞·ª£c l√†m b·∫±ng c√°c vi√™n g·∫°ch h√¨nh vu√¥ng. B√™n d∆∞·ªõi m·ªói √¥ vu√¥ng, c√≥ m·ªôt h·ªá th·ªëng c√≥ th·ªÉ s·∫£n xu·∫•t m·ªôt l∆∞·ª£ng ƒëi·ªán nh·∫•t ƒë·ªãnh v·ªõi chi ph√≠ r·∫•t r·∫ª ‚Äì t·ª´ nƒÉng l∆∞·ª£ng ƒë∆∞·ª£c t·∫°o ra m·ªói khi c√≥ ai ƒë√≥ b∆∞·ªõc l√™n n√≥!
                </div>
            </div>

            <div class="paragraph">
                The creator of the floor, Laurence Kemball-Cook, came up with the idea when he was a student, and did some work experience with an energy company. The company asked him to investigate ways of providing street lighting in city centres, using energy from the sun to produce electricity. <span class="gap-placeholder">(2)</span> One reason was that many city centres don‚Äôt get enough sunlight, because of all the tall buildings. Then he thought of a better plan.
                <button class="translate-btn" onclick="toggleTrans('p3')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p3" class="translation-text">
                    Ng∆∞·ªùi s√°ng t·∫°o ra s√†n nh√†, Laurence Kemball-Cook, ƒë√£ n·∫£y ra √Ω t∆∞·ªüng n√†y khi anh c√≤n l√† sinh vi√™n v√† ƒë√£ c√≥ th·ªùi gian th·ª±c t·∫≠p t·∫°i m·ªôt c√¥ng ty nƒÉng l∆∞·ª£ng. C√¥ng ty y√™u c·∫ßu anh ƒëi·ªÅu tra c√°c c√°ch cung c·∫•p √°nh s√°ng ƒë∆∞·ªùng ph·ªë ·ªü c√°c trung t√¢m th√†nh ph·ªë, s·ª≠ d·ª•ng nƒÉng l∆∞·ª£ng t·ª´ m·∫∑t tr·ªùi ƒë·ªÉ s·∫£n xu·∫•t ƒëi·ªán. (2) ... M·ªôt l√Ω do l√† nhi·ªÅu trung t√¢m th√†nh ph·ªë kh√¥ng nh·∫≠n ƒë·ªß √°nh s√°ng m·∫∑t tr·ªùi do c√≥ qu√° nhi·ªÅu t√≤a nh√† cao t·∫ßng. Sau ƒë√≥, anh ·∫•y nghƒ© ra m·ªôt k·∫ø ho·∫°ch t·ªët h∆°n.
                </div>
            </div>

            <div class="paragraph">
                <span class="gap-placeholder">(3)</span> The right technology could be used to convert this energy into electricity ‚Äì right under people‚Äôs feet!
                <button class="translate-btn" onclick="toggleTrans('p4')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p4" class="translation-text">
                    (3) ... C√¥ng ngh·ªá ph√π h·ª£p c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ chuy·ªÉn ƒë·ªïi nƒÉng l∆∞·ª£ng n√†y th√†nh ƒëi·ªán nƒÉng ‚Äì ngay d∆∞·ªõi ch√¢n m·ªçi ng∆∞·ªùi!
                </div>
            </div>

            <div class="paragraph">
                The design of the floor is actually extremely effective. <span class="gap-placeholder">(4)</span> And the reason is that a lot of energy is produced simply because of the large numbers of people walking across the floor. In fact, the special squares are already in place in several locations with high numbers of pedestrians. These include big department stores and also an airport.
                <button class="translate-btn" onclick="toggleTrans('p5')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p5" class="translation-text">
                    Thi·∫øt k·∫ø c·ªßa s√†n nh√† th·ª±c s·ª± c·ª±c k·ª≥ hi·ªáu qu·∫£. (4) ... V√† l√Ω do l√† r·∫•t nhi·ªÅu nƒÉng l∆∞·ª£ng ƒë∆∞·ª£c t·∫°o ra ch·ªâ ƒë∆°n gi·∫£n l√† do s·ªë l∆∞·ª£ng l·ªõn ng∆∞·ªùi ƒëi b·ªô qua s√†n. Tr√™n th·ª±c t·∫ø, c√°c √¥ vu√¥ng ƒë·∫∑c bi·ªát ƒë√£ ƒë∆∞·ª£c l·∫Øp ƒë·∫∑t t·∫°i m·ªôt s·ªë ƒë·ªãa ƒëi·ªÉm c√≥ l∆∞·ª£ng ng∆∞·ªùi ƒëi b·ªô cao. Bao g·ªìm c√°c c·ª≠a h√†ng b√°ch h√≥a l·ªõn v√† c·∫£ m·ªôt s√¢n bay.
                </div>
            </div>

            <div class="paragraph">
                The flooring can have other uses too, such as recording how many people visit a shopping centre at particular times. <span class="gap-placeholder">(5)</span> For example, shop owners in the centre would be interested in knowing at which times of days they have the highest customer numbers. So the next time you visit a big shopping centre, have a careful look at the floor that you‚Äôre walking across!
                <button class="translate-btn" onclick="toggleTrans('p6')">üîç B·∫£n d·ªãch ƒë·∫ßy ƒë·ªß</button>
                <div id="p6" class="translation-text">
                    S√†n nh√† c≈©ng c√≥ th·ªÉ c√≥ nh·ªØng c√¥ng d·ª•ng kh√°c, ch·∫≥ng h·∫°n nh∆∞ ghi l·∫°i s·ªë l∆∞·ª£ng ng∆∞·ªùi ƒë·∫øn trung t√¢m mua s·∫Øm v√†o nh·ªØng th·ªùi ƒëi·ªÉm c·ª• th·ªÉ. (5) ... V√≠ d·ª•, c√°c ch·ªß c·ª≠a h√†ng trong trung t√¢m s·∫Ω quan t√¢m ƒë·∫øn vi·ªác bi·∫øt th·ªùi ƒëi·ªÉm n√†o trong ng√†y h·ªç c√≥ l∆∞·ª£ng kh√°ch h√†ng cao nh·∫•t. V√¨ v·∫≠y, l·∫ßn t·ªõi khi b·∫°n gh√© thƒÉm m·ªôt trung t√¢m mua s·∫Øm l·ªõn, h√£y nh√¨n k·ªπ xu·ªëng s√†n nh√† m√† b·∫°n ƒëang b∆∞·ªõc qua nh√©!
                </div>
            </div>

            <div class="glossary-section">
                <h3 style="color: var(--primary-color);">üìö Glossary (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</h3>
                <table class="glossary-table">
                    <tr><th>Word</th><th>Type</th><th>Vietnamese Meaning</th></tr>
                    <tr><td>**Efficient**</td><td>adj</td><td>Hi·ªáu qu·∫£, nƒÉng su·∫•t cao</td></tr>
                    <tr><td>**Investigate**</td><td>v</td><td>ƒêi·ªÅu tra, nghi√™n c·ª©u k·ªπ</td></tr>
                    <tr><td>**Convert**</td><td>v</td><td>Chuy·ªÉn ƒë·ªïi (d·∫°ng n√†y sang d·∫°ng kh√°c)</td></tr>
                    <tr><td>**Pedestrians**</td><td>n</td><td>Ng∆∞·ªùi ƒëi b·ªô</td></tr>
                    <tr><td>**Locations**</td><td>n</td><td>ƒê·ªãa ƒëi·ªÉm, v·ªã tr√≠</td></tr>
                    <tr><td>**Particular**</td><td>adj</td><td>C·ª• th·ªÉ, ƒë·∫∑c bi·ªát</td></tr>
                    <tr><td>**Department store**</td><td>n</td><td>C·ª≠a h√†ng b√°ch h√≥a t·ªïng h·ª£p</td></tr>
                    <tr><td>**Renewable**</td><td>adj</td><td>C√≥ th·ªÉ t√°i t·∫°o (nƒÉng l∆∞·ª£ng)</td></tr>
                    <tr><td>**Technology**</td><td>n</td><td>C√¥ng ngh·ªá</td></tr>
                    <tr><td>**Produce**</td><td>v</td><td>S·∫£n xu·∫•t, t·∫°o ra</td></tr>
                </table>
            </div>
        </div>

        <div class="exercise-panel">
            <h2 style="text-align:center; color: var(--text-dark);">‚úçÔ∏è Exercises</h2>
            <p style="text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 20px;">Choose the correct sentence (A-H) for each gap (1-5).</p>

            <div class="question-card" id="q1">
                <div class="q-header"><span>1Ô∏è‚É£</span> Gap (1) needs which sentence?</div>
                <div class="options-grid" id="opt-q1">
                    </div>
                <div class="explanation-box" id="exp-q1"></div>
            </div>

            <div class="question-card" id="q2">
                <div class="q-header"><span>2Ô∏è‚É£</span> Gap (2) needs which sentence?</div>
                <div class="options-grid" id="opt-q2"></div>
                <div class="explanation-box" id="exp-q2"></div>
            </div>

            <div class="question-card" id="q3">
                <div class="q-header"><span>3Ô∏è‚É£</span> Gap (3) needs which sentence?</div>
                <div class="options-grid" id="opt-q3"></div>
                <div class="explanation-box" id="exp-q3"></div>
            </div>

            <div class="question-card" id="q4">
                <div class="q-header"><span>4Ô∏è‚É£</span> Gap (4) needs which sentence?</div>
                <div class="options-grid" id="opt-q4"></div>
                <div class="explanation-box" id="exp-q4"></div>
            </div>

            <div class="question-card" id="q5">
                <div class="q-header"><span>5Ô∏è‚É£</span> Gap (5) needs which sentence?</div>
                <div class="options-grid" id="opt-q5"></div>
                <div class="explanation-box" id="exp-q5"></div>
            </div>

            <div class="submit-container">
                <button class="submit-btn" onclick="showFinalScore()">üèÜ N·ªòP B√ÄI</button>
            </div>
        </div>
    </div>

    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <h2 style="font-size: 2.5rem; margin: 0;">K·∫æT QU·∫¢</h2>
            <div id="final-emoji" style="font-size: 4rem; margin: 20px 0;">üéâ</div>
            <p id="score-text" style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">4/5</p>
            <p id="feedback-text" style="color: #666;"></p>
            <button onclick="closeModal()" style="background: var(--primary-color); color: white; border: none; padding: 10px 30px; border-radius: 20px; font-size: 1.2rem; cursor: pointer; margin-top: 20px;">Review Answers</button>
        </div>
    </div>

    <script>
        // DATA & LOGIC
        const answers = {
            q1: 'E',
            q2: 'G',
            q3: 'C',
            q4: 'F',
            q5: 'B'
        };

        const optionsList = [
            { id: 'A', text: 'But that isn‚Äôt the end of the story.' },
            { id: 'B', text: 'This kind of information is very useful for certain people.' },
            { id: 'C', text: 'Why not use the energy created by pedestrians instead?' },
            { id: 'D', text: 'However, one big problem could be cost.' },
            { id: 'E', text: 'And it‚Äôs actually based on a simple idea.' },
            { id: 'F', text: 'This is especially true when it‚Äôs been used in very busy areas.' },
            { id: 'G', text: 'But it soon became clear that this might not work.' },
            { id: 'H', text: 'This new system should work even better.' }
        ];

        const explanations = {
            q1: {
                trans: "V√† th·ª±c ra n√≥ d·ª±a tr√™n m·ªôt √Ω t∆∞·ªüng ƒë∆°n gi·∫£n.",
                logic: "C√¢u tr∆∞·ªõc n√≥i v·ªÅ c√¥ng ngh·ªá Pavegen. C√¢u E n√≥i 'd·ª±a tr√™n √Ω t∆∞·ªüng ƒë∆°n gi·∫£n' ƒë·ªÉ d·∫´n d·∫Øt v√†o c√¢u sau m√¥ t·∫£ c·ª• th·ªÉ v·ªÅ s√†n nh√† ƒë·∫∑c bi·ªát v√† c√°ch n√≥ ho·∫°t ƒë·ªông (h·ªá th·ªëng d∆∞·ªõi m·ªói √¥ vu√¥ng).",
                vocab: "Based on (d·ª±a tr√™n), Simple idea (√Ω t∆∞·ªüng ƒë∆°n gi·∫£n)"
            },
            q2: {
                trans: "Nh∆∞ng r·ªìi s·ªõm nh·∫≠n ra r·∫±ng ƒëi·ªÅu n√†y c√≥ th·ªÉ kh√¥ng hi·ªáu qu·∫£.",
                logic: "C√¢u tr∆∞·ªõc n√≥i v·ªÅ vi·ªác d√πng nƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi. C√¢u G ph·ªß ƒë·ªãnh 'might not work' (c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông). C√¢u sau gi·∫£i th√≠ch l√Ω do: 'One reason was...' (M·ªôt l√Ω do l√† thi·∫øu √°nh n·∫Øng).",
                vocab: "Become clear (tr·ªü n√™n r√µ r√†ng), Work (ho·∫°t ƒë·ªông/hi·ªáu qu·∫£)"
            },
            q3: {
                trans: "T·∫°i sao kh√¥ng s·ª≠ d·ª•ng nƒÉng l∆∞·ª£ng t·∫°o ra b·ªüi ng∆∞·ªùi ƒëi b·ªô thay v√†o ƒë√≥?",
                logic: "ƒê√¢y l√† c√¢u h·ªèi tu t·ª´, ƒë∆∞a ra √Ω t∆∞·ªüng m·ªõi. C√¢u sau x√°c nh·∫≠n 'Convert THIS energy' (chuy·ªÉn ƒë·ªïi ngu·ªìn nƒÉng l∆∞·ª£ng N√ÄY) -> √°m ch·ªâ nƒÉng l∆∞·ª£ng t·ª´ ng∆∞·ªùi ƒëi b·ªô v·ª´a nh·∫Øc ƒë·∫øn.",
                vocab: "Pedestrians (ng∆∞·ªùi ƒëi b·ªô), Instead (thay v√†o ƒë√≥)"
            },
            q4: {
                trans: "ƒêi·ªÅu n√†y ƒë·∫∑c bi·ªát ƒë√∫ng khi n√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü nh·ªØng khu v·ª±c r·∫•t s·∫ßm u·∫•t.",
                logic: "C√¢u tr∆∞·ªõc khen thi·∫øt k·∫ø 'effective' (hi·ªáu qu·∫£). C√¢u F b·ªï sung 'ƒë·∫∑c bi·ªát ƒë√∫ng ·ªü n∆°i ƒë√¥ng ƒë√∫c'. C√¢u sau gi·∫£i th√≠ch: 'reason is large numbers of people' (l√Ω do l√† l∆∞·ª£ng ng∆∞·ªùi l·ªõn).",
                vocab: "Especially true (ƒë·∫∑c bi·ªát ƒë√∫ng), Busy areas (khu v·ª±c b·∫≠n r·ªôn/ƒë√¥ng ƒë√∫c)"
            },
            q5: {
                trans: "Lo·∫°i th√¥ng tin n√†y r·∫•t h·ªØu √≠ch cho m·ªôt s·ªë ng∆∞·ªùi nh·∫•t ƒë·ªãnh.",
                logic: "C√¢u tr∆∞·ªõc n√≥i v·ªÅ vi·ªác 'recording' (ghi l·∫°i s·ªë li·ªáu). C√¢u B n√≥i 'th√¥ng tin n√†y h·ªØu √≠ch'. C√¢u sau v√≠ d·ª•: 'shop owners' (ch·ªß c·ª≠a h√†ng) ch√≠nh l√† nh·ªØng ng∆∞·ªùi th·∫•y h·ªØu √≠ch ƒë√≥.",
                vocab: "Useful (h·ªØu √≠ch), Certain people (m·ªôt s·ªë ng∆∞·ªùi nh·∫•t ƒë·ªãnh)"
            }
        };

        let score = 0;
        let answered = { q1: false, q2: false, q3: false, q4: false, q5: false };
        let timerInterval;
        let timeLeft = 600; // 10 minutes
        let isPaused = true;

        // INIT
        window.onload = function() {
            renderOptions();
        };

        // RENDER OPTIONS RANDOMLY OR ORDERED (Ordered is better for A-H list)
        function renderOptions() {
            ['q1', 'q2', 'q3', 'q4', 'q5'].forEach(qId => {
                const container = document.getElementById(`opt-${qId}`);
                optionsList.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerHTML = `<b>${opt.id}.</b> ${opt.text}`;
                    btn.onclick = () => checkAnswer(qId, opt.id, btn);
                    container.appendChild(btn);
                });
            });
        }

        // CHECK ANSWER LOGIC
        function checkAnswer(qId, selectedOpt, btnElement) {
            // Reset previous styles in this question
            const parent = document.getElementById(`opt-${qId}`);
            Array.from(parent.children).forEach(child => {
                child.className = 'option-btn'; 
                child.disabled = true; // Disable all after selection
            });

            if (selectedOpt === answers[qId]) {
                // CORRECT
                btnElement.classList.add('correct');
                document.getElementById(qId).classList.add('correct');
                playTone('ding');
                fireConfetti();
                score++;
                showExplanation(qId, true);
            } else {
                // WRONG
                btnElement.classList.add('wrong');
                document.getElementById(qId).classList.add('wrong');
                playTone('buzz');
                // Highlight correct one
                Array.from(parent.children).forEach(child => {
                    if (child.innerHTML.includes(`<b>${answers[qId]}.</b>`)) {
                        child.classList.add('correct');
                    }
                });
                showExplanation(qId, false);
            }
            answered[qId] = true;
        }

        // SHOW EXPLANATION
        function showExplanation(qId, isCorrect) {
            const expBox = document.getElementById(`exp-${qId}`);
            const data = explanations[qId];
            
            expBox.style.display = 'block';
            expBox.innerHTML = `
                <div class="support-actions">
                    <button class="action-btn btn-explain" onclick="toggleDetail('${qId}', 'logic')">üí° Gi·∫£i th√≠ch</button>
                    <button class="action-btn btn-trans" onclick="toggleDetail('${qId}', 'trans')">üáªüá≥ D·ªãch c√¢u</button>
                    <button class="action-btn btn-vocab" onclick="toggleDetail('${qId}', 'vocab')">üìñ T·ª´ v·ª±ng</button>
                </div>
                <div id="detail-${qId}" class="detail-content">
                    <b>${isCorrect ? 'Tuy·ªát v·ªùi! Ch√≠nh x√°c.' : 'Ti·∫øc qu√°! ƒê√°p √°n ƒë√∫ng l√† ' + answers[qId] + '.'}</b><br>
                    ${data.logic}
                </div>
            `;
        }

        function toggleDetail(qId, type) {
            const content = document.getElementById(`detail-${qId}`);
            const data = explanations[qId];
            if (type === 'logic') content.innerHTML = `<b>Gi·∫£i th√≠ch chi ti·∫øt:</b><br>${data.logic}`;
            if (type === 'trans') content.innerHTML = `<b>D·ªãch nghƒ©a ƒë√°p √°n ƒë√∫ng:</b><br>"${data.trans}"`;
            if (type === 'vocab') content.innerHTML = `<b>T·ª´ kh√≥a c·∫ßn nh·ªõ:</b><br>${data.vocab}`;
        }

        // TIMER LOGIC
        function toggleTimer() {
            const timerDisplay = document.getElementById('timer');
            if (isPaused) {
                isPaused = false;
                timerDisplay.style.background = '#e8f5e9';
                timerDisplay.style.color = '#27ae60';
                timerInterval = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                    const s = (timeLeft % 60).toString().padStart(2, '0');
                    timerDisplay.innerText = `${m}:${s}`;
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        alert("ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c, nh∆∞ng h√£y nh·ªõ t·ªëc ƒë·ªô l√†m b√†i trong ph√≤ng thi nh√©.");
                    }
                }, 1000);
            } else {
                isPaused = true;
                clearInterval(timerInterval);
                timerDisplay.style.background = '#ffecec';
                timerDisplay.style.color = '#EB5757';
                timerDisplay.innerText = "PAUSED";
            }
        }

        // AUDIO SYSTEM (No external files)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'ding') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
                gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // CONFETTI EFFECT
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    speed: Math.random() * 5 + 2
                });
            }

            function animate() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.y += p.speed;
                    if(p.y < canvas.height) {
                        active = true;
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, p.size, p.size);
                    }
                });
                if(active) requestAnimationFrame(animate);
                else ctx.clearRect(0,0, canvas.width, canvas.height);
            }
            animate();
        }

        // UI HELPERS
        function toggleTrans(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        function showFinalScore() {
            const modal = document.getElementById('scoreModal');
            const scoreText = document.getElementById('score-text');
            const feedText = document.getElementById('feedback-text');
            const emoji = document.getElementById('final-emoji');

            modal.style.display = 'flex';
            scoreText.innerText = `${score}/5 Correct`;
            
            if (score === 5) {
                emoji.innerText = "üëë";
                feedText.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng√¥n ng·ªØ!";
                fireConfetti();
            } else if (score >= 3) {
                emoji.innerText = "üòé";
                feedText.innerText = "L√†m t·ªët l·∫Øm! Ch·ªâ c·∫ßn c·∫©n th·∫≠n h∆°n m·ªôt ch√∫t th√¥i.";
            } else {
                emoji.innerText = "üí™";
                feedText.innerText = "C·ªë l√™n nh√©! H√£y ƒë·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu b√†i h∆°n.";
            }
        }

        function closeModal() {
            document.getElementById('scoreModal').style.display = 'none';
        }
    </script>
</body>
</html>