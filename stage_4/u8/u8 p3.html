<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ng·ªØ Ph√°p - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --text-color: #2d3436;
            --card-shadow: 0 10px 0px rgba(0,0,0,0.1);
            --btn-shadow: 0 6px 0px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e0f7fa;
            background-image: radial-gradient(#00C9A7 15%, transparent 16%), radial-gradient(#8854C0 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            position: relative;
            margin-top: 20px;
            border: 4px solid var(--primary-purple);
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-teal));
            padding: 20px;
            border-radius: 20px;
            color: white;
            box-shadow: var(--card-shadow);
        }

        header h1 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        header h2 {
            margin: 5px 0 0;
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 600;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 50px;
            height: 15px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 2px solid #ccc;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-teal);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 50px;
        }

        /* Question Card */
        .question-box {
            background: #fff;
            border: 3px solid #eee;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-purple);
            position: relative;
        }

        .question-number {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-purple);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background-color: white;
            border: 3px solid #e0e0e0;
            border-bottom: 6px solid #e0e0e0; /* 3D effect */
            border-radius: 15px;
            padding: 15px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            outline: none;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-teal);
            border-bottom-color: var(--primary-teal);
            background-color: #f0fffa;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .option-btn.correct {
            background-color: var(--correct-green) !important;
            color: white !important;
            border-color: #00a653 !important;
            border-bottom-color: #008f47 !important;
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red) !important;
            color: white !important;
            border-color: #d63031 !important;
            border-bottom-color: #b71c1c !important;
            animation: shake 0.5s;
        }

        /* Explanation Section */
        #explanation-container {
            display: none;
            margin-top: 25px;
            background: #fff;
            border-radius: 15px;
            border: 2px dashed var(--primary-purple);
            overflow: hidden;
            animation: slideDown 0.4s ease-out;
        }

        .exp-header {
            background: #f3e5f5;
            padding: 10px 20px;
            font-weight: 800;
            color: var(--primary-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content {
            padding: 20px;
            font-size: 1rem;
            line-height: 1.6;
        }

        .exp-section {
            margin-bottom: 15px;
        }

        .exp-section strong {
            color: var(--primary-purple);
            display: block;
            margin-bottom: 5px;
        }

        .vocab-list {
            list-style: none;
            padding: 0;
            background: #fafafa;
            padding: 10px;
            border-radius: 10px;
        }
        
        .vocab-list li {
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }
        .badge-type { background-color: #a29bfe; }
        .badge-correct { background-color: var(--correct-green); }
        .badge-wrong { background-color: var(--wrong-red); }

        /* Next Button */
        #next-btn {
            display: none;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            background-color: var(--primary-purple);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #6c429c;
            transition: all 0.2s;
        }

        #next-btn:hover {
            transform: scale(1.02);
            background-color: #9b59b6;
        }

        #next-btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #6c429c;
        }

        /* Result Screen */
        #result-screen {
            display: none;
            text-align: center;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            background: var(--primary-teal);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: 800;
            color: white;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--primary-teal);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>B√†i T·∫≠p Ng·ªØ Ph√°p T·ªïng H·ª£p</h1>
        <h2>Gi√°o vi√™n: Ms Mai An ULIS</h2>
    </header>

    <div id="quiz-area">
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="question-box">
            <span class="question-number">C√¢u <span id="q-current">1</span>/<span id="q-total">30</span></span>
            <div id="question-text">Loading...</div>
        </div>

        <div class="options-grid" id="options-container">
            </div>

        <div id="explanation-container">
            <div class="exp-header">
                <span>üë©‚Äçüè´ Ms Mai An gi·∫£i th√≠ch:</span>
            </div>
            <div class="exp-content" id="exp-content">
                </div>
        </div>

        <button id="next-btn" onclick="nextQuestion()">C√¢u Ti·∫øp Theo ‚ûî</button>
    </div>

    <div id="result-screen">
        <h2>üéâ HO√ÄN TH√ÄNH B√ÄI THI! üéâ</h2>
        <div class="score-circle">
            <span id="final-score">0</span>
        </div>
        <p id="final-msg" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
        <button id="next-btn" style="display:block" onclick="location.reload()">L√†m L·∫°i B√†i Thi üîÑ</button>
    </div>
</div>

<script>
    // --- DATABASE: 30 Questions (Mixed Tenses for Grade 3-4) ---
    // Tenses: Present Simple, Present Continuous, Past Simple, Present Perfect, Future Simple
    
    const rawQuestions = [
        {
            question: "Look! The boys ______ football in the playground.",
            options: ["A. play", "B. are playing", "C. played", "D. will play"],
            correct: 1, // Index 0-3
            explanation: {
                vocab: [
                    "A. play (v): ch∆°i (Hi·ªán t·∫°i ƒë∆°n)",
                    "B. are playing (v): ƒëang ch∆°i (Hi·ªán t·∫°i ti·∫øp di·ªÖn)",
                    "C. played (v): ƒë√£ ch∆°i (Qu√° kh·ª© ƒë∆°n)",
                    "D. will play (v): s·∫Ω ch∆°i (T∆∞∆°ng lai ƒë∆°n)"
                ],
                trans: "Nh√¨n k√¨a! C√°c c·∫≠u b√© ƒëang ƒë√° b√≥ng trong s√¢n ch∆°i.",
                correctReason: "C√≥ t·ª´ t√≠n hi·ªáu 'Look!' (Nh√¨n k√¨a!) ƒë·ª©ng ƒë·∫ßu c√¢u ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn** (h√†nh ƒë·ªông ƒëang x·∫£y ra ngay l√∫c n√≥i).",
                wrongReason: "C√°c ƒë√°p √°n A, C, D sai v·ªÅ th√¨. 'Look!' y√™u c·∫ßu m·ªôt h√†nh ƒë·ªông ƒëang di·ªÖn ra."
            }
        },
        {
            question: "I ______ to the zoo last Sunday.",
            options: ["A. go", "B. goes", "C. went", "D. going"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. go (v): ƒëi (nguy√™n th·ªÉ)",
                    "B. goes (v): ƒëi (chia ng√¥i th·ª© 3 s·ªë √≠t)",
                    "C. went (v): ƒë√£ ƒëi (Qu√° kh·ª© c·ªßa go)",
                    "D. going (v): ƒëang ƒëi (V-ing)"
                ],
                trans: "T·ªõ ƒë√£ ƒëi s·ªü th√∫ v√†o Ch·ªß nh·∫≠t tu·∫ßn tr∆∞·ªõc.",
                correctReason: "C√≥ c·ª•m t·ª´ 'last Sunday' (Ch·ªß nh·∫≠t tr∆∞·ªõc) ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **Qu√° kh·ª© ƒë∆°n**.",
                wrongReason: "A, B l√† hi·ªán t·∫°i. D thi·∫øu ƒë·ªông t·ª´ tobe. C l√† d·∫°ng qu√° kh·ª© c·ªßa 'go' n√™n ƒë√∫ng."
            }
        },
        {
            question: "She usually ______ up at 6 o'clock every morning.",
            options: ["A. get", "B. gets", "C. is getting", "D. got"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. get (v): th·ª©c d·∫≠y (s·ªë nhi·ªÅu)",
                    "B. gets (v): th·ª©c d·∫≠y (s·ªë √≠t)",
                    "C. is getting (v): ƒëang th·ª©c d·∫≠y",
                    "D. got (v): ƒë√£ th·ª©c d·∫≠y"
                ],
                trans: "C√¥ ·∫•y th∆∞·ªùng th·ª©c d·∫≠y l√∫c 6 gi·ªù m·ªói s√°ng.",
                correctReason: "C√≥ t·ª´ 'usually' v√† 'every morning' ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **Hi·ªán t·∫°i ƒë∆°n** di·ªÖn t·∫£ th√≥i quen. Ch·ªß ng·ªØ 'She' l√† ng√¥i th·ª© 3 s·ªë √≠t n√™n ƒë·ªông t·ª´ th√™m 's'.",
                wrongReason: "A sai v√¨ thi·∫øu 's'. C sai th√¨. D sai th√¨."
            }
        },
        {
            question: "We ______ Grandma next week.",
            options: ["A. visit", "B. visited", "C. have visited", "D. will visit"],
            correct: 3,
            explanation: {
                vocab: [
                    "A. visit (v): thƒÉm",
                    "B. visited (v): ƒë√£ thƒÉm",
                    "C. have visited (v): ƒë√£ t·ª´ng thƒÉm",
                    "D. will visit (v): s·∫Ω thƒÉm"
                ],
                trans: "Ch√∫ng t·ªõ s·∫Ω ƒëi thƒÉm b√† v√†o tu·∫ßn t·ªõi.",
                correctReason: "C√≥ t·ª´ 'next week' (tu·∫ßn t·ªõi) ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **T∆∞∆°ng lai ƒë∆°n**.",
                wrongReason: "A, B, C ƒë·ªÅu sai m·ªëc th·ªùi gian (hi·ªán t·∫°i, qu√° kh·ª©)."
            }
        },
        {
            question: "______ you finished your homework yet?",
            options: ["A. Do", "B. Did", "C. Have", "D. Are"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. Do (tr·ª£ t·ª´ HTƒê)",
                    "B. Did (tr·ª£ t·ª´ QKƒê)",
                    "C. Have (tr·ª£ t·ª´ HTHT)",
                    "D. Are (ƒë·ªông t·ª´ tobe)"
                ],
                trans: "B·∫°n ƒë√£ l√†m xong b√†i t·∫≠p v·ªÅ nh√† ch∆∞a?",
                correctReason: "C√≥ t·ª´ 'yet' ·ªü cu·ªëi c√¢u h·ªèi v√† ƒë·ªông t·ª´ ch√≠nh 'finished' (V3/ed) ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **Hi·ªán t·∫°i ho√†n th√†nh**. C·∫•u tr√∫c: Have/Has + S + V3/ed...?",
                wrongReason: "A, B ƒëi v·ªõi ƒë·ªông t·ª´ nguy√™n th·ªÉ. D ƒëi v·ªõi V-ing."
            }
        },
        {
            question: "My father ______ TV in the living room now.",
            options: ["A. watch", "B. watches", "C. is watching", "D. watched"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. watch (v): xem",
                    "B. watches (v): xem (s·ªë √≠t)",
                    "C. is watching (v): ƒëang xem",
                    "D. watched (v): ƒë√£ xem"
                ],
                trans: "B·ªë t·ªõ ƒëang xem TV ·ªü ph√≤ng kh√°ch b√¢y gi·ªù.",
                correctReason: "C√≥ t·ª´ 'now' (b√¢y gi·ªù) ‚Üí D·∫•u hi·ªáu c·ªßa th√¨ **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                wrongReason: "A, B l√† hi·ªán t·∫°i ƒë∆°n (th√≥i quen). D l√† qu√° kh·ª©."
            }
        },
        {
            question: "He ______ play the guitar two years ago.",
            options: ["A. doesn't", "B. don't", "C. didn't", "D. won't"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. doesn't (HTƒê)",
                    "B. don't (HTƒê)",
                    "C. didn't (QKƒê)",
                    "D. won't (TLƒê)"
                ],
                trans: "Anh ·∫•y ƒë√£ kh√¥ng ch∆°i ghi-ta c√°ch ƒë√¢y 2 nƒÉm.",
                correctReason: "C√≥ 'two years ago' (2 nƒÉm tr∆∞·ªõc) ‚Üí D·∫•u hi·ªáu th√¨ **Qu√° kh·ª© ƒë∆°n**. C√¢u ph·ªß ƒë·ªãnh c·ªßa qu√° kh·ª© ƒë∆°n d√πng tr·ª£ t·ª´ 'didn't'.",
                wrongReason: "A, B l√† hi·ªán t·∫°i. D l√† t∆∞∆°ng lai."
            }
        },
        {
            question: "They ______ in this house for 10 years.",
            options: ["A. live", "B. lived", "C. are living", "D. have lived"],
            correct: 3,
            explanation: {
                vocab: [
                    "A. live (HTƒê)",
                    "B. lived (QKƒê)",
                    "C. are living (HTTD)",
                    "D. have lived (HTHT)"
                ],
                trans: "H·ªç ƒë√£ s·ªëng ·ªü ng√¥i nh√† n√†y ƒë∆∞·ª£c 10 nƒÉm r·ªìi.",
                correctReason: "C√≥ 'for 10 years' (ƒë∆∞·ª£c 10 nƒÉm) ‚Üí D·∫•u hi·ªáu th√¨ **Hi·ªán t·∫°i ho√†n th√†nh** (h√†nh ƒë·ªông b·∫Øt ƒë·∫ßu trong qu√° kh·ª© v√† k√©o d√†i ƒë·∫øn hi·ªán t·∫°i).",
                wrongReason: "A, C ch·ªâ hi·ªán t·∫°i. B ch·ªâ qu√° kh·ª© ƒë√£ ch·∫•m d·ª©t."
            }
        },
        {
            question: "Be quiet! The baby ______.",
            options: ["A. sleep", "B. sleeps", "C. is sleeping", "D. slept"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. sleep (v): ng·ªß",
                    "B. sleeps (v): ng·ªß (s·ªë √≠t)",
                    "C. is sleeping (v): ƒëang ng·ªß",
                    "D. slept (v): ƒë√£ ng·ªß"
                ],
                trans: "Tr·∫≠t t·ª± n√†o! Em b√© ƒëang ng·ªß.",
                correctReason: "C√≥ c√¢u m·ªánh l·ªánh 'Be quiet!' (Tr·∫≠t t·ª± ƒëi!) ‚Üí C·∫£nh b√°o m·ªôt h√†nh ƒë·ªông ƒëang di·ªÖn ra ‚Üí **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                wrongReason: "A, B ch·ªâ th√≥i quen. D l√† qu√° kh·ª©."
            }
        },
        {
            question: "Tom ______ to school by bus every day.",
            options: ["A. go", "B. goes", "C. going", "D. went"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. go (nguy√™n th·ªÉ)",
                    "B. goes (th√™m es)",
                    "C. going (V-ing)",
                    "D. went (qu√° kh·ª©)"
                ],
                trans: "Tom ƒëi h·ªçc b·∫±ng xe bu√Ωt m·ªói ng√†y.",
                correctReason: "C√≥ 'every day' ‚Üí Th√≥i quen ·ªü hi·ªán t·∫°i ‚Üí **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'Tom' (s·ªë √≠t) n√™n ƒë·ªông t·ª´ 'go' th√™m 'es' th√†nh 'goes'.",
                wrongReason: "A sai ng√¥i. C thi·∫øu tobe. D sai th√¨."
            }
        },
        {
            question: "I think it ______ rain tomorrow.",
            options: ["A. rains", "B. rained", "C. is raining", "D. will"],
            correct: 3,
            explanation: {
                vocab: [
                    "A. rains (HTƒê)",
                    "B. rained (QKƒê)",
                    "C. is raining (HTTD)",
                    "D. will (TLƒê - thi·∫øu 'rain' nh∆∞ng trong tr·∫Øc nghi·ªám ƒë√¥i khi vi·∫øt t·∫Øt, ·ªü ƒë√¢y ƒë·∫ßy ƒë·ªß l√† 'will rain' nh∆∞ng ƒë·ªÅ b√†i ch·ªâ c·∫ßn ƒëi·ªÅn tr·ª£ t·ª´ ho·∫∑c ƒë·ªÅ b√†i c√≥ l·ªói nh·ªè? √Ä kh√¥ng, ƒë·ªÅ b√†i l√† '... rain', v·∫≠y ch·ªó tr·ªëng c·∫ßn ƒëi·ªÅn tr·ª£ t·ª´)",
                ],
                // Correction for context: The blank needs an auxiliary verb or modal.
                // Re-analyzing options: If the blank is before "rain" (verb), D is "will". 
                trans: "T·ªõ nghƒ© ng√†y mai tr·ªùi s·∫Ω m∆∞a.",
                correctReason: "C√≥ 'tomorrow' v√† 'I think' (d·ª± ƒëo√°n) ‚Üí **T∆∞∆°ng lai ƒë∆°n**. C·∫•u tr√∫c: will + V_nguy√™n_th·ªÉ.",
                wrongReason: "A, B sai th√¨. C sai c·∫•u tr√∫c (is raining rain? -> sai)."
            }
        },
        {
            question: "______ she play badminton yesterday?",
            options: ["A. Do", "B. Does", "C. Did", "D. Will"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. Do (HTƒê)",
                    "B. Does (HTƒê s·ªë √≠t)",
                    "C. Did (QKƒê)",
                    "D. Will (TLƒê)"
                ],
                trans: "C√¥ ·∫•y c√≥ ch∆°i c·∫ßu l√¥ng h√¥m qua kh√¥ng?",
                correctReason: "C√≥ 'yesterday' (h√¥m qua) ‚Üí C√¢u h·ªèi **Qu√° kh·ª© ƒë∆°n**. Tr·ª£ t·ª´ ƒë·∫£o l√™n ƒë·∫ßu l√† 'Did'.",
                wrongReason: "A, B l√† hi·ªán t·∫°i. D l√† t∆∞∆°ng lai."
            }
        },
        {
            question: "We ______ just ______ our dinner.",
            options: ["A. have / eat", "B. have / eaten", "C. did / eat", "D. are / eating"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. have/eat (sai V3)",
                    "B. have/eaten (HT ho√†n th√†nh)",
                    "C. did/eat (Qu√° kh·ª©)",
                    "D. are/eating (Ti·∫øp di·ªÖn)"
                ],
                trans: "Ch√∫ng t·ªõ v·ª´a m·ªõi ƒÉn t·ªëi xong.",
                correctReason: "C√≥ t·ª´ 'just' n·∫±m gi·ªØa ‚Üí D·∫•u hi·ªáu **Hi·ªán t·∫°i ho√†n th√†nh**. C·∫•u tr√∫c: Have + just + V3 (eaten).",
                wrongReason: "A sai V3. C v√† D kh√¥ng d√πng v·ªõi 'just' ·ªü v·ªã tr√≠ n√†y mang nghƒ©a v·ª´a m·ªõi xong."
            }
        },
        {
            question: "Where ______ you last summer?",
            options: ["A. are", "B. do", "C. were", "D. was"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. are (tobe HT)",
                    "B. do (tr·ª£ t·ª´ th∆∞·ªùng)",
                    "C. were (tobe QK s·ªë nhi·ªÅu)",
                    "D. was (tobe QK s·ªë √≠t)"
                ],
                trans: "B·∫°n ƒë√£ ·ªü ƒë√¢u v√†o m√πa h√® tr∆∞·ªõc?",
                correctReason: "C√≥ 'last summer' ‚Üí Qu√° kh·ª©. Ch·ªß ng·ªØ 'you' ƒëi v·ªõi ƒë·ªông t·ª´ tobe qu√° kh·ª© s·ªë nhi·ªÅu l√† 'were'.",
                wrongReason: "A l√† hi·ªán t·∫°i. B l√† ƒë·ªông t·ª´ th∆∞·ªùng. D d√πng cho ng√¥i s·ªë √≠t (I, He, She, It)."
            }
        },
        {
            question: "Listen! Someone ______ the piano.",
            options: ["A. plays", "B. played", "C. is playing", "D. has played"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. plays (HTƒê)",
                    "B. played (QKƒê)",
                    "C. is playing (HTTD)",
                    "D. has played (HTHT)"
                ],
                trans: "Nghe k√¨a! Ai ƒë√≥ ƒëang ch∆°i ƒë√†n piano.",
                correctReason: "C√≥ 'Listen!' (Nghe k√¨a!) ‚Üí D·∫•u hi·ªáu **Hi·ªán t·∫°i ti·∫øp di·ªÖn**. H√†nh ƒë·ªông ƒëang x·∫£y ra.",
                wrongReason: "A ch·ªâ th√≥i quen. B, D sai ng·ªØ c·∫£nh ƒëang di·ªÖn ra."
            }
        },
        {
            question: "My mom ______ buy a new bike for me next month.",
            options: ["A. will", "B. is", "C. did", "D. does"],
            correct: 0,
            explanation: {
                vocab: [
                    "A. will (s·∫Ω)",
                    "B. is (th√¨)",
                    "C. did (ƒë√£)",
                    "D. does (l√†m)"
                ],
                trans: "M·∫π t·ªõ s·∫Ω mua m·ªôt chi·∫øc xe ƒë·∫°p m·ªõi cho t·ªõ v√†o th√°ng sau.",
                correctReason: "C√≥ 'next month' (th√°ng sau) ‚Üí **T∆∞∆°ng lai ƒë∆°n**. C·∫•u tr√∫c: will + V (buy).",
                wrongReason: "B c·∫ßn V-ing. C l√† qu√° kh·ª©. D l√† hi·ªán t·∫°i ƒë∆°n."
            }
        },
        {
            question: "She never ______ coffee.",
            options: ["A. drink", "B. drinks", "C. is drinking", "D. drank"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. drink (v): u·ªëng",
                    "B. drinks (v): u·ªëng (s·ªë √≠t)",
                    "C. is drinking (v): ƒëang u·ªëng",
                    "D. drank (v): ƒë√£ u·ªëng"
                ],
                trans: "C√¥ ·∫•y kh√¥ng bao gi·ªù u·ªëng c√† ph√™.",
                correctReason: "C√≥ 'never' (kh√¥ng bao gi·ªù) ch·ªâ t·∫ßn su·∫•t ‚Üí **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'She' n√™n ƒë·ªông t·ª´ th√™m 's'.",
                wrongReason: "A thi·∫øu 's'. C di·ªÖn t·∫£ ƒëang l√†m. D qu√° kh·ª©."
            }
        },
        {
            question: "I ______ that movie 3 times.",
            options: ["A. see", "B. saw", "C. am seeing", "D. have seen"],
            correct: 3,
            explanation: {
                vocab: [
                    "A. see (HTƒê)",
                    "B. saw (QKƒê)",
                    "C. am seeing (HTTD)",
                    "D. have seen (HTHT)"
                ],
                trans: "T·ªõ ƒë√£ xem b·ªô phim ƒë√≥ 3 l·∫ßn r·ªìi.",
                correctReason: "C√≥ s·ªë l·∫ßn th·ª±c hi·ªán h√†nh ƒë·ªông '3 times' ‚Üí D·∫•u hi·ªáu ƒë·∫∑c tr∆∞ng c·ªßa **Hi·ªán t·∫°i ho√†n th√†nh**.",
                wrongReason: "A, C sai th√¨. B d√πng khi c√≥ th·ªùi gian c·ª• th·ªÉ trong qu√° kh·ª©."
            }
        },
        {
            question: "What ______ you doing at the moment?",
            options: ["A. do", "B. are", "C. did", "D. will"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. do (tr·ª£ t·ª´ th∆∞·ªùng)",
                    "B. are (tobe)",
                    "C. did (QK)",
                    "D. will (TL)"
                ],
                trans: "B·∫°n ƒëang l√†m g√¨ v√†o l√∫c n√†y?",
                correctReason: "C√≥ 'at the moment' (l√∫c n√†y) v√† ƒë·ªông t·ª´ ƒëu√¥i -ing (doing) ‚Üí **Hi·ªán t·∫°i ti·∫øp di·ªÖn**. C·∫•u tr√∫c: What + be + S + V-ing?",
                wrongReason: "A, C, D kh√¥ng ƒëi v·ªõi V-ing trong c·∫•u tr√∫c n√†y."
            }
        },
        {
            question: "They ______ not go to the cinema yesterday.",
            options: ["A. do", "B. does", "C. did", "D. will"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. do (HTƒê)",
                    "B. does (HTƒê)",
                    "C. did (QKƒê)",
                    "D. will (TLƒê)"
                ],
                trans: "H√¥m qua h·ªç ƒë√£ kh√¥ng ƒëi xem phim.",
                correctReason: "C√≥ 'yesterday' ‚Üí **Qu√° kh·ª© ƒë∆°n**. C√¢u ph·ªß ƒë·ªãnh d√πng tr·ª£ t·ª´ 'did' + not.",
                wrongReason: "A, B hi·ªán t·∫°i. D t∆∞∆°ng lai."
            }
        },
        {
            question: "He ______ English since 2015.",
            options: ["A. learns", "B. learned", "C. has learned", "D. is learning"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. learns (HTƒê)",
                    "B. learned (QKƒê)",
                    "C. has learned (HTHT)",
                    "D. is learning (HTTD)"
                ],
                trans: "Anh ·∫•y ƒë√£ h·ªçc ti·∫øng Anh t·ª´ nƒÉm 2015.",
                correctReason: "C√≥ 'since 2015' (t·ª´ nƒÉm 2015) ‚Üí M·ªëc th·ªùi gian b·∫Øt ƒë·∫ßu trong qu√° kh·ª© k√©o d√†i ƒë·∫øn nay ‚Üí **Hi·ªán t·∫°i ho√†n th√†nh**.",
                wrongReason: "A, D hi·ªán t·∫°i. B qu√° kh·ª© ƒë√£ ch·∫•m d·ª©t."
            }
        },
        {
            question: "Keep silent! The teacher ______.",
            options: ["A. talk", "B. talks", "C. talked", "D. is talking"],
            correct: 3,
            explanation: {
                vocab: [
                    "A. talk (v): n√≥i",
                    "B. talks (v): n√≥i (s·ªë √≠t)",
                    "C. talked (v): ƒë√£ n√≥i",
                    "D. is talking (v): ƒëang n√≥i"
                ],
                trans: "Gi·ªØ tr·∫≠t t·ª± n√†o! C√¥ gi√°o ƒëang n√≥i.",
                correctReason: "C√≥ 'Keep silent!' (Tr·∫≠t t·ª±!) ‚Üí C·∫£nh b√°o h√†nh ƒë·ªông ƒëang x·∫£y ra ‚Üí **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                wrongReason: "A, B th√≥i quen. C qu√° kh·ª©."
            }
        },
        {
            question: "______ you help me tomorrow?",
            options: ["A. Do", "B. Did", "C. Will", "D. Are"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. Do (HTƒê)",
                    "B. Did (QKƒê)",
                    "C. Will (TLƒê)",
                    "D. Are (HTTD)"
                ],
                trans: "B·∫°n s·∫Ω gi√∫p t·ªõ v√†o ng√†y mai ch·ª©?",
                correctReason: "C√≥ 'tomorrow' (ng√†y mai) ‚Üí **T∆∞∆°ng lai ƒë∆°n**. C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng 'Will'.",
                wrongReason: "A, B sai th·ªùi gian. D c·∫ßn V-ing."
            }
        },
        {
            question: "My sister always ______ her hands before meals.",
            options: ["A. wash", "B. washes", "C. washing", "D. washed"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. wash (nguy√™n th·ªÉ)",
                    "B. washes (th√™m es)",
                    "C. washing (V-ing)",
                    "D. washed (QK)"
                ],
                trans: "Em g√°i t·ªõ lu√¥n r·ª≠a tay tr∆∞·ªõc b·ªØa ƒÉn.",
                correctReason: "C√≥ 'always' (lu√¥n lu√¥n) ‚Üí Th√≥i quen **Hi·ªán t·∫°i ƒë∆°n**. Ch·ªß ng·ªØ 'My sister' (s·ªë √≠t) n√™n ch·ªçn 'washes'.",
                wrongReason: "A thi·∫øu es. C, D sai th√¨."
            }
        },
        {
            question: "We ______ play video games last night.",
            options: ["A. didn't", "B. don't", "C. doesn't", "D. won't"],
            correct: 0,
            explanation: {
                vocab: [
                    "A. didn't (QKƒê)",
                    "B. don't (HTƒê)",
                    "C. doesn't (HTƒê s·ªë √≠t)",
                    "D. won't (TLƒê)"
                ],
                trans: "Ch√∫ng t·ªõ ƒë√£ kh√¥ng ch∆°i ƒëi·ªán t·ª≠ t·ªëi qua.",
                correctReason: "C√≥ 'last night' (t·ªëi qua) ‚Üí **Qu√° kh·ª© ƒë∆°n**. Ph·ªß ƒë·ªãnh d√πng 'didn't'.",
                wrongReason: "B, C hi·ªán t·∫°i. D t∆∞∆°ng lai."
            }
        },
        {
            question: "Look at the clouds! It ______ rain.",
            options: ["A. is going to", "B. will", "C. did", "D. are going to"],
            correct: 0,
            explanation: {
                vocab: [
                    "A. is going to (s·∫Øp s·ª≠a - c√≥ cƒÉn c·ª©)",
                    "B. will (s·∫Ω - ph·ªèng ƒëo√°n)",
                    "C. did (ƒë√£)",
                    "D. are going to (sai ng√¥i)"
                ],
                trans: "Nh√¨n m√¢y k√¨a! Tr·ªùi s·∫Øp m∆∞a r·ªìi.",
                correctReason: "C√≥ d·∫´n ch·ª©ng c·ª• th·ªÉ 'Look at the clouds' (Nh√¨n m√¢y k√¨a) ‚Üí T∆∞∆°ng lai g·∫ßn (Be going to) di·ªÖn t·∫£ d·ª± ƒëo√°n c√≥ cƒÉn c·ª©. 'It' ƒëi v·ªõi 'is'.",
                wrongReason: "B d√πng khi kh√¥ng c√≥ cƒÉn c·ª© r√µ r√†ng. C qu√° kh·ª©. D sai ng√¥i."
            }
        },
        {
            question: "I ______ my keys. Can you help me find them?",
            options: ["A. lose", "B. lost", "C. have lost", "D. am losing"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. lose (HTƒê)",
                    "B. lost (QKƒê)",
                    "C. have lost (HTHT)",
                    "D. am losing (HTTD)"
                ],
                trans: "T·ªõ v·ª´a l√†m m·∫•t ch√¨a kh√≥a. B·∫°n t√¨m gi√∫p t·ªõ ƒë∆∞·ª£c kh√¥ng?",
                correctReason: "H√†nh ƒë·ªông m·∫•t ch√¨a kh√≥a ƒë√£ x·∫£y ra nh∆∞ng h·∫≠u qu·∫£ c√≤n ·ªü hi·ªán t·∫°i (ch∆∞a t√¨m th·∫•y) ‚Üí **Hi·ªán t·∫°i ho√†n th√†nh**.",
                wrongReason: "A th√≥i quen. B d√πng khi k·ªÉ l·∫°i chuy·ªán c≈© ƒë√£ xong. D ƒëang m·∫•t (v√¥ l√Ω)."
            }
        },
        {
            question: "While I was reading, my mom ______ in.",
            options: ["A. come", "B. comes", "C. came", "D. coming"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. come (HT)",
                    "B. comes (HT s·ªë √≠t)",
                    "C. came (QK)",
                    "D. coming (V-ing)"
                ],
                trans: "Khi t·ªõ ƒëang ƒë·ªçc s√°ch th√¨ m·∫π t·ªõ b∆∞·ªõc v√†o.",
                correctReason: "H√†nh ƒë·ªông c·∫Øt ngang m·ªôt h√†nh ƒë·ªông ƒëang di·ªÖn ra trong qu√° kh·ª© ‚Üí Chia **Qu√° kh·ª© ƒë∆°n** (came).",
                wrongReason: "A, B hi·ªán t·∫°i. D thi·∫øu tobe."
            }
        },
        {
            question: "They ______ soccer right now.",
            options: ["A. play", "B. played", "C. are playing", "D. have played"],
            correct: 2,
            explanation: {
                vocab: [
                    "A. play (HTƒê)",
                    "B. played (QKƒê)",
                    "C. are playing (HTTD)",
                    "D. have played (HTHT)"
                ],
                trans: "H·ªç ƒëang ƒë√° b√≥ng ngay l√∫c n√†y.",
                correctReason: "C√≥ 'right now' (ngay b√¢y gi·ªù) ‚Üí **Hi·ªán t·∫°i ti·∫øp di·ªÖn**.",
                wrongReason: "A th√≥i quen. B qu√° kh·ª©. D ho√†n th√†nh."
            }
        },
        {
            question: "When I was a baby, I ______ cry a lot.",
            options: ["A. use to", "B. used to", "C. am used to", "D. use"],
            correct: 1,
            explanation: {
                vocab: [
                    "A. use to (sai ch√≠nh t·∫£)",
                    "B. used to (ƒë√£ t·ª´ng)",
                    "C. am used to (quen v·ªõi)",
                    "D. use (s·ª≠ d·ª•ng)"
                ],
                trans: "Khi t·ªõ c√≤n b√©, t·ªõ ƒë√£ t·ª´ng kh√≥c r·∫•t nhi·ªÅu.",
                correctReason: "C·∫•u tr√∫c 'used to + V' di·ªÖn t·∫£ th√≥i quen trong qu√° kh·ª© nay kh√¥ng c√≤n n·ªØa.",
                wrongReason: "A sai (thi·∫øu d). C nghƒ©a l√† quen v·ªõi vi·ªác g√¨ ƒë√≥. D sai nghƒ©a."
            }
        }
    ];

    // --- GAME LOGIC ---

    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let userAnswers = [];
    
    // Audio files (Simple short sounds using standardized CDN links for reliability)
    const soundCorrect = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
    const soundWrong = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
    const soundFinish = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');

    // Shuffle Algorithm (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // Initialize Quiz
    function initQuiz() {
        // Clone and shuffle questions
        questions = [...rawQuestions];
        shuffleArray(questions);
        currentQuestionIndex = 0;
        score = 0;
        document.getElementById('q-total').innerText = questions.length;
        loadQuestion();
    }

    // Load Question
    function loadQuestion() {
        if (currentQuestionIndex >= questions.length) {
            showResult();
            return;
        }

        // Update Progress
        const progressPercent = ((currentQuestionIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progressPercent}%`;
        
        // Reset UI
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('explanation-container').style.display = 'none';
        document.getElementById('explanation-container').style.animation = 'none';
        
        const currentQ = questions[currentQuestionIndex];
        
        // Render Text
        document.getElementById('q-current').innerText = currentQuestionIndex + 1;
        document.getElementById('question-text').innerText = currentQ.question;
        
        // Render Options
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';
        
        currentQ.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsContainer.appendChild(btn);
        });
    }

    // Check Answer
    function checkAnswer(selectedIndex, btnElement) {
        const currentQ = questions[currentQuestionIndex];
        const correctIndex = currentQ.correct;
        const allBtns = document.querySelectorAll('.option-btn');

        // Disable all buttons
        allBtns.forEach(btn => btn.disabled = true);

        // Highlight Logic
        if (selectedIndex === correctIndex) {
            // CORRECT
            btnElement.classList.add('correct');
            score++;
            soundCorrect.currentTime = 0;
            soundCorrect.play();
            triggerConfetti();
        } else {
            // WRONG
            btnElement.classList.add('wrong');
            allBtns[correctIndex].classList.add('correct'); // Show correct answer
            soundWrong.currentTime = 0;
            soundWrong.play();
        }

        // Show Explanation immediately
        renderExplanation(currentQ, selectedIndex === correctIndex);
        
        // Show Next Button
        document.getElementById('next-btn').style.display = 'block';
    }

    // Render Explanation
    function renderExplanation(qData, isCorrect) {
        const expContainer = document.getElementById('explanation-container');
        const expContent = document.getElementById('exp-content');
        
        // Build Vocab List HTML
        let vocabHTML = '<ul class="vocab-list">';
        qData.explanation.vocab.forEach(v => {
            vocabHTML += `<li>üìå ${v}</li>`;
        });
        vocabHTML += '</ul>';

        const statusBadge = isCorrect 
            ? `<span class="badge badge-correct">ƒê√öNG R·ªíI! üéâ</span>` 
            : `<span class="badge badge-wrong">TI·∫æC QU√Å! üòÖ</span>`;

        expContent.innerHTML = `
            <div class="exp-section">
                ${statusBadge}
                <strong>üìñ D·ªãch c√¢u h·ªèi:</strong>
                <em>"${qData.explanation.trans}"</em>
            </div>
            <div class="exp-section">
                <strong>üîç Ph√¢n t√≠ch t·ª´ v·ª±ng:</strong>
                ${vocabHTML}
            </div>
            <div class="exp-section" style="background: #e8f5e9; padding: 10px; border-radius: 8px;">
                <strong>‚úÖ T·∫°i sao ƒë√°p √°n ƒë√∫ng?</strong>
                ${qData.explanation.correctReason}
            </div>
            <div class="exp-section" style="background: #ffebee; padding: 10px; border-radius: 8px;">
                <strong>‚ùå T·∫°i sao c√°c c√¢u kia sai?</strong>
                ${qData.explanation.wrongReason}
            </div>
        `;

        expContainer.style.display = 'block';
        // Reset animation to play again
        setTimeout(() => {
            expContainer.style.animation = 'slideDown 0.5s ease-out';
        }, 10);
        
        // Scroll to explanation on mobile
        if(window.innerWidth < 600) {
            expContainer.scrollIntoView({behavior: "smooth", block: "start"});
        }
    }

    // Next Question
    function nextQuestion() {
        currentQuestionIndex++;
        loadQuestion();
    }

    // Confetti Effect
    function triggerConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#00C9A7', '#8854C0', '#FF4757', '#FFD700']
        });
    }

    // Show Result
    function showResult() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('final-score').innerText = `${score}/${questions.length}`;
        soundFinish.play();
        triggerConfetti(); // Big confetti for finish

        let msg = "";
        if (score === questions.length) msg = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng·ªØ ph√°p! üèÜ";
        else if (score >= 25) msg = "R·∫•t gi·ªèi! Em n·∫Øm b√†i r·∫•t ch·∫Øc! üåü";
        else if (score >= 15) msg = "Kh√° t·ªët! C·ªë g·∫Øng √¥n t·∫≠p th√™m ch√∫t n·ªØa nh√©! üí™";
        else msg = "ƒê·ª´ng bu·ªìn! H√£y xem l·∫°i gi·∫£i th√≠ch v√† l√†m l·∫°i nh√©! üå±";
        
        document.getElementById('final-msg').innerText = msg;
    }

    // Start
    initQuiz();

</script>

</body>
</html>