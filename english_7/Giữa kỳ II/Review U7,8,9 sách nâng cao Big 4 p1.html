<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BÃ i Kiá»ƒm Tra Tiáº¿ng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* Há»“ng nháº¡t / TÃ­m Pastel */
            --secondary: #00C9A7; /* Xanh ngá»c */
            --correct: #00D26A; /* Xanh lÃ¡ */
            --correct-shadow: #00A653;
            --wrong: #FF4757; /* Äá» cam */
            --wrong-shadow: #D83A46;
            --btn-shadow: #00A085;
            --bg-color: #F8F9FA;
            --text-dark: #2D3436;
        }

        * {
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }

        body {
            background-color: #f0e6ff;
            background-image: radial-gradient(#d5bbf2 20%, transparent 20%), radial-gradient(#d5bbf2 20%, transparent 20%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 15px 40px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 3px solid var(--primary);
        }

        .header h5 {
            margin: 0;
            color: var(--primary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header h1 {
            margin: 5px 0 0 0;
            color: var(--text-dark);
            font-size: 28px;
            font-weight: 900;
        }

        .quiz-container {
            width: 100%;
            max-width: 800px;
        }

        .section-title {
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 20px;
            box-shadow: 0 6px 0 #6A3A9E;
            text-align: center;
        }

        .card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.05);
            border: 2px solid #E2E8F0;
            position: relative;
        }

        .question-text {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 25px;
            color: var(--text-dark);
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 18px;
            padding: 18px 25px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 0 var(--btn-shadow);
            transition: all 0.15s ease;
            text-align: left;
            position: relative;
            outline: none;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.03) translateY(-2px);
            box-shadow: 0 10px 0 var(--btn-shadow);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(6px);
            box-shadow: 0 2px 0 var(--btn-shadow);
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .option-btn.correct {
            background-color: var(--correct) !important;
            box-shadow: 0 6px 0 var(--correct-shadow) !important;
            transform: translateY(2px);
        }

        .option-btn.wrong {
            background-color: var(--wrong) !important;
            box-shadow: 0 6px 0 var(--wrong-shadow) !important;
            transform: translateY(2px);
        }

        /* Input for Rewrite Sentences */
        .type-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 18px;
            border: 3px solid #E2E8F0;
            border-radius: 15px;
            outline: none;
            transition: border-color 0.3s;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
        }

        .type-input:focus {
            border-color: var(--primary);
        }

        .check-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #6A3A9E;
            margin-top: 15px;
            transition: all 0.1s;
        }

        .check-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #6A3A9E;
        }

        /* Explanation Box */
        .explanation {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background-color: #FFFBEA;
            border: 2px dashed #F1C40F;
            border-radius: 15px;
            font-size: 16px;
            line-height: 1.6;
            animation: fadeIn 0.5s;
        }

        .explanation h4 {
            color: #E67E22;
            margin-top: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .explanation li {
            margin-bottom: 8px;
        }

        .submit-btn {
            background-color: #FDCB6E;
            color: #2D3436;
            border: none;
            border-radius: 20px;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: 900;
            cursor: pointer;
            box-shadow: 0 8px 0 #E1B12C;
            margin: 20px auto 50px auto;
            display: block;
            transition: all 0.1s;
        }
        
        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #E1B12C;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-content h2 {
            font-size: 32px;
            color: var(--primary);
            margin-top: 0;
        }
        .modal-content .score {
            font-size: 60px;
            font-weight: 900;
            color: var(--secondary);
            margin: 10px 0;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-8px); }
            40%, 80% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.4s ease-in-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            z-index: 999;
            pointer-events: none;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }
    </style>
</head>
<body>

    <div class="header">
        <h5>GiÃ¡o viÃªn táº¡o: Ms Mai An ULIS</h5>
        <h1>English Challenge! ğŸš€</h1>
    </div>

    <div class="quiz-container" id="quiz-container">
        </div>

    <button class="submit-btn" onclick="submitQuiz()">Ná»™p BÃ i & Xem Äiá»ƒm</button>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>HoÃ n thÃ nh! ğŸ‰</h2>
            <div class="score" id="score-display">0/30</div>
            <p id="praise-message" style="font-size: 20px; font-weight: bold; color: var(--text-dark);"></p>
            <button class="option-btn" style="width: 100%; margin-top: 20px; text-align: center;" onclick="closeModal()">Xem láº¡i bÃ i</button>
        </div>
    </div>

<script>
// --- AUDIO SYSTEM (Web Audio API - No external files needed) ---
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playDing() {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
    gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.5);
}

function playBuzzer() {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(150, audioCtx.currentTime);
    osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
    osc.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.3);
}

// --- CONFETTI SYSTEM ---
function fireConfetti() {
    const colors = ['#00D26A', '#FF4757', '#FDCB6E', '#00C9A7', '#8854C0'];
    for (let i = 0; i < 40; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.top = '-10px';
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
    }
}

// --- DATA ---
const quizData = [
    { section: "Part 2: Choose the correct answer." },
    {
        id: 1, type: "mcq",
        question: "My aunt and uncle are going to Ho Chi Minh City _________ March.",
        options: [
            { text: "on", trans: "vÃ o (dÃ¹ng cho thá»©/ngÃ y)", isCorrect: false },
            { text: "in", trans: "vÃ o (dÃ¹ng cho thÃ¡ng/nÄƒm/mÃ¹a)", isCorrect: true },
            { text: "at", trans: "lÃºc (dÃ¹ng cho giá»/dá»‹p lá»…)", isCorrect: false },
            { text: "to", trans: "Ä‘áº¿n (chá»‰ phÆ°Æ¡ng hÆ°á»›ng)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> CÃ´ chÃº cá»§a tÃ´i sáº½ Ä‘i TP.HCM vÃ o thÃ¡ng Ba.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'in'. Trong tiáº¿ng Anh, Ä‘i vá»›i 'thÃ¡ng' (March) ta luÃ´n dÃ¹ng giá»›i tá»« 'in' (VÃ­ dá»¥: in March, in 2023).<br><b>Táº¡i sao SAI:</b> 'on' dÃ¹ng cho ngÃ y cá»¥ thá»ƒ (on Monday); 'at' dÃ¹ng cho giá» (at 6 AM); 'to' khÃ´ng pháº£i giá»›i tá»« chá»‰ thá»i gian trong trÆ°á»ng há»£p nÃ y."
    },
    {
        id: 2, type: "mcq",
        question: "My father _________ on a farm when he was a young boy.",
        options: [
            { text: "lives", trans: "sá»‘ng (Hiá»‡n táº¡i Ä‘Æ¡n)", isCorrect: false },
            { text: "lived", trans: "Ä‘Ã£ sá»‘ng (QuÃ¡ khá»© Ä‘Æ¡n)", isCorrect: true },
            { text: "uses to live", trans: "sai ngá»¯ phÃ¡p (pháº£i lÃ  used to)", isCorrect: false },
            { text: "was living", trans: "Ä‘ang sá»‘ng (QuÃ¡ khá»© tiáº¿p diá»…n)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Bá»‘ tÃ´i Ä‘Ã£ sá»‘ng á»Ÿ má»™t nÃ´ng tráº¡i khi Ã´ng cÃ²n lÃ  má»™t cáº­u bÃ©.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'lived'. Má»‡nh Ä‘á» 'when he was a young boy' chá»‰ má»™t sá»± viá»‡c Ä‘Ã£ xáº£y ra vÃ  cháº¥m dá»©t trong quÃ¡ khá»©, nÃªn ta dÃ¹ng thÃ¬ QuÃ¡ khá»© Ä‘Æ¡n.<br><b>Táº¡i sao SAI:</b> 'lives' lÃ  hiá»‡n táº¡i; 'uses to live' sai cáº¥u trÃºc (chÃ­nh xÃ¡c lÃ  used to live); 'was living' nháº¥n máº¡nh tÃ­nh tiáº¿p diá»…n táº¡i 1 thá»i Ä‘iá»ƒm cá»¥ thá»ƒ trong QK, khÃ´ng phÃ¹ há»£p báº±ng QK Ä‘Æ¡n á»Ÿ Ä‘Ã¢y."
    },
    {
        id: 3, type: "mcq",
        question: "How far _________ from her house to his shops?",
        options: [
            { text: "is it", trans: "lÃ  nÃ³ (chá»§ ngá»¯ giáº£ chá»‰ khoáº£ng cÃ¡ch)", isCorrect: true },
            { text: "are they", trans: "lÃ  chÃºng (sá»‘ nhiá»u)", isCorrect: false },
            { text: "is he", trans: "lÃ  anh áº¥y", isCorrect: false },
            { text: "is she", trans: "lÃ  cÃ´ áº¥y", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Khoáº£ng cÃ¡ch tá»« nhÃ  cÃ´ áº¥y Ä‘áº¿n cá»­a hÃ ng cá»§a anh áº¥y lÃ  bao xa?<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'is it'. Cáº¥u trÃºc há»i khoáº£ng cÃ¡ch cá»‘ Ä‘á»‹nh trong tiáº¿ng Anh lÃ : 'How far is it from A to B?'. 'It' á»Ÿ Ä‘Ã¢y lÃ  chá»§ ngá»¯ giáº£ chá»‰ khoáº£ng cÃ¡ch.<br><b>Táº¡i sao SAI:</b> KhÃ´ng dÃ¹ng Ä‘áº¡i tá»« nhÃ¢n xÆ°ng (he/she/they) Ä‘á»ƒ há»i vá» khoáº£ng cÃ¡ch khÃ´ng gian."
    },
    {
        id: 4, type: "mcq",
        question: "Many people are walking _________ the weather is bad these day.",
        options: [
            { text: "so", trans: "vÃ¬ váº­y (chá»‰ káº¿t quáº£)", isCorrect: false },
            { text: "since", trans: "bá»Ÿi vÃ¬ (chá»‰ nguyÃªn nhÃ¢n)", isCorrect: false },
            { text: "although", trans: "máº·c dÃ¹ (chá»‰ sá»± nhÆ°á»£ng bá»™)", isCorrect: true },
            { text: "because", trans: "bá»Ÿi vÃ¬ (chá»‰ nguyÃªn nhÃ¢n)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Nhiá»u ngÆ°á»i Ä‘ang Ä‘i bá»™ máº·c dÃ¹ thá»i tiáº¿t nhá»¯ng ngÃ y nÃ y ráº¥t xáº¥u.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'although'. Hai váº¿ cÃ¢u mang Ã½ nghÄ©a Ä‘á»‘i láº­p nhau (Ä‘i bá»™ ngoÃ i trá»i >< thá»i tiáº¿t xáº¥u). 'Although' + má»‡nh Ä‘á» lÃ  cáº¥u trÃºc chuáº©n xÃ¡c.<br><b>Táº¡i sao SAI:</b> Náº¿u dÃ¹ng 'since/because' (bá»Ÿi vÃ¬) hoáº·c 'so' (vÃ¬ váº­y) thÃ¬ cÃ¢u sáº½ trá»Ÿ nÃªn vÃ´ lÃ½ vá» máº·t Ã½ nghÄ©a."
    },
    {
        id: 5, type: "mcq",
        question: "The film was made many years ago. _________, many people have enjoyed seeing it.",
        options: [
            { text: "However", trans: "Tuy nhiÃªn", isCorrect: false },
            { text: "Nevertheless", trans: "Tuy nhiÃªn / Dáº«u váº­y", isCorrect: false },
            { text: "A & B are correct", trans: "Cáº£ A vÃ  B Ä‘á»u Ä‘Ãºng", isCorrect: true },
            { text: "A & B are incorrect", trans: "Cáº£ A vÃ  B Ä‘á»u sai", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Bá»™ phim Ä‘Æ°á»£c lÃ m tá»« nhiá»u nÄƒm trÆ°á»›c. Tuy nhiÃªn, nhiá»u ngÆ°á»i váº«n thÃ­ch xem nÃ³.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'A & B are correct'. Cáº£ 'However' vÃ  'Nevertheless' Ä‘á»u lÃ  tráº¡ng tá»« liÃªn káº¿t mang nghÄ©a 'tuy nhiÃªn', dÃ¹ng Ä‘á»ƒ ná»‘i 2 cÃ¢u cÃ³ Ã½ nghÄ©a trÃ¡i ngÆ°á»£c nhau, thÆ°á»ng Ä‘á»©ng sau dáº¥u cháº¥m vÃ  trÆ°á»›c dáº¥u pháº©y.<br><b>Táº¡i sao SAI:</b> VÃ¬ cáº£ A vÃ  B Ä‘á»u sá»­ dá»¥ng Ä‘Ãºng ngá»¯ phÃ¡p vÃ  ngá»¯ nghÄ©a nÃªn chá»n C."
    },
    {
        id: 6, type: "mcq",
        question: "_________ you need two kilos of pork, Madam?",
        options: [
            { text: "How much", trans: "Bao nhiÃªu (há»i sá»‘ lÆ°á»£ng)", isCorrect: false },
            { text: "Do", trans: "Trá»£ Ä‘á»™ng tá»« (cho I/you/we/they)", isCorrect: true },
            { text: "Does", trans: "Trá»£ Ä‘á»™ng tá»« (cho he/she/it)", isCorrect: false },
            { text: "Are", trans: "Äá»™ng tá»« to-be", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> BÃ  cÃ³ cáº§n 2 cÃ¢n thá»‹t lá»£n khÃ´ng, thÆ°a bÃ ?<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'Do'. ÄÃ¢y lÃ  cÃ¢u há»i Yes/No á»Ÿ thÃ¬ Hiá»‡n táº¡i Ä‘Æ¡n. Äá»™ng tá»« chÃ­nh lÃ  'need' (Ä‘á»™ng tá»« thÆ°á»ng), chá»§ ngá»¯ lÃ  'you', nÃªn ta mÆ°á»£n trá»£ Ä‘á»™ng tá»« 'Do' Ä‘áº£o lÃªn Ä‘áº§u cÃ¢u.<br><b>Táº¡i sao SAI:</b> 'How much' khÃ´ng há»£p vÃ¬ cÃ¢u Ä‘Ã£ cÃ³ sá»‘ lÆ°á»£ng (two kilos); 'Does' sai chá»§ ngá»¯; 'Are' lÃ  to-be, khÃ´ng Ä‘i vá»›i Ä‘á»™ng tá»« thÆ°á»ng 'need' (trá»« khi lÃ  V-ing)."
    },
    {
        id: 7, type: "mcq",
        question: "How did he feel _________ first?",
        options: [
            { text: "at", trans: "táº¡i", isCorrect: true },
            { text: "in", trans: "trong", isCorrect: false },
            { text: "on", trans: "trÃªn", isCorrect: false },
            { text: "from", trans: "tá»«", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Ban Ä‘áº§u anh áº¥y cáº£m tháº¥y tháº¿ nÃ o?<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'at'. Ta cÃ³ cá»¥m thÃ nh ngá»¯ (collocation) cá»‘ Ä‘á»‹nh: <b>at first</b> = ban Ä‘áº§u, lÃºc Ä‘áº§u.<br><b>Táº¡i sao SAI:</b> CÃ¡c giá»›i tá»« 'in, on, from' khÃ´ng káº¿t há»£p vá»›i 'first' Ä‘á»ƒ táº¡o thÃ nh nghÄ©a 'ban Ä‘áº§u' trong ngá»¯ cáº£nh nÃ y."
    },
    {
        id: 8, type: "mcq",
        question: "A lot of people like watching Titanic _________ it has an unhappy ending.",
        options: [
            { text: "however", trans: "tuy nhiÃªn (+ dáº¥u pháº©y)", isCorrect: false },
            { text: "despite", trans: "máº·c dÃ¹ (+ Noun/V-ing)", isCorrect: false },
            { text: "although", trans: "máº·c dÃ¹ (+ Má»‡nh Ä‘á»)", isCorrect: true },
            { text: "nevertheless", trans: "tuy nhiÃªn (+ dáº¥u pháº©y)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Nhiá»u ngÆ°á»i thÃ­ch xem Titanic máº·c dÃ¹ nÃ³ cÃ³ má»™t cÃ¡i káº¿t buá»“n.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'although'. PhÃ­a sau lÃ  má»™t má»‡nh Ä‘á» hoÃ n chá»‰nh (S = it, V = has), vÃ  hai váº¿ cÃ³ Ã½ nghÄ©a nhÆ°á»£ng bá»™ (thÃ­ch xem >< káº¿t buá»“n) nÃªn dÃ¹ng although.<br><b>Táº¡i sao SAI:</b> 'despite' + Danh tá»«/V-ing (á»Ÿ Ä‘Ã¢y lÃ  má»‡nh Ä‘á» nÃªn sai); 'however/nevertheless' lÃ  tráº¡ng tá»«, pháº£i Ä‘á»©ng sau dáº¥u cháº¥m vÃ  trÆ°á»›c dáº¥u pháº©y."
    },
    {
        id: 9, type: "mcq",
        question: "_________ does the festival take place? â€“ Every April.",
        options: [
            { text: "How long", trans: "Bao lÃ¢u (há»i khoáº£ng thá»i gian)", isCorrect: false },
            { text: "How far", trans: "Bao xa (há»i khoáº£ng cÃ¡ch)", isCorrect: false },
            { text: "How many", trans: "Bao nhiÃªu (há»i sá»‘ lÆ°á»£ng Ä‘áº¿m Ä‘Æ°á»£c)", isCorrect: false },
            { text: "How often", trans: "ThÆ°á»ng xuyÃªn tháº¿ nÃ o (há»i táº§n suáº¥t)", isCorrect: true }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Lá»… há»™i diá»…n ra thÆ°á»ng xuyÃªn nhÆ° tháº¿ nÃ o? - Má»—i thÃ¡ng TÆ°.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'How often'. CÃ¢u tráº£ lá»i lÃ  'Every April' (Má»—i thÃ¡ng 4 - chá»‰ táº§n suáº¥t láº·p láº¡i), do Ä‘Ã³ cÃ¢u há»i pháº£i dÃ¹ng 'How often'.<br><b>Táº¡i sao SAI:</b> Dá»±a vÃ o cÃ¢u tráº£ lá»i, ta loáº¡i trá»« ngay cÃ¡c tá»« Ä‘á»ƒ há»i vá» thá»i gian (how long), khoáº£ng cÃ¡ch (how far), sá»‘ lÆ°á»£ng (how many)."
    },
    {
        id: 10, type: "mcq",
        question: "We should wait here _________ our teacher comes back.",
        options: [
            { text: "before", trans: "trÆ°á»›c khi", isCorrect: false },
            { text: "after", trans: "sau khi", isCorrect: false },
            { text: "until", trans: "cho Ä‘áº¿n khi", isCorrect: true },
            { text: "during", trans: "trong suá»‘t", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> ChÃºng ta nÃªn Ä‘á»£i á»Ÿ Ä‘Ã¢y cho Ä‘áº¿n khi giÃ¡o viÃªn cá»§a chÃºng ta quay láº¡i.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'until'. 'Until' + má»‡nh Ä‘á» mang nghÄ©a chá» Ä‘á»£i sá»± viá»‡c gÃ¬ Ä‘Ã³ xáº£y ra, cá»±c ká»³ há»£p lÃ½ vá»›i Ä‘á»™ng tá»« 'wait'.<br><b>Táº¡i sao SAI:</b> 'before/after' sai logic ngá»¯ nghÄ©a (khÃ´ng ai báº£o: hÃ£y Ä‘á»£i á»Ÿ Ä‘Ã¢y trÆ°á»›c khi/sau khi cÃ´ giÃ¡o vá» cáº£); 'during' + Danh tá»« (trong khi phÃ­a sau lÃ  má»‡nh Ä‘á» nÃªn sai ngá»¯ phÃ¡p)."
    },
    {
        id: 11, type: "mcq",
        question: "_________ you have turkey on Thanksgiving?",
        options: [
            { text: "Do", trans: "Trá»£ Ä‘á»™ng tá»« (Ä‘i vá»›i you/we/they)", isCorrect: true },
            { text: "Does", trans: "Trá»£ Ä‘á»™ng tá»« (Ä‘i vá»›i he/she/it)", isCorrect: false },
            { text: "Are", trans: "Äá»™ng tá»« to-be", isCorrect: false },
            { text: "Is", trans: "Äá»™ng tá»« to-be", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Báº¡n cÃ³ Äƒn gÃ  tÃ¢y vÃ o ngÃ y Lá»… Táº¡ Æ n khÃ´ng?<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'Do'. CÃ¢u há»i cho thÃ³i quen/phong tá»¥c á»Ÿ thÃ¬ Hiá»‡n táº¡i Ä‘Æ¡n. Äá»™ng tá»« chÃ­nh 'have' (Äƒn), chá»§ ngá»¯ 'you' -> mÆ°á»£n trá»£ Ä‘á»™ng tá»« 'Do'.<br><b>Táº¡i sao SAI:</b> 'Does' Ä‘i vá»›i ngÃ´i thá»© 3 sá»‘ Ã­t; 'Are/Is' khÃ´ng dÃ¹ng Ä‘á»ƒ há»i cho Ä‘á»™ng tá»« thÆ°á»ng (have) trong thÃ¬ Hiá»‡n táº¡i Ä‘Æ¡n."
    },
    {
        id: 12, type: "mcq",
        question: "_________ is only a short walk from my house to school.",
        options: [
            { text: "It", trans: "NÃ³ (chá»§ ngá»¯ giáº£)", isCorrect: true },
            { text: "This", trans: "CÃ¡i nÃ y", isCorrect: false },
            { text: "That", trans: "CÃ¡i kia", isCorrect: false },
            { text: "There", trans: "CÃ³ (There is/are)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> Chá»‰ máº¥t má»™t quÃ£ng Ä‘i bá»™ ngáº¯n tá»« nhÃ  tÃ´i Ä‘áº¿n trÆ°á»ng.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'It'. TÆ°Æ¡ng tá»± cÃ¢u 3, trong tiáº¿ng Anh Ä‘á»ƒ nÃ³i vá» khoáº£ng cÃ¡ch, ta luÃ´n dÃ¹ng chá»§ ngá»¯ giáº£ 'It' (It is + khoáº£ng cÃ¡ch + from A to B).<br><b>Táº¡i sao SAI:</b> KhÃ´ng dÃ¹ng This/That Ä‘á»ƒ chá»‰ khoáº£ng cÃ¡ch nÃ³i chung; 'There is' mang nghÄ©a 'CÃ³ tá»“n táº¡i', khÃ´ng há»£p cáº¥u trÃºc khoáº£ng cÃ¡ch."
    },
    {
        id: 13, type: "mcq",
        question: "Several hundred people work together to make a film. The director, _________, is the most important person in a studio.",
        options: [
            { text: "although", trans: "máº·c dÃ¹", isCorrect: false },
            { text: "however", trans: "tuy nhiÃªn", isCorrect: true },
            { text: "but", trans: "nhÆ°ng", isCorrect: false },
            { text: "and", trans: "vÃ ", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> VÃ i trÄƒm ngÆ°á»i lÃ m viá»‡c cÃ¹ng nhau Ä‘á»ƒ táº¡o ra má»™t bá»™ phim. Tuy nhiÃªn, Ä‘áº¡o diá»…n lÃ  ngÆ°á»i quan trá»ng nháº¥t trong trÆ°á»ng quay.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'however'. Chá»‰ cÃ³ 'however' má»›i Ä‘Æ°á»£c phÃ©p Ä‘á»©ng giá»¯a hai dáº¥u pháº©y ( , however, ) Ä‘á»ƒ nháº¥n máº¡nh sá»± Ä‘á»‘i láº­p vá»›i cÃ¢u trÆ°á»›c Ä‘Ã³.<br><b>Táº¡i sao SAI:</b> 'although' ná»‘i 2 má»‡nh Ä‘á»; 'but / and' lÃ  liÃªn tá»«, khÃ´ng bao giá» bá»‹ káº¹p giá»¯a 2 dáº¥u pháº©y á»Ÿ giá»¯a cÃ¢u nhÆ° tháº¿ nÃ y."
    },
    {
        id: 14, type: "mcq",
        question: "_________ there a BRT station here?",
        options: [
            { text: "Were", trans: "To-be quÃ¡ khá»© sá»‘ nhiá»u", isCorrect: false },
            { text: "Was", trans: "To-be quÃ¡ khá»© sá»‘ Ã­t", isCorrect: true },
            { text: "Did", trans: "Trá»£ Ä‘á»™ng tá»« quÃ¡ khá»©", isCorrect: false },
            { text: "Are", trans: "To-be hiá»‡n táº¡i sá»‘ nhiá»u", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> ÄÃ£ tá»«ng cÃ³ má»™t tráº¡m xe buÃ½t nhanh (BRT) á»Ÿ Ä‘Ã¢y pháº£i khÃ´ng?<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'Was'. Cáº¥u trÃºc 'There is/are/was/were' mang nghÄ©a 'CÃ³'. Danh tá»« phÃ­a sau lÃ  'a BRT station' (sá»‘ Ã­t). NhÃ¬n vÃ o Ä‘Ã¡p Ã¡n khÃ´ng cÃ³ 'Is', nÃªn ta hiá»ƒu Ä‘Ã¢y lÃ  cÃ¢u há»i trong quÃ¡ khá»© -> DÃ¹ng 'Was'.<br><b>Táº¡i sao SAI:</b> 'Were/Are' dÃ¹ng cho sá»‘ nhiá»u; 'Did' lÃ  trá»£ Ä‘á»™ng tá»«, pháº£i Ä‘i kÃ¨m Ä‘á»™ng tá»« thÆ°á»ng (trong cÃ¢u nÃ y khÃ´ng cÃ³ Ä‘á»™ng tá»« thÆ°á»ng nÃ o)."
    },
    {
        id: 15, type: "mcq",
        question: "There are a lot of cars today. You shouldn't _________ so fast.",
        options: [
            { text: "drove", trans: "lÃ¡i xe (V-quÃ¡ khá»©)", isCorrect: false },
            { text: "drive", trans: "lÃ¡i xe (V-nguyÃªn thá»ƒ)", isCorrect: true },
            { text: "drives", trans: "lÃ¡i xe (V-thÃªm s)", isCorrect: false },
            { text: "driving", trans: "lÃ¡i xe (V-ing)", isCorrect: false }
        ],
        explanation: "<b>Dá»‹ch cÃ¢u há»i:</b> HÃ´m nay cÃ³ ráº¥t nhiá»u Ã´ tÃ´. Báº¡n khÃ´ng nÃªn lÃ¡i xe quÃ¡ nhanh.<br><b>Táº¡i sao ÄÃšNG:</b> ÄÃ¡p Ã¡n 'drive'. Cáº¥u trÃºc Modal Verb (Äá»™ng tá»« khuyáº¿t thiáº¿u): <b>Should / Shouldn't + Äá»™ng tá»« nguyÃªn thá»ƒ khÃ´ng to (V-inf)</b>.<br><b>Táº¡i sao SAI:</b> Táº¥t cáº£ cÃ¡c dáº¡ng chia Ä‘á»™ng tá»« khÃ¡c (quÃ¡ khá»©, thÃªm s, thÃªm ing) Ä‘á»u sai quy táº¯c ngá»¯ phÃ¡p Ä‘á»©ng sau 'shouldn't'."
    },
    { section: "Part 3: Turn these sentences into interrogative form. (Viáº¿t láº¡i thÃ nh cÃ¢u há»i)" },
    {
        id: 16, type: "rewrite",
        question: "We decided to go home early yesterday.",
        answer: "Did we decide to go home early yesterday?",
        altAnswer: "Did you decide to go home early yesterday?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> QuÃ¡ khá»© Ä‘Æ¡n (cÃ³ 'yesterday' vÃ  'decided').<br>- <b>CÃ¡ch lÃ m:</b> MÆ°á»£n trá»£ Ä‘á»™ng tá»« <b>Did</b> Ä‘áº·t lÃªn Ä‘áº§u cÃ¢u. Äá»™ng tá»« chÃ­nh 'decided' pháº£i tráº£ vá» nguyÃªn thá»ƒ lÃ  <b>decide</b>.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Did we/you decide to go home early yesterday?"
    },
    {
        id: 17, type: "rewrite",
        question: "We often played marbles when we were small.",
        answer: "Did we often play marbles when we were small?",
        altAnswer: "Did you often play marbles when you were small?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> QuÃ¡ khá»© Ä‘Æ¡n (played, were).<br>- <b>CÃ¡ch lÃ m:</b> Äáº·t <b>Did</b> lÃªn Ä‘áº§u cÃ¢u, Ä‘Æ°a 'played' vá» nguyÃªn thá»ƒ <b>play</b>. (LÆ°u Ã½: má»‡nh Ä‘á» sau 'when we were small' giá»¯ nguyÃªn).<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Did we often play marbles when we were small?"
    },
    {
        id: 18, type: "rewrite",
        question: "They do their homework after dinner.",
        answer: "Do they do their homework after dinner?",
        altAnswer: "",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch (Cáº©n tháº­n cÃ¢u nÃ y dá»… lá»«a!):</b><br>- <b>ThÃ¬:</b> Hiá»‡n táº¡i Ä‘Æ¡n. Tá»« 'do' trong cÃ¢u gá»‘c lÃ  Äá»˜NG Tá»ª CHÃNH (lÃ m bÃ i táº­p).<br>- <b>CÃ¡ch lÃ m:</b> Váº«n pháº£i mÆ°á»£n trá»£ Ä‘á»™ng tá»« <b>Do</b> Ä‘Æ°a lÃªn Ä‘áº§u cÃ¢u. Váº­y cÃ¢u sáº½ cÃ³ 2 chá»¯ 'do' (má»™t lÃ  trá»£ Ä‘á»™ng tá»«, hai lÃ  Ä‘á»™ng tá»« chÃ­nh).<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> <u>Do</u> they <u>do</u> their homework after dinner?"
    },
    {
        id: 19, type: "rewrite",
        question: "We have yoga class three times a week.",
        answer: "Do we have yoga class three times a week?",
        altAnswer: "Do you have yoga class three times a week?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> Hiá»‡n táº¡i Ä‘Æ¡n (have).<br>- <b>CÃ¡ch lÃ m:</b> Chá»§ ngá»¯ lÃ  'We', mÆ°á»£n trá»£ Ä‘á»™ng tá»« <b>Do</b> Ä‘áº£o lÃªn Ä‘áº§u. Äá»™ng tá»« 'have' giá»¯ nguyÃªn.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Do we/you have yoga class three times a week?"
    },
    {
        id: 20, type: "rewrite",
        question: "My favorite food is noodles.",
        answer: "Is your favorite food noodles?",
        altAnswer: "Is my favorite food noodles?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Äá»™ng tá»«:</b> To-be (is).<br>- <b>CÃ¡ch lÃ m:</b> Vá»›i Ä‘á»™ng tá»« to-be, ta KHÃ”NG mÆ°á»£n trá»£ Ä‘á»™ng tá»« mÃ  Ä‘áº£o trá»±c tiáº¿p to-be lÃªn trÆ°á»›c chá»§ ngá»¯. (NÃªn Ä‘á»•i 'My' thÃ nh 'Your' cho tá»± nhiÃªn).<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Is your favorite food noodles?"
    },
    {
        id: 21, type: "rewrite",
        question: "Susan told me the truth of the robbery.",
        answer: "Did Susan tell you the truth of the robbery?",
        altAnswer: "Did Susan tell me the truth of the robbery?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> QuÃ¡ khá»© Ä‘Æ¡n (told).<br>- <b>CÃ¡ch lÃ m:</b> MÆ°á»£n <b>Did</b>, tráº£ 'told' vá» nguyÃªn thá»ƒ lÃ  <b>tell</b>. Äá»•i 'me' thÃ nh 'you' Ä‘á»ƒ cÃ¢u há»i cÃ³ logic giao tiáº¿p.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Did Susan tell you the truth of the robbery?"
    },
    {
        id: 22, type: "rewrite",
        question: "We should take an umbrella when we go out.",
        answer: "Should we take an umbrella when we go out?",
        altAnswer: "Should you take an umbrella when you go out?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Äá»™ng tá»«:</b> Khuyáº¿t thiáº¿u (Should).<br>- <b>CÃ¡ch lÃ m:</b> Ráº¥t dá»…! Äáº£o trá»±c tiáº¿p <b>Should</b> lÃªn trÆ°á»›c chá»§ ngá»¯, cÃ¡c thÃ nh pháº§n khÃ¡c giá»¯ nguyÃªn vá»‹ trÃ­.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Should we take an umbrella when we go out?"
    },
    {
        id: 23, type: "rewrite",
        question: "The club is not far from here.",
        answer: "Is the club not far from here?",
        altAnswer: "Isn't the club far from here?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Äá»™ng tá»«:</b> To-be (is).<br>- <b>CÃ¡ch lÃ m:</b> Äáº£o 'Is' lÃªn Ä‘áº§u cÃ¢u.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Is the club not far from here? (Hoáº·c dÃ¹ng cÃ¢u há»i Ä‘uÃ´i phá»§ Ä‘á»‹nh: Isn't the club far from here?)"
    },
    {
        id: 24, type: "rewrite",
        question: "I drink four bottles of water a day.",
        answer: "Do you drink four bottles of water a day?",
        altAnswer: "Do I drink four bottles of water a day?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> Hiá»‡n táº¡i Ä‘Æ¡n (drink). Chá»§ ngá»¯ 'I'.<br>- <b>CÃ¡ch lÃ m:</b> MÆ°á»£n <b>Do</b>, Ä‘á»•i 'I' thÃ nh 'you' cho há»£p tá»± nhiÃªn khi há»i ngÆ°á»i khÃ¡c.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Do you drink four bottles of water a day?"
    },
    {
        id: 25, type: "rewrite",
        question: "They can sing some English songs.",
        answer: "Can they sing any English songs?",
        altAnswer: "Can they sing some English songs?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Äá»™ng tá»«:</b> Khuyáº¿t thiáº¿u (Can).<br>- <b>CÃ¡ch lÃ m:</b> Äáº£o <b>Can</b> lÃªn Ä‘áº§u. LÆ¯U Ã Äáº¶C BIá»†T: Trong cÃ¢u há»i, chá»¯ <b>some</b> thÆ°á»ng pháº£i Ä‘á»•i thÃ nh <b>any</b>.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Can they sing any English songs?"
    },
    {
        id: 26, type: "rewrite",
        question: "They are going to visit us tomorrow.",
        answer: "Are they going to visit you tomorrow?",
        altAnswer: "Are they going to visit us tomorrow?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Cáº¥u trÃºc:</b> Be going to (TÆ°Æ¡ng lai gáº§n).<br>- <b>CÃ¡ch lÃ m:</b> Äáº£o to-be <b>Are</b> lÃªn trÆ°á»›c chá»§ ngá»¯ 'they'. NÃªn Ä‘á»•i 'us' (chÃºng tÃ´i) thÃ nh 'you' (cÃ¡c báº¡n).<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Are they going to visit you tomorrow?"
    },
    {
        id: 27, type: "rewrite",
        question: "My mother took me to the zoo last weekend.",
        answer: "Did your mother take you to the zoo last weekend?",
        altAnswer: "Did my mother take me to the zoo last weekend?",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> QuÃ¡ khá»© Ä‘Æ¡n (took).<br>- <b>CÃ¡ch lÃ m:</b> MÆ°á»£n <b>Did</b>. Tráº£ 'took' vá» nguyÃªn thá»ƒ lÃ  <b>take</b>. Äá»•i 'My' -> 'Your', 'me' -> 'you'.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Did your mother take you to the zoo last weekend?"
    },
    {
        id: 28, type: "rewrite",
        question: "Kate usually spends most of her time reading.",
        answer: "Does Kate usually spend most of her time reading?",
        altAnswer: "",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>ThÃ¬:</b> Hiá»‡n táº¡i Ä‘Æ¡n (spends), chá»§ ngá»¯ sá»‘ Ã­t (Kate).<br>- <b>CÃ¡ch lÃ m:</b> MÆ°á»£n <b>Does</b> Ä‘áº£o lÃªn trÆ°á»›c Kate. Äá»™ng tá»« 'spends' PHáº¢I bá» 's' vá» nguyÃªn thá»ƒ lÃ  <b>spend</b>.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Does Kate usually spend most of her time reading?"
    },
    {
        id: 29, type: "rewrite",
        question: "The film is about two women living in two different countries.",
        answer: "Is the film about two women living in two different countries?",
        altAnswer: "",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Äá»™ng tá»«:</b> To-be (is).<br>- <b>CÃ¡ch lÃ m:</b> Ráº¥t Ä‘Æ¡n giáº£n, chá»‰ viá»‡c Ä‘áº£o <b>Is</b> lÃªn trÆ°á»›c chá»§ ngá»¯ 'The film'.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Is the film about two women living in two different countries?"
    },
    {
        id: 30, type: "rewrite",
        question: "There are various ways to save the environment clean.",
        answer: "Are there various ways to save the environment clean?",
        altAnswer: "",
        explanation: "<b>CÃ´ Mai An phÃ¢n tÃ­ch:</b><br>- <b>Cáº¥u trÃºc:</b> There are...<br>- <b>CÃ¡ch lÃ m:</b> Äáº£o to-be <b>Are</b> lÃªn trÆ°á»›c 'there'.<br>- <b>ÄÃ¡p Ã¡n chuáº©n:</b> Are there various ways to save the environment clean?"
    }
];

// --- RENDER LOGIC ---
let score = 0;
const container = document.getElementById('quiz-container');

// Fisher-Yates Shuffle Function for Options
function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
}

function renderQuiz() {
    quizData.forEach((item, index) => {
        if (item.section) {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'section-title';
            sectionDiv.innerText = item.section;
            container.appendChild(sectionDiv);
            return;
        }

        const card = document.createElement('div');
        card.className = 'card';
        card.id = `q${item.id}`;

        let content = `<div class="question-text">CÃ¢u ${item.id}: ${item.question}</div>`;

        if (item.type === 'mcq') {
            content += `<div class="options-grid">`;
            const shuffledOptions = shuffle([...item.options]); // Shuffle options here
            
            shuffledOptions.forEach((opt, optIndex) => {
                const letter = String.fromCharCode(65 + optIndex); // A, B, C, D
                content += `
                    <button class="option-btn" onclick="handleMCQ(this, ${item.id}, ${opt.isCorrect})">
                        <b>${letter}.</b> ${opt.text}
                    </button>
                `;
            });
            content += `</div>`;
        } else if (item.type === 'rewrite') {
            content += `
                <input type="text" class="type-input" id="input-${item.id}" placeholder="Viáº¿t láº¡i cÃ¢u há»i vÃ o Ä‘Ã¢y...">
                <button class="check-btn" onclick="handleRewrite(${item.id})">Kiá»ƒm tra Ä‘Ã¡p Ã¡n</button>
            `;
        }

        // Explanation Box (Hidden initially)
        content += `
            <div class="explanation" id="expl-${item.id}">
                <h4><span style="font-size:24px">ğŸ’¡</span> Giáº£i thÃ­ch chi tiáº¿t:</h4>
                ${item.explanation}
            </div>
        `;

        card.innerHTML = content;
        container.appendChild(card);
    });
}

// --- INTERACTION LOGIC ---

function handleMCQ(btn, qId, isCorrect) {
    const card = document.getElementById(`q${qId}`);
    const buttons = card.querySelectorAll('.option-btn');
    const expl = document.getElementById(`expl-${qId}`);

    // Disable all buttons in this question
    buttons.forEach(b => b.disabled = true);

    if (isCorrect) {
        btn.classList.add('correct');
        playDing();
        fireConfetti();
        score++;
    } else {
        btn.classList.add('wrong');
        btn.classList.add('shake');
        playBuzzer();
        // Highlight correct answer
        const qData = quizData.find(q => q.id === qId);
        // We need to find which button holds the correct text since we shuffled
        buttons.forEach(b => {
            const correctOpt = qData.options.find(o => o.isCorrect);
            if(b.innerHTML.includes(correctOpt.text)) {
                b.classList.add('correct'); // Show correct one
            }
        });
    }

    // Show explanation
    expl.style.display = 'block';
}

function normalizeStr(str) {
    return str.toLowerCase().replace(/[.?,]/g, '').replace(/\s+/g, ' ').trim();
}

function handleRewrite(qId) {
    const inputEl = document.getElementById(`input-${qId}`);
    const btn = inputEl.nextElementSibling;
    const expl = document.getElementById(`expl-${qId}`);
    const userAns = normalizeStr(inputEl.value);
    
    if(!userAns) {
        alert("Em hÃ£y gÃµ Ä‘Ã¡p Ã¡n vÃ o nhÃ©!");
        return;
    }

    const qData = quizData.find(q => q.id === qId);
    const ans1 = normalizeStr(qData.answer);
    const ans2 = qData.altAnswer ? normalizeStr(qData.altAnswer) : null;

    inputEl.disabled = true;
    btn.disabled = true;

    if (userAns === ans1 || userAns === ans2) {
        inputEl.style.borderColor = "var(--correct)";
        inputEl.style.backgroundColor = "#E6FFF0";
        playDing();
        fireConfetti();
        score++;
    } else {
        inputEl.style.borderColor = "var(--wrong)";
        inputEl.style.backgroundColor = "#FFE6E8";
        inputEl.classList.add('shake');
        playBuzzer();
    }

    // Append correct answer to explanation for visibility
    expl.innerHTML = `<h4><span style="font-size:24px">ğŸ¯</span> ÄÃ¡p Ã¡n Ä‘Ãºng:</h4> <p style="font-size: 18px; color: var(--primary); font-weight:bold; margin-top:0;">${qData.answer}</p>` + expl.innerHTML;
    expl.style.display = 'block';
}

function submitQuiz() {
    const totalQ = quizData.filter(q => q.type).length;
    document.getElementById('score-display').innerText = `${score}/${totalQ}`;
    
    let praise = "";
    const percentage = score / totalQ;
    if (percentage === 1) praise = "Tuyá»‡t Ä‘á»‰nh Kungfu! Em lÃ m Ä‘Ãºng háº¿t luÃ´n! ğŸ†";
    else if (percentage >= 0.8) praise = "Ráº¥t xuáº¥t sáº¯c! CÃ´ khen ngá»£i em! ğŸŒŸ";
    else if (percentage >= 0.5) praise = "LÃ m tá»‘t láº¯m, nhÆ°ng cá»‘ gáº¯ng cáº©n tháº­n hÆ¡n chÃºt nhÃ©! ğŸ’ª";
    else praise = "Äá»«ng náº£n chÃ­! HÃ£y xem ká»¹ pháº§n giáº£i thÃ­ch cá»§a cÃ´ nhÃ©! â¤ï¸";
    
    document.getElementById('praise-message').innerText = praise;
    document.getElementById('result-modal').style.display = 'flex';
    playDing();
    fireConfetti();
}

function closeModal() {
    document.getElementById('result-modal').style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Initialize
window.onload = renderQuiz;

</script>
</body>
</html>