<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 9: World Englishes - Ms Mai An ULIS</title>
    <style>
        :root {
            --primary: #0056b3;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --light: #f8f9fa;
            --dark: #343a40;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
            margin: 0;
            padding-bottom: 80px; /* Space for sticky footer */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border-left: 5px solid var(--primary);
            text-align: center;
        }

        header h1 {
            color: var(--primary);
            margin: 0;
            font-size: 1.8rem;
        }

        header p {
            color: #666;
            margin: 5px 0 0;
            font-weight: 600;
        }

        /* Data Box (Reading Passages) */
        .data-box {
            background-color: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            margin-bottom: 20px;
            font-size: 1.05rem;
            white-space: pre-line; /* Keep formatting */
        }

        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            font-size: 0.9rem;
        }
        .glossary-table th, .glossary-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        .glossary-table th {
            background-color: var(--primary);
            color: white;
        }

        /* Question Cards */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
            transition: transform 0.2s;
        }

        .question-text {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .option:hover {
            background-color: #e2e6ea;
            border-color: #adb5bd;
        }

        .option.selected {
            background-color: #e7f1ff;
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        /* Feedback Colors */
        .option.correct {
            background-color: #d4edda !important;
            border-color: var(--success) !important;
            color: #155724 !important;
        }

        .option.incorrect {
            background-color: #f8d7da !important;
            border-color: var(--danger) !important;
            color: #721c24 !important;
        }

        /* Explanation Section */
        .explanation {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f1f8ff;
            border-left: 4px solid var(--primary);
            border-radius: 4px;
            font-size: 0.95rem;
        }
        
        .explanation h4 { margin-top: 0; color: var(--primary); }
        .explanation strong { color: #333; }
        .vocab-item { margin-bottom: 5px; }

        /* Buttons */
        .btn-check {
            margin-top: 15px;
            padding: 8px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        .btn-check:hover { background-color: #004494; }

        /* Sticky Footer */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .btn-submit {
            background-color: var(--success);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.3);
        }
        .btn-submit:hover { background-color: #218838; }

        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-right: 20px;
        }

        /* Custom Visuals for Q29 & Q30 */
        .sign-box {
            border: 4px solid #f4a460;
            background-color: #fff8dc;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        .sign-icon { font-size: 3rem; }
        .sign-text { color: #8b4513; font-weight: bold; }
        
        .email-box {
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .email-header {
            background: #dce4ef;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .email-dots span {
            display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #666; margin-right: 3px;
        }
        .email-meta { font-weight: bold; margin: 5px 0; font-family: Arial, sans-serif; }
        .email-body { padding: 15px; background: white; font-family: 'Times New Roman', serif; }

        /* Phonetics */
        u { text-decoration: underline; text-decoration-thickness: 2px; text-underline-offset: 3px; }
        
        /* Gap Fill Sentence Layout */
        .gap-fill-container { display: flex; flex-direction: column; gap: 15px; }
        .gap-options-box { background: #e2e3e5; padding: 10px; border-radius: 5px; font-weight: bold; }
        .gap-text-box { background: white; padding: 15px; border: 1px solid #ddd; border-radius: 5px; line-height: 1.8; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>UNIT 9 – WORLD ENGLISHES (TEST 01)</h1>
        <p>Giáo viên tạo: Ms Mai An ULIS</p>
    </header>

    <div id="quiz-container">
        </div>
</div>

<div class="sticky-footer">
    <div style="margin-left: 20px;">
        <span>Progress: <span id="progress-count">0</span>/40</span>
    </div>
    <div style="display: flex; align-items: center;">
        <div id="final-score" class="score-display" style="display:none;"></div>
        <button class="btn-submit" onclick="submitAll()">NỘP BÀI (SUBMIT)</button>
    </div>
</div>

<script>
    // DATA SOURCE
    const quizData = [
        // PRONUNCIATION
        {
            id: 1, type: 'phonetics',
            question: "Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.",
            options: [
                {id: 'A', text: "rea<u>s</u>on"},
                {id: 'B', text: "con<u>s</u>ist"},
                {id: 'C', text: "e<u>s</u>tablish"},
                {id: 'D', text: "que<u>s</u>tion"}
            ],
            correct: 'A',
            explanation: `
                <div class="vocab-item"><strong>A. reason</strong> /ˈriːzn/ (s phát âm là /z/)</div>
                <div class="vocab-item"><strong>B. consist</strong> /kənˈsɪst/ (s phát âm là /s/)</div>
                <div class="vocab-item"><strong>C. establish</strong> /ɪˈstæblɪʃ/ (s phát âm là /s/)</div>
                <div class="vocab-item"><strong>D. question</strong> /ˈkwestʃən/ (s phát âm là /s/)</div>
                <br>
                <strong>Giải thích:</strong> Đáp án A phát âm là hữu thanh /z/, các đáp án còn lại là vô thanh /s/.
                <br><em>Lưu ý:</em> Trong từ "question", mặc dù đuôi là -tion nhưng âm 's' đứng trước vẫn giữ nguyên là /s/.
            `
        },
        {
            id: 2, type: 'phonetics',
            question: "Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.",
            options: [
                {id: 'A', text: "vocabul<u>a</u>ry"},
                {id: 'B', text: "stand<u>a</u>rd"},
                {id: 'C', text: "langu<u>a</u>ge"},
                {id: 'D', text: "grammatic<u>a</u>l"}
            ],
            correct: 'C',
            explanation: `
                <div class="vocab-item"><strong>A. vocabulary</strong> /vəˈkæbjələri/ (âm /ə/)</div>
                <div class="vocab-item"><strong>B. standard</strong> /ˈstændəd/ (âm /ə/)</div>
                <div class="vocab-item"><strong>C. language</strong> /ˈlæŋɡwɪdʒ/ (âm /ɪ/)</div>
                <div class="vocab-item"><strong>D. grammatical</strong> /ɡrəˈmætɪkl/ (âm /ə/)</div>
                <br>
                <strong>Giải thích:</strong> Đáp án C phát âm là /ɪ/ (trong âm tiết cuối -age), các đáp án còn lại là âm ngắn /ə/ (schwa).
            `
        },
        // STRESS
        {
            id: 3, type: 'stress',
            question: "Indicate the word that differs from the other three in the position of primary stress.",
            options: [
                {id: 'A', text: "collection"},
                {id: 'B', text: "energy"},
                {id: 'C', text: "finally"},
                {id: 'D', text: "equity"}
            ],
            correct: 'A',
            explanation: `
                <div class="vocab-item"><strong>A. collection</strong> /kəˈlekʃn/ (Trọng âm 2)</div>
                <div class="vocab-item"><strong>B. energy</strong> /ˈenədʒi/ (Trọng âm 1)</div>
                <div class="vocab-item"><strong>C. finally</strong> /ˈfaɪnəli/ (Trọng âm 1)</div>
                <div class="vocab-item"><strong>D. equity</strong> /ˈekwəti/ (Trọng âm 1)</div>
                <br>
                <strong>Quy tắc:</strong> Đuôi -tion nhấn trọng âm vào âm tiết ngay trước nó (col-LEC-tion).
            `
        },
        {
            id: 4, type: 'stress',
            question: "Indicate the word that differs from the other three in the position of primary stress.",
            options: [
                {id: 'A', text: "bilingual"},
                {id: 'B', text: "concentric"},
                {id: 'C', text: "connection"},
                {id: 'D', text: "entity"}
            ],
            correct: 'D',
            explanation: `
                <div class="vocab-item"><strong>A. bilingual</strong> /ˌbaɪˈlɪŋɡwəl/ (Trọng âm 2)</div>
                <div class="vocab-item"><strong>B. concentric</strong> /kənˈsentrɪk/ (Trọng âm 2 - quy tắc đuôi -ic)</div>
                <div class="vocab-item"><strong>C. connection</strong> /kəˈnekʃn/ (Trọng âm 2 - quy tắc đuôi -tion)</div>
                <div class="vocab-item"><strong>D. entity</strong> /ˈentəti/ (Trọng âm 1 - quy tắc đuôi -y thường dịch chuyển 3 âm tiết từ dưới lên)</div>
            `
        },
        // VOCAB & GRAMMAR
        {
            id: 5, type: 'mcq',
            question: "One example of _____ world is the word “ballet”, which comes from French.",
            options: [
                {id: 'A', text: "lent (v): cho mượn"},
                {id: 'B', text: "borrowed (adj/v): vay mượn"},
                {id: 'C', text: "compound (n/adj): ghép"},
                {id: 'D', text: "foreign (adj): nước ngoài"}
            ],
            correct: 'B',
            explanation: `
                <strong>Dịch câu:</strong> Một ví dụ của từ <em>vay mượn</em> là từ "ballet", cái mà đến từ tiếng Pháp.
                <br><strong>Giải thích:</strong>
                <ul>
                    <li><strong>Borrowed word</strong> (Collocation): Từ vay mượn (từ mượn từ ngôn ngữ khác).</li>
                    <li>Lent: Quá khứ của Lend (cho mượn) - sai nghĩa.</li>
                    <li>Compound word: Từ ghép (ví dụ: blackbird) - sai định nghĩa.</li>
                </ul>
            `
        },
        {
            id: 6, type: 'mcq',
            question: "Another way of conceptualizing learning in English is to view it through the lens of the various ______ of the subject.",
            options: [
                {id: 'A', text: "rules (n): quy tắc"},
                {id: 'B', text: "varieties (n): biến thể"},
                {id: 'C', text: "standards (n): tiêu chuẩn"},
                {id: 'D', text: "models (n): mô hình"}
            ],
            correct: 'D',
            explanation: `
                <strong>Dịch câu:</strong> Một cách khác để khái niệm hóa việc học tiếng Anh là nhìn nó qua lăng kính của các <em>mô hình</em> khác nhau của môn học.
                <br><strong>Giải thích:</strong> Trong ngôn ngữ học (Unit 9), khi nói về việc khái niệm hóa (conceptualizing) cấu trúc môn học/ngôn ngữ, ta dùng từ <strong>models</strong> (ví dụ: Kachru's model of World Englishes - mô hình 3 vòng tròn).
                <br>Sai lầm thường gặp: <em>Varieties</em> (biến thể) thường dùng cho "Varieties of English" chứ không nói "Varieties of the subject" trong ngữ cảnh khái niệm hóa.
            `
        },
        {
            id: 7, type: 'mcq',
            question: "Our school invited some famous _______ to be the judges for an English debating contest.",
            options: [
                {id: 'A', text: "coaches (n): huấn luyện viên"},
                {id: 'B', text: "linguists (n): nhà ngôn ngữ học"},
                {id: 'C', text: "doctors (n): bác sĩ"},
                {id: 'D', text: "accountants (n): kế toán"}
            ],
            correct: 'B',
            explanation: `
                <strong>Dịch câu:</strong> Trường chúng tôi đã mời một vài <em>nhà ngôn ngữ học</em> nổi tiếng để làm giám khảo cho cuộc thi tranh biện tiếng Anh.
                <br><strong>Giải thích:</strong>
                <ul>
                    <li>Context là "English debating contest" (thi hùng biện tiếng Anh) nên cần chuyên gia về ngôn ngữ => <strong>Linguists</strong>.</li>
                    <li>Các đáp án còn lại không phù hợp về chuyên môn.</li>
                </ul>
            `
        },
        {
            id: 8, type: 'mcq',
            question: "Many English words have origins _____ trace back to Latin and French.",
            options: [
                {id: 'A', text: "Who"},
                {id: 'B', text: "Which"},
                {id: 'C', text: "Whose"},
                {id: 'D', text: "Whom"}
            ],
            correct: 'B',
            explanation: `
                <strong>Dịch câu:</strong> Nhiều từ tiếng Anh có nguồn gốc <em>cái mà</em> bắt nguồn từ tiếng Latin và Pháp.
                <br><strong>Ngữ pháp:</strong> Mệnh đề quan hệ.
                <ul>
                    <li>Danh từ đứng trước là "origins" (vật/sự vật) => Dùng đại từ quan hệ <strong>Which</strong> hoặc <strong>That</strong>.</li>
                    <li>"Who/Whom" dùng cho người. "Whose" chỉ sở hữu.</li>
                </ul>
            `
        },
        {
            id: 9, type: 'mcq',
            question: "Linguists ______ analyse the historical development and variations.",
            options: [
                {id: 'A', text: "Whose English language they study"},
                {id: 'B', text: "who study the English language"},
                {id: 'C', text: "That they study the English language"},
                {id: 'D', text: "Studied the English language"}
            ],
            correct: 'B',
            explanation: `
                <strong>Dịch câu:</strong> Những nhà ngôn ngữ học <em>người mà nghiên cứu tiếng Anh</em> thì phân tích sự phát triển lịch sử và các biến thể.
                <br><strong>Phân tích:</strong>
                <ul>
                    <li>Câu đã có động từ chính là "analyse".</li>
                    <li>Cần một mệnh đề quan hệ bổ nghĩa cho chủ ngữ "Linguists" (người).</li>
                    <li><strong>B. who study...</strong> là mệnh đề quan hệ xác định đúng cấu trúc (Who + V).</li>
                    <li>A, C sai cấu trúc ngữ pháp. D làm câu trở nên vô nghĩa hoặc sai thì (nếu coi là rút gọn thì phải là Studying, nếu là động từ chính thì câu có 2 động từ chính nối tiếp nhau without conjunction).</li>
                </ul>
            `
        },
        {
            id: 10, type: 'mcq',
            question: "Minh: “ I heard you have a big presentation tomorrow. _______.” <br>Linda: “Thank you so much.”",
            options: [
                {id: 'A', text: "I promise I’ll try my best (Tôi hứa tôi sẽ cố hết sức)"},
                {id: 'B', text: "I wish you all the best of luck (Chúc bạn may mắn)"},
                {id: 'C', text: "I appreciate your effort (Tôi trân trọng nỗ lực của bạn)"},
                {id: 'D', text: "Don’t worry about me (Đừng lo cho tôi)"}
            ],
            correct: 'B',
            explanation: `
                <strong>Ngữ cảnh:</strong> Minh nghe nói Linda sắp có bài thuyết trình lớn. Linda cảm ơn.
                <br>-> Minh phải nói một lời chúc hoặc động viên.
                <br><strong>Đáp án đúng:</strong> B. "Chúc bạn mọi điều may mắn nhất". Đây là lời chúc tự nhiên trước một sự kiện quan trọng.
            `
        },
        {
            id: 11, type: 'mcq',
            question: "The article was about the different varieties of _____ English spoken throughout the world.",
            options: [
                {id: 'A', text: "in"},
                {id: 'B', text: "of"},
                {id: 'C', text: "from"},
                {id: 'D', text: "among"}
            ],
            correct: 'D',
            explanation: `
                <strong>Dịch câu:</strong> Bài báo viết về các biến thể khác nhau <em>của</em> tiếng Anh được nói trên khắp thế giới.
                <br><strong>Lỗi đề bài/Check lại:</strong> Thông thường cụm là "Varieties OF English". Tuy nhiên, đề bài viết "Varieties of _____ English".
                <br>Nếu điền "of" thì thành "varieties of of English" => Sai.
                <br>Nếu điền "among" => "Varieties of among English" => Sai.
                <br><em>Phân tích lại đề:</em> Có thể đề gốc là "varieties _____ English". Nếu đề là "varieties of _____ English" thì chỗ trống là thừa hoặc cần một tính từ.
                <br>Tuy nhiên, dựa trên các đáp án giới từ, khả năng cao đề gốc là "varieties _____ English" (bỏ chữ of trước chỗ trống). Khi đó đáp án là <strong>B. of</strong>.
                <br><em>Giả sử đề giữ nguyên:</em> "Varieties of...". Có thể ý là "Varieties of spoken English"? Không có đáp án Spoken.
                <br><strong>Chốt theo logic ngữ pháp bài thi phổ thông:</strong> Đáp án là <strong>B. of</strong> (Cấu trúc: <em>Varieties of English</em>). Vị trí chỗ trống trong đề bài hiển thị trên UI có thể gây hiểu nhầm, nhưng bản chất là kiểm tra giới từ đi sau Varieties.
            `
        },
        {
            id: 12, type: 'mcq',
            question: "Susan __________ bit of Korean when she was living here.",
            options: [
                {id: 'A', text: "looked up (tra cứu)"},
                {id: 'B', text: "went over (xem lại)"},
                {id: 'C', text: "picked up (học lỏm/học được qua trải nghiệm)"},
                {id: 'D', text: "took in (tiếp thu/hiểu/lừa gạt)"}
            ],
            correct: 'C',
            explanation: `
                <strong>Dịch câu:</strong> Susan đã <em>học lỏm được</em> một chút tiếng Hàn khi cô ấy sống ở đây.
                <br><strong>Giải thích:</strong>
                <ul>
                    <li><strong>Pick up (a language):</strong> Học được một ngôn ngữ một cách tự nhiên (không qua trường lớp chính quy) thông qua môi trường sống. Rất hợp với ngữ cảnh "when she was living here".</li>
                    <li>Look up: Tra từ điển.</li>
                    <li>Go over: Ôn tập kỹ lưỡng.</li>
                </ul>
            `
        },
        // READING 1 (GAP FILL)
        {
            id: 'reading1', type: 'reading-group',
            text: `The Importance of Learning English
            Learning English is very important (13) ____ today’s world. It helps you talk with people from many different countries and makes traveling and working abroad easier. Additionally, (14) ____ English opens doors to many good schools and educational resources, allowing you (15) ____ a wide range of information and opportunities. Being able to speak English can also (16) ____ your chances of getting a better job and advancing in your career.`,
            glossary: [
                {word: "Abroad", type: "adv", meaning: "Ở nước ngoài"},
                {word: "Resource", type: "n", meaning: "Tài nguyên/Nguồn lực"},
                {word: "Advance", type: "v", meaning: "Thăng tiến"}
            ],
            questions: [
                {
                    id: 13,
                    question: "Question 13:",
                    options: [{id:'A', text:'on'}, {id:'B', text:'in'}, {id:'C', text:'at'}, {id:'D', text:'by'}],
                    correct: 'B',
                    explanation: "<strong>In today's world</strong> (Trong thế giới ngày nay) là cụm cố định."
                },
                {
                    id: 14,
                    question: "Question 14:",
                    options: [{id:'A', text:'the'}, {id:'B', text:'a'}, {id:'C', text:'an'}, {id:'D', text:'X (no article)'}],
                    correct: 'D',
                    explanation: "Trước tên ngôn ngữ (English) không dùng mạo từ khi không có chữ 'language' đi kèm. 'Learning English' là cụm danh động từ chung."
                },
                {
                    id: 15,
                    question: "Question 15:",
                    options: [{id:'A', text:'to access'}, {id:'B', text:'access'}, {id:'C', text:'accessing'}, {id:'D', text:'to accessing'}],
                    correct: 'A',
                    explanation: "Cấu trúc: <strong>Allow sb to V</strong> (Cho phép ai làm gì). -> Allowing you to access."
                },
                {
                    id: 16,
                    question: "Question 16:",
                    options: [{id:'A', text:'improve'}, {id:'B', text:'improved'}, {id:'C', text:'improving'}, {id:'D', text:'improves'}],
                    correct: 'A',
                    explanation: "Sau Modal verb 'can' + V nguyên thể. -> Can also <strong>improve</strong>."
                }
            ]
        },
        // SENTENCE ARRANGEMENT
        {
            id: 'arrange1', type: 'reading-group',
            text: `(a) Moreover, schools are setting up English clubs and language exchange events for students to practice. 
            (b) Besides normal classes, many villages now use mobile apps and online tools to help people learn English. 
            (c) Next, I want to tell you about learning English in rural areas of Vietnam. 
            (d) First, I hope you are doing well.`,
            questions: [
                {
                    id: 17,
                    question: "Question 17: Arrange the sentences to make a meaningful letter.",
                    options: [
                        {id:'A', text:'d-b-a-c'},
                        {id:'B', text:'d-c-a-b'},
                        {id:'C', text:'d-c-b-a'},
                        {id:'D', text:'d-a-c-b'}
                    ],
                    correct: 'C',
                    explanation: `
                        <strong>Trình tự logic của một lá thư:</strong>
                        <br>1. <strong>(d)</strong> First, I hope you are doing well. (Lời chào hỏi đầu thư).
                        <br>2. <strong>(c)</strong> Next, I want to tell you about... (Giới thiệu chủ đề chính: học tiếng Anh ở vùng quê).
                        <br>3. <strong>(b)</strong> Besides normal classes... (Triển khai ý 1: dùng apps).
                        <br>4. <strong>(a)</strong> Moreover... (Triển khai ý 2 bổ sung: CLB tiếng Anh).
                        <br>=> Thứ tự: <strong>d - c - b - a</strong>.
                    `
                },
                {
                    id: 18,
                    question: "Question 18: Choose the sentence that most appropriately ends the text.",
                    options: [
                        {id:'A', text:'Finally, these new ideas are really helping people improve their English skills.'},
                        {id:'B', text:'Finally, English is hard to use for mostly Vietnamese people'},
                        {id:'C', text:'Finally, English contributes to the development of tourism in rural areas.'},
                        {id:'D', text:'Finally, students are using English more than their mother tongue.'}
                    ],
                    correct: 'A',
                    explanation: `
                        <strong>Giải thích:</strong>
                        <br>Đoạn văn trên nói về các giải pháp tích cực (apps, clubs) để học tiếng Anh.
                        <br>-> Câu kết luận cần mang tính tổng kết tích cực về hiệu quả của các giải pháp đó.
                        <br><strong>A.</strong> Cuối cùng, những ý tưởng mới này thực sự giúp mọi người cải thiện kỹ năng. (Phù hợp nhất).
                        <br>B, D mang nghĩa tiêu cực hoặc phóng đại. C đề cập đến du lịch (không liên quan bài).
                    `
                }
            ]
        },
        // READING 2
        {
            id: 'reading2', type: 'reading-group',
            text: `English is a (19) ____________ language spoken by a lot of people around the world. Approximately 1.5 billion people speak English as a native or as a second language. However, when it comes to understanding the difference between American English (AE) and British English (BE), it is not uncommon to find even native-English speakers getting (20) ____________.
            One of (21) ____________ differences between BE and AE is in terms of vocabulary. In the UK, for example, they call it a flat, while in America it’s an apartment. The British go on holiday, while Americans go on vacation. Some of the other common words like trousers, lorry, university and chips come under BE while for AE they correspond to pants, truck, college and fries.
            Another significant difference is the (22) ____________ of certain words, such as color in AE instead of colour in BE. Verbs that are spelt with ize or ise in BE are always spelt as ize in AE. For example, it is apologize or apologise in BE but in AE, it is always apologize.
            Aside from spelling and vocabulary, there are certain grammar differences between BE and AE. For instance, in AE, collective nouns are considered singular (e.g. The band is playing). In contrast, collective nouns can be (23) ____________ singular or plural in BE, although the plural form is most often used (e.g. The band are playing). The British are also more likely to use formal speech, such as shall, whereas Americans (24) ____________ the more informal will or should.`,
            glossary: [
                {word: "Correspond to", type: "v", meaning: "Tương ứng với"},
                {word: "Collective noun", type: "n", meaning: "Danh từ tập hợp"},
                {word: "Significant", type: "adj", meaning: "Đáng kể/Quan trọng"}
            ],
            questions: [
                {
                    id: 19, question: "Question 19:",
                    options: [{id:'A', text:'modern'}, {id:'B', text:'regional'}, {id:'C', text:'global'}, {id:'D', text:'national'}],
                    correct: 'C',
                    explanation: "<strong>Global language</strong>: Ngôn ngữ toàn cầu. Phù hợp với câu sau 'spoken by a lot of people around the world'."
                },
                {
                    id: 20, question: "Question 20:",
                    options: [{id:'A', text:'confusing'}, {id:'B', text:'confusion'}, {id:'C', text:'confusable'}, {id:'D', text:'confused'}],
                    correct: 'D',
                    explanation: "Cấu trúc: <strong>Get + Adjective (V_ed)</strong> chỉ trạng thái cảm xúc. Người bản xứ cũng bị <em>bối rối</em> (confused)."
                },
                {
                    id: 21, question: "Question 21:",
                    options: [{id:'A', text:'more evident'}, {id:'B', text:'the most evident'}, {id:'C', text:'the least evident'}, {id:'D', text:'less evident'}],
                    correct: 'B',
                    explanation: "Cấu trúc: <strong>One of + the most + Adj</strong> (Một trong những khác biệt <em>rõ ràng nhất</em>)."
                },
                {
                    id: 22, question: "Question 22:",
                    options: [{id:'A', text:'pronunciation'}, {id:'B', text:'rhythm'}, {id:'C', text:'intonation'}, {id:'D', text:'spelling'}],
                    correct: 'D',
                    explanation: "Đoạn văn đưa ví dụ: 'color' vs 'colour', 'ize' vs 'ise'. Đây là sự khác biệt về <strong>chính tả (spelling)</strong>."
                },
                {
                    id: 23, question: "Question 23:",
                    options: [{id:'A', text:'both'}, {id:'B', text:'only'}, {id:'C', text:'neither'}, {id:'D', text:'either'}],
                    correct: 'D',
                    explanation: "Cấu trúc: <strong>Either... or...</strong> (Hoặc là... hoặc là...). 'Can be either singular or plural'."
                },
                {
                    id: 24, question: "Question 24:",
                    options: [{id:'A', text:'favour'}, {id:'B', text:'dislike'}, {id:'C', text:'ignore'}, {id:'D', text:'disagree'}],
                    correct: 'A',
                    explanation: "Americans <strong>favour</strong> (ưa thích/thiên về) cái gì đó thân mật hơn (informal). Các từ khác không hợp ngữ cảnh."
                }
            ]
        },
        // CLOSEST MEANING
        {
            id: 25, type: 'mcq',
            question: "Choose the sentence closest in meaning: Let’s do a revision these grammar structures before you take the test.",
            options: [
                {id: 'A', text: "Let’s pick up these grammar structures..."},
                {id: 'B', text: "Why don’t you learn by heart these grammar structures..."},
                {id: 'C', text: "Why don’t you go over these grammar structures..."},
                {id: 'D', text: "Let’s look up these grammar structures..."}
            ],
            correct: 'C',
            explanation: `
                <strong>Từ khóa:</strong> do a revision = ôn tập.
                <br><strong>Phân tích:</strong>
                <ul>
                    <li><strong>Go over</strong> = Examine/Check/Review (Xem lại/Ôn tập). => Đồng nghĩa.</li>
                    <li>Pick up: Học lỏm.</li>
                    <li>Look up: Tra cứu.</li>
                    <li>Learn by heart: Học thuộc lòng (nghĩa hẹp hơn revision).</li>
                </ul>
            `
        },
        {
            id: 26, type: 'mcq',
            question: "Choose the sentence closest in meaning: Chau can speak both English and Japanese perfectly.",
            options: [
                {id: 'A', text: "Chau is bilingual in English and Japanese."},
                {id: 'B', text: "Chau is good at learning both English and Japanese."},
                {id: 'C', text: "Chau can use perfect English and Japanese."},
                {id: 'D', text: "Chau practises speaking English and Japanese regularly."}
            ],
            correct: 'A',
            explanation: `
                <strong>Từ khóa:</strong> speak both... perfectly (nói hoàn hảo 2 ngôn ngữ).
                <br><strong>Định nghĩa:</strong> <strong>Bilingual</strong> (Song ngữ) = Có khả năng sử dụng 2 ngôn ngữ trôi chảy.
                <br>Đáp án A diễn đạt chính xác nhất nghĩa của câu gốc.
            `
        },
        // SENTENCE BUILD
        {
            id: 27, type: 'mcq',
            question: "Choose the sentence made from given cues: When/ arrive/ guide/ tell/ story/ a cruel king.",
            options: [
                {id: 'A', text: "When arriving, the guide was telling the story about a cruel king."},
                {id: 'B', text: "When we arrived, the guide was telling the story about a cruel king."},
                {id: 'C', text: "When we were arriving, the guide told the story about a cruel king."},
                {id: 'D', text: "When to arrive, a guide was telling the story about a cruel king."}
            ],
            correct: 'B',
            explanation: `
                <strong>Kiến thức:</strong> Sự phối hợp thì (Quá khứ đơn và Quá khứ tiếp diễn).
                <br>Hành động đang xảy ra (guide telling story) -> QK tiếp diễn.
                <br>Hành động xen vào (we arrive) -> QK đơn.
                <br>=> <strong>When we arrived, the guide was telling...</strong>
            `
        },
        {
            id: 28, type: 'mcq',
            question: "Choose the sentence made from given cues: You/shouldn’t/ look/ the meaning/ all the words/ when reading/ text.",
            options: [
                {id: 'A', text: "You shouldn’t look for the meaning of all the words when reading a text."},
                {id: 'B', text: "You shouldn’t look over the meaning all the words when reading a text."},
                {id: 'C', text: "You shouldn't look up the meaning of all the words when reading a text."},
                {id: 'D', text: "You shouldn’t look after the meaning all the words while reading a text."}
            ],
            correct: 'C',
            explanation: `
                <strong>Phrasal Verb:</strong>
                <ul>
                    <li><strong>Look up</strong>: Tra từ (trong từ điển).</li>
                    <li>Look for: Tìm kiếm (vật bị mất).</li>
                    <li>Look after: Chăm sóc.</li>
                </ul>
                <br>Ngữ cảnh "meaning of words" (nghĩa của từ) => Dùng <strong>Look up</strong>.
            `
        },
        // IMAGES
        {
            id: 29, type: 'visual',
            visualType: 'sign',
            question: "Who is this message for?",
            content: { title: "If you are not well and miss a class, please ask a classmate to tell you what was taught." },
            options: [
                {id: 'A', text: "Pupils who are not feeling well."},
                {id: 'B', text: "Pupils who couldn’t go to a lesson."},
                {id: 'C', text: "Pupils who would like to help their friends."},
                {id: 'D', text: "The student does not study."}
            ],
            correct: 'B',
            explanation: `
                <strong>Dịch biển báo:</strong> "Nếu bạn không khỏe và <em>bỏ lỡ một buổi học</em>, hãy nhờ bạn cùng lớp nói lại những gì đã dạy."
                <br><strong>Phân tích:</strong>
                <ul>
                    <li>A: Học sinh không khỏe (đúng 1 vế, nhưng thông báo hướng đến hành động xử lý việc vắng mặt).</li>
                    <li>B: Học sinh không thể đến lớp (miss a class). -> Đây là đối tượng chính cần thực hiện hành động "ask a classmate".</li>
                    <li>Đáp án B bao quát ngữ cảnh "miss a class" (bỏ lỡ bài học) chính xác nhất.</li>
                </ul>
            `
        },
        {
            id: 30, type: 'visual',
            visualType: 'email',
            question: "What should the club members do?",
            content: { 
                to: "Photography club members",
                subject: "Picnic",
                body: "Everyone welcome – just meet at the park at 2.30 on Saturday. Bring something for the barbecue – drinks provided. Bring your best pictures to share. See you there! Tom"
            },
            options: [
                {id: 'A', text: "Bring food to cook on the picnic."},
                {id: 'B', text: "Take lots of photos at the picnic."},
                {id: 'C', text: "Tell Tom if they want to go on the picnic"},
                {id: 'D', text: "Have a barbecue on the picnic."}
            ],
            correct: 'A',
            explanation: `
                <strong>Thông tin trong thư:</strong> "Bring something for the barbecue" (Mang cái gì đó cho tiệc nướng).
                <br><strong>Phân tích:</strong>
                <ul>
                    <li>Barbecue ám chỉ việc nướng đồ ăn. -> "Bring food to cook".</li>
                    <li>Đáp án A chính xác nhất với yêu cầu "Bring something".</li>
                    <li>D sai vì "Have a barbecue" là hoạt động chung, không phải nhiệm vụ cụ thể của từng thành viên phải "làm" (do/bring).</li>
                </ul>
            `
        },
        // READING 3
        {
            id: 'reading3', type: 'reading-group',
            text: `English as a global language
            People often talk about English as a global language or lingua franca. With more than 350 million people around the world speaking English as a first language and more than 430 million speaking it as a second language, there are English speakers in most countries around the world. Why is English so popular, though? And why has it become a global language?
            People often call English the international language of business, and it’s increasingly true as international trade expands every year, bringing new countries into contact. Most multinational companies require a certain degree of English proficiency from potential employees so in order to get a position with a top company, more and more people are learning English.
            If your ambitions lie in science or medicine, you can’t neglect English either. Much of the technical terminology is based on English words, and if you want to learn about the latest developments and discoveries from around the world, you’ll read about them in journals and research reports published in English, no matter whether the scientists who wrote them are from China or Norway.
            If you want a career in travel, English is absolutely essential. As the international language of aviation, pilots and cabin crew all need to speak English. Even if you’re not up in the air, speaking English accurately will ensure you are able to communicate with clients and suppliers all over the world.
            So, what’s stopping you from learning this global language? With all the English resources available on the internet and so many other English speakers around the world to practice with, there’s never been a better time to start learning English. Pick up a book, learn a few words, or even start a course today and take your first steps towards becoming one of nearly 800 million English speakers in the world.`,
            glossary: [
                {word: "Lingua franca", type: "n", meaning: "Ngôn ngữ chung"},
                {word: "Proficiency", type: "n", meaning: "Sự thành thạo"},
                {word: "Aviation", type: "n", meaning: "Hàng không"},
                {word: "Supplier", type: "n", meaning: "Nhà cung cấp"}
            ],
            questions: [
                {
                    id: 31, question: "Question 31: What is the main idea of the passage?",
                    options: [
                        {id:'A', text:'The history of the English language'},
                        {id:'B', text:'Why English is a global language and its importance in various fields.'},
                        {id:'C', text:'How many people speak English worldwide'},
                        {id:'D', text:'The challenges of learning English as a second language'}
                    ],
                    correct: 'B',
                    explanation: "Bài đọc thảo luận tại sao tiếng Anh phổ biến (Business, Science, Travel) và tầm quan trọng của nó. -> Ý chính là B."
                },
                {
                    id: 32, question: "Question 32: Why are more and more people learning English?",
                    options: [
                        {id:'A', text:'Be hired by a top company'},
                        {id:'B', text:'Expand international trade'},
                        {id:'C', text:'Require a certain degree'},
                        {id:'D', text:'Make contact with foreigners.'}
                    ],
                    correct: 'A',
                    explanation: "Dẫn chứng (Đoạn 2): '...so in order to <strong>get a position with a top company</strong>, more and more people are learning English.'"
                },
                {
                    id: 33, question: "Question 33: The noun “steps” used in the phrase “take your first steps” means_____.",
                    options: [
                        {id:'A', text:'Movements'}, {id:'B', text:'actions'}, {id:'C', text:'feet'}, {id:'D', text:'stages'}
                    ],
                    correct: 'B',
                    explanation: "Cụm từ 'Take steps' = Take actions (Thực hiện các hành động/bước đi). Nghĩa bóng là hành động, không phải bước chân vật lý."
                },
                {
                    id: 34, question: "Question 34: Which of the following statements is NOT TRUE?",
                    options: [
                        {id:'A', text:'Speaking English fluently is necessary even if you are on the ground staff'},
                        {id:'B', text:'You can learn English from online resources or other English speakers.'},
                        {id:'C', text:'It’s better to take online English classes than physical classes.'},
                        {id:'D', text:'There are nearly 800 million English speakers, both as a first and second language.'}
                    ],
                    correct: 'C',
                    explanation: "Trong bài không hề so sánh việc học online 'tốt hơn' (better) so với lớp học trực tiếp. Bài chỉ nói có nhiều resource trên internet."
                },
                {
                    id: 35, question: "Question 35: Why is English important if you want to pursue a medical career?",
                    options: [
                        {id:'A', text:'Because all journals of the world are published in English'},
                        {id:'B', text:'Because most medical research is written by English scientists'},
                        {id:'C', text:'Because medicine conferences are often held in English'},
                        {id:'D', text:'Because many medical terms are English.'}
                    ],
                    correct: 'D',
                    explanation: "Dẫn chứng (Đoạn 3): 'Much of the <strong>technical terminology is based on English words</strong>' (Nhiều thuật ngữ kỹ thuật dựa trên từ tiếng Anh)."
                },
                {
                    id: 36, question: "Question 36: The word “essential” is OPPOSITE in meaning to ______.",
                    options: [
                        {id:'A', text:'Important'}, {id:'B', text:'vital'}, {id:'C', text:'crucial'}, {id:'D', text:'worthless'}
                    ],
                    correct: 'D',
                    explanation: "Essential (Thiết yếu/Quan trọng) >< <strong>Worthless</strong> (Vô giá trị). Các từ còn lại là đồng nghĩa."
                }
            ]
        },
        // GAP FILL SENTENCES
        {
            id: 'gapfill_sentences', type: 'gapfill-sentence',
            boxOptions: [
                {id: 'A', text: "For example, lowering the pitch of the voice may mean the end of a sentence."},
                {id: 'B', text: "When these visual signals are not possible, more formal signals may be needed."},
                {id: 'C', text: "I reply to you and so on"},
                {id: 'D', text: "In speech, the coding system is the language like English or Spanish"}
            ],
            text: `Face-to-face conversation is a two-way process. You speak to me, (37) _____. Two-way communication depends on having a coding system that is understood by both sender and receiver, and an agreed convention about signaling the beginning and end of the message. (38) ____; the convention that one person speaks at a time may seem too obvious to mention. In fact, the signals used in conversation and meetings are often non-verbal. (39) ______. A sharp intake of breath may signal the desire to interrupt, catching the chairman’s eye may indicate the desire to speak in a formal setting like a debate, a clenched fist may indicate anger. (40) ____`,
            questions: [
                { id: 37, correct: 'C', explanation: "Câu trước: 'You speak to me'. Cần một vế đối lại để thể hiện 'two-way process' -> 'I reply to you' (C)." },
                { id: 38, correct: 'D', explanation: "Câu trước nhắc đến 'coding system'. Đáp án D giải thích 'In speech, the coding system is the language...' -> Logic định nghĩa." },
                { id: 39, correct: 'A', explanation: "Câu trước nói tín hiệu thường là 'non-verbal'. Đáp án A đưa ví dụ 'lowering pitch' (hạ giọng) là một tín hiệu phi ngôn ngữ." },
                { id: 40, correct: 'B', explanation: "Đoạn văn liệt kê các tín hiệu thị giác (visual) như 'clenched fist'. Câu kết B nói 'Khi các tín hiệu visual này không khả thi...' -> Kết đoạn hợp lý." }
            ]
        }
    ];

    // RENDER FUNCTION
    const quizContainer = document.getElementById('quiz-container');

    function renderQuiz() {
        quizData.forEach((item, index) => {
            if (item.type === 'reading-group') {
                renderReadingGroup(item);
            } else if (item.type === 'gapfill-sentence') {
                renderGapFillSentence(item);
            } else if (item.type === 'visual') {
                renderVisualQuestion(item);
            } else {
                renderStandardQuestion(item);
            }
        });
    }

    function renderStandardQuestion(q) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${q.id}`;
        
        let html = `<div class="question-text">Question ${q.id}: ${q.question}</div>`;
        html += `<div class="options-grid">`;
        
        q.options.forEach(opt => {
            html += `<div class="option" onclick="selectOption(${q.id}, '${opt.id}')" id="opt-${q.id}-${opt.id}">
                        <strong>${opt.id}.</strong>&nbsp; ${opt.text}
                     </div>`;
        });
        html += `</div>`;
        
        html += `<button class="btn-check" onclick="checkQuestion(${q.id})">Kiểm tra (Check)</button>`;
        html += `<div class="explanation" id="exp-${q.id}">
                    <h4>Giải thích chi tiết:</h4>
                    ${q.explanation}
                 </div>`;
        
        card.innerHTML = html;
        quizContainer.appendChild(card);
    }

    function renderVisualQuestion(q) {
        const card = document.createElement('div');
        card.className = 'card';
        card.id = `card-${q.id}`;

        let visualHtml = '';
        if (q.visualType === 'sign') {
            visualHtml = `
                <div class="sign-box">
                    <div class="sign-icon">📚</div>
                    <div class="sign-text">${q.content.title}</div>
                </div>
            `;
        } else if (q.visualType === 'email') {
            visualHtml = `
                <div class="email-box">
                    <div class="email-header">
                        <div class="email-dots"><span></span><span></span><span></span></div>
                        <div class="email-meta">To: ${q.content.to}</div>
                        <div class="email-meta">Subject: ${q.content.subject}</div>
                    </div>
                    <div class="email-body">
                        ${q.content.body}
                    </div>
                </div>
            `;
        }

        let html = `<div class="question-text">Question ${q.id}: ${q.question}</div>`;
        html += visualHtml;
        html += `<div class="options-grid">`;
        
        q.options.forEach(opt => {
            html += `<div class="option" onclick="selectOption(${q.id}, '${opt.id}')" id="opt-${q.id}-${opt.id}">
                        <strong>${opt.id}.</strong>&nbsp; ${opt.text}
                     </div>`;
        });
        html += `</div>`;
        html += `<button class="btn-check" onclick="checkQuestion(${q.id})">Kiểm tra (Check)</button>`;
        html += `<div class="explanation" id="exp-${q.id}">
                    <h4>Giải thích chi tiết:</h4>
                    ${q.explanation}
                 </div>`;
        
        card.innerHTML = html;
        quizContainer.appendChild(card);
    }

    function renderReadingGroup(group) {
        const groupDiv = document.createElement('div');
        
        // Glossary Builder
        let glossaryHtml = '';
        if (group.glossary && group.glossary.length > 0) {
            glossaryHtml = `
                <table class="glossary-table">
                    <thead><tr><th>Word</th><th>Type</th><th>Meaning</th></tr></thead>
                    <tbody>
                        ${group.glossary.map(w => `<tr><td><strong>${w.word}</strong></td><td>${w.type}</td><td>${w.meaning}</td></tr>`).join('')}
                    </tbody>
                </table>
            `;
        }

        groupDiv.innerHTML = `
            <div class="data-box">
                <strong>READING TEXT:</strong><br>
                ${group.text}
                ${glossaryHtml}
            </div>
        `;
        quizContainer.appendChild(groupDiv);

        group.questions.forEach(q => {
            // Treat sub-questions as standard questions but link logically
            // We reuse renderStandardQuestion logic but modify ID slightly to avoid duplication in loop if needed
            // But here structure is clean.
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `card-${q.id}`;
            
            let html = `<div class="question-text">${q.question}</div>`;
            html += `<div class="options-grid">`;
            q.options.forEach(opt => {
                html += `<div class="option" onclick="selectOption(${q.id}, '${opt.id}')" id="opt-${q.id}-${opt.id}">
                            <strong>${opt.id}.</strong>&nbsp; ${opt.text}
                        </div>`;
            });
            html += `</div>`;
            html += `<button class="btn-check" onclick="checkQuestion(${q.id})">Kiểm tra (Check)</button>`;
            html += `<div class="explanation" id="exp-${q.id}">
                        <h4>Giải thích chi tiết:</h4>
                        ${q.explanation}
                    </div>`;
            card.innerHTML = html;
            quizContainer.appendChild(card);
            
            // Register sub-question into global logic map (implicit via ID)
        });
    }

    function renderGapFillSentence(group) {
        const container = document.createElement('div');
        container.className = 'card gap-fill-container';
        
        // Options Box
        let optionsHtml = `<div class="gap-options-box">`;
        group.boxOptions.forEach(opt => {
            optionsHtml += `<div><strong>${opt.id}.</strong> ${opt.text}</div>`;
        });
        optionsHtml += `</div>`;

        // Text Box
        let textHtml = `<div class="gap-text-box">${group.text}</div>`;

        // Answers Area
        let answersHtml = `<div class="question-text" style="margin-top:10px;">Select Answers:</div>`;
        
        group.questions.forEach(q => {
            answersHtml += `
                <div style="margin-bottom: 15px; border-top: 1px solid #eee; padding-top:10px;" id="card-${q.id}">
                    <strong>Question ${q.id}:</strong>
                    <div class="options-grid" style="grid-template-columns: repeat(4, 1fr); margin-top:5px;">
                        ${['A','B','C','D'].map(opt => `
                            <div class="option" style="justify-content:center;" onclick="selectOption(${q.id}, '${opt}')" id="opt-${q.id}-${opt}">
                                <strong>${opt}</strong>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn-check" onclick="checkQuestion(${q.id})" style="margin-top:5px; padding: 5px 10px; font-size:0.9rem;">Check Q${q.id}</button>
                    <div class="explanation" id="exp-${q.id}">
                        ${q.explanation}
                    </div>
                </div>
            `;
        });

        container.innerHTML = optionsHtml + textHtml + answersHtml;
        quizContainer.appendChild(container);
    }

    // STATE MANAGEMENT
    const userAnswers = {};

    function selectOption(qId, optionId) {
        // Prevent changing if already checked (optional, but good for study mode)
        if (document.getElementById(`exp-${qId}`).style.display === 'block') return;

        // Save answer
        userAnswers[qId] = optionId;

        // Visual update
        // Clear previous selection in this question group
        const options = document.querySelectorAll(`#card-${qId} .option`);
        options.forEach(el => el.classList.remove('selected'));
        
        // Select new
        const selectedEl = document.getElementById(`opt-${qId}-${optionId}`);
        if(selectedEl) selectedEl.classList.add('selected');

        updateProgress();
    }

    function checkQuestion(qId) {
        const selected = userAnswers[qId];
        if (!selected) {
            alert("Vui lòng chọn đáp án trước khi kiểm tra!");
            return;
        }

        // Find correct answer
        let correct = '';
        // Search in all data structures
        quizData.forEach(item => {
            if (item.id === qId) correct = item.correct;
            if (item.questions) {
                item.questions.forEach(sub => {
                    if (sub.id === qId) correct = sub.correct;
                });
            }
        });

        const selectedEl = document.getElementById(`opt-${qId}-${selected}`);
        const correctEl = document.getElementById(`opt-${qId}-${correct}`);

        // Show result
        if (selected === correct) {
            selectedEl.classList.add('correct');
        } else {
            selectedEl.classList.add('incorrect');
            correctEl.classList.add('correct');
        }

        // Show explanation
        const expEl = document.getElementById(`exp-${qId}`);
        expEl.style.display = 'block';
    }

    function updateProgress() {
        const count = Object.keys(userAnswers).length;
        document.getElementById('progress-count').innerText = count;
    }

    function submitAll() {
        let score = 0;
        let total = 40;
        let unAnswered = [];

        for (let i = 1; i <= total; i++) {
            if (!userAnswers[i]) {
                unAnswered.push(i);
            }
        }

        if (unAnswered.length > 0) {
            const confirmMsg = `Bạn chưa làm các câu: ${unAnswered.join(', ')}. Bạn có chắc chắn muốn nộp bài?`;
            if (!confirm(confirmMsg)) return;
        }

        // Calculate score and Reveal All
        for (let i = 1; i <= total; i++) {
            // Find data for logic
            let correct = '';
            quizData.forEach(item => {
                if (item.id === i) correct = item.correct;
                if (item.questions) {
                    item.questions.forEach(sub => {
                        if (sub.id === i) correct = sub.correct;
                    });
                }
            });

            if (userAnswers[i] === correct) {
                score++;
            }
            
            // Force check visual
            if (userAnswers[i]) {
                // If answered, logic is already handled by individual check or we force it now
                const selectedEl = document.getElementById(`opt-${i}-${userAnswers[i]}`);
                const correctEl = document.getElementById(`opt-${i}-${correct}`);
                
                if (userAnswers[i] === correct) {
                    selectedEl.classList.add('correct');
                } else {
                    selectedEl.classList.add('incorrect');
                    correctEl.classList.add('correct');
                }
            } else {
                // Mark missed question yellow or just show correct
                const correctEl = document.getElementById(`opt-${i}-${correct}`);
                if(correctEl) {
                    correctEl.style.border = "2px dashed #ffc107";
                    correctEl.style.backgroundColor = "#fff3cd";
                }
            }

            // Show all explanations
            const exp = document.getElementById(`exp-${i}`);
            if(exp) exp.style.display = 'block';
        }

        const scoreDisplay = document.getElementById('final-score');
        scoreDisplay.innerText = `Kết quả: ${score}/${total}`;
        scoreDisplay.style.display = 'block';
        
        alert(`Bạn đã hoàn thành bài thi!\nĐiểm số: ${score}/${total}`);
    }

    // Initialize
    renderQuiz();

</script>

</body>
</html>