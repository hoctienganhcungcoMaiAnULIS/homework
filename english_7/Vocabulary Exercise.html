<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Test - Ms Mai An ULIS</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --primary-light: #e7f1ff;
            --success-color: #28a745;
            --success-bg: #d4edda;
            --error-color: #dc3545;
            --error-bg: #f8d7da;
            --warning-color: #ffc107;
            --text-color: #333;
            --bg-color: #f4f6f9;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding-bottom: 80px; /* Space for footer */
        }

        /* HEADER */
        header {
            background-color: #fff;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--primary-color);
        }

        h1.teacher-name {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin: 0;
            font-weight: 700;
            text-transform: uppercase;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* CARD STYLE */
        .card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid transparent;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .question-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .section-title {
            background-color: var(--primary-color);
            color: #fff;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        /* WORD BOX FOR EX 1 & 2 */
        .word-box {
            background-color: var(--primary-light);
            border: 1px dashed var(--primary-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            font-weight: bold;
            color: var(--primary-color);
        }

        .word-item {
            background: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* INPUTS & SELECTS */
        select.form-control, input.form-control {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: inherit;
            margin: 0 5px;
            min-width: 150px;
        }

        /* OPTIONS GRID (MCQ) */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-label {
            display: block;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-label:hover {
            background-color: #f8f9fa;
        }

        input[type="radio"] {
            margin-right: 10px;
        }

        /* EXPLANATION BOX */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-top: 1px solid #eee;
            border-radius: 0 0 8px 8px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .exp-header {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
            font-size: 0.85rem;
        }

        .trans-text {
            color: #555;
            font-style: italic;
            margin-bottom: 8px;
            display: block;
        }

        .analysis-text {
            color: #333;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            font-size: 0.75rem;
            border-radius: 4px;
            margin-right: 5px;
            color: #fff;
            font-weight: bold;
        }
        .bg-noun { background-color: #17a2b8; }
        .bg-verb { background-color: #e83e8c; }
        .bg-adj { background-color: #fd7e14; }
        .bg-adv { background-color: #6f42c1; }

        /* BUTTONS */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn-check {
            background-color: #6c757d;
            color: white;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        .btn-check:hover { background-color: #5a6268; }

        .btn-submit {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,86,179,0.3);
            width: 100%;
        }
        .btn-submit:hover { background-color: #004494; }

        /* FOOTER */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 10px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 1001;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score-display {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
        }

        /* STATUS COLORS */
        .card.correct { border-left-color: var(--success-color); }
        .card.wrong { border-left-color: var(--error-color); }
        
        .card.correct .question-title { color: var(--success-color); }
        .card.wrong .question-title { color: var(--error-color); }

        .correct-answer-text {
            color: var(--success-color);
            font-weight: bold;
        }
        .wrong-answer-text {
            color: var(--error-color);
            text-decoration: line-through;
        }

        /* CUSTOM VISUALS FOR Q29 & Q30 */
        .visual-q29 {
            background: #fff9c4;
            padding: 15px;
            border: 1px solid #fbc02d;
            box-shadow: 3px 3px 5px rgba(0,0,0,0.1);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            margin-bottom: 15px;
            transform: rotate(-1deg);
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        .visual-q29:before {
            content: 'üìå Note:';
            display: block;
            font-weight: bold;
            color: #d32f2f;
            margin-bottom: 5px;
        }

        .visual-q30 {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 15px;
            max-width: 350px;
            margin: 0 auto 15px auto;
            border: 1px solid #90caf9;
            position: relative;
        }
        .visual-q30::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 20px;
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: #e3f2fd transparent;
            display: block;
            width: 0;
        }
        .msg-header {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 3px;
        }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
        }
        .glossary-table th, .glossary-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .glossary-table th {
            background-color: var(--primary-color);
            color: white;
        }
        .glossary-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 20px auto;
        }

        @keyframes fadeIn {
            from {opacity: 0}
            to {opacity: 1}
        }

    </style>
</head>
<body>

<header>
    <h1 class="teacher-name">Ms Mai An ULIS - English Test</h1>
</header>

<div class="container" id="quiz-container">
    </div>

<div class="container">
    <div class="card">
        <h2 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">Glossary (T·ª´ v·ª±ng n√¢ng cao)</h2>
        <table class="glossary-table">
            <thead>
                <tr>
                    <th>Word</th>
                    <th>Type</th>
                    <th>Meaning</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Feast</td><td>(n)</td><td>Y·∫øn ti·ªác, b·ªØa ƒÉn th·ªãnh so·∫°n</td></tr>
                <tr><td>Costume</td><td>(n)</td><td>Trang ph·ª•c h√≥a trang/truy·ªÅn th·ªëng</td></tr>
                <tr><td>Parade</td><td>(n)</td><td>Cu·ªôc di·ªÖu h√†nh</td></tr>
                <tr><td>Harvest</td><td>(n/v)</td><td>M√πa g·∫∑t, thu ho·∫°ch</td></tr>
                <tr><td>Reunion</td><td>(n)</td><td>S·ª± ƒëo√†n t·ª• (gia ƒë√¨nh)</td></tr>
                <tr><td>Symbol</td><td>(n)</td><td>Bi·ªÉu t∆∞·ª£ng</td></tr>
                <tr><td>Folk</td><td>(adj/n)</td><td>D√¢n gian, thu·ªôc v·ªÅ truy·ªÅn th·ªëng</td></tr>
                <tr><td>Decorate</td><td>(v)</td><td>Trang tr√≠</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="sticky-footer">
    <div class="score-display" id="score-text">Score: 0/0</div>
    <button class="btn btn-submit" onclick="submitAll()">N·ªòP B√ÄI</button>
</div>

<div id="resultModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 style="color: var(--primary-color)">K·∫øt qu·∫£ b√†i l√†m</h2>
    <div class="score-circle" id="modal-score">0</div>
    <p id="modal-message">Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh b√†i thi!</p>
    <button class="btn btn-submit" onclick="closeModal()">Xem chi ti·∫øt l·ªùi gi·∫£i</button>
  </div>
</div>

<script>
    // D·ªÆ LI·ªÜU B√ÄI T·∫¨P & GI·∫¢I TH√çCH
    const quizData = [
        // EXERCISE 1
        {
            section: "Exercise 1. Complete the sentences with the words from the box.",
            box: ["Film", "talent", "lunar", "exciting", "cook", "pray"],
            questions: [
                { id: 1, type: "fill", text: "People ___ banh chung for Tet holidays.", correct: "cook", 
                  expl: "<b>D·ªãch:</b> M·ªçi ng∆∞·ªùi <u>n·∫•u</u> b√°nh ch∆∞ng cho ng√†y T·∫øt.<br><b>Gi·∫£i th√≠ch:</b> C·ª•m t·ª´ 'cook banh chung' (n·∫•u b√°nh ch∆∞ng) l√† h√†nh ƒë·ªông ƒë·∫∑c tr∆∞ng ng√†y T·∫øt. C√°c t·ª´ kh√°c kh√¥ng h·ª£p nghƒ©a." },
                { id: 2, type: "fill", text: "The ___ show featured singing, dancing, comedy and other things.", correct: "talent", 
                  expl: "<b>D·ªãch:</b> Ch∆∞∆°ng tr√¨nh <u>t√†i nƒÉng</u> bao g·ªìm h√°t, m√∫a, h√†i k·ªãch...<br><b>Gi·∫£i th√≠ch:</b> 'Talent show' (Show di·ªÖn t√†i nƒÉng) l√† c·ª•m danh t·ª´ c·ªë ƒë·ªãnh (Compound Noun)." },
                { id: 3, type: "fill", text: "This is one of the most ___ festivals that I've been to.", correct: "exciting", 
                  expl: "<b>D·ªãch:</b> ƒê√¢y l√† m·ªôt trong nh·ªØng l·ªÖ h·ªôi <u>th√∫ v·ªã</u> nh·∫•t t√¥i t·ª´ng ƒë·∫øn.<br><b>Gi·∫£i th√≠ch:</b> C·∫ßn t√≠nh t·ª´ (Adjective) b·ªï nghƒ©a cho 'festivals'. 'Exciting' mi√™u t·∫£ t√≠nh ch·∫•t c·ªßa l·ªÖ h·ªôi." },
                { id: 4, type: "fill", text: "The Mid-Autumn Festival is on the 15th of ___ August.", correct: "lunar", 
                  expl: "<b>D·ªãch:</b> T·∫øt Trung Thu di·ªÖn ra v√†o ng√†y 15 th√°ng 8 <u>√Çm l·ªãch</u>.<br><b>Gi·∫£i th√≠ch:</b> 'Lunar August' ch·ªâ th√°ng 8 √¢m l·ªãch, th·ªùi ƒëi·ªÉm di·ªÖn ra Trung Thu." },
                { id: 5, type: "fill", text: "Hoi Mua Festival is held to thank the Rice God and ___ for a better new crop.", correct: "pray", 
                  expl: "<b>D·ªãch:</b> L·ªÖ h·ªôi H·ªôi M√πa ƒë∆∞·ª£c t·ªï ch·ª©c ƒë·ªÉ t·∫° ∆°n Th·∫ßn L√∫a v√† <u>c·∫ßu nguy·ªán</u> cho v·ª• m√πa m·ªõi t·ªët h∆°n.<br><b>Gi·∫£i th√≠ch:</b> C·∫•u tr√∫c 'to thank... and (to) pray'. 'Pray' (ƒë·ªông t·ª´) l√† c·∫ßu nguy·ªán." },
                { id: 6, type: "fill", text: "She was the best actress at the Cannes ___ Festival last year.", correct: "Film", 
                  expl: "<b>D·ªãch:</b> C√¥ ·∫•y l√† n·ªØ di·ªÖn vi√™n xu·∫•t s·∫Øc nh·∫•t t·∫°i Li√™n hoan <u>Phim</u> Cannes nƒÉm ngo√°i.<br><b>Gi·∫£i th√≠ch:</b> T√™n ri√™ng 'Cannes Film Festival' (Li√™n hoan phim Cannes)." }
            ]
        },
        // EXERCISE 2
        {
            section: "Exercise 2. Complete the sentences with the words from the box.",
            box: ["painting", "films", "costumes", "Christmas", "display", "cheese"],
            questions: [
                { id: 7, type: "fill", text: "We always have a big feast on ___ Day.", correct: "Christmas", 
                  expl: "<b>D·ªãch:</b> Ch√∫ng t√¥i lu√¥n c√≥ b·ªØa ti·ªác l·ªõn v√†o ng√†y <u>Gi√°ng sinh</u>.<br><b>Gi·∫£i th√≠ch:</b> 'Christmas Day' l√† ng√†y l·ªÖ c·ª• th·ªÉ, ph√π h·ª£p ng·ªØ c·∫£nh 'feast' (b·ªØa ti·ªác)." },
                { id: 8, type: "fill", text: "He loves ___ eggs at Easter.", correct: "painting", 
                  expl: "<b>D·ªãch:</b> Anh ·∫•y th√≠ch <u>v·∫Ω/t√¥ m√†u</u> tr·ª©ng v√†o l·ªÖ Ph·ª•c sinh.<br><b>Gi·∫£i th√≠ch:</b> 'Painting eggs' l√† ho·∫°t ƒë·ªông truy·ªÅn th·ªëng d·ªãp Easter. Sau 'loves' d√πng V-ing." },
                { id: 9, type: "fill", text: "People chase after a wheel of ___ at Cheese Rolling festival.", correct: "cheese", 
                  expl: "<b>D·ªãch:</b> M·ªçi ng∆∞·ªùi ƒëu·ªïi theo m·ªôt t·∫£ng <u>ph√¥ mai</u> t·∫°i l·ªÖ h·ªôi LƒÉn Ph√¥ mai.<br><b>Gi·∫£i th√≠ch:</b> T√™n l·ªÖ h·ªôi l√† 'Cheese Rolling', v·∫≠t ƒë∆∞·ª£c ƒëu·ªïi theo l√† 'wheel of cheese'." },
                { id: 10, type: "fill", text: "There are many interesting ___ at Cannes Film Festival.", correct: "films", 
                  expl: "<b>D·ªãch:</b> C√≥ r·∫•t nhi·ªÅu <u>b·ªô phim</u> th√∫ v·ªã t·∫°i LHP Cannes.<br><b>Gi·∫£i th√≠ch:</b> Li√™n hoan phim th√¨ ph·∫£i c√≥ 'films'." },
                { id: 11, type: "fill", text: "You can watch fireworks ___ with my family on New Year‚Äôs Eve.", correct: "display", 
                  expl: "<b>D·ªãch:</b> B·∫°n c√≥ th·ªÉ xem <u>tr√¨nh di·ªÖn</u> ph√°o hoa c√πng gia ƒë√¨nh t√¥i v√†o ƒë√™m Giao th·ª´a.<br><b>Gi·∫£i th√≠ch:</b> 'Fireworks display' (m√†n tr√¨nh di·ªÖn ph√°o hoa) l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh." },
                { id: 12, type: "fill", text: "Do you like wearing Dutch traditional ___?", correct: "costumes", 
                  expl: "<b>D·ªãch:</b> B·∫°n c√≥ th√≠ch m·∫∑c <u>trang ph·ª•c</u> truy·ªÅn th·ªëng H√† Lan kh√¥ng?<br><b>Gi·∫£i th√≠ch:</b> 'Traditional costumes' (Trang ph·ª•c truy·ªÅn th·ªëng)." }
            ]
        },
        // EXERCISE 3
        {
            section: "Exercise 3. Choose the correct word to complete the sentences.",
            questions: [
                { id: 13, type: "mcq", text: "___ is celebrated to remember the birth of Jesus Christ.", options: ["Christmas", "Thanksgiving"], correct: 0,
                  expl: "<b>A. Christmas: Gi√°ng sinh (ƒê√öNG)</b> - K·ª∑ ni·ªám ch√∫a Jesus ra ƒë·ªùi.<br>B. Thanksgiving: L·ªÖ T·∫° ∆°n." },
                { id: 14, type: "mcq", text: "Holi is a ___ that spreads love and harmony among people.", options: ["dance", "festival"], correct: 1,
                  expl: "<b>B. Festival: L·ªÖ h·ªôi (ƒê√öNG)</b> - Holi l√† l·ªÖ h·ªôi s·∫Øc m√†u.<br>A. Dance: ƒêi·ªáu nh·∫£y - Kh√¥ng ph√π h·ª£p ƒë·ªãnh nghƒ©a t·ªïng qu√°t." },
                { id: 15, type: "mcq", text: "People chase after a wheel of ___ at Cheese Rolling festival.", options: ["cheese", "potatoes"], correct: 0,
                  expl: "<b>A. Cheese: Ph√¥ mai (ƒê√öNG)</b> - T√™n l·ªÖ h·ªôi ƒë√£ g·ª£i √Ω ƒë√°p √°n.<br>B. Potatoes: Khoai t√¢y." },
                { id: 16, type: "mcq", text: "We ___ tomatoes at each other at La Tomatina.", options: ["eat", "throw"], correct: 1,
                  expl: "<b>B. Throw: N√©m (ƒê√öNG)</b> - L·ªÖ h·ªôi La Tomatina n·ªïi ti·∫øng v·ªõi vi·ªác n√©m c√† chua.<br>A. Eat: ƒÇn." },
                { id: 17, type: "mcq", text: "The dancers are trained to ___ folk dances.", options: ["wear", "perform"], correct: 1,
                  expl: "<b>B. Perform: Bi·ªÉu di·ªÖn (ƒê√öNG)</b> - ƒêi v·ªõi 'dances'.<br>A. Wear: M·∫∑c - Kh√¥ng ai n√≥i 'm·∫∑c ƒëi·ªáu nh·∫£y'." },
                { id: 18, type: "mcq", text: "The ___ is a folkloric figure and symbol of Easter.", options: ["Easter Bunny", "Black Cat"], correct: 0,
                  expl: "<b>A. Easter Bunny: Th·ªè Ph·ª•c sinh (ƒê√öNG)</b> - Bi·ªÉu t∆∞·ª£ng l·ªÖ Ph·ª•c sinh.<br>B. Black Cat: M√®o ƒëen (th∆∞·ªùng li√™n quan Halloween)." },
                { id: 19, type: "mcq", text: "Thousands of ___ come from different countries to attend the Twins Day Festival.", options: ["flowers", "twins"], correct: 1,
                  expl: "<b>B. Twins: C√°c c·∫∑p sinh ƒë√¥i (ƒê√öNG)</b> - L·ªÖ h·ªôi Twins Day d√†nh cho c√°c c·∫∑p sinh ƒë√¥i.<br>A. Flowers: Hoa." },
                { id: 20, type: "mcq", text: "We always ___ pine trees and give gifts to each other at Christmas.", options: ["plant", "decorate"], correct: 1,
                  expl: "<b>B. Decorate: Trang tr√≠ (ƒê√öNG)</b> - Trang tr√≠ c√¢y th√¥ng Noel.<br>A. Plant: Tr·ªìng - √çt ai tr·ªìng c√¢y ngay d·ªãp l·ªÖ ƒë·ªÉ ch∆°i." },
                { id: 21, type: "mcq", text: "Halloween is celebrated on the 31st of ___ every year.", options: ["October", "November"], correct: 0,
                  expl: "<b>A. October: Th√°ng 10 (ƒê√öNG)</b> - Halloween l√† 31/10.<br>B. November: Th√°ng 11." },
                { id: 22, type: "mcq", text: "She loves wearing ___ costumes such as '√Åo d√†i' and '√Åo b√† ba'.", options: ["traditional", "modern"], correct: 0,
                  expl: "<b>A. Traditional: Truy·ªÅn th·ªëng (ƒê√öNG)</b> - √Åo d√†i l√† trang ph·ª•c truy·ªÅn th·ªëng.<br>B. Modern: Hi·ªán ƒë·∫°i." }
            ]
        },
        // EXERCISE 4
        {
            section: "Exercise 4. Choose the word or phrase (A, B, C or D) that best fits the blank space.",
            questions: [
                { id: 23, type: "mcq4", text: "A __________ is a round cake traditionally eaten during the Mid-Autumn Festival.", 
                  options: ["hamburger", "mooncake", "cookie", "sandwich"], correct: 1,
                  expl: "<b>A. Hamburger:</b> B√°nh m√¨ k·∫πp.<br><b>B. Mooncake:</b> B√°nh trung thu (ƒê√öNG).<br><b>C. Cookie:</b> B√°nh quy.<br><b>D. Sandwich:</b> B√°nh m√¨ k·∫πp.<br>üëâ <b>Gi·∫£i th√≠ch:</b> B√°nh ƒë·∫∑c tr∆∞ng c·ªßa Trung thu (Mid-Autumn) l√† b√°nh trung thu." },
                
                { id: 24, type: "mcq4", text: "La Tomatina Festival is held in ___________.", 
                  options: ["England", "German", "Spain", "Turkey"], correct: 2,
                  expl: "<b>C. Spain: T√¢y Ban Nha (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> L·ªÖ h·ªôi n√©m c√† chua La Tomatina t·ªï ch·ª©c ·ªü Bu√±ol, T√¢y Ban Nha." },

                { id: 25, type: "mcq4", text: "Santa Claus often brings children presents at _________________.", 
                  options: ["Easter", "Christmas", "Tet", "Halloween"], correct: 1,
                  expl: "<b>B. Christmas: Gi√°ng sinh (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> √îng gi√† Noel (Santa Claus) xu·∫•t hi·ªán d·ªãp Gi√°ng sinh." },

                { id: 26, type: "mcq4", text: "Diwali is the festival of ____________.", 
                  options: ["harvests", "tomatoes", "dances", "lights"], correct: 3,
                  expl: "<b>D. Lights: √Ånh s√°ng (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Diwali ƒë∆∞·ª£c g·ªçi l√† 'Festival of Lights' (L·ªÖ h·ªôi √°nh s√°ng) c·ªßa ng∆∞·ªùi ·∫§n ƒê·ªô." },

                { id: 27, type: "mcq4", text: "The Golden _______________ is the symbol of the Cannes Film Festival.", 
                  options: ["Palm", "Pigeon", "Coin", "Pig"], correct: 0,
                  expl: "<b>A. Palm: C√†nh c·ªç (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Gi·∫£i th∆∞·ªüng cao qu√Ω nh·∫•t ·ªü Cannes l√† C√†nh C·ªç V√†ng (The Golden Palm/Palme d'Or)." },

                { id: 28, type: "mcq4", text: "We saw beautiful ____________ floats at a parade at the Tulip Festival.", 
                  options: ["tulip", "rose", "daisy", "lily"], correct: 0,
                  expl: "<b>A. Tulip (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> L·ªÖ h·ªôi Hoa Tulip (Tulip Festival) th√¨ xe hoa (floats) s·∫Ω trang tr√≠ b·∫±ng hoa tulip." },

                { id: 29, type: "mcq4", text: "She wore a beautiful traditional __________.", 
                  options: ["firework", "parade", "display", "costume"], correct: 3,
                  expl: "<b>D. Costume: Trang ph·ª•c (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> ƒê·ªông t·ª´ 'wore' (m·∫∑c) ch·ªâ ƒëi v·ªõi danh t·ª´ ch·ªâ qu·∫ßn √°o/trang ph·ª•c. C√°c t·ª´ kh√°c: firework (ph√°o hoa), parade (di·ªÖu h√†nh)." },

                { id: 30, type: "mcq4", text: "Children love ____________ eggs at Easter.", 
                  options: ["cooking", "eating", "painting", "making"], correct: 2,
                  expl: "<b>C. Painting: V·∫Ω/t√¥ m√†u (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ho·∫°t ƒë·ªông ƒë·∫∑c tr∆∞ng cho tr·∫ª em d·ªãp Easter l√† 'painting eggs' (v·∫Ω tr·ª©ng)." },

                { id: 31, type: "mcq4", text: "Most families have a big feast with roast __________ on Thanksgiving Day.", 
                  options: ["potatoes", "beef", "turkey", "sheep"], correct: 2,
                  expl: "<b>C. Turkey: G√† t√¢y (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> M√≥n ƒÉn truy·ªÅn th·ªëng c·ªßa L·ªÖ T·∫° ∆°n l√† g√† t√¢y quay (roast turkey)." },

                { id: 32, type: "mcq4", text: "Everybody wore a _________ at Halloween night, so no one knew who was really at the party.", 
                  options: ["mask", "towel", "dress", "shirt"], correct: 0,
                  expl: "<b>A. Mask: M·∫∑t n·∫° (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> 'No one knew who...' (kh√¥ng ai nh·∫≠n ra ai) => V√¨ h·ªç ƒëeo m·∫∑t n·∫°." },

                { id: 33, type: "mcq4", text: "The figure of Santa Claus has a long history in ___________ traditions.", 
                  options: ["Christmas", "Easter", "Thanksgiving", "Halloween"], correct: 0,
                  expl: "<b>A. Christmas (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Santa Claus g·∫Øn li·ªÅn v·ªõi truy·ªÅn th·ªëng Gi√°ng sinh." },

                { id: 34, type: "mcq4", text: "The beauty of traditional ao dai and ___________ dances are the highlight of Vietnamese cultural festivals.", 
                  options: ["dragon", "folk", "lion", "modern"], correct: 1,
                  expl: "<b>B. Folk: D√¢n gian (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> ƒêi ƒë√¥i v·ªõi 'traditional ao dai' (√°o d√†i truy·ªÅn th·ªëng) th√¨ 'folk dances' (ƒëi·ªáu m√∫a d√¢n gian) l√† h·ª£p ng·ªØ c·∫£nh vƒÉn h√≥a nh·∫•t." },

                { id: 35, type: "mcq4", text: "La Tomatina is ___________ in a small town in Spain.", 
                  options: ["holds", "hold", "holding", "held"], correct: 3,
                  expl: "<b>D. Held: ƒê∆∞·ª£c t·ªï ch·ª©c (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> C√¢u b·ªã ƒë·ªông (Passive Voice) v·ªõi th√¨ hi·ªán t·∫°i ƒë∆°n: is + V3/ed. V3 c·ªßa hold l√† held." },

                { id: 36, type: "mcq4", text: "Rio Carnival is famous for samba music and amazing ___________.", 
                  options: ["twins", "gifts", "wheels of cheese", "costumes"], correct: 3,
                  expl: "<b>D. Costumes: Trang ph·ª•c (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> L·ªÖ h·ªôi Carnival Rio n·ªïi ti·∫øng v·ªõi nh·∫°c Samba v√† c√°c b·ªô trang ph·ª•c l·ªông l·∫´y." },

                { id: 37, type: "mcq4", text: "Cannes ___________ Festival is held in Cannes, France every year.", 
                  options: ["Film", "Music", "Arts", "Drama"], correct: 0,
                  expl: "<b>A. Film (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Collocation: Cannes Film Festival." },

                { id: 38, type: "mcq4", text: "On Thanksgiving Day, we ___________ and play and talk.", 
                  options: ["have a feast", "perform a lion dance", "carve pumpkins", "throw tomatoes"], correct: 0,
                  expl: "<b>A. Have a feast: ƒÇn ti·ªác (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> L·ªÖ T·∫° ∆°n l√† d·ªãp ƒë·ªÉ ƒÉn u·ªëng t·ª• t·∫≠p. Carve pumpkins (Halloween), Lion dance (Tet), Throw tomatoes (La Tomatina)." },

                { id: 39, type: "mcq4", text: "___________ Egg Hunt is a fun holiday activity for kids of all ages.", 
                  options: ["Tulip Festival", "Easter", "Tet Holiday", "New Year"], correct: 1,
                  expl: "<b>B. Easter (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> 'Egg Hunt' (sƒÉn tr·ª©ng) l√† tr√≤ ch∆°i ƒë·∫∑c tr∆∞ng c·ªßa L·ªÖ Ph·ª•c sinh." },

                { id: 40, type: "mcq4", text: "The greatest flower event in Vietnam, ___________ is a show to remember.", 
                  options: ["Twins Day Festival", "Rio Carnival", "Hoi Mua Festival", "Da Lat Flower Festival"], correct: 3,
                  expl: "<b>D. Da Lat Flower Festival (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> S·ª± ki·ªán v·ªÅ hoa l·ªõn nh·∫•t Vi·ªát Nam => Festival hoa ƒê√† L·∫°t." },

                { id: 41, type: "mcq4", text: "___________ is the top prize at the Cannes Film Festival in France.", 
                  options: ["Easter Bunny", "The Golden Palm", "Moon Cake", "Candy Apple"], correct: 1,
                  expl: "<b>B. The Golden Palm (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Gi·∫£i th∆∞·ªüng C√†nh C·ªç V√†ng." },

                { id: 42, type: "mcq4", text: "At Tet, celebrations begin with the family ___________ dinner on the last evening of a lunar year.", 
                  options: ["dancing", "rolling", "floating", "gathering"], correct: 3,
                  expl: "<b>D. Gathering: T·ª• h·ªçp (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> B·ªØa c∆°m t·∫•t ni√™n l√† b·ªØa c∆°m sum h·ªçp (family gathering dinner)." },

                { id: 43, type: "mcq4", text: "__________ you always get up late on the weekends?", 
                  options: ["Is", "Are", "Do", "Does"], correct: 2,
                  expl: "<b>C. Do (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ch·ªß ng·ªØ 'you' + ƒë·ªông t·ª´ th∆∞·ªùng 'get up' => C√¢u h·ªèi nghi v·∫•n d√πng tr·ª£ ƒë·ªông t·ª´ 'Do'." },

                { id: 44, type: "mcq4", text: "_________ the girl in the fitting room?", 
                  options: ["Do", "Does", "Are", "Is"], correct: 3,
                  expl: "<b>D. Is (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ch·ªß ng·ªØ 'the girl' (s·ªë √≠t) + kh√¥ng c√≥ ƒë·ªông t·ª´ th∆∞·ªùng => D√πng ƒë·ªông t·ª´ To Be 'Is'." },

                { id: 45, type: "mcq4", text: "_________ the boys perform lion dances at the festival tomorrow?", 
                  options: ["Are", "Will", "Did", "Do"], correct: 1,
                  expl: "<b>B. Will (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'tomorrow' (t∆∞∆°ng lai) => D√πng 'Will'." },

                { id: 46, type: "mcq4", text: "_________ they watch fireworks display last night?", 
                  options: ["Will", "Did", "Can", "Are"], correct: 1,
                  expl: "<b>B. Did (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'last night' (qu√° kh·ª©) + ƒë·ªông t·ª´ th∆∞·ªùng 'watch' => D√πng tr·ª£ ƒë·ªông t·ª´ 'Did'." },

                { id: 47, type: "mcq4", text: "__________ she like reading romantic love stories?", 
                  options: ["Does", "Do", "Was", "Did"], correct: 0,
                  expl: "<b>A. Does (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ch·ªß ng·ªØ 'she' (s·ªë √≠t) + ƒë·ªông t·ª´ th∆∞·ªùng 'like' (hi·ªán t·∫°i) => D√πng 'Does'." },

                { id: 48, type: "mcq4", text: "_________ her children painting eggs now?", 
                  options: ["Are", "Is", "Were", "Was"], correct: 0,
                  expl: "<b>A. Are (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'now' (hi·ªán t·∫°i ti·∫øp di·ªÖn) + Ch·ªß ng·ªØ 'her children' (s·ªë nhi·ªÅu) => D√πng 'Are'." },

                { id: 49, type: "mcq4", text: "___________ she so happy at her birthday's party yesterday?", 
                  options: ["Is", "Was", "Does", "Did"], correct: 1,
                  expl: "<b>B. Was (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'yesterday' (qu√° kh·ª©) + t√≠nh t·ª´ 'happy' (kh√¥ng c√≥ ƒë·ªông t·ª´ th∆∞·ªùng) => D√πng To Be qu√° kh·ª© s·ªë √≠t 'Was'." },

                { id: 50, type: "mcq4", text: "I have a sore throat. __________ I drink cold water?", 
                  options: ["Were", "Did", "Will", "Should"], correct: 3,
                  expl: "<b>D. Should (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> C√¢u h·ªèi xin l·ªùi khuy√™n (T√¥i b·ªã ƒëau h·ªçng. T√¥i c√≥ n√™n u·ªëng n∆∞·ªõc l·∫°nh kh√¥ng?) => D√πng Modal verb 'Should'." },

                { id: 51, type: "mcq4", text: "___________ Mary and Ann your students 7 years ago?", 
                  options: ["Did", "Are", "Were", "Will"], correct: 2,
                  visualClass: "visual-q29",
                  expl: "<b>C. Were (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu '7 years ago' (qu√° kh·ª©). Ch·ªß ng·ªØ 'Mary and Ann' (s·ªë nhi·ªÅu) => D√πng To Be qu√° kh·ª© s·ªë nhi·ªÅu 'Were'." },

                { id: 52, type: "mcq4", text: "____________ you make apple cakes? - Yes, I can.", 
                  options: ["Can", "Should", "Will", "Are"], correct: 0,
                  visualClass: "visual-q30",
                  expl: "<b>A. Can (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> C√¢u tr·∫£ l·ªùi l√† 'Yes, I can' => C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng 'Can'." },

                { id: 53, type: "mcq4", text: "___________ 12 years old? ‚Äì No, I‚Äôm not.", 
                  options: ["You are", "Are you", "Do you", "Am I"], correct: 1,
                  expl: "<b>B. Are you (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> C√¢u h·ªèi v·ªÅ tu·ªïi t√°c v·ªõi To Be. ƒê·∫£o 'Are' l√™n tr∆∞·ªõc 'you'." },

                { id: 54, type: "mcq4", text: "Is your mother a teacher? ‚Äì Yes, ___________.", 
                  options: ["he isn‚Äôt", "he is", "she isn‚Äôt", "she is"], correct: 3,
                  expl: "<b>D. she is (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> M·∫π (mother) l√† n·ªØ => d√πng 'she'. C√¢u tr·∫£ l·ªùi 'Yes' => kh·∫≥ng ƒë·ªãnh 'is'." },

                { id: 55, type: "mcq4", text: "___________ your best friend? ‚Äì Yes, you are.", 
                  options: ["I am", "You are", "Am I", "Are you"], correct: 2,
                  expl: "<b>C. Am I (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ng∆∞·ªùi h·ªèi t·ª± h·ªèi v·ªÅ m√¨nh 'T√¥i c√≥ ph·∫£i b·∫°n th√¢n c·ªßa b·∫°n kh√¥ng?' (Am I...) => Ng∆∞·ªùi kia tr·∫£ l·ªùi 'Yes, you are' (ƒê√∫ng, b·∫°n ph·∫£i)." },

                { id: 56, type: "mcq4", text: "___________ they play all sorts of music in the festival?", 
                  options: ["Does", "Is", "Are", "Do"], correct: 3,
                  expl: "<b>D. Do (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Ch·ªß ng·ªØ 'they' + ƒë·ªông t·ª´ th∆∞·ªùng 'play' => Tr·ª£ ƒë·ªông t·ª´ 'Do'." },

                { id: 57, type: "mcq4", text: "___________ the cats in the garden? ‚Äì Yes, _____________.", 
                  options: ["Is ‚Äì it is", "Are ‚Äì the cats are", "Are ‚Äì they are", "Do ‚Äì they do"], correct: 2,
                  expl: "<b>C. Are ‚Äì they are (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Cats (s·ªë nhi·ªÅu) d√πng Are. Tr·∫£ l·ªùi thay th·∫ø Cats b·∫±ng ƒë·∫°i t·ª´ 'they'." },

                { id: 58, type: "mcq4", text: "___________ your school near your home? ‚Äì Yes, ______________.", 
                  options: ["Is ‚Äì it is", "Is ‚Äì I am", "Are ‚Äì they are", "Are ‚Äì I am"], correct: 0,
                  expl: "<b>A. Is ‚Äì it is (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> School (s·ªë √≠t, v·∫≠t) => H·ªèi 'Is'. Tr·∫£ l·ªùi d√πng ƒë·∫°i t·ª´ 'it'." },

                { id: 59, type: "mcq4", text: "___________ the girls have the tickets? ‚Äì No, ____________.", 
                  options: ["Do ‚Äì she isn‚Äôt", "Do ‚Äì they don‚Äôt", "Is ‚Äì she is", "Are ‚Äì they aren‚Äôt"], correct: 1,
                  expl: "<b>B. Do ‚Äì they don‚Äôt (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> ƒê·ªông t·ª´ th∆∞·ªùng 'have' => H·ªèi 'Do'. Girls (s·ªë nhi·ªÅu) => Tr·∫£ l·ªùi 'they don't'." },

                { id: 60, type: "mcq4", text: "___________ Nga and Loan like the festival? ‚Äì Yes, _____________.", 
                  options: ["Do ‚Äì they do", "Did ‚Äì they do", "Does ‚Äì she does", "Are ‚Äì she is"], correct: 0,
                  expl: "<b>A. Do ‚Äì they do (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Nga and Loan (2 ng∆∞·ªùi) => S·ªë nhi·ªÅu d√πng 'Do'. Tr·∫£ l·ªùi 'they do'." },

                { id: 61, type: "mcq4", text: "___________ Henry have a TV in his room? ‚Äì No, ______________.", 
                  options: ["Does ‚Äì he does", "Is ‚Äì he isn‚Äôt", "Does ‚Äì he doesn‚Äôt", "Do ‚Äì he doesn‚Äôt"], correct: 2,
                  expl: "<b>C. Does ‚Äì he doesn‚Äôt (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> Henry (s·ªë √≠t) + ƒë·ªông t·ª´ 'have' => H·ªèi 'Does'. Tr·∫£ l·ªùi No => 'he doesn't'." },

                { id: 62, type: "mcq4", text: "___________ your parents from Vietnam? ‚Äì No, _____________.", 
                  options: ["Were ‚Äì they aren‚Äôt", "Was ‚Äì they weren‚Äôt", "Are ‚Äì they are", "Are ‚Äì they aren‚Äôt"], correct: 3,
                  expl: "<b>D. Are ‚Äì they aren‚Äôt (ƒê√öNG).</b><br>üëâ <b>Gi·∫£i th√≠ch:</b> H·ªèi v·ªÅ xu·∫•t x·ª© (from...) d√πng To Be. Parents (s·ªë nhi·ªÅu) => Are. Tr·∫£ l·ªùi No => 'they aren't'." }
            ]
        }
    ];

    // RENDER FUNCTIONS
    const container = document.getElementById('quiz-container');

    function renderQuiz() {
        let questionCounter = 1;

        quizData.forEach((section, sIndex) => {
            // Render Section Title
            const sectionTitle = document.createElement('div');
            sectionTitle.className = 'section-title';
            sectionTitle.innerText = section.section;
            container.appendChild(sectionTitle);

            // Render Word Box if exists
            if (section.box) {
                const boxDiv = document.createElement('div');
                boxDiv.className = 'word-box';
                section.box.forEach(word => {
                    const span = document.createElement('span');
                    span.className = 'word-item';
                    span.innerText = word;
                    boxDiv.appendChild(span);
                });
                container.appendChild(boxDiv);
            }

            // Render Questions
            section.questions.forEach((q, qIndex) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${q.id}`;

                // Custom Visuals for Q29 (id 51 in array logic) & Q30 (id 52)
                let visualHTML = "";
                if (q.visualClass) {
                    let content = "";
                    if(q.visualClass === 'visual-q29') content = "Teacher's Note: Remember looking back at old photos!";
                    if(q.visualClass === 'visual-q30') content = "<div class='msg-header'>Message from: Mom</div>Can you bake a cake for me?";
                    visualHTML = `<div class="${q.visualClass}">${content}</div>`;
                }

                // Question Title
                let qTitle = `<div class="question-title">Question ${questionCounter}:</div>`;
                if (visualHTML) qTitle += visualHTML;
                
                let qContent = "";

                // Logic for FILL IN BLANK (Ex 1 & 2)
                if (q.type === 'fill') {
                    // Replace ___ with select box
                    const parts = q.text.split('___');
                    let selectHTML = `<select id="ans-${q.id}" class="form-control">
                        <option value="">--Select--</option>`;
                    // Add options from the box (case insensitive matching logic later)
                    // But for UX, let's just list the box words
                    section.box.forEach(w => {
                        selectHTML += `<option value="${w}">${w}</option>`;
                    });
                    selectHTML += `</select>`;
                    
                    qContent = `<div style="line-height: 2;">${parts[0]} ${selectHTML} ${parts[1]}</div>`;
                }
                
                // Logic for MCQ (Ex 3) - Binary
                else if (q.type === 'mcq') {
                    qContent = `<div style="margin-bottom:10px;">${q.text.replace('___', '...')}</div>
                    <div class="options-grid">
                        ${q.options.map((opt, i) => `
                            <label class="option-label">
                                <input type="radio" name="q${q.id}" value="${i}"> 
                                ${opt}
                            </label>
                        `).join('')}
                    </div>`;
                }

                // Logic for MCQ 4 (Ex 4)
                else if (q.type === 'mcq4') {
                    qContent = `<div style="margin-bottom:10px;">${q.text}</div>
                    <div class="options-grid">
                        ${q.options.map((opt, i) => `
                            <label class="option-label">
                                <input type="radio" name="q${q.id}" value="${i}"> 
                                <b>${String.fromCharCode(65+i)}.</b> ${opt}
                            </label>
                        `).join('')}
                    </div>`;
                }

                // Explanation Block
                const expHTML = `
                    <div class="explanation-box" id="exp-${q.id}">
                        <span class="exp-header">üìù GI·∫¢I TH√çCH CHI TI·∫æT:</span>
                        <div class="analysis-text">${q.expl}</div>
                    </div>
                `;

                // Check Button
                const btnHTML = `<button class="btn btn-check" onclick="checkOne(${sIndex}, ${qIndex})">Ki·ªÉm tra c√¢u n√†y</button>`;

                card.innerHTML = qTitle + qContent + btnHTML + expHTML;
                container.appendChild(card);
                questionCounter++;
            });
        });
        
        // Update max score
        document.getElementById('score-text').innerText = `Score: 0/${questionCounter-1}`;
    }

    // CHECK LOGIC FOR SINGLE QUESTION
    function checkOne(sectionIndex, qIndex) {
        const q = quizData[sectionIndex].questions[qIndex];
        const card = document.getElementById(`card-${q.id}`);
        const expBox = document.getElementById(`exp-${q.id}`);
        let isCorrect = false;
        let userAnswer = "";

        // Disable inputs after checking
        const inputs = card.querySelectorAll('input, select');
        inputs.forEach(i => i.disabled = true);
        card.querySelector('.btn-check').style.display = 'none'; // Hide check button

        if (q.type === 'fill') {
            const select = document.getElementById(`ans-${q.id}`);
            userAnswer = select.value;
            if (userAnswer.toLowerCase() === q.correct.toLowerCase()) isCorrect = true;
        } else {
            const selected = card.querySelector(`input[name="q${q.id}"]:checked`);
            if (selected && parseInt(selected.value) === q.correct) isCorrect = true;
            
            // Highlight options logic
            if(q.type === 'mcq' || q.type === 'mcq4') {
                const labels = card.querySelectorAll('.option-label');
                // Highlight correct one
                labels[q.correct].style.backgroundColor = "var(--success-bg)";
                labels[q.correct].style.borderColor = "var(--success-color)";
                labels[q.correct].style.fontWeight = "bold";

                if (!isCorrect && selected) {
                    selected.parentElement.style.backgroundColor = "var(--error-bg)";
                    selected.parentElement.style.borderColor = "var(--error-color)";
                }
            }
        }

        // Apply Styles
        if (isCorrect) {
            card.classList.add('correct');
        } else {
            card.classList.add('wrong');
        }

        // Show Explanation
        expBox.style.display = 'block';
        
        return isCorrect; // Return for Submit All function
    }

    // SUBMIT ALL LOGIC
    function submitAll() {
        let score = 0;
        let total = 0;
        let unanswered = 0;

        quizData.forEach((section, sIndex) => {
            section.questions.forEach((q, qIndex) => {
                total++;
                // Check if already checked by user?
                // Re-run check logic but purely for calculation
                // Note: If user already clicked "Check", inputs are disabled. 
                // We need to read values even if disabled.
                
                let isCorrect = false;
                let hasAnswer = false;

                if (q.type === 'fill') {
                    const val = document.getElementById(`ans-${q.id}`).value;
                    if(val) hasAnswer = true;
                    if (val.toLowerCase() === q.correct.toLowerCase()) isCorrect = true;
                } else {
                    const selected = document.querySelector(`input[name="q${q.id}"]:checked`);
                    if(selected) {
                        hasAnswer = true;
                        if(parseInt(selected.value) === q.correct) isCorrect = true;
                    }
                }

                if (!hasAnswer) unanswered++;
                if (isCorrect) score++;

                // Trigger visual check for all
                checkOne(sIndex, qIndex);
            });
        });

        // Show Modal
        const modal = document.getElementById('resultModal');
        const scoreCircle = document.getElementById('modal-score');
        const msg = document.getElementById('modal-message');

        scoreCircle.innerText = `${score}`;
        
        let feedback = "";
        if(score === total) feedback = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ti·∫øng Anh! üåü";
        else if(score > total * 0.8) feedback = "L√†m r·∫•t t·ªët! Ch·ªâ sai m·ªôt ch√∫t th√¥i. üí™";
        else if(score > total * 0.5) feedback = "Kh√° t·ªët, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©. üìö";
        else feedback = "C·ªë g·∫Øng l√™n! H√£y √¥n l·∫°i t·ª´ v·ª±ng v√† ng·ªØ ph√°p nh√©. üî•";

        msg.innerHTML = `${feedback}<br>B·∫°n l√†m ƒë√∫ng ${score}/${total} c√¢u.`;
        
        modal.style.display = "block";
        document.getElementById('score-text').innerText = `Score: ${score}/${total}`;
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = "none";
    }

    // Initialize
    window.onload = renderQuiz;

</script>

</body>
</html>


