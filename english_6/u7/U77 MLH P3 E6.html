<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-pattern: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(var(--secondary) 1px, transparent 1px), radial-gradient(var(--primary) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-main);
            margin: 0;
            padding-bottom: 80px; /* Space for sticky footer */
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            color: white;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-family: 'Quicksand', sans-serif;
            font-size: 2.5rem;
            margin: 0;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-top: 10px;
        }

        /* CARD STYLES */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05), 0 15px 20px rgba(0,0,0,0.1);
            border: 2px solid #eee;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .section-title {
            color: var(--primary);
            font-size: 1.5rem;
            border-left: 5px solid var(--secondary);
            padding-left: 15px;
            margin-bottom: 20px;
            font-weight: 800;
        }

        /* TEXT STYLES */
        .passage-text {
            font-size: 1.1rem;
            line-height: 1.8;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid var(--secondary);
            margin-bottom: 20px;
        }

        /* QUESTIONS */
        .question-block {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }

        .question-text {
            font-weight: 700;
            font-size: 1.15rem;
            margin-bottom: 15px;
        }

        /* OPTIONS (GAMIFICATION BUTTONS) */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #555;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #e0e0e0;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #e0e0e0;
            border-color: var(--secondary);
            background: #f0fffc;
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #e0e0e0;
        }

        /* STATES */
        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #00b85c;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: #e03e4d;
            box-shadow: 0 4px 0 #e03e4d;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* EXPLANATION BOX */
        .explanation {
            display: none;
            margin-top: 15px;
            background: #fff8e1;
            border: 2px solid #ffe082;
            border-radius: 15px;
            padding: 15px;
            font-size: 0.95rem;
        }

        .explanation.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .teacher-note {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .teacher-note::before {
            content: 'üë©‚Äçüè´';
            font-size: 1.5rem;
        }

        .detail-row {
            margin-bottom: 8px;
        }
        .detail-label {
            font-weight: 800;
            color: #444;
            display: inline-block;
            width: 100px;
        }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .glossary-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .glossary-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .glossary-table tr:last-child td {
            border-bottom: none;
        }

        .word-type {
            font-style: italic;
            color: #888;
            font-size: 0.9em;
        }

        /* GAP FILL SPECIFIC */
        .gap-fill-container {
            line-height: 2.2;
        }
        .gap-input {
            display: inline-block;
            min-width: 80px;
            padding: 5px 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: white;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            cursor: pointer;
            margin: 0 5px;
        }
        .gap-input.filled-correct {
            background-color: var(--correct);
            color: white;
            border-color: var(--correct);
        }
        .gap-input.filled-wrong {
            background-color: var(--wrong);
            color: white;
            border-color: var(--wrong);
        }

        /* STICKY FOOTER */
        .footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .btn-submit {
            background: var(--primary);
            color: white;
            font-size: 1.2rem;
            padding: 12px 40px;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 5px 0 #6c429c;
            transition: all 0.2s;
            margin: 0 auto;
            display: block;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #6c429c;
        }

        .btn-submit:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #6c429c;
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 500px;
            animation: slideDown 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;
        }
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            font-size: 3rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            border: 5px solid white;
            box-shadow: 0 0 0 5px var(--primary);
        }
        .close-modal {
            margin-top: 20px;
            background: #eee;
            border: none;
            padding: 10px 30px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
        }

        /* CANVAS CONFETTI */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>ENGLISH TEST - GRADE 7/8</h1>
        <p>Gi√°o vi√™n: Ms. Mai An (ULIS - VNU)</p>
        <p style="font-size: 0.9rem">Ch·ªß ƒë·ªÅ: Television & Media</p>
    </header>

    <div class="card" id="part1">
        <h2 class="section-title">Part 1: Complete the Conversation</h2>
        <p><i>Click v√†o c√°c ƒë√°p √°n b√™n d∆∞·ªõi ƒë·ªÉ ƒëi·ªÅn v√†o ch·ªó tr·ªëng t∆∞∆°ng ·ª©ng.</i></p>
        
        <div class="passage-text">
            <strong>Bob:</strong> (1) <span id="gap1-display" class="gap-input">???</span><br>
            <strong>David:</strong> Mostly for one hour. (2) <span id="gap2-display" class="gap-input">???</span><br>
            <strong>Bob:</strong> (3) <span id="gap3-display" class="gap-input">???</span><br>
            <strong>David:</strong> I watch it for information and entertainment.<br>
            <strong>Bob:</strong> (4) <span id="gap4-display" class="gap-input">???</span><br>
            <strong>David:</strong> I like to watch sports channel ESPN.<br>
            <strong>David:</strong> I also watch Discovery, History and some news channels.<br>
            <strong>Bob:</strong> (6) <span id="gap6-display" class="gap-input">???</span><br>
            <strong>David:</strong> Most of the cartoon movies refresh our mind.
        </div>

        <div id="p1-questions">
            </div>
    </div>

    <div class="card" id="part2">
        <h2 class="section-title">Part 2: Complete the Passage</h2>
        <p><i>Ch·ªçn t·ª´ th√≠ch h·ª£p ƒë·ªÉ ƒëi·ªÅn v√†o ƒëo·∫°n vƒÉn.</i></p>
        <div style="background: #e1f5fe; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; text-align: center; color: var(--primary);">
            friends | because | crazy | enjoy | programme | entertainment | restrict | fond
        </div>

        <div class="passage-text" style="line-height: 2.5;">
            For me TV is the best source of (1) <span class="gap-input" onclick="showGapModal(2, 1)">...</span>. I can relax and have fun at the same time. My favourite TV (2) <span class="gap-input" onclick="showGapModal(2, 2)">...</span> is ‚ÄúHow I met your mother‚Äù. I like it (3) <span class="gap-input" onclick="showGapModal(2, 3)">...</span> it is funny and I (4) <span class="gap-input" onclick="showGapModal(2, 4)">...</span> myself a lot. I watch it every day. The series follows the main character Ted Mosby, and his group of (5) <span class="gap-input" onclick="showGapModal(2, 5)">...</span> in Manhattan. I am also (6) <span class="gap-input" onclick="showGapModal(2, 6)">...</span> of ‚ÄúCriminal Minds‚Äù and ‚ÄúCSI:NY‚Äù.<br>
            TV is indeed very important for me. I would go (7) <span class="gap-input" onclick="showGapModal(2, 7)">...</span> if I couldn‚Äôt watch it for a week. My parents sometimes have to (8) <span class="gap-input" onclick="showGapModal(2, 8)">...</span> my television viewing, but that‚Äôs okay.
        </div>
        
        <div id="part2-explanations"></div>
    </div>

    <div class="card" id="part3">
        <h2 class="section-title">Part 3: Reading Passages</h2>
        
        <div class="passage-text">
            <strong>Steve, 13</strong><br>
            I love TV. The first thing I do when I wake up is to switch it on. My favourite channel is the Cartoon Network. I watch TV three or four hours a day. My parents think it is too much and they are always telling me to study, read a little or do a sport. But TV is my favourite hobby. I‚Äôm addicted to my favourite progammes.<br><br>

            <strong>Kate, 14</strong><br>
            I know most teens don‚Äôt like watching the news, but I do. I like to know what is happening around our world. I also enjoy documentaries, especially about wildlife. I‚Äôm very curious about the way animals live and how to preserve their habitats. I also enjoy watching live shows and films, mostly comedies and thrillers. I watch TV two or three hours a day.<br><br>

            <strong>Rachel, 17</strong><br>
            I like TV as everybody else, but now that I‚Äôm older I am more selective about the programmes I watch. I used to watch cartoons all the time. Now I like watching the news and some games shows like ‚ÄúWho wants to be a millionaire?‚Äù, so I don‚Äôt really spend too much time in front of the box, an hour or two a day... Some programmes are educational and help us to use our imagination, but many are full of violence.
        </div>

        <h3 style="color: var(--secondary);">üìö GLOSSARY (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</h3>
        <table class="glossary-table">
            <thead>
                <tr>
                    <th>Word / Phrase</th>
                    <th>Type</th>
                    <th>Meaning (Ti·∫øng Vi·ªát)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Addicted (to)</td><td><span class="word-type">adj</span></td><td>Nghi·ªán, qu√° say m√™</td></tr>
                <tr><td>Documentary</td><td><span class="word-type">n</span></td><td>Phim t√†i li·ªáu</td></tr>
                <tr><td>Wildlife</td><td><span class="word-type">n</span></td><td>Cu·ªôc s·ªëng hoang d√£</td></tr>
                <tr><td>Preserve</td><td><span class="word-type">v</span></td><td>B·∫£o t·ªìn, g√¨n gi·ªØ</td></tr>
                <tr><td>Habitat</td><td><span class="word-type">n</span></td><td>M√¥i tr∆∞·ªùng s·ªëng</td></tr>
                <tr><td>Thriller</td><td><span class="word-type">n</span></td><td>Phim kinh d·ªã, gi·∫≠t g√¢n</td></tr>
                <tr><td>Selective</td><td><span class="word-type">adj</span></td><td>C√≥ ch·ªçn l·ªçc</td></tr>
                <tr><td>Violence</td><td><span class="word-type">n</span></td><td>B·∫°o l·ª±c</td></tr>
                <tr><td>Imagination</td><td><span class="word-type">n</span></td><td>Tr√≠ t∆∞·ªüng t∆∞·ª£ng</td></tr>
                <tr><td>Curious</td><td><span class="word-type">adj</span></td><td>T√≤ m√≤, hi·∫øu k·ª≥</td></tr>
            </tbody>
        </table>
    </div>

    <div class="card" id="part4">
        <h2 class="section-title">Part 4: Reading Comprehension</h2>
        
        <h3>A. True or False?</h3>
        <div id="tf-questions">
            </div>

        <h3>B. Multiple Choice</h3>
        <div id="mc-questions">
            </div>
    </div>

</div>

<div class="footer-bar">
    <div style="font-weight: bold; color: var(--primary);">Ms. Mai An - ULIS</div>
    <button class="btn-submit" onclick="submitAll()">N·ªòP B√ÄI üöÄ</button>
</div>

<div class="modal-overlay" id="result-modal">
    <div class="modal-content">
        <div class="score-circle" id="final-score">0</div>
        <h2 style="color: var(--primary);">K·∫øt qu·∫£ c·ªßa b·∫°n</h2>
        <p id="feedback-text">B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
        <button class="close-modal" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
    </div>
</div>

<div class="modal-overlay" id="gap-modal">
    <div class="modal-content">
        <h3>Ch·ªçn t·ª´/c√¢u ƒë·ªÉ ƒëi·ªÅn v√†o ch·ªó tr·ªëng:</h3>
        <div id="gap-options-container" class="options-grid"></div>
        <button class="close-modal" onclick="document.getElementById('gap-modal').style.display='none'">ƒê√≥ng</button>
    </div>
</div>

<script>
    // --- DATA ---
    const part1Data = [
        {
            id: 'p1q1', gapIndex: 1,
            question: "Bob: (1) _____________________",
            correct: "D",
            options: [
                {val: "A", text: "A. Don‚Äôt you watch any other channel?"},
                {val: "B", text: "B. Why do you watch television?"},
                {val: "C", text: "C. What is your opinion about cartoon films?"},
                {val: "D", text: "D. How many hours do you watch TV every day?"}
            ],
            trans_q: "Bob h·ªèi v·ªÅ th·ªùi gian xem TV.",
            trans_opts: "A. B·∫°n kh√¥ng xem k√™nh n√†o kh√°c √†? | B. T·∫°i sao b·∫°n xem TV? | C. √ù ki·∫øn b·∫°n v·ªÅ ho·∫°t h√¨nh? | D. B·∫°n xem TV bao nhi√™u ti·∫øng m·ªói ng√†y?",
            why_correct: "C√¢u tr·∫£ l·ªùi c·ªßa David l√† 'Mostly for one hour' (H·∫ßu nh∆∞ l√† 1 ti·∫øng). C√¢u h·ªèi v·ªÅ s·ªë l∆∞·ª£ng th·ªùi gian (How many hours) l√† ph√π h·ª£p nh·∫•t.",
            why_wrong: "C√°c c√¢u kh√°c kh√¥ng kh·ªõp v·ªõi c√¢u tr·∫£ l·ªùi v·ªÅ th·ªùi gian."
        },
        {
            id: 'p1q2', gapIndex: 2,
            question: "David: Mostly for one hour. (2) _____________________",
            correct: "F",
            options: [
                {val: "E", text: "E. Which is your favourite TV channel?"},
                {val: "F", text: "F. On weekends I may watch for two hours or more."},
                {val: "A", text: "A. Don‚Äôt you watch any other channel?"},
                {val: "B", text: "B. Why do you watch television?"}
            ],
            trans_q: "David n√≥i th√™m v·ªÅ th√≥i quen cu·ªëi tu·∫ßn.",
            trans_opts: "E. K√™nh y√™u th√≠ch? | F. Cu·ªëi tu·∫ßn t√¥i c√≥ th·ªÉ xem 2 ti·∫øng ho·∫∑c h∆°n. | A. B·∫°n kh√¥ng xem k√™nh kh√°c √†? | B. T·∫°i sao xem TV?",
            why_correct: "C√¢u tr∆∞·ªõc n√≥i 'th∆∞·ªùng l√† 1 ti·∫øng'. C√¢u n√†y b·ªï sung th√¥ng tin t∆∞∆°ng ph·∫£n 'v√†o cu·ªëi tu·∫ßn th√¨ xem nhi·ªÅu h∆°n'. H·ª£p l√Ω v·ªÅ m·∫°ch vƒÉn.",
            why_wrong: "C√°c c√¢u h·ªèi (A, B, E) kh√¥ng ph√π h·ª£p v√¨ ƒë√¢y l√† l∆∞·ª£t l·ªùi c·ªßa David ƒëang tr·∫£ l·ªùi/k·ªÉ l·ªÉ."
        },
        {
            id: 'p1q3', gapIndex: 3,
            question: "Bob: (3) _____________________",
            correct: "B",
            options: [
                {val: "B", text: "B. Why do you watch television?"},
                {val: "C", text: "C. What is your opinion about cartoon films?"},
                {val: "E", text: "E. Which is your favourite TV channel?"},
                {val: "A", text: "A. Don‚Äôt you watch any other channel?"}
            ],
            trans_q: "Bob h·ªèi l√Ω do.",
            trans_opts: "B. T·∫°i sao b·∫°n xem TV? | C. √ù ki·∫øn v·ªÅ ho·∫°t h√¨nh? | E. K√™nh y√™u th√≠ch? | A. Kh√¥ng xem k√™nh kh√°c √†?",
            why_correct: "C√¢u tr·∫£ l·ªùi c·ªßa David l√† 'I watch it for information and entertainment' (T√¥i xem ƒë·ªÉ l·∫•y th√¥ng tin v√† gi·∫£i tr√≠). ƒê√¢y l√† c√¢u tr·∫£ l·ªùi cho c√¢u h·ªèi 'T·∫°i sao' (Why).",
            why_wrong: "C√°c c√¢u kh√°c kh√¥ng h·ªèi v·ªÅ m·ª•c ƒë√≠ch/l√Ω do."
        },
        {
            id: 'p1q4', gapIndex: 4,
            question: "Bob: (4) _____________________",
            correct: "E",
            options: [
                {val: "E", text: "E. Which is your favourite TV channel?"},
                {val: "A", text: "A. Don‚Äôt you watch any other channel?"},
                {val: "C", text: "C. What is your opinion about cartoon films?"},
                {val: "D", text: "D. How many hours...?"}
            ],
            trans_q: "Bob h·ªèi v·ªÅ k√™nh y√™u th√≠ch.",
            trans_opts: "E. K√™nh TV y√™u th√≠ch c·ªßa b·∫°n l√† g√¨? | A. Kh√¥ng xem k√™nh kh√°c √†? | C. √ù ki·∫øn v·ªÅ ho·∫°t h√¨nh?",
            why_correct: "David tr·∫£ l·ªùi: 'I like to watch sports channel ESPN'. C√¢u h·ªèi v·ªÅ 'favourite TV channel' kh·ªõp ho√†n to√†n v·ªõi c√¢u tr·∫£ l·ªùi.",
            why_wrong: "A l√† c√¢u h·ªèi Yes/No. C h·ªèi v·ªÅ ho·∫°t h√¨nh, kh√¥ng kh·ªõp v·ªõi c√¢u tr·∫£ l·ªùi v·ªÅ th·ªÉ thao."
        },
        {
            id: 'p1q6', gapIndex: 6,
            question: "Bob: (6) _____________________",
            correct: "C",
            options: [
                {val: "C", text: "C. What is your opinion about cartoon films?"},
                {val: "A", text: "A. Don‚Äôt you watch any other channel?"},
                {val: "B", text: "B. Why do you watch television?"},
                {val: "F", text: "F. On weekends..."}
            ],
            trans_q: "Bob h·ªèi √Ω ki·∫øn v·ªÅ ho·∫°t h√¨nh.",
            trans_opts: "C. B·∫°n nghƒ© g√¨ v·ªÅ phim ho·∫°t h√¨nh? | A. Kh√¥ng xem k√™nh kh√°c √†? | B. T·∫°i sao xem TV?",
            why_correct: "David tr·∫£ l·ªùi: 'Most of the cartoon movies refresh our mind' (H·∫ßu h·∫øt ho·∫°t h√¨nh gi√∫p th∆∞ gi√£n ƒë·∫ßu √≥c). ƒê√¢y l√† √Ω ki·∫øn (opinion) v·ªÅ ho·∫°t h√¨nh.",
            why_wrong: "C√°c c√¢u c√≤n l·∫°i kh√¥ng li√™n quan ƒë·∫øn 'cartoon'."
        }
    ];

    const part2Data = [
        {id: 1, word: "entertainment", correct: "entertainment", trans: "gi·∫£i tr√≠", explain: "C·ª•m t·ª´ 'source of entertainment' (ngu·ªìn gi·∫£i tr√≠)."},
        {id: 2, word: "programme", correct: "programme", trans: "ch∆∞∆°ng tr√¨nh", explain: "TV programme (ch∆∞∆°ng tr√¨nh TV). Theo sau l√† t√™n phim 'How I met your mother'."},
        {id: 3, word: "because", correct: "because", trans: "b·ªüi v√¨", explain: "N·ªëi hai m·ªánh ƒë·ªÅ ch·ªâ nguy√™n nh√¢n - k·∫øt qu·∫£: T√¥i th√≠ch n√≥ [b·ªüi v√¨] n√≥ h√†i h∆∞·ªõc."},
        {id: 4, word: "enjoy", correct: "enjoy", trans: "t·∫≠n h∆∞·ªüng", explain: "C·∫•u tr√∫c 'enjoy myself' (c·∫£m th·∫•y vui v·∫ª/t·∫≠n h∆∞·ªüng)."},
        {id: 5, word: "friends", correct: "friends", trans: "b·∫°n b√®", explain: "Ng·ªØ c·∫£nh phim: Ted Mosby v√† nh√≥m [b·∫°n] c·ªßa anh ·∫•y."},
        {id: 6, word: "fond", correct: "fond", trans: "y√™u th√≠ch", explain: "C·∫•u tr√∫c 'to be fond of something' = th√≠ch c√°i g√¨ ƒë√≥."},
        {id: 7, word: "crazy", correct: "crazy", trans: "ph√°t ƒëi√™n", explain: "Idiom: 'go crazy' (tr·ªü n√™n ph√°t ƒëi√™n/kh√≥ ch·ªãu) n·∫øu kh√¥ng ƒë∆∞·ª£c xem TV."},
        {id: 8, word: "restrict", correct: "restrict", trans: "h·∫°n ch·∫ø", explain: "B·ªë m·∫π ph·∫£i [h·∫°n ch·∫ø] vi·ªác xem TV l·∫°i v√¨ xem nhi·ªÅu qu√°."}
    ];
    
    // Word bank for P2
    const p2Words = ["friends", "because", "crazy", "enjoy", "programme", "entertainment", "restrict", "fond"];

    const part4TF = [
        {
            id: 'tf1', q: "1. Steve is obsessed about TV.", ans: true,
            trans: "Steve b·ªã √°m ·∫£nh b·ªüi TV.",
            why: "ƒê√∫ng. Trong b√†i ƒë·ªçc Steve n√≥i: 'I‚Äôm addicted to my favourite progammes.' (Addicted = Obsessed = Nghi·ªán/√Åm ·∫£nh).",
            why_not: ""
        },
        {
            id: 'tf2', q: "2. Kate doesn‚Äôt like watching the news.", ans: false,
            trans: "Kate kh√¥ng th√≠ch xem tin t·ª©c.",
            why: "Sai. Kate n√≥i: 'I know most teens don‚Äôt like watching the news, but I do.' (T√¥i bi·∫øt ƒëa s·ªë gh√©t tin t·ª©c, nh∆∞ng t√¥i th√¨ c√≥).",
            why_not: ""
        },
        {
            id: 'tf3', q: "3. Rachel‚Äôs favourite programmes are still cartoons.", ans: false,
            trans: "Ch∆∞∆°ng tr√¨nh y√™u th√≠ch c·ªßa Rachel v·∫´n l√† ho·∫°t h√¨nh.",
            why: "Sai. Rachel n√≥i: 'I used to watch cartoons... Now I like watching the news...' (T√¥i t·ª´ng xem ho·∫°t h√¨nh... Gi·ªù t√¥i th√≠ch xem tin t·ª©c).",
            why_not: ""
        },
        {
            id: 'tf4', q: "4. Kate likes watching things that make her laugh.", ans: true,
            trans: "Kate th√≠ch xem nh·ªØng th·ª© l√†m c√¥ ·∫•y c∆∞·ªùi.",
            why: "ƒê√∫ng. Kate n√≥i c√¥ ·∫•y th√≠ch: 'mostly comedies' (ch·ªß y·∫øu l√† phim h√†i).",
            why_not: ""
        },
        {
            id: 'tf5', q: "5. Rachel is the teenager who watches less TV of the three.", ans: true,
            trans: "Rachel l√† ng∆∞·ªùi xem √≠t TV nh·∫•t trong 3 ng∆∞·ªùi.",
            why: "ƒê√∫ng. Steve (3-4 gi·ªù), Kate (2-3 gi·ªù), Rachel (an hour or two - 1 ho·∫∑c 2 gi·ªù).",
            why_not: ""
        },
        {
            id: 'tf6', q: "6. Steve‚Äôs parents don‚Äôt mind that he watches so much TV.", ans: false,
            trans: "B·ªë m·∫π Steve kh√¥ng phi·ªÅn vi·ªác c·∫≠u ·∫•y xem nhi·ªÅu TV.",
            why: "Sai. Steve k·ªÉ: 'My parents think it is too much' (B·ªë m·∫π nghƒ© th·∫ø l√† qu√° nhi·ªÅu).",
            why_not: ""
        }
    ];

    const part4MC = [
        {
            id: 'mc1', 
            q: "1. Which TV programme does Steve like watching?",
            options: [
                {val: "A", text: "The news and documentaries"},
                {val: "B", text: "Cartoons (on Cartoon Network)"},
                {val: "C", text: "Comedies and thrillers"},
                {val: "D", text: "Game shows"}
            ],
            correct: "B",
            trans_q: "Steve th√≠ch xem ch∆∞∆°ng tr√¨nh n√†o?",
            trans_opts: "A. Tin t·ª©c & phim t√†i li·ªáu | B. Ho·∫°t h√¨nh | C. H√†i & k·ªãch t√≠nh | D. Tr√≤ ch∆°i truy·ªÅn h√¨nh",
            why_correct: "D·∫´n ch·ª©ng: 'My favourite channel is the Cartoon Network.' (K√™nh y√™u th√≠ch l√† Cartoon Network).",
            why_wrong: "A l√† s·ªü th√≠ch c·ªßa Kate. C l√† s·ªü th√≠ch c·ªßa Kate. D l√† s·ªü th√≠ch c·ªßa Rachel."
        },
        {
            id: 'mc2', 
            q: "2. Why does Kate like watching documentaries on wildlife?",
            options: [
                {val: "A", text: "Because she wants to be selective..."},
                {val: "B", text: "Because she likes to know what is happening..."},
                {val: "C", text: "Because she is curious about how animals live..."},
                {val: "D", text: "Because she thinks most programmes are educational..."}
            ],
            correct: "C",
            trans_q: "T·∫°i sao Kate th√≠ch xem phim t√†i li·ªáu v·ªÅ th·∫ø gi·ªõi hoang d√£?",
            trans_opts: "C. V√¨ c√¥ ·∫•y t√≤ m√≤ v·ªÅ c√°ch ƒë·ªông v·∫≠t s·ªëng v√† c√°ch b·∫£o t·ªìn m√¥i tr∆∞·ªùng s·ªëng.",
            why_correct: "D·∫´n ch·ª©ng: 'I‚Äôm very curious about the way animals live and how to preserve their habitats.'",
            why_wrong: "B l√† l√Ω do c√¥ ·∫•y xem Tin t·ª©c (News). A v√† D l√† √Ω ki·∫øn c·ªßa Rachel."
        },
        {
            id: 'mc3', 
            q: "3. How much time does Rachel spend watching TV?",
            options: [
                {val: "A", text: "Three or four hours a day."},
                {val: "B", text: "Two or three hours a day."},
                {val: "C", text: "An hour or two a day."},
                {val: "D", text: "She watches TV all the time."}
            ],
            correct: "C",
            trans_q: "Rachel d√†nh bao nhi√™u th·ªùi gian xem TV?",
            trans_opts: "C. M·ªôt ho·∫∑c hai ti·∫øng m·ªói ng√†y.",
            why_correct: "D·∫´n ch·ª©ng: 'an hour or two a day'.",
            why_wrong: "A l√† Steve. B l√† Kate. D sai s·ª± th·∫≠t."
        },
        {
            id: 'mc4', 
            q: "4. According to Rachel, what are the benefits of TV?",
            options: [
                {val: "A", text: "It helps her relax and have fun..."},
                {val: "B", text: "It provides information about sports..."},
                {val: "C", text: "It allows her to know what is happening..."},
                {val: "D", text: "Some programmes are educational and help use imagination."}
            ],
            correct: "D",
            trans_q: "Theo Rachel, l·ª£i √≠ch c·ªßa TV l√† g√¨?",
            trans_opts: "D. M·ªôt s·ªë ch∆∞∆°ng tr√¨nh mang t√≠nh gi√°o d·ª•c v√† gi√∫p ph√°t tri·ªÉn tr√≠ t∆∞·ªüng t∆∞·ª£ng.",
            why_correct: "D·∫´n ch·ª©ng: 'Some programmes are educational and help us to use our imagination'.",
            why_wrong: "A l√† √Ω c·ªßa nh√¢n v·∫≠t trong Part 2. B l√† David (Part 1). C l√† Kate."
        }
    ];

    // --- RENDER FUNCTIONS ---

    function renderPart1() {
        const container = document.getElementById('p1-questions');
        part1Data.forEach(item => {
            let html = `
                <div class="question-block" id="${item.id}">
                    <div class="question-text">${item.question}</div>
                    <div class="options-grid">
                        ${item.options.map(opt => `
                            <button class="option-btn" onclick="checkPart1('${item.id}', '${opt.val}')">${opt.text}</button>
                        `).join('')}
                    </div>
                    <div class="explanation" id="exp-${item.id}">
                        <div class="teacher-note">C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="detail-row"><span class="detail-label">D·ªãch c√¢u h·ªèi:</span> ${item.trans_q}</div>
                        <div class="detail-row"><span class="detail-label">D·ªãch ƒë√°p √°n:</span><br>${item.trans_opts}</div>
                        <div class="detail-row" style="color:var(--correct)"><strong>‚úÖ T·∫°i sao ƒë√∫ng:</strong> ${item.why_correct}</div>
                        <div class="detail-row" style="color:var(--wrong)"><strong>‚ùå T·∫°i sao sai:</strong> ${item.why_wrong}</div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function renderPart4() {
        // TF
        const tfContainer = document.getElementById('tf-questions');
        part4TF.forEach(item => {
            tfContainer.innerHTML += `
                <div class="question-block" id="${item.id}">
                    <div class="question-text">${item.q}</div>
                    <div class="options-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <button class="option-btn" onclick="checkTF('${item.id}', true)">TRUE (ƒê√∫ng)</button>
                        <button class="option-btn" onclick="checkTF('${item.id}', false)">FALSE (Sai)</button>
                    </div>
                    <div class="explanation" id="exp-${item.id}">
                         <div class="teacher-note">C√¥ Mai An gi·∫£i th√≠ch:</div>
                         <div><strong>D·ªãch:</strong> ${item.trans}</div>
                         <div style="color:var(--correct)"><strong>Gi·∫£i th√≠ch:</strong> ${item.why}</div>
                    </div>
                </div>
            `;
        });

        // MCQ
        const mcContainer = document.getElementById('mc-questions');
        part4MC.forEach(item => {
            mcContainer.innerHTML += `
                <div class="question-block" id="${item.id}">
                    <div class="question-text">${item.q}</div>
                    <div class="options-grid">
                        ${item.options.map(opt => `
                            <button class="option-btn" onclick="checkMC('${item.id}', '${opt.val}')">${opt.text}</button>
                        `).join('')}
                    </div>
                    <div class="explanation" id="exp-${item.id}">
                        <div class="teacher-note">C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="detail-row"><span class="detail-label">D·ªãch c√¢u h·ªèi:</span> ${item.trans_q}</div>
                        <div class="detail-row"><span class="detail-label">D·ªãch ƒë√°p √°n:</span><br>${item.trans_opts}</div>
                        <div class="detail-row" style="color:var(--correct)"><strong>‚úÖ T·∫°i sao ƒë√∫ng:</strong> ${item.why_correct}</div>
                        <div class="detail-row" style="color:var(--wrong)"><strong>‚ùå T·∫°i sao sai:</strong> ${item.why_wrong}</div>
                    </div>
                </div>
            `;
        });
    }

    // --- INTERACTION LOGIC ---

    let currentGapId = null;

    function showGapModal(part, gapIndex) {
        currentGapId = {part, index: gapIndex};
        const container = document.getElementById('gap-options-container');
        container.innerHTML = '';
        
        // Use words from P2
        p2Words.forEach(word => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = word;
            btn.onclick = () => selectGapWord(word);
            container.appendChild(btn);
        });

        document.getElementById('gap-modal').style.display = 'flex';
    }

    function selectGapWord(word) {
        if (!currentGapId) return;
        
        // Update Display
        const span = document.querySelector(`span[onclick="showGapModal(${currentGapId.part}, ${currentGapId.index})"]`);
        span.innerText = word;
        
        // Check correctness immediately
        const data = part2Data.find(d => d.id === currentGapId.index);
        const expContainer = document.getElementById('part2-explanations');
        
        // Create or find explanation div for this gap
        let expDiv = document.getElementById(`exp-p2-${currentGapId.index}`);
        if (!expDiv) {
            expDiv = document.createElement('div');
            expDiv.id = `exp-p2-${currentGapId.index}`;
            expDiv.className = 'explanation show';
            expDiv.style.marginBottom = "10px";
            expContainer.appendChild(expDiv);
        }

        if (word === data.correct) {
            span.className = "gap-input filled-correct";
            expDiv.innerHTML = `
                <div class="teacher-note">‚úÖ C√¢u ${currentGapId.index}: Ch√≠nh x√°c!</div>
                <div><strong>${data.correct}</strong> (${data.trans}): ${data.explain}</div>
            `;
            triggerConfetti();
        } else {
            span.className = "gap-input filled-wrong";
            expDiv.innerHTML = `
                <div class="teacher-note" style="color:var(--wrong)">‚ùå C√¢u ${currentGapId.index}: Sai r·ªìi b√© ∆°i!</div>
                <div>ƒê√°p √°n ƒë√∫ng l√†: <strong>${data.correct}</strong> (${data.trans}).<br>L√Ω do: ${data.explain}</div>
            `;
            shakeElement(span);
        }

        document.getElementById('gap-modal').style.display = 'none';
    }

    function checkPart1(id, selectedVal) {
        const data = part1Data.find(d => d.id === id);
        const block = document.getElementById(id);
        const btns = block.querySelectorAll('.option-btn');
        const exp = document.getElementById(`exp-${id}`);
        const gapDisplay = document.getElementById(`gap${data.gapIndex}-display`);

        btns.forEach(btn => {
            btn.classList.add('disabled');
            if (btn.innerText.startsWith(data.correct)) btn.classList.add('correct');
            if (btn.innerText.startsWith(selectedVal) && selectedVal !== data.correct) btn.classList.add('wrong');
        });

        exp.classList.add('show');
        
        if (selectedVal === data.correct) {
            gapDisplay.innerText = selectedVal;
            gapDisplay.classList.add('filled-correct');
            triggerConfetti();
        } else {
            gapDisplay.innerText = selectedVal;
            gapDisplay.classList.add('filled-wrong');
        }
    }

    function checkTF(id, selectedBool) {
        const data = part4TF.find(d => d.id === id);
        const block = document.getElementById(id);
        const btns = block.querySelectorAll('.option-btn');
        const exp = document.getElementById(`exp-${id}`);

        btns.forEach(btn => {
            btn.classList.add('disabled');
            // Check button text to identify
            const isTrueBtn = btn.innerText.includes("TRUE");
            if (data.ans === true && isTrueBtn) btn.classList.add('correct');
            if (data.ans === false && !isTrueBtn) btn.classList.add('correct');
            
            if (selectedBool === true && isTrueBtn && data.ans !== true) btn.classList.add('wrong');
            if (selectedBool === false && !isTrueBtn && data.ans !== false) btn.classList.add('wrong');
        });

        exp.classList.add('show');
        if (selectedBool === data.ans) triggerConfetti();
    }

    function checkMC(id, selectedVal) {
        const data = part4MC.find(d => d.id === id);
        const block = document.getElementById(id);
        const btns = block.querySelectorAll('.option-btn');
        const exp = document.getElementById(`exp-${id}`);

        btns.forEach(btn => {
            btn.classList.add('disabled');
            // Assuming button text starts with Val or match logic
            // To simplify, we rely on click handler passing val, but to style we look at order or attribute?
            // Actually, we can check innerText or just rebuild logic. Simpler:
            // Since we don't have easy reference to specific btn element inside loop, let's use text content matching
            // Wait, logic above used 'startsWith'. Let's stick to that if possible.
            // Text is "The news...". Let's assume options don't have prefixes A. B. in text array, oh wait Part 1 did.
            // Part 4 MC options array does NOT have A. B. inside 'text'.
            // Let's refactor Part 4 rendering to include prefixes for easier matching or just check exact text.
        });
        
        // Re-looping specifically to style
        for (let i = 0; i < btns.length; i++) {
             const btn = btns[i];
             const optVal = data.options[i].val;
             
             if (optVal === data.correct) btn.classList.add('correct');
             if (optVal === selectedVal && selectedVal !== data.correct) btn.classList.add('wrong');
        }

        exp.classList.add('show');
        if (selectedVal === data.correct) triggerConfetti();
    }

    // --- EFFECTS ---

    function triggerConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const pieces = [];
        for(let i=0; i<50; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 10 + 5,
                speed: Math.random() * 5 + 2
            });
        }

        function animate() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            let active = false;
            pieces.forEach(p => {
                p.y += p.speed;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if(p.y < canvas.height) active = true;
            });
            if(active) requestAnimationFrame(animate);
            else ctx.clearRect(0,0,canvas.width,canvas.height);
        }
        animate();
    }

    function shakeElement(el) {
        el.style.animation = 'none';
        el.offsetHeight; /* trigger reflow */
        el.style.animation = 'shake 0.5s';
    }

    function submitAll() {
        // Count correct
        const correctP1 = document.querySelectorAll('#part1 .option-btn.correct.disabled').length; // Logic slightly flawed as it counts correct buttons shown, not user clicks.
        // Better logic: Count .filled-correct and clicked correct buttons.
        
        // Simple heuristic for this standalone file:
        // P1: Count .filled-correct in text
        const p1Score = document.querySelectorAll('#part1 .filled-correct').length;
        
        // P2: Count .filled-correct in text
        const p2Score = document.querySelectorAll('#part2 .filled-correct').length;
        
        // P3/4: Count questions where user clicked correct (we need to track user state or check DOM)
        // Since we add .wrong to user selection if wrong, and .correct to the right answer always...
        // We need to check if the user SELECTED the correct one.
        // In my logic above, I highlight correct answer regardless. 
        // Let's rely on a global score counter or just count "blocks where no .wrong button exists BUT .correct exists"? 
        // No, because if user picks wrong, both exist.
        // We need to track answers.
        
        // Quick Fix: Count how many question blocks have a "wrong" class active? No.
        // Let's just say "B·∫°n ƒë√£ ho√†n th√†nh b√†i thi!" because grading logic requires strict state tracking which is bulky here.
        // BUT, the prompt asks for "Score".
        
        // Let's approximate:
        // Total questions = 5 (P1) + 8 (P2) + 6 (TF) + 4 (MC) = 23.
        // Let's calc score based on DOM classes:
        // If a Question Block has a ".option-btn.wrong", 0 points.
        // If it has ".option-btn.correct" AND NO ".option-btn.wrong" (and is disabled), 1 point.
        
        let score = 0;
        
        // P1
        part1Data.forEach(d => {
            const block = document.getElementById(d.id);
            if (block.querySelector('.filled-correct')) score++; // Wait, Gap display is separate
            if (document.getElementById(`gap${d.gapIndex}-display`).classList.contains('filled-correct')) score++; 
        }); // P1 logic double counting? No. part1Data loop.

        // P2
        score += document.querySelectorAll('#part2 .filled-correct').length;

        // P4
        const p4Blocks = document.querySelectorAll('#part4 .question-block');
        p4Blocks.forEach(block => {
            const wrong = block.querySelector('.option-btn.wrong');
            const correctClicked = block.querySelector('.option-btn.correct'); // This class is added to the RIGHT answer always.
            // We need to know if the user clicked it.
            // My checkTF logic adds .correct to the right answer. It adds .wrong to the clicked answer if wrong.
            // It does NOT explicitly mark the clicked answer as "user-selected-correct".
            // However, if the user clicked correct, there is NO .wrong button.
            // AND the buttons are disabled.
            if (!wrong && block.querySelector('.option-btn.disabled')) score++;
        });
        
        // Total score calculation might be slightly off due to Part 1 Logic (using same variable).
        // Let's reset score and count strictly.
        
        score = 0;
        // P1: Check gaps
        score += document.querySelectorAll('#part1 .filled-correct').length;
        // P2: Check gaps
        score += document.querySelectorAll('#part2 .filled-correct').length;
        // P4: Check blocks
        document.querySelectorAll('#part4 .question-block').forEach(b => {
            // If user acted (disabled exists) AND no wrong button highlighted
            if (b.querySelector('.disabled') && !b.querySelector('.wrong')) score++;
        });

        const total = 5 + 8 + 6 + 4;
        
        document.getElementById('final-score').innerText = `${score}/${total}`;
        
        const feedback = document.getElementById('feedback-text');
        if(score === total) feedback.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ti·∫øng Anh! üåü";
        else if(score > 15) feedback.innerText = "L√†m t·ªët l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
        else feedback.innerText = "ƒê·ª´ng bu·ªìn, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt nh√©! ‚ù§Ô∏è";

        document.getElementById('result-modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
    }

    // INIT
    renderPart1();
    renderPart4();

</script>

</body>
</html>