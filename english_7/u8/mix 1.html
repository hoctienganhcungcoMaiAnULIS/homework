<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện viết lại câu: Nguyên nhân & Tương phản (Lớp 7) - Ms Mai An ULIS</title>
    
    <!-- Google Fonts: Nunito & Quicksand -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-color: #8854C0; /* Hồng tím pastel */
            --secondary-color: #00C9A7; /* Xanh ngọc */
            --accent-color: #FF9F43; /* Cam pastel */
            --correct-color: #00D26A; /* Xanh lá tươi */
            --wrong-color: #FF4757; /* Đỏ cam */
            --text-color: #2f3542;
            --bg-pattern: radial-gradient(#dff9fb 15%, transparent 16%), radial-gradient(#dff9fb 15%, transparent 16%);
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f1f2f6;
            background-image: var(--bg-pattern);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* HEADER STYLES */
        header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 800;
            text-shadow: 3px 3px 0px rgba(136, 84, 192, 0.2);
            margin: 0;
            background: #fff;
            display: inline-block;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 4px solid var(--primary-color);
        }

        .teacher-tag {
            display: block;
            margin-top: 10px;
            color: var(--secondary-color);
            font-weight: 700;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* QUESTION CARD STYLES */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 0 #dfe4ea, 0 10px 20px rgba(0,0,0,0.1);
            border: 2px solid #f1f2f6;
            transition: transform 0.3s ease;
            position: relative;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px dashed #f1f2f6;
            padding-bottom: 15px;
        }

        .q-number {
            background: var(--accent-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 800;
            box-shadow: 0 4px 0 #e67e22;
        }

        .q-text {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2f3542;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .hint-text {
            background-color: #fff4e6;
            color: #d35400;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.95rem;
            margin-bottom: 20px;
            border-left: 5px solid #e67e22;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        /* OPTIONS GRID */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr; /* Mobile first */
            gap: 15px;
        }

        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 3px solid #f1f2f6;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            text-align: left;
            position: relative;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 5px 0 #dfe4ea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-letter {
            background: #f1f2f6;
            color: #747d8c;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 800;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            border-color: var(--primary-color);
            box-shadow: 0 8px 0 #e1e1e1;
        }
        
        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #e1e1e1;
        }

        /* CORRECT & WRONG STATES */
        .option-btn.correct {
            background-color: #d1f7c4;
            border-color: var(--correct-color);
            color: #009432;
            box-shadow: 0 5px 0 #009432;
        }
        .option-btn.correct .option-letter {
            background-color: var(--correct-color);
            color: white;
        }

        .option-btn.wrong {
            background-color: #ffdde1;
            border-color: var(--wrong-color);
            color: #c0392b;
            box-shadow: 0 5px 0 #c0392b;
            animation: shake 0.5s;
        }
        .option-btn.wrong .option-letter {
            background-color: var(--wrong-color);
            color: white;
        }

        /* EXPLANATION BOX */
        .explanation-box {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid var(--primary-color);
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid #e1e1e1;
            padding-bottom: 10px;
        }

        .exp-item {
            margin-bottom: 12px;
            font-size: 1rem;
            line-height: 1.5;
        }

        .exp-label {
            font-weight: 700;
            margin-right: 5px;
            display: inline-block;
            min-width: 25px;
        }

        .label-A { color: #e67e22; }
        .label-B { color: #3498db; }
        .label-C { color: #9b59b6; }
        .label-D { color: #2ecc71; }

        .correct-tag {
            background: var(--correct-color);
            color: white;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: middle;
        }

        .rationale-text {
            color: #57606f;
            font-style: italic;
            display: block;
            margin-top: 4px;
            margin-left: 30px;
            font-size: 0.95rem;
        }

        /* SUBMIT BUTTON & FOOTER */
        .footer-control {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary-color);
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #5f27cd;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:active {
            transform: scale(0.95) translateY(4px);
            box-shadow: 0 4px 0 #5f27cd;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 8px solid var(--secondary-color);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: zoomIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .score-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 20px 0;
        }

        /* ANIMATIONS */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>

    <header>
        <h1>BÀI KIỂM TRA TỔNG HỢP</h1>
        <span class="teacher-tag"><i class="fas fa-crown"></i> Giáo viên: Ms Mai An ULIS <i class="fas fa-crown"></i></span>
    </header>

    <div class="container" id="quiz-container">
        <!-- Questions will be injected here by JS -->
    </div>

    <div class="footer-control">
        <button class="submit-btn" onclick="finishQuiz()">
            <i class="fas fa-paper-plane"></i> NỘP BÀI
        </button>
    </div>

    <!-- Modal Result -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-content">
            <h2 style="color: var(--secondary-color); font-family: 'Quicksand'; font-size: 2rem;">KẾT QUẢ CỦA BẠN</h2>
            <div class="score-display" id="finalScore">0/30</div>
            <p id="feedbackText" style="font-size: 1.2rem; color: #57606f; margin-bottom: 30px;">Bạn làm rất tốt!</p>
            <button class="submit-btn" onclick="location.reload()">Làm lại bài</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio> <!-- Ding -->
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio> <!-- Buzz/Error -->
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio> <!-- Applause -->

    <script>
        // DATA TỪ FILE JSON CỦA BẠN (30 Câu hỏi đầy đủ)
        const quizData = {
            "questions": [
                {
                    "questionNumber": 1,
                    "question": "Choose the correct sentence with the same meaning:\n'Although Tom was ill, he went to school.'",
                    "hint": "Quy tắc 3: Chủ ngữ là Đại từ (He/Tom) + tobe + Tính từ (ill) -> Đổi thành Sở hữu + Danh từ.",
                    "answerOptions": [
                        { "text": "Despite his illness, he went to school.", "rationale": "Dịch: Bất chấp sự ốm đau của mình, cậu ấy vẫn đi học. \nGiải thích: Áp dụng Quy tắc 3. 'Tom was ill' -> Tính từ 'ill' chuyển thành danh từ 'illness'. Đại từ sở hữu là 'his'.", "isCorrect": true },
                        { "text": "Despite Tom was ill, he went to school.", "rationale": "Dịch: Sai ngữ pháp. \nGiải thích: Sau 'Despite' không được dùng mệnh đề (S + V).", "isCorrect": false },
                        { "text": "In spite of he was ill, he went to school.", "rationale": "Dịch: Sai ngữ pháp. \nGiải thích: Sau 'In spite of' không được dùng mệnh đề.", "isCorrect": false },
                        { "text": "Despite of his illness, he went to school.", "rationale": "Dịch: Sai ngữ pháp. \nGiải thích: 'Despite' không đi với 'of'. Chỉ có 'In spite of'.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 2,
                    "question": "Choose the correct sentence with the same meaning:\n'Because the rain was heavy, we stayed at home.'",
                    "hint": "Quy tắc 2: Chủ ngữ là Danh từ (The rain) + tobe + Tính từ (heavy) -> The + Adj + N.",
                    "answerOptions": [
                        { "text": "Because of the heavy rain, we stayed at home.", "rationale": "Dịch: Vì cơn mưa lớn, chúng tôi ở nhà. \nGiải thích: Áp dụng Quy tắc 2. Đưa tính từ 'heavy' lên trước danh từ 'rain' -> 'the heavy rain'.", "isCorrect": true },
                        { "text": "Because of the rain was heavy, we stayed at home.", "rationale": "Dịch: Sai ngữ pháp (thừa động từ 'was').", "isCorrect": false },
                        { "text": "Because of the heavy, we stayed at home.", "rationale": "Dịch: Sai ngữ pháp (thiếu danh từ).", "isCorrect": false },
                        { "text": "Due to the rain heavy, we stayed at home.", "rationale": "Dịch: Sai trật tự từ (Tính từ phải đứng trước danh từ).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 3,
                    "question": "Choose the correct sentence with the same meaning:\n'Although she looked tired, she finished her work.'",
                    "hint": "Đây là câu Tương phản (Mặc dù). Chủ ngữ 2 vế giống nhau (She). Áp dụng Quy tắc 1 (V-ing).",
                    "answerOptions": [
                        { "text": "Despite looking tired, she finished her work.", "rationale": "Dịch: Mặc dù trông có vẻ mệt, cô ấy vẫn hoàn thành công việc. \nGiải thích: Quy tắc 1: Hai chủ ngữ giống nhau (She), bỏ chủ ngữ đầu, động từ thêm đuôi -ing (looking).", "isCorrect": true },
                        { "text": "Despite she looked tired, she finished her work.", "rationale": "Dịch: Sai ngữ pháp (Mệnh đề sau Despite).", "isCorrect": false },
                        { "text": "In spite looking tired, she finished her work.", "rationale": "Dịch: Sai giới từ (Thiếu 'of' sau In spite).", "isCorrect": false },
                        { "text": "Although looking tired, she finished her work.", "rationale": "Dịch: Sai liên từ (Although thường đi với mệnh đề, ít khi rút gọn trực tiếp V-ing trong chương trình lớp 7).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 4,
                    "question": "Choose the correct sentence with the same meaning:\n'He couldn't pass the exam because he was lazy.'",
                    "hint": "Đây là câu Nguyên nhân (Bởi vì). Quy tắc 3: Đại từ (He) + tobe + adj (lazy).",
                    "answerOptions": [
                        { "text": "He couldn't pass the exam because of his lazy.", "rationale": "Dịch: Sai loại từ ('lazy' là tính từ).", "isCorrect": false },
                        { "text": "He couldn't pass the exam because of his laziness.", "rationale": "Dịch: Anh ấy không qua kỳ thi vì sự lười biếng của mình. \nGiải thích: Quy tắc 3: Chuyển tính từ 'lazy' thành danh từ 'laziness'. Dùng sở hữu 'his'.", "isCorrect": true },
                        { "text": "He couldn't pass the exam due to he was lazy.", "rationale": "Dịch: Sai ngữ pháp (Mệnh đề sau Due to).", "isCorrect": false },
                        { "text": "He couldn't pass the exam because of the laziness.", "rationale": "Dịch: Sai mạo từ (Dùng 'his' chính xác hơn 'the' vì chỉ rõ sự lười của ai).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 5,
                    "question": "Choose the correct sentence with the same meaning:\n'Even though the car is old, it runs well.'",
                    "hint": "Câu Tương phản. Quy tắc 2: The car (N) + is + old (Adj).",
                    "answerOptions": [
                        { "text": "Despite the old car, it runs well.", "rationale": "Dịch: Mặc dù chiếc xe cũ, nó vẫn chạy tốt. \nGiải thích: Quy tắc 2: Chuyển 'The car is old' thành cụm danh từ 'The old car'.", "isCorrect": true },
                        { "text": "In spite of the car is old, it runs well.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Despite of the old car, it runs well.", "rationale": "Dịch: Sai ngữ pháp (Thừa 'of').", "isCorrect": false },
                        { "text": "Although the old car, it runs well.", "rationale": "Dịch: Sai ngữ pháp (Although cần mệnh đề).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 6,
                    "question": "Choose the correct sentence with the same meaning:\n'We didn't go out because it snowed heavily.'",
                    "hint": "Câu Nguyên nhân. Quy tắc 4: V (snowed) + Adv (heavily) -> Adj (heavy) + N (snow).",
                    "answerOptions": [
                        { "text": "We didn't go out because of the heavy snow.", "rationale": "Dịch: Chúng tôi không ra ngoài vì tuyết rơi dày. \nGiải thích: Quy tắc 4 (biến thể): Chuyển trạng từ 'heavily' thành tính từ 'heavy', động từ 'snowed' thành danh từ 'snow'.", "isCorrect": true },
                        { "text": "We didn't go out because the snow heavy.", "rationale": "Dịch: Sai ngữ pháp (thiếu 'of' và sai trật tự).", "isCorrect": false },
                        { "text": "We didn't go out due to it snowed heavily.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "We didn't go out because of the heavily snow.", "rationale": "Dịch: Sai loại từ (Adv + N là sai).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 7,
                    "question": "Choose the correct sentence with the same meaning:\n'In spite of being hungry, I didn't eat anything.'",
                    "hint": "Viết lại thành câu với 'Although'. Chú ý V-ing nghĩa là 2 chủ ngữ giống nhau (I).",
                    "answerOptions": [
                        { "text": "Although I was hungry, I didn't eat anything.", "rationale": "Dịch: Mặc dù tôi đói, tôi không ăn gì. \nGiải thích: Chuyển từ V-ing (being) về mệnh đề 'S + V'. Vì vế sau là quá khứ (didn't), nên vế đầu dùng 'was'.", "isCorrect": true },
                        { "text": "Although I am hungry, I didn't eat anything.", "rationale": "Dịch: Sai thì (am - hiện tại, didn't - quá khứ).", "isCorrect": false },
                        { "text": "Although being hungry, I didn't eat anything.", "rationale": "Dịch: Sai cấu trúc (Although + S + V).", "isCorrect": false },
                        { "text": "Because I was hungry, I didn't eat anything.", "rationale": "Dịch: Sai nghĩa (Nguyên nhân - Kết quả không hợp lý).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 8,
                    "question": "Choose the correct sentence with the same meaning:\n'Because of the cold weather, we wear warm clothes.'",
                    "hint": "Viết lại bằng 'Because' (tạo thành mệnh đề). The cold weather -> The weather is cold.",
                    "answerOptions": [
                        { "text": "Because the weather is cold, we wear warm clothes.", "rationale": "Dịch: Vì thời tiết lạnh, chúng tôi mặc áo ấm. \nGiải thích: Phục hồi cụm danh từ 'the cold weather' thành mệnh đề 'the weather is cold'.", "isCorrect": true },
                        { "text": "Because the weather cold, we wear warm clothes.", "rationale": "Dịch: Sai ngữ pháp (thiếu động từ tobe).", "isCorrect": false },
                        { "text": "Because the cold weather, we wear warm clothes.", "rationale": "Dịch: Sai ngữ pháp (Because cần mệnh đề).", "isCorrect": false },
                        { "text": "Although the weather is cold, we wear warm clothes.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 9,
                    "question": "Choose the correct sentence with the same meaning:\n'Although he behaved badly, his mom forgave him.'",
                    "hint": "Câu Tương phản. Quy tắc 4: V (behaved) + Adv (badly) -> Possessive + Adj + N.",
                    "answerOptions": [
                        { "text": "Despite his bad behavior, his mom forgave him.", "rationale": "Dịch: Mặc dù hành vi xấu của cậu ấy... \nGiải thích: Quy tắc 4: 'badly' (adv) -> 'bad' (adj); 'behaved' (v) -> 'behavior' (n).", "isCorrect": true },
                        { "text": "Despite his badly behavior, his mom forgave him.", "rationale": "Dịch: Sai loại từ (badly là trạng từ).", "isCorrect": false },
                        { "text": "In spite of he behaved badly, his mom forgave him.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Despite his behavior bad, his mom forgave him.", "rationale": "Dịch: Sai trật tự từ.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 10,
                    "question": "Choose the correct sentence with the same meaning:\n'Since the test was difficult, I couldn't finish it.'",
                    "hint": "Câu Nguyên nhân (Since = Because). The test (N) + was + difficult (Adj).",
                    "answerOptions": [
                        { "text": "Because of the difficult test, I couldn't finish it.", "rationale": "Dịch: Vì bài kiểm tra khó... \nGiải thích: Quy tắc 2: Chuyển 'The test was difficult' thành cụm 'The difficult test'.", "isCorrect": true },
                        { "text": "Due to the test was difficult, I couldn't finish it.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Because of the difficulty test, I couldn't finish it.", "rationale": "Dịch: Sai loại từ (difficulty là danh từ, cần tính từ bổ nghĩa cho test).", "isCorrect": false },
                        { "text": "In spite of the difficult test, I couldn't finish it.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 11,
                    "question": "Choose the correct sentence with the same meaning:\n'Although there was a lot of noise, we slept well.'",
                    "hint": "Quy tắc 5: 'There be + Noun' -> Bỏ 'There be', giữ lại Noun.",
                    "answerOptions": [
                        { "text": "Despite the noise, we slept well.", "rationale": "Dịch: Mặc dù tiếng ồn, chúng tôi vẫn ngủ ngon. \nGiải thích: Quy tắc 5: Bỏ 'there was', chỉ lấy danh từ chính 'the noise' (hoặc 'a lot of noise').", "isCorrect": true },
                        { "text": "Despite there was noise, we slept well.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "In spite the noise, we slept well.", "rationale": "Dịch: Sai giới từ (thiếu 'of').", "isCorrect": false },
                        { "text": "Because of the noise, we slept well.", "rationale": "Dịch: Sai nghĩa (Ồn thì sao ngủ ngon được vì lý do đó?).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 12,
                    "question": "Choose the correct sentence with the same meaning:\n'I stayed up late because I had a lot of homework.'",
                    "hint": "Câu Nguyên nhân. Hai chủ ngữ giống nhau (I). Áp dụng Quy tắc 1 (V-ing).",
                    "answerOptions": [
                        { "text": "I stayed up late because of having a lot of homework.", "rationale": "Dịch: Tôi thức khuya vì có nhiều bài tập. \nGiải thích: Quy tắc 1: Chủ ngữ giống nhau, dùng V-ing (had -> having).", "isCorrect": true },
                        { "text": "I stayed up late due to I had a lot of homework.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "I stayed up late because of I have homework.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "I stayed up late because having a lot of homework.", "rationale": "Dịch: Sai ngữ pháp (Because + mệnh đề, hoặc Because of + V-ing). Đáp án này thiếu 'of'.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 13,
                    "question": "Choose the correct sentence with the same meaning:\n'Even though he is poor, he is happy.'",
                    "hint": "Poor (adj) -> Poverty (noun) HOẶC dùng cấu trúc 'Being + adj'.",
                    "answerOptions": [
                        { "text": "Despite his poverty, he is happy.", "rationale": "Dịch: Mặc dù sự nghèo khó, ông ấy vẫn hạnh phúc. \nGiải thích: Quy tắc 3: Poor (adj) -> Poverty (noun). Đây là cách dùng danh từ nâng cao.", "isCorrect": true },
                        { "text": "Despite he is poor, he is happy.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "In spite of his poor, he is happy.", "rationale": "Dịch: Sai loại từ (Poor là adj, không đứng sau his).", "isCorrect": false },
                        { "text": "Although his poverty, he is happy.", "rationale": "Dịch: Sai ngữ pháp (Although cần mệnh đề).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 14,
                    "question": "Choose the correct sentence with the same meaning:\n'Because the wind is strong, we can't play badminton.'",
                    "hint": "The wind is strong -> The strong wind.",
                    "answerOptions": [
                        { "text": "Due to the strong wind, we can't play badminton.", "rationale": "Dịch: Do gió mạnh... \nGiải thích: Quy tắc 2: The wind (N) + is + strong (adj) -> The strong wind.", "isCorrect": true },
                        { "text": "Due to the wind is strong, we can't play badminton.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Because of the wind strong, we can't play badminton.", "rationale": "Dịch: Sai trật tự từ.", "isCorrect": false },
                        { "text": "Despite the strong wind, we can't play badminton.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 15,
                    "question": "Choose the correct sentence with the same meaning:\n'Despite not having a ticket, he entered the cinema.'",
                    "hint": "Viết lại bằng 'Although'. Not having (V-ing phủ định) -> He didn't have.",
                    "answerOptions": [
                        { "text": "Although he didn't have a ticket, he entered the cinema.", "rationale": "Dịch: Mặc dù anh ấy không có vé... \nGiải thích: Phục hồi mệnh đề từ V-ing. Vế sau quá khứ (entered) nên vế trước dùng 'didn't have'.", "isCorrect": true },
                        { "text": "Although he doesn't have a ticket, he entered the cinema.", "rationale": "Dịch: Sai thì (doesn't - hiện tại).", "isCorrect": false },
                        { "text": "Although not having a ticket, he entered the cinema.", "rationale": "Dịch: Sai cấu trúc (Although + S + V).", "isCorrect": false },
                        { "text": "Because he didn't have a ticket, he entered the cinema.", "rationale": "Dịch: Sai nghĩa (Không có vé thì sao vào được? Phải là tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 16,
                    "question": "Choose the correct sentence with the same meaning:\n'As I was tired, I went to bed early.'",
                    "hint": "Câu Nguyên nhân. Hai chủ ngữ giống nhau (I).",
                    "answerOptions": [
                        { "text": "Due to being tired, I went to bed early.", "rationale": "Dịch: Vì bị mệt... \nGiải thích: Quy tắc 1: Rút gọn chủ ngữ -> V-ing (being).", "isCorrect": true },
                        { "text": "Due to I was tired, I went to bed early.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Because of tired, I went to bed early.", "rationale": "Dịch: Sai ngữ pháp (Thiếu being).", "isCorrect": false },
                        { "text": "Although I was tired, I went to bed early.", "rationale": "Dịch: Sai nghĩa (Mệt thì đi ngủ là đúng logic nguyên nhân, không phải tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 17,
                    "question": "Choose the correct sentence with the same meaning:\n'Although the street was crowded, he drove fast.'",
                    "hint": "The street was crowded -> The crowded street.",
                    "answerOptions": [
                        { "text": "In spite of the crowded street, he drove fast.", "rationale": "Dịch: Bất chấp đường phố đông đúc... \nGiải thích: Quy tắc 2: The street (N) + was + crowded (adj) -> The crowded street.", "isCorrect": true },
                        { "text": "In spite of the street was crowded, he drove fast.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Despite of the crowded street, he drove fast.", "rationale": "Dịch: Sai ngữ pháp (Thừa 'of').", "isCorrect": false },
                        { "text": "Because of the crowded street, he drove fast.", "rationale": "Dịch: Sai nghĩa (Đông đúc thì không nên lái nhanh).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 18,
                    "question": "Choose the correct sentence with the same meaning:\n'She didn't go to the party because of her sickness.'",
                    "hint": "Viết lại bằng 'Because'. Her sickness (N) -> She was sick (Adj).",
                    "answerOptions": [
                        { "text": "She didn't go to the party because she was sick.", "rationale": "Dịch: ...bởi vì cô ấy bị ốm. \nGiải thích: Quy tắc 3 (ngược lại): Chuyển danh từ 'sickness' thành tính từ 'sick' trong mệnh đề.", "isCorrect": true },
                        { "text": "She didn't go to the party because she was sickness.", "rationale": "Dịch: Sai loại từ (Sau tobe dùng tính từ).", "isCorrect": false },
                        { "text": "She didn't go to the party because her sickness.", "rationale": "Dịch: Sai ngữ pháp (Because cần S + V).", "isCorrect": false },
                        { "text": "She didn't go to the party although she was sick.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 19,
                    "question": "Choose the correct sentence with the same meaning:\n'Though he is young, he performs excellently.'",
                    "hint": "Young (adj) -> Youth (noun) HOẶC dùng 'being young'.",
                    "answerOptions": [
                        { "text": "In spite of being young, he performs excellently.", "rationale": "Dịch: Mặc dù còn trẻ... \nGiải thích: Quy tắc 1: Chủ ngữ giống nhau (he), dùng V-ing (being young).", "isCorrect": true },
                        { "text": "In spite he is young, he performs excellently.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Despite of being young, he performs excellently.", "rationale": "Dịch: Sai (thừa of).", "isCorrect": false },
                        { "text": "Because of being young, he performs excellently.", "rationale": "Dịch: Sai nghĩa (Trẻ thường thiếu kinh nghiệm, diễn giỏi là tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 20,
                    "question": "Choose the correct sentence with the same meaning:\n'Because of the high price, I didn't buy the shirt.'",
                    "hint": "Viết lại bằng 'Since'. The high price -> The price was high.",
                    "answerOptions": [
                        { "text": "Since the price was high, I didn't buy the shirt.", "rationale": "Dịch: Vì giá cao... \nGiải thích: Phục hồi mệnh đề: The price (S) + was (V) + high (adj).", "isCorrect": true },
                        { "text": "Since the price high, I didn't buy the shirt.", "rationale": "Dịch: Sai ngữ pháp (thiếu tobe).", "isCorrect": false },
                        { "text": "Since the high price, I didn't buy the shirt.", "rationale": "Dịch: Sai ngữ pháp (Since cần mệnh đề).", "isCorrect": false },
                        { "text": "Although the price was high, I didn't buy the shirt.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 21,
                    "question": "Choose the correct sentence with the same meaning:\n'Although he ran fast, he missed the bus.'",
                    "hint": "Ran (V) + fast (Adv) -> Quy tắc 4: Possessive + Adj + N.",
                    "answerOptions": [
                        { "text": "Despite his fast running, he missed the bus.", "rationale": "Dịch: Mặc dù việc chạy nhanh của anh ấy... \nGiải thích: Quy tắc 4: Ran (động từ) -> Running (danh từ). Fast (vừa là trạng từ vừa là tính từ). His fast running.", "isCorrect": true },
                        { "text": "Despite he ran fast, he missed the bus.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "In spite of ran fast, he missed the bus.", "rationale": "Dịch: Sai ngữ pháp (cần V-ing hoặc Noun).", "isCorrect": false },
                        { "text": "Because of his fast running, he missed the bus.", "rationale": "Dịch: Sai nghĩa (Chạy nhanh thì đáng lẽ phải bắt được xe).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 22,
                    "question": "Choose the correct sentence with the same meaning:\n'Because it was foggy, we couldn't see the road.'",
                    "hint": "Foggy (adj) -> Fog (noun).",
                    "answerOptions": [
                        { "text": "Due to the fog, we couldn't see the road.", "rationale": "Dịch: Do sương mù... \nGiải thích: Chuyển tính từ chỉ thời tiết (foggy) sang danh từ (the fog).", "isCorrect": true },
                        { "text": "Due to it was foggy, we couldn't see the road.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Due to the foggy, we couldn't see the road.", "rationale": "Dịch: Sai loại từ.", "isCorrect": false },
                        { "text": "Despite the fog, we couldn't see the road.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 23,
                    "question": "Choose the correct sentence with the same meaning:\n'In spite of her beauty, she is not arrogant.'",
                    "hint": "Viết lại bằng 'Although'. Her beauty (N) -> She is beautiful (Adj).",
                    "answerOptions": [
                        { "text": "Although she is beautiful, she is not arrogant.", "rationale": "Dịch: Mặc dù cô ấy xinh đẹp, cô ấy không kiêu ngạo. \nGiải thích: Chuyển danh từ 'beauty' thành tính từ 'beautiful' trong mệnh đề.", "isCorrect": true },
                        { "text": "Although she is beauty, she is not arrogant.", "rationale": "Dịch: Sai loại từ (Sau tobe dùng tính từ).", "isCorrect": false },
                        { "text": "Although her beauty, she is not arrogant.", "rationale": "Dịch: Sai cấu trúc.", "isCorrect": false },
                        { "text": "Because she is beautiful, she is not arrogant.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 24,
                    "question": "Choose the correct sentence with the same meaning:\n'He lost his job because he was careless.'",
                    "hint": "Careless (adj) -> Carelessness (noun).",
                    "answerOptions": [
                        { "text": "He lost his job because of his carelessness.", "rationale": "Dịch: Anh ấy mất việc vì sự bất cẩn. \nGiải thích: Quy tắc 3: Careless -> Carelessness.", "isCorrect": true },
                        { "text": "He lost his job because of his careless.", "rationale": "Dịch: Sai loại từ.", "isCorrect": false },
                        { "text": "He lost his job due to he was careless.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "He lost his job despite his carelessness.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 25,
                    "question": "Choose the correct sentence with the same meaning:\n'Despite the fact that he is rich, he lives simply.'",
                    "hint": "Bỏ 'Despite the fact that', dùng liên từ 'Although' + mệnh đề.",
                    "answerOptions": [
                        { "text": "Although he is rich, he lives simply.", "rationale": "Dịch: Mặc dù ông ấy giàu... \nGiải thích: 'Despite the fact that + S + V' = 'Although + S + V'. Chỉ cần thay thế cụm từ mở đầu.", "isCorrect": true },
                        { "text": "Although of he is rich, he lives simply.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Because he is rich, he lives simply.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false },
                        { "text": "In spite he is rich, he lives simply.", "rationale": "Dịch: Sai ngữ pháp (thiếu of).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 26,
                    "question": "Choose the correct sentence with the same meaning:\n'Because the question was difficult, no one could answer it.'",
                    "hint": "The question was difficult -> The difficult question.",
                    "answerOptions": [
                        { "text": "Because of the difficult question, no one could answer it.", "rationale": "Dịch: Vì câu hỏi khó... \nGiải thích: Quy tắc 2: The question (N) + was + difficult (Adj) -> The difficult question.", "isCorrect": true },
                        { "text": "Because of the question was difficult, no one could answer it.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "Due to the difficult of the question, no one could answer it.", "rationale": "Dịch: Sai loại từ (difficult là adj, danh từ là difficulty).", "isCorrect": false },
                        { "text": "In spite of the difficult question, no one could answer it.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 27,
                    "question": "Choose the correct sentence with the same meaning:\n'Although I studied hard, I failed.'",
                    "hint": "Studied (V) + hard (Adv) -> Studying hard (V-ing phrase).",
                    "answerOptions": [
                        { "text": "Despite studying hard, I failed.", "rationale": "Dịch: Mặc dù học chăm... \nGiải thích: Quy tắc 1: Hai chủ ngữ giống nhau (I), dùng V-ing.", "isCorrect": true },
                        { "text": "Despite I studied hard, I failed.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false },
                        { "text": "In spite studying hard, I failed.", "rationale": "Dịch: Sai giới từ (thiếu of).", "isCorrect": false },
                        { "text": "Because of studying hard, I failed.", "rationale": "Dịch: Sai nghĩa (Học chăm dẫn đến trượt là vô lý -> phải là tương phản).", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 28,
                    "question": "Choose the correct sentence with the same meaning:\n'Due to the heavy traffic, we are late.'",
                    "hint": "Viết lại bằng 'As'. The heavy traffic -> The traffic is heavy.",
                    "answerOptions": [
                        { "text": "As the traffic is heavy, we are late.", "rationale": "Dịch: Vì giao thông đông đúc... \nGiải thích: 'As' = 'Because'. Phục hồi mệnh đề 'S + V + Adj'.", "isCorrect": true },
                        { "text": "As the heavy traffic, we are late.", "rationale": "Dịch: Sai ngữ pháp (As cần mệnh đề).", "isCorrect": false },
                        { "text": "As the traffic heavy, we are late.", "rationale": "Dịch: Sai ngữ pháp (thiếu tobe).", "isCorrect": false },
                        { "text": "Although the traffic is heavy, we are late.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 29,
                    "question": "Choose the correct sentence with the same meaning:\n'Even though he is strong, he can't lift the box.'",
                    "hint": "Strong (Adj) -> Strength (Noun).",
                    "answerOptions": [
                        { "text": "Despite his strength, he can't lift the box.", "rationale": "Dịch: Bất chấp sức mạnh của anh ấy... \nGiải thích: Quy tắc 3 (nâng cao): Strong -> Strength. Dùng sở hữu 'his'.", "isCorrect": true },
                        { "text": "Despite his strong, he can't lift the box.", "rationale": "Dịch: Sai loại từ.", "isCorrect": false },
                        { "text": "Because of his strength, he can't lift the box.", "rationale": "Dịch: Sai nghĩa.", "isCorrect": false },
                        { "text": "In spite of he is strong, he can't lift the box.", "rationale": "Dịch: Sai ngữ pháp.", "isCorrect": false }
                    ]
                },
                {
                    "questionNumber": 30,
                    "question": "Choose the correct sentence with the same meaning:\n'Because of driving carelessly, he caused an accident.'",
                    "hint": "Driving carelessly (V-ing + Adv) -> He drove carelessly.",
                    "answerOptions": [
                        { "text": "Because he drove carelessly, he caused an accident.", "rationale": "Dịch: Vì anh ấy lái xe ẩu... \nGiải thích: Phục hồi mệnh đề. Vế sau 'caused' (quá khứ) nên vế trước 'drove' (quá khứ).", "isCorrect": true },
                        { "text": "Because he drives carelessly, he caused an accident.", "rationale": "Dịch: Sai thì (drives - hiện tại).", "isCorrect": false },
                        { "text": "Although he drove carelessly, he caused an accident.", "rationale": "Dịch: Sai nghĩa (Tương phản).", "isCorrect": false },
                        { "text": "Because driving carelessly, he caused an accident.", "rationale": "Dịch: Sai ngữ pháp (Because + mệnh đề).", "isCorrect": false }
                    ]
                }
            ]
        };

        const container = document.getElementById('quiz-container');
        const correctSound = document.getElementById('sound-correct');
        const wrongSound = document.getElementById('sound-wrong');
        const finishSound = document.getElementById('sound-finish');
        let correctCount = 0;
        let totalAnswered = 0;

        // Shuffle function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Render Questions
        function initQuiz() {
            quizData.questions.forEach((q, index) => {
                // Shuffle options before rendering
                shuffleArray(q.answerOptions);

                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-card-${index}`;

                // Question Header
                const qHeader = `
                    <div class="question-header">
                        <span class="q-number">Câu ${q.questionNumber}</span>
                        <i class="fas fa-pencil-alt" style="color: var(--secondary-color);"></i>
                    </div>
                `;

                // Question Text
                const qText = `<div class="q-text">${q.question.replace(/\n/g, '<br>')}</div>`;

                // Hint
                const qHint = q.hint ? `<div class="hint-text"><i class="far fa-lightbulb"></i> Gợi ý: ${q.hint}</div>` : '';

                // Options
                let optionsHtml = '<div class="options-grid">';
                const letters = ['A', 'B', 'C', 'D'];
                q.answerOptions.forEach((opt, i) => {
                    optionsHtml += `
                        <button class="option-btn" onclick="checkAnswer(${index}, ${i}, this)" id="btn-${index}-${i}">
                            <div class="option-letter">${letters[i]}</div>
                            <span>${opt.text}</span>
                        </button>
                    `;
                });
                optionsHtml += '</div>';

                // Explanation Box (Hidden initially)
                let explanationHtml = `
                    <div class="explanation-box" id="exp-${index}">
                        <div class="explanation-header">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Lời giải chi tiết của Ms Mai An:</span>
                        </div>
                        <div class="exp-item">
                            <strong>Đề bài:</strong> ${q.question.replace(/\n/g, ' ')}
                        </div>
                        <div class="exp-item" style="color: #e67e22;">
                            <i class="fas fa-lightbulb"></i> <strong>Gợi ý:</strong> ${q.hint}
                        </div>
                        <hr style="border: 0; border-top: 1px dashed #ccc; margin: 15px 0;">
                        <div class="exp-item">
                            <strong>Phân tích đáp án:</strong>
                        </div>
                `;

                // Add detailed analysis for each option
                q.answerOptions.forEach((opt, i) => {
                    const isRight = opt.isCorrect;
                    const letter = letters[i];
                    explanationHtml += `
                        <div class="exp-item">
                            <span class="exp-label label-${letter}">${letter}.</span>
                            <span>${opt.text}</span>
                            ${isRight ? '<span class="correct-tag"><i class="fas fa-check"></i> ĐÚNG</span>' : ''}
                            <span class="rationale-text">${opt.rationale.replace(/\n/g, '<br>')}</span>
                        </div>
                    `;
                });
                explanationHtml += `</div>`;

                card.innerHTML = qHeader + qText + qHint + optionsHtml + explanationHtml;
                container.appendChild(card);
            });
        }

        // Check Answer Logic
        window.checkAnswer = function(qIndex, optIndex, btnElement) {
            // Prevent re-answering
            const card = document.getElementById(`q-card-${qIndex}`);
            if (card.getAttribute('data-answered') === 'true') return;
            card.setAttribute('data-answered', 'true');

            const question = quizData.questions[qIndex];
            const isCorrect = question.answerOptions[optIndex].isCorrect;
            const explanationBox = document.getElementById(`exp-${qIndex}`);
            
            // Disable all buttons in this card
            const buttons = card.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                // Correct logic
                btnElement.classList.add('correct');
                correctSound.currentTime = 0;
                correctSound.play();
                correctCount++;
                
                // Confetti Effect
                const rect = btnElement.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { x: x, y: y },
                    colors: ['#00D26A', '#00C9A7', '#f1c40f']
                });

            } else {
                // Wrong logic
                btnElement.classList.add('wrong');
                wrongSound.currentTime = 0;
                wrongSound.play();

                // Highlight correct answer
                const correctOptIndex = question.answerOptions.findIndex(o => o.isCorrect);
                const correctBtn = document.getElementById(`btn-${qIndex}-${correctOptIndex}`);
                if(correctBtn) correctBtn.classList.add('correct');
            }

            totalAnswered++;
            
            // Show Explanation immediately
            explanationBox.style.display = 'block';
            explanationBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Finish Quiz Logic
        window.finishQuiz = function() {
            const modal = document.getElementById('resultModal');
            const scoreDisplay = document.getElementById('finalScore');
            const feedbackText = document.getElementById('feedbackText');

            // Calculate score
            scoreDisplay.innerText = `${correctCount}/${quizData.questions.length}`;

            // Feedback message
            const percentage = (correctCount / quizData.questions.length) * 100;
            if (percentage === 100) {
                feedbackText.innerText = "Tuyệt đối! Con là thiên tài ngoại ngữ! 🌟";
                finishSound.play();
                confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
            } else if (percentage >= 80) {
                feedbackText.innerText = "Xuất sắc! Con làm bài rất tốt! 🎉";
                finishSound.play();
            } else if (percentage >= 50) {
                feedbackText.innerText = "Khá tốt! Cố gắng luyện tập thêm nhé! 💪";
            } else {
                feedbackText.innerText = "Đừng buồn nhé, hãy xem lại lời giải chi tiết của cô! 😊";
            }

            modal.style.display = 'flex';
        }

        // Initialize
        initQuiz();

    </script>
</body>
</html>
