<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trắc nghiệm Giới từ chỉ Thời gian - Ms Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #8854C0; /* Tím */
            --secondary-color: #00C9A7; /* Xanh ngọc */
            --correct-color: #00D26A; /* Xanh lá */
            --wrong-color: #FF4757; /* Đỏ cam */
            --bg-color: #F0F3F8;
            --card-bg: #FFFFFF;
            --text-color: #2F3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854C0 0.8px, transparent 0.8px), radial-gradient(#8854C0 0.8px, var(--bg-color) 0.8px);
            background-size: 32px 32px;
            background-position: 0 0, 16px 16px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid #eee;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            color: var(--primary-color);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 2.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            color: #747d8c;
            font-weight: 600;
            margin-top: 10px;
        }

        .teacher-badge {
            background: var(--secondary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        /* Question Card Styles */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.15);
            border: 2px solid #fff;
            position: relative;
            transition: transform 0.3s ease;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
        }

        .question-number {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2F3542;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #dfe4ea;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            position: relative;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #dfe4ea;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #dfe4ea;
            background-color: #f1f2f6;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #dfe4ea;
        }

        .option-letter {
            width: 30px;
            height: 30px;
            background: #f1f2f6;
            color: #57606f;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 800;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        /* State Classes */
        .option-btn.correct {
            background-color: var(--correct-color) !important;
            color: white !important;
            border-color: #00b85b !important;
            box-shadow: 0 4px 0 #00b85b !important;
        }

        .option-btn.correct .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color) !important;
            color: white !important;
            border-color: #ff2e40 !important;
            box-shadow: 0 4px 0 #ff2e40 !important;
            animation: shake 0.5s;
        }

        .option-btn.wrong .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.8;
            pointer-events: none; /* Prevent clicks after selection */
        }
        
        /* Highlight correct answer when wrong is chosen */
        .option-btn.show-correct {
            background-color: #fff;
            border-color: var(--correct-color);
            color: var(--correct-color);
            box-shadow: 0 4px 0 var(--correct-color);
        }
        .option-btn.show-correct .option-letter {
            background-color: var(--correct-color);
            color: white;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background-color: #F3F0FF; /* Light Purple Bg */
            border-left: 5px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .explanation-header i {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .explanation-content {
            font-size: 1rem;
            color: #2F3542;
            line-height: 1.6;
        }
        
        /* Markdown-like styling for rationale */
        .explanation-content strong {
            color: var(--primary-color);
        }

        /* Floating Submit Button */
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .submit-btn {
            background: var(--secondary-color);
            color: white;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            padding: 12px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #00a388;
            transition: transform 0.1s;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 0 #00a388;
        }

        .submit-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #00a388;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--primary-color);
            position: relative;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            box-shadow: 0 10px 0 #6c429c;
        }

        .feedback-text {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .close-btn {
            background: #dfe4ea;
            color: #2F3542;
            padding: 10px 30px;
            border-radius: 30px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #ced6e0;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="teacher-badge">ENGLISH QUIZ</div>
            <h1>Ms Mai An ULIS</h1>
            <p>Bài tập: Giới từ chỉ Thời gian (Prepositions of Time)</p>
            <div style="margin-top:10px; font-size: 0.9rem; color: #a4b0be;">
                <i class="fas fa-info-circle"></i> Chọn đáp án đúng để xem giải thích chi tiết!
            </div>
        </header>

        <div id="quiz-container">
            <!-- Questions will be injected here by JS -->
        </div>
    </div>

    <div class="submit-container">
        <button class="submit-btn" onclick="finishQuiz()">Nộp bài & Xem điểm</button>
    </div>

    <!-- Score Modal -->
    <div class="modal-overlay" id="scoreModal">
        <div class="modal-content">
            <div class="score-circle" id="finalScore">0/40</div>
            <div class="feedback-text" id="feedbackMsg">Tuyệt vời!</div>
            <p id="detailScore" style="color:#747d8c; margin-bottom: 20px;">Bạn đã hoàn thành bài thi.</p>
            <button class="close-btn" onclick="closeModal()">Đóng</button>
        </div>
    </div>

    <!-- Canvas for Confetti -->
    <canvas id="confetti-canvas"></canvas>

    <script>
        // --- DATA ---
        const quizData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "Ex 6 - Q1: The competition starts ______ 8 o’clock.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Cuộc thi bắt đầu **lúc** 8 giờ.\n\nPhân tích:\n- at (prep): lúc (dùng cho giờ đồng hồ).\n- on (prep): vào (ngày).\n- in (prep): trong (tháng/năm).\n- for (prep): khoảng (thời gian).\n\nGiải thích: '8 o'clock' là giờ cụ thể -> dùng 'at'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 2,
              "question": "Ex 6 - Q2: He is sending a voice message ______ the moment.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Anh ấy đang gửi tin nhắn thoại **vào lúc này**.\n\nPhân tích:\n- at the moment = now: ngay lúc này (cụm từ cố định).\n\nGiải thích: Cụm từ chỉ thời điểm hiện tại -> dùng 'at'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 3,
              "question": "Ex 6 - Q3: My father worked here ______ the 1990s.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Bố tôi đã làm việc ở đây **vào** những năm 1990.\n\nPhân tích:\n- in + thập kỷ/thế kỷ/năm.\n\nGiải thích: 'The 1990s' là thập kỷ -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "at", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 4,
              "question": "Ex 6 - Q4: Is her birthday ______ July 20th?",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Sinh nhật cô ấy có phải **vào** ngày 20 tháng 7 không?\n\nPhân tích:\n- on + ngày tháng cụ thể.\n\nGiải thích: Có ngày (20th) đi kèm tháng -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 5,
              "question": "Ex 6 - Q5: Was the old temple built ______ the 19th century?",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Ngôi đền cổ có phải được xây dựng **vào** thế kỷ 19 không?\n\nPhân tích:\n- in + thế kỷ.\n\nGiải thích: 'The 19th century' là khoảng thời gian dài -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 6,
              "question": "Ex 6 - Q6: John was born ______ 2008.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: John được sinh ra **vào** năm 2008.\n\nPhân tích:\n- in + năm.\n\nGiải thích: Chỉ có năm -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 7,
              "question": "Ex 6 - Q7: Children always get lucky money ______ Tet.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Trẻ em luôn nhận được tiền lì xì **vào dịp** Tết.\n\nPhân tích:\n- at + tên lễ hội (kéo dài nhiều ngày, không có chữ 'Day').\n\nGiải thích: Tet là dịp lễ hội -> dùng 'at'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 8,
              "question": "Ex 6 - Q8: I will finish the project ______ two weeks.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Tôi sẽ hoàn thành dự án **trong vòng** hai tuần nữa.\n\nPhân tích:\n- in + khoảng thời gian (dùng với thì tương lai): trong bao lâu nữa.\n\nGiải thích: Chỉ thời gian từ hiện tại đến tương lai -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "at", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 9,
              "question": "Ex 6 - Q9: Nam and Phong are reading in the library ______ present.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Nam và Phong đang đọc sách trong thư viện **vào lúc** hiện tại.\n\nPhân tích:\n- at present = now: hiện tại/bây giờ.\n\nGiải thích: Cụm từ cố định.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 10,
              "question": "Ex 6 - Q10: We have a video conference ______ the first day of the month.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Chúng tôi có một cuộc họp qua video **vào** ngày đầu tiên của tháng.\n\nPhân tích:\n- on + ngày.\n\nGiải thích: Cứ có chữ 'day' chỉ ngày cụ thể -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 11,
              "question": "Ex 6 - Q11: We always go on holiday ______ summer.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Chúng tôi luôn đi nghỉ mát **vào** mùa hè.\n\nPhân tích:\n- in + mùa (spring, summer, autumn, winter).\n\nGiải thích: Summer là mùa -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 12,
              "question": "Ex 6 - Q12: My mother usually goes shopping ______ Friday morning.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Mẹ tôi thường đi mua sắm **vào** sáng thứ Sáu.\n\nPhân tích:\n- on + buổi của một ngày cụ thể (thứ + buổi).\n\nGiải thích: Có thứ (Friday) -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 13,
              "question": "Ex 6 - Q13: I always do my homework ______ the evening.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Tôi luôn làm bài tập về nhà **vào** buổi tối.\n\nPhân tích:\n- in the morning/afternoon/evening.\n\nGiải thích: Các buổi trong ngày (trừ night) -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "at", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 14,
              "question": "Ex 6 - Q14: The circus usually comes to our town ______ spring.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Rạp xiếc thường đến thị trấn của chúng tôi **vào** mùa xuân.\n\nPhân tích:\n- in + mùa.\n\nGiải thích: Spring là mùa -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 15,
              "question": "Ex 6 - Q15: Sophia's birthday is ______ May 16th.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Sinh nhật của Sophia là **vào** ngày 16 tháng 5.\n\nPhân tích:\n- on + ngày tháng cụ thể.\n\nGiải thích: Có ngày (16th) -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 16,
              "question": "Ex 6 - Q16: I usually get up ______ seven o'clock.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Tôi thường thức dậy **lúc** bảy giờ.\n\nPhân tích:\n- at + giờ đồng hồ.\n\nGiải thích: 7 o'clock -> dùng 'at'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 17,
              "question": "Ex 6 - Q17: My favourite television programme begins ______ 6:30 ______ the evening.",
              "answerOptions": [
                {
                  "text": "at / in",
                  "rationale": "Dịch nghĩa: Chương trình truyền hình yêu thích của tôi bắt đầu **lúc** 6:30 **vào** buổi tối.\n\nPhân tích:\n- at + giờ (6:30).\n- in + buổi (the evening).\n\nGiải thích: Kết hợp hai quy tắc trên.",
                  "isCorrect": true
                },
                { "text": "on / in", "isCorrect": false },
                { "text": "in / at", "isCorrect": false },
                { "text": "at / on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 18,
              "question": "Ex 6 - Q18: Sometimes it snows ______ winter.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Đôi khi trời có tuyết **vào** mùa đông.\n\nPhân tích:\n- in + mùa.\n\nGiải thích: Winter -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 19,
              "question": "Ex 6 - Q19: My friend's birthday is ______ June.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Sinh nhật bạn tôi là **vào** tháng Sáu.\n\nPhân tích:\n- in + tháng (không có ngày).\n\nGiải thích: Chỉ có tháng June -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 20,
              "question": "Ex 6 - Q20: Some birds and animals come out ______ night.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Một số loài chim và động vật xuất hiện **vào** ban đêm.\n\nPhân tích:\n- at night (cụm cố định).\n\nGiải thích: Riêng buổi đêm dùng 'at', các buổi khác dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 21,
              "question": "Ex 7 - Q1: You need to submit your essay ______ 5 p.m. today. The teacher won't accept late submissions.",
              "answerOptions": [
                {
                  "text": "by",
                  "rationale": "Dịch nghĩa: Bạn cần nộp bài luận **trước** 5 giờ chiều nay. Giáo viên sẽ không nhận bài nộp muộn.\n\nPhân tích:\n- by (prep): trước/chậm nhất là (chỉ hạn chót - deadline).\n- on: vào lúc.\n- for: cho/khoảng.\n\nGiải thích: Ngữ cảnh 'won't accept late submissions' (không nhận bài muộn) -> ám chỉ Deadline -> dùng 'by'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "for", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 22,
              "question": "Ex 7 - Q2: The internet became very popular ______ the 1990s.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Internet trở nên rất phổ biến **vào** những năm 1990.\n\nPhân tích:\n- in + thập kỷ.\n\nGiải thích: Thập kỷ -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 23,
              "question": "Ex 7 - Q3: My uncle stayed in Vietnam ______ three weeks last summer.",
              "answerOptions": [
                {
                  "text": "for",
                  "rationale": "Dịch nghĩa: Chú tôi đã ở Việt Nam **trong** ba tuần vào mùa hè năm ngoái.\n\nPhân tích:\n- for + khoảng thời gian (duration).\n- on: vào.\n- by: trước.\n\nGiải thích: 'Three weeks' là khoảng thời gian kéo dài -> dùng 'for'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "by", "isCorrect": false },
                { "text": "in", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 24,
              "question": "Ex 7 - Q4: We usually visit our grandparents ______ Saturdays.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Chúng tôi thường thăm ông bà **vào** các ngày thứ Bảy.\n\nPhân tích:\n- on + thứ trong tuần.\n\nGiải thích: Saturdays -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "by", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 25,
              "question": "Ex 7 - Q5: Scientists predict that people will live on Mars ______ 50 years.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Các nhà khoa học dự đoán con người sẽ sống trên sao Hỏa **trong vòng** 50 năm nữa.\n\nPhân tích:\n- in + khoảng thời gian (tương lai): sau khoảng thời gian đó.\n- for: trong suốt (kéo dài).\n- by: trước lúc.\n\nGiải thích: Dự đoán tương lai sẽ xảy ra sau 50 năm nữa -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "for", "isCorrect": false },
                { "text": "by", "isCorrect": false },
                { "text": "on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 26,
              "question": "Ex 7 - Q6: Our first lesson always starts ______ 7:15 a.m.",
              "answerOptions": [
                {
                  "text": "at",
                  "rationale": "Dịch nghĩa: Tiết học đầu tiên của chúng tôi luôn bắt đầu **lúc** 7:15 sáng.\n\nPhân tích:\n- at + giờ cụ thể.\n\nGiải thích: 7:15 a.m. -> dùng 'at'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 27,
              "question": "Ex 7 - Q7: We have a lot of exams ______ June every year.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Chúng tôi có rất nhiều bài thi **vào** tháng Sáu hàng năm.\n\nPhân tích:\n- in + tháng.\n\nGiải thích: June -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 28,
              "question": "Ex 7 - Q8: Students must be in the classroom ______ 7 o'clock. If you arrive at 7:05, you are late.",
              "answerOptions": [
                {
                  "text": "by",
                  "rationale": "Dịch nghĩa: Học sinh phải có mặt trong lớp **trước** 7 giờ. Nếu bạn đến lúc 7:05, bạn bị muộn.\n\nPhân tích:\n- by: trước (hạn chót).\n- for: cho.\n- in: trong.\n\nGiải thích: Quy định thời gian muộn nhất được phép -> dùng 'by'.",
                  "isCorrect": true
                },
                { "text": "for", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 29,
              "question": "Ex 7 - Q9: I have studied French ______ two years, but I’m not very good at it.",
              "answerOptions": [
                {
                  "text": "for",
                  "rationale": "Dịch nghĩa: Tôi đã học tiếng Pháp **được** hai năm, nhưng tôi không giỏi lắm.\n\nPhân tích:\n- for + khoảng thời gian (dùng trong thì hoàn thành).\n\nGiải thích: 'Have studied' (hiện tại hoàn thành) + 'two years' (độ dài) -> dùng 'for'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 30,
              "question": "Ex 7 - Q10: The school festival will happen ______ November 20th.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Lễ hội trường sẽ diễn ra **vào** ngày 20 tháng 11.\n\nPhân tích:\n- on + ngày tháng cụ thể.\n\nGiải thích: Có ngày 20th -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "by", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 31,
              "question": "Ex 7 - Q11: The battery in this phone only lasts ______ 10 hours.",
              "answerOptions": [
                {
                  "text": "for",
                  "rationale": "Dịch nghĩa: Pin của điện thoại này chỉ kéo dài **trong** 10 tiếng.\n\nPhân tích:\n- last + for + khoảng thời gian: kéo dài trong bao lâu.\n\nGiải thích: '10 hours' là độ dài thời gian -> dùng 'for'.",
                  "isCorrect": true
                },
                { "text": "by", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "in", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 32,
              "question": "Ex 7 - Q12: Don't worry, the computer will restart ______ a few minutes.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Đừng lo, máy tính sẽ khởi động lại **trong** vài phút nữa.\n\nPhân tích:\n- in + khoảng thời gian (tương lai): sau khoảng thời gian đó.\n\nGiải thích: Sự việc sẽ xảy ra trong tương lai gần -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "for", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 33,
              "question": "Ex 7 - Q13: We hope to finish this robot project ______ the end of this month.",
              "answerOptions": [
                {
                  "text": "by",
                  "rationale": "Dịch nghĩa: Chúng tôi hy vọng sẽ hoàn thành dự án robot này **trước/vào** cuối tháng này.\n\nPhân tích:\n- by + mốc thời gian: trước hoặc muộn nhất là lúc đó (deadline).\n- for: cho.\n- in: trong.\n\nGiải thích: 'Finish' (hoàn thành) ám chỉ hạn chót -> dùng 'by'. ('At the end of' cũng dùng được nhưng 'by' nhấn mạnh mục tiêu hoàn thành).",
                  "isCorrect": true
                },
                { "text": "for", "isCorrect": false },
                { "text": "in", "isCorrect": false },
                { "text": "on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 34,
              "question": "Ex 7 - Q14: Steve Jobs introduced the first iPhone ______ 2007.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Steve Jobs đã giới thiệu chiếc iPhone đầu tiên **vào** năm 2007.\n\nPhân tích:\n- in + năm.\n\nGiải thích: 2007 -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 35,
              "question": "Ex 7 - Q15: I think electric cars will be cheaper ______ the near future.",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Tôi nghĩ ô tô điện sẽ rẻ hơn **trong** tương lai gần.\n\nPhân tích:\n- in the near future (cụm cố định).\n\nGiải thích: Dùng 'in' cho khoảng thời gian tương lai.",
                  "isCorrect": true
                },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 36,
              "question": "Ex 7 - Q16: Can you finish the housework ______ lunch time?",
              "answerOptions": [
                {
                  "text": "by",
                  "rationale": "Dịch nghĩa: Bạn có thể làm xong việc nhà **trước** giờ ăn trưa không?\n\nPhân tích:\n- by + mốc thời gian: trước (deadline).\n\nGiải thích: Hỏi về khả năng hoàn thành trước một mốc thời gian -> dùng 'by'.",
                  "isCorrect": true
                },
                { "text": "for", "isCorrect": false },
                { "text": "on", "isCorrect": false },
                { "text": "at", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 37,
              "question": "Ex 7 - Q17: It was very hot. We swam in the pool ______ the whole afternoon.",
              "answerOptions": [
                {
                  "text": "for",
                  "rationale": "Dịch nghĩa: Trời rất nóng. Chúng tôi đã bơi trong hồ **suốt** cả buổi chiều.\n\nPhân tích:\n- for + khoảng thời gian: trong suốt (chỉ độ dài).\n\nGiải thích: 'The whole afternoon' là khoảng thời gian -> dùng 'for'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 38,
              "question": "Ex 7 - Q18: My birthday party is ______ Sunday evening.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Tiệc sinh nhật của tôi **vào** tối Chủ nhật.\n\nPhân tích:\n- on + buổi của một ngày cụ thể (Thứ + buổi).\n\nGiải thích: Sunday evening -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 39,
              "question": "Ex 7 - Q19: The train leaves ______ 10 minutes. Hurry up!",
              "answerOptions": [
                {
                  "text": "in",
                  "rationale": "Dịch nghĩa: Tàu sẽ rời đi **trong** 10 phút nữa. Nhanh lên!\n\nPhân tích:\n- in + khoảng thời gian (tương lai): ... nữa.\n\nGiải thích: Chỉ sự việc sắp xảy ra -> dùng 'in'.",
                  "isCorrect": true
                },
                { "text": "at", "isCorrect": false },
                { "text": "for", "isCorrect": false },
                { "text": "on", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 40,
              "question": "Ex 7 - Q20: He was born ______ May 15th, 2010.",
              "answerOptions": [
                {
                  "text": "on",
                  "rationale": "Dịch nghĩa: Cậu ấy sinh **vào** ngày 15 tháng 5 năm 2010.\n\nPhân tích:\n- on + ngày tháng năm đầy đủ.\n\nGiải thích: Có ngày 15th -> dùng 'on'.",
                  "isCorrect": true
                },
                { "text": "in", "isCorrect": false },
                { "text": "at", "isCorrect": false },
                { "text": "by", "isCorrect": false }
              ]
            }
          ]
        };

        let userScore = 0;
        let answeredCount = 0;
        const totalQuestions = quizData.questions.length;
        
        // Sound Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // High pitch "Ding"
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            } else {
                // Low pitch "Buzz"
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function initQuiz() {
            const container = document.getElementById('quiz-container');
            
            quizData.questions.forEach((q, index) => {
                const qCard = document.createElement('div');
                qCard.className = 'quiz-card';
                
                // Find correct answer data for logic
                const correctOptionData = q.answerOptions.find(opt => opt.isCorrect);
                const rationaleText = correctOptionData ? correctOptionData.rationale : "Giải thích đang cập nhật...";
                const formattedRationale = rationaleText.replace(/\n/g, '<br>');

                // Generate Options HTML
                let optionsHtml = '';
                const letters = ['A', 'B', 'C', 'D'];
                
                q.answerOptions.forEach((opt, optIndex) => {
                    optionsHtml += `
                        <button class="option-btn" 
                                onclick="checkAnswer(this, ${opt.isCorrect}, 'exp-${index}')">
                            <span class="option-letter">${letters[optIndex]}</span>
                            ${opt.text}
                        </button>
                    `;
                });

                qCard.innerHTML = `
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options-grid">
                        ${optionsHtml}
                    </div>
                    <div class="explanation-box" id="exp-${index}">
                        <div class="explanation-header">
                            <i class="fas fa-chalkboard-teacher"></i> Lời giải chi tiết của Ms Mai An:
                        </div>
                        <div class="explanation-content">
                            ${formattedRationale}
                        </div>
                    </div>
                `;
                container.appendChild(qCard);
            });
        }

        function checkAnswer(btn, isCorrect, expId) {
            // Prevent multiple clicks on the same question
            const parent = btn.parentElement;
            if (parent.classList.contains('answered')) return;
            parent.classList.add('answered');

            // Disable all buttons in this group
            const buttons = parent.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true);

            // Styling & Scoring
            if (isCorrect) {
                btn.classList.add('correct');
                playSound('correct');
                fireConfetti(btn.getBoundingClientRect());
                userScore++;
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
                // Highlight the correct one
                // Use a trick: check onclick attribute or reconstruct logic. 
                // Since I generated onclick with boolean literal, I can't easily grep it back.
                // Easier: Loop buttons and find the one that corresponds to 'true'
                // Re-reading data is cleaner but here DOM traversal is fast.
                // Actually, I can just rely on the 'checkAnswer(this, true, ...)' structure in HTML,
                // but since I disabled them, I need to check which one *would* have been true.
                // Alternative: The options logic is embedded in the click handler. 
                // Let's pass the correct index or simply highlight based on matching text from data? No, data might have duplicates.
                // Better approach: In init, add data-is-correct="true"
                
                // Retrying logic:
                // Let's find the button with onclick containing "true"
                 buttons.forEach(b => {
                    if (b.getAttribute('onclick').includes('true')) {
                        b.classList.add('show-correct');
                    }
                });
            }

            answeredCount++;
            
            // Show Explanation
            const expBox = document.getElementById(expId);
            expBox.style.display = 'block';
        }

        function finishQuiz() {
            const modal = document.getElementById('scoreModal');
            const scoreDisplay = document.getElementById('finalScore');
            const detailDisplay = document.getElementById('detailScore');
            const feedback = document.getElementById('feedbackMsg');

            scoreDisplay.innerText = `${userScore}/${totalQuestions}`;
            
            const percentage = (userScore / totalQuestions) * 100;
            
            if (percentage === 100) {
                feedback.innerText = "Xuất sắc! Điểm tuyệt đối!";
                fireConfettiFull();
            } else if (percentage >= 80) {
                feedback.innerText = "Giỏi lắm! Cố gắng phát huy!";
            } else if (percentage >= 50) {
                feedback.innerText = "Khá tốt! Ôn thêm xíu nữa nha!";
            } else {
                feedback.innerText = "Cần cố gắng hơn nhé!";
            }

            detailDisplay.innerText = `Bạn đã trả lời đúng ${userScore} trên tổng số ${totalQuestions} câu hỏi.`;
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('scoreModal').style.display = 'none';
        }

        // --- CONFETTI LOGIC (Simple Particle System) ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti(rect) {
            // Burst from button position
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            createParticles(x, y, 30);
        }

        function fireConfettiFull() {
            // Burst from center
            createParticles(window.innerWidth / 2, window.innerHeight / 2, 100);
        }

        function createParticles(x, y, count) {
            const colors = ['#8854C0', '#00C9A7', '#FF4757', '#FFA502', '#2ED573'];
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    life: 100
                });
            }
            if (particles.length <= count) animateConfetti();
        }

        function animateConfetti() {
            if (particles.length === 0) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // Gravity
                p.life -= 2;
                
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            
            requestAnimationFrame(animateConfetti);
        }

        // Initialize
        initQuiz();

    </script>
</body>
</html>
