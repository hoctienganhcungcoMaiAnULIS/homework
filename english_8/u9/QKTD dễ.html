<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán t·∫≠p Th√¨ Qu√° Kh·ª© Ti·∫øp Di·ªÖn - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #8854C0; /* T√≠m Pastel */
            --secondary-color: #00C9A7; /* Xanh Ng·ªçc */
            --correct-color: #00D26A; /* Xanh l√° */
            --wrong-color: #FF4757; /* ƒê·ªè cam */
            --bg-color: #F0F4F8;
            --text-color: #2F3542;
            --card-bg: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.15);
            --btn-shadow: rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e3f2fd;
            background-image: radial-gradient(#8854C0 1px, transparent 1px), radial-gradient(#00C9A7 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        /* Header */
        header {
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 0 rgba(136, 84, 192, 0.2);
            margin-bottom: 40px;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        header h1 {
            color: var(--primary-color);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 2.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            color: #747d8c;
            font-weight: 600;
            margin-top: 10px;
        }

        .score-board {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-weight: 800;
            color: var(--secondary-color);
            z-index: 1000;
            border: 2px solid var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        /* Quiz Card */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            border: 2px solid #f1f2f6;
            transition: transform 0.3s ease;
            position: relative;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
        }

        .question-number {
            display: inline-block;
            background: var(--primary-color);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 3px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2f3542;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 1.5rem;
            }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e1e1e1;
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            box-shadow: 0 4px 0 #e1e1e1;
            outline: none;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .option-btn:hover:not(:disabled) {
            background-color: #f7f1ff;
            border-color: var(--primary-color);
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-color);
            color: #fff;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #00b85c;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: #fff;
            border-color: #ff2e40;
            box-shadow: 0 4px 0 #ff2e40;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation {
            margin-top: 25px;
            padding: 20px;
            background-color: #f0fff4;
            border: 2px solid var(--correct-color);
            border-radius: 15px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation.visible {
            display: block;
        }

        .explanation h4 {
            margin: 0 0 10px 0;
            color: var(--correct-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap; /* Preserves newlines */
        }

        .explanation-content strong {
            color: var(--primary-color);
        }
        
        /* Hint Button */
        .hint-btn {
            background: none;
            border: none;
            color: #ffa502;
            cursor: pointer;
            font-weight: 700;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .hint-text {
            display: none;
            color: #ffa502;
            font-style: italic;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        /* Submit Section */
        .submit-section {
            text-align: center;
            margin: 50px 0;
        }

        .submit-btn {
            background: var(--secondary-color);
            color: #fff;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #00a388;
            transition: all 0.2s;
        }

        .submit-btn:hover {
            transform: scale(1.05);
        }

        .submit-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #fff;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary-color);
        }

        .final-score {
            font-size: 4rem;
            color: var(--primary-color);
            font-weight: 900;
            margin: 10px 0;
        }

        .modal-message {
            font-size: 1.2rem;
            color: #57606f;
            margin-bottom: 20px;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>

    <div class="score-board">
        <span>‚≠ê</span> <span id="current-score">0</span>
    </div>

    <div class="container">
        <header>
            <h1>Luy·ªán t·∫≠p Th√¨ Qu√° Kh·ª© Ti·∫øp Di·ªÖn</h1>
            <p>Gi√°o vi√™n: Ms Mai An (ULIS)</p>
            <p style="font-size: 0.9rem; color: #a4b0be;">H√£y ch·ªçn ƒë√°p √°n ƒë√∫ng nh·∫•t ƒë·ªÉ xem gi·∫£i th√≠ch chi ti·∫øt nh√©!</p>
        </header>

        <div id="quiz-container">
            <!-- Questions will be rendered here via JavaScript -->
        </div>

        <div class="submit-section">
            <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI üöÄ</button>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
            <div class="final-score" id="final-score-display">0/30</div>
            <p class="modal-message" id="modal-message">B·∫°n l√†m t·ªët l·∫Øm!</p>
            <button class="submit-btn" onclick="location.reload()" style="font-size: 1.2rem; padding: 10px 30px;">L√†m l·∫°i b√†i thi üîÑ</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <!-- Using reliable short sounds -->
    <audio id="sound-correct" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

<script>
    // DATA T·ª™ B√ÄI T·∫¨P C·ª¶A B·∫†N
    const quizData = {
      "questions": [
        {
          "questionNumber": 1,
          "question": "I _____ watching TV at 8 o‚Äôclock last night.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü (d√πng cho s·ªë √≠t: I, He, She, It)\nB. were (verb): th√¨/l√†/·ªü (d√πng cho s·ªë nhi·ªÅu: You, We, They)\nC. am (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i, ƒëi v·ªõi I)\nD. is (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i, s·ªë √≠t)\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ l√† 'I' (t·ªõ/t√¥i) n√™n trong qu√° kh·ª© ta d√πng 'was'.\n\nD·ªãch c√¢u: T·ªõ ƒëang xem TV l√∫c 8 gi·ªù t·ªëi qua.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "am", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Ch·ªß ng·ªØ 'I' ƒëi v·ªõi 'was' hay 'were' nh·ªâ?"
        },
        {
          "questionNumber": 2,
          "question": "They _____ playing football yesterday afternoon.",
          "answerOptions": [
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü (s·ªë √≠t)\nB. were (verb): th√¨/l√†/·ªü (s·ªë nhi·ªÅu)\nC. do (verb): l√†m\nD. are (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'They' (h·ªç) l√† s·ªë nhi·ªÅu n√™n ta d√πng 'were'.\n\nD·ªãch c√¢u: H·ªç ƒëang ch∆°i b√≥ng ƒë√° v√†o chi·ªÅu h√¥m qua.", "isCorrect": true },
            { "text": "do", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Ch·ªß ng·ªØ 'They' l√† s·ªë nhi·ªÅu hay s·ªë √≠t?"
        },
        {
          "questionNumber": 3,
          "question": "She _____ cooking dinner when I came.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü (qu√° kh·ª© s·ªë √≠t)\nB. were (verb): th√¨/l√†/·ªü (qu√° kh·ª© s·ªë nhi·ªÅu)\nC. is (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\nD. are (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'She' (c√¥ ·∫•y) l√† s·ªë √≠t n√™n ƒëi v·ªõi 'was'.\n\nD·ªãch c√¢u: C√¥ ·∫•y ƒëang n·∫•u b·ªØa t·ªëi khi t·ªõ ƒë·∫øn.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "M·ªôt ng∆∞·ªùi (She) th√¨ d√πng was hay were?"
        },
        {
          "questionNumber": 4,
          "question": "What _____ you doing at 7 p.m yesterday?",
          "answerOptions": [
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. did (verb): l√†m (tr·ª£ ƒë·ªông t·ª´ qu√° kh·ª© ƒë∆°n)\nD. are (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'You' (b·∫°n) lu√¥n ƒëi v·ªõi 'were' trong c√¢u h·ªèi qu√° kh·ª© ti·∫øp di·ªÖn.\n\nD·ªãch c√¢u: B·∫°n ƒëang l√†m g√¨ l√∫c 7 gi·ªù t·ªëi qua v·∫≠y?", "isCorrect": true },
            { "text": "did", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "ƒêi v·ªõi 'You' th√¨ d√πng 'was' hay 'were'?"
        },
        {
          "questionNumber": 5,
          "question": "He _____ reading a book at this time last Sunday.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\nD. are (verb): th√¨/l√†/·ªü (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'He' (anh ·∫•y) l√† s·ªë √≠t -> d√πng 'was'. C·ª•m 'at this time last Sunday' l√† d·∫•u hi·ªáu c·ªßa qu√° kh·ª© ti·∫øp di·ªÖn.\n\nD·ªãch c√¢u: Gi·ªù n√†y Ch·ªß nh·∫≠t tr∆∞·ªõc anh ·∫•y ƒëang ƒë·ªçc s√°ch.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "He l√† anh ·∫•y (1 ng∆∞·ªùi)."
        },
        {
          "questionNumber": 6,
          "question": "We _____ sleeping when the phone rang.",
          "answerOptions": [
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. did (verb): l√†m\nD. are (verb): th√¨/l√†/·ªü\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'We' (ch√∫ng t·ªõ/ch√∫ng t√¥i) l√† s·ªë nhi·ªÅu -> d√πng 'were'. ƒê√¢y l√† h√†nh ƒë·ªông d√†i (ƒëang ng·ªß) b·ªã chen ngang.\n\nD·ªãch c√¢u: Ch√∫ng t·ªõ ƒëang ng·ªß th√¨ ƒëi·ªán tho·∫°i reo.", "isCorrect": true },
            { "text": "did", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "We l√† s·ªë nhi·ªÅu (ch√∫ng t√¥i)."
        },
        {
          "questionNumber": 7,
          "question": "Was she _____ to music?",
          "answerOptions": [
            { "text": "listening", "rationale": "D·ªãch chi ti·∫øt:\nA. listening (verb-ing): ƒëang nghe\nB. listened (verb-ed): ƒë√£ nghe\nC. listen (verb): nghe (nguy√™n th·ªÉ)\nD. listens (verb-s): nghe (chia ng√¥i th·ª© 3)\n\nGi·∫£i th√≠ch: C√¥ng th·ª©c c√¢u h·ªèi: Was + S + V-ing? N√™n ƒë·ªông t·ª´ ph·∫£i th√™m ƒëu√¥i -ing.\n\nD·ªãch c√¢u: C√¥ ·∫•y c√≥ ƒëang nghe nh·∫°c kh√¥ng?", "isCorrect": true },
            { "text": "listened", "rationale": "...", "isCorrect": false },
            { "text": "listen", "rationale": "...", "isCorrect": false },
            { "text": "listens", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Sau Was/Were ƒë·ªông t·ª´ ph·∫£i th√™m ƒëu√¥i g√¨?"
        },
        {
          "questionNumber": 8,
          "question": "While my mom was cooking, my dad _____ reading a newspaper.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü\nD. are (verb): th√¨/l√†/·ªü\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'my dad' (b·ªë t·ªõ) l√† 1 ng∆∞·ªùi (s·ªë √≠t) -> d√πng 'was'. ƒê√¢y l√† 2 h√†nh ƒë·ªông x·∫£y ra song song.\n\nD·ªãch c√¢u: Trong khi m·∫π t·ªõ ƒëang n·∫•u ƒÉn th√¨ b·ªë t·ªõ ƒëang ƒë·ªçc b√°o.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "B·ªë (my dad) l√† s·ªë √≠t hay nhi·ªÅu?"
        },
        {
          "questionNumber": 9,
          "question": "It _____ raining at 3 o'clock yesterday.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü\nD. are (verb): th√¨/l√†/·ªü\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'It' (tr·ªùi/n√≥) l√† s·ªë √≠t -> d√πng 'was'.\n\nD·ªãch c√¢u: Tr·ªùi ƒëang m∆∞a l√∫c 3 gi·ªù h√¥m qua.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "It (s·ªë √≠t) ƒëi v·ªõi Was hay Were?"
        },
        {
          "questionNumber": 10,
          "question": "_____ they watching TV when you arrived?",
          "answerOptions": [
            { "text": "Were", "rationale": "D·ªãch chi ti·∫øt:\nA. Were (verb): Th√¨/l√†/·ªü (qu√° kh·ª©)\nB. Was (verb): Th√¨/l√†/·ªü (qu√° kh·ª©)\nC. Do (verb): L√†m (tr·ª£ ƒë·ªông t·ª´)\nD. Did (verb): ƒê√£ l√†m (tr·ª£ ƒë·ªông t·ª´)\n\nGi·∫£i th√≠ch: C√¢u h·ªèi v·ªõi ch·ªß ng·ªØ 'they' (h·ªç - s·ªë nhi·ªÅu) -> D√πng 'Were' ƒë·ª©ng ƒë·∫ßu c√¢u.\n\nD·ªãch c√¢u: H·ªç c√≥ ƒëang xem TV khi b·∫°n ƒë·∫øn kh√¥ng?", "isCorrect": true },
            { "text": "Was", "rationale": "...", "isCorrect": false },
            { "text": "Do", "rationale": "...", "isCorrect": false },
            { "text": "Did", "rationale": "...", "isCorrect": false }
          ],
          "hint": "They l√† s·ªë nhi·ªÅu."
        },
        {
          "questionNumber": 11,
          "question": "My friends _____ playing games at 4 p.m.",
          "answerOptions": [
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü\nD. are (verb): th√¨/l√†/·ªü\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'My friends' l√† s·ªë nhi·ªÅu -> d√πng 'were'.\n\nD·ªãch c√¢u: B·∫°n b√® c·ªßa t·ªõ ƒëang ch∆°i tr√≤ ch∆°i l√∫c 4 gi·ªù chi·ªÅu.", "isCorrect": true },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "My friends (c√≥ s) l√† s·ªë nhi·ªÅu."
        },
        {
          "questionNumber": 12,
          "question": "I was _____ homework when he called.",
          "answerOptions": [
            { "text": "doing", "rationale": "D·ªãch chi ti·∫øt:\nA. doing (verb-ing): ƒëang l√†m\nB. do (verb): l√†m\nC. did (verb): ƒë√£ l√†m\nD. does (verb-s): l√†m\n\nGi·∫£i th√≠ch: Sau 'was' ph·∫£i l√† V-ing (doing homework).\n\nD·ªãch c√¢u: T·ªõ ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√† th√¨ c·∫≠u ·∫•y g·ªçi.", "isCorrect": true },
            { "text": "do", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false },
            { "text": "does", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Doing homework hay Do homework?"
        },
        {
          "questionNumber": 13,
          "question": "_____ you having lunch at 12 o'clock?",
          "answerOptions": [
            { "text": "Were", "rationale": "D·ªãch chi ti·∫øt:\nA. Were (verb): Th√¨/l√†/·ªü\nB. Was (verb): Th√¨/l√†/·ªü\nC. Are (verb): Th√¨/l√†/·ªü (hi·ªán t·∫°i)\nD. Do (verb): L√†m\n\nGi·∫£i th√≠ch: ƒêi v·ªõi 'You' ph·∫£i d√πng 'Were'.\n\nD·ªãch c√¢u: B·∫°n c√≥ ƒëang ƒÉn tr∆∞a l√∫c 12 gi·ªù kh√¥ng?", "isCorrect": true },
            { "text": "Was", "rationale": "...", "isCorrect": false },
            { "text": "Are", "rationale": "...", "isCorrect": false },
            { "text": "Do", "rationale": "...", "isCorrect": false }
          ],
          "hint": "You ƒëi v·ªõi Were hay Was?"
        },
        {
          "questionNumber": 14,
          "question": "No, they _____.",
          "answerOptions": [
            { "text": "weren't", "rationale": "D·ªãch chi ti·∫øt:\nA. weren't (verb): kh√¥ng ph·∫£i (vi·∫øt t·∫Øt were not)\nB. wasn't (verb): kh√¥ng ph·∫£i (vi·∫øt t·∫Øt was not)\nC. didn't (verb): kh√¥ng l√†m (qu√° kh·ª© ƒë∆°n)\nD. aren't (verb): kh√¥ng ph·∫£i (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: C√¢u tr·∫£ l·ªùi ng·∫Øn cho c√¢u h·ªèi 'Were they...?' l√† 'No, they weren't'.\n\nD·ªãch c√¢u: Kh√¥ng, h·ªç kh√¥ng ph·∫£i.", "isCorrect": true },
            { "text": "wasn't", "rationale": "...", "isCorrect": false },
            { "text": "didn't", "rationale": "...", "isCorrect": false },
            { "text": "aren't", "rationale": "...", "isCorrect": false }
          ],
          "hint": "C√¢u ph·ªß ƒë·ªãnh c·ªßa Were they l√† No, they ...?"
        },
        {
          "questionNumber": 15,
          "question": "While Tom was reading, Jerry _____ eating.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü\nD. did (verb): l√†m\n\nGi·∫£i th√≠ch: Jerry (1 b·∫°n chu·ªôt) l√† s·ªë √≠t -> d√πng 'was'. H√†nh ƒë·ªông song song: Tom ƒë·ªçc, Jerry ƒÉn.\n\nD·ªãch c√¢u: Trong khi Tom ƒëang ƒë·ªçc s√°ch th√¨ Jerry ƒëang ƒÉn.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Jerry (s·ªë √≠t) ƒëi v·ªõi Was hay Were?"
        },
        {
          "questionNumber": 16,
          "question": "What was she doing _____ this time yesterday?",
          "answerOptions": [
            { "text": "at", "rationale": "D·ªãch chi ti·∫øt:\nA. at (prep): t·∫°i/l√∫c\nB. in (prep): trong\nC. on (prep): tr√™n\nD. for (prep): cho\n\nGi·∫£i th√≠ch: C·ª•m t·ª´ ch·ªâ th·ªùi gian 'at this time' (v√†o th·ªùi ƒëi·ªÉm n√†y).\n\nD·ªãch c√¢u: C√¥ ·∫•y ƒëang l√†m g√¨ v√†o th·ªùi ƒëi·ªÉm n√†y h√¥m qua?", "isCorrect": true },
            { "text": "in", "rationale": "...", "isCorrect": false },
            { "text": "on", "rationale": "...", "isCorrect": false },
            { "text": "for", "rationale": "...", "isCorrect": false }
          ],
          "hint": "C·ª•m t·ª´: ... this time (V√†o l√∫c n√†y)."
        },
        {
          "questionNumber": 17,
          "question": "We weren't _____ games.",
          "answerOptions": [
            { "text": "playing", "rationale": "D·ªãch chi ti·∫øt:\nA. playing (verb-ing): ƒëang ch∆°i\nB. play (verb): ch∆°i\nC. played (verb-ed): ƒë√£ ch∆°i\nD. plays (verb-s): ch∆°i\n\nGi·∫£i th√≠ch: C√¢u ph·ªß ƒë·ªãnh qu√° kh·ª© ti·∫øp di·ªÖn: We weren't + V-ing.\n\nD·ªãch c√¢u: Ch√∫ng t·ªõ kh√¥ng ƒëang ch∆°i tr√≤ ch∆°i.", "isCorrect": true },
            { "text": "play", "rationale": "...", "isCorrect": false },
            { "text": "played", "rationale": "...", "isCorrect": false },
            { "text": "plays", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Sau wasn't/weren't ƒë·ªông t·ª´ ph·∫£i th√™m g√¨?"
        },
        {
          "questionNumber": 18,
          "question": "The dog was _____ in the garden.",
          "answerOptions": [
            { "text": "running", "rationale": "D·ªãch chi ti·∫øt:\nA. running (verb-ing): ƒëang ch·∫°y\nB. run (verb): ch·∫°y\nC. ran (verb): ƒë√£ ch·∫°y\nD. runs (verb): ch·∫°y\n\nGi·∫£i th√≠ch: C·∫•u tr√∫c: Was + V-ing. (L∆∞u √Ω: run -> running).\n\nD·ªãch c√¢u: Ch√∫ ch√≥ ƒëang ch·∫°y trong v∆∞·ªùn.", "isCorrect": true },
            { "text": "run", "rationale": "...", "isCorrect": false },
            { "text": "ran", "rationale": "...", "isCorrect": false },
            { "text": "runs", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Was + V-ing."
        },
        {
          "questionNumber": 19,
          "question": "He was watching TV _____ I arrived.",
          "answerOptions": [
            { "text": "when", "rationale": "D·ªãch chi ti·∫øt:\nA. when (adv): khi\nB. while (conj): trong khi\nC. what (pronoun): c√°i g√¨\nD. where (adv): ·ªü ƒë√¢u\n\nGi·∫£i th√≠ch: D√πng 'when' ƒë·ªÉ n·ªëi h√†nh ƒë·ªông d√†i (ƒëang xem TV) v·ªõi h√†nh ƒë·ªông ng·∫Øn chen ngang (t√¥i ƒë·∫øn).\n\nD·ªãch c√¢u: Anh ·∫•y ƒëang xem TV th√¨ t√¥i ƒë·∫øn.", "isCorrect": true },
            { "text": "while", "rationale": "...", "isCorrect": false },
            { "text": "what", "rationale": "...", "isCorrect": false },
            { "text": "where", "rationale": "...", "isCorrect": false }
          ],
          "hint": "H√†nh ƒë·ªông ng·∫Øn chen v√†o th√¨ d√πng When hay While?"
        },
        {
          "questionNumber": 20,
          "question": "My parents _____ working at 9 a.m yesterday.",
          "answerOptions": [
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. were (verb): th√¨/l√†/·ªü\nB. was (verb): th√¨/l√†/·ªü\nC. are (verb): th√¨/l√†/·ªü\nD. do (verb): l√†m\n\nGi·∫£i th√≠ch: 'Parents' (b·ªë m·∫π) l√† s·ªë nhi·ªÅu -> d√πng 'were'.\n\nD·ªãch c√¢u: B·ªë m·∫π t·ªõ ƒëang l√†m vi·ªác l√∫c 9 gi·ªù s√°ng h√¥m qua.", "isCorrect": true },
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false },
            { "text": "do", "rationale": "...", "isCorrect": false }
          ],
          "hint": "B·ªë m·∫π (2 ng∆∞·ªùi) l√† s·ªë nhi·ªÅu."
        },
        {
          "questionNumber": 21,
          "question": "Was John _____ a bike?",
          "answerOptions": [
            { "text": "riding", "rationale": "D·ªãch chi ti·∫øt:\nA. riding (verb-ing): ƒëang l√°i (xe ƒë·∫°p, ng·ª±a)\nB. driving (verb-ing): ƒëang l√°i (√¥ t√¥)\nC. playing (verb-ing): ƒëang ch∆°i\nD. going (verb-ing): ƒëang ƒëi\n\nGi·∫£i th√≠ch: ƒêi xe ƒë·∫°p d√πng t·ª´ 'ride a bike' -> Chuy·ªÉn sang ti·∫øp di·ªÖn l√† 'riding'.\n\nD·ªãch c√¢u: John c√≥ ƒëang ƒë·∫°p xe kh√¥ng?", "isCorrect": true },
            { "text": "driving", "rationale": "...", "isCorrect": false },
            { "text": "playing", "rationale": "...", "isCorrect": false },
            { "text": "going", "rationale": "...", "isCorrect": false }
          ],
          "hint": "ƒêi xe ƒë·∫°p d√πng t·ª´ Ride."
        },
        {
          "questionNumber": 22,
          "question": "I was sleeping when the cat _____ on my bed.",
          "answerOptions": [
            { "text": "jumped", "rationale": "D·ªãch chi ti·∫øt:\nA. jumped (verb-ed): ƒë√£ nh·∫£y (qu√° kh·ª© ƒë∆°n)\nB. jumping (verb-ing): ƒëang nh·∫£y\nC. jumps (verb-s): nh·∫£y\nD. jump (verb): nh·∫£y\n\nGi·∫£i th√≠ch: H√†nh ƒë·ªông ng·∫Øn chen ngang (khi con m√®o nh·∫£y l√™n) d√πng th√¨ Qu√° kh·ª© ƒë∆°n (V-ed). T·ªõ ƒëang ng·ªß (d√†i) th√¨ m√®o nh·∫£y l√™n (ng·∫Øn/b·∫•t ng·ªù).\n\nD·ªãch c√¢u: T·ªõ ƒëang ng·ªß th√¨ con m√®o nh·∫£y l√™n gi∆∞·ªùng t·ªõ.", "isCorrect": true },
            { "text": "jumping", "rationale": "...", "isCorrect": false },
            { "text": "jumps", "rationale": "...", "isCorrect": false },
            { "text": "jump", "rationale": "...", "isCorrect": false }
          ],
          "hint": "H√†nh ƒë·ªông ng·∫Øn (m√®o nh·∫£y) d√πng Qu√° kh·ª© ƒë∆°n (th√™m ed)."
        },
        {
          "questionNumber": 23,
          "question": "_____ your sister singing?",
          "answerOptions": [
            { "text": "Was", "rationale": "D·ªãch chi ti·∫øt:\nA. Was (verb): Th√¨/l√†/·ªü\nB. Were (verb): Th√¨/l√†/·ªü\nC. Did (verb): ƒê√£ l√†m\nD. Is (verb): L√† (hi·ªán t·∫°i)\n\nGi·∫£i th√≠ch: 'Your sister' (ch·ªã g√°i c·ªßa b·∫°n) l√† 1 ng∆∞·ªùi (s·ªë √≠t) -> D√πng 'Was'.\n\nD·ªãch c√¢u: Ch·ªã g√°i c·∫≠u c√≥ ƒëang h√°t kh√¥ng?", "isCorrect": true },
            { "text": "Were", "rationale": "...", "isCorrect": false },
            { "text": "Did", "rationale": "...", "isCorrect": false },
            { "text": "Is", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Ch·ªã g√°i (1 ng∆∞·ªùi) d√πng Was."
        },
        {
          "questionNumber": 24,
          "question": "Yes, I _____.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): l√†/th√¨ (qu√° kh·ª©)\nB. were (verb): l√†/th√¨ (qu√° kh·ª©)\nC. am (verb): l√†/th√¨ (hi·ªán t·∫°i)\nD. did (verb): ƒë√£ l√†m\n\nGi·∫£i th√≠ch: C√¢u tr·∫£ l·ªùi ng·∫Øn cho 'Were you...?': Yes, I was.\n\nD·ªãch c√¢u: V√¢ng, ƒë√∫ng v·∫≠y (t·ªõ ƒëang l√†m).", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "am", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false }
          ],
          "hint": "C√¢u tr·∫£ l·ªùi ng·∫Øn: Yes, I was."
        },
        {
          "questionNumber": 25,
          "question": "I was _____ lunch when you came.",
          "answerOptions": [
            { "text": "having", "rationale": "D·ªãch chi ti·∫øt:\nA. having (verb-ing): ƒëang ƒÉn/c√≥\nB. have (verb): ƒÉn/c√≥\nC. had (verb): ƒë√£ ƒÉn/c√≥\nD. has (verb): ƒÉn/c√≥\n\nGi·∫£i th√≠ch: Was + V-ing. (Have -> Having).\n\nD·ªãch c√¢u: T·ªõ ƒëang ƒÉn tr∆∞a th√¨ c·∫≠u ƒë·∫øn.", "isCorrect": true },
            { "text": "have", "rationale": "...", "isCorrect": false },
            { "text": "had", "rationale": "...", "isCorrect": false },
            { "text": "has", "rationale": "...", "isCorrect": false }
          ],
          "hint": "ƒÇn tr∆∞a l√† 'have lunch', chuy·ªÉn sang ƒëang ƒÉn l√†...?"
        },
        {
          "questionNumber": 26,
          "question": "We _____ playing chess.",
          "answerOptions": [
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. were (verb): th√¨/l√†/·ªü\nB. was (verb): th√¨/l√†/·ªü\nC. did (verb): l√†m\nD. are (verb): th√¨/l√†/·ªü\n\nGi·∫£i th√≠ch: 'We' ƒëi v·ªõi 'were'.\n\nD·ªãch c√¢u: Ch√∫ng t·ªõ ƒëang ch∆°i c·ªù vua.", "isCorrect": true },
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Chess l√† c·ªù vua."
        },
        {
          "questionNumber": 27,
          "question": "While Linda was drawing, Peter _____ coloring.",
          "answerOptions": [
            { "text": "was", "rationale": "D·ªãch chi ti·∫øt:\nA. was (verb): th√¨/l√†/·ªü\nB. were (verb): th√¨/l√†/·ªü\nC. is (verb): th√¨/l√†/·ªü\nD. did (verb): l√†m\n\nGi·∫£i th√≠ch: Hai h√†nh ƒë·ªông song song: Linda v·∫Ω, Peter t√¥ m√†u. Peter (1 ng∆∞·ªùi) d√πng 'was'.\n\nD·ªãch c√¢u: Trong khi Linda ƒëang v·∫Ω th√¨ Peter ƒëang t√¥ m√†u.", "isCorrect": true },
            { "text": "were", "rationale": "...", "isCorrect": false },
            { "text": "is", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Peter l√† s·ªë √≠t."
        },
        {
          "questionNumber": 28,
          "question": "Was it _____ yesterday?",
          "answerOptions": [
            { "text": "raining", "rationale": "D·ªãch chi ti·∫øt:\nA. raining (verb-ing): ƒëang m∆∞a\nB. rain (verb/noun): m∆∞a\nC. rained (verb-ed): ƒë√£ m∆∞a\nD. rains (verb-s): m∆∞a\n\nGi·∫£i th√≠ch: Was + It + V-ing? (C·∫•u tr√∫c c√¢u h·ªèi).\n\nD·ªãch c√¢u: H√¥m qua tr·ªùi c√≥ ƒëang m∆∞a kh√¥ng?", "isCorrect": true },
            { "text": "rain", "rationale": "...", "isCorrect": false },
            { "text": "rained", "rationale": "...", "isCorrect": false },
            { "text": "rains", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Was + It + ...ing?"
        },
        {
          "questionNumber": 29,
          "question": "What _____ you doing when the lights went out?",
          "answerOptions": [
            { "text": "were", "rationale": "D·ªãch chi ti·∫øt:\nA. were (verb): th√¨/l√†/·ªü\nB. was (verb): th√¨/l√†/·ªü\nC. are (verb): th√¨/l√†/·ªü\nD. did (verb): l√†m\n\nGi·∫£i th√≠ch: Ch·ªß ng·ªØ 'you' ƒëi v·ªõi 'were'. (The lights went out: ƒê√®n t·∫Øt -> h√†nh ƒë·ªông ng·∫Øn).\n\nD·ªãch c√¢u: B·∫°n ƒëang l√†m g√¨ khi ƒë√®n t·∫Øt?", "isCorrect": true },
            { "text": "was", "rationale": "...", "isCorrect": false },
            { "text": "are", "rationale": "...", "isCorrect": false },
            { "text": "did", "rationale": "...", "isCorrect": false }
          ],
          "hint": "You ƒëi v·ªõi Were."
        },
        {
          "questionNumber": 30,
          "question": "He wasn't _____ a book.",
          "answerOptions": [
            { "text": "reading", "rationale": "D·ªãch chi ti·∫øt:\nA. reading (verb-ing): ƒëang ƒë·ªçc\nB. read (verb): ƒë·ªçc\nC. reads (verb-s): ƒë·ªçc\nD. to read (verb): ƒë·ªÉ ƒë·ªçc\n\nGi·∫£i th√≠ch: Wasn't + V-ing.\n\nD·ªãch c√¢u: Anh ·∫•y kh√¥ng ƒëang ƒë·ªçc s√°ch.", "isCorrect": true },
            { "text": "read", "rationale": "...", "isCorrect": false },
            { "text": "reads", "rationale": "...", "isCorrect": false },
            { "text": "to read", "rationale": "...", "isCorrect": false }
          ],
          "hint": "Wasn't + V-ing."
        }
      ]
    };

    let score = 0;
    let correctCount = 0;

    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        
        quizData.questions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.id = `card-${index}`;

            // T√¨m correct rationale ƒë·ªÉ hi·ªÉn th·ªã n·∫øu user ch·ªçn sai
            const correctOption = q.answerOptions.find(opt => opt.isCorrect);
            const correctRationale = correctOption ? correctOption.rationale : "Gi·∫£i th√≠ch ƒëang c·∫≠p nh·∫≠t...";

            // Create buttons HTML
            let optionsHtml = '';
            q.answerOptions.forEach((opt, optIndex) => {
                optionsHtml += `
                    <button class="option-btn" 
                            id="btn-${index}-${optIndex}"
                            onclick="checkAnswer(${index}, ${optIndex}, ${opt.isCorrect})">
                        ${String.fromCharCode(65 + optIndex)}. ${opt.text}
                    </button>
                `;
            });

            // Store rationales in data attributes to load dynamically
            const rationaleData = JSON.stringify(q.answerOptions.map(o => o.rationale || correctRationale));

            card.innerHTML = `
                <div class="question-number">C√¢u ${q.questionNumber}</div>
                <div class="question-text">${q.question}</div>
                <div class="options-grid">
                    ${optionsHtml}
                </div>
                
                <button class="hint-btn" onclick="toggleHint(${index})">
                    üí° Xem g·ª£i √Ω
                </button>
                <div id="hint-${index}" class="hint-text">${q.hint}</div>

                <div class="explanation" id="expl-${index}">
                    <h4><span id="expl-icon-${index}"></span> Ms Mai An gi·∫£i th√≠ch:</h4>
                    <div class="explanation-content" id="expl-content-${index}"></div>
                </div>
                <input type="hidden" id="rationales-${index}" value='${rationaleData.replace(/'/g, "&#39;")}'>
            `;
            container.appendChild(card);
        });
    }

    function toggleHint(index) {
        const hintDiv = document.getElementById(`hint-${index}`);
        if (hintDiv.style.display === 'block') {
            hintDiv.style.display = 'none';
        } else {
            hintDiv.style.display = 'block';
        }
    }

    function checkAnswer(questionIndex, optionIndex, isCorrect) {
        const card = document.getElementById(`card-${questionIndex}`);
        const btns = card.querySelectorAll('.option-btn');
        const selectedBtn = document.getElementById(`btn-${questionIndex}-${optionIndex}`);
        const explBox = document.getElementById(`expl-${questionIndex}`);
        const explContent = document.getElementById(`expl-content-${questionIndex}`);
        const explIcon = document.getElementById(`expl-icon-${questionIndex}`);

        // Prevent multiple clicks
        if (card.classList.contains('answered')) return;
        card.classList.add('answered');

        // Disable all buttons
        btns.forEach(btn => btn.disabled = true);

        // Get rationales
        const rationales = JSON.parse(document.getElementById(`rationales-${questionIndex}`).value);
        let rationaleText = rationales[optionIndex];
        
        // Format newlines
        if (rationaleText === "...") {
             // Fallback if specific wrong rationale isn't provided in JSON (using correct one instead)
             const correctOptIndex = quizData.questions[questionIndex].answerOptions.findIndex(o => o.isCorrect);
             rationaleText = rationales[correctOptIndex];
        }
        
        explContent.innerHTML = rationaleText.replace(/\n/g, '<br>');

        if (isCorrect) {
            // Correct Logic
            selectedBtn.classList.add('correct');
            document.getElementById('sound-correct').play();
            explIcon.innerText = "‚úÖ";
            score += 10;
            correctCount++;
            document.getElementById('current-score').innerText = score;
            
            // Confetti
            const rect = selectedBtn.getBoundingClientRect();
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { 
                    x: (rect.left + rect.width / 2) / window.innerWidth, 
                    y: (rect.top + rect.height / 2) / window.innerHeight 
                }
            });

        } else {
            // Wrong Logic
            selectedBtn.classList.add('wrong');
            document.getElementById('sound-wrong').play();
            explIcon.innerText = "‚ùå";
            
            // Highlight the correct answer
            quizData.questions[questionIndex].answerOptions.forEach((opt, idx) => {
                if (opt.isCorrect) {
                    document.getElementById(`btn-${questionIndex}-${idx}`).classList.add('correct');
                }
            });
        }

        // Show Explanation
        explBox.classList.add('visible');
    }

    function finishQuiz() {
        const total = quizData.questions.length;
        const modal = document.getElementById('result-modal');
        const scoreDisplay = document.getElementById('final-score-display');
        const messageDisplay = document.getElementById('modal-message');

        scoreDisplay.innerText = `${correctCount}/${total}`;

        if (correctCount === total) {
            messageDisplay.innerText = "Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng·ªØ ph√°p! üèÜ";
            confetti({ particleCount: 500, spread: 100, origin: { y: 0.6 } });
        } else if (correctCount >= total * 0.8) {
            messageDisplay.innerText = "R·∫•t gi·ªèi! Ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i! üåü";
        } else if (correctCount >= total * 0.5) {
            messageDisplay.innerText = "C·ªë g·∫Øng th√™m nh√©! Xem l·∫°i c√°c c√¢u sai ƒë·ªÉ h·ªçc t·ªët h∆°n. üí™";
        } else {
            messageDisplay.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y √¥n t·∫≠p l·∫°i l√Ω thuy·∫øt v√† th·ª≠ l·∫°i n√†o. üìö";
        }

        modal.style.display = 'flex';
    }

    // Initialize
    renderQuiz();

</script>
</body>
</html>
