<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Ti·∫øng Anh - Ms Mai An ULIS (Fixed Scroll)</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            /* Dynamic Theme Colors: Family/Sister Theme -> Warm Pink & Soft Teal */
            --primary-color: #FF6B6B; /* Warm Salmon/Pink */
            --secondary-color: #4ECDC4; /* Soft Teal */
            --accent-color: #FFE66D; /* Pop Yellow */
            --text-dark: #2D3436;
            --text-light: #F7F1E3;
            --correct-color: #00D26A;
            --wrong-color: #FF4757;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            height: 100vh; /* Full viewport height */
            width: 100vw;
            overflow: hidden; /* Prevent scroll on body level */
            color: var(--text-dark);
            /* Auto-generated SVG Background with Emojis */
            background-color: #FFE5E5;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' stop-color='%23FF9A9E' stop-opacity='0.5'/%3E%3Cstop offset='100%25' stop-color='%23FECFEF' stop-opacity='0'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23g)'/%3E%3Ctext x='10%25' y='20%25' font-size='80' opacity='0.2'%3Eüë≠%3C/text%3E%3Ctext x='80%25' y='10%25' font-size='80' opacity='0.2'%3Eüè†%3C/text%3E%3Ctext x='20%25' y='80%25' font-size='80' opacity='0.2'%3Eüíñ%3C/text%3E%3Ctext x='70%25' y='70%25' font-size='80' opacity='0.2'%3EüçÄ%3C/text%3E%3C/svg%3E");
            background-size: cover;
            display: flex;
            flex-direction: column;
        }

        /* Top Bar */
        header {
            background: white;
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            flex-shrink: 0; /* Header does not shrink */
        }

        .teacher-brand {
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .teacher-brand span {
            background: var(--secondary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .timer-container {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-color);
            background: #FFF0F0;
            padding: 5px 20px;
            border-radius: 20px;
            border: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .timer-container:hover { transform: scale(1.05); }

        /* Main Layout - FIXED SCROLLING LOGIC */
        .main-container {
            display: flex;
            flex: 1; /* Takes remaining height */
            height: calc(100vh - 60px); /* Explicit height calculation */
            overflow: hidden; /* Contains the scrollable children */
            position: relative;
        }

        /* Panel Styling */
        .panel {
            flex: 1;
            height: 100%; /* Fill the container height */
            overflow-y: auto; /* Enable vertical scroll */
            padding: 20px;
            scroll-behavior: smooth;
            /* Scrollbar styling for Webkit */
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) #f1f1f1;
        }

        /* Scrollbar aesthetics */
        .panel::-webkit-scrollbar { width: 10px; }
        .panel::-webkit-scrollbar-track { background: #f1f1f1; }
        .panel::-webkit-scrollbar-thumb { background: var(--secondary-color); border-radius: 10px; border: 2px solid #f1f1f1; }

        /* Left Panel: Reading */
        #reading-panel {
            background: rgba(255, 255, 255, 0.85);
            border-right: 2px solid #eee;
            backdrop-filter: blur(5px);
            padding-bottom: 50px; /* Extra space at bottom */
        }

        .passage-title {
            color: var(--text-dark);
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid var(--primary-color);
            display: inline-block;
            padding-bottom: 5px;
        }

        .passage-part {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            line-height: 1.8;
            font-size: 1.05rem;
        }
        
        .passage-part h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .translation-btn {
            background: var(--text-dark);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            display: inline-block;
            transition: 0.2s;
        }
        .translation-btn:hover { background: #555; }

        .translation-content {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid var(--secondary-color);
            font-style: italic;
            color: #555;
            border-radius: 0 10px 10px 0;
            animation: fadeIn 0.5s;
        }

        /* Glossary Table */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .glossary-table th {
            background: var(--secondary-color);
            color: white;
            padding: 12px;
            text-align: left;
        }
        .glossary-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .tag-pos {
            font-size: 0.8rem;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            color: #666;
            margin-left: 5px;
        }

        /* Right Panel: Exercises */
        #exercise-panel {
            background: rgba(255, 240, 240, 0.6);
            padding-bottom: 100px; /* Crucial for scrolling past the last element */
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            position: relative;
            transition: transform 0.3s;
        }

        .q-header {
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .q-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 2px solid #E0E0E0;
            padding: 15px;
            border-radius: 15px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            box-shadow: 0 4px 0 #E0E0E0; /* 3D effect */
            position: relative;
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .option-btn:hover:not(.disabled) {
            border-color: var(--secondary-color);
            transform: scale(1.02);
        }

        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: #00A653;
            box-shadow: 0 4px 0 #008f47;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: #D63031;
            box-shadow: 0 4px 0 #b32424;
            animation: shake 0.5s;
        }

        .explanation-box {
            margin-top: 20px;
            padding: 15px;
            background: #EDFDF4;
            border: 2px solid var(--correct-color);
            border-radius: 12px;
            display: none;
            animation: slideDown 0.4s ease-out;
        }
        .explanation-box.show { display: block; }

        .teacher-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            float: left;
            margin-right: 10px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .submit-all-btn {
            display: block;
            width: 100%;
            padding: 20px;
            background: var(--primary-color);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 30px;
            margin-bottom: 50px; /* Extra bottom margin */
            box-shadow: 0 6px 0 #D63031;
            transition: 0.2s;
        }
        
        .submit-all-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 5px solid var(--secondary-color);
            animation: zoomIn 0.4s;
        }
        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .score-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 20px 0;
        }
        .modal-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; overflow-y: auto; height: auto; }
            .panel { height: auto; overflow: visible; padding-bottom: 20px; }
            #reading-panel { border-right: none; border-bottom: 2px solid #eee; }
            body { height: auto; overflow-y: auto; }
        }

    </style>
</head>
<body>

    <header>
        <div class="teacher-brand">
            Ms Mai An ULIS <span>Teacher</span>
        </div>
        <div class="timer-container" onclick="toggleTimer()">
            <span>‚è±</span> <span id="timer">10:00</span>
        </div>
    </header>

    <div class="main-container">
        
        <div id="reading-panel" class="panel">
            <h1 class="passage-title">My Sister</h1>
            
            <div class="passage-part">
                <h3>Part 1: Childhood Memories</h3>
                <p>"When I think of someone close to me, my older sister immediately (1)__________. We grew up in a busy neighborhood, so I was never (2)__________. Even though she was older, I used to always (3)__________ with her and her friends wherever they went. Of course, she liked to (4)__________ and tell me what to do, which led us to (5)__________ quite often. But that was just (6)__________; we would fight and then (7)__________ five minutes later. If we (8)__________ to those days, I realize she was truly my (9)__________ whenever we got into trouble."</p>
                <button class="translation-btn" onclick="toggleTrans('trans1')">üìñ Xem B·∫£n D·ªãch</button>
                <div id="trans1" class="translation-content">
                    "Khi t√¥i nghƒ© v·ªÅ m·ªôt ng∆∞·ªùi th√¢n thi·∫øt, ch·ªã g√°i t√¥i ngay l·∫≠p t·ª©c <b>hi·ªán l√™n trong t√¢m tr√≠</b>. Ch√∫ng t√¥i l·ªõn l√™n trong m·ªôt khu ph·ªë s·∫ßm u·∫•t, v√¨ v·∫≠y t√¥i kh√¥ng bao gi·ªù <b>thi·∫øu b·∫°n ch∆°i</b>. M·∫∑c d√π ch·ªã ·∫•y l·ªõn h∆°n, t√¥i th∆∞·ªùng lu√¥n <b>b√°m ƒëu√¥i</b> ch·ªã v√† b·∫°n b√® b·∫•t c·ª© n∆°i n√†o h·ªç ƒë·∫øn. T·∫•t nhi√™n, ch·ªã ·∫•y th√≠ch <b>ch·ªâ ƒë·∫°o/ra l·ªánh</b> cho t√¥i v√† b·∫£o t√¥i ph·∫£i l√†m g√¨, ƒëi·ªÅu n√†y khi·∫øn ch√∫ng t√¥i <b>c√£i c·ªç/xung ƒë·ªôt</b> kh√° th∆∞·ªùng xuy√™n. Nh∆∞ng ƒë√≥ ch·ªâ l√† <b>chuy·ªán th∆∞·ªùng t√¨nh c·ªßa anh ch·ªã em</b>; ch√∫ng t√¥i c√£i nhau r·ªìi l·∫°i <b>l√†m l√†nh</b> nƒÉm ph√∫t sau ƒë√≥. N·∫øu ch√∫ng t√¥i <b>nh·ªõ l·∫°i</b> nh·ªØng ng√†y ƒë√≥, t√¥i nh·∫≠n ra ch·ªã ·∫•y th·ª±c s·ª± l√† <b>ƒë·ªìng ph·∫°m (ng∆∞·ªùi c√πng h·ªôi c√πng thuy·ªÅn)</b> c·ªßa t√¥i m·ªói khi ch√∫ng t√¥i g·∫∑p r·∫Øc r·ªëi."
                </div>
            </div>

            <div class="passage-part">
                <h3>Part 2: Growing Up & Personality</h3>
                <p>"As we got older, she was the one (10)__________, teaching me how to navigate high school and university. Living away from home and (11)__________ can be scary, but she taught me that being independent (12)__________. She is a very strong woman; she has (13)__________ being (14)__________ and standing up for yourself. Whenever life creates a situation that is (15)__________, or whatever challenge life (16)__________, she always manages to (17)__________. In terms of being the most resilient person I know, she definitely (18)__________."</p>
                <button class="translation-btn" onclick="toggleTrans('trans2')">üìñ Xem B·∫£n D·ªãch</button>
                <div id="trans2" class="translation-content">
                    "Khi ch√∫ng t√¥i l·ªõn l√™n, ch·ªã ·∫•y l√† ng∆∞·ªùi <b>h∆∞·ªõng d·∫´n t√¥i</b>, d·∫°y t√¥i c√°ch xoay s·ªü ·ªü tr∆∞·ªùng trung h·ªçc v√† ƒë·∫°i h·ªçc. S·ªëng xa nh√† v√† <b>t·ª± l·∫≠p</b> c√≥ th·ªÉ ƒë√°ng s·ª£, nh∆∞ng ch·ªã ·∫•y d·∫°y t√¥i r·∫±ng ƒë·ªôc l·∫≠p <b>c√≥ nh·ªØng l·ª£i √≠ch ri√™ng</b>. Ch·ªã ·∫•y l√† m·ªôt ng∆∞·ªùi ph·ª• n·ªØ r·∫•t m·∫°nh m·∫Ω; ch·ªã ·∫•y ƒë√£ <b>cho t√¥i m·ªôt b√†i h·ªçc b·∫≠c th·∫ßy v·ªÅ</b> vi·ªác tr·ªü n√™n <b>quy·∫øt ƒëo√°n</b> v√† t·ª± b·∫£o v·ªá m√¨nh. B·∫•t c·ª© khi n√†o cu·ªôc s·ªëng t·∫°o ra m·ªôt t√¨nh hu·ªëng <b>kh√≥ nh·∫±n</b>, hay b·∫•t c·ª© th·ª≠ th√°ch n√†o cu·ªôc ƒë·ªùi <b>n√©m v√†o b·∫°n</b>, ch·ªã ·∫•y lu√¥n xoay s·ªü ƒë·ªÉ <b>v∆∞·ª£t qua/chi·∫øn th·∫Øng</b>. X√©t v·ªÅ vi·ªác l√† ng∆∞·ªùi ki√™n c∆∞·ªùng nh·∫•t m√† t√¥i bi·∫øt, ch·ªã ·∫•y ch·∫Øc ch·∫Øn <b>gi√†nh v∆∞∆°ng mi·ªán (l√† s·ªë 1)</b>."
                </div>
            </div>

            <div class="passage-part">
                <h3>Part 3: Current Relationship</h3>
                <p>"Nowadays, we are both busy, but we (19)__________ see each other at least (20)__________ a month. We try to (21)__________ some family time to just (22)__________ and relax. We usually (23)__________ good food or movies. Even when work stresses threaten to (24)__________, her positivity is like (25)__________. I tend to worry a lot, so I often (26)__________ negative thinking, but knowing I (27)__________ gives me confidence."</p>
                <button class="translation-btn" onclick="toggleTrans('trans3')">üìñ Xem B·∫£n D·ªãch</button>
                <div id="trans3" class="translation-content">
                    "Ng√†y nay, c·∫£ hai ch√∫ng t√¥i ƒë·ªÅu b·∫≠n r·ªôn, nh∆∞ng ch√∫ng t√¥i <b>c·ªë g·∫Øng/ch√∫ tr·ªçng</b> g·∫∑p nhau √≠t nh·∫•t <b>m·ªôt v√†i l·∫ßn</b> m·ªôt th√°ng. Ch√∫ng t√¥i c·ªë g·∫Øng <b>d√†nh ra</b> m·ªôt ch√∫t th·ªùi gian gia ƒë√¨nh ƒë·ªÉ ch·ªâ <b>th∆∞ gi√£n/x·∫£ h∆°i</b>. Ch√∫ng t√¥i th∆∞·ªùng <b>g·∫Øn k·∫øt qua</b> ƒë·ªì ƒÉn ngon ho·∫∑c phim ·∫£nh. Ngay c·∫£ khi √°p l·ª±c c√¥ng vi·ªác ƒëe d·ªça <b>nh·∫•n ch√¨m/l√†m ch·ªã ·∫•y n·∫£n l√≤ng</b>, s·ª± t√≠ch c·ª±c c·ªßa ch·ªã ·∫•y gi·ªëng nh∆∞ <b>m·ªôt lu·ªìng gi√≥ m·ªõi</b>. T√¥i c√≥ xu h∆∞·ªõng lo l·∫Øng nhi·ªÅu, n√™n t√¥i th∆∞·ªùng <b>nghi√™ng v·ªÅ</b> suy nghƒ© ti√™u c·ª±c, nh∆∞ng bi·∫øt r·∫±ng t√¥i <b>c√≥ ch·ªã ·∫•y ·ªßng h·ªô</b> mang l·∫°i cho t√¥i s·ª± t·ª± tin."
                </div>
            </div>

            <div class="passage-part">
                <h3>Part 4: Future & Roles</h3>
                <p>"Looking ahead, (28)__________, but I know we will always remain close. Sometimes she has to (29)__________ a second mother, even (30)__________ my kids when I‚Äôm busy. Trust and loyalty are (31)__________ our relationship."</p>
                <button class="translation-btn" onclick="toggleTrans('trans4')">üìñ Xem B·∫£n D·ªãch</button>
                <div id="trans4" class="translation-content">
                    "Nh√¨n v·ªÅ ph√≠a tr∆∞·ªõc, <b>t√¥i kh√¥ng c√≥ qu·∫£ c·∫ßu pha l√™ (kh√¥ng ƒëo√°n tr∆∞·ªõc ƒë∆∞·ª£c t∆∞∆°ng lai)</b>, nh∆∞ng t√¥i bi·∫øt ch√∫ng t√¥i s·∫Ω lu√¥n th√¢n thi·∫øt. ƒê√¥i khi ch·ªã ·∫•y ph·∫£i <b>ƒë√≥ng vai</b> m·ªôt ng∆∞·ªùi m·∫π th·ª© hai, th·∫≠m ch√≠ <b>tham gia/nh·∫£y v√†o</b> tr√¥ng con cho t√¥i khi t√¥i b·∫≠n. Tin t∆∞·ªüng v√† l√≤ng trung th√†nh l√† <b>nh·ªØng n·ªÅn t·∫£ng c·ªßa</b> m·ªëi quan h·ªá c·ªßa ch√∫ng t√¥i."
                </div>
            </div>

            <h3 style="margin-top: 30px; color: var(--primary-color);">üìö Glossary (T·ª´ v·ª±ng Academic)</h3>
            <table class="glossary-table">
                <thead>
                    <tr><th>Word/Phrase</th><th>Meaning (VN)</th></tr>
                </thead>
                <tbody id="glossary-body"></tbody>
            </table>
            <br><br>
        </div>

        <div id="exercise-panel" class="panel">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 20px;">üìù B√ÄI T·∫¨P TH·ª∞C H√ÄNH</h2>
            <div id="quiz-container">
                </div>
            
            <button class="submit-all-btn" onclick="finishQuiz()">üèÜ N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
        </div>
    </div>

    <div id="result-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>K·∫æT QU·∫¢ B√ÄI L√ÄM</h2>
            <div class="score-display" id="final-score">0/31</div>
            <p id="feedback-msg" style="font-size: 1.2rem; color: #666;">B·∫°n ch∆∞a l√†m b√†i!</p>
            <button class="modal-btn" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
        </div>
    </div>

    <script>
        // --- 1. DATA & CONTENT ---
        
        const vocabList = [
            "boss me around", "tag along", "typical sibling stuff", "carve out", "kick back", 
            "a breath of fresh air", "has its perks", "striking out on your own", "lean towards", 
            "butt heads with", "patch things up", "assertive", "given me a masterclass in", 
            "throws at you", "pops up in my mind", "bond over", "showing me the ropes", 
            "make it a point to", "a handful of times", "bog her down", "come out on top", 
            "takes the crown", "partner in crime", "have her in my corner", "cast our minds back", 
            "I don‚Äôt have a crystal ball or anything", "the cornerstones of", "stepping in to babysit", 
            "wear the hat of", "that‚Äôs a tough cookie to crack", "short of playmates"
        ];

        // Glossary Data
        const glossaryData = [
            { word: "Assertive", type: "adj", mean: "Qu·∫£ quy·∫øt, quy·∫øt ƒëo√°n" },
            { word: "Navigate", type: "v", mean: "ƒê·ªãnh h∆∞·ªõng, xoay s·ªü" },
            { word: "Resilient", type: "adj", mean: "Ki√™n c∆∞·ªùng, mau ph·ª•c h·ªìi" },
            { word: "Cornerstones", type: "n", mean: "N·ªÅn t·∫£ng, c∆° s·ªü" },
            { word: "Bond over", type: "phr.v", mean: "G·∫Øn k·∫øt qua vi·ªác g√¨ ƒë√≥" },
            { word: "Kick back", type: "phr.v", mean: "Th∆∞ gi√£n, x·∫£ h∆°i" },
            { word: "Perks", type: "n", mean: "L·ª£i √≠ch, ƒë·∫∑c quy·ªÅn" },
            { word: "Tag along", type: "phr.v", mean: "ƒêi theo, b√°m ƒëu√¥i" },
            { word: "Boss around", type: "phr.v", mean: "H·∫°ch s√°ch, ch·ªâ ƒë·∫°o" },
            { word: "Patch things up", type: "idiom", mean: "L√†m l√†nh, gi·∫£ng h√≤a" }
        ];

        // Answer Key with Detailed Explanations - 31 QUESTIONS
        const answers = [
            { id: 1, text: "pops up in my mind", explain: "C·ª•m 'pops up in my mind' nghƒ©a l√† n·∫£y ra/xu·∫•t hi·ªán ngay trong ƒë·∫ßu. H·ª£p ng·ªØ c·∫£nh nghƒ© v·ªÅ ai ƒë√≥ th√¢n thi·∫øt." },
            { id: 2, text: "short of playmates", explain: "C·ª•m 'short of' l√† thi·∫øu th·ªën. 'Playmates' l√† b·∫°n ch∆°i. V√¨ s·ªëng ·ªü khu ƒë√¥ng ƒë√∫c n√™n kh√¥ng bao gi·ªù thi·∫øu b·∫°n ch∆°i." },
            { id: 3, text: "tag along", explain: "'Tag along' nghƒ©a l√† ƒëi theo ai ƒë√≥ (th∆∞·ªùng l√† kh√¥ng ƒë∆∞·ª£c m·ªùi ho·∫∑c ƒëi k√©). Em hay ƒëi theo ch·ªã." },
            { id: 4, text: "boss me around", explain: "'Boss someone around' l√† ch·ªâ ƒë·∫°o, ra l·ªánh h√°ch d·ªãch. Ph√π h·ª£p v·ªõi v·∫ø sau 'tell me what to do'." },
            { id: 5, text: "butt heads with", explain: "'Butt heads' (h√∫c ƒë·∫ßu v√†o nhau) l√† ·∫©n d·ª• cho vi·ªác xung ƒë·ªôt, c√£i c·ªç." },
            { id: 6, text: "typical sibling stuff", explain: "C·∫£ c·ª•m n√†y nghƒ©a l√† 'chuy·ªán b√¨nh th∆∞·ªùng gi·ªØa anh ch·ªã em'. D√πng ƒë·ªÉ gi·∫£i th√≠ch cho vi·ªác c√£i nhau r·ªìi l√†m l√†nh." },
            { id: 7, text: "patch things up", explain: "'Patch things up' l√† h√†n g·∫Øn, l√†m l√†nh sau khi c√£i v√£." },
            { id: 8, text: "cast our minds back", explain: "'Cast one's mind back' l√† h·ªìi t∆∞·ªüng l·∫°i qu√° kh·ª©." },
            { id: 9, text: "partner in crime", explain: "'Partner in crime' l√† b·∫°n ƒë·ªìng h√†nh, ƒë·ªìng ph·∫°m (nghƒ©a vui: ng∆∞·ªùi c√πng g√¢y r·∫Øc r·ªëi ho·∫∑c c√πng l√†m m·ªçi vi·ªác)." },
            { id: 10, text: "showing me the ropes", explain: "'Show someone the ropes' l√† d·∫°y ai ƒë√≥ c√°ch l√†m vi·ªác g√¨, h∆∞·ªõng d·∫´n ng∆∞·ªùi m·ªõi." },
            { id: 11, text: "striking out on your own", explain: "'Strike out on one's own' l√† b·∫Øt ƒë·∫ßu s·ªëng t·ª± l·∫≠p." },
            { id: 12, text: "has its perks", explain: "'Has its perks' nghƒ©a l√† c√≥ nh·ªØng l·ª£i √≠ch/∆∞u ƒëi·ªÉm ri√™ng." },
            { id: 13, text: "given me a masterclass in", explain: "'Give a masterclass in' l√† d·∫°y m·ªôt b√†i h·ªçc ƒë·∫≥ng c·∫•p cao/b·∫≠c th·∫ßy v·ªÅ c√°i g√¨ ƒë√≥." },
            { id: 14, text: "assertive", explain: "'Assertive' l√† t√≠nh t·ª´ ch·ªâ s·ª± quy·∫øt ƒëo√°n, m·∫°nh m·∫Ω b·∫£o v·ªá √Ω ki·∫øn c·ªßa m√¨nh." },
            { id: 15, text: "that‚Äôs a tough cookie to crack", explain: "'A tough cookie to crack' l√† v·∫•n ƒë·ªÅ nan gi·∫£i ho·∫∑c ng∆∞·ªùi kh√≥ ƒë·ªëi ph√≥." },
            { id: 16, text: "throws at you", explain: "Idiom 'Life throws something at you' nghƒ©a l√† cu·ªôc ƒë·ªùi n√©m v√†o b·∫°n nh·ªØng th·ª≠ th√°ch b·∫•t ng·ªù." },
            { id: 17, text: "come out on top", explain: "'Come out on top' l√† chi·∫øn th·∫Øng, v∆∞·ª£t qua kh√≥ khƒÉn ƒë·ªÉ th√†nh c√¥ng." },
            { id: 18, text: "takes the crown", explain: "'Takes the crown' l√† gi√†nh v∆∞∆°ng mi·ªán, √Ω n√≥i l√† ng∆∞·ªùi gi·ªèi nh·∫•t/s·ªë 1 v·ªÅ m·∫∑t n√†o ƒë√≥." },
            { id: 19, text: "make it a point to", explain: "'Make it a point to do something' l√† coi tr·ªçng vi·ªác g√¨ v√† c·ªë g·∫Øng th·ª±c hi·ªán n√≥." },
            { id: 20, text: "a handful of times", explain: "'A handful of' l√† m·ªôt n·∫Øm, √Ω ch·ªâ s·ªë l∆∞·ª£ng nh·ªè (m·ªôt v√†i l·∫ßn)." },
            { id: 21, text: "carve out", explain: "'Carve out time' l√† 'ƒë·ª•c/kho√©t' th·ªùi gian, √Ω l√† c·ªë g·∫Øng s·∫Øp x·∫øp th·ªùi gian trong l·ªãch tr√¨nh b·∫≠n r·ªôn." },
            { id: 22, text: "kick back", explain: "'Kick back' l√† th∆∞ gi√£n, ngh·ªâ ng∆°i (th∆∞·ªùng ƒëi v·ªõi relax)." },
            { id: 23, text: "bond over", explain: "'Bond over' l√† g·∫Øn k·∫øt t√¨nh c·∫£m th√¥ng qua vi·ªác c√πng l√†m g√¨ ƒë√≥." },
            { id: 24, text: "bog her down", explain: "'Bog down' l√† b·ªã sa l·∫ßy, b·ªã nh·∫•n ch√¨m b·ªüi √°p l·ª±c/c√¥ng vi·ªác." },
            { id: 25, text: "a breath of fresh air", explain: "'A breath of fresh air' l√† lu·ªìng gi√≥ m·ªõi, ch·ªâ s·ª± thay ƒë·ªïi t√≠ch c·ª±c, d·ªÖ ch·ªãu." },
            { id: 26, text: "lean towards", explain: "'Lean towards' l√† nghi√™ng v·ªÅ ph√≠a (nghƒ©a ƒëen ho·∫∑c b√≥ng)." },
            { id: 27, text: "have her in my corner", explain: "'Have someone in your corner' (t·ª´ quy·ªÅn anh) l√† c√≥ ng∆∞·ªùi ·ªü g√≥c ƒë√†i h·ªó tr·ª£, nghƒ©a l√† c√≥ ng∆∞·ªùi ·ªßng h·ªô/b√™nh v·ª±c m√¨nh." },
            { id: 28, text: "I don‚Äôt have a crystal ball or anything", explain: "Th√†nh ng·ªØ ch·ªâ vi·ªác kh√¥ng th·ªÉ d·ª± ƒëo√°n t∆∞∆°ng lai (nh∆∞ th·∫ßy b√≥i nh√¨n qu·∫£ c·∫ßu pha l√™)." },
            { id: 29, text: "wear the hat of", explain: "'Wear the hat of' l√† ƒë√≥ng vai tr√≤ l√† ai ƒë√≥." },
            { id: 30, text: "stepping in to babysit", explain: "'Step in' l√† can thi·ªáp, nh·∫£y v√†o gi√∫p ƒë·ª°." },
            { id: 31, text: "the cornerstones of", explain: "'Cornerstone' l√† ƒë√° t·∫£ng g√≥c t∆∞·ªùng, nghƒ©a b√≥ng l√† n·ªÅn t·∫£ng quan tr·ªçng nh·∫•t." }
        ];

        // --- 2. LOGIC & FUNCTIONS ---

        // Sound Effects (Base64 Web Audio)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#00D26A', '#FFE66D', '#FF6B6B']
                });
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // Toggle Translation
        function toggleTrans(id) {
            const el = document.getElementById(id);
            if (el.style.display === 'block') {
                el.style.display = 'none';
            } else {
                el.style.display = 'block';
            }
        }

        // Timer Logic
        let timeLeft = 600; // 10 minutes
        let timerId = null;
        let isPaused = true;

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        function toggleTimer() {
            const timerDisplay = document.getElementById('timer');
            if (isPaused) {
                isPaused = false;
                timerDisplay.style.color = "#00D26A";
                timerId = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        timerDisplay.innerText = formatTime(timeLeft);
                        if(timeLeft === 0) {
                            alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c.");
                            clearInterval(timerId);
                        }
                    }
                }, 1000);
            } else {
                isPaused = true;
                timerDisplay.style.color = "#FF6B6B";
                clearInterval(timerId);
            }
        }

        // Generate Glossary
        function renderGlossary() {
            const tbody = document.getElementById('glossary-body');
            let html = '';
            glossaryData.forEach(item => {
                html += `<tr>
                    <td><strong>${item.word}</strong> <span class="tag-pos">${item.type}</span></td>
                    <td>${item.mean}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // Generate Quiz
        function generateQuiz() {
            const container = document.getElementById('quiz-container');
            let html = '';

            answers.forEach((ans, index) => {
                let distractors = vocabList.filter(w => w !== ans.text);
                distractors = distractors.sort(() => 0.5 - Math.random()).slice(0, 3);
                let options = [ans.text, ...distractors];
                options.sort(() => 0.5 - Math.random());

                // Escape helper for HTML attributes
                const escapeStr = (str) => str.replace(/'/g, "\\'"); 

                html += `
                <div class="question-card" id="q-card-${index}">
                    <div class="q-header">
                        <span>Question ${index + 1}</span>
                        <div class="teacher-avatar">M</div>
                    </div>
                    <div class="q-text">Fill in blank (${index + 1}): "..."</div>
                    <div class="options-grid">
                        ${options.map(opt => `
                            <button class="option-btn" onclick="checkAnswer(this, '${escapeStr(opt)}', '${escapeStr(ans.text)}', ${index})">
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                    <div class="explanation-box" id="explain-${index}">
                        <strong>üë©‚Äçüè´ Ms Mai An gi·∫£i th√≠ch:</strong><br>
                        ƒê√°p √°n ƒë√∫ng: <span style="color:var(--correct-color); font-weight:bold;">${ans.text}</span><br>
                        <hr style="margin: 10px 0; border: 0; border-top: 1px dashed #ccc;">
                        ${ans.explain}
                    </div>
                </div>`;
            });

            container.innerHTML = html;
        }

        let score = 0;
        let answeredCount = 0;

        function checkAnswer(btn, selected, correct, qIndex) {
            const card = document.getElementById(`q-card-${qIndex}`);
            const buttons = card.querySelectorAll('.option-btn');
            if (card.classList.contains('answered')) return;

            card.classList.add('answered');
            answeredCount++;

            const explainBox = document.getElementById(`explain-${qIndex}`);
            explainBox.classList.add('show');

            if (selected === correct) {
                btn.classList.add('correct');
                playSound('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
                buttons.forEach(b => {
                    if (b.innerText.trim() === correct) b.classList.add('correct');
                });
            }
            buttons.forEach(b => b.classList.add('disabled'));
        }

        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const scoreDisplay = document.getElementById('final-score');
            const feedback = document.getElementById('feedback-msg');

            scoreDisplay.innerText = `${score} / ${answers.length}`;
            
            const percentage = (score / answers.length) * 100;
            if (percentage === 100) feedback.innerText = "üåü Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng√¥n ng·ªØ!";
            else if (percentage >= 80) feedback.innerText = "üëè L√†m t·ªët l·∫Øm! V·ªën t·ª´ c·ªßa b·∫°n r·∫•t r·ªông.";
            else if (percentage >= 50) feedback.innerText = "üí™ C·ªë l√™n nh√©! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch.";
            else feedback.innerText = "üòÖ ƒê·ª´ng n·∫£n l√≤ng! H√£y l√†m l·∫°i ƒë·ªÉ nh·ªõ t·ª´ v·ª±ng nh√©.";

            modal.style.display = 'flex';
            playSound('correct'); 
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

        // Initialization
        window.onload = function() {
            renderGlossary();
            generateQuiz();
        };

    </script>
</body>
</html>