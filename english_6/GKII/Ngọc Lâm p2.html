<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamified English Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --accent: #FDCB6E;
            --correct: #00D26A;
            --wrong: #FF4757;
            --white: #ffffff;
            --text-dark: #2d3436;
            --bg-gray: #f4f6f8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Nunito', sans-serif;
        }

        body {
            overflow: hidden; /* Prevent body scroll, use split panes */
            background: linear-gradient(-45deg, #8854C0, #FDCB6E, #00C9A7, #ff9a9e);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-dark);
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* SVG Pattern Overlay floating */
        .bg-pattern {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
            background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='250' height='250' viewBox='0 0 200 200'><text x='20' y='50' font-size='35'>üèÄ</text><text x='130' y='90' font-size='35'>üåâ</text><text x='50' y='160' font-size='35'>‚úàÔ∏è</text><text x='160' y='180' font-size='35'>‚õπÔ∏è</text></svg>");
            animation: floatPattern 40s linear infinite;
        }

        @keyframes floatPattern {
            0% { background-position: 0 0; }
            100% { background-position: 500px 500px; }
        }

        /* Top Control Bar */
        .top-bar {
            position: relative;
            z-index: 10;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            border-bottom: 3px solid var(--accent);
        }

        .header-info h2 {
            font-size: 14px;
            color: var(--primary);
            text-transform: uppercase;
            font-weight: 900;
            letter-spacing: 1px;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timer-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 5px 0 #5f3a8c;
            transition: all 0.1s;
        }
        .timer-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0px 0 #5f3a8c;
        }

        .timer-display {
            font-size: 24px;
            font-weight: 900;
            color: var(--wrong);
            background: #ffeaa7;
            padding: 5px 15px;
            border-radius: 10px;
            border: 2px solid var(--accent);
        }

        /* Split Screen Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
            position: relative;
            z-index: 1;
        }

        .pane {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .pane::-webkit-scrollbar { width: 10px; }
        .pane::-webkit-scrollbar-track { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .pane::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.6); border-radius: 10px; }

        .left-pane { border-right: 4px dashed rgba(255,255,255,0.4); }

        /* Card Styles */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), inset 0 -4px 0 rgba(0,0,0,0.05);
            line-height: 1.8;
            font-size: 18px;
        }

        .reading-text { font-weight: 700; color: #2d3436; }
        
        .translate-btn {
            background: var(--accent);
            color: #d35400;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 4px 0 #e1b12c;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: 0.2s;
        }
        .translate-btn:active { transform: translateY(4px); box-shadow: 0 0 0; }
        .translate-box {
            display: none;
            background: #fff3cd;
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
            font-size: 16px;
            color: #856404;
            border-left: 5px solid var(--accent);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Glossary Table */
        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 15px;
        }
        .glossary-table th { background: var(--primary); color: white; padding: 12px; }
        .glossary-table td { padding: 10px; background: white; border-bottom: 1px solid #eee; text-align: center;}
        .glossary-table tr:last-child td { border-bottom: none; }

        /* Question Styles */
        .question-block {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
        }
        .question-text {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: var(--bg-gray);
            border: 2px solid #dfe6e9;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 6px 0 #dfe6e9;
            display: flex;
            align-items: center;
        }
        .option-btn:hover {
            transform: scale(1.02) translateY(-2px);
            border-color: var(--secondary);
            background: #e6fff7;
        }
        .option-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #dfe6e9; }
        
        .option-btn.correct { background: var(--correct); color: white; border-color: #00b85c; box-shadow: 0 6px 0 #00b85c; }
        .option-btn.wrong { background: var(--wrong); color: white; border-color: #e84118; box-shadow: 0 6px 0 #e84118; }
        .option-btn:disabled { cursor: not-allowed; pointer-events: none; opacity: 0.7;}

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px) rotate(-2deg); }
            75% { transform: translateX(8px) rotate(2deg); }
        }
        .shake { animation: shake 0.4s ease; }

        /* Explanation Box */
        .explanation-box {
            display: none;
            background: #f8f9fa;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            animation: slideDown 0.4s ease;
        }
        .explanation-box h4 { color: var(--correct); margin-bottom: 10px; font-size: 18px; display: flex; align-items: center; gap: 8px;}
        .expl-step { margin-bottom: 12px; font-size: 16px; }
        .expl-step span { font-weight: 800; color: var(--primary); }

        /* Submit Button */
        .submit-btn {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-size: 22px;
            font-weight: 900;
            padding: 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 0 #4a2377;
            margin-bottom: 50px;
            transition: 0.2s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .submit-btn:active { transform: translateY(6px); box-shadow: 0 2px 0 #4a2377; }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background: white; width: 500px; padding: 40px; border-radius: 30px;
            text-align: center; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .score-display { font-size: 60px; font-weight: 900; color: var(--primary); margin: 20px 0; }
        .feedback-text { font-size: 22px; font-weight: 800; margin-bottom: 20px; color: #d35400; }
        .close-modal-btn {
            background: var(--correct); color: white; border: none; padding: 15px 30px;
            font-size: 18px; font-weight: 800; border-radius: 15px; cursor: pointer;
            box-shadow: 0 6px 0 #00b85c;
        }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99; }

        /* Responsive */
        @media (max-width: 900px) {
            .main-container { flex-direction: column; overflow-y: auto; height: auto; }
            body { overflow: auto; }
            .pane { overflow-y: visible; }
            .left-pane { border-right: none; border-bottom: 4px dashed rgba(255,255,255,0.4); }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="bg-pattern"></div>
    <canvas id="confetti-canvas"></canvas>

    <div class="top-bar">
        <div class="header-info">
            <h2>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h2>
        </div>
        <div class="timer-container">
            <button class="timer-btn" id="start-timer-btn" onclick="toggleTimer()">B·∫ÆT ƒê·∫¶U T√çNH GI·ªú</button>
            <div class="timer-display" id="timer-display">10:00</div>
        </div>
    </div>

    <div class="main-container">
        
        <div class="pane left-pane">
            
            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">üìñ PASSAGE 1: Fill in the blanks</h3>
                <p class="reading-text">
                    According to a study, only 6 out of 10 children between 5 and 14 years old join in sport outside of school. Children often spend too much time watching TV or <b>(31) _______</b> video games. 
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans1')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans1">
                    Theo m·ªôt nghi√™n c·ª©u, ch·ªâ c√≥ 6 tr√™n 10 tr·∫ª em t·ª´ 5 ƒë·∫øn 14 tu·ªïi tham gia th·ªÉ thao ngo√†i gi·ªù h·ªçc. Tr·∫ª em th∆∞·ªùng d√†nh qu√° nhi·ªÅu th·ªùi gian xem TV ho·∫∑c ch∆°i tr√≤ ch∆°i ƒëi·ªán t·ª≠.
                </div>

                <p class="reading-text" style="margin-top: 20px;">
                    However, there <b>(32) _______</b> many benefits of children‚Äôs sport participation. Firstly, sport helps them become fitter and sleep better. Secondly, children can burn calories when playing sport, <b>(33) _______</b> sport reduces the risk of overweight. 
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans2')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans2">
                    Tuy nhi√™n, c√≥ r·∫•t nhi·ªÅu l·ª£i √≠ch t·ª´ vi·ªác tr·∫ª em tham gia th·ªÉ thao. ƒê·∫ßu ti√™n, th·ªÉ thao gi√∫p c√°c em tr·ªü n√™n kh·ªèe m·∫°nh h∆°n v√† ng·ªß ngon h∆°n. Th·ª© hai, tr·∫ª em c√≥ th·ªÉ ƒë·ªët ch√°y calo khi ch∆°i th·ªÉ thao, v√¨ v·∫≠y th·ªÉ thao l√†m gi·∫£m nguy c∆° th·ª´a c√¢n.
                </div>

                <p class="reading-text" style="margin-top: 20px;">
                    Finally, when children play team sport, they can improve their social skills. They work <b>(34) _______</b> their teammates to play well and win the game. Kids learn leadership skills, team-building skills and communication skills that will help them in school, their future <b>(35) _______</b> and personal relationships.
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans3')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans3">
                    Cu·ªëi c√πng, khi tr·∫ª em ch∆°i th·ªÉ thao ƒë·ªìng ƒë·ªôi, c√°c em c√≥ th·ªÉ c·∫£i thi·ªán k·ªπ nƒÉng x√£ h·ªôi. C√°c em l√†m vi·ªác c√πng v·ªõi ƒë·ªìng ƒë·ªôi c·ªßa m√¨nh ƒë·ªÉ ch∆°i t·ªët v√† gi√†nh chi·∫øn th·∫Øng. Tr·∫ª em h·ªçc ƒë∆∞·ª£c k·ªπ nƒÉng l√£nh ƒë·∫°o, k·ªπ nƒÉng x√¢y d·ª±ng ƒë·ªôi nh√≥m v√† k·ªπ nƒÉng giao ti·∫øp, nh·ªØng ƒëi·ªÅu s·∫Ω gi√∫p √≠ch cho c√°c em ·ªü tr∆∞·ªùng h·ªçc, s·ª± nghi·ªáp t∆∞∆°ng lai v√† c√°c m·ªëi quan h·ªá c√° nh√¢n.
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--primary); margin-bottom: 15px;">üìñ PASSAGE 2: Reading Comprehension</h3>
                <p class="reading-text">
                    San Francisco - a very hilly city - is in the San Francisco Bay, the USA. San Francisco is well-known for its steep rolling hills, cool summers and landmarks, including the Golden Gate Bridge, Alcatraz, Chinatown and Mission district.
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans4')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans4">
                    San Francisco - m·ªôt th√†nh ph·ªë r·∫•t nhi·ªÅu ƒë·ªìi n√∫i - n·∫±m ·ªü V·ªãnh San Francisco, Hoa K·ª≥. San Francisco n·ªïi ti·∫øng v·ªõi nh·ªØng ng·ªçn ƒë·ªìi d·ªëc thoai tho·∫£i, m√πa h√® m√°t m·∫ª v√† c√°c ƒë·ªãa danh n·ªïi b·∫≠t, bao g·ªìm C·∫ßu C·ªïng V√†ng, ƒë·∫£o Alcatraz, Khu ph·ªë T√†u (Chinatown) v√† qu·∫≠n Mission.
                </div>

                <p class="reading-text" style="margin-top: 20px;">
                    The celebration of the Chinese New Year in Chinatown is one thing that you should not miss. You should also visit Mission Dolores, an old church built by the Spanish in the 18th century.
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans5')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans5">
                    L·ªÖ k·ª∑ ni·ªám T·∫øt Nguy√™n ƒê√°n ·ªü Khu ph·ªë T√†u l√† m·ªôt ƒëi·ªÅu m√† b·∫°n kh√¥ng n√™n b·ªè l·ª°. B·∫°n c≈©ng n√™n ƒë·∫øn thƒÉm Mission Dolores, m·ªôt nh√† th·ªù c·ªï do ng∆∞·ªùi T√¢y Ban Nha x√¢y d·ª±ng v√†o th·∫ø k·ª∑ 18.
                </div>

                <p class="reading-text" style="margin-top: 20px;">
                    You can find the best food from around the world here: Brazilian, Indian, Japanese, Korean, Mexican, Russian, Thai, Chinese and much more. Don't forget to visit a jazz club or an outdoor coffee shop to enjoy good coffee and fresh air.
                </p>
                <button class="translate-btn" onclick="toggleTranslate('trans6')">üåü M·ªü d·ªãch ƒëo·∫°n n√†y</button>
                <div class="translate-box" id="trans6">
                    B·∫°n c√≥ th·ªÉ t√¨m th·∫•y nh·ªØng m√≥n ƒÉn ngon nh·∫•t t·ª´ kh·∫Øp n∆°i tr√™n th·∫ø gi·ªõi t·∫°i ƒë√¢y: m√≥n ƒÉn Brazil, ·∫§n ƒê·ªô, Nh·∫≠t B·∫£n, H√†n Qu·ªëc, Mexico, Nga, Th√°i Lan, Trung Qu·ªëc v√† nhi·ªÅu h∆°n n·ªØa. ƒê·ª´ng qu√™n gh√© thƒÉm m·ªôt c√¢u l·∫°c b·ªô nh·∫°c jazz ho·∫∑c m·ªôt qu√°n c√† ph√™ ngo√†i tr·ªùi ƒë·ªÉ th∆∞·ªüng th·ª©c c√† ph√™ ngon v√† kh√¥ng kh√≠ trong l√†nh.
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--secondary); text-align: center; font-weight: 900;">üìö B·∫¢NG T·ª™ V·ª∞NG (GLOSSARY)</h3>
                <table class="glossary-table">
                    <tr><th>T·ª´ v·ª±ng</th><th>Lo·∫°i t·ª´</th><th>Nghƒ©a Ti·∫øng Vi·ªát</th></tr>
                    <tr><td><b>Participation</b></td><td>Noun (Danh t·ª´)</td><td>S·ª± tham gia</td></tr>
                    <tr><td><b>Benefit</b></td><td>Noun (Danh t·ª´)</td><td>L·ª£i √≠ch</td></tr>
                    <tr><td><b>Reduce</b></td><td>Verb (ƒê·ªông t·ª´)</td><td>L√†m gi·∫£m b·ªõt</td></tr>
                    <tr><td><b>Overweight</b></td><td>Adjective (T√≠nh t·ª´)</td><td>Th·ª´a c√¢n, b√©o ph√¨</td></tr>
                    <tr><td><b>Leadership</b></td><td>Noun (Danh t·ª´)</td><td>Kh·∫£ nƒÉng l√£nh ƒë·∫°o</td></tr>
                    <tr><td><b>Career</b></td><td>Noun (Danh t·ª´)</td><td>S·ª± nghi·ªáp</td></tr>
                    <tr><td><b>Hilly</b></td><td>Adjective (T√≠nh t·ª´)</td><td>Nhi·ªÅu ƒë·ªìi n√∫i</td></tr>
                    <tr><td><b>Steep</b></td><td>Adjective (T√≠nh t·ª´)</td><td>D·ªëc</td></tr>
                    <tr><td><b>Landmark</b></td><td>Noun (Danh t·ª´)</td><td>ƒê·ªãa danh, c·ªôt m·ªëc</td></tr>
                    <tr><td><b>Celebration</b></td><td>Noun (Danh t·ª´)</td><td>L·ªÖ k·ª∑ ni·ªám, s·ª± ƒÉn m·ª´ng</td></tr>
                </table>
            </div>

        </div>

        <div class="pane right-pane" id="exercises-container">
            <button class="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI THI C·ª¶A B·∫†N üöÄ</button>
        </div>

    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h1 style="font-size: 40px;">üéâ K·∫æT QU·∫¢ üéâ</h1>
            <div class="score-display" id="final-score">0 / 10</div>
            <div class="feedback-text" id="feedback-text">Tuy·ªát v·ªùi!</div>
            <button class="close-modal-btn" onclick="closeModal()">Xem L·∫°i B√†i L√†m</button>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURE FOR QUESTIONS ---
        const questionsData = [
            {
                id: 31,
                text: "Question 31: Children often spend too much time watching TV or _______ video games.",
                options: [
                    { text: "doing", isCorrect: false },
                    { text: "playing", isCorrect: true },
                    { text: "paying", isCorrect: false },
                    { text: "going", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</span><br>
                    - <b>doing</b> (v): l√†m<br>
                    - <b>playing</b> (v): ch∆°i<br>
                    - <b>paying</b> (v): tr·∫£ ti·ªÅn<br>
                    - <b>going</b> (v): ƒëi
                    </div>
                    <div class="expl-step"><span>2. D·ªãch c√¢u:</span> "Tr·∫ª em th∆∞·ªùng d√†nh qu√° nhi·ªÅu th·ªùi gian xem TV ho·∫∑c <b>ch∆°i</b> tr√≤ ch∆°i ƒëi·ªán t·ª≠."</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> Trong ti·∫øng Anh, ta c√≥ c·ª•m t·ª´ c·ªë ƒë·ªãnh (collocation) <b>"play video games"</b> mang nghƒ©a l√† ch∆°i tr√≤ ch∆°i ƒëi·ªán t·ª≠. C√°c t·ª´ c√≤n l·∫°i kh√¥ng ƒëi v·ªõi "video games". V√¨ v·∫≠y ta ch·ªçn "playing".</div>
                `
            },
            {
                id: 32,
                text: "Question 32: However, there _______ many benefits of children‚Äôs sport participation.",
                options: [
                    { text: "is", isCorrect: false },
                    { text: "were", isCorrect: false },
                    { text: "are", isCorrect: true },
                    { text: "was", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. Ph√¢n t√≠ch ng·ªØ ph√°p:</span> C·∫•u tr√∫c "There is/are" (C√≥...). ƒê·ªông t·ª´ to be ph·ª• thu·ªôc v√†o danh t·ª´ ƒë·ª©ng ngay sau n√≥.</div>
                    <div class="expl-step"><span>2. D·ªãch c√¢u:</span> "Tuy nhi√™n, <b>c√≥</b> r·∫•t nhi·ªÅu l·ª£i √≠ch t·ª´ vi·ªác tham gia th·ªÉ thao c·ªßa tr·∫ª em."</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> Danh t·ª´ ngay sau ch·ªó tr·ªëng l√† "many benefits" (nhi·ªÅu l·ª£i √≠ch) - ƒë√¢y l√† danh t·ª´ ƒë·∫øm ƒë∆∞·ª£c s·ªë nhi·ªÅu. H∆°n n·ªØa, to√†n b·ªô ƒëo·∫°n vƒÉn ƒëang k·ªÉ nh·ªØng s·ª± th·∫≠t ·ªü hi·ªán t·∫°i. Do ƒë√≥ ta d√πng to-be ·ªü hi·ªán t·∫°i s·ªë nhi·ªÅu l√† <b>"are"</b>. Lo·∫°i 'is/was' (s·ªë √≠t), lo·∫°i 'were' (qu√° kh·ª©).</div>
                `
            },
            {
                id: 33,
                text: "Question 33: children can burn calories when playing sport, _______ sport reduces the risk of overweight.",
                options: [
                    { text: "because", isCorrect: false },
                    { text: "and", isCorrect: false },
                    { text: "but", isCorrect: false },
                    { text: "so", isCorrect: true }
                ],
                explanation: `
                    <div class="expl-step"><span>1. Ph√¢n t√≠ch li√™n t·ª´:</span><br>
                    - <b>because</b>: b·ªüi v√¨ (ch·ªâ nguy√™n nh√¢n)<br>
                    - <b>and</b>: v√† (b·ªï sung th√¥ng tin)<br>
                    - <b>but</b>: nh∆∞ng (tr√°i ng∆∞·ª£c)<br>
                    - <b>so</b>: v√¨ v·∫≠y, cho n√™n (ch·ªâ k·∫øt qu·∫£)
                    </div>
                    <div class="expl-step"><span>2. D·ªãch c√¢u:</span> "Tr·∫ª em c√≥ th·ªÉ ƒë·ªët ch√°y calo khi ch∆°i th·ªÉ thao, <b>v√¨ v·∫≠y</b> th·ªÉ thao l√†m gi·∫£m nguy c∆° th·ª´a c√¢n."</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> V·∫ø tr∆∞·ªõc (ƒë·ªët calo) l√† nguy√™n nh√¢n d·∫´n ƒë·∫øn v·∫ø sau (gi·∫£m nguy c∆° th·ª´a c√¢n) l√† k·∫øt qu·∫£. T·ª´ n·ªëi ch·ªâ k·∫øt qu·∫£ ch√≠nh x√°c nh·∫•t l√† <b>"so"</b>.</div>
                `
            },
            {
                id: 34,
                text: "Question 34: They work _______ their teammates to play well and win the game.",
                options: [
                    { text: "with", isCorrect: true },
                    { text: "for", isCorrect: false },
                    { text: "out", isCorrect: false },
                    { text: "at", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. Ph√¢n t√≠ch gi·ªõi t·ª´:</span> Ch√∫ng ta c·∫ßn t√¨m gi·ªõi t·ª´ ƒëi sau ƒë·ªông t·ª´ "work" ƒë·ªÉ mang nghƒ©a "l√†m vi·ªác C√ôNG AI ƒë√≥".</div>
                    <div class="expl-step"><span>2. D·ªãch c√¢u:</span> "C√°c em l√†m vi·ªác <b>c√πng v·ªõi</b> ƒë·ªìng ƒë·ªôi c·ªßa m√¨nh ƒë·ªÉ ch∆°i t·ªët v√† gi√†nh chi·∫øn th·∫Øng."</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> Ta c√≥ c·∫•u tr√∫c <b>work with somebody</b> (l√†m vi·ªác c√πng ai). 'work for' l√† l√†m vi·ªác cho ai (nh∆∞ √¥ng ch·ªß), 'work out' l√† t·∫≠p th·ªÉ d·ª•c/t√¨m ra gi·∫£i ph√°p. ·ªû ƒë√¢y ph·ªëi h·ª£p v·ªõi ƒë·ªìng ƒë·ªôi n√™n d√πng <b>"with"</b>.</div>
                `
            },
            {
                id: 35,
                text: "Question 35: that will help them in school, their future _______ and personal relationships.",
                options: [
                    { text: "world", isCorrect: false },
                    { text: "career", isCorrect: true },
                    { text: "game", isCorrect: false },
                    { text: "shape", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</span><br>
                    - <b>world</b> (n): th·∫ø gi·ªõi<br>
                    - <b>career</b> (n): s·ª± nghi·ªáp<br>
                    - <b>game</b> (n): tr√≤ ch∆°i<br>
                    - <b>shape</b> (n): h√¨nh d√°ng
                    </div>
                    <div class="expl-step"><span>2. D·ªãch c√¢u:</span> "...nh·ªØng ƒëi·ªÅu s·∫Ω gi√∫p √≠ch cho c√°c em ·ªü tr∆∞·ªùng h·ªçc, <b>s·ª± nghi·ªáp</b> t∆∞∆°ng lai v√† c√°c m·ªëi quan h·ªá c√° nh√¢n."</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> X√©t theo ng·ªØ c·∫£nh, nh·ªØng k·ªπ nƒÉng n√†y mang t√≠nh d√†i h·∫°n. C·ª•m t·ª´ "future career" (s·ª± nghi·ªáp trong t∆∞∆°ng lai) ho√†n to√†n h·ª£p l√Ω v√† t·ª± nhi√™n nh·∫•t. C√°c t·ª´ c√≤n l·∫°i gh√©p v√†o kh√¥ng t·∫°o th√†nh c·ª•m t·ª´ c√≥ nghƒ©a ph√π h·ª£p logic.</div>
                `
            },
            {
                id: 36,
                text: "Question 36: What is the text mainly about?",
                options: [
                    { text: "Capital of the USA", isCorrect: false },
                    { text: "San Francisco Bay", isCorrect: false },
                    { text: "Food in San Francisco", isCorrect: false },
                    { text: "A city of the USA", isCorrect: true }
                ],
                explanation: `
                    <div class="expl-step"><span>1. D·ªãch c√¢u h·ªèi:</span> "N·ªôi dung ch√≠nh c·ªßa ƒëo·∫°n vƒÉn l√† g√¨?"</div>
                    <div class="expl-step"><span>2. Ph√¢n t√≠ch ƒë√°p √°n & D·∫´n ch·ª©ng:</span><br>
                    ƒêo·∫°n vƒÉn b·∫Øt ƒë·∫ßu b·∫±ng "San Francisco... is in the San Francisco Bay, the USA." Sau ƒë√≥ mi√™u t·∫£ c√°c ƒë·ªãa danh, l·ªÖ h·ªôi, th·ª©c ƒÉn c·ªßa th√†nh ph·ªë n√†y. V·∫≠y b√†i vƒÉn n√≥i v·ªÅ m·ªôt th√†nh ph·ªë c·ªßa n∆∞·ªõc M·ªπ (San Francisco).<br>
                    - Lo·∫°i "Capital of the USA" v√¨ th·ªß ƒë√¥ M·ªπ l√† Washington D.C, b√†i kh√¥ng nh·∫Øc ƒë·∫øn.<br>
                    - Lo·∫°i "San Francisco Bay" v√† "Food" v√¨ ƒë√¢y ch·ªâ l√† chi ti·∫øt nh·ªè trong b√†i, kh√¥ng bao qu√°t to√†n b·ªô b√†i vƒÉn. N√™n ch·ªçn <b>A city of the USA</b>.
                    </div>
                `
            },
            {
                id: 37,
                text: "Question 37: What does the word ‚Äúits‚Äù in line 2 mean?",
                options: [
                    { text: "San Francisco's", isCorrect: true },
                    { text: "the USA's", isCorrect: false },
                    { text: "the landmark‚Äôs", isCorrect: false },
                    { text: "Chinatown`s", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. D·ªãch c√¢u h·ªèi:</span> "T·ª´ 'its' ·ªü d√≤ng 2 c√≥ nghƒ©a l√† g√¨?"</div>
                    <div class="expl-step"><span>2. T√¨m d·∫´n ch·ª©ng trong b√†i:</span> D√≤ng 2 vi·∫øt: "San Francisco is well-known for <b>its</b> steep rolling hills..." (San Francisco n·ªïi ti·∫øng v·ªõi nh·ªØng ng·ªçn ƒë·ªìi d·ªëc thoai tho·∫£i c·ªßa <b>n√≥</b>).</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> T·ª´ "its" (c·ªßa n√≥) l√† ƒë·∫°i t·ª´ s·ªü h·ªØu thay th·∫ø cho danh t·ª´ ƒë·ª©ng tr∆∞·ªõc n√≥ l√†m ch·ªß ng·ªØ, ch√≠nh l√† "San Francisco". V·∫≠y "its" nghƒ©a l√† <b>San Francisco's</b> (c·ªßa San Francisco).</div>
                `
            },
            {
                id: 38,
                text: "Question 38: Who built Mission Dolores church in the 18th century?",
                options: [
                    { text: "People from Russia.", isCorrect: false },
                    { text: "People from Spain.", isCorrect: true },
                    { text: "People from Brazil.", isCorrect: false },
                    { text: "People from Japan.", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. D·ªãch c√¢u h·ªèi:</span> "Ai ƒë√£ x√¢y d·ª±ng nh√† th·ªù Mission Dolores v√†o th·∫ø k·ª∑ 18?"</div>
                    <div class="expl-step"><span>2. T√¨m d·∫´n ch·ª©ng trong b√†i:</span> ·ªû ƒëo·∫°n 2 c√≥ c√¢u: "You should also visit Mission Dolores, an old church built by <b>the Spanish</b> in the 18th century." (B·∫°n c≈©ng n√™n ƒë·∫øn thƒÉm Mission Dolores, m·ªôt nh√† th·ªù c·ªï do ng∆∞·ªùi T√¢y Ban Nha x√¢y d·ª±ng...)</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> "the Spanish" c√≥ nghƒ©a l√† ng∆∞·ªùi T√¢y Ban Nha (People from Spain). V√¨ v·∫≠y ƒë√°p √°n ch√≠nh x√°c l√† <b>People from Spain</b>.</div>
                `
            },
            {
                id: 39,
                text: "Question 39: Where can we have coffee and enjoy fresh air?",
                options: [
                    { text: "Chinatown", isCorrect: false },
                    { text: "Old houses", isCorrect: false },
                    { text: "Churches", isCorrect: false },
                    { text: "Outdoor coffee shops", isCorrect: true }
                ],
                explanation: `
                    <div class="expl-step"><span>1. D·ªãch c√¢u h·ªèi:</span> "Ch√∫ng ta c√≥ th·ªÉ u·ªëng c√† ph√™ v√† t·∫≠n h∆∞·ªüng kh√¥ng kh√≠ trong l√†nh ·ªü ƒë√¢u?"</div>
                    <div class="expl-step"><span>2. T√¨m d·∫´n ch·ª©ng trong b√†i:</span> ·ªû c√¢u cu·ªëi c√πng c·ªßa ƒëo·∫°n vƒÉn c√≥ vi·∫øt: "Don't forget to visit a jazz club or an <b>outdoor coffee shop</b> to enjoy good coffee and fresh air." (ƒê·ª´ng qu√™n gh√© thƒÉm m·ªôt c√¢u l·∫°c b·ªô nh·∫°c jazz ho·∫∑c qu√°n c√† ph√™ ngo√†i tr·ªùi ƒë·ªÉ th∆∞·ªüng th·ª©c c√† ph√™ ngon v√† kh√¥ng kh√≠ trong l√†nh).</div>
                    <div class="expl-step"><span>3. Gi·∫£i th√≠ch:</span> Th√¥ng tin tr√πng kh·ªõp ho√†n to√†n, ƒë√°p √°n ch·∫Øc ch·∫Øn l√† <b>Outdoor coffee shops</b>.</div>
                `
            },
            {
                id: 40,
                text: "Question 40: Which of the following sentences is NOT TRUE about San Francisco?",
                options: [
                    { text: "San Francisco is in the San Francisco Bay.", isCorrect: false },
                    { text: "The celebration of the Chinese New Year in Chinatown is very interesting.", isCorrect: false },
                    { text: "You can only enjoy American and Chinese food in San Francisco.", isCorrect: true },
                    { text: "You should enjoy jazz at a jazz club in San Francisco.", isCorrect: false }
                ],
                explanation: `
                    <div class="expl-step"><span>1. D·ªãch c√¢u h·ªèi:</span> "C√¢u n√†o sau ƒë√¢y KH√îNG ƒê√öNG v·ªÅ San Francisco?" (Ch√∫ √Ω t·ª´ NOT TRUE).</div>
                    <div class="expl-step"><span>2. ƒê·ªëi chi·∫øu c√°c ƒë√°p √°n v·ªõi b√†i ƒë·ªçc:</span><br>
                    - A ƒë√∫ng v√¨ b√†i vi·∫øt "San Francisco... is in the San Francisco Bay".<br>
                    - B ƒë√∫ng v√¨ b√†i khuy√™n "is one thing that you should not miss" (l√† m·ªôt ƒëi·ªÅu b·∫°n kh√¥ng n√™n b·ªè l·ª° -> R·∫•t th√∫ v·ªã).<br>
                    - D ƒë√∫ng v√¨ b√†i vi·∫øt "Don't forget to visit a jazz club...".<br>
                    - C sai. √ù C n√≥i: "B·∫°n <b>ch·ªâ c√≥ th·ªÉ</b> (only) th∆∞·ªüng th·ª©c ƒë·ªì ƒÉn M·ªπ v√† Trung Qu·ªëc". Trong khi b√†i ƒë·ªçc li·ªát k√™ r·∫•t nhi·ªÅu: "Brazilian, Indian, Japanese, Korean, Mexican, Russian, Thai, Chinese...". V√¨ v·∫≠y c√¢u C l√† th√¥ng tin KH√îNG ƒê√öNG. Ch·ªçn C.
                    </div>
                `
            }
        ];

        let score = 0;
        let answeredQuestions = 0;
        const totalQuestions = questionsData.length;

        // --- UTILS: Shuffle Array ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- WEB AUDIO API (Synthesizing Sounds) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        function playCorrectSound() {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(1046.50, audioCtx.currentTime + 0.1); // C6
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function playWrongSound() {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.3);
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // --- TIMER LOGIC ---
        let timerInterval;
        let timeRemaining = 600; // 10 minutes in seconds
        let isTimerRunning = false;

        function updateTimerDisplay() {
            let m = Math.floor(timeRemaining / 60);
            let s = timeRemaining % 60;
            document.getElementById('timer-display').innerText = `${m < 10 ? '0' + m : m}:${s < 10 ? '0' + s : s}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('start-timer-btn');
            if (isTimerRunning) {
                clearInterval(timerInterval);
                btn.innerText = "TI·∫æP T·ª§C L√ÄM";
                btn.style.background = "#00b85c";
            } else {
                btn.innerText = "T·∫†M D·ª™NG";
                btn.style.background = "#e1b12c";
                timerInterval = setInterval(() => {
                    if (timeRemaining > 0) {
                        timeRemaining--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i. B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m, nh∆∞ng nh·ªõ l√† trong ph√≤ng thi th·∫≠t, b·∫°n ch·ªâ n√™n l√†m m·ªôt b√†i nh∆∞ th·∫ø n√†y trong 10 ph√∫t th√¥i nha.");
                    }
                }, 1000);
            }
            isTimerRunning = !isTimerRunning;
        }

        // --- TRANSLATION TOGGLE ---
        function toggleTranslate(id) {
            const el = document.getElementById(id);
            if (el.style.display === "block") {
                el.style.display = "none";
            } else {
                el.style.display = "block";
            }
        }

        // --- RENDER QUESTIONS ---
        function renderQuestions() {
            const container = document.getElementById('exercises-container');
            let html = "";
            const labels = ['A', 'B', 'C', 'D'];

            questionsData.forEach((q, index) => {
                let optionsHtml = "";
                // Shuffle options for this specific question dynamically
                let shuffledOptions = shuffleArray([...q.options]);

                shuffledOptions.forEach((opt, optIndex) => {
                    optionsHtml += `
                        <button class="option-btn" 
                            onclick="checkAnswer(this, ${index}, ${opt.isCorrect})"
                            data-correct="${opt.isCorrect}">
                            <span style="background: white; border-radius: 50%; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; margin-right: 15px; color: var(--primary); font-weight: 900;">${labels[optIndex]}</span>
                            ${opt.text}
                        </button>
                    `;
                });

                html += `
                    <div class="question-block" id="qb-${index}">
                        <div class="question-text">${q.text}</div>
                        <div class="options-grid" id="options-${index}">
                            ${optionsHtml}
                        </div>
                        <div class="explanation-box" id="expl-${index}">
                            <h4>üí° GI·∫¢I TH√çCH CHI TI·∫æT:</h4>
                            ${q.explanation}
                        </div>
                    </div>
                `;
            });
            // Insert before submit button
            container.insertAdjacentHTML('afterbegin', html);
        }

        // --- CHECK ANSWER LOGIC ---
        function checkAnswer(buttonElement, questionIndex, isCorrect) {
            // Disable all buttons in this question to prevent multiple clicks
            const parent = document.getElementById(`options-${questionIndex}`);
            const buttons = parent.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);

            answeredQuestions++;

            if (isCorrect) {
                buttonElement.classList.add('correct');
                playCorrectSound();
                fireConfetti();
                score++;
            } else {
                buttonElement.classList.add('wrong');
                buttonElement.classList.add('shake');
                playWrongSound();
                // Find and highlight correct answer
                buttons.forEach(btn => {
                    if(btn.getAttribute('data-correct') === 'true') {
                        btn.classList.add('correct');
                    }
                });
            }

            // Show explanation
            document.getElementById(`expl-${questionIndex}`).style.display = "block";
        }

        // --- CONFETTI EFFECT ---
        let particles = [];
        const colors = ["#8854C0", "#FDCB6E", "#00C9A7", "#FF4757", "#00D26A"];
        let canvas, ctx;

        function fireConfetti() {
            canvas = document.getElementById('confetti-canvas');
            ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2 + 100,
                    r: Math.random() * 6 + 4,
                    dx: Math.random() * 10 - 5,
                    dy: Math.random() * -10 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    tilt: Math.floor(Math.random() * 10) - 10,
                    tiltAngleInc: (Math.random() * 0.07) + 0.05,
                    tiltAngle: 0
                });
            }
            if(particles.length <= 100) requestAnimationFrame(drawConfetti);
        }

        function drawConfetti() {
            requestAnimationFrame(drawConfetti);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, index) => {
                p.tiltAngle += p.tiltAngleInc;
                p.y += (Math.cos(p.tiltAngle) + 1 + p.r / 2) / 2;
                p.x += Math.sin(p.tiltAngle) * 2;
                
                ctx.beginPath();
                ctx.lineWidth = p.r;
                ctx.strokeStyle = p.color;
                ctx.moveTo(p.x + p.tilt + p.r, p.y);
                ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r);
                ctx.stroke();

                if (p.y > canvas.height) particles.splice(index, 1);
            });
        }

        // --- SUBMIT AND SCORE ---
        function submitQuiz() {
            if (answeredQuestions < totalQuestions) {
                const confirmSubmit = confirm("B·∫°n ch∆∞a l√†m h·∫øt c√°c c√¢u h·ªèi. B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?");
                if (!confirmSubmit) return;
            }
            
            clearInterval(timerInterval); // Stop timer
            
            document.getElementById('final-score').innerText = `${score} / ${totalQuestions}`;
            
            let feedback = "";
            if (score === totalQuestions) feedback = "Th·∫≠t kh√¥ng th·ªÉ tin n·ªïi! B·∫°n l√† Thi√™n T√†i! üèÜ";
            else if (score >= 8) feedback = "L√†m t·ªët l·∫Øm! Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t v·ªØng! üåü";
            else if (score >= 5) feedback = "B·∫°n ƒë√£ c·ªë g·∫Øng r·ªìi! H√£y xem l·∫°i gi·∫£i th√≠ch ƒë·ªÉ gi·ªèi h∆°n nha! üí™";
            else feedback = "ƒê·ª´ng n·∫£n ch√≠! H√£y ƒë·ªçc k·ªπ l·∫°i l·ªùi gi·∫£i chi ti·∫øt v√† th·ª≠ l·∫°i nh√©! ‚ù§Ô∏è";
            
            document.getElementById('feedback-text').innerText = feedback;
            document.getElementById('result-modal').style.display = "flex";
            if(score >= 8) fireConfetti();
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = "none";
        }

        // INIT
        window.onload = () => {
            renderQuestions();
        };

    </script>
</body>
</html>