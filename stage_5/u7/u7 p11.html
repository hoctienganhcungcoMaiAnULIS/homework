<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p C√¢u M·ªánh L·ªánh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #E0F7FA;
            background-image: radial-gradient(#00C9A7 15%, transparent 16%), radial-gradient(#8854C0 15%, transparent 16%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary-pink);
        }

        header h1 {
            font-size: 1.5rem;
            color: var(--primary-pink);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header p {
            margin: 5px 0 0;
            color: #666;
            font-size: 0.9rem;
        }

        /* Question Card */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 3px solid #eee;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .question-number {
            font-weight: 800;
            color: var(--primary-teal);
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: block;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.4;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 5px 0 #cccccc;
            text-align: left;
            position: relative;
        }

        .option-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #cccccc;
        }

        .option-btn:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--primary-pink);
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 5px 0 #008f47;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #e03e4d;
            box-shadow: 0 5px 0 #c23642;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation-box {
            display: none;
            margin-top: 25px;
            background: #f8f9fa;
            border-left: 5px solid var(--primary-pink);
            padding: 20px;
            border-radius: 10px;
            animation: slideDown 0.4s ease-out;
        }

        .exp-header {
            font-weight: 800;
            color: var(--primary-pink);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .exp-content strong {
            color: #2c3e50;
        }

        .vocab-list {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            border: 1px dashed #ccc;
            margin-top: 10px;
        }
        
        .vocab-item {
            display: block;
            margin-bottom: 5px;
        }

        /* Submit Button */
        .submit-section {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 60px;
        }

        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #6c429c;
            transition: transform 0.1s;
            font-family: 'Nunito', sans-serif;
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: none;
        }

        /* Popup */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 5px solid var(--primary-teal);
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .score-display {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-pink);
            margin: 20px 0;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <header>
        <h1>B√†i T·∫≠p C√¢u M·ªánh L·ªánh (Imperatives)</h1>
        <p>Gi√°o vi√™n t·∫°o: <strong>Ms Mai An ULIS</strong> | Th·∫°c s·ªπ Ng√¥n ng·ªØ Anh</p>
    </header>

    <div class="container" id="quiz-container">
        </div>

    <div class="submit-section">
        <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI <i class="fas fa-paper-plane"></i></button>
    </div>

    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-teal);">K·∫æT QU·∫¢ B√ÄI L√ÄM</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p id="feedback-msg" style="font-size: 1.2rem; color: #555;"></p>
            <button class="submit-btn" onclick="location.reload()" style="font-size: 1rem; padding: 10px 30px; margin-top:20px;">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>

    <script>
        // --- DATA SOURCE (30 C√ÇU H·ªéI V·ªÄ C√ÇU M·ªÜNH L·ªÜNH) ---
        const rawQuestions = [
            {
                q: "______ quiet, please! The baby is sleeping.",
                options: ["A. Be", "B. Being", "C. To be", "D. Are"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Be (v): H√£y (d·∫°ng nguy√™n th·ªÉ)",
                        "B. Being (V-ing): ƒêang l√†",
                        "C. To be (to V): ƒê·ªÉ l√†",
                        "D. Are (V-chia): Th√¨/l√†/·ªü (chia theo ng√¥i)"
                    ],
                    trans: "Xin h√£y gi·ªØ im l·∫∑ng! Em b√© ƒëang ng·ªß.",
                    right: "C√¢u m·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh b·∫Øt ƒë·∫ßu b·∫±ng ƒê·ªông t·ª´ nguy√™n th·ªÉ (V-infinitive). V·ªõi t√≠nh t·ª´ 'quiet', ta d√πng ƒë·ªông t·ª´ 'Be'.",
                    wrong: "B, C, D sai v√¨ c√¢u m·ªánh l·ªánh kh√¥ng b·∫Øt ƒë·∫ßu b·∫±ng V-ing, To V, hay ƒë·ªông t·ª´ ƒë√£ chia th√¨."
                }
            },
            {
                q: "______ talk during the exam.",
                options: ["A. No", "B. Not", "C. Don't", "D. Doesn't"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. No: Kh√¥ng (th∆∞·ªùng ƒëi v·ªõi danh t·ª´)",
                        "B. Not: Kh√¥ng (ph·ªß ƒë·ªãnh)",
                        "C. Don't: ƒê·ª´ng/Kh√¥ng ƒë∆∞·ª£c (tr·ª£ ƒë·ªông t·ª´ m·ªánh l·ªánh)",
                        "D. Doesn't: Kh√¥ng (d√πng cho th√¨ hi·ªán t·∫°i ƒë∆°n ng√¥i th·ª© 3)"
                    ],
                    trans: "Kh√¥ng ƒë∆∞·ª£c n√≥i chuy·ªán trong gi·ªù ki·ªÉm tra.",
                    right: "C·∫•u tr√∫c c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh (C·∫•m ƒëo√°n): Don't + V-nguy√™n th·ªÉ.",
                    wrong: "A v√† B kh√¥ng d√πng l√†m tr·ª£ ƒë·ªông t·ª´ ƒë·∫ßu c√¢u m·ªánh l·ªánh. D sai v√¨ c√¢u m·ªánh l·ªánh lu√¥n d√πng 'Don't', kh√¥ng bao gi·ªù d√πng 'Doesn't' d√π n√≥i v·ªõi ai."
                }
            },
            {
                q: "______ your books to page 45.",
                options: ["A. Opening", "B. Open", "C. Opens", "D. To open"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Opening (V-ing): ƒêang m·ªü",
                        "B. Open (v): M·ªü ra",
                        "C. Opens (V-s): M·ªü (chia ng√¥i 3)",
                        "D. To open (to V): ƒê·ªÉ m·ªü"
                    ],
                    trans: "H√£y m·ªü s√°ch c·ªßa c√°c em ra trang 45.",
                    right: "C√¢u m·ªánh l·ªánh y√™u c·∫ßu h√†nh ƒë·ªông: B·∫Øt ƒë·∫ßu b·∫±ng ƒê·ªông t·ª´ nguy√™n th·ªÉ (V-inf).",
                    wrong: "A, C, D sai ng·ªØ ph√°p c√¢u m·ªánh l·ªánh (kh√¥ng chia s/es, kh√¥ng d√πng V-ing hay to-V)."
                }
            },
            {
                q: "______ on the grass! It is forbidden.",
                options: ["A. Not step", "B. Don't step", "C. No step", "D. Step not"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Not step: (Sai c·∫•u tr√∫c)",
                        "B. Don't step: ƒê·ª´ng gi·∫´m l√™n",
                        "C. No step: (Sai ng·ªØ ph√°p)",
                        "D. Step not: (Sai tr·∫≠t t·ª± t·ª´)"
                    ],
                    trans: "ƒê·ª´ng gi·∫´m l√™n c·ªè! ƒêi·ªÅu ƒë√≥ b·ªã c·∫•m.",
                    right: "C√¢u m·ªánh l·ªánh c·∫•m ƒëo√°n: Don't + V-inf. ƒê·ªông t·ª´ 'step' nghƒ©a l√† b∆∞·ªõc/gi·∫´m.",
                    wrong: "A, C, D ƒë·ªÅu sai c·∫•u tr√∫c ng·ªØ ph√°p c∆° b·∫£n c·ªßa c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh."
                }
            },
            {
                q: "Please ______ me the salt.",
                options: ["A. pass", "B. to pass", "C. passing", "D. passes"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. pass (v): ƒë∆∞a/chuy·ªÅn",
                        "B. to pass: ƒë·ªÉ ƒë∆∞a",
                        "C. passing: ƒëang ƒë∆∞a",
                        "D. passes: ƒë∆∞a (chia ng√¥i 3)"
                    ],
                    trans: "L√†m ∆°n ƒë∆∞a cho t√¥i l·ªç mu·ªëi.",
                    right: "D√π c√≥ t·ª´ 'Please' (l√†m ∆°n) ·ªü ƒë·∫ßu hay cu·ªëi c√¢u, ƒë·ªông t·ª´ ch√≠nh v·∫´n ph·∫£i ·ªü d·∫°ng Nguy√™n th·ªÉ (V-inf).",
                    wrong: "B, C, D sai v√¨ ƒë·ªông t·ª´ trong c√¢u m·ªánh l·ªánh kh√¥ng ƒë∆∞·ª£c chia hay th√™m ƒëu√¥i."
                }
            },
            {
                q: "______ up! It's time to go.",
                options: ["A. Standing", "B. Stands", "C. Stand", "D. Stood"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. Standing (V-ing)",
                        "B. Stands (V-s)",
                        "C. Stand (V-inf): ƒê·ª©ng",
                        "D. Stood (V-ed): ƒê√£ ƒë·ª©ng"
                    ],
                    trans: "ƒê·ª©ng l√™n n√†o! ƒê√£ ƒë·∫øn gi·ªù ƒëi r·ªìi.",
                    right: "C·ª•m t·ª´ 'Stand up' (ƒë·ª©ng l√™n). C√¢u m·ªánh l·ªánh b·∫Øt ƒë·∫ßu b·∫±ng V-nguy√™n th·ªÉ.",
                    wrong: "A, B, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ late for school again.",
                options: ["A. Don't be", "B. Not be", "C. Don't", "D. Aren't"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Don't be: ƒê·ª´ng (th√¨/l√†/·ªü)",
                        "B. Not be: (Sai ng·ªØ ph√°p)",
                        "C. Don't: ƒê·ª´ng (thi·∫øu ƒë·ªông t·ª´ ch√≠nh)",
                        "D. Aren't: (Sai ng·ªØ ph√°p c√¢u m·ªánh l·ªánh)"
                    ],
                    trans: "ƒê·ª´ng ƒëi h·ªçc mu·ªôn l·∫ßn n·ªØa nh√©.",
                    right: "'Late' l√† t√≠nh t·ª´, n√™n c·∫ßn ƒë·ªông t·ª´ tobe ƒëi k√®m. C·∫•u tr√∫c c·∫•m ƒëo√°n: Don't + V(nguy√™n th·ªÉ). Nguy√™n th·ªÉ c·ªßa tobe l√† 'Be'. => Don't be.",
                    wrong: "B sai c·∫•u tr√∫c. C thi·∫øu ƒë·ªông t·ª´ 'be'. D d√πng d·∫°ng chia 'Aren't' l√† sai trong c√¢u c·∫ßu khi·∫øn."
                }
            },
            {
                q: "______ your homework before watching TV.",
                options: ["A. Doing", "B. Do", "C. Does", "D. Did"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Doing (V-ing)",
                        "B. Do (v): L√†m",
                        "C. Does (V-es)",
                        "D. Did (V-ed)"
                    ],
                    trans: "H√£y l√†m b√†i t·∫≠p v·ªÅ nh√† tr∆∞·ªõc khi xem TV.",
                    right: "C√¢u m·ªánh l·ªánh kh·∫≥ng ƒë·ªãnh b·∫Øt ƒë·∫ßu b·∫±ng V-nguy√™n th·ªÉ: 'Do'.",
                    wrong: "A, C, D l√† c√°c d·∫°ng ƒë√£ chia c·ªßa ƒë·ªông t·ª´, kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u m·ªánh l·ªánh."
                }
            },
            {
                q: "______ careful! The floor is wet.",
                options: ["A. Be", "B. Do", "C. Have", "D. Make"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Be (v): H√£y (tobe)",
                        "B. Do (v): L√†m",
                        "C. Have (v): C√≥",
                        "D. Make (v): T·∫°o ra/l√†m"
                    ],
                    trans: "H√£y c·∫©n th·∫≠n! S√†n nh√† ƒëang ∆∞·ªõt.",
                    right: "'Careful' l√† t√≠nh t·ª´, n√™n b·∫Øt bu·ªôc ph·∫£i d√πng ƒë·ªông t·ª´ 'Be' ƒë·∫±ng tr∆∞·ªõc ƒë·ªÉ t·∫°o th√†nh c√¢u m·ªánh l·ªánh. C·ª•m: Be careful (C·∫©n th·∫≠n ƒë·∫•y).",
                    wrong: "B, C, D kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi t√≠nh t·ª´ 'careful' trong ng·ªØ c·∫£nh n√†y."
                }
            },
            {
                q: "______ touch that dog. It's dangerous.",
                options: ["A. Not", "B. Doesn't", "C. Don't", "D. No"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. Not: Kh√¥ng",
                        "B. Doesn't: Kh√¥ng (ng√¥i 3)",
                        "C. Don't: ƒê·ª´ng",
                        "D. No: Kh√¥ng"
                    ],
                    trans: "ƒê·ª´ng ch·∫°m v√†o con ch√≥ ƒë√≥. N√≥ nguy hi·ªÉm ƒë·∫•y.",
                    right: "C√¢u c·∫•m ƒëo√°n: Don't + V(nguy√™n th·ªÉ).",
                    wrong: "Ch·ªâ c√≥ 'Don't' l√† tr·ª£ ƒë·ªông t·ª´ ƒë√∫ng cho c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh."
                }
            },
            {
                q: "______ me use your pen, please.",
                options: ["A. Let", "B. Lets", "C. Letting", "D. To let"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Let (v): ƒê·ªÉ/cho ph√©p",
                        "B. Lets (V-s)",
                        "C. Letting (V-ing)",
                        "D. To let (to V)"
                    ],
                    trans: "L√†m ∆°n cho t·ªõ d√πng b√∫t c·ªßa c·∫≠u nh√©.",
                    right: "C·∫•u tr√∫c 'Let + O + V': ƒê·ªÉ ai l√†m g√¨. C√¢u m·ªánh l·ªánh d√πng 'Let' nguy√™n th·ªÉ ƒë·∫ßu c√¢u.",
                    wrong: "B, C, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ right at the corner.",
                options: ["A. Turning", "B. Turns", "C. Turned", "D. Turn"],
                correct: 3,
                exp: {
                    vocab: [
                        "A. Turning (V-ing)",
                        "B. Turns (V-s)",
                        "C. Turned (V-ed)",
                        "D. Turn (v): R·∫Ω/qu·∫πo"
                    ],
                    trans: "H√£y r·∫Ω ph·∫£i ·ªü g√≥c ƒë∆∞·ªùng.",
                    right: "C√¢u ch·ªâ d·∫´n ƒë∆∞·ªùng ƒëi l√† c√¢u m·ªánh l·ªánh -> D√πng V nguy√™n th·ªÉ 'Turn'.",
                    wrong: "A, B, C sai v√¨ ƒë·ªông t·ª´ b·ªã chia ƒëu√¥i."
                }
            },
            {
                q: "______ forget to lock the door.",
                options: ["A. Not", "B. Don't", "C. No", "D. Won't"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Not: Kh√¥ng",
                        "B. Don't: ƒê·ª´ng",
                        "C. No: Kh√¥ng",
                        "D. Won't: S·∫Ω kh√¥ng"
                    ],
                    trans: "ƒê·ª´ng qu√™n kh√≥a c·ª≠a nh√©.",
                    right: "C·∫•u tr√∫c nh·∫Øc nh·ªü/c·∫•m ƒëo√°n: Don't + V.",
                    wrong: "D (Won't) d√πng cho th√¨ t∆∞∆°ng lai, kh√¥ng d√πng cho c√¢u m·ªánh l·ªánh tr·ª±c ti·∫øp."
                }
            },
            {
                q: "______ nice to your friends.",
                options: ["A. Be", "B. Do", "C. Make", "D. Play"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Be (v): H√£y (tobe)",
                        "B. Do (v): L√†m",
                        "C. Make (v): L√†m",
                        "D. Play (v): Ch∆°i"
                    ],
                    trans: "H√£y ƒë·ªëi x·ª≠ t·ªët v·ªõi b·∫°n b√® c·ªßa con.",
                    right: "'Nice' l√† t√≠nh t·ª´ -> C·∫ßn ƒë·ªông t·ª´ 'Be' ƒë·ª©ng tr∆∞·ªõc. C·ª•m: Be nice to someone.",
                    wrong: "B, C, D l√† ƒë·ªông t·ª´ th∆∞·ªùng, kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi t√≠nh t·ª´ 'nice' ƒë·ªÉ t·∫°o nghƒ©a n√†y."
                }
            },
            {
                q: "______ litter in the park.",
                options: ["A. Don't", "B. Not", "C. No", "D. Aren't"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Don't: ƒê·ª´ng",
                        "B. Not: Kh√¥ng",
                        "C. No: Kh√¥ng",
                        "D. Aren't: Kh√¥ng ph·∫£i"
                    ],
                    trans: "ƒê·ª´ng x·∫£ r√°c trong c√¥ng vi√™n.",
                    right: "C√¢u c·∫•m ƒëo√°n: Don't + V (litter - x·∫£ r√°c).",
                    wrong: "Litter ·ªü ƒë√¢y l√† ƒë·ªông t·ª´ (x·∫£ r√°c), n√™n ph·∫£i d√πng tr·ª£ ƒë·ªông t·ª´ Don't."
                }
            },
            {
                q: "______ your coat on; it's cold outside.",
                options: ["A. Putting", "B. Put", "C. Puts", "D. To put"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Putting (V-ing)",
                        "B. Put (v): M·∫∑c v√†o/ƒë·∫∑t",
                        "C. Puts (V-s)",
                        "D. To put (to V)"
                    ],
                    trans: "H√£y m·∫∑c √°o kho√°c v√†o; b√™n ngo√†i l·∫°nh l·∫Øm.",
                    right: "C√¢u y√™u c·∫ßu: V nguy√™n th·ªÉ 'Put'. C·ª•m: Put on (m·∫∑c v√†o).",
                    wrong: "A, C, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ smoke here. This is a non-smoking area.",
                options: ["A. No", "B. Not", "C. Don't", "D. Doesn't"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. No",
                        "B. Not",
                        "C. Don't: ƒê·ª´ng",
                        "D. Doesn't"
                    ],
                    trans: "ƒê·ª´ng h√∫t thu·ªëc ·ªü ƒë√¢y. ƒê√¢y l√† khu v·ª±c c·∫•m h√∫t thu·ªëc.",
                    right: "C·∫•m ƒëo√°n h√†nh ƒë·ªông: Don't + V (smoke).",
                    wrong: "L∆∞u √Ω: Bi·ªÉn b√°o c√≥ th·ªÉ ghi 'No smoking' (Danh t·ª´), nh∆∞ng c√¢u m·ªánh l·ªánh v·ªõi ƒë·ªông t·ª´ 'smoke' ph·∫£i d√πng 'Don't smoke'."
                }
            },
            {
                q: "______ in line, please.",
                options: ["A. Stand", "B. Standing", "C. Stands", "D. Stood"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Stand (v): ƒê·ª©ng",
                        "B. Standing (V-ing)",
                        "C. Stands (V-s)",
                        "D. Stood (V-ed)"
                    ],
                    trans: "Vui l√≤ng ƒë·ª©ng v√†o h√†ng.",
                    right: "Y√™u c·∫ßu l·ªãch s·ª±: V nguy√™n th·ªÉ + please.",
                    wrong: "C√°c ƒë√°p √°n c√≤n l·∫°i sai d·∫°ng th·ª©c c·ªßa ƒë·ªông t·ª´ ƒë·∫ßu c√¢u m·ªánh l·ªánh."
                }
            },
            {
                q: "______ eat in the library.",
                options: ["A. Not", "B. Don't", "C. Isn't", "D. Aren't"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Not",
                        "B. Don't: ƒê·ª´ng",
                        "C. Isn't",
                        "D. Aren't"
                    ],
                    trans: "Kh√¥ng ƒë∆∞·ª£c ƒÉn trong th∆∞ vi·ªán.",
                    right: "Quy t·∫Øc th∆∞ vi·ªán (C·∫•m): Don't + Eat.",
                    wrong: "C v√† D l√† ƒë·ªông t·ª´ tobe, kh√¥ng ƒëi v·ªõi ƒë·ªông t·ª´ th∆∞·ªùng 'eat' trong c√¢u m·ªánh l·ªánh."
                }
            },
            {
                q: "______ the window; it's raining.",
                options: ["A. Close", "B. Closing", "C. To close", "D. Closed"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Close (v): ƒê√≥ng",
                        "B. Closing (V-ing)",
                        "C. To close (to V)",
                        "D. Closed (V-ed)"
                    ],
                    trans: "H√£y ƒë√≥ng c·ª≠a s·ªï l·∫°i; tr·ªùi ƒëang m∆∞a.",
                    right: "Ra l·ªánh th·ª±c hi·ªán h√†nh ƒë·ªông: D√πng V nguy√™n th·ªÉ 'Close'.",
                    wrong: "B, C, D sai ng·ªØ ph√°p."
                }
            },
            {
                q: "______ listen to him!",
                options: ["A. No", "B. Not", "C. Don't", "D. Doesn't"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. No",
                        "B. Not",
                        "C. Don't",
                        "D. Doesn't"
                    ],
                    trans: "ƒê·ª´ng l·∫Øng nghe anh ta!",
                    right: "C√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh: Don't + V (listen).",
                    wrong: "A, B, D kh√¥ng d√πng l√†m tr·ª£ ƒë·ªông t·ª´ ph·ªß ƒë·ªãnh cho c√¢u m·ªánh l·ªánh."
                }
            },
            {
                q: "______ silly! Think carefully.",
                options: ["A. Don't be", "B. Don't", "C. Not be", "D. No be"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Don't be: ƒê·ª´ng (th√¨/l√†/·ªü)",
                        "B. Don't: ƒê·ª´ng (thi·∫øu V)",
                        "C. Not be: (Sai)",
                        "D. No be: (Sai)"
                    ],
                    trans: "ƒê·ª´ng ng·ªëc ngh·∫øch th·∫ø! H√£y suy nghƒ© k·ªπ ƒëi.",
                    right: "'Silly' l√† t√≠nh t·ª´. C·∫ßn ƒë·ªông t·ª´ 'be'. C·∫•u tr√∫c: Don't + be + adj.",
                    wrong: "B thi·∫øu 'be'. C v√† D sai ng·ªØ ph√°p."
                }
            },
            {
                q: "______ faster! We are late.",
                options: ["A. Running", "B. Run", "C. To run", "D. Runs"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Running",
                        "B. Run (v): Ch·∫°y",
                        "C. To run",
                        "D. Runs"
                    ],
                    trans: "Ch·∫°y nhanh l√™n! Ch√∫ng ta mu·ªôn r·ªìi.",
                    right: "Th√∫c gi·ª•c h√†nh ƒë·ªông: V nguy√™n th·ªÉ 'Run'.",
                    wrong: "A, C, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ give up!",
                options: ["A. No", "B. Not", "C. Don't", "D. Won't"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. No",
                        "B. Not",
                        "C. Don't",
                        "D. Won't"
                    ],
                    trans: "ƒê·ª´ng b·ªè cu·ªôc!",
                    right: "L·ªùi khuy√™n/ƒë·ªông vi√™n (ph·ªß ƒë·ªãnh): Don't + Give up.",
                    wrong: "C·∫•u tr√∫c chu·∫©n l√† Don't + V."
                }
            },
            {
                q: "______ a look at this picture.",
                options: ["A. Take", "B. Takes", "C. Taking", "D. Took"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Take (v): C·∫ßm/l·∫•y",
                        "B. Takes (V-s)",
                        "C. Taking (V-ing)",
                        "D. Took (V-ed)"
                    ],
                    trans: "H√£y nh√¨n v√†o b·ª©c tranh n√†y.",
                    right: "Collocation: Take a look (nh√¨n/xem qua). D√πng V nguy√™n th·ªÉ ƒë·∫ßu c√¢u.",
                    wrong: "B, C, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ shy! Come and say hello.",
                options: ["A. Don't", "B. Not", "C. Don't be", "D. No"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. Don't: (Thi·∫øu be)",
                        "B. Not: (Sai)",
                        "C. Don't be: ƒê·ª´ng c√≥...",
                        "D. No: (Sai)"
                    ],
                    trans: "ƒê·ª´ng ng·∫°i ng√πng! H√£y l·∫°i ƒë√¢y v√† ch√†o h·ªèi ƒëi.",
                    right: "'Shy' l√† t√≠nh t·ª´ -> C·∫ßn 'Don't be'.",
                    wrong: "A thi·∫øu ƒë·ªông t·ª´ tobe ƒëi k√®m t√≠nh t·ª´."
                }
            },
            {
                q: "______ your shoes before entering the house.",
                options: ["A. Remove", "B. Removing", "C. Removed", "D. Removes"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Remove (v): Th√°o/c·ªüi b·ªè",
                        "B. Removing (V-ing)",
                        "C. Removed (V-ed)",
                        "D. Removes (V-s)"
                    ],
                    trans: "H√£y th√°o gi√†y ra tr∆∞·ªõc khi v√†o nh√†.",
                    right: "Y√™u c·∫ßu h√†nh ƒë·ªông: V nguy√™n th·ªÉ 'Remove'.",
                    wrong: "B, C, D sai d·∫°ng ƒë·ªông t·ª´."
                }
            },
            {
                q: "______ cross the street when the light is red.",
                options: ["A. No", "B. Not", "C. Don't", "D. Aren't"],
                correct: 2,
                exp: {
                    vocab: [
                        "A. No",
                        "B. Not",
                        "C. Don't",
                        "D. Aren't"
                    ],
                    trans: "ƒê·ª´ng bƒÉng qua ƒë∆∞·ªùng khi ƒë√®n ƒëang ƒë·ªè.",
                    right: "C·∫•m ƒëo√°n nguy hi·ªÉm: Don't + V (cross).",
                    wrong: "C l√† ƒë√°p √°n duy nh·∫•t ƒë√∫ng ng·ªØ ph√°p c√¢u m·ªánh l·ªánh ph·ªß ƒë·ªãnh."
                }
            },
            {
                q: "______ polite to the teacher.",
                options: ["A. Do", "B. Be", "C. Have", "D. Get"],
                correct: 1,
                exp: {
                    vocab: [
                        "A. Do",
                        "B. Be: H√£y (tobe)",
                        "C. Have",
                        "D. Get"
                    ],
                    trans: "H√£y l·ªÖ ph√©p v·ªõi gi√°o vi√™n.",
                    right: "'Polite' l√† t√≠nh t·ª´ -> D√πng ƒë·ªông t·ª´ 'Be' ƒë·∫ßu c√¢u.",
                    wrong: "A, C, D kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi t√≠nh t·ª´ 'polite' ƒë·ªÉ t·∫°o nghƒ©a n√†y."
                }
            },
            {
                q: "______ wait for me!",
                options: ["A. Please", "B. Do", "C. Be", "D. Can"],
                correct: 0,
                exp: {
                    vocab: [
                        "A. Please: L√†m ∆°n",
                        "B. Do: (Nh·∫•n m·∫°nh)",
                        "C. Be: (Sai)",
                        "D. Can: (Sai)"
                    ],
                    trans: "L√†m ∆°n h√£y ƒë·ª£i m√¨nh v·ªõi!",
                    right: "C√¢u n√†y 'Wait' ƒë√£ l√† ƒë·ªông t·ª´ ch√≠nh. Ta th√™m 'Please' ƒë·ªÉ tƒÉng s·ª± l·ªãch s·ª±/van n√†i.",
                    wrong: "C sai (kh√¥ng d√πng Be wait). D sai (Can wait l√† c√¢u h·ªèi ho·∫∑c kh·∫≥ng ƒë·ªãnh kh·∫£ nƒÉng, kh√¥ng ph·∫£i m·ªánh l·ªánh)."
                }
            }
        ];

        // --- AUDIO ENGINE (Web Audio API - No external files needed) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Ding sound (High pitch sine wave)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Buzz sound (Sawtooth wave, lower pitch)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            }
        }

        // --- LOGIC ---
        
        // Shuffle function
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const questions = shuffleArray([...rawQuestions]); // Shuffle questions
        let score = 0;
        let answeredCount = 0;

        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            questions.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-${index}`;

                // Question Text
                const qNum = document.createElement('span');
                qNum.className = 'question-number';
                qNum.innerText = `Question ${index + 1}`;
                
                const qText = document.createElement('div');
                qText.className = 'question-text';
                qText.innerText = item.q;

                // Options
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'options-grid';

                item.options.forEach((opt, optIndex) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(index, optIndex, btn);
                    optionsDiv.appendChild(btn);
                });

                // Explanation Box
                const expBox = document.createElement('div');
                expBox.className = 'explanation-box';
                expBox.id = `exp-${index}`;
                expBox.innerHTML = `
                    <div class="exp-header"><i class="fas fa-chalkboard-teacher"></i> C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-content">
                        <div class="vocab-list">
                            <strong>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</strong><br>
                            ${item.exp.vocab.map(v => `<span class="vocab-item">${v}</span>`).join('')}
                        </div>
                        <p><strong>2. D·ªãch nghƒ©a:</strong> "${item.exp.trans}"</p>
                        <p style="color: var(--correct-green);"><strong>3. T·∫°i sao ƒê√öNG?</strong> ${item.exp.right}</p>
                        <p style="color: var(--wrong-red);"><strong>4. T·∫°i sao SAI?</strong> ${item.exp.wrong}</p>
                    </div>
                `;

                card.appendChild(qNum);
                card.appendChild(qText);
                card.appendChild(optionsDiv);
                card.appendChild(expBox);
                container.appendChild(card);
            });
        }

        function checkAnswer(qIndex, optIndex, btn) {
            const currentQ = questions[qIndex];
            const card = document.getElementById(`q-${qIndex}`);
            const buttons = card.querySelectorAll('.option-btn');
            
            // Prevent multiple clicks
            if (card.getAttribute('data-answered') === 'true') return;
            card.setAttribute('data-answered', 'true');

            // Check correct
            if (optIndex === currentQ.correct) {
                btn.classList.add('correct');
                playSound('correct');
                fireConfetti();
                score++;
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
                // Highlight correct answer
                buttons[currentQ.correct].classList.add('correct');
            }

            // Disable all buttons
            buttons.forEach(b => b.classList.add('disabled'));

            // Show explanation
            const expBox = document.getElementById(`exp-${qIndex}`);
            expBox.style.display = 'block';

            answeredCount++;
        }

        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const scoreText = document.getElementById('final-score');
            const msg = document.getElementById('feedback-msg');

            scoreText.innerText = `${score} / ${questions.length}`;
            
            const percentage = (score / questions.length) * 100;
            if (percentage === 100) {
                msg.innerText = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i Ti·∫øng Anh! üåüüèÜ";
            } else if (percentage >= 80) {
                msg.innerText = "Gi·ªèi l·∫Øm! Con n·∫Øm b√†i r·∫•t ch·∫Øc! üéâ";
            } else if (percentage >= 50) {
                msg.innerText = "C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! Con l√†m t·ªët r·ªìi! üëç";
            } else {
                msg.innerText = "ƒê·ª´ng bu·ªìn nh√©, xem k·ªπ l·∫°i l·ªùi gi·∫£i th√≠ch c·ªßa c√¥ l√† gi·ªèi ngay! üí™";
            }

            modal.style.display = 'flex';
            if (percentage >= 80) fireConfetti();
        }

        // --- CONFETTI LOGIC ---
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        const colors = ['#8854C0', '#00C9A7', '#FF4757', '#FFD700', '#00D26A'];

        function fireConfetti() {
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    r: Math.random() * 6 + 2,
                    d: Math.random() * 5 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    tilt: Math.floor(Math.random() * 10) - 10,
                    tiltAngleIncremental: Math.random() * 0.07 + 0.05,
                    tiltAngle: 0
                });
            }
        }

        function drawConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                ctx.beginPath();
                ctx.lineWidth = p.r;
                ctx.strokeStyle = p.color;
                ctx.moveTo(p.x + p.tilt + p.r / 2, p.y);
                ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 2);
                ctx.stroke();

                p.y += p.d;
                p.tiltAngle += p.tiltAngleIncremental;
                p.tilt = Math.sin(p.tiltAngle) * 15;

                if (p.y > canvas.height) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(drawConfetti);
        }

        drawConfetti();
        renderQuiz();

    </script>
</body>
</html>