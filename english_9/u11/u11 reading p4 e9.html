<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i t·∫≠p Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-color: #f0f3ff;
            --card-bg: #ffffff;
            --text-color: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#8854c0 0.5px, transparent 0.5px), radial-gradient(#8854c0 0.5px, #f0f3ff 0.5px);
            background-size: 20px 20px;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: #fff;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(136, 84, 192, 0.2);
            border: 3px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            font-size: 2rem;
        }

        .teacher-name {
            color: var(--secondary);
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 5px;
        }

        /* CARD STYLES */
        .card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border: 2px solid #e1e1e1;
        }

        h2 {
            color: var(--primary);
            border-bottom: 2px dashed #ddd;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .reading-text {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 6px solid var(--secondary);
            margin-bottom: 25px;
            line-height: 1.8;
            font-size: 1.05rem;
            text-align: justify;
            white-space: pre-wrap;
        }

        /* GLOSSARY */
        .glossary-box {
            margin: 20px 0;
            border: 2px solid #eee;
            border-radius: 15px;
            overflow: hidden;
        }
        .glossary-title {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            font-weight: bold;
            font-family: 'Quicksand', sans-serif;
        }
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .glossary-table td {
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
        }
        .glossary-table tr:last-child td { border-bottom: none; }
        .word-type { color: #888; font-style: italic; font-size: 0.9em; margin-left: 5px; }

        /* QUESTIONS */
        .question-block {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .question-block:last-child { border-bottom: none; }

        .question-text {
            font-weight: 700;
            font-size: 1.15rem;
            margin-bottom: 15px;
            color: #2d3436;
        }

        /* OPTIONS GRID */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
        }

        .option-btn {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #e0e0e0;
            position: relative;
            line-height: 1.4;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .option-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 4px 0 #00b85c;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: #e03e4d;
            box-shadow: 0 4px 0 #e03e4d;
            animation: shake 0.5s;
        }

        /* GAP FILL SPECIFIC */
        .options-box-top {
            background: #fff8e1;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .options-box-top h3 { margin-top: 0; color: #d35400; font-size: 1rem; text-transform: uppercase; }
        .options-box-item { margin-bottom: 8px; font-weight: 600; color: #444; }

        .gap-answers-area {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            background: #f1f2f6;
            padding: 20px;
            border-radius: 15px;
        }
        
        .gap-answer-group {
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .gap-label { font-weight: 800; color: var(--primary); }
        .circle-btn {
            width: 35px; height: 35px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .circle-btn:hover { background: #eee; }
        .circle-btn.correct { background: var(--correct); color: white; border-color: var(--correct); }
        .circle-btn.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }

        /* PART 4 SENTENCE LIST */
        .sentence-list {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .sentence-item {
            margin-bottom: 8px;
            display: flex;
            gap: 10px;
        }
        .sentence-id { font-weight: bold; color: var(--secondary); min-width: 20px; }

        /* EXPLANATION */
        .explanation {
            display: none;
            margin-top: 15px;
            background: #e8fbf4;
            border: 2px solid var(--correct);
            border-radius: 12px;
            padding: 20px;
            animation: slideDown 0.3s;
        }
        .explanation.visible { display: block; }
        .exp-title { font-weight: 800; color: var(--correct); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .exp-detail p { margin: 5px 0; font-size: 0.95rem; }
        .exp-tag { font-weight: 700; color: var(--primary); }

        /* BUTTONS */
        .btn-submit {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.3rem;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 6px 0 #009e82;
            display: block;
            margin: 40px auto;
            transition: 0.2s;
        }
        .btn-submit:active { transform: translateY(6px); box-shadow: none; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* POPUP */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .popup-content {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            max-width: 400px; border: 5px solid var(--primary);
            animation: slideDown 0.5s;
        }
        #confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }

    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="container">
    <header>
        <h1>ENGLISH MASTERY TEST</h1>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
    </header>

    <div class="card">
        <h2>Part 1: Reading Comprehension</h2>
        <div class="reading-text">Are smartphones causing neck pain? According to a recent study conducted by a doctor in the US, they are even more problematic. The phenomenon known as ‚Äútext neck‚Äù is becoming widespread and could result in permanent damage.
According to the surgeon, the posture we adopt while looking at our phones increases stress on our necks and can lead to excessive wear and tear that may require an operation to correct it in the long run.
Dr. Kenneth Hansraj explains that as we tilt our heads down to view our phones, the effective weight on our necks increases. At a 15-degree angle, it‚Äôs approximately 27 pounds, rising to 60 pounds at a 60-degree angle.
Sammy Margo from the Chartered Society of Physiotherapy in the UK believes that ‚Äútext neck‚Äù is on the rise. She notes that people become involved in texting and often underestimate the need for breaks. This can result in head pain, neck pain, arm pain, and numbness because the normal standing position aligns the curves of the neck and spine correctly. However, when you keep your chin on your chest for a long period, you stretch the whole structure.
Eventually, this, combined with an inactive lifestyle, could lead to serious consequences. Margo advises using voice recognition for making phone calls instead of texting and taking regular breaks while altering texting positions to avoid problems.</div>
        
        <div class="glossary-box">
            <div class="glossary-title">üìö Glossary (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</div>
            <table class="glossary-table">
                <tr><td><strong>Phenomenon</strong><span class="word-type">(n)</span></td><td>Hi·ªán t∆∞·ª£ng</td></tr>
                <tr><td><strong>Widespread</strong><span class="word-type">(adj)</span></td><td>Lan r·ªông, ph·ªï bi·∫øn</td></tr>
                <tr><td><strong>Posture</strong><span class="word-type">(n)</span></td><td>T∆∞ th·∫ø</td></tr>
                <tr><td><strong>Excessive</strong><span class="word-type">(adj)</span></td><td>Qu√° m·ª©c</td></tr>
                <tr><td><strong>Physiotherapy</strong><span class="word-type">(n)</span></td><td>V·∫≠t l√Ω tr·ªã li·ªáu</td></tr>
                <tr><td><strong>Numbness</strong><span class="word-type">(n)</span></td><td>S·ª± t√™ c·ª©ng</td></tr>
            </table>
        </div>

        <div id="quiz-part1"></div>
    </div>

    <div class="card">
        <h2>Part 2: Gap Fill - 3D Printing</h2>
        <p><em>Exercise 5: Choose the correct answer to complete the text.</em></p>
        
        <div class="options-box-top">
            <h3>Options Box:</h3>
            <div class="options-box-item">A. Nevertheless, 3D printing holds immense potential for the future</div>
            <div class="options-box-item">B. from a custom phone case to a functioning prosthetic limb</div>
            <div class="options-box-item">C. This freedom extends to the materials used</div>
            <div class="options-box-item">D. and even aerospace with lightweight parts for airplanes</div>
        </div>

        <div class="reading-text">Imagine a world where you can create anything you can dream of, <strong>(1) ___________</strong>. That‚Äôs the promise of 3D printing, a revolutionary technology that builds objects layer by layer from a digital file. Unlike traditional manufacturing that carves or shapes materials, 3D printing adds material, giving designers and engineers incredible freedom to create intricate and complex designs.

<strong>(2) ___________</strong>. From common plastics like ABS to even metals and food, 3D printing allows for customization and innovation. The possibilities are vast, transforming industries like healthcare with custom prosthetics and implants, <strong>(3) ___________</strong>.

However, 3D printing technology is still evolving. Current limitations include the size and complexity of printable objects, as well as the cost of some materials and printers. <strong>(4) ___________</strong>, offering possibilities for on-demand manufacturing, personalized products, and even pushing the boundaries of medicine.</div>

        <div class="glossary-box">
            <div class="glossary-title">üìö Glossary (3D Printing)</div>
            <table class="glossary-table">
                <tr><td><strong>Revolutionary</strong><span class="word-type">(adj)</span></td><td>Mang t√≠nh c√°ch m·∫°ng</td></tr>
                <tr><td><strong>Prosthetics</strong><span class="word-type">(n)</span></td><td>B·ªô ph·∫≠n gi·∫£ (ch√¢n tay gi·∫£)</td></tr>
                <tr><td><strong>Aerospace</strong><span class="word-type">(n)</span></td><td>H√†ng kh√¥ng v≈© tr·ª•</td></tr>
                <tr><td><strong>On-demand</strong><span class="word-type">(adj)</span></td><td>Theo y√™u c·∫ßu</td></tr>
            </table>
        </div>

        <div class="gap-answers-area" id="gap-part2-answers"></div>
    </div>

    <div class="card">
        <h2>Part 3: Gap Fill - Technology in Education</h2>
        <p><em>Exercise 5: Choose the correct answer to complete the text.</em></p>
        
        <div class="options-box-top">
            <h3>Options Box:</h3>
            <div class="options-box-item">A. Visit libraries for a wealth of printed materials or participate in study groups that encourage face-to-face interaction</div>
            <div class="options-box-item">B. Students can now research projects with ease</div>
            <div class="options-box-item">C. a balanced approach is key to a healthy and productive learning experience</div>
            <div class="options-box-item">D. leading to issues like eye strain and sleep problems</div>
        </div>

        <div class="reading-text">Technology has undeniably revolutionized our world. From instant communication to access to a vast ocean of information, its benefits are undeniable. <strong>(1) ___________</strong> with ease, collaborate with classmates across the globe, and explore diverse educational resources online. However, technology also presents challenges. Excessive screen time can negatively impact physical health, <strong>(2) ___________</strong>. Furthermore, constant connectivity can be distracting, hindering focus and concentration during crucial study periods. So, how can we achieve a healthy balance? Here are some practical steps. Firstly, establish screen-free zones in your study environment. Secondly, designate specific times for checking emails and social media, avoiding the temptation to constantly refresh. Finally, explore alternative learning methods. <strong>(3) ___________</strong>. By consciously managing technology use, students can harness its power for academic success while protecting their well-being. Remember, <strong>(4) ___________</strong>.</div>

        <div class="glossary-box">
            <div class="glossary-title">üìö Glossary (Tech & Education)</div>
            <table class="glossary-table">
                <tr><td><strong>Undeniably</strong><span class="word-type">(adv)</span></td><td>Kh√¥ng th·ªÉ ph·ªß nh·∫≠n</td></tr>
                <tr><td><strong>Collaborate</strong><span class="word-type">(v)</span></td><td>H·ª£p t√°c</td></tr>
                <tr><td><strong>Temptation</strong><span class="word-type">(n)</span></td><td>S·ª± c√°m d·ªó</td></tr>
                <tr><td><strong>Harness</strong><span class="word-type">(v)</span></td><td>Khai th√°c, t·∫≠n d·ª•ng</td></tr>
                <tr><td><strong>Well-being</strong><span class="word-type">(n)</span></td><td>S·ª± kh·ªèe m·∫°nh, h·∫°nh ph√∫c</td></tr>
            </table>
        </div>

        <div class="gap-answers-area" id="gap-part3-answers"></div>
    </div>

    <div class="card">
        <h2>Part 4: Sentence Arrangement</h2>
        <div id="quiz-part4"></div>
    </div>

    <button class="btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
</div>

<div class="popup-overlay" id="scorePopup">
    <div class="popup-content">
        <h2 style="color:var(--primary)">K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
        <div style="font-size: 3.5rem; font-weight: 800; color: var(--correct); margin: 20px 0;" id="finalScore">0/16</div>
        <p id="praiseText" style="font-size: 1.2rem;">B·∫°n l√†m r·∫•t t·ªët!</p>
        <button class="btn-submit" style="font-size: 1rem; padding: 12px 30px; margin: 20px auto 0;" onclick="closePopup()">Xem l·∫°i b√†i l√†m</button>
    </div>
</div>

<script>
    // --- DATA ---
    const dataPart1 = [
        {
            q: "1. According to the text, what is the phenomenon known as ‚Äútext neck‚Äù?",
            opts: ["A. A condition caused by excessive phone usage.", "B. Neck pain caused by smartphone addiction.", "C. Permanent damage resulting from smartphone usage.", "D. The increased stress on the neck due to phone posture."],
            correct: 3,
            exp: "D·ªãch c√¢u h·ªèi: Theo b√†i ƒë·ªçc, hi·ªán t∆∞·ª£ng 'text neck' l√† g√¨?<br><b>T·∫°i sao ch·ªçn D:</b> Trong b√†i (ƒêo·∫°n 2): 'the posture we adopt while looking at our phones increases stress on our necks'. ƒê√¢y l√† ƒë·ªãnh nghƒ©a c·ªët l√µi c·ªßa hi·ªán t∆∞·ª£ng: √Åp l·ª±c l√™n c·ªï tƒÉng do t∆∞ th·∫ø."
        },
        {
            q: "2. Who believes that ‚Äútext neck‚Äù is on the rise?",
            opts: ["A. Dr. Kenneth Hansraj.", "B. A doctor from the US.", "C. Sammy Margo.", "D. The surgeon conducting the study."],
            correct: 2,
            exp: "D·ªãch c√¢u h·ªèi: Ai tin r·∫±ng 'text neck' ƒëang gia tƒÉng?<br><b>T·∫°i sao ch·ªçn C:</b> D·∫´n ch·ª©ng ƒëo·∫°n 4: 'Sammy Margo ... believes that text neck is on the rise.'"
        },
        {
            q: "3. Which statement contradicts the information in the text?",
            opts: ["A. Text neck may require an operation to correct it.", "B. Neck pain is not a consequence of using smartphones.", "C. The normal standing position aligns the neck and spine correctly.", "D. Keeping the chin on the chest for a long time stretches the whole structure."],
            correct: 1,
            exp: "D·ªãch c√¢u h·ªèi: C√¢u n√†o M√ÇU THU·∫™N v·ªõi th√¥ng tin trong b√†i?<br><b>T·∫°i sao ch·ªçn B:</b> B√†i ƒë·ªçc li·ªát k√™ 'head pain, neck pain' l√† h·∫≠u qu·∫£. V·∫≠y n√≥i 'ƒëau c·ªï KH√îNG ph·∫£i h·∫≠u qu·∫£' l√† sai (m√¢u thu·∫´n)."
        },
        {
            q: "4. Which is the phrase ‚Äúon the rise‚Äù closest in meaning to?",
            opts: ["A. decrease", "B. drop", "C. rocket", "D. increase"],
            correct: 3,
            exp: "D·ªãch: C·ª•m t·ª´ 'on the rise' g·∫ßn nghƒ©a nh·∫•t v·ªõi t·ª´ n√†o?<br><b>Gi·∫£i th√≠ch:</b> 'On the rise' = ƒëang tƒÉng l√™n = Increase (D). Rocket th∆∞·ªùng l√† tƒÉng v·ªçt r·∫•t m·∫°nh."
        },
        {
            q: "5. What can be inferred about the effects of texting on the body?",
            opts: ["A. Texting causes permanent damage to the neck.", "B. Texting frequently leads to numbness in the arms.", "C. Texting can result in head pain and neck pain.", "D. Texting rarely causes any health problems."],
            correct: 2,
            exp: "D·ªãch: C√≥ th·ªÉ suy ra ƒëi·ªÅu g√¨ v·ªÅ t√°c h·∫°i c·ªßa nh·∫Øn tin?<br><b>T·∫°i sao ch·ªçn C:</b> B√†i vi·∫øt d√πng t·ª´ 'can result in head pain, neck pain'. C√¢u A sai v√¨ b√†i d√πng 'could result' (c√≥ th·ªÉ) ch·ª© kh√¥ng kh·∫≥ng ƒë·ªãnh ch·∫Øc ch·∫Øn."
        }
    ];

    const dataPart2 = [
        { id: "p2_1", correct: 1, exp: "Ch·ªçn B: 'from a custom phone case to a functioning prosthetic limb'.<br>L√Ω do: C√¢u tr∆∞·ªõc n√≥i 'create anything you can dream of'. C√¢u B ƒë∆∞a ra v√≠ d·ª• c·ª• th·ªÉ cho 'anything'." },
        { id: "p2_2", correct: 2, exp: "Ch·ªçn C: 'This freedom extends to the materials used'.<br>L√Ω do: C√¢u sau li·ªát k√™ c√°c v·∫≠t li·ªáu: 'From common plastics... to even metals'." },
        { id: "p2_3", correct: 3, exp: "Ch·ªçn D: 'and even aerospace with lightweight parts for airplanes'.<br>L√Ω do: ƒêang li·ªát k√™ ng√†nh c√¥ng nghi·ªáp (healthcare, prosthetics...) th√¨ c·∫ßn n·ªëi ti·∫øp b·∫±ng 'and' + ng√†nh ti·∫øp theo (aerospace)." },
        { id: "p2_4", correct: 0, exp: "Ch·ªçn A: 'Nevertheless, 3D printing holds immense potential...'.<br>L√Ω do: ƒêo·∫°n tr∆∞·ªõc n√≥i v·ªÅ h·∫°n ch·∫ø (limitations). C·∫ßn t·ª´ n·ªëi 'Nevertheless' (Tuy nhi√™n) ƒë·ªÉ chuy·ªÉn sang √Ω t√≠ch c·ª±c k·∫øt b√†i." }
    ];

    const dataPart3 = [
        { id: "p3_1", correct: 1, exp: "Ch·ªçn B: 'Students can now research projects with ease'.<br>L√Ω do: C·∫ßn m·ªôt ch·ªß ng·ªØ (Students) ƒë·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông ti·∫øp theo nh∆∞ 'collaborate', 'explore' trong c√¢u." },
        { id: "p3_2", correct: 3, exp: "Ch·ªçn D: 'leading to issues like eye strain and sleep problems'.<br>L√Ω do: C√¢u tr∆∞·ªõc n√≥i ·∫£nh h∆∞·ªüng s·ª©c kh·ªèe th·ªÉ ch·∫•t (physical health). C√¢u D gi·∫£i th√≠ch c·ª• th·ªÉ h·∫≠u qu·∫£ ƒë√≥." },
        { id: "p3_3", correct: 0, exp: "Ch·ªçn A: 'Visit libraries... or participate in study groups...'.<br>L√Ω do: C√¢u tr∆∞·ªõc khuy√™n t√¨m ph∆∞∆°ng ph√°p h·ªçc thay th·∫ø (alternative learning methods). C√¢u A li·ªát k√™ c√°c ph∆∞∆°ng ph√°p ƒë√≥." },
        { id: "p3_4", correct: 2, exp: "Ch·ªçn C: 'a balanced approach is key...'.<br>L√Ω do: ƒê√¢y l√† c√¢u k·∫øt lu·∫≠n cho to√†n b√†i vƒÉn n√≥i v·ªÅ vi·ªác c√¢n b·∫±ng c√¥ng ngh·ªá." }
    ];

    const dataPart4 = [
        {
            id: "p4_1",
            text: "1. Conversation between Mai & Lan:",
            sentences: [
                "a. Mai: You're right. Maybe we should set some limits for ourselves? Like study sessions with phones off?",
                "b. Mai: Deal! We can even reward ourselves with some phone time after we finish an assignment.",
                "c. Mai: Hey Linh, isn't technology amazing for schoolwork? So many resources online!",
                "d. Lan: Yeah, totally! But sometimes it's a bit much. Screens everywhere can be distracting.",
                "e. Lan: Great idea! We can focus better and still enjoy the benefits of tech during breaks."
            ],
            opts: ["A. c-d-b-e-a", "B. c-e-a-d-b", "C. c-d-a-e-b", "D. c-d-a-b-e"],
            correct: 2, // C
            exp: "<b>Ch·ªçn C (c-d-a-e-b):</b><br>1. (c) Mai m·ªü ƒë·∫ßu khen c√¥ng ngh·ªá.<br>2. (d) Lan ƒë·ªìng √Ω nh∆∞ng n√™u v·∫•n ƒë·ªÅ (distracting).<br>3. (a) Mai ƒë·ªÅ xu·∫•t gi·∫£i ph√°p (set limits).<br>4. (e) Lan t√°n th√†nh gi·∫£i ph√°p.<br>5. (b) Mai ch·ªët 'Deal!'."
        },
        {
            id: "p4_2",
            text: "2. Instructions for new smartphone:",
            sentences: [
                "a. Next, turn on the phone by pressing the power button on the side. After that, use the setup guide to connect to your Wi-Fi network and sign in.",
                "b. By following these simple instructions, you can quickly get your new smartphone ready for use and enjoy all of its features.",
                "c. Then, explore the settings to change things like brightness and volume. Finally, download any apps you need from the app store.",
                "d. To start using your new phone, first, take it out of the box and charge it fully.",
                "e. Setting up your new smartphone for the first time is a straightforward process, breaking down into a few manageable steps."
            ],
            opts: ["A. e-a-d-c-b", "B. d-e-b-a-c", "C. d-e-c-b-c", "D. e-d-a-c-b"],
            correct: 3, // D
            exp: "<b>Ch·ªçn D (e-d-a-c-b):</b><br>1. (e) Gi·ªõi thi·ªáu chung.<br>2. (d) First, take it out...<br>3. (a) Next, turn on...<br>4. (c) Then, explore... Finally...<br>5. (b) K·∫øt lu·∫≠n (By following...)."
        },
        {
            id: "p4_3",
            text: "3. Essay on Technology Balance:",
            sentences: [
                "a. By limiting screen time and engaging in real-life activities, we can gain the benefits of technology without harming our health or thinking skills.",
                "b. However, there's a downside Spending too much time glued to screens can lead to a more sedentary lifestyle a hinder critical thinking skills.",
                "c. Technology offers a double-edged sword.",
                "d. On the one hand, it's a fantastic tool to finding information and entertainment. With just a few clicks, we can access: world of knowledge or relax with a funny video.",
                "e. Information overload can make it difficult to analyze and evaluate what we see online. The key is finding balance."
            ],
            opts: ["A. c-d-b-e-a", "B. c-e-a-d-b", "C. c-d-a-e-b", "D. c-d-a-b-e"],
            correct: 0, // A
            exp: "<b>Ch·ªçn A (c-d-b-e-a):</b><br>1. (c) C√¢u ch·ªß ƒë·ªÅ (Dao hai l∆∞·ª°i).<br>2. (d) M·∫∑t t·ªët (On the one hand).<br>3. (b) M·∫∑t x·∫•u (However).<br>4. (e) Chi ti·∫øt th√™m v·ªÅ m·∫∑t x·∫•u.<br>5. (a) K·∫øt lu·∫≠n gi·∫£i ph√°p (By limiting...)."
        }
    ];

    let totalScore = 0;
    let answeredQuestions = new Set();

    // --- RENDER FUNCTIONS ---
    function renderPart1() {
        const container = document.getElementById('quiz-part1');
        dataPart1.forEach((item, index) => {
            container.innerHTML += createMCQHTML(`p1_${index}`, item.q, item.opts, item.correct, item.exp);
        });
    }

    function renderPart2() {
        const container = document.getElementById('gap-part2-answers');
        dataPart2.forEach((item, index) => {
            container.innerHTML += createGapHTML(`p2_${index}`, index + 1, item.correct, item.exp);
        });
    }

    function renderPart3() {
        const container = document.getElementById('gap-part3-answers');
        dataPart3.forEach((item, index) => {
            container.innerHTML += createGapHTML(`p3_${index}`, index + 1, item.correct, item.exp);
        });
    }

    function renderPart4() {
        const container = document.getElementById('quiz-part4');
        dataPart4.forEach((item, index) => {
            let sentencesHTML = `<div class="sentence-list">`;
            item.sentences.forEach(s => {
                sentencesHTML += `<div class="sentence-item"><span class="sentence-id"></span><span>${s}</span></div>`;
            });
            sentencesHTML += `</div>`;
            
            let html = `
                <div class="question-block" id="block-p4_${index}">
                    <div class="question-text">${item.text}</div>
                    ${sentencesHTML}
                    <div class="options-grid">
                        ${item.opts.map((opt, i) => `<button class="option-btn" onclick="checkAnswer('p4_${index}', ${i}, ${item.correct}, this)">${opt}</button>`).join('')}
                    </div>
                    <div class="explanation">
                        <div class="exp-title">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="exp-detail">${item.exp}</div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // --- HELPER HTML GENERATORS ---
    function createMCQHTML(id, question, options, correctIndex, explanation) {
        return `
            <div class="question-block" id="block-${id}">
                <div class="question-text">${question}</div>
                <div class="options-grid">
                    ${options.map((opt, i) => `<button class="option-btn" onclick="checkAnswer('${id}', ${i}, ${correctIndex}, this)">${opt}</button>`).join('')}
                </div>
                <div class="explanation">
                    <div class="exp-title">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-detail">${explanation}</div>
                </div>
            </div>
        `;
    }

    function createGapHTML(id, labelNum, correctIndex, explanation) {
        return `
            <div style="width:100%; margin-bottom: 10px;">
                <div class="gap-answer-group" id="block-${id}">
                    <span class="gap-label">C√¢u (${labelNum}):</span>
                    ${['A', 'B', 'C', 'D'].map((opt, i) => `<button class="circle-btn" onclick="checkAnswer('${id}', ${i}, ${correctIndex}, this)">${opt}</button>`).join('')}
                </div>
                <div class="explanation" style="margin-top:5px;">
                    <div class="exp-title">üë©‚Äçüè´ C√¥ Mai An gi·∫£i th√≠ch:</div>
                    <div class="exp-detail">${explanation}</div>
                </div>
            </div>
        `;
    }

    // --- LOGIC ---
    function checkAnswer(id, selectedIndex, correctIndex, btnElement) {
        if (answeredQuestions.has(id)) return; // Prevent multiple clicks
        answeredQuestions.add(id);

        const block = document.getElementById(`block-${id}`);
        // Support for both MCQ (buttons inside div) and Gap (buttons inside div)
        const buttons = block.querySelectorAll('button');
        const explanation = block.parentElement.querySelector('.explanation') || block.querySelector('.explanation'); 
        // Logic fix for Gap fill structure where explanation is sibling
        const actualExp = block.nextElementSibling?.classList.contains('explanation') ? block.nextElementSibling : block.querySelector('.explanation');

        if (selectedIndex === correctIndex) {
            btnElement.classList.add('correct');
            totalScore++;
            playSound(true);
            fireConfetti();
        } else {
            btnElement.classList.add('wrong');
            buttons[correctIndex].classList.add('correct'); // Show correct answer
            playSound(false);
        }

        if(actualExp) actualExp.classList.add('visible');
    }

    function submitQuiz() {
        const totalQ = dataPart1.length + dataPart2.length + dataPart3.length + dataPart4.length;
        document.getElementById('finalScore').innerText = `${totalScore}/${totalQ}`;
        
        const popup = document.getElementById('scorePopup');
        popup.style.display = 'flex';
        
        const praise = document.getElementById('praiseText');
        if (totalScore === totalQ) praise.innerText = "Xu·∫•t s·∫Øc! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em!";
        else if (totalScore > totalQ * 0.8) praise.innerText = "Gi·ªèi l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa l√† ƒëi·ªÉm tuy·ªát ƒë·ªëi!";
        else if (totalScore > totalQ * 0.5) praise.innerText = "Kh√° t·ªët! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu b√†i h∆°n nh√©.";
        else praise.innerText = "C·∫ßn c·ªë g·∫Øng nhi·ªÅu h∆°n nha! ƒê·ª´ng n·∫£n ch√≠!";
    }

    function closePopup() {
        document.getElementById('scorePopup').style.display = 'none';
    }

    // --- AUDIO & EFFECTS ---
    function playSound(isCorrect) {
        // Using simple tones created by AudioContext would be better but keeping it simple with no external dependencies
        // Simulating sound via beep isn't possible easily without user interaction first.
        // We will assume browser allows it or silent fail.
        const audio = new Audio(isCorrect 
            ? 'https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg' 
            : 'https://actions.google.com/sounds/v1/cartoon/clown_horn_squeeze.ogg');
        audio.volume = 0.5;
        audio.play().catch(e => console.log("Audio blocked"));
    }

    // Confetti
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let confetti = [];

    function fireConfetti() {
        for (let i = 0; i < 60; i++) {
            confetti.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: ['#8854C0', '#00C9A7', '#FF4757', '#F1C40F'][Math.floor(Math.random() * 4)],
                size: Math.random() * 8 + 4,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 4 - 2
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let active = false;
        confetti.forEach((p, i) => {
            p.y += p.speedY;
            p.x += p.speedX;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if (p.y < canvas.height) active = true;
        });
        if (active) requestAnimationFrame(animateConfetti);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // --- INIT ---
    renderPart1();
    renderPart2();
    renderPart3();
    renderPart4();

</script>
</body>
</html>


