<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercise 18: Sentence Combination (Relative Clauses) - Ms Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #8854C0; /* Purple */
            --secondary-color: #00C9A7; /* Teal */
            --correct-color: #00D26A; /* Green */
            --wrong-color: #FF4757; /* Red/Orange */
            --bg-color: #F0F4F8;
            --card-bg: #FFFFFF;
            --text-main: #2D3436;
            --text-light: #636E72;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevent text selection for game feel */
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dfe6e9 10%, transparent 10%), radial-gradient(#dfe6e9 10%, transparent 10%);
            background-position: 0 0, 20px 20px;
            background-size: 40px 40px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1), 0 20px 30px rgba(0,0,0,0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
            border: 4px solid #fff;
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }

        .teacher-badge {
            background: var(--primary-color);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-weight: 800;
            font-size: 1.1rem;
            display: inline-block;
            margin-bottom: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background-color: #dfe6e9;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
            border: 2px solid white;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), #00b894);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 10px;
        }

        /* Question Area */
        .question-box {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 10px;
            line-height: 1.5;
            text-align: center;
        }

        .hint-text {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            margin-bottom: 25px;
            font-size: 0.95rem;
            background: #f1f2f6;
            padding: 8px;
            border-radius: 10px;
            display: inline-block;
            width: 100%;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            gap: 15px;
            grid-template-columns: 1fr; /* Default mobile */
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr; /* 2 columns on desktop */
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-bottom: 6px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
            margin-bottom: 4px; /* offset the border reduction */
        }

        .option-letter {
            background: #f1f2f6;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            margin-right: 12px;
            flex-shrink: 0;
            color: var(--text-light);
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: #00b894;
            border-bottom-color: #008f72;
        }
        .option-btn.correct .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: #ff6b81;
            border-bottom-color: #e03b4b;
            animation: shake 0.5s;
        }
        .option-btn.wrong .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background: #fff8e1; /* Light yellow note */
            border: 2px solid #ffeaa7;
            border-left: 8px solid #fdcb6e;
            border-radius: 12px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideUp 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: #d35400;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-content p {
            margin: 8px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        .exp-label {
            font-weight: 700;
            color: var(--primary-color);
        }

        .exp-translation {
            color: #2c3e50;
            font-style: italic;
        }

        /* Controls */
        .controls {
            margin-top: 25px;
            text-align: right;
        }

        .next-btn {
            background: var(--text-main);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            font-family: 'Nunito', sans-serif;
            display: none; /* Hidden until answered */
        }

        .next-btn:hover {
            transform: scale(1.05);
            background: var(--primary-color);
        }

        /* Modal */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .score-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-main);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            50% { transform: translateX(10px) rotate(5deg); }
            75% { transform: translateX(-10px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .game-container { padding: 15px; border-width: 2px; }
            .question-box { font-size: 1.1rem; }
            .option-btn { padding: 15px; font-size: 0.9rem; }
            .teacher-badge { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

<div class="game-container">
    <div class="header">
        <div class="teacher-badge">üë©‚Äçüè´ Gi√°o vi√™n: Ms Mai An (ULIS)</div>
        <div id="score-tracker" style="font-weight: bold; color: var(--primary-color);">ƒêi·ªÉm: 0</div>
    </div>

    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div id="quiz-area">
        <div class="question-box" id="question-text">
            Loading question...
        </div>
        
        <div class="hint-text" id="hint-text"></div>

        <div class="options-grid" id="options-container">
            <!-- Options generated by JS -->
        </div>

        <div class="explanation-box" id="explanation-box">
            <div class="explanation-header">
                <span>üí° C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</span>
            </div>
            <div class="explanation-content" id="explanation-content">
                <!-- Content generated by JS -->
            </div>
        </div>

        <div class="controls">
            <button class="next-btn" id="next-btn" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
            <button class="next-btn" id="finish-btn" onclick="showResults()" style="display:none; background-color: var(--secondary-color);">N·ªôp b√†i & Xem ƒëi·ªÉm üèÜ</button>
        </div>
    </div>
</div>

<!-- Result Modal -->
<div class="result-modal" id="result-modal">
    <div class="result-content">
        <h2>üéâ HO√ÄN TH√ÄNH!</h2>
        <div class="score-display" id="final-score">0/15</div>
        <p class="feedback-text" id="final-feedback">B·∫°n l√†m t·ªët l·∫Øm!</p>
        <button class="next-btn" style="display:inline-block;" onclick="location.reload()">L√†m l·∫°i b√†i thi üîÑ</button>
    </div>
</div>

<script>
    // --- DATA ---
    // Note: I have processed the rationale to follow the "Analyze All 4" format requested.
    const rawData = {
      "questions": [
        {
          "questionNumber": 1,
          "question": "The tourists are from Japan. They are visiting the floating market.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The tourists' (ng∆∞·ªùi). ƒê·ªông t·ª´ theo sau l√† 'are visiting' (ƒëang thƒÉm). C·∫ßn ƒë·∫°i t·ª´ quan h·ªá ch·ªâ ng∆∞·ªùi l√†m ch·ªß ng·ªØ.",
          "answerOptions": [
            { "text": "The tourists who are visiting the floating market are from Japan.", "isCorrect": true, "analysis": "D√πng 'who' (ƒë·∫°i t·ª´ quan h·ªá ch·ªâ ng∆∞·ªùi) l√†m ch·ªß ng·ªØ cho 'are visiting'." },
            { "text": "The tourists which are visiting the floating market are from Japan.", "isCorrect": false, "analysis": "D√πng 'which' (ch·ªâ v·∫≠t) -> Sai v√¨ 'tourists' l√† ng∆∞·ªùi." },
            { "text": "The tourists whose are visiting the floating market are from Japan.", "isCorrect": false, "analysis": "D√πng 'whose' (ch·ªâ s·ªü h·ªØu) -> Sai v√¨ sau 'whose' ph·∫£i l√† danh t·ª´, ·ªü ƒë√¢y l√† ƒë·ªông t·ª´ 'are'." },
            { "text": "The tourists whom are visiting the floating market are from Japan.", "isCorrect": false, "analysis": "D√πng 'whom' (ch·ªâ t√¢n ng·ªØ) -> Sai v√¨ ch·ªó tr·ªëng c·∫ßn Ch·ªß ng·ªØ cho 'are visiting'." }
          ],
          "transQ": "Nh·ªØng du kh√°ch ƒë·∫øn t·ª´ Nh·∫≠t B·∫£n. H·ªç ƒëang thƒÉm ch·ª£ n·ªïi.",
          "transA": "Nh·ªØng du kh√°ch ng∆∞·ªùi m√† ƒëang gh√© thƒÉm ch·ª£ n·ªïi th√¨ ƒë·∫øn t·ª´ Nh·∫≠t B·∫£n."
        },
        {
          "questionNumber": 2,
          "question": "This is the hotel. We stayed there last summer.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'the hotel' (v·∫≠t/n∆°i ch·ªën). Trong c√¢u g·ªëc 'stayed there' (·ªü ƒë√≥) = 'stayed at the hotel'.",
          "answerOptions": [
            { "text": "This is the hotel who we stayed there last summer.", "isCorrect": false, "analysis": "D√πng 'who' (ch·ªâ ng∆∞·ªùi) cho 'hotel' (v·∫≠t) l√† sai. Th·ª´a t·ª´ 'there'." },
            { "text": "This is the hotel which we stayed at last summer.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (hotel). Gi·ªõi t·ª´ 'at' ƒë∆∞·ª£c gi·ªØ l·∫°i cu·ªëi c√¢u (stayed at which)." },
            { "text": "This is the hotel whose we stayed at last summer.", "isCorrect": false, "analysis": "D√πng 'whose' (ch·ªâ s·ªü h·ªØu) -> Sai ng·ªØ ph√°p." },
            { "text": "This is the hotel whom we stayed at last summer.", "isCorrect": false, "analysis": "D√πng 'whom' (ch·ªâ ng∆∞·ªùi) -> Sai." }
          ],
          "transQ": "ƒê√¢y l√† c√°i kh√°ch s·∫°n. Ch√∫ng t√¥i ƒë√£ ·ªü ƒë√≥ m√πa h√® tr∆∞·ªõc.",
          "transA": "ƒê√¢y l√† kh√°ch s·∫°n c√°i m√† ch√∫ng t√¥i ƒë√£ ·ªü v√†o m√πa h√® nƒÉm ngo√°i."
        },
        {
          "questionNumber": 3,
          "question": "The tour guide's microphone is broken. He is leading our group.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Microphone l√† c·ªßa h∆∞·ªõng d·∫´n vi√™n (The tour guide's). C·∫ßn ƒë·∫°i t·ª´ quan h·ªá ch·ªâ s·ªü h·ªØu.",
          "answerOptions": [
            { "text": "The tour guide who is leading our group has a broken microphone.", "isCorrect": false, "analysis": "C√¢u n√†y ƒë√∫ng ng·ªØ ph√°p nh∆∞ng ƒë·ªÅ b√†i y√™u c·∫ßu k·∫øt h·ª£p c√¢u d√πng MƒêQH s·ªü h·ªØu ƒë·ªÉ s√°t c·∫•u tr√∫c g·ªëc nh·∫•t." },
            { "text": "The tour guide whose microphone is broken is leading our group.", "isCorrect": true, "analysis": "D√πng 'whose' thay th·∫ø cho t√≠nh t·ª´ s·ªü h·ªØu 'The tour guide's'. C·∫•u tr√∫c: Person + whose + Noun." },
            { "text": "The tour guide which microphone is broken is leading our group.", "isCorrect": false, "analysis": "Sai v√¨ 'which' kh√¥ng d√πng ƒë·ªÉ ch·ªâ s·ªü h·ªØu cho ng∆∞·ªùi." },
            { "text": "The tour guide whom microphone is broken is leading our group.", "isCorrect": false, "analysis": "Sai v√¨ 'whom' l√† t√¢n ng·ªØ, kh√¥ng ch·ªâ s·ªü h·ªØu." }
          ],
          "transQ": "Micro c·ªßa h∆∞·ªõng d·∫´n vi√™n b·ªã h·ªèng. Anh ·∫•y ƒëang d·∫´n ƒëo√†n ch√∫ng t√¥i.",
          "transA": "Ng∆∞·ªùi h∆∞·ªõng d·∫´n vi√™n m√† micro c·ªßa anh ·∫•y b·ªã h·ªèng th√¨ ƒëang d·∫´n ƒëo√†n ch√∫ng t√¥i."
        },
        {
          "questionNumber": 4,
          "question": "The beach is very clean. It attracts many families with children.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The beach' (v·∫≠t). ƒê·ªông t·ª´ l√† 'attracts'.",
          "answerOptions": [
            { "text": "The beach who attracts many families with children is very clean.", "isCorrect": false, "analysis": "Sai do d√πng 'who' (ng∆∞·ªùi) cho 'beach' (v·∫≠t)." },
            { "text": "The beach whose attracts many families with children is very clean.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu, kh√¥ng l√†m ch·ªß ng·ªØ tr·ª±c ti·∫øp cho ƒë·ªông t·ª´." },
            { "text": "The beach which attracts many families with children is very clean.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (beach) l√†m ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'attracts'." },
            { "text": "The beach whom attracts many families with children is very clean.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' (ng∆∞·ªùi)." }
          ],
          "transQ": "B√£i bi·ªÉn r·∫•t s·∫°ch. N√≥ thu h√∫t nhi·ªÅu gia ƒë√¨nh c√≥ tr·∫ª nh·ªè.",
          "transA": "B√£i bi·ªÉn c√°i m√† thu h√∫t nhi·ªÅu gia ƒë√¨nh c√≥ tr·∫ª em th√¨ r·∫•t s·∫°ch s·∫Ω."
        },
        {
          "questionNumber": 5,
          "question": "The travelers missed their flight. They arrived at the airport late.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The travelers' (ng∆∞·ªùi). ƒê·ªông t·ª´ l√† 'arrived'.",
          "answerOptions": [
            { "text": "The travelers who arrived at the airport late missed their flight.", "isCorrect": true, "analysis": "D√πng 'who' thay th·∫ø cho ng∆∞·ªùi (travelers) l√†m ch·ªß ng·ªØ cho m·ªánh ƒë·ªÅ quan h·ªá." },
            { "text": "The travelers which arrived at the airport late missed their flight.", "isCorrect": false, "analysis": "Sai do d√πng 'which' (v·∫≠t) cho ng∆∞·ªùi." },
            { "text": "The travelers whose arrived at the airport late missed their flight.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The travelers whom arrived at the airport late missed their flight.", "isCorrect": false, "analysis": "Sai do 'whom' l√† t√¢n ng·ªØ, kh√¥ng th·ªÉ l√†m ch·ªß ng·ªØ cho 'arrived'." }
          ],
          "transQ": "Nh·ªØng du kh√°ch b·ªã l·ª° chuy·∫øn bay. H·ªç ƒë·∫øn s√¢n bay mu·ªôn.",
          "transA": "Nh·ªØng du kh√°ch ng∆∞·ªùi m√† ƒë·∫øn s√¢n bay mu·ªôn ƒë√£ b·ªã l·ª° chuy·∫øn bay."
        },
        {
          "questionNumber": 6,
          "question": "The restaurant serves traditional food. It is near the old market.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The restaurant' (v·∫≠t).",
          "answerOptions": [
            { "text": "The restaurant who is near the old market serves traditional food.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The restaurant which is near the old market serves traditional food.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (restaurant) l√†m ch·ªß ng·ªØ." },
            { "text": "The restaurant whose is near the old market serves traditional food.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The restaurant whom is near the old market serves traditional food.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "Nh√† h√†ng ph·ª•c v·ª• ƒë·ªì ƒÉn truy·ªÅn th·ªëng. N√≥ ·ªü g·∫ßn ch·ª£ c≈©.",
          "transA": "Nh√† h√†ng c√°i m√† ·ªü g·∫ßn ch·ª£ c≈© th√¨ ph·ª•c v·ª• ƒë·ªì ƒÉn truy·ªÅn th·ªëng."
        },
        {
          "questionNumber": 7,
          "question": "Mrs. Smith's passport expired yesterday. She cannot board the plane.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Passport l√† c·ªßa Mrs. Smith (Mrs. Smith's passport). Ch·ªâ s·ª± s·ªü h·ªØu.",
          "answerOptions": [
            { "text": "Mrs. Smith who passport expired yesterday cannot board the plane.", "isCorrect": false, "analysis": "Sai ng·ªØ ph√°p, thi·∫øu t·ª´ ch·ªâ s·ªü h·ªØu." },
            { "text": "Mrs. Smith which passport expired yesterday cannot board the plane.", "isCorrect": false, "analysis": "Sai do 'which' kh√¥ng ch·ªâ s·ªü h·ªØu cho ng∆∞·ªùi." },
            { "text": "Mrs. Smith whose passport expired yesterday cannot board the plane.", "isCorrect": true, "analysis": "D√πng 'whose' thay th·∫ø cho t√≠nh t·ª´ s·ªü h·ªØu (Mrs. Smith's)." },
            { "text": "Mrs. Smith whom passport expired yesterday cannot board the plane.", "isCorrect": false, "analysis": "Sai do 'whom' l√† t√¢n ng·ªØ." }
          ],
          "transQ": "H·ªô chi·∫øu c·ªßa b√† Smith h·∫øt h·∫°n h√¥m qua. B√† ·∫•y kh√¥ng th·ªÉ l√™n m√°y bay.",
          "transA": "B√† Smith, ng∆∞·ªùi m√† h·ªô chi·∫øu ƒë√£ h·∫øt h·∫°n h√¥m qua, kh√¥ng th·ªÉ l√™n m√°y bay."
        },
        {
          "questionNumber": 8,
          "question": "The museum closes at 5 PM. It displays ancient pottery.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The museum' (v·∫≠t). ƒê·ªông t·ª´ 'displays'.",
          "answerOptions": [
            { "text": "The museum who displays ancient pottery closes at 5 PM.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The museum which displays ancient pottery closes at 5 PM.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (museum) l√†m ch·ªß ng·ªØ." },
            { "text": "The museum whose displays ancient pottery closes at 5 PM.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The museum whom displays ancient pottery closes at 5 PM.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "B·∫£o t√†ng ƒë√≥ng c·ª≠a l√∫c 5h chi·ªÅu. N√≥ tr∆∞ng b√†y ƒë·ªì g·ªëm c·ªï.",
          "transA": "B·∫£o t√†ng c√°i m√† tr∆∞ng b√†y ƒë·ªì g·ªëm c·ªï ƒë√≥ng c·ª≠a l√∫c 5 gi·ªù chi·ªÅu."
        },
        {
          "questionNumber": 9,
          "question": "The tourists want to buy souvenirs. They come from France.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung l√† 'The tourists' (ng∆∞·ªùi). ƒê·ªông t·ª´ 'come'.",
          "answerOptions": [
            { "text": "The tourists who come from France want to buy souvenirs.", "isCorrect": true, "analysis": "D√πng 'who' thay th·∫ø cho ng∆∞·ªùi l√†m ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'come'." },
            { "text": "The tourists which come from France want to buy souvenirs.", "isCorrect": false, "analysis": "Sai do d√πng 'which' cho ng∆∞·ªùi." },
            { "text": "The tourists whose come from France want to buy souvenirs.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The tourists whom come from France want to buy souvenirs.", "isCorrect": false, "analysis": "Sai do 'whom' l√† t√¢n ng·ªØ, kh√¥ng th·ªÉ l√†m ch·ªß ng·ªØ." }
          ],
          "transQ": "Nh·ªØng du kh√°ch mu·ªën mua qu√† l∆∞u ni·ªám. H·ªç ƒë·∫øn t·ª´ Ph√°p.",
          "transA": "Nh·ªØng du kh√°ch ng∆∞·ªùi m√† ƒë·∫øn t·ª´ Ph√°p mu·ªën mua qu√† l∆∞u ni·ªám."
        },
        {
          "questionNumber": 10,
          "question": "The travel agency offers cheap tours. Its office is on Main Street.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "VƒÉn ph√≤ng l√† C·ª¶A ƒë·∫°i l√Ω du l·ªãch (Its office). 'Whose' c√≥ th·ªÉ d√πng cho c·∫£ v·∫≠t ƒë·ªÉ ch·ªâ s·ªü h·ªØu.",
          "answerOptions": [
            { "text": "The travel agency who office is on Main Street offers cheap tours.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The travel agency which office is on Main Street offers cheap tours.", "isCorrect": false, "analysis": "Sai do 'which' kh√¥ng ƒë·ª©ng ngay tr∆∞·ªõc danh t·ª´ ƒë·ªÉ ch·ªâ s·ªü h·ªØu." },
            { "text": "The travel agency whose office is on Main Street offers cheap tours.", "isCorrect": true, "analysis": "D√πng 'whose' ƒë·ªÉ ch·ªâ s·ªü h·ªØu cho v·∫≠t (The agency's office). Whose + Noun." },
            { "text": "The travel agency whom office is on Main Street offers cheap tours.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "ƒê·∫°i l√Ω du l·ªãch cung c·∫•p tour gi√° r·∫ª. VƒÉn ph√≤ng c·ªßa n√≥ ·ªü ƒë∆∞·ªùng Main.",
          "transA": "ƒê·∫°i l√Ω du l·ªãch m√† vƒÉn ph√≤ng c·ªßa n√≥ n·∫±m tr√™n ƒë∆∞·ªùng Main th√¨ cung c·∫•p c√°c tour gi√° r·∫ª."
        },
        {
          "questionNumber": 11,
          "question": "The bus broke down yesterday. It takes tourists to the airport.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung 'The bus' (v·∫≠t). ƒê·ªông t·ª´ 'takes'.",
          "answerOptions": [
            { "text": "The bus who takes tourists to the airport broke down yesterday.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The bus which takes tourists to the airport broke down yesterday.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (bus) l√†m ch·ªß ng·ªØ." },
            { "text": "The bus whose takes tourists to the airport broke down yesterday.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The bus whom takes tourists to the airport broke down yesterday.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "Xe bu√Ωt b·ªã h·ªèng h√¥m qua. N√≥ ch·ªü kh√°ch ƒë·∫øn s√¢n bay.",
          "transA": "Chi·∫øc xe bu√Ωt c√°i m√† ch·ªü du kh√°ch ra s√¢n bay ƒë√£ b·ªã h·ªèng h√¥m qua."
        },
        {
          "questionNumber": 12,
          "question": "The family is enjoying their vacation. Their children are playing on the beach.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Tr·∫ª em l√† C·ª¶A gia ƒë√¨nh ƒë√≥ (Their children). Ch·ªâ s·ª± s·ªü h·ªØu.",
          "answerOptions": [
            { "text": "The family who children are playing on the beach is enjoying their vacation.", "isCorrect": false, "analysis": "Sai. Thi·∫øu t·ª´ ch·ªâ s·ªü h·ªØu." },
            { "text": "The family which children are playing on the beach is enjoying their vacation.", "isCorrect": false, "analysis": "Sai. 'which' kh√¥ng ch·ªâ s·ªü h·ªØu." },
            { "text": "The family whose children are playing on the beach is enjoying their vacation.", "isCorrect": true, "analysis": "D√πng 'whose' thay th·∫ø cho t√≠nh t·ª´ s·ªü h·ªØu 'Their'. C·∫•u tr√∫c: whose + children." },
            { "text": "The family whom children are playing on the beach is enjoying their vacation.", "isCorrect": false, "analysis": "Sai. 'whom' l√† t√¢n ng·ªØ." }
          ],
          "transQ": "Gia ƒë√¨nh ƒëang t·∫≠n h∆∞·ªüng k·ª≥ ngh·ªâ. Con c√°i h·ªç ƒëang ch∆°i tr√™n b√£i bi·ªÉn.",
          "transA": "Gia ƒë√¨nh m√† con c√°i c·ªßa h·ªç ƒëang ch∆°i tr√™n b√£i bi·ªÉn th√¨ ƒëang t·∫≠n h∆∞·ªüng k·ª≥ ngh·ªâ."
        },
        {
          "questionNumber": 13,
          "question": "The temple was built in 1850. Many tourists visit it every year.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung 'The temple' (v·∫≠t). ƒê·ªông t·ª´ 'was built'.",
          "answerOptions": [
            { "text": "The temple who was built in 1850 is visited by many tourists every year.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The temple which was built in 1850 is visited by many tourists every year.", "isCorrect": true, "analysis": "D√πng 'which' thay th·∫ø cho v·∫≠t (temple) l√†m ch·ªß ng·ªØ." },
            { "text": "The temple whose was built in 1850 is visited by many tourists every year.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The temple whom was built in 1850 is visited by many tourists every year.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "Ng√¥i ƒë·ªÅn ƒë∆∞·ª£c x√¢y nƒÉm 1850. Nhi·ªÅu du kh√°ch ƒë·∫øn thƒÉm n√≥ h√†ng nƒÉm.",
          "transA": "Ng√¥i ƒë·ªÅn c√°i m√† ƒë∆∞·ª£c x√¢y d·ª±ng nƒÉm 1850 ƒë∆∞·ª£c nhi·ªÅu du kh√°ch gh√© thƒÉm h√†ng nƒÉm."
        },
        {
          "questionNumber": 14,
          "question": "The tourists are waiting for the guide. They booked the morning tour.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "Danh t·ª´ chung 'The tourists' (ng∆∞·ªùi). ƒê·ªông t·ª´ 'booked'.",
          "answerOptions": [
            { "text": "The tourists who booked the morning tour are waiting for the guide.", "isCorrect": true, "analysis": "D√πng 'who' thay th·∫ø cho ng∆∞·ªùi l√†m ch·ªß ng·ªØ cho 'booked'." },
            { "text": "The tourists which booked the morning tour are waiting for the guide.", "isCorrect": false, "analysis": "Sai do d√πng 'which' cho ng∆∞·ªùi." },
            { "text": "The tourists whose booked the morning tour are waiting for the guide.", "isCorrect": false, "analysis": "Sai do 'whose' ch·ªâ s·ªü h·ªØu." },
            { "text": "The tourists whom booked the morning tour are waiting for the guide.", "isCorrect": false, "analysis": "Sai do 'whom' l√† t√¢n ng·ªØ, kh√¥ng th·ªÉ l√†m ch·ªß ng·ªØ." }
          ],
          "transQ": "Nh·ªØng du kh√°ch ƒëang ƒë·ª£i h∆∞·ªõng d·∫´n vi√™n. H·ªç ƒë√£ ƒë·∫∑t tour s√°ng.",
          "transA": "Nh·ªØng du kh√°ch ng∆∞·ªùi m√† ƒë√£ ƒë·∫∑t tour bu·ªïi s√°ng ƒëang ƒë·ª£i h∆∞·ªõng d·∫´n vi√™n."
        },
        {
          "questionNumber": 15,
          "question": "The hotel has a rooftop restaurant. Its view is amazing.\nChoose the best second sentence so that it has a similar meaning to the first one.",
          "hint": "T·∫ßm nh√¨n (view) l√† C·ª¶A kh√°ch s·∫°n (Its view).",
          "answerOptions": [
            { "text": "The hotel who view is amazing has a rooftop restaurant.", "isCorrect": false, "analysis": "Sai do d√πng 'who' cho v·∫≠t." },
            { "text": "The hotel which view is amazing has a rooftop restaurant.", "isCorrect": false, "analysis": "Sai do 'which' kh√¥ng ch·ªâ s·ªü h·ªØu." },
            { "text": "The hotel whose view is amazing has a rooftop restaurant.", "isCorrect": true, "analysis": "D√πng 'whose' ch·ªâ s·ªü h·ªØu cho v·∫≠t (The hotel's view)." },
            { "text": "The hotel whom view is amazing has a rooftop restaurant.", "isCorrect": false, "analysis": "Sai do d√πng 'whom' cho v·∫≠t." }
          ],
          "transQ": "Kh√°ch s·∫°n c√≥ nh√† h√†ng tr√™n t·∫ßng th∆∞·ª£ng. T·∫ßm nh√¨n c·ªßa n√≥ th·∫≠t tuy·ªát.",
          "transA": "Kh√°ch s·∫°n m√† t·∫ßm nh√¨n c·ªßa n√≥ tuy·ªát v·ªùi c√≥ m·ªôt nh√† h√†ng tr√™n s√¢n th∆∞·ª£ng."
        }
      ]
    };

    // --- GAME LOGIC ---
    
    // Audio Context Setup
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound: Sine wave, high pitch, short decay
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            // Error sound: Sawtooth, low pitch, dissonant
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let answered = false;

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function initGame() {
        // Deep copy and shuffle questions
        questions = JSON.parse(JSON.stringify(rawData.questions));
        questions = shuffleArray(questions);
        
        // Shuffle options for each question but keep track of indices if needed (not needed here as we check isCorrect)
        questions.forEach(q => {
            q.answerOptions = shuffleArray(q.answerOptions);
        });

        currentQuestionIndex = 0;
        score = 0;
        updateScore();
        loadQuestion();
    }

    function updateScore() {
        document.getElementById('score-tracker').innerText = `ƒêi·ªÉm: ${score}`;
        const progress = ((currentQuestionIndex) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    function loadQuestion() {
        answered = false;
        const qData = questions[currentQuestionIndex];
        
        // Reset UI
        document.getElementById('explanation-box').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('finish-btn').style.display = 'none';
        
        // Set Content
        document.getElementById('question-text').innerText = `C√¢u ${currentQuestionIndex + 1}: ${qData.question}`;
        document.getElementById('hint-text').innerText = `üí° G·ª£i √Ω: ${qData.hint}`;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        const letters = ['A', 'B', 'C', 'D'];
        qData.answerOptions.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = `<div class="option-letter">${letters[index]}</div><span>${opt.text}</span>`;
            btn.onclick = () => checkAnswer(opt, btn, qData);
            optionsContainer.appendChild(btn);
        });

        updateScore();
    }

    function checkAnswer(selectedOption, btnElement, questionData) {
        if (answered) return;
        answered = true;

        const allButtons = document.querySelectorAll('.option-btn');
        allButtons.forEach(btn => btn.disabled = true);

        if (selectedOption.isCorrect) {
            // Correct
            btnElement.classList.add('correct');
            score++;
            playSound('correct');
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#00D26A', '#00C9A7', '#f1c40f']
            });
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            playSound('wrong');
            // Highlight the correct one
            questionData.answerOptions.forEach((opt, idx) => {
                if (opt.isCorrect) {
                    allButtons[idx].classList.add('correct');
                }
            });
        }

        updateScore();
        showExplanation(questionData);

        // Show Next or Finish button
        if (currentQuestionIndex < questions.length - 1) {
            document.getElementById('next-btn').style.display = 'inline-block';
        } else {
            document.getElementById('finish-btn').style.display = 'inline-block';
        }
    }

    function showExplanation(qData) {
        const expBox = document.getElementById('explanation-box');
        const expContent = document.getElementById('explanation-content');
        
        // Construct Explanation HTML strictly following the request
        // 1. D·ªãch c√¢u h·ªèi
        // 2. Ph√¢n t√≠ch 4 ƒë√°p √°n (A, B, C, D)
        // 3. T·∫°i sao ƒë√∫ng/sai
        
        let analysisHTML = '<div style="margin-top:10px;">';
        const letters = ['A', 'B', 'C', 'D'];
        
        qData.answerOptions.forEach((opt, idx) => {
            const statusIcon = opt.isCorrect ? '‚úÖ' : '‚ùå';
            analysisHTML += `<p><strong>${letters[idx]} (${statusIcon}):</strong> ${opt.text}<br><span style="color:#636E72; font-size:0.9em;">‚û° ${opt.analysis}</span></p>`;
        });
        analysisHTML += '</div>';

        expContent.innerHTML = `
            <p><span class="exp-label">1. D·ªãch ƒë·ªÅ b√†i:</span> "${qData.transQ}"</p>
            <p><span class="exp-label">2. Ph√¢n t√≠ch ƒë√°p √°n:</span></p>
            ${analysisHTML}
            <div style="margin-top:15px; border-top: 1px dashed #ccc; padding-top:10px;">
                <p><span class="exp-label">üéØ ƒê√°p √°n ƒë√∫ng:</span> "${qData.transA}"</p>
                <p><strong>T·∫°i sao ƒë√∫ng?</strong> Ta d√πng ƒë·∫°i t·ª´ quan h·ªá ph√π h·ª£p v·ªõi danh t·ª´ ƒë·ª©ng tr∆∞·ªõc (Ng∆∞·ªùi/V·∫≠t/S·ªü h·ªØu) v√† vai tr√≤ ng·ªØ ph√°p c·ªßa n√≥ trong m·ªánh ƒë·ªÅ quan h·ªá (Ch·ªß ng·ªØ/T√¢n ng·ªØ).</p>
            </div>
        `;
        
        expBox.style.display = 'block';
    }

    function nextQuestion() {
        currentQuestionIndex++;
        loadQuestion();
        // Smooth scroll to top of game container for mobile
        document.querySelector('.game-container').scrollIntoView({ behavior: 'smooth' });
    }

    function showResults() {
        const modal = document.getElementById('result-modal');
        const finalScore = document.getElementById('final-score');
        const feedback = document.getElementById('final-feedback');
        
        finalScore.innerText = `${score}/${questions.length}`;
        
        const percentage = (score / questions.length) * 100;
        if (percentage === 100) {
            feedback.innerText = "üåü Xu·∫•t s·∫Øc! Em l√† thi√™n t√†i ng·ªØ ph√°p! üåü";
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
        } else if (percentage >= 80) {
            feedback.innerText = "üëè Gi·ªèi l·∫Øm! Em n·∫Øm b√†i r·∫•t ch·∫Øc!";
        } else if (percentage >= 50) {
            feedback.innerText = "üí™ C·ªë g·∫Øng l√™n! Em ƒë√£ hi·ªÉu b√†i nh∆∞ng c·∫ßn c·∫©n th·∫≠n h∆°n.";
        } else {
            feedback.innerText = "üìö C·∫ßn √¥n l·∫°i b√†i nh√©! ƒê·ª´ng n·∫£n ch√≠!";
        }
        
        modal.style.display = 'flex';
        playSound('correct');
    }

    // Start
    window.onload = initGame;

</script>

</body>
</html>
