<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Gi·ªõi T·ª´ - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #eef2f5;
            background-image: radial-gradient(#8854C0 1.5px, transparent 1.5px), radial-gradient(#00C9A7 1.5px, #eef2f5 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            margin: 0;
            padding: 20px;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 4px solid var(--primary-pink);
        }

        h1 {
            color: var(--primary-pink);
            margin: 0;
            font-weight: 800;
            font-size: 2.5rem;
            text-shadow: 2px 2px 0px #eee;
        }

        .subtitle {
            color: var(--primary-teal);
            font-weight: 700;
            font-size: 1.2rem;
            margin-top: 5px;
        }

        /* Question Card */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border-bottom: 6px solid #e0e0e0;
            position: relative;
            transition: transform 0.3s;
        }

        .question-number {
            display: inline-block;
            background: var(--primary-pink);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.5;
            color: #2d3436;
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-bottom: 5px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #555;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            position: relative;
            font-family: 'Nunito', sans-serif;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--primary-teal);
            color: var(--primary-teal);
            background: #f0fffa;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }

        /* Correct/Wrong Styles */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b85c;
            border-bottom-color: #008f47;
            transform: scale(1.02);
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #e63b49;
            border-bottom-color: #c42e3a;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
        }

        /* Explanation Section */
        .explanation-box {
            margin-top: 20px;
            background: #fff8e1;
            border: 2px dashed #f6b93b;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: #e58e26;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .expl-content p {
            margin: 5px 0;
            line-height: 1.6;
            font-size: 1rem;
        }

        .vocab-list {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #eee;
        }

        .vocab-item {
            margin-bottom: 5px;
            display: block;
        }

        .vocab-word {
            font-weight: 700;
            color: var(--primary-pink);
        }

        .tag-correct {
            display: inline-block;
            background: #e6fffa;
            color: #00C9A7;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Submit Button */
        .submit-container {
            text-align: center;
            margin-top: 40px;
            padding-bottom: 50px;
        }

        .btn-submit {
            background: var(--primary-pink);
            color: white;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            border-bottom: 6px solid #6c429c;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.4);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .btn-submit:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
        }

        /* Modal Result */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 5px solid var(--primary-teal);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary-pink);
            margin: 20px 0;
        }

        .feedback-text {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 20px;
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Responsive Fixes */
        @media(max-width: 480px){
            .question-text { font-size: 1.1rem; }
            .option-btn { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <header>
            <h1>TEST GI·ªöI T·ª™ (IN/ON/AT)</h1>
            <div class="subtitle">Gi√°o vi√™n: Ms. Mai An ULIS</div>
            <p style="margin-top:10px; color: #666;">Ch·ªçn ƒë√°p √°n ƒë√∫ng nh·∫•t v√† xem gi·∫£i th√≠ch chi ti·∫øt nh√©!</p>
        </header>

        <div id="quiz-container">
            </div>

        <div class="submit-container">
            <button class="btn-submit" onclick="submitQuiz()">N·ªòP B√ÄI</button>
        </div>
    </div>

    <div class="modal-overlay" id="resultModal">
        <div class="modal-content">
            <h2 style="color: var(--primary-teal);">K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
            <div class="score-display" id="finalScore">0/30</div>
            <p class="feedback-text" id="finalFeedback">C·ªë g·∫Øng h∆°n nh√©!</p>
            <button class="btn-submit" onclick="location.reload()" style="font-size: 1rem; padding: 10px 30px;">L√†m l·∫°i</button>
        </div>
    </div>

<script>
    // --- DATABASE: 30 QUESTIONS ---
    const questionBank = [
        {
            q: "I usually wake up ______ 6 a.m.",
            options: ["in", "on", "at", "to"],
            correct: 2, // Index of 'at'
            expl: {
                trans: "T√¥i th∆∞·ªùng th·ª©c d·∫≠y l√∫c 6 gi·ªù s√°ng.",
                vocab: [
                    "A. in: d√πng cho th√°ng, nƒÉm, m√πa, bu·ªïi.",
                    "B. on: d√πng cho ng√†y, th·ª©.",
                    "C. at: d√πng cho gi·ªù c·ª• th·ªÉ.",
                    "D. to: ƒë·∫øn (h∆∞·ªõng ƒëi)."
                ],
                whyCorrect: "D√πng 'at' tr∆∞·ªõc gi·ªù c·ª• th·ªÉ (6 a.m, 7 o'clock).",
                whyWrong: "C√°c ƒë√°p √°n kh√°c kh√¥ng ƒëi v·ªõi gi·ªù."
            }
        },
        {
            q: "My birthday is ______ May.",
            options: ["in", "on", "at", "from"],
            correct: 0,
            expl: {
                trans: "Sinh nh·∫≠t c·ªßa t√¥i v√†o th√°ng NƒÉm.",
                vocab: [
                    "A. in: trong (th√°ng, nƒÉm).",
                    "B. on: v√†o (ng√†y c·ª• th·ªÉ).",
                    "C. at: t·∫°i (gi·ªù, ƒë·ªãa ƒëi·ªÉm).",
                    "D. from: t·ª´."
                ],
                whyCorrect: "D√πng 'in' tr∆∞·ªõc th√°ng (in May, in June).",
                whyWrong: "'On' ph·∫£i ƒëi k√®m ng√†y (VD: on May 5th). 'At' kh√¥ng d√πng cho th√°ng."
            }
        },
        {
            q: "We have English classes ______ Mondays.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i c√≥ ti·∫øt ti·∫øng Anh v√†o c√°c ng√†y th·ª© Hai.",
                vocab: [
                    "A. in: trong.",
                    "B. at: l√∫c.",
                    "C. on: v√†o (ng√†y/th·ª©).",
                    "D. of: c·ªßa."
                ],
                whyCorrect: "D√πng 'on' tr∆∞·ªõc c√°c th·ª© trong tu·∫ßn (on Monday, on Sundays).",
                whyWrong: "'In' d√πng cho bu·ªïi/th√°ng/nƒÉm. 'At' d√πng cho gi·ªù."
            }
        },
        {
            q: "It is very hot ______ summer.",
            options: ["on", "in", "at", "to"],
            correct: 1,
            expl: {
                trans: "Tr·ªùi r·∫•t n√≥ng v√†o m√πa h√®.",
                vocab: [
                    "A. on: tr√™n/v√†o ng√†y.",
                    "B. in: trong/v√†o m√πa.",
                    "C. at: t·∫°i.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "D√πng 'in' tr∆∞·ªõc c√°c m√πa trong nƒÉm (in summer, in winter).",
                whyWrong: "'On' d√πng cho ng√†y. 'At' d√πng cho th·ªùi ƒëi·ªÉm ng·∫Øn."
            }
        },
        {
            q: "See you ______ the morning!",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "H·∫πn g·∫∑p l·∫°i b·∫°n v√†o bu·ªïi s√°ng!",
                vocab: [
                    "A. at: l√∫c.",
                    "B. on: tr√™n.",
                    "C. in: trong.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "C·ª•m c·ªë ƒë·ªãnh: 'in the morning', 'in the afternoon', 'in the evening'.",
                whyWrong: "Kh√¥ng d√πng 'at' hay 'on' cho c√°c bu·ªïi n√†y (tr·ª´ khi c√≥ th·ª© ƒëi k√®m)."
            }
        },
        {
            q: "The party is ______ 19th May, 2025.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "B·ªØa ti·ªác di·ªÖn ra v√†o ng√†y 19 th√°ng 5 nƒÉm 2025.",
                vocab: [
                    "A. in (prep): d√πng cho th√°ng/nƒÉm.",
                    "B. at (prep): d√πng cho gi·ªù.",
                    "C. on (prep): d√πng cho ng√†y c·ª• th·ªÉ.",
                    "D. of (prep): c·ªßa."
                ],
                whyCorrect: "ƒê√¢y l√† ng√†y c·ª• th·ªÉ (ng√†y + th√°ng + nƒÉm) n√™n b·∫Øt bu·ªôc d√πng 'on'.",
                whyWrong: "N·∫øu ch·ªâ c√≥ th√°ng/nƒÉm m·ªõi d√πng 'in'. C√≥ ng√†y d√≠nh v√†o l√† ph·∫£i d√πng 'on'."
            }
        },
        {
            q: "She likes reading books ______ night.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "C√¥ ·∫•y th√≠ch ƒë·ªçc s√°ch v√†o ban ƒë√™m.",
                vocab: [
                    "A. in: trong.",
                    "B. on: tr√™n.",
                    "C. at: v√†o l√∫c.",
                    "D. to: ƒë·∫øn."
                ],
                whyCorrect: "C·ª•m c·ªë ƒë·ªãnh: 'at night' (v√†o ban ƒë√™m).",
                whyWrong: "Ta n√≥i 'in the morning' nh∆∞ng l·∫°i n√≥i 'at night' (ngo·∫°i l·ªá)."
            }
        },
        {
            q: "They were born ______ 2010.",
            options: ["at", "on", "in", "with"],
            correct: 2,
            expl: {
                trans: "H·ªç sinh nƒÉm 2010.",
                vocab: [
                    "A. at: l√∫c.",
                    "B. on: v√†o ng√†y.",
                    "C. in: v√†o nƒÉm.",
                    "D. with: v·ªõi."
                ],
                whyCorrect: "D√πng 'in' tr∆∞·ªõc c√°c nƒÉm (in 1990, in 2024).",
                whyWrong: "'On' d√πng cho ng√†y. 'At' d√πng cho gi·ªù."
            }
        },
        {
            q: "Are you free ______ the moment?",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "B·∫°n c√≥ r·∫£nh ngay l√∫c n√†y kh√¥ng?",
                vocab: [
                    "A. in: trong.",
                    "B. on: tr√™n.",
                    "C. at: t·∫°i.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'at the moment' = now (ngay b√¢y gi·ªù).",
                whyWrong: "Kh√¥ng d√πng in/on the moment."
            }
        },
        {
            q: "We usually visit our grandparents ______ Christmas.",
            options: ["in", "on", "at", "from"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th∆∞·ªùng thƒÉm √¥ng b√† v√†o d·ªãp Gi√°ng sinh.",
                vocab: [
                    "A. in: trong.",
                    "B. on: v√†o ng√†y.",
                    "C. at: v√†o d·ªãp.",
                    "D. from: t·ª´."
                ],
                whyCorrect: "D√πng 'at' cho m·ªôt d·ªãp l·ªÖ h·ªôi k√©o d√†i (at Christmas, at Tet).",
                whyWrong: "L∆∞u √Ω: N·∫øu n√≥i v·ªÅ NG√ÄY Gi√°ng sinh c·ª• th·ªÉ th√¨ d√πng 'on Christmas Day'. C√≤n n√≥i v·ªÅ d·ªãp l·ªÖ chung chung th√¨ d√πng 'at Christmas'."
            }
        },
        {
            q: "I will be back ______ a minute.",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "T√¥i s·∫Ω quay l·∫°i trong m·ªôt ph√∫t n·ªØa.",
                vocab: [
                    "A. at: l√∫c.",
                    "B. on: tr√™n.",
                    "C. in: trong (kho·∫£ng th·ªùi gian).",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "C·∫•u tr√∫c: 'in + kho·∫£ng th·ªùi gian' d√πng cho t∆∞∆°ng lai (nghƒ©a l√†: bao l√¢u n·ªØa th√¨ vi·ªác g√¨ x·∫£y ra).",
                whyWrong: "'At a minute' l√† sai ng·ªØ ph√°p trong ng·ªØ c·∫£nh n√†y."
            }
        },
        {
            q: "Don't sit ______ the floor!",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "ƒê·ª´ng ng·ªìi tr√™n s√†n nh√†!",
                vocab: [
                    "A. in: trong.",
                    "B. at: t·∫°i.",
                    "C. on: tr√™n b·ªÅ m·∫∑t.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "D√πng 'on' khi v·∫≠t n·∫±m tr√™n b·ªÅ m·∫∑t c·ªßa c√°i g√¨ ƒë√≥ (on the table, on the floor).",
                whyWrong: "S√†n nh√† l√† b·ªÅ m·∫∑t ph·∫≥ng n√™n kh√¥ng d√πng 'in' (b√™n trong) hay 'at'."
            }
        },
        {
            q: "Someone is standing ______ the door.",
            options: ["on", "in", "at", "of"],
            correct: 2,
            expl: {
                trans: "C√≥ ai ƒë√≥ ƒëang ƒë·ª©ng ·ªü c·ª≠a.",
                vocab: [
                    "A. on: tr√™n.",
                    "B. in: trong.",
                    "C. at: t·∫°i (v·ªã tr√≠ ƒëi·ªÉm).",
                    "D. of: c·ªßa."
                ],
                whyCorrect: "D√πng 'at' ƒë·ªÉ ch·ªâ m·ªôt v·ªã tr√≠/ƒëi·ªÉm c·ª• th·ªÉ (at the door, at the bus stop).",
                whyWrong: "'On the door' nghƒ©a l√† d√°n c√°i g√¨ l√™n c√°nh c·ª≠a. 'In the door' l√† sai."
            }
        },
        {
            q: "We walk ______ the park every morning.",
            options: ["to", "in", "at", "on"],
            correct: 0,
            expl: {
                trans: "Ch√∫ng t√¥i ƒëi b·ªô ƒë·∫øn c√¥ng vi√™n m·ªói s√°ng.",
                vocab: [
                    "A. to (prep): ƒë·∫øn (ch·ªâ h∆∞·ªõng chuy·ªÉn ƒë·ªông).",
                    "B. in (prep): ·ªü trong.",
                    "C. at (prep): t·∫°i.",
                    "D. on (prep): tr√™n."
                ],
                whyCorrect: "ƒê·ªông t·ª´ 'walk' ch·ªâ s·ª± di chuy·ªÉn t·ª´ n∆°i n√†y sang n∆°i kh√°c -> D√πng 'to'.",
                whyWrong: "'Walk in the park' nghƒ©a l√† ƒëi d·∫°o b√™n trong c√¥ng vi√™n (kh√¥ng c√≥ h∆∞·ªõng ƒë·∫øn). Nh∆∞ng c√¢u n√†y th∆∞·ªùng h√†m √Ω ƒëi t·ª´ nh√† T·ªöI c√¥ng vi√™n."
            }
        },
        {
            q: "My house is ______ the left.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Nh√† c·ªßa t√¥i ·ªü b√™n tr√°i.",
                vocab: [
                    "A. in: trong.",
                    "B. at: t·∫°i.",
                    "C. on: tr√™n/b√™n ph√≠a.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "C·ª•m c·ªë ƒë·ªãnh ch·ªâ ph∆∞∆°ng h∆∞·ªõng: 'on the left', 'on the right'.",
                whyWrong: "Kh√¥ng d√πng at/in cho left/right."
            }
        },
        {
            q: "The cat is sleeping ______ the middle of the bed.",
            options: ["in", "on", "at", "to"],
            correct: 0,
            expl: {
                trans: "Con m√®o ƒëang ng·ªß ·ªü gi·ªØa gi∆∞·ªùng.",
                vocab: [
                    "A. in: trong.",
                    "B. on: tr√™n.",
                    "C. at: t·∫°i.",
                    "D. to: t·ªõi."
                ],
                whyCorrect: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'in the middle of' (·ªü gi·ªØa).",
                whyWrong: "D√π gi∆∞·ªùng l√† b·ªÅ m·∫∑t (on), nh∆∞ng c·ª•m 'middle' ƒëi v·ªõi 'in'."
            }
        },
        {
            q: "We are flying to Phu Quoc ______ tomorrow morning.",
            options: ["on", "in", "at", "no preposition"],
            correct: 3,
            expl: {
                trans: "Ch√∫ng t√¥i s·∫Ω bay t·ªõi Ph√∫ Qu·ªëc v√†o s√°ng mai.",
                vocab: [
                    "A. on: d√πng cho th·ª©.",
                    "B. in: d√πng cho bu·ªïi.",
                    "C. at: d√πng cho gi·ªù.",
                    "D. kh√¥ng d√πng gi·ªõi t·ª´."
                ],
                whyCorrect: "Tr∆∞·ªõc 'tomorrow', 'yesterday', 'tonight', 'next week', 'last month'... KH√îNG d√πng gi·ªõi t·ª´ in/on/at.",
                whyWrong: "N√≥i 'in tomorrow morning' l√† sai ng·ªØ ph√°p. Ch·ªâ d√πng 'tomorrow morning'."
            }
        },
        {
            q: "He often plays football ______ Thursday evening.",
            options: ["in", "at", "on", "from"],
            correct: 2,
            expl: {
                trans: "Anh ·∫•y th∆∞·ªùng ƒë√° b√≥ng v√†o t·ªëi th·ª© NƒÉm.",
                vocab: [
                    "A. in: trong.",
                    "B. at: t·∫°i.",
                    "C. on: v√†o.",
                    "D. from: t·ª´."
                ],
                whyCorrect: "Quy t·∫Øc: C·ª© c√≥ TH·ª® (Thursday) d√≠nh v√†o th√¨ d√πng 'ON', d√π ph√≠a sau c√≥ bu·ªïi (evening). -> 'on Thursday evening'.",
                whyWrong: "Ch·ªâ d√πng 'in the evening' khi kh√¥ng c√≥ th·ª© ƒëi k√®m."
            }
        },
        {
            q: "There is a tree ______ front of my house.",
            options: ["in", "on", "at", "to"],
            correct: 0,
            expl: {
                trans: "C√≥ m·ªôt c√°i c√¢y ·ªü ph√≠a tr∆∞·ªõc nh√† t√¥i.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'in front of' (·ªü ph√≠a tr∆∞·ªõc).",
                whyWrong: "Kh√¥ng c√≥ 'on front of' hay 'at front of'."
            }
        },
        {
            q: "Write your name ______ the top of the page.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "Vi·∫øt t√™n b·∫°n ·ªü ph√≠a tr√™n c√πng c·ªßa trang gi·∫•y.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'at the top' (·ªü ƒë·ªânh/ƒë·∫ßu) v√† 'at the bottom' (·ªü ƒë√°y/cu·ªëi).",
                whyWrong: "D√πng 'on the top' khi v·∫≠t n·∫±m ƒë√® l√™n ƒë·ªânh v·∫≠t kh√°c (VD: on top of the mountain), nh∆∞ng v·ªõi trang gi·∫•y th∆∞·ªùng d√πng 'at'."
            }
        },
        {
            q: "Did you go to Hue ______ 2018?",
            options: ["on", "in", "at", "to"],
            correct: 1,
            expl: {
                trans: "B·∫°n ƒë√£ ƒëi Hu·∫ø v√†o nƒÉm 2018 ph·∫£i kh√¥ng?",
                vocab: [
                    "A. on", "B. in", "C. at", "D. to"
                ],
                whyCorrect: "NƒÉm (2018) ƒëi v·ªõi gi·ªõi t·ª´ 'in'.",
                whyWrong: "On + ng√†y, At + gi·ªù."
            }
        },
        {
            q: "We like walking ______ the beach.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th√≠ch ƒëi d·∫°o tr√™n b√£i bi·ªÉn.",
                vocab: [
                    "A. in", "B. at", "C. on", "D. to"
                ],
                whyCorrect: "C·ª•m t·ª´: 'on the beach' (tr√™n b√£i bi·ªÉn).",
                whyWrong: "'In the beach' nghƒ©a l√† b·ªã ch√¥n d∆∞·ªõi c√°t. 'At the beach' nghƒ©a l√† ·ªü khu v·ª±c b√£i bi·ªÉn (chung chung), nh∆∞ng 'walking' th∆∞·ªùng d√πng 'on'."
            }
        },
        {
            q: "The shop closes ______ midnight.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "C·ª≠a h√†ng ƒë√≥ng c·ª≠a l√∫c n·ª≠a ƒë√™m.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "'Midnight' (n·ª≠a ƒë√™m) l√† m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ -> D√πng 'at' (at midnight, at noon).",
                whyWrong: "In d√πng cho bu·ªïi d√†i. On d√πng cho ng√†y."
            }
        },
        {
            q: "My father goes to work ______ bus.",
            options: ["in", "on", "by", "at"],
            correct: 2,
            expl: {
                trans: "B·ªë t√¥i ƒëi l√†m b·∫±ng xe bu√Ωt.",
                vocab: [
                    "A. in", "B. on", "C. by", "D. at"
                ],
                whyCorrect: "Ch·ªâ ph∆∞∆°ng ti·ªán ƒëi l·∫°i: 'by + ph∆∞∆°ng ti·ªán' (by bus, by car, by plane).",
                whyWrong: "N·∫øu d√πng 'on' ph·∫£i l√† 'on the bus'. ·ªû ƒë√¢y kh√¥ng c√≥ 'the' n√™n d√πng 'by'."
            }
        },
        {
            q: "We will meet ______ lunchtime.",
            options: ["in", "on", "at", "of"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng ta s·∫Ω g·∫∑p nhau v√†o gi·ªù ƒÉn tr∆∞a.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. of"
                ],
                whyCorrect: "Lunchtime l√† m·ªôt th·ªùi ƒëi·ªÉm x√°c ƒë·ªãnh trong ng√†y -> D√πng 'at lunchtime'.",
                whyWrong: "Kh√¥ng d√πng in/on lunchtime."
            }
        },
        {
            q: "I received a gift ______ my birthday.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "T√¥i nh·∫≠n ƒë∆∞·ª£c m·ªôt m√≥n qu√† v√†o ng√†y sinh nh·∫≠t.",
                vocab: [
                    "A. in", "B. at", "C. on", "D. to"
                ],
                whyCorrect: "Birthday c√≥ ch·ªØ 'day' (ng√†y) -> D√πng 'on' (on my birthday).",
                whyWrong: "At d√πng cho ti·ªác (at the party). In d√πng cho th√°ng."
            }
        },
        {
            q: "Can you come ______ my house?",
            options: ["in", "on", "at", "to"],
            correct: 3,
            expl: {
                trans: "B·∫°n c√≥ th·ªÉ ƒë·∫øn nh√† t√¥i kh√¥ng?",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "ƒê·ªông t·ª´ 'come' ch·ªâ s·ª± di chuy·ªÉn h∆∞·ªõng t·ªõi ƒë√¢u -> D√πng 'to' (come to my house).",
                whyWrong: "Come in: ƒëi v√†o trong. Nh∆∞ng 'come to' ph·ªï bi·∫øn h∆°n khi m·ªùi ai ƒë·∫øn ƒë·ªãa ƒëi·ªÉm."
            }
        },
        {
            q: "We live ______ the 21st century.",
            options: ["in", "on", "at", "to"],
            correct: 0,
            expl: {
                trans: "Ch√∫ng ta ƒëang s·ªëng ·ªü th·∫ø k·ª∑ 21.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "Th·∫ø k·ª∑ (century) l√† kho·∫£ng th·ªùi gian d√†i -> D√πng 'in' (in the 21st century).",
                whyWrong: "On d√πng cho ng√†y. At d√πng cho ƒëi·ªÉm th·ªùi gian."
            }
        },
        {
            q: "The meeting starts ______ 20 minutes.",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "Cu·ªôc h·ªçp s·∫Ω b·∫Øt ƒë·∫ßu trong 20 ph√∫t n·ªØa.",
                vocab: [
                    "A. at", "B. on", "C. in", "D. to"
                ],
                whyCorrect: "D√πng 'in' + kho·∫£ng th·ªùi gian ƒë·ªÉ ch·ªâ t∆∞∆°ng lai (bao l√¢u n·ªØa s·∫Ω x·∫£y ra).",
                whyWrong: "At 20 minutes l√† sai (ph·∫£i l√† At 8:00...)."
            }
        },
        {
            q: "They arrived ______ Paris last week.",
            options: ["in", "on", "at", "to"],
            correct: 0,
            expl: {
                trans: "H·ªç ƒë√£ ƒë·∫øn Paris tu·∫ßn tr∆∞·ªõc.",
                vocab: [
                    "A. in", "B. on", "C. at", "D. to"
                ],
                whyCorrect: "Arrive in: ƒê·∫øn th√†nh ph·ªë/qu·ªëc gia l·ªõn (arrive in Paris, in Vietnam).",
                whyWrong: "Arrive at: ƒê·∫øn ƒë·ªãa ƒëi·ªÉm nh·ªè (s√¢n bay, nh√† ga). Kh√¥ng d√πng Arrive to."
            }
        }
    ];

    // --- GAME LOGIC ---

    let shuffledQuestions = [];
    let currentScore = 0;
    let answeredCount = 0;

    // Shuffle Array (Fisher-Yates)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Initialize Quiz
    function initQuiz() {
        shuffledQuestions = shuffleArray([...questionBank]);
        const container = document.getElementById('quiz-container');
        container.innerHTML = '';

        shuffledQuestions.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.id = `card-${index}`;

            // Create Options HTML
            let optionsHtml = '';
            item.options.forEach((opt, optIndex) => {
                optionsHtml += `<button class="option-btn" onclick="checkAnswer(${index}, ${optIndex}, this)">${String.fromCharCode(65+optIndex)}. ${opt}</button>`;
            });

            // Explanation HTML
            const explanationHtml = `
                <div class="explanation-box" id="expl-${index}">
                    <div class="explanation-header">
                        <span>üë©‚Äçüè´</span> C√¥ Mai An gi·∫£i th√≠ch:
                    </div>
                    <div class="expl-content">
                        <div class="tag-correct">ƒê√°p √°n ƒë√∫ng: ${item.options[item.correct]}</div>
                        <p><strong>D·ªãch c√¢u:</strong> "${item.expl.trans}"</p>
                        <div class="vocab-list">
                            ${item.expl.vocab.map(v => `<span class="vocab-item">${v}</span>`).join('')}
                        </div>
                        <p style="color: #00D26A;"><strong>‚úÖ T·∫°i sao ƒê√öNG:</strong> ${item.expl.whyCorrect}</p>
                        <p style="color: #FF4757;"><strong>‚ùå T·∫°i sao SAI:</strong> ${item.expl.whyWrong}</p>
                    </div>
                </div>
            `;

            card.innerHTML = `
                <div class="question-number">Question ${index + 1}</div>
                <div class="question-text">${item.q}</div>
                <div class="options-grid">
                    ${optionsHtml}
                </div>
                ${explanationHtml}
            `;
            container.appendChild(card);
        });
    }

    // Check Answer
    function checkAnswer(questionIndex, selectedOptionIndex, btnElement) {
        // Prevent re-clicking
        const card = document.getElementById(`card-${questionIndex}`);
        if (card.classList.contains('answered')) return;
        card.classList.add('answered');

        const questionData = shuffledQuestions[questionIndex];
        const correctIndex = questionData.correct;
        const allButtons = card.querySelectorAll('.option-btn');

        // Logic
        if (selectedOptionIndex === correctIndex) {
            // Correct
            btnElement.classList.add('correct');
            playSound('ding');
            triggerConfetti();
            currentScore++;
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            playSound('buzz');
            // Highlight correct answer
            allButtons[correctIndex].classList.add('correct');
        }

        // Disable all buttons
        allButtons.forEach(btn => btn.disabled = true);

        // Show Explanation
        document.getElementById(`expl-${questionIndex}`).style.display = 'block';
    }

    // Submit Quiz
    function submitQuiz() {
        const modal = document.getElementById('resultModal');
        const scoreDisplay = document.getElementById('finalScore');
        const feedback = document.getElementById('finalFeedback');
        
        // Count answered logic could be added, but prompt says sum score
        scoreDisplay.textContent = `${currentScore} / 30`;
        
        if (currentScore === 30) {
            feedback.textContent = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i ti·∫øng Anh! üåüüèÜ";
            playSound('ding');
        } else if (currentScore >= 20) {
            feedback.textContent = "L√†m t·ªët l·∫Øm! Con n·∫Øm kh√° v·ªØng ki·∫øn th·ª©c r·ªìi! üéâ";
        } else {
            feedback.textContent = "C·ªë g·∫Øng √¥n l·∫°i b√†i m·ªôt ch√∫t n·ªØa nh√©! Con l√†m ƒë∆∞·ª£c m√†! üí™";
        }

        modal.style.display = 'flex';
        triggerConfetti();
    }

    // --- AUDIO SYSTEM (Base64 to avoid external files) ---
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        // Simple oscillator beep synthesizer to avoid large base64 strings
        const osc = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioContext.destination);

        if (type === 'ding') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioContext.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioContext.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            osc.start();
            osc.stop(audioContext.currentTime + 0.5);
        } else {
            // Buzz sound
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioContext.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioContext.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            osc.start();
            osc.stop(audioContext.currentTime + 0.3);
        }
    }

    // --- CONFETTI EFFECT ---
    function triggerConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const particleCount = 100;

        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: ['#ff0', '#f00', '#0f0', '#00f', '#0ff', '#f0f'][Math.floor(Math.random() * 6)],
                size: Math.random() * 10 + 5,
                speedY: Math.random() * 5 + 2,
                speedX: Math.random() * 4 - 2
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let activeParticles = 0;
            particles.forEach(p => {
                p.y += p.speedY;
                p.x += p.speedX;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if (p.y < canvas.height) activeParticles++;
            });

            if (activeParticles > 0) requestAnimationFrame(draw);
            else ctx.clearRect(0,0,canvas.width, canvas.height);
        }
        draw();
    }

    // Start App
    initQuiz();

</script>
</body>
</html>