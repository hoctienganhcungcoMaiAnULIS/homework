<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Gi·ªõi T·ª´ (Level 2) - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-cyan: #00C9A7;
            --accent-yellow: #FFC048;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-pattern: #f3f0ff;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-pattern);
            background-image: radial-gradient(var(--primary-purple) 0.8px, transparent 0.8px), radial-gradient(var(--primary-cyan) 0.8px, var(--bg-pattern) 0.8px);
            background-size: 25px 25px;
            background-position: 0 0, 12.5px 12.5px;
            margin: 0;
            padding: 20px;
            color: #2f3542;
            min-height: 100vh;
        }

        .container {
            max-width: 850px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            background: #fff;
            padding: 30px;
            border-radius: 25px;
            border-bottom: 8px solid var(--primary-purple);
            margin-bottom: 40px;
            box-shadow: 0 10px 25px rgba(136, 84, 192, 0.15);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -10px; left: -10px;
            width: 100%; height: 10px;
            background: repeating-linear-gradient(45deg, var(--primary-cyan), var(--primary-cyan) 10px, white 10px, white 20px);
        }

        h1 {
            color: var(--primary-purple);
            font-weight: 800;
            font-size: 2.2rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .teacher-name {
            background: var(--primary-cyan);
            color: white;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* Question Card */
        .quiz-card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 35px;
            position: relative;
            box-shadow: 0 8px 0 #dfe4ea, 0 15px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid #fff;
        }

        .quiz-card:hover {
            transform: translateY(-5px);
        }

        .q-badge {
            background: var(--accent-yellow);
            color: #574b90;
            font-weight: 800;
            padding: 5px 15px;
            border-radius: 12px;
            position: absolute;
            top: -15px;
            left: 20px;
            box-shadow: 0 4px 0 #e1b12c;
        }

        .question-content {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 15px 0 25px 0;
            line-height: 1.4;
            color: #2f3640;
        }

        .blank-space {
            display: inline-block;
            width: 80px;
            border-bottom: 3px dashed var(--primary-purple);
            margin: 0 5px;
        }

        /* Options Grid */
        .options-wrapper {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .btn-option {
            background: white;
            border: 3px solid #f1f2f6;
            border-radius: 18px;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Quicksand', sans-serif;
            color: #57606f;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            text-align: left;
            padding-left: 20px;
            box-shadow: 0 5px 0 #f1f2f6;
        }

        .btn-option:hover:not(:disabled) {
            border-color: var(--primary-purple);
            color: var(--primary-purple);
            transform: translateY(-2px);
            box-shadow: 0 7px 0 #dcdde1;
        }

        .btn-option:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 0 0;
            border-bottom-width: 3px;
        }

        /* Correct/Wrong States */
        .btn-option.correct {
            background: var(--correct-green);
            color: white;
            border-color: #00b85c;
            box-shadow: 0 5px 0 #008f47;
        }

        .btn-option.wrong {
            background: var(--wrong-red);
            color: white;
            border-color: #e63b49;
            box-shadow: 0 5px 0 #c42e3a;
            animation: shake 0.4s ease-in-out;
        }

        /* Explanations */
        .expl-container {
            margin-top: 25px;
            background: #fffdf0;
            border: 2px dashed var(--accent-yellow);
            border-radius: 20px;
            padding: 20px;
            display: none;
            animation: expandOpen 0.5s;
        }

        .expl-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e67e22;
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .expl-body p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.95rem;
            border: 1px solid #eee;
        }

        .vocab-table th, .vocab-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #f1f2f6;
        }

        .vocab-table th {
            background: var(--primary-purple);
            color: white;
        }

        .reason-box {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
            border-left: 5px solid;
        }

        .reason-correct { border-left-color: var(--correct-green); }
        .reason-wrong { border-left-color: var(--wrong-red); }

        /* Footer / Submit */
        .footer-action {
            text-align: center;
            margin-top: 50px;
            padding-bottom: 60px;
        }

        .submit-btn {
            background: linear-gradient(180deg, var(--primary-purple), #6c429c);
            color: white;
            border: none;
            padding: 18px 60px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(136, 84, 192, 0.4), 0 6px 0 #56347c;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(136, 84, 192, 0.5), 0 8px 0 #56347c;
        }

        .submit-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            border: 5px solid var(--primary-cyan);
            animation: popIn 0.5s;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px) rotate(-3deg); }
            40%, 80% { transform: translateX(6px) rotate(3deg); }
        }

        @keyframes expandOpen {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        #confetti {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            width: 100%; height: 100%;
            z-index: 999;
        }

        @media (max-width: 600px) {
            .options-wrapper { grid-template-columns: 1fr; }
            h1 { font-size: 1.6rem; }
            .question-content { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <canvas id="confetti"></canvas>

    <div class="container">
        <header>
            <h1>Prepositions of Time <br>(In/On/At/To)</h1>
            <div class="teacher-name">Level 2 - Gi√°o vi√™n: Ms. Mai An ULIS</div>
            <p style="margin-top: 15px; color: #7f8c8d;">
                30 c√¢u h·ªèi m·ªõi v·ªõi ng·ªØ c·∫£nh ƒëa d·∫°ng: L·ªãch s·ª≠, Khoa h·ªçc & ƒê·ªùi s·ªëng.<br>
                H√£y xem k·ªπ gi·∫£i th√≠ch ƒë·ªÉ kh√¥ng m·∫Øc b·∫´y nh√©!
            </p>
        </header>

        <div id="quiz-area">
            </div>

        <div class="footer-action">
            <button class="submit-btn" onclick="finishTest()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-purple); margin-top:0;">K·∫æT QU·∫¢ B√ÄI L√ÄM</h2>
            <div style="font-size: 4rem; font-weight: 800; color: var(--primary-cyan); margin: 20px 0;" id="scoreText">0/30</div>
            <p id="commentText" style="font-size: 1.2rem; margin-bottom: 30px; line-height: 1.5;">...</p>
            <button class="submit-btn" onclick="location.reload()" style="font-size: 1.1rem; padding: 15px 40px;">L√†m l·∫°i b√†i thi</button>
        </div>
    </div>

<script>
    // --- D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI (30 C√ÇU M·ªöI) ---
    const questionData = [
        {
            q: "William Shakespeare was born ______ 1564.",
            options: ["on", "at", "in", "to"],
            correct: 2,
            expl: {
                trans: "William Shakespeare ƒë∆∞·ª£c sinh ra v√†o nƒÉm 1564.",
                vocab: [
                    { w: "In", m: "D√πng cho nƒÉm, th·∫ø k·ª∑, giai ƒëo·∫°n d√†i" },
                    { w: "On", m: "D√πng cho ng√†y c·ª• th·ªÉ" },
                    { w: "At", m: "D√πng cho gi·ªù, th·ªùi ƒëi·ªÉm ng·∫Øn" }
                ],
                whyCorrect: "1564 l√† m·ªôt nƒÉm (Year). Quy t·∫Øc: In + NƒÉm.",
                whyWrong: "Kh√¥ng d√πng 'On' hay 'At' cho nƒÉm."
            }
        },
        {
            q: "Humans first walked on the Moon ______ July 20th, 1969.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "Con ng∆∞·ªùi l·∫ßn ƒë·∫ßu ti√™n ƒëi b·ªô tr√™n M·∫∑t TrƒÉng v√†o ng√†y 20 th√°ng 7 nƒÉm 1969.",
                vocab: [
                    { w: "On", m: "V√†o ng√†y..." },
                    { w: "In", m: "V√†o th√°ng/nƒÉm" }
                ],
                whyCorrect: "D√π c√≥ th√°ng v√† nƒÉm, nh∆∞ng c√≥ NG√ÄY (20th) n√™n b·∫Øt bu·ªôc d√πng 'On'. (On + Date).",
                whyWrong: "N·∫øu ch·ªâ c√≥ 'July 1969' th√¨ d√πng 'In'. Nh∆∞ng c√≥ ng√†y c·ª• th·ªÉ th√¨ 'In' l√† sai."
            }
        },
        {
            q: "Dinosaurs lived on Earth ______ the Mesozoic Era.",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "Kh·ªßng long s·ªëng tr√™n Tr√°i ƒê·∫•t v√†o K·ª∑ Nguy√™n Sinh.",
                vocab: [
                    { w: "Era", m: "K·ª∑ nguy√™n (kho·∫£ng th·ªùi gian r·∫•t d√†i)" }
                ],
                whyCorrect: "D√πng 'In' cho c√°c kho·∫£ng th·ªùi gian d√†i, k·ª∑ nguy√™n, th·ªùi ƒë·∫°i (In the Ice Age, In the past).",
                whyWrong: "On/At d√πng cho ƒë∆°n v·ªã th·ªùi gian ng·∫Øn h∆°n."
            }
        },
        {
            q: "What will happen ______ the future?",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "ƒêi·ªÅu g√¨ s·∫Ω x·∫£y ra trong t∆∞∆°ng lai?",
                vocab: [
                    { w: "Future", m: "T∆∞∆°ng lai" }
                ],
                whyCorrect: "C·ª•m c·ªë ƒë·ªãnh: 'In the future' (trong t∆∞∆°ng lai) v√† 'In the past' (trong qu√° kh·ª©).",
                whyWrong: "Kh√¥ng n√≥i 'on the future' hay 'at the future'."
            }
        },
        {
            q: "The rocket will launch ______ exactly 8:00 a.m.",
            options: ["on", "in", "at", "since"],
            correct: 2,
            expl: {
                trans: "T√™n l·ª≠a s·∫Ω ph√≥ng v√†o ƒë√∫ng l√∫c 8 gi·ªù s√°ng.",
                vocab: [
                    { w: "Launch", m: "Ph√≥ng (t√™n l·ª≠a)" },
                    { w: "Exactly", m: "Ch√≠nh x√°c" }
                ],
                whyCorrect: "8:00 a.m l√† gi·ªù c·ª• th·ªÉ -> D√πng 'At'.",
                whyWrong: "In/On kh√¥ng d√πng cho gi·ªù ƒë·ªìng h·ªì."
            }
        },
        {
            q: "We often visit our teachers ______ Teacher's Day.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th∆∞·ªùng thƒÉm th·∫ßy c√¥ v√†o ng√†y Nh√† gi√°o.",
                vocab: [
                    { w: "Teacher's Day", m: "Ng√†y nh√† gi√°o (m·ªôt ng√†y l·ªÖ c·ª• th·ªÉ)" }
                ],
                whyCorrect: "B·∫•t k·ª≥ d·ªãp l·ªÖ n√†o c√≥ ch·ªØ 'DAY' (Teacher's Day, Valentine's Day) ƒë·ªÅu d√πng 'ON'.",
                whyWrong: "Ch·ªâ d√πng 'At' cho d·ªãp l·ªÖ k√©o d√†i kh√¥ng c√≥ ch·ªØ Day (At Christmas, At Tet)."
            }
        },
        {
            q: "He finished the test ______ 45 minutes.",
            options: ["at", "on", "in", "about"],
            correct: 2,
            expl: {
                trans: "Anh ·∫•y ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra trong 45 ph√∫t.",
                vocab: [
                    { w: "In + duration", m: "Trong kho·∫£ng th·ªùi gian (l∆∞·ª£ng th·ªùi gian ƒë·ªÉ l√†m xong vi·ªác g√¨)" }
                ],
                whyCorrect: "D√πng 'In' ƒë·ªÉ ch·ªâ kho·∫£ng th·ªùi gian c·∫ßn thi·∫øt ƒë·ªÉ ho√†n th√†nh m·ªôt vi·ªác g√¨ ƒë√≥.",
                whyWrong: "At/On kh√¥ng mang nghƒ©a 'trong v√≤ng bao l√¢u'."
            }
        },
        {
            q: "We usually have a break ______ noon.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th∆∞·ªùng ngh·ªâ gi·∫£i lao v√†o bu·ªïi tr∆∞a.",
                vocab: [
                    { w: "Noon", m: "Gi·ªØa tr∆∞a (12 gi·ªù tr∆∞a)" }
                ],
                whyCorrect: "Noon l√† m·ªôt m·ªëc th·ªùi gian c·ª• th·ªÉ (nh∆∞ Midnight) -> D√πng 'At noon'.",
                whyWrong: "Sai l·∫ßm ph·ªï bi·∫øn: 'In the noon' l√† sai. (Ch·ªâ c√≥ In the afternoon)."
            }
        },
        {
            q: "I don't go to school ______ Sundays.",
            options: ["in", "at", "on", "from"],
            correct: 2,
            expl: {
                trans: "T√¥i kh√¥ng ƒëi h·ªçc v√†o c√°c ng√†y Ch·ªß Nh·∫≠t.",
                vocab: [
                    { w: "Sunday", m: "Th·ª© trong tu·∫ßn" }
                ],
                whyCorrect: "Th·ª© trong tu·∫ßn lu√¥n ƒëi v·ªõi 'On' (On Sundays, On Mondays).",
                whyWrong: "In/At kh√¥ng d√πng cho th·ª©."
            }
        },
        {
            q: "The weather is beautiful ______ spring.",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "Th·ªùi ti·∫øt r·∫•t ƒë·∫πp v√†o m√πa xu√¢n.",
                vocab: [
                    { w: "Spring", m: "M√πa xu√¢n" }
                ],
                whyCorrect: "M√πa (Spring, Summer, Autumn, Winter) d√πng gi·ªõi t·ª´ 'In'.",
                whyWrong: "On d√πng cho ng√†y, At d√πng cho gi·ªù."
            }
        },
        {
            q: "My father often drinks tea ______ the morning.",
            options: ["at", "on", "in", "to"],
            correct: 2,
            expl: {
                trans: "B·ªë t√¥i th∆∞·ªùng u·ªëng tr√† v√†o bu·ªïi s√°ng.",
                vocab: [
                    { w: "The morning", m: "Bu·ªïi s√°ng" }
                ],
                whyCorrect: "C·ª•m c·ªë ƒë·ªãnh: In the morning / In the afternoon / In the evening.",
                whyWrong: "Tuy·ªát ƒë·ªëi kh√¥ng d√πng 'On the morning' tr·ª´ khi c√≥ th·ª© ƒëi k√®m (On Sunday morning)."
            }
        },
        {
            q: "We will meet ______ Tuesday afternoon.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng ta s·∫Ω g·∫∑p nhau v√†o chi·ªÅu th·ª© Ba.",
                vocab: [
                    { w: "Tuesday", m: "Th·ª© Ba" },
                    { w: "Afternoon", m: "Bu·ªïi chi·ªÅu" }
                ],
                whyCorrect: "Quy t·∫Øc ∆∞u ti√™n: C√≥ TH·ª® (Tuesday) l√† d√πng ON. D√π ph√≠a sau c√≥ bu·ªïi (afternoon). -> 'On Tuesday afternoon'.",
                whyWrong: "Kh√¥ng d√πng 'In Tuesday afternoon'."
            }
        },
        {
            q: "The train leaves ______ 10 minutes.",
            options: ["at", "on", "in", "by"],
            correct: 2,
            expl: {
                trans: "T√†u s·∫Ω r·ªùi ƒëi trong 10 ph√∫t n·ªØa.",
                vocab: [
                    { w: "In + time (future)", m: "Trong bao l√¢u n·ªØa (t√≠nh t·ª´ b√¢y gi·ªù)" }
                ],
                whyCorrect: "Khi n√≥i v·ªÅ t∆∞∆°ng lai, 'In' c√≥ nghƒ©a l√† 'sau/trong v√≤ng'. (In 10 minutes = 10 ph√∫t n·ªØa).",
                whyWrong: "At 10 minutes l√† sai ng·ªØ ph√°p (ph·∫£i l√† At 10 o'clock)."
            }
        },
        {
            q: "Are you busy ______ the moment?",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "B·∫°n c√≥ b·∫≠n ngay l√∫c n√†y kh√¥ng?",
                vocab: [
                    { w: "At the moment", m: "Ngay b√¢y gi·ªù (= Now)" }
                ],
                whyCorrect: "Th√†nh ng·ªØ c·ªë ƒë·ªãnh: At the moment / At present.",
                whyWrong: "Kh√¥ng d√πng in/on."
            }
        },
        {
            q: "We usually go back to our hometown ______ Tet.",
            options: ["on", "in", "at", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th∆∞·ªùng v·ªÅ qu√™ v√†o d·ªãp T·∫øt.",
                vocab: [
                    { w: "Tet", m: "T·∫øt (D·ªãp l·ªÖ h·ªôi k√©o d√†i)" }
                ],
                whyCorrect: "V·ªõi c√°c d·ªãp l·ªÖ h·ªôi (Holiday periods) kh√¥ng c√≥ ch·ªØ 'Day', ta d√πng 'At'. (At Tet, At Christmas, At Easter).",
                whyWrong: "Ch·ªâ d√πng 'On' n·∫øu n√≥i 'On the first day of Tet'."
            }
        },
        {
            q: "They got married ______ 14th February.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "H·ªç k·∫øt h√¥n v√†o ng√†y 14 th√°ng 2.",
                vocab: [
                    { w: "14th February", m: "Ng√†y c·ª• th·ªÉ" }
                ],
                whyCorrect: "Ng√†y th√°ng c·ª• th·ªÉ -> D√πng 'On'.",
                whyWrong: "In d√πng cho th√°ng (In February), nh∆∞ng c√≥ ng√†y 14 th√¨ ph·∫£i d√πng On."
            }
        },
        {
            q: "I watched that movie ______ last night.",
            options: ["at", "on", "in", "no preposition"],
            correct: 3,
            expl: {
                trans: "T√¥i ƒë√£ xem b·ªô phim ƒë√≥ t·ªëi qua.",
                vocab: [
                    { w: "Last night", m: "T·ªëi qua" }
                ],
                whyCorrect: "Tr∆∞·ªõc 'last, next, this, every' KH√îNG d√πng gi·ªõi t·ª´ in/on/at.",
                whyWrong: "N√≥i 'on last night' hay 'at last night' l√† sai."
            }
        },
        {
            q: "Birds start singing ______ sunrise.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "Chim b·∫Øt ƒë·∫ßu h√≥t l√∫c b√¨nh minh.",
                vocab: [
                    { w: "Sunrise", m: "B√¨nh minh" },
                    { w: "Sunset", m: "Ho√†ng h√¥n" }
                ],
                whyCorrect: "Sunrise/Sunset l√† c√°c th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong ng√†y -> D√πng 'At'.",
                whyWrong: "In the morning th√¨ ƒë√∫ng, nh∆∞ng Sunrise ph·∫£i d√πng At."
            }
        },
        {
            q: "We live ______ the 21st century.",
            options: ["on", "at", "in", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng ta s·ªëng ·ªü th·∫ø k·ª∑ 21.",
                vocab: [
                    { w: "Century", m: "Th·∫ø k·ª∑ (100 nƒÉm)" }
                ],
                whyCorrect: "Kho·∫£ng th·ªùi gian d√†i (th·∫ø k·ª∑, thi√™n ni√™n k·ª∑) lu√¥n d√πng 'In'.",
                whyWrong: "On/At d√πng cho ƒë∆°n v·ªã nh·ªè h∆°n."
            }
        },
        {
            q: "Halloween is ______ October 31st.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "Halloween v√†o ng√†y 31 th√°ng 10.",
                vocab: [
                    { w: "October 31st", m: "Ng√†y c·ª• th·ªÉ" }
                ],
                whyCorrect: "Ng√†y c·ª• th·ªÉ trong nƒÉm -> D√πng 'On'.",
                whyWrong: "In October (ƒë√∫ng), nh∆∞ng In October 31st (sai)."
            }
        },
        {
            q: "Can you finish the report ______ Friday?",
            options: ["by", "on", "at", "in"],
            correct: 0,
            expl: {
                trans: "B·∫°n c√≥ th·ªÉ ho√†n th√†nh b√°o c√°o TR∆Ø·ªöC th·ª© S√°u kh√¥ng?",
                vocab: [
                    { w: "By + time", m: "Tr∆∞·ªõc ho·∫∑c mu·ªôn nh·∫•t l√† v√†o l√∫c..." },
                    { w: "On Friday", m: "V√†o ng√†y th·ª© S√°u" }
                ],
                whyCorrect: "Trong ng·ªØ c·∫£nh 'deadline' (h·∫°n ch√≥t), 'By' hay ƒë∆∞·ª£c d√πng nghƒ©a l√† 'tr∆∞·ªõc th·ªùi ƒëi·ªÉm ƒë√≥'. Tuy nhi√™n, n·∫øu ch·ªâ h·ªèi th·ªùi gian ƒë∆°n thu·∫ßn th√¨ 'On' c≈©ng ch·∫•p nh·∫≠n ƒë∆∞·ª£c. Nh∆∞ng ·ªü ƒë√¢y 'By' (tr∆∞·ªõc h·∫°n) l√† t·ª´ ch√≠nh x√°c nh·∫•t cho ng·ªØ c·∫£nh c√¥ng vi·ªác.",
                whyWrong: "Tuy nhi√™n, ƒë·ªÅ b√†i tr·∫Øc nghi·ªám n√†y n·∫øu ƒë√°p √°n 'On' c≈©ng h·ª£p l√Ω (v√†o th·ª© 6). Nh∆∞ng 'By' (tr∆∞·ªõc th·ª© 6) hay h∆°n. Ms Mai An ch·ªçn 'By' l√† ƒë√°p √°n t·ªëi ∆∞u cho ng·ªØ c·∫£nh nh·ªù v·∫£."
            }
        },
        {
            q: "Children often receive lucky money ______ New Year's Eve.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Tr·∫ª em th∆∞·ªùng nh·∫≠n l√¨ x√¨ v√†o ƒë√™m Giao th·ª´a.",
                vocab: [
                    { w: "New Year's Eve", m: "ƒê√™m giao th·ª´a" }
                ],
                whyCorrect: "Eve = Evening (Bu·ªïi t·ªëi tr∆∞·ªõc s·ª± ki·ªán). Nh∆∞ng 'New Year's Eve' ƒë∆∞·ª£c coi l√† m·ªôt NG√ÄY (ho·∫∑c th·ªùi ƒëi·ªÉm ƒë·∫∑c bi·ªát c√≥ ch·ªØ Eve/Day) -> D√πng 'On'.",
                whyWrong: "At New Year (d·ªãp nƒÉm m·ªõi) th√¨ ƒë√∫ng, nh∆∞ng 'On New Year's Eve' l√† c·ª•m chu·∫©n."
            }
        },
        {
            q: "The stars shine brightly ______ night.",
            options: ["in", "on", "at", "to"],
            correct: 2,
            expl: {
                trans: "Nh·ªØng ng√¥i sao s√°ng l·∫•p l√°nh v√†o ban ƒë√™m.",
                vocab: [
                    { w: "Night", m: "Ban ƒë√™m" }
                ],
                whyCorrect: "Ngo·∫°i l·ªá kinh ƒëi·ªÉn: In the morning, In the afternoon... NH∆ØNG 'At night'.",
                whyWrong: "Kh√¥ng d√πng 'In the night' (tr·ª´ vƒÉn th∆° c·ª• th·ªÉ)."
            }
        },
        {
            q: "I will see you ______ next week.",
            options: ["in", "on", "at", "no preposition"],
            correct: 3,
            expl: {
                trans: "T√¥i s·∫Ω g·∫∑p b·∫°n tu·∫ßn sau.",
                vocab: [
                    { w: "Next week", m: "Tu·∫ßn t·ªõi" }
                ],
                whyCorrect: "Tr∆∞·ªõc 'Next' kh√¥ng d√πng gi·ªõi t·ª´.",
                whyWrong: "On next week / In next week l√† l·ªói sai ph·ªï bi·∫øn c·ªßa ng∆∞·ªùi Vi·ªát."
            }
        },
        {
            q: "Lunch is served ______ 11:30 and 1:00.",
            options: ["between", "from", "at", "in"],
            correct: 0,
            expl: {
                trans: "B·ªØa tr∆∞a ƒë∆∞·ª£c ph·ª•c v·ª• GI·ªÆA 11:30 v√† 1:00.",
                vocab: [
                    { w: "Between ... and ...", m: "Gi·ªØa ... v√† ..." }
                ],
                whyCorrect: "C·∫•u tr√∫c: Between [Time 1] and [Time 2].",
                whyWrong: "N·∫øu d√πng 'From' th√¨ ph·∫£i ƒëi v·ªõi 'To' (From 11:30 to 1:00). ·ªû ƒë√¢y c√≥ ch·ªØ 'and' n√™n ph·∫£i ch·ªçn 'Between'."
            }
        },
        {
            q: "The library is closed ______ the weekend.",
            options: ["in", "to", "at", "by"],
            correct: 2,
            expl: {
                trans: "Th∆∞ vi·ªán ƒë√≥ng c·ª≠a v√†o cu·ªëi tu·∫ßn.",
                vocab: [
                    { w: "Weekend", m: "Cu·ªëi tu·∫ßn" }
                ],
                whyCorrect: "Anh-Anh d√πng 'At the weekend'. Anh-M·ªπ d√πng 'On the weekend'. Trong b√†i n√†y ƒë√°p √°n kh√¥ng c√≥ 'On' n√™n ch·ªçn 'At' l√† ch√≠nh x√°c nh·∫•t.",
                whyWrong: "In the weekend l√† sai."
            }
        },
        {
            q: "We moved to this city ______ 2020.",
            options: ["at", "on", "in", "since"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i chuy·ªÉn ƒë·∫øn th√†nh ph·ªë n√†y v√†o nƒÉm 2020.",
                vocab: [
                    { w: "2020", m: "NƒÉm" }
                ],
                whyCorrect: "Tr∆∞·ªõc nƒÉm d√πng 'In'.",
                whyWrong: "Since 2020 d√πng cho th√¨ Ho√†n th√†nh (We have lived here since 2020). C√≤n 'Moved' l√† qu√° kh·ª© ƒë∆°n -> d√πng 'In'."
            }
        },
        {
            q: "The course begins ______ January 15th.",
            options: ["in", "at", "on", "of"],
            correct: 2,
            expl: {
                trans: "Kh√≥a h·ªçc b·∫Øt ƒë·∫ßu v√†o ng√†y 15 th√°ng 1.",
                vocab: [
                    { w: "January 15th", m: "Ng√†y th√°ng" }
                ],
                whyCorrect: "C√≥ ng√†y (15th) -> D√πng 'On'.",
                whyWrong: "Ch·ªâ d√πng 'In' n·∫øu d·ª´ng l·∫°i ·ªü 'January'."
            }
        },
        {
            q: "He runs 5km ______ every morning.",
            options: ["in", "on", "at", "no preposition"],
            correct: 3,
            expl: {
                trans: "Anh ·∫•y ch·∫°y 5km m·ªói s√°ng.",
                vocab: [
                    { w: "Every morning", m: "M·ªói s√°ng" }
                ],
                whyCorrect: "Tr∆∞·ªõc 'Every' kh√¥ng d√πng gi·ªõi t·ª´ th·ªùi gian.",
                whyWrong: "In every morning l√† sai."
            }
        },
        {
            q: "We often watch fireworks ______ New Year's Eve.",
            options: ["in", "at", "on", "to"],
            correct: 2,
            expl: {
                trans: "Ch√∫ng t√¥i th∆∞·ªùng xem ph√°o hoa v√†o ƒë√™m Giao th·ª´a.",
                vocab: [
                    { w: "Fireworks", m: "Ph√°o hoa" },
                    { w: "New Year's Eve", m: "ƒê√™m giao th·ª´a" }
                ],
                whyCorrect: "Nh∆∞ ƒë√£ gi·∫£i th√≠ch, Eve ƒë∆∞·ª£c t√≠nh l√† Ng√†y -> D√πng 'On'.",
                whyWrong: "At d√πng cho th·ªùi ƒëi·ªÉm (At midnight) ho·∫∑c d·ªãp l·ªÖ chung (At Tet)."
            }
        }
    ];

    // --- GAME LOGIC ---
    let currentQ = 0;
    let score = 0;
    let shuffledQuestions = [];

    // √Çm thanh (Base64 Web Audio API)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // X√°o tr·ªôn m·∫£ng
    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    // Render c√¢u h·ªèi
    function initGame() {
        const quizArea = document.getElementById('quiz-area');
        shuffledQuestions = shuffle([...questionData]); // Clone v√† x√°o tr·ªôn

        quizArea.innerHTML = shuffledQuestions.map((item, idx) => {
            const optionsHTML = item.options.map((opt, optIdx) => 
                `<button class="btn-option" onclick="checkAns(this, ${idx}, ${optIdx})">
                    ${String.fromCharCode(65 + optIdx)}. ${opt}
                 </button>`
            ).join('');

            return `
                <div class="quiz-card" id="q-card-${idx}">
                    <div class="q-badge">C√¢u ${idx + 1}</div>
                    <div class="question-content">
                        ${item.q.replace('______', '<span class="blank-space"></span>')}
                    </div>
                    <div class="options-wrapper">
                        ${optionsHTML}
                    </div>
                    <div class="expl-container" id="expl-${idx}">
                        <div class="expl-title">üìù Gi·∫£i th√≠ch chi ti·∫øt:</div>
                        <div class="expl-body">
                            <p><strong>D·ªãch:</strong> <em>"${item.expl.trans}"</em></p>
                            <table class="vocab-table">
                                <thead><tr><th>T·ª´ v·ª±ng/C·∫•u tr√∫c</th><th>Nghƒ©a & C√°ch d√πng</th></tr></thead>
                                <tbody>
                                    ${item.expl.vocab.map(v => `<tr><td>${v.w}</td><td>${v.m}</td></tr>`).join('')}
                                </tbody>
                            </table>
                            <div class="reason-box reason-correct">
                                <strong>‚úÖ T·∫°i sao ƒê√öNG:</strong> ${item.expl.whyCorrect}
                            </div>
                            <div class="reason-box reason-wrong">
                                <strong>‚ùå T·∫°i sao SAI:</strong> ${item.expl.whyWrong}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Ki·ªÉm tra ƒë√°p √°n
    window.checkAns = function(btn, qIdx, optIdx) {
        const card = document.getElementById(`q-card-${qIdx}`);
        // Ch·∫∑n click l·∫°i
        if (card.getAttribute('data-answered')) return;
        card.setAttribute('data-answered', 'true');

        const question = shuffledQuestions[qIdx];
        const buttons = card.querySelectorAll('.btn-option');
        const correctIdx = question.correct;

        if (optIdx === correctIdx) {
            btn.classList.add('correct');
            playSound('correct');
            fireConfetti(btn);
            score++;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Hi·ªán ƒë√°p √°n ƒë√∫ng
            buttons[correctIdx].classList.add('correct');
        }

        // Hi·ªán gi·∫£i th√≠ch
        document.getElementById(`expl-${qIdx}`).style.display = 'block';
    };

    // N·ªôp b√†i
    window.finishTest = function() {
        const modal = document.getElementById('resultModal');
        const scoreText = document.getElementById('scoreText');
        const comment = document.getElementById('commentText');

        scoreText.innerText = `${score} / 30`;
        
        if (score === 30) {
            comment.innerText = "Tuy·ªát ƒë·ªânh! Con ƒë√£ l√†m ch·ªß ho√†n to√†n c√°c gi·ªõi t·ª´ th·ªùi gian! üèÜ";
            launchBigConfetti();
        } else if (score >= 25) {
            comment.innerText = "R·∫•t t·ªët! Con ch·ªâ sai m·ªôt ch√∫t x√≠u th√¥i. C·ªë l√™n! üåü";
        } else if (score >= 15) {
            comment.innerText = "Kh√° ·ªïn! H√£y xem l·∫°i c√°c c√¢u sai ƒë·ªÉ nh·ªõ l√¢u h∆°n nh√©. üí™";
        } else {
            comment.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y ƒë·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch c·ªßa c√¥ Mai An ƒë·ªÉ l√†m l·∫°i t·ªët h∆°n! üìö";
        }

        modal.style.display = 'flex';
    };

    // Hi·ªáu ·ª©ng ph√°o gi·∫•y nh·ªè (khi ch·ªçn ƒë√∫ng)
    function fireConfetti(element) {
        const rect = element.getBoundingClientRect();
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // V·∫Ω ƒë∆°n gi·∫£n v√†i h·∫°t
        for(let i=0; i<30; i++) {
            const x = rect.left + rect.width/2;
            const y = rect.top;
            // (Ph·∫ßn n√†y ch·ªâ l√† placeholder logic, hi·ªáu ·ª©ng th·ª±c t·∫ø n√™n d√πng th∆∞ vi·ªán canvas-confetti n·∫øu mu·ªën x·ªãn h∆°n,
            // nh∆∞ng ƒë·ªÉ single-file ƒë∆°n gi·∫£n ta d√πng CSS animation ho·∫∑c logic JS ƒë∆°n gi·∫£n ·ªü ƒë√¢y)
        }
    }

    // Hi·ªáu ·ª©ng ph√°o gi·∫•y l·ªõn (khi th·∫Øng)
    function launchBigConfetti() {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        let particles = [];
        const colors = ['#f1c40f', '#e74c3c', '#8e44ad', '#3498db', '#2ecc71'];

        for(let i=0; i<300; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: colors[Math.floor(Math.random() * colors.length)],
                size: Math.random() * 10 + 5,
                speedY: Math.random() * 3 + 2
            });
        }

        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            particles.forEach(p => {
                p.y += p.speedY;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            requestAnimationFrame(animate);
        }
        animate();
    }

    // Ch·∫°y game khi load
    initGame();

</script>
</body>
</html>