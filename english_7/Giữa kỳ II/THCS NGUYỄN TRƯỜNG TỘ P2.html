<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - English Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #8854C0; /* H·ªìng t√≠m pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg-color: #F0F3F8;
            --card-bg: #ffffff;
            --text-main: #2C3A47;
            --shadow-color: rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--secondary) 1px, transparent 1px), radial-gradient(var(--primary) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            padding-bottom: 100px; /* Space for sticky footer */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            font-weight: 800;
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        h2.section-title {
            color: var(--secondary);
            font-weight: 700;
            margin-top: 40px;
            background: #fff;
            display: inline-block;
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 0 #ddd;
            border: 2px solid var(--secondary);
        }

        /* CARD STYLE */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px var(--shadow-color);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        /* INPUT FIELDS (GAP FILL) */
        input.gap-input {
            border: none;
            border-bottom: 3px solid #ccc;
            background: #f9f9f9;
            padding: 8px 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            color: var(--primary);
            width: 150px;
            text-align: center;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: bold;
        }

        input.gap-input:focus {
            outline: none;
            border-bottom-color: var(--primary);
            background: #fff;
            transform: scale(1.05);
        }

        input.gap-input.correct {
            border-color: var(--correct);
            background-color: #e0ffeecb;
            color: var(--correct);
        }

        input.gap-input.wrong {
            border-color: var(--wrong);
            background-color: #ffe0e3cb;
            color: var(--wrong);
            animation: shake 0.5s;
        }

        .check-btn-gap {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 0 #5e3a85;
            margin-left: 10px;
        }
        
        .check-btn-gap:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* MULTIPLE CHOICE BUTTONS */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #eee;
            border-bottom: 5px solid #eee;
            padding: 15px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
        }

        .option-btn:hover {
            transform: scale(1.02);
            background-color: #f8f9fa;
        }

        .option-btn:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }

        .option-btn.correct {
            background-color: var(--correct);
            color: white;
            border-color: #00a352;
            border-bottom-color: #00a352;
        }

        .option-btn.wrong {
            background-color: var(--wrong);
            color: white;
            border-color: #c42b39;
            border-bottom-color: #c42b39;
            animation: shake 0.5s;
        }

        /* READING PASSAGE STYLING */
        .reading-passage {
            background: #fff9e6;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--secondary);
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: justify;
        }

        /* GLOSSARY TABLE */
        .glossary-box {
            margin: 20px 0;
            border: 2px solid var(--primary);
            border-radius: 15px;
            overflow: hidden;
            background: white;
        }
        
        .glossary-title {
            background: var(--primary);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
        }

        table.glossary-table {
            width: 100%;
            border-collapse: collapse;
        }

        table.glossary-table th, table.glossary-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        table.glossary-table th {
            background-color: #f4eaff;
            color: var(--primary);
        }

        table.glossary-table tr:last-child td {
            border-bottom: none;
        }

        .academic-tag {
            background: var(--secondary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        /* EXPLANATION BOX */
        .explanation {
            margin-top: 15px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 12px;
            border: 2px dashed #2196f3;
            display: none; /* Hidden by default */
            animation: slideDown 0.3s ease-out;
        }

        .explanation.show {
            display: block;
        }

        .exp-header {
            font-weight: 800;
            color: #1565c0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin: 5px 0;
            font-size: 0.95rem;
        }

        .exp-translation {
            color: #555;
            font-style: italic;
            margin-bottom: 10px;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }

        .exp-correct {
            color: var(--correct);
            font-weight: bold;
        }

        .exp-wrong {
            color: var(--wrong);
        }

        /* STICKY FOOTER */
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            z-index: 1000;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 5px 0 #00917c;
            transition: all 0.2s;
        }

        .submit-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        .score-display {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        /* ANIMATIONS */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* RESPONSIVE */
        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
            .reading-passage {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-graduation-cap"></i> Ms Mai An ULIS</h1>
    <p>B√†i ki·ªÉm tra t∆∞∆°ng t√°c th√¥ng minh - Ch√∫c c√°c con l√†m b√†i th·∫≠t vui!</p>
</header>

<div class="container">

    <h2 class="section-title">II. Verb Tenses</h2>
    <div id="section-ii-container">
        </div>

    <h2 class="section-title">III. Word Forms</h2>
    <div id="section-iii-container">
        </div>

    <h2 class="section-title">IV. Reading: Ewan McGregor</h2>
    <div class="card">
        <div class="reading-passage">
            <strong>Ewan McGregor</strong><br>
            Ewan McGregor was born in Scotland in 1971. He decided to be an actor when he was only nine and he (1) ____________ his first film in 1992. So far in his career he has (2) ____________ in a lot of different types of films, including comedies, musicals, dramas and the Star Wars movies. His uncle, Denis Lawson, was in the original Star War in 1977 and McGregor (3) ____________ in his first Star Wars movie 22 years later. In his career Ewan McGregor has worked with actresses like Cameron Diaz and Nicole Kidman, and his films have won lots of (4) ____________. He loves acting and when he finished (5) ____________ the musical, Moulin Rouge, he said, ‚ÄòI have never been happier to do anything in my life.'
        </div>
        
        <div class="glossary-box">
            <div class="glossary-title"><i class="fas fa-book-open"></i> B·∫£ng T·ª´ V·ª±ng (Vocabulary)</div>
            <table class="glossary-table">
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                <tr><td>Career</td><td>(n)</td><td>S·ª± nghi·ªáp</td></tr>
                <tr><td>Musical</td><td>(n)</td><td>Phim ca nh·∫°c</td></tr>
                <tr><td>Original</td><td>(adj)</td><td>Nguy√™n b·∫£n, g·ªëc</td></tr>
                <tr><td>Actress</td><td>(n)</td><td>N·ªØ di·ªÖn vi√™n</td></tr>
            </table>
        </div>

        <div id="section-iv-questions"></div>
    </div>

    <h2 class="section-title">V. Reading: Traffic Signs</h2>
    <div class="card">
        <div class="reading-passage">
            A traffic sign is a sign put at the (1) ___________ of or above roads to give instruction or provide information to road users. A traffic sign gives information by means of a symbol, or in only 1 or 2 words. Some signs include: stop, no left turn, hospital ahead, no parking, speed limit, one way, and much more.
            <br><br>
            Traffic signs are divided into (2) ___________ basic categories: warning, prohibition, and information signs. A sign within a red triangle will warn you of something. Signs with red circles are mostly (3) ___________. Signs in blue are usually to give directions.
            <br><br>
            Signs are very useful. Without signs and traffic lights there would be many (4) ___________ and arguments on the road. Everyone on the road, regardless of whether you are a pedestrian or a driver, needs to know the meaning of each specific sign and (5) ___________ the sign.
        </div>

        <div class="glossary-box">
            <div class="glossary-title"><i class="fas fa-book-open"></i> B·∫£ng T·ª´ V·ª±ng (Vocabulary)</div>
            <table class="glossary-table">
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                <tr><td>Instruction</td><td>(n)</td><td>S·ª± ch·ªâ d·∫´n</td></tr>
                <tr><td>Symbol</td><td>(n)</td><td>Bi·ªÉu t∆∞·ª£ng</td></tr>
                <tr><td>Category</td><td>(n)</td><td>H·∫°ng m·ª•c / Lo·∫°i</td></tr>
                <tr><td>Pedestrian</td><td>(n)</td><td>Ng∆∞·ªùi ƒëi b·ªô <span class="academic-tag">B1</span></td></tr>
                <tr><td>Regardless of</td><td>(phrase)</td><td>B·∫•t k·ªÉ, kh√¥ng k·ªÉ</td></tr>
            </table>
        </div>

        <div id="section-v-questions"></div>
    </div>

</div>

<div class="sticky-footer">
    <div class="score-display" id="score-display">ƒêi·ªÉm: 0/0</div>
    <button class="submit-btn" onclick="finishTest()">N·ªòP B√ÄI <i class="fas fa-paper-plane"></i></button>
</div>

<audio id="sound-correct" src="data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"></audio>
<script>
    // SOUND EFFECTS (Simple Synth to ensure it works without external files)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // DATA FOR SECTION II (TENSES)
    const sectionII = [
        { q: "My sister (not love) _____________________ romantic movies.", ans: ["doesn't love", "does not love"], id: "ii-1", 
          exp: "<b>D·ªãch:</b> Ch·ªã g√°i t√¥i kh√¥ng th√≠ch phim l√£ng m·∫°n.<br><b>Gi·∫£i th√≠ch:</b> Di·ªÖn t·∫£ m·ªôt s·ªü th√≠ch/th√≥i quen c·ªë ƒë·ªãnh -> D√πng Hi·ªán t·∫°i ƒë∆°n (Simple Present). Ch·ªß ng·ªØ 'My sister' (ng√¥i th·ª© 3 s·ªë √≠t) -> m∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ 'does' + not." },
        { q: "Right now, we (watch) _____________________ a horror movie at the cinema.", ans: ["are watching", "'re watching"], id: "ii-2", 
          exp: "<b>D·ªãch:</b> Ngay b√¢y gi·ªù, ch√∫ng t√¥i ƒëang xem phim kinh d·ªã...<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Right now' (ngay l√∫c n√†y) -> D√πng Hi·ªán t·∫°i ti·∫øp di·ªÖn (Present Continuous): S + am/is/are + V-ing." },
        { q: "Last night, I (see) _____________________ an amazing action film.", ans: ["saw"], id: "ii-3", 
          exp: "<b>D·ªãch:</b> T·ªëi qua, t√¥i ƒë√£ xem m·ªôt b·ªô phim h√†nh ƒë·ªông tuy·ªát v·ªùi.<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Last night' (t·ªëi qua) -> D√πng Qu√° kh·ª© ƒë∆°n (Simple Past). 'See' l√† b·∫•t quy t·∫Øc -> 'Saw'." },
        { q: "Tomorrow, they (go) _____________________ to the film festival in the city.", ans: ["are going", "will go", "'ll go"], id: "ii-4", 
          exp: "<b>D·ªãch:</b> Ng√†y mai, h·ªç s·∫Ω ƒëi d·ª± li√™n hoan phim...<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Tomorrow' -> T∆∞∆°ng lai. C√≥ th·ªÉ d√πng T∆∞∆°ng lai ƒë∆°n (will go) ho·∫∑c Hi·ªán t·∫°i ti·∫øp di·ªÖn mang nghƒ©a t∆∞∆°ng lai (are going) ƒë·ªÅu ch·∫•p nh·∫≠n ƒë∆∞·ª£c." },
        { q: "Look! The bus (come) _____________________.", ans: ["is coming", "'s coming"], id: "ii-5", 
          exp: "<b>D·ªãch:</b> Nh√¨n k√¨a! Xe bu√Ωt ƒëang t·ªõi.<br><b>Gi·∫£i th√≠ch:</b> C√¢u m·ªánh l·ªánh 'Look!' (Nh√¨n k√¨a) -> H√†nh ƒë·ªông ƒëang x·∫£y ra tr∆∞·ªõc m·∫Øt -> Hi·ªán t·∫°i ti·∫øp di·ªÖn." },
        { q: "She (miss) _____________________ the train because she woke up late.", ans: ["missed"], id: "ii-6", 
          exp: "<b>D·ªãch:</b> C√¥ ·∫•y ƒë√£ l·ª° t√†u v√¨ c√¥ ·∫•y d·∫≠y mu·ªôn.<br><b>Gi·∫£i th√≠ch:</b> V·∫ø sau 'woke up' (qu√° kh·ª©) -> V·∫ø tr∆∞·ªõc c≈©ng chia Qu√° kh·ª© ƒë∆°n. Miss -> Missed (c√≥ quy t·∫Øc)." },
        { q: "Every year, people (celebrate) _____________________ the Rio Carnival in Brazil.", ans: ["celebrate"], id: "ii-7", 
          exp: "<b>D·ªãch:</b> H√†ng nƒÉm, m·ªçi ng∆∞·ªùi t·ªï ch·ª©c l·ªÖ h·ªôi Rio...<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Every year' -> S·ª± th·∫≠t hi·ªÉn nhi√™n/l·∫∑p l·∫°i -> Hi·ªán t·∫°i ƒë∆°n. Ch·ªß ng·ªØ 'People' (s·ªë nhi·ªÅu) -> Gi·ªØ nguy√™n ƒë·ªông t·ª´." },
        { q: "Listen! The children (sing) _____________________ Christmas songs?", ans: ["are the children singing", "are singing"], id: "ii-8", 
          exp: "<b>D·ªãch:</b> Nghe k√¨a! C√≥ ph·∫£i l≈© tr·∫ª ƒëang h√°t...?<br><b>Gi·∫£i th√≠ch:</b> 'Listen!' -> ƒêang x·∫£y ra -> Hi·ªán t·∫°i ti·∫øp di·ªÖn. ƒê√¢y l√† c√¢u h·ªèi -> ƒê·∫£o To-be l√™n tr∆∞·ªõc (Are the children singing?). *L∆∞u √Ω: N·∫øu ch·ªâ ƒëi·ªÅn ƒë·ªông t·ª´ th√¨ ch·∫•p nh·∫≠n 'are singing'.*" },
        { q: "Last year, we (take part) _____________________ in the Songkran festival in Thailand.", ans: ["took part"], id: "ii-9", 
          exp: "<b>D·ªãch:</b> NƒÉm ngo√°i, ch√∫ng t√¥i ƒë√£ tham gia...<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Last year' -> Qu√° kh·ª© ƒë∆°n. Take -> Took." },
        { q: "Next month, they (organize) _____________________ a big festival in Japan.", ans: ["will organize", "are organizing", "'ll organize"], id: "ii-10", 
          exp: "<b>D·ªãch:</b> Th√°ng t·ªõi, h·ªç s·∫Ω t·ªï ch·ª©c...<br><b>Gi·∫£i th√≠ch:</b> D·∫•u hi·ªáu 'Next month' -> T∆∞∆°ng lai. D√πng Will organize ho·∫∑c Are organizing." }
    ];

    // DATA FOR SECTION III (WORD FORM)
    const sectionIII = [
        { q: "It is very _______ to ride a motorbike without wearing a helmet. (danger)", ans: ["dangerous"], id: "iii-1", 
          exp: "<b>D·ªãch:</b> R·∫•t <u>nguy hi·ªÉm</u> khi ƒëi xe m√°y kh√¥ng ƒë·ªôi m≈©.<br><b>Gi·∫£i th√≠ch:</b> Sau to-be 'is very' c·∫ßn m·ªôt T√≠nh t·ª´ (Adjective). Danger (n) -> Dangerous (adj)." },
        { q: "The road signs help us drive _______ . (safe)", ans: ["safely"], id: "iii-2", 
          exp: "<b>D·ªãch:</b> Bi·ªÉn b√°o gi√∫p ch√∫ng ta l√°i xe <u>an to√†n</u>.<br><b>Gi·∫£i th√≠ch:</b> Sau ƒë·ªông t·ª´ th∆∞·ªùng 'drive' c·∫ßn m·ªôt Tr·∫°ng t·ª´ (Adverb). Safe (adj) -> Safely (adv)." },
        { q: "My father drives very _______ . (careful)", ans: ["carefully"], id: "iii-3", 
          exp: "<b>D·ªãch:</b> B·ªë t√¥i l√°i xe r·∫•t <u>c·∫©n th·∫≠n</u>.<br><b>Gi·∫£i th√≠ch:</b> Sau ƒë·ªông t·ª´ 'drives' c·∫ßn Tr·∫°ng t·ª´. Careful -> Carefully." },
        { q: "That horror movie was really _______ . (frighten)", ans: ["frightening"], id: "iii-4", 
          exp: "<b>D·ªãch:</b> Phim kinh d·ªã ƒë√≥ th·∫≠t s·ª± <u>ƒë√°ng s·ª£</u>.<br><b>Gi·∫£i th√≠ch:</b> M√¥ t·∫£ t√≠nh ch·∫•t c·ªßa b·ªô phim -> D√πng t√≠nh t·ª´ ƒëu√¥i -ING. Frighten -> Frightening." },
        { q: "The film was so _______ that everyone laughed a lot. (fun)", ans: ["funny"], id: "iii-5", 
          exp: "<b>D·ªãch:</b> Phim qu√° <u>h√†i h∆∞·ªõc</u> khi·∫øn m·ªçi ng∆∞·ªùi c∆∞·ªùi nhi·ªÅu.<br><b>Gi·∫£i th√≠ch:</b> C·∫ßn t√≠nh t·ª´ g√¢y c∆∞·ªùi. Fun (vui), Funny (bu·ªìn c∆∞·ªùi/h√†i h∆∞·ªõc). Ng·ªØ c·∫£nh 'laughed a lot' -> Funny." },
        { q: "The _______ of this movie is very interesting. (direct)", ans: ["director"], id: "iii-6", 
          exp: "<b>D·ªãch:</b> <u>ƒê·∫°o di·ªÖn</u> c·ªßa phim n√†y r·∫•t th√∫ v·ªã.<br><b>Gi·∫£i th√≠ch:</b> Sau 'The' c·∫ßn Danh t·ª´ ch·ªâ ng∆∞·ªùi. Direct -> Director." },
        { q: "The film had a very _______ ending. Many people cried. (emotion)", ans: ["emotional"], id: "iii-7", 
          exp: "<b>D·ªãch:</b> Phim c√≥ c√°i k·∫øt r·∫•t <u>c·∫£m ƒë·ªông</u>.<br><b>Gi·∫£i th√≠ch:</b> B·ªï nghƒ©a cho danh t·ª´ 'ending' c·∫ßn m·ªôt T√≠nh t·ª´. Emotion (n) -> Emotional (adj)." },
        { q: "The festival was very _______ . We enjoyed it a lot. (excite)", ans: ["exciting"], id: "iii-8", 
          exp: "<b>D·ªãch:</b> L·ªÖ h·ªôi r·∫•t <u>s√¥i ƒë·ªông/th√∫ v·ªã</u>.<br><b>Gi·∫£i th√≠ch:</b> M√¥ t·∫£ t√≠nh ch·∫•t s·ª± v·∫≠t (festival) -> T√≠nh t·ª´ ƒëu√¥i -ING. Excite -> Exciting." },
        { q: "There are many _______ activities during Tet holiday. (tradition)", ans: ["traditional"], id: "iii-9", 
          exp: "<b>D·ªãch:</b> C√≥ nhi·ªÅu ho·∫°t ƒë·ªông <u>truy·ªÅn th·ªëng</u>...<br><b>Gi·∫£i th√≠ch:</b> B·ªï nghƒ©a cho 'activities' c·∫ßn T√≠nh t·ª´. Tradition -> Traditional." },
        { q: "The Rio Carnival is one of the most _______ festivals in the world. (fame)", ans: ["famous"], id: "iii-10", 
          exp: "<b>D·ªãch:</b> Rio Carnival l√† m·ªôt trong nh·ªØng l·ªÖ h·ªôi <u>n·ªïi ti·∫øng</u> nh·∫•t.<br><b>Gi·∫£i th√≠ch:</b> C·∫•u tr√∫c so s√°nh nh·∫•t 'most + adj d√†i'. Fame (n) -> Famous (adj)." }
    ];

    // DATA FOR SECTION IV (READING 1)
    const sectionIV = [
        { 
            q: "(1) ____________ his first film in 1992.", 
            options: ["A. made", "B. played", "C. worked", "D. took"], 
            correct: 0, 
            id: "iv-1",
            exp: {
                trans: "√îng ·∫•y ƒë√£ l√†m b·ªô phim ƒë·∫ßu ti√™n nƒÉm 1992.",
                opts: "A. L√†m (phim/b√°nh) | B. Ch∆°i | C. L√†m vi·ªác | D. C·∫ßm/L·∫•y",
                why: "<b>Collocation:</b> 'Make a film' (L√†m m·ªôt b·ªô phim). ƒê√¢y l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh.",
                wrong: "Played (ch∆°i th·ªÉ thao/nh·∫°c c·ª•), Worked (l√†m vi·ªác - kh√¥ng ƒëi tr·ª±c ti·∫øp v·ªõi film nh∆∞ t√¢n ng·ªØ), Took (c·∫ßm/ch·ª•p ·∫£nh)."
            }
        },
        { 
            q: "(2) So far in his career he has ____________ in a lot of different types of films", 
            options: ["A. attended", "B. appeared", "C. took", "D. participated"], 
            correct: 1, 
            id: "iv-2",
            exp: {
                trans: "√îng ·∫•y ƒë√£ xu·∫•t hi·ªán trong r·∫•t nhi·ªÅu th·ªÉ lo·∫°i phim...",
                opts: "A. Tham d·ª± | B. Xu·∫•t hi·ªán | C. C·∫ßm | D. Tham gia",
                why: "<b>C·∫•u tr√∫c:</b> 'Appear in a film' (Xu·∫•t hi·ªán/ƒë√≥ng trong phim).",
                wrong: "Participated ph·∫£i ƒëi v·ªõi 'in' nh∆∞ng nghƒ©a l√† tham gia ho·∫°t ƒë·ªông, √≠t d√πng cho ƒë√≥ng phim. Attended (tham d·ª± cu·ªôc h·ªçp)."
            }
        },
        { 
            q: "(3) McGregor ____________ in his first Star Wars movie 22 years later.", 
            options: ["A. acted", "B. performed", "C. starred", "D. took"], 
            correct: 2, 
            id: "iv-3",
            exp: {
                trans: "McGregor ƒë√≥ng vai ch√≠nh trong phim Star Wars...",
                opts: "A. Di·ªÖn | B. Bi·ªÉu di·ªÖn | C. ƒê√≥ng vai ch√≠nh | D. C·∫ßm",
                why: "<b>T·ª´ v·ª±ng:</b> 'Star in' (ƒê·ªông t·ª´) nghƒ©a l√† ƒë√≥ng vai ch√≠nh. Trong ng·ªØ c·∫£nh nh·∫Øc ƒë·∫øn di·ªÖn vi√™n n·ªïi ti·∫øng.",
                wrong: "Acted in c≈©ng ƒë√∫ng ng·ªØ ph√°p nh∆∞ng 'Starred' hay h∆°n khi n√≥i v·ªÅ vai tr√≤ l·ªõn. Tuy nhi√™n Acted c≈©ng ch·∫•p nh·∫≠n ƒë∆∞·ª£c nh∆∞ng Starred s√°t nghƒ©a 'ng√¥i sao' h∆°n."
            }
        },
        { 
            q: "(4) his films have won lots of ____________.", 
            options: ["A. profit", "B. money", "C. presents", "D. awards"], 
            correct: 3, 
            id: "iv-4",
            exp: {
                trans: "Phim c·ªßa √¥ng ·∫•y th·∫Øng nhi·ªÅu gi·∫£i th∆∞·ªüng.",
                opts: "A. L·ª£i nhu·∫≠n | B. Ti·ªÅn | C. Qu√† t·∫∑ng | D. Gi·∫£i th∆∞·ªüng",
                why: "<b>Collocation:</b> 'Win awards' (Th·∫Øng gi·∫£i th∆∞·ªüng). Phim th√¨ nh·∫≠n gi·∫£i th∆∞·ªüng (Oscars, etc.).",
                wrong: "Profit/Money l√† ti·ªÅn b·∫°c (ki·∫øm ƒë∆∞·ª£c ch·ª© kh√¥ng ph·∫£i 'th·∫Øng' theo nghƒ©a gi·∫£i th∆∞·ªüng danh gi√°)."
            }
        },
        { 
            q: "(5) when he finished ____________ the musical...", 
            options: ["A. filming", "B. film", "C. to film", "D. filmed"], 
            correct: 0, 
            id: "iv-5",
            exp: {
                trans: "Khi √¥ng ·∫•y ho√†n th√†nh vi·ªác quay b·ªô phim ca nh·∫°c...",
                opts: "A. V-ing | B. V-inf | C. To V | D. V-ed",
                why: "<b>Ng·ªØ ph√°p:</b> Sau ƒë·ªông t·ª´ 'Finish' lu√¥n l√† V-ing (Ho√†n th√†nh vi·ªác g√¨ ƒë√≥).",
                wrong: "C√°c d·∫°ng kh√°c sai ng·ªØ ph√°p cƒÉn b·∫£n."
            }
        }
    ];

    // DATA FOR SECTION V (READING 2)
    const sectionV = [
        { 
            q: "(1) A traffic sign is a sign put at the ___________ of or above roads", 
            options: ["A. side", "B. end", "C. centre", "D. beginning"], 
            correct: 0, 
            id: "v-1",
            exp: {
                trans: "Bi·ªÉn b√°o ƒë∆∞·ª£c ƒë·∫∑t ·ªü l·ªÅ ƒë∆∞·ªùng ho·∫∑c ph√≠a tr√™n ƒë∆∞·ªùng.",
                opts: "A. B√™n c·∫°nh/L·ªÅ | B. Cu·ªëi | C. Gi·ªØa | D. ƒê·∫ßu",
                why: "<b>Ng·ªØ c·∫£nh:</b> Bi·ªÉn b√°o th∆∞·ªùng ƒë·∫∑t ·ªü 'side of the road' (l·ªÅ ƒë∆∞·ªùng) ƒë·ªÉ d·ªÖ nh√¨n.",
                wrong: "Centre (gi·ªØa ƒë∆∞·ªùng) s·∫Ω c·∫£n tr·ªü giao th√¥ng."
            }
        },
        { 
            q: "(2) Traffic signs are divided into ___________ basic categories", 
            options: ["A. five", "B. four", "C. three", "D. two"], 
            correct: 2, 
            id: "v-2",
            exp: {
                trans: "Bi·ªÉn b√°o chia l√†m 3 lo·∫°i ch√≠nh...",
                opts: "A. 5 | B. 4 | C. 3 | D. 2",
                why: "<b>D·∫´n ch·ª©ng:</b> B√†i ƒë·ªçc li·ªát k√™: 'warning, prohibition, and information signs'. C√≥ 3 lo·∫°i li·ªát k√™.",
                wrong: "ƒê·∫øm s·ªë l∆∞·ª£ng lo·∫°i ƒë∆∞·ª£c li·ªát k√™ trong b√†i."
            }
        },
        { 
            q: "(3) Signs with red circles are mostly ___________.", 
            options: ["A. prohibited", "B. prohibition", "C. prohibiting", "D. prohibitive"], 
            correct: 1, 
            id: "v-3",
            exp: {
                trans: "Bi·ªÉn b√°o h√¨nh tr√≤n ƒë·ªè h·∫ßu h·∫øt l√† bi·ªÉn c·∫•m.",
                opts: "A. B·ªã c·∫•m (V-ed) | B. S·ª± c·∫•m ƒëo√°n (Danh t·ª´) | C. ƒêang c·∫•m | D. Gi√° c·∫£ ƒë·∫Øt ƒë·ªè (adj)",
                why: "<b>Ng·ªØ ph√°p & Context:</b> C·∫ßn m·ªôt Danh t·ª´/C·ª•m danh t·ª´ ƒë·ªÉ ƒë·ªãnh danh lo·∫°i bi·ªÉn. ·ªû tr√™n ƒë√£ nh·∫Øc ƒë·∫øn 'prohibition signs'. ·ªû ƒë√¢y d√πng danh t·ª´ 'prohibition'.",
                wrong: "Prohibited l√† t√≠nh t·ª´/ƒë·ªông t·ª´. Prohibitive th∆∞·ªùng d√πng cho gi√° c·∫£."
            }
        },
        { 
            q: "(4) Without signs... there would be many ___________ and arguments", 
            options: ["A. users", "B. accidents", "C. vehicles", "D. jams"], 
            correct: 1, 
            id: "v-4",
            exp: {
                trans: "N·∫øu kh√¥ng c√≥ bi·ªÉn b√°o... s·∫Ω c√≥ nhi·ªÅu tai n·∫°n v√† tranh c√£i.",
                opts: "A. Ng∆∞·ªùi d√πng | B. Tai n·∫°n | C. Xe c·ªô | D. T·∫Øc ƒë∆∞·ªùng",
                why: "<b>Logic:</b> Kh√¥ng c√≥ lu·∫≠t l·ªá/bi·ªÉn b√°o -> Nguy hi·ªÉm -> Tai n·∫°n (Accidents). ƒêi k√®m v·ªõi 'arguments' (tranh c√£i) h·ª£p l√Ω nh·∫•t.",
                wrong: "Vehicles (xe c·ªô) th√¨ l√∫c n√†o c≈©ng c√≥, kh√¥ng ph·ª• thu·ªôc bi·ªÉn b√°o."
            }
        },
        { 
            q: "(5) needs to know the meaning... and ___________ the sign.", 
            options: ["A. obey", "B. see", "C. pass", "D. cross"], 
            correct: 0, 
            id: "v-5",
            exp: {
                trans: "...c·∫ßn hi·ªÉu √Ω nghƒ©a v√† tu√¢n th·ªß bi·ªÉn b√°o.",
                opts: "A. Tu√¢n th·ªß | B. Nh√¨n | C. V∆∞·ª£t qua | D. BƒÉng qua",
                why: "<b>Collocation:</b> 'Obey the sign/rules' (Tu√¢n th·ªß bi·ªÉn b√°o/lu·∫≠t). M·ª•c ƒë√≠ch ch√≠nh c·ªßa bi·ªÉn b√°o l√† ƒë·ªÉ tu√¢n theo.",
                wrong: "See (nh√¨n) ch∆∞a ƒë·ªß, ph·∫£i l√†m theo. Pass/Cross kh√¥ng h·ª£p ng·ªØ c·∫£nh tu√¢n th·ªß lu·∫≠t."
            }
        }
    ];

    let totalScore = 0;
    const maxScore = sectionII.length + sectionIII.length + sectionIV.length + sectionV.length;
    let correctCount = 0;

    // RENDER FUNCTIONS

    function renderSectionII() {
        const container = document.getElementById('section-ii-container');
        sectionII.forEach((item, index) => {
            // Replace brackets with input
            const parts = item.q.split('_____________________');
            const html = `
                <div class="card">
                    <div class="question-text">
                        ${index + 1}. ${parts[0]} 
                        <input type="text" class="gap-input" id="${item.id}" placeholder="...">
                        ${parts[1] || ''}
                        <button class="check-btn-gap" onclick="checkGap('${item.id}', ${index}, 'ii')">Check</button>
                    </div>
                    <div id="exp-${item.id}" class="explanation">
                        <div class="exp-header"><i class="fas fa-chalkboard-teacher"></i> C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="exp-content">${item.exp}</div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function renderSectionIII() {
        const container = document.getElementById('section-iii-container');
        sectionIII.forEach((item, index) => {
            const parts = item.q.split('_______');
            const html = `
                <div class="card">
                    <div class="question-text">
                        ${index + 1}. ${parts[0]} 
                        <input type="text" class="gap-input" id="${item.id}" placeholder="...">
                        ${parts[1]}
                        <button class="check-btn-gap" onclick="checkGap('${item.id}', ${index}, 'iii')">Check</button>
                    </div>
                    <div id="exp-${item.id}" class="explanation">
                        <div class="exp-header"><i class="fas fa-chalkboard-teacher"></i> C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="exp-content">${item.exp}</div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    function renderMCQ(sectionData, containerId) {
        const container = document.getElementById(containerId);
        sectionData.forEach((item, index) => {
            let optionsHtml = '';
            item.options.forEach((opt, optIndex) => {
                optionsHtml += `<button class="option-btn" id="btn-${item.id}-${optIndex}" onclick="checkMCQ('${item.id}', ${optIndex}, ${item.correct}, '${containerId}', ${index})">${opt}</button>`;
            });

            const html = `
                <div class="question-block" style="margin-top:20px; border-top: 1px dashed #ccc; padding-top:15px;">
                    <div class="question-text"><strong>Question ${index + 1}:</strong> ${item.q}</div>
                    <div class="options-grid">
                        ${optionsHtml}
                    </div>
                    <div id="exp-${item.id}" class="explanation">
                        <div class="exp-header"><i class="fas fa-chalkboard-teacher"></i> C√¥ Mai An gi·∫£i th√≠ch:</div>
                        <div class="exp-translation">${item.exp.trans}</div>
                        <div class="exp-content">
                            <p>üìù <b>D·ªãch ƒë√°p √°n:</b> ${item.exp.opts}</p>
                            <p class="exp-correct"><i class="fas fa-check-circle"></i> T·∫°i sao ƒë√∫ng: ${item.exp.why}</p>
                            <p class="exp-wrong"><i class="fas fa-times-circle"></i> T·∫°i sao sai: ${item.exp.wrong}</p>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
    }

    // CHECK FUNCTIONS

    function checkGap(id, index, type) {
        const input = document.getElementById(id);
        const expBox = document.getElementById(`exp-${id}`);
        const userVal = input.value.trim().toLowerCase();
        let data;
        if (type === 'ii') data = sectionII[index];
        else data = sectionIII[index];

        const isCorrect = data.ans.some(a => a.toLowerCase() === userVal);

        // Reset classes
        input.classList.remove('correct', 'wrong');
        
        if (isCorrect) {
            input.classList.add('correct');
            playSound('correct');
            triggerConfetti();
            correctCount++;
        } else {
            input.classList.add('wrong');
            playSound('wrong');
        }

        // Always show explanation
        expBox.classList.add('show');
        updateScore();
    }

    function checkMCQ(id, selectedIndex, correctIndex, sectionId, qIndex) {
        // Disable all buttons in this question
        let dataSrc = sectionId === 'section-iv-questions' ? sectionIV : sectionV;
        const correctBtn = document.getElementById(`btn-${id}-${correctIndex}`);
        const selectedBtn = document.getElementById(`btn-${id}-${selectedIndex}`);
        const expBox = document.getElementById(`exp-${id}`);

        // Prevent multiple clicks
        if (selectedBtn.disabled) return;

        // Loop to disable all
        for(let i=0; i<4; i++) {
            document.getElementById(`btn-${id}-${i}`).disabled = true;
        }

        if (selectedIndex === correctIndex) {
            selectedBtn.classList.add('correct');
            playSound('correct');
            triggerConfetti();
            correctCount++;
        } else {
            selectedBtn.classList.add('wrong');
            correctBtn.classList.add('correct'); // Show correct one
            playSound('wrong');
        }

        expBox.classList.add('show');
        updateScore();
    }

    function updateScore() {
        // Since user can retry gaps, this is a simplified counter just for visual feedback
        // A real robust system would track state by ID.
        // For this task, we'll just update the display text.
        document.getElementById('score-display').innerText = `ƒê√£ l√†m: ${document.querySelectorAll('.explanation.show').length}/${maxScore}`;
    }

    function triggerConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#8854C0', '#00C9A7', '#FF4757']
        });
    }

    function finishTest() {
        const attempted = document.querySelectorAll('.explanation.show').length;
        let message = "";
        if (correctCount === maxScore) message = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i ti·∫øng Anh! üåüüèÜ";
        else if (correctCount > maxScore * 0.8) message = "L√†m t·ªët l·∫Øm! Con r·∫•t gi·ªèi! üéâ";
        else message = "C·ªë g·∫Øng h∆°n n·ªØa nh√©! C√¥ tin con l√†m ƒë∆∞·ª£c! üí™";

        alert(`T·ªïng k·∫øt:\nS·ªë c√¢u ƒë√£ l√†m: ${attempted}/${maxScore}\nS·ªë c√¢u ƒë√∫ng (∆∞·ªõc t√≠nh): ${correctCount}\n\n${message}`);
    }

    // INITIALIZE
    window.onload = function() {
        renderSectionII();
        renderSectionIII();
        renderMCQ(sectionIV, 'section-iv-questions');
        renderMCQ(sectionV, 'section-v-questions');
    };

</script>

</body>
</html>
