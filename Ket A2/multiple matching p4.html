<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Quiz - School Cooking Competition</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- DYNAMIC THEME & COLOR PALETTE: COOKING / FOOD --- */
        :root {
            --primary: #FF6B81; /* Watermelon Pink - K√≠ch th√≠ch v·ªã gi√°c, vui nh·ªôn */
            --accent: #FECA57; /* Sunny Orange/Yellow - ·∫§m √°p */
            --secondary: #1DD1A1; /* Mint Green - T∆∞∆°i m√°t (Salad/Vegetables) */
            --correct: #10ac84; /* Xanh l√° ƒë·∫≠m */
            --incorrect: #ee5253; /* ƒê·ªè cam */
            --text-dark: #2f3542;
        }

        /* HI·ªÜU ·ª®NG CHUY·ªÇN M√ÄU N·ªÄN LOANG M∆Ø·ª¢T M√Ä (ANIMATED GRADIENT) */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
            color: var(--text-dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            
            background: linear-gradient(-45deg, #FF6B81, #FECA57, #1DD1A1, #ff9ff3);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* SVG Pattern l∆° l·ª≠ng n·∫±m ƒë√® l√™n n·ªÅn chuy·ªÉn m√†u */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='150' height='150' viewBox='0 0 150 150' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='20' y='30' font-size='26' opacity='0.35'%3Eüçï%3C/text%3E%3Ctext x='100' y='70' font-size='26' opacity='0.35'%3Eüë®‚Äçüç≥%3C/text%3E%3Ctext x='40' y='120' font-size='24' opacity='0.35'%3Eüç∞%3C/text%3E%3Ctext x='110' y='140' font-size='20' opacity='0.35'%3E‚ú®%3C/text%3E%3Ctext x='70' y='40' font-size='24' opacity='0.35'%3Eü•ó%3C/text%3E%3C/svg%3E");
            z-index: -1;
            pointer-events: none;
        }

        /* --- HEADER & TIMER --- */
        .top-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 4px solid var(--primary);
        }

        .teacher-title {
            font-size: 16px;
            font-weight: 800;
            color: var(--incorrect);
            background: #fff0f5;
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px dashed var(--primary);
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #timerDisplay {
            font-size: 26px;
            font-weight: 800;
            color: var(--incorrect);
            background: white;
            padding: 5px 20px;
            border-radius: 15px;
            border: 3px solid var(--accent);
            box-shadow: 0 4px 0 var(--accent);
        }

        .btn-timer {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 800;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 0 #ff4757;
            transition: all 0.1s;
            text-transform: uppercase;
        }
        .btn-timer:active {
            transform: translateY(6px);
            box-shadow: 0 0px 0 #ff4757;
        }

        /* --- SPLIT SCREEN LAYOUT --- */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            padding: 15px;
            gap: 15px;
        }

        .left-panel, .right-panel {
            flex: 1;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 25px;
            padding: 25px;
            overflow-y: auto;
            scroll-behavior: smooth;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid white;
        }

        /* --- READING CONTENT STYLES --- */
        .passage-title {
            font-size: 32px;
            color: var(--incorrect);
            text-align: center;
            margin-top: 0;
            margin-bottom: 25px;
            text-transform: uppercase;
            font-weight: 900;
            text-shadow: 2px 2px 0px var(--accent);
            letter-spacing: 1px;
        }

        .paragraph-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 0 #e1e5ee;
            border: 2px solid #f1f2f6;
            position: relative;
        }

        .paragraph-card h3 {
            margin-top: 0;
            color: var(--correct);
            font-size: 24px;
            border-bottom: 3px dashed var(--accent);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .text-content {
            font-size: 19px;
            line-height: 1.7;
            color: #4a4a4a;
            font-weight: 600;
        }

        .btn-translate {
            background: var(--accent);
            color: #d35400;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 900;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 5px 0 #e58e26;
            transition: all 0.1s;
        }
        .btn-translate:active {
            transform: translateY(5px);
            box-shadow: 0 0px 0 #e58e26;
        }

        .translation-text {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: #fff9e6;
            border-radius: 15px;
            font-size: 17px;
            color: #2f3640;
            border-left: 6px solid var(--primary);
            font-weight: 600;
            line-height: 1.6;
        }

        /* --- GLOSSARY TABLE --- */
        .glossary-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 0 #e1e5ee;
        }
        .glossary-container h3 {
            color: var(--primary);
            text-align: center;
            font-size: 22px;
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 15px;
            border-bottom: 2px solid #f1f2f6;
            text-align: left;
            font-size: 17px;
            font-weight: 600;
        }
        th {
            background: var(--primary);
            color: white;
            border-radius: 10px 10px 0 0;
        }
        tr:hover { background: #fff0f5; }

        /* --- QUIZ SECTION STYLES --- */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 0 #dfe4ea;
            border: 3px solid #f1f2f6;
            transition: all 0.3s;
        }

        .question-text {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 25px;
            color: #2d3436;
            line-height: 1.4;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            background: #f8f9fa;
            border: 3px solid #e9ecef;
            padding: 18px 25px;
            font-size: 20px;
            font-weight: 700;
            border-radius: 18px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 0 #ced4da;
            color: #495057;
            display: flex;
            align-items: center;
        }

        .option-btn .opt-label {
            display: inline-block;
            width: 35px;
            height: 35px;
            line-height: 35px;
            background: #e9ecef;
            border-radius: 50%;
            text-align: center;
            margin-right: 15px;
            color: var(--primary);
            font-weight: 900;
        }

        .option-btn:hover:not(:disabled) {
            transform: scale(1.03) translateY(-4px);
            background: #fff0f5;
            border-color: var(--primary);
            box-shadow: 0 10px 0 var(--primary);
            color: #d63031;
        }
        .option-btn:hover:not(:disabled) .opt-label {
            background: var(--primary);
            color: white;
        }

        .option-btn.correct {
            background: var(--correct) !important;
            color: white !important;
            border-color: #05c46b !important;
            box-shadow: 0 6px 0 #05c46b !important;
        }
        .option-btn.correct .opt-label { background: white; color: var(--correct); }

        .option-btn.wrong {
            background: var(--incorrect) !important;
            color: white !important;
            border-color: #ff3f34 !important;
            box-shadow: 0 6px 0 #ff3f34 !important;
        }
        .option-btn.wrong .opt-label { background: white; color: var(--incorrect); }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        /* Detailed Explanation Box */
        .explanation-box {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background: #f0fdf4;
            border-radius: 15px;
            border: 3px solid var(--correct);
            font-size: 17px;
            line-height: 1.6;
            color: #166534;
            animation: slideDown 0.4s ease;
        }
        
        .exp-title {
            font-weight: 800;
            color: var(--correct);
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px dashed #bbf7d0;
            padding-bottom: 10px;
        }

        .exp-quote {
            background: white;
            padding: 15px;
            border-radius: 12px;
            font-style: italic;
            margin: 15px 0;
            border-left: 5px solid var(--accent);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            color: #4b5563;
        }

        /* --- ANIMATIONS --- */
        @keyframes slideDown { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-3px, 0, 0); }
            20%, 80% { transform: translate3d(5px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        /* --- CONFETTI CANVAS --- */
        #confettiCanvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
        }

        /* --- SUBMIT & MODAL --- */
        .submit-btn-container { text-align: center; margin: 40px 0; }
        .btn-submit {
            background: var(--primary);
            color: white;
            font-size: 26px;
            font-weight: 900;
            padding: 18px 50px;
            border: 4px solid white;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 10px 0 #ff4757, 0 15px 20px rgba(0,0,0,0.2);
            transition: all 0.2s;
            text-transform: uppercase;
            font-family: 'Quicksand', sans-serif;
        }
        .btn-submit:hover { transform: scale(1.08) rotate(-2deg); }
        .btn-submit:active { transform: translateY(10px); box-shadow: 0 0px 0 #ff4757; }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center;
            z-index: 10000; backdrop-filter: blur(8px);
        }
        .modal-content {
            background: white; padding: 50px; border-radius: 30px;
            text-align: center; max-width: 450px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            animation: bounceIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--primary);
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .score-text { font-size: 60px; font-weight: 900; color: var(--primary); margin: 20px 0; text-shadow: 2px 2px 0 var(--accent); }
        .feedback-text { font-size: 22px; font-weight: 800; color: #636e72; line-height: 1.5; }
        .btn-close-modal {
            margin-top: 30px; background: var(--secondary); color: #2d3436;
            border: none; padding: 15px 35px; font-size: 20px; border-radius: 20px;
            font-weight: 900; cursor: pointer; box-shadow: 0 8px 0 #05c46b;
            font-family: 'Quicksand', sans-serif; transition: 0.2s;
        }
        .btn-close-modal:hover { transform: scale(1.05); }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #f1f2f6; border-radius: 10px; margin: 10px; }
        ::-webkit-scrollbar-thumb { background: #b2bec3; border-radius: 10px; border: 3px solid #f1f2f6; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
    </style>
</head>
<body>

    <canvas id="confettiCanvas"></canvas>

    <div class="top-bar">
        <div class="teacher-title">üë©‚Äçüè´ Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <div class="timer-container">
            <div id="timerDisplay">10:00</div>
            <button class="btn-timer" id="btnTimerToggle" onclick="toggleTimer()">B·∫ÆT ƒê·∫¶U T√çNH GI·ªú</button>
        </div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <h1 class="passage-title">School Cooking Competition</h1>
            
            <div class="paragraph-card">
                <h3>üçï Alice</h3>
                <div class="text-content">
                    Our class has just won a prize in a cooking competition ‚Äì and we‚Äôre going to be on the local TV news tonight. The judges liked our pizzas because they were delicious and we also made pasta with sauce and dessert for the children in our school for lunch yesterday. Our teacher is married to a chef who helped us with our main course. We‚Äôre planning to bake some cakes tomorrow and sell them. We want to get enough money to pay for a school trip.
                </div>
                <button class="btn-translate" onclick="toggleTranslate('trans1')">‚ú® B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text" id="trans1">
                    L·ªõp ch√∫ng t√¥i v·ª´a gi√†nh gi·∫£i th∆∞·ªüng trong m·ªôt cu·ªôc thi n·∫•u ƒÉn ‚Äì v√† ch√∫ng t√¥i s·∫Ω xu·∫•t hi·ªán tr√™n b·∫£n tin truy·ªÅn h√¨nh ƒë·ªãa ph∆∞∆°ng v√†o t·ªëi nay. C√°c gi√°m kh·∫£o th√≠ch nh·ªØng chi·∫øc b√°nh pizza c·ªßa ch√∫ng t√¥i v√¨ ch√∫ng r·∫•t ngon v√† h√¥m qua ch√∫ng t√¥i c≈©ng l√†m m√¨ ·ªëng v·ªõi n∆∞·ªõc s·ªët v√† m√≥n tr√°ng mi·ªáng cho h·ªçc sinh trong tr∆∞·ªùng ƒÉn tr∆∞a. Gi√°o vi√™n c·ªßa ch√∫ng t√¥i ƒë√£ k·∫øt h√¥n v·ªõi m·ªôt ƒë·∫ßu b·∫øp, ng∆∞·ªùi ƒë√£ gi√∫p ch√∫ng t√¥i l√†m m√≥n ch√≠nh. Ch√∫ng t√¥i d·ª± ƒë·ªãnh ng√†y mai s·∫Ω n∆∞·ªõng v√†i chi·∫øc b√°nh ng·ªçt v√† ƒëem b√°n. Ch√∫ng t√¥i mu·ªën ki·∫øm ƒë·ªß ti·ªÅn ƒë·ªÉ chi tr·∫£ cho m·ªôt chuy·∫øn d√£ ngo·∫°i c·ªßa tr∆∞·ªùng.
                </div>
            </div>

            <div class="paragraph-card">
                <h3>üç≤ Eva</h3>
                <div class="text-content">
                    Our class teacher heard about the cooking competition on the local TV news and told us about it. We decided to enter and won second prize! We made rice and vegetables, lemonade and dessert for our parents. We turned the school hall into a restaurant for one evening. Our prize is a visit to the kitchens of a famous restaurant in our city ‚Äì Gigi‚Äôs. My cousin works there and she says the food is amazing.
                </div>
                <button class="btn-translate" onclick="toggleTranslate('trans2')">‚ú® B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text" id="trans2">
                    Gi√°o vi√™n ch·ªß nhi·ªám c·ªßa ch√∫ng t√¥i ƒë√£ nghe v·ªÅ cu·ªôc thi n·∫•u ƒÉn tr√™n b·∫£n tin truy·ªÅn h√¨nh ƒë·ªãa ph∆∞∆°ng v√† k·ªÉ cho ch√∫ng t√¥i nghe v·ªÅ n√≥. Ch√∫ng t√¥i quy·∫øt ƒë·ªãnh tham gia v√† gi√†nh gi·∫£i nh√¨! Ch√∫ng t√¥i ƒë√£ l√†m c∆°m v√† rau, n∆∞·ªõc chanh v√† m√≥n tr√°ng mi·ªáng cho b·ªë m·∫π. Ch√∫ng t√¥i ƒë√£ bi·∫øn h·ªôi tr∆∞·ªùng c·ªßa tr∆∞·ªùng th√†nh m·ªôt nh√† h√†ng trong m·ªôt bu·ªïi t·ªëi. Gi·∫£i th∆∞·ªüng c·ªßa ch√∫ng t√¥i l√† m·ªôt chuy·∫øn tham quan nh√† b·∫øp c·ªßa m·ªôt nh√† h√†ng n·ªïi ti·∫øng trong th√†nh ph·ªë - nh√† h√†ng Gigi's. Ch·ªã h·ªç c·ªßa t√¥i l√†m vi·ªác ·ªü ƒë√≥ v√† ch·ªã ·∫•y n√≥i ƒë·ªì ƒÉn ·ªü ƒë√≥ r·∫•t tuy·ªát.
                </div>
            </div>

            <div class="paragraph-card">
                <h3>üç∞ Jenny</h3>
                <div class="text-content">
                    The food our class made for the cooking competition was amazing. We baked a lot of cakes ‚Äì chocolate, orange, lemon and honey. We also used vegetables from the school garden to make steak with vegetable salad for the class below us and everyone said it was fantastic. It was an interesting project and we learned a lot about food. We won third prize for our cakes and took them to a home for old people near our school.
                </div>
                <button class="btn-translate" onclick="toggleTranslate('trans3')">‚ú® B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div class="translation-text" id="trans3">
                    ƒê·ªì ƒÉn l·ªõp ch√∫ng t√¥i l√†m cho cu·ªôc thi n·∫•u ƒÉn th·∫≠t tuy·ªát v·ªùi. Ch√∫ng t√¥i ƒë√£ n∆∞·ªõng r·∫•t nhi·ªÅu b√°nh ng·ªçt - s√¥ c√¥ la, cam, chanh v√† m·∫≠t ong. Ch√∫ng t√¥i c≈©ng s·ª≠ d·ª•ng rau t·ª´ khu v∆∞·ªùn c·ªßa tr∆∞·ªùng ƒë·ªÉ l√†m b√≠t t·∫øt v·ªõi salad rau cho l·ªõp d∆∞·ªõi v√† m·ªçi ng∆∞·ªùi ƒë·ªÅu n√≥i n√≥ r·∫•t ngon (tuy·ªát v·ªùi). ƒê√≥ l√† m·ªôt d·ª± √°n th√∫ v·ªã v√† ch√∫ng t√¥i ƒë√£ h·ªçc ƒë∆∞·ª£c r·∫•t nhi·ªÅu ƒëi·ªÅu v·ªÅ th·ª±c ph·∫©m. Ch√∫ng t√¥i ƒë√£ gi√†nh gi·∫£i ba cho nh·ªØng chi·∫øc b√°nh ng·ªçt v√† mang ch√∫ng ƒë·∫øn m·ªôt vi·ªán d∆∞·ª°ng l√£o g·∫ßn tr∆∞·ªùng.
                </div>
            </div>

            <div class="glossary-container">
                <h3>üìö B·∫£ng T·ª´ V·ª±ng H·ªçc Thu·∫≠t (Glossary)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>T·ª´ v·ª±ng (Word)</th>
                            <th>Lo·∫°i t·ª´ (POS)</th>
                            <th>Nghƒ©a Ti·∫øng Vi·ªát (Meaning)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1. Competition</td><td>Noun (n)</td><td>Cu·ªôc thi, s·ª± c·∫°nh tranh</td></tr>
                        <tr><td>2. Local</td><td>Adjective (adj)</td><td>ƒê·ªãa ph∆∞∆°ng, trong v√πng</td></tr>
                        <tr><td>3. Delicious</td><td>Adjective (adj)</td><td>R·∫•t ngon mi·ªáng</td></tr>
                        <tr><td>4. Dessert</td><td>Noun (n)</td><td>M√≥n tr√°ng mi·ªáng</td></tr>
                        <tr><td>5. Main course</td><td>Noun phrase (n)</td><td>M√≥n ch√≠nh (trong b·ªØa ƒÉn)</td></tr>
                        <tr><td>6. Bake</td><td>Verb (v)</td><td>N∆∞·ªõng (b√°nh)</td></tr>
                        <tr><td>7. Restaurant</td><td>Noun (n)</td><td>Nh√† h√†ng</td></tr>
                        <tr><td>8. Famous</td><td>Adjective (adj)</td><td>N·ªïi ti·∫øng</td></tr>
                        <tr><td>9. Amazing</td><td>Adjective (adj)</td><td>ƒê√°ng kinh ng·∫°c, tuy·ªát v·ªùi</td></tr>
                        <tr><td>10. Project</td><td>Noun (n)</td><td>D·ª± √°n, ƒë·ªÅ √°n</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="right-panel" id="quizContainer">
            <div class="submit-btn-container">
                <button class="btn-submit" onclick="submitQuiz()">üöÄ N·ªòP B√ÄI TH√îI üöÄ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="resultModal">
        <div class="modal-content">
            <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
            <div class="score-text" id="finalScoreText">0/7</div>
            <div class="feedback-text" id="feedbackText">Tuy·ªát v·ªùi!</div>
            <button class="btn-close-modal" onclick="closeModal()">Xem L·∫°i B√†i Ch·ªØa</button>
        </div>
    </div>

    <script>
        /* ================= AUDIO GENERATOR ================= */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playCorrectSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(880, audioCtx.currentTime); 
            osc.frequency.exponentialRampToValueAtTime(1760, audioCtx.currentTime + 0.15);
            gainNode.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }

        function playWrongSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(250, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.4);
            gainNode.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        /* ================= CONFETTI GENERATOR ================= */
        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particles = [];

        function fireConfetti() {
            particles = [];
            const colors = ['#10ac84', '#FECA57', '#FF6B81', '#1DD1A1', '#ff9ff3'];
            for(let i=0; i<120; i++) {
                particles.push({
                    x: canvas.width/2,
                    y: canvas.height/2 + 200,
                    r: Math.random() * 8 + 3,
                    dx: Math.random() * 14 - 7,
                    dy: Math.random() * -18 - 5,
                    color: colors[Math.floor(Math.random() * colors.length)]
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            requestAnimationFrame(animateConfetti);
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p, index) => {
                p.x += p.dx;
                p.y += p.dy;
                p.dy += 0.4; 
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
                ctx.fillStyle = p.color;
                ctx.fill();
                if(p.y > canvas.height) particles.splice(index, 1);
            });
        }

        /* ================= TIMER LOGIC ================= */
        let timeRemaining = 600; 
        let timerInterval;
        let isTimerRunning = false;

        function updateTimerDisplay() {
            let m = Math.floor(timeRemaining / 60).toString().padStart(2, '0');
            let s = (timeRemaining % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').innerText = `${m}:${s}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('btnTimerToggle');
            if (isTimerRunning) {
                clearInterval(timerInterval);
                btn.innerText = "TI·∫æP T·ª§C L√ÄM B√ÄI";
                btn.style.background = "#FECA57";
                btn.style.color = "#d63031";
                isTimerRunning = false;
            } else {
                btn.innerText = "T·∫†M D·ª™NG";
                btn.style.background = "#FF6B81";
                btn.style.color = "white";
                isTimerRunning = true;
                timerInterval = setInterval(() => {
                    timeRemaining--;
                    updateTimerDisplay();
                    if (timeRemaining <= 0) {
                        clearInterval(timerInterval);
                        alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i. B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m, nh∆∞ng nh·ªõ l√† trong ph√≤ng thi th·∫≠t, b·∫°n ch·ªâ n√™n l√†m m·ªôt b√†i nh∆∞ th·∫ø n√†y trong 10 ph√∫t th√¥i nha.");
                        btn.innerText = "H·∫æT GI·ªú";
                        btn.disabled = true;
                        btn.style.background = "#ccc";
                    }
                }, 1000);
            }
        }

        /* ================= TRANSLATION TOGGLE ================= */
        function toggleTranslate(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === "block") ? "none" : "block";
        }

        /* ================= QUIZ DATA & LOGIC ================= */
        const quizData = [
            {
                q: "1. Whose food was popular with other students?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'C',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 1)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> Th·ª©c ƒÉn c·ªßa ai r·∫•t ƒë∆∞·ª£c c√°c h·ªçc sinh kh√°c y√™u th√≠ch? (popular with other students).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Jenny):</b> 
                    <div class="exp-quote">"...make steak with vegetable salad for the <b>class below us</b> and <b>everyone said it was fantastic</b>."</div>
                    <b>3. T·∫°i sao ch·ªçn Jenny?</b> "Class below us" ch√≠nh l√† c√°c h·ªçc sinh l·ªõp d∆∞·ªõi (other students), v√† m·ªçi ng∆∞·ªùi ƒë·ªÅu n√≥i th·ª©c ƒÉn "th·∫≠t tuy·ªát v·ªùi" (fantastic) -> T·ª©c l√† n√≥ r·∫•t ƒë∆∞·ª£c y√™u th√≠ch (popular).
                `
            },
            {
                q: "2. Whose class learned about the cooking competition from a TV programme?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'B',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 2)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai bi·∫øt ƒë·∫øn cu·ªôc thi n·∫•u ƒÉn t·ª´ m·ªôt ch∆∞∆°ng tr√¨nh TV? (learned from a TV programme).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Eva):</b> 
                    <div class="exp-quote">"Our class teacher heard about the cooking competition <b>on the local TV news</b> and told us about it."</div>
                    <b>3. T·∫°i sao ch·ªçn Eva?</b> Gi√°o vi√™n c·ªßa l·ªõp Eva ƒë√£ nghe v·ªÅ cu·ªôc thi tr√™n "b·∫£n tin truy·ªÅn h√¨nh ƒë·ªãa ph∆∞∆°ng" (TV news) v√† b√°o l·∫°i cho c·∫£ l·ªõp.
                `
            },
            {
                q: "3. Whose class baked cakes and gave them away?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'C',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 3)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai ƒë√£ n∆∞·ªõng b√°nh v√† ƒëem ƒëi t·∫∑ng? (gave them away = took them to a home for old people).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Jenny):</b> 
                    <div class="exp-quote">"We won third prize for our cakes and <b>took them to a home for old people</b> near our school."</div>
                    <b>3. T·∫°i sao ch·ªçn Jenny?</b> L·ªõp c·ªßa Jenny ƒë√£ n∆∞·ªõng b√°nh v√† "mang ch√∫ng ƒë·∫øn m·ªôt vi·ªán d∆∞·ª°ng l√£o", ƒë√¢y ch√≠nh l√† h√†nh ƒë·ªông ƒëem ƒëi t·∫∑ng.
                `
            },
            {
                q: "4. Whose class won a trip in the cooking competition?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'B',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 4)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai gi√†nh ƒë∆∞·ª£c m·ªôt chuy·∫øn ƒëi trong cu·ªôc thi n·∫•u ƒÉn? (won a trip = prize is a visit).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Eva):</b> 
                    <div class="exp-quote">"Our prize is <b>a visit to the kitchens of a famous restaurant</b> in our city..."</div>
                    <b>3. T·∫°i sao ch·ªçn Eva?</b> Gi·∫£i th∆∞·ªüng (prize) l·ªõp Eva nh·∫≠n ƒë∆∞·ª£c l√† "m·ªôt chuy·∫øn tham quan" (a visit), t∆∞∆°ng ƒë∆∞∆°ng v·ªõi m·ªôt chuy·∫øn ƒëi (a trip).
                `
            },
            {
                q: "5. Whose class got some help from someone who works in a restaurant?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'A',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 5)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai nh·∫≠n ƒë∆∞·ª£c s·ª± gi√∫p ƒë·ª° t·ª´ m·ªôt ng∆∞·ªùi l√†m vi·ªác ·ªü nh√† h√†ng? (someone who works in a restaurant = a chef).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Alice):</b> 
                    <div class="exp-quote">"Our teacher is married to <b>a chef who helped us</b> with our main course."</div>
                    <b>3. T·∫°i sao ch·ªçn Alice?</b> L·ªõp Alice ƒë∆∞·ª£c m·ªôt "ƒë·∫ßu b·∫øp" (chef) gi√∫p ƒë·ª°. ƒê·∫ßu b·∫øp ch√≠nh l√† ng∆∞·ªùi l√†m vi·ªác t·∫°i c√°c nh√† h√†ng.
                `
            },
            {
                q: "6. Whose class used food grown in the school to make lunch for another class?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'C',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 6)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai ƒë√£ s·ª≠ d·ª•ng th·ª±c ph·∫©m tr·ªìng ·ªü tr∆∞·ªùng ƒë·ªÉ l√†m b·ªØa tr∆∞a cho m·ªôt l·ªõp kh√°c?<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Jenny):</b> 
                    <div class="exp-quote">"We also used <b>vegetables from the school garden</b> to make steak... <b>for the class below us</b>..."</div>
                    <b>3. T·∫°i sao ch·ªçn Jenny?</b> "Vegetables from the school garden" ch√≠nh l√† rau (th·ª±c ph·∫©m) tr·ªìng t·∫°i v∆∞·ªùn tr∆∞·ªùng, v√† h·ªç n·∫•u cho "l·ªõp d∆∞·ªõi" (another class).
                `
            },
            {
                q: "7. Whose class plans to use their cakes to make money?",
                options: [{id:'A', text:'Alice'}, {id:'B', text:'Eva'}, {id:'C', text:'Jenny'}],
                correct: 'A',
                explanation: `
                    <div class="exp-title">üí° Gi·∫£i th√≠ch chi ti·∫øt (C√¢u 7)</div>
                    <b>1. Ph√¢n t√≠ch c√¢u h·ªèi:</b> L·ªõp c·ªßa ai d·ª± ƒë·ªãnh d√πng b√°nh c·ªßa h·ªç ƒë·ªÉ ki·∫øm ti·ªÅn? (make money = sell them / get enough money).<br>
                    <b>2. D·∫´n ch·ª©ng trong b√†i (ƒêo·∫°n Alice):</b> 
                    <div class="exp-quote">"We‚Äôre planning to bake some cakes tomorrow and <b>sell them</b>. We want to <b>get enough money</b>..."</div>
                    <b>3. T·∫°i sao ch·ªçn Alice?</b> L·ªõp Alice d·ª± ƒë·ªãnh n∆∞·ªõng b√°nh r·ªìi "ƒëem b√°n" (sell them) ƒë·ªÉ "ki·∫øm ƒë·ªß ti·ªÅn" (get enough money) cho chuy·∫øn d√£ ngo·∫°i.
                `
            }
        ];

        let score = 0;
        let answeredQuestions = new Set();

        function shuffleArray(array) {
            let newArr = [...array];
            for (let i = newArr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
            }
            return newArr;
        }

        function renderQuiz() {
            const container = document.getElementById('quizContainer');
            const submitBtn = document.querySelector('.submit-btn-container');
            container.innerHTML = '';

            quizData.forEach((qObj, qIndex) => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-card-${qIndex}`;

                const qText = document.createElement('div');
                qText.className = 'question-text';
                qText.innerHTML = qObj.q;
                card.appendChild(qText);

                const optionsGrid = document.createElement('div');
                optionsGrid.className = 'options-grid';

                let shuffledOptions = shuffleArray(qObj.options);

                shuffledOptions.forEach((opt, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    
                    const label = index === 0 ? 'A' : (index === 1 ? 'B' : 'C');
                    btn.innerHTML = `<span class="opt-label">${label}</span> <span>${opt.text}</span>`;
                    
                    btn.dataset.optId = opt.id;
                    btn.onclick = () => handleAnswer(btn, opt.id, qObj.correct, qIndex, card);
                    optionsGrid.appendChild(btn);
                });

                card.appendChild(optionsGrid);

                const expBox = document.createElement('div');
                expBox.className = 'explanation-box';
                expBox.id = `exp-${qIndex}`;
                expBox.innerHTML = qObj.explanation;
                card.appendChild(expBox);

                container.appendChild(card);
            });
            
            container.appendChild(submitBtn);
        }

        function handleAnswer(btn, selectedId, correctId, qIndex, card) {
            const buttons = card.querySelectorAll('.option-btn');
            const expBox = document.getElementById(`exp-${qIndex}`);

            if (selectedId === correctId) {
                btn.classList.add('correct');
                playCorrectSound();
                fireConfetti();
                if (!answeredQuestions.has(qIndex)) {
                    score++;
                    answeredQuestions.add(qIndex);
                }
            } else {
                btn.classList.add('wrong');
                btn.classList.add('shake');
                playWrongSound();
                setTimeout(() => btn.classList.remove('shake'), 500);
                answeredQuestions.add(qIndex); 
                
                buttons.forEach(b => {
                    if (b.dataset.optId === correctId) {
                        b.classList.add('correct');
                    }
                });
            }

            buttons.forEach(b => b.disabled = true);
            expBox.style.display = 'block';
        }

        function submitQuiz() {
            const modal = document.getElementById('resultModal');
            const scoreText = document.getElementById('finalScoreText');
            const feedbackText = document.getElementById('feedbackText');
            
            scoreText.innerText = `${score} / 7`;
            
            let percentage = score / 7;
            if (percentage === 1) {
                feedbackText.innerHTML = "üèÜ ƒê·ªàNH C·ª¶A CH√ìP!<br>Em ƒë√∫ng chu·∫©n MasterChef ng√¥n ng·ªØ!";
                feedbackText.style.color = "#10ac84";
                fireConfetti();
                playCorrectSound();
            } else if (percentage >= 0.7) {
                feedbackText.innerHTML = "üåü R·∫§T T·ªêT!<br>K·ªπ nƒÉng ƒë·ªçc hi·ªÉu c·ªßa em ngon nh∆∞ Pizza v·∫≠y!";
                feedbackText.style.color = "#1DD1A1";
            } else if (percentage >= 0.4) {
                feedbackText.innerHTML = "üëç KH√Å L·∫ÆM!<br>ƒê·ªçc k·ªπ ph·∫ßn Gi·∫£i th√≠ch chi ti·∫øt ƒë·ªÉ nh·∫∑t th√™m t·ª´ v·ª±ng nh√©!";
                feedbackText.style.color = "#FECA57";
            } else {
                feedbackText.innerHTML = "üí™ KH√îNG SAO ƒê√ÇU!<br>L·∫ßn t·ªõi m√¨nh s·∫Ω l√†m t·ªët h∆°n nhi·ªÅu!";
                feedbackText.style.color = "#ee5253";
            }

            modal.style.display = "flex";
            clearInterval(timerInterval);
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = "none";
        }

        window.onload = () => {
            updateTimerDisplay();
            renderQuiz();
        };
    </script>
</body>
</html>