<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-width=1.0">
    <title>English Quiz - Ms Mai An ULIS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

        /* ANIMATIONS */
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes floatPattern {
            from { transform: translateY(0px) translateX(0px); }
            to { transform: translateY(-100vh) translateX(50px); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
        @keyframes scaleUp {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes confettiFall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        /* GLOBAL STYLES */
        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: linear-gradient(-45deg, #8854C0, #FDCB6E, #00C9A7, #ff9a9e);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
            color: #333;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 200%;
            z-index: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ctext x='10' y='30' font-size='20'%3E‚≠ê%3C/text%3E%3Ctext x='60' y='80' font-size='20'%3Eüå∏%3C/text%3E%3Ctext x='80' y='20' font-size='20'%3Eüçé%3C/text%3E%3Ctext x='20' y='90' font-size='20'%3E‚òÅÔ∏è%3C/text%3E%3C/svg%3E");
            animation: floatPattern 40s linear infinite;
            opacity: 0.6;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        header {
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 30px;
            border-radius: 30px;
            margin-top: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            text-align: center;
        }
        header h1 { margin: 0; font-size: 1.2rem; color: #8854C0; font-weight: 900; }
        header p { margin: 0; font-size: 0.9rem; color: #666; font-weight: 700; }

        #quiz-container {
            z-index: 10;
            width: 90%;
            max-width: 800px;
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1);
            animation: scaleUp 0.5s ease;
            position: relative;
        }
        .question-title {
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 20px;
            color: #2d3436;
            line-height: 1.5;
        }

        /* MCQ OPTIONS */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 500px) { .options-grid { grid-template-columns: 1fr; } }
        
        .btn-option {
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            background: #f1f2f6;
            border: 3px solid #dfe4ea;
            color: #2f3542;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 6px 0 #dfe4ea;
            text-align: left;
        }
        .btn-option:hover:not(:disabled) { transform: scale(1.02); border-color: #7bed9f; }
        .btn-option:active:not(:disabled) { transform: translateY(6px); box-shadow: 0 0 0 #dfe4ea; }
        .btn-option.correct { background: #00D26A; border-color: #00b359; color: white; box-shadow: 0 6px 0 #00b359; }
        .btn-option.wrong { background: #FF4757; border-color: #ff2a3d; color: white; box-shadow: 0 6px 0 #ff2a3d; animation: shake 0.4s ease; }
        .btn-option:disabled { cursor: not-allowed; }

        /* INPUT T·ª∞ LU·∫¨N */
        .input-group { display: flex; gap: 10px; margin-top: 15px; }
        .text-input {
            flex: 1; font-family: 'Nunito', sans-serif; font-size: 1.1rem; padding: 15px;
            border: 3px solid #dfe4ea; border-radius: 15px; outline: none; transition: border 0.3s;
        }
        .text-input:focus { border-color: #8854C0; }
        .btn-check {
            font-family: 'Nunito', sans-serif; font-size: 1.1rem; font-weight: 700;
            background: #FDCB6E; border: none; color: #2d3436; padding: 0 25px;
            border-radius: 15px; cursor: pointer; box-shadow: 0 6px 0 #e1b15c; transition: all 0.2s;
        }
        .btn-check:active { transform: translateY(6px); box-shadow: 0 0 0 transparent; }

        /* FIND & FIX ERRORS (NEW FEATURE) */
        .sentence-box {
            font-size: 1.25rem; line-height: 2; padding: 15px 20px;
            background: #f8f9fa; border-radius: 15px; border: 2px dashed #a4b0be;
            text-align: center;
        }
        .err-opt {
            display: inline-block; margin: 0 4px; padding: 2px 8px;
            cursor: pointer; transition: all 0.2s; border-radius: 8px;
            background: transparent;
        }
        .err-opt u { text-decoration-thickness: 3px; text-decoration-color: #8854C0; font-weight: bold; }
        .err-opt sub { font-weight: 900; color: #8854C0; font-size: 0.8em; margin-left: 2px; }
        .err-opt:hover { background: #f1e4ff; transform: translateY(-3px); box-shadow: 0 4px 0 #d9b3ff; }
        
        .err-opt.selected-correct { 
            background: #FDCB6E; color: #2d3436; box-shadow: 0 4px 0 #e1b15c; transform: translateY(-3px); 
        }
        .err-opt.selected-correct u { text-decoration-color: #2d3436; }
        .err-opt.selected-correct sub { color: #2d3436; }
        
        .err-opt.selected-wrong { 
            background: #FF4757; color: white; animation: shake 0.4s ease; box-shadow: 0 4px 0 #d93845;
        }
        .err-opt.selected-wrong u { text-decoration-color: white; }
        .err-opt.selected-wrong sub { color: white; }

        .correction-area {
            margin-top: 20px; padding: 20px; background: #e6fff2;
            border-radius: 15px; border: 3px solid #00D26A; animation: scaleUp 0.4s ease;
        }
        .correction-area p { margin: 0 0 10px 0; color: #00b359; font-weight: 800; font-size: 1.1rem;}

        /* EXPLANATION BOX */
        .explanation {
            display: none; margin-top: 20px; background: #f8f9fa;
            border-left: 6px solid #8854C0; padding: 15px; border-radius: 10px;
            font-size: 1rem; color: #333; animation: scaleUp 0.3s ease;
        }
        .ex-step { margin-bottom: 8px; }
        .ex-step b { color: #8854C0; }

        .confetti { position: fixed; width: 15px; height: 15px; z-index: 9999; pointer-events: none; }
        
        #submit-area { text-align: center; margin-bottom: 50px; z-index: 10; }
        #btn-submit {
            font-family: 'Nunito', sans-serif; font-size: 1.5rem; font-weight: 900;
            background: #00C9A7; color: white; border: none; padding: 15px 40px;
            border-radius: 20px; cursor: pointer; box-shadow: 0 8px 0 #00a689; transition: all 0.2s;
        }
        #btn-submit:hover { transform: scale(1.05); }
        #btn-submit:active { transform: translateY(8px); box-shadow: 0 0 0 transparent; }

        /* POPUP */
        #result-popup {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center;
        }
        .popup-content {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            box-shadow: 0 15px 0 rgba(0,0,0,0.2); animation: scaleUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .popup-content h2 { color: #8854C0; font-size: 2rem; margin: 0 0 10px 0; }
        .popup-content p { font-size: 1.2rem; color: #555; font-weight: 700; }
        .popup-btn {
            margin-top: 20px; background: #FF4757; color: white; border: none; padding: 10px 20px;
            border-radius: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #d93845;
        }
    </style>
</head>
<body>

    <div class="bg-pattern"></div>

    <header>
        <h1>Ms Mai An ULIS</h1>
        <p>Gamified Interactive English Test üöÄ</p>
    </header>

    <div id="quiz-container"></div>

    <div id="submit-area">
        <button id="btn-submit" onclick="showResults()">N·ªòP B√ÄI!</button>
    </div>

    <div id="result-popup">
        <div class="popup-content">
            <h2 id="result-title">Tuy·ªát v·ªùi! üéâ</h2>
            <p id="result-score">B·∫°n ƒë·∫°t 0/0 ƒëi·ªÉm</p>
            <p id="result-message">Lu√¥n c·ªë g·∫Øng nh√©!</p>
            <button class="popup-btn" onclick="document.getElementById('result-popup').style.display='none'">ƒê√≥ng l·∫°i</button>
        </div>
    </div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(type, frequency, duration, slideFreq = null) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.type = type; osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
    if (slideFreq) osc.frequency.exponentialRampToValueAtTime(slideFreq, audioCtx.currentTime + duration/2);
    gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gainNode); gainNode.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + duration);
}
function playDing() { playTone('sine', 800, 0.5, 1200); }
function playBuzz() { playTone('sawtooth', 150, 0.4, 100); }

function fireConfetti() {
    const colors = ['#FF4757', '#00D26A', '#FDCB6E', '#8854C0', '#00C9A7'];
    for(let i = 0; i < 40; i++) {
        let conf = document.createElement('div');
        conf.classList.add('confetti');
        conf.style.left = Math.random() * 100 + 'vw';
        conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        conf.style.animation = `confettiFall ${Math.random() * 2 + 1}s linear forwards`;
        document.body.appendChild(conf);
        setTimeout(() => conf.remove(), 3000);
    }
}

const rawData = [
    // --- MULTIPLE CHOICE --- (Gi·ªØ nguy√™n)
    { id: 51, type: "mcq", q: "51. ________ is it from your house to the nearest bus stop? - About 50 metres.", o: ["How often", "How long", "How much", "How far"], a: "How far", ex: "D·ªãch: T·ª´ nh√† b·∫°n ƒë·∫øn tr·∫°m xe bu√Ωt g·∫ßn nh·∫•t l√† bao xa? - Kho·∫£ng 50 m√©t.|A. How often: Bao l√¢u 1 l·∫ßn; B. How long: Bao l√¢u/Bao xa (ƒë·ªô d√†i); C. How much: Bao nhi√™u; D. How far: Bao xa (kho·∫£ng c√°ch).|C√¢u tr·∫£ l·ªùi l√† 'About 50 metres' (ch·ªâ kho·∫£ng c√°ch v·∫≠t l√Ω) -> d√πng 'How far'." },
    { id: 52, type: "mcq", q: "52. Drivers have to ________ your seatbelt whenever they drive.", o: ["put", "fasten", "put on", "tie"], a: "fasten", ex: "D·ªãch: T√†i x·∫ø ph·∫£i th·∫Øt d√¢y an to√†n b·∫•t c·ª© khi n√†o h·ªç l√°i xe.|A. put: ƒë·∫∑t ƒë·ªÉ; B. fasten: th·∫Øt ch·∫∑t; C. put on: m·∫∑c v√†o; D. tie: bu·ªôc.|Collocation chu·∫©n: 'fasten seatbelt' (th·∫Øt d√¢y an to√†n)." },
    { id: 53, type: "mcq", q: "53. ________ he go to the cinema with his friends tonight?", o: ["Is", "Do", "Did", "Will"], a: "Will", ex: "D·ªãch: T·ªëi nay anh ·∫•y s·∫Ω ƒëi xem phim c√πng b·∫°n b√® ph·∫£i kh√¥ng?|A. Is; B. Do; C. Did; D. Will.|D·∫•u hi·ªáu 'tonight' (t·ªëi nay) -> d√πng th√¨ T∆∞∆°ng lai ƒë∆°n v·ªõi tr·ª£ ƒë·ªông t·ª´ Will." },
    { id: 54, type: "mcq", q: "54. All of us have to obey ________ strictly.", o: ["regular", "traffic rules", "traffic jam", "traffic"], a: "traffic rules", ex: "D·ªãch: T·∫•t c·∫£ ch√∫ng ta ƒë·ªÅu ph·∫£i tu√¢n th·ªß lu·∫≠t giao th√¥ng nghi√™m ng·∫∑t.|A. regular; B. traffic rules (lu·∫≠t giao th√¥ng); C. traffic jam; D. traffic.|ƒê·ªông t·ª´ 'obey' (tu√¢n th·ªß) ƒëi v·ªõi danh t·ª´ lu·∫≠t l·ªá -> 'traffic rules'." },
    { id: 55, type: "mcq", q: "55. Cyclists and motorists have to wear a ________ when they ride a motorbike.", o: ["cap", "mask", "hard hat", "helmet"], a: "helmet", ex: "D·ªãch: Ng∆∞·ªùi ƒëi xe ƒë·∫°p v√† xe m√°y ph·∫£i ƒë·ªôi m≈© b·∫£o hi·ªÉm.|A. cap; B. mask; C. hard hat; D. helmet (m≈© b·∫£o hi·ªÉm).|L√°i xe m√°y b·∫Øt bu·ªôc d√πng 'helmet'." },
    { id: 56, type: "mcq", q: "56. He forgot to give a ________ before he turned left and got a ticket.", o: ["hand", "sign", "light", "signal"], a: "signal", ex: "D·ªãch: Anh ·∫•y qu√™n ra t√≠n hi·ªáu tr∆∞·ªõc khi r·∫Ω tr√°i v√† b·ªã ph·∫°t.|A. hand; B. sign; C. light; D. signal (t√≠n hi·ªáu).|C·ª•m t·ª´ c·ªë ƒë·ªãnh: 'give a signal' (ra t√≠n hi·ªáu, b·∫≠t xi-nhan)." },
    { id: 57, type: "mcq", q: "57. On New Year‚Äôs Eve, we go to Hoan Kiem Lake to watch the fireworks ________.", o: ["show", "performance", "exhibition", "display"], a: "display", ex: "D·ªãch: Giao th·ª´a, ch√∫ng t√¥i ƒëi xem m√†n b·∫Øn ph√°o hoa.|A. show; B. performance; C. exhibition; D. display.|C·ª•m danh t·ª´ c·ªë ƒë·ªãnh: 'fireworks display' (m√†n b·∫Øn ph√°o hoa)." },
    { id: 58, type: "mcq", q: "58. I found the book so ________ that I couldn't read any words.", o: ["dull", "shocked", "tiring", "gripping"], a: "dull", ex: "D·ªãch: S√°ch ch√°n ƒë·∫øn n·ªói kh√¥ng ƒë·ªçc n·ªïi ch·ªØ n√†o.|A. dull (nh√†m ch√°n); B. shocked; C. tiring; D. gripping.|'Kh√¥ng th·ªÉ ƒë·ªçc' do t√≠nh ch·∫•t ti√™u c·ª±c -> 'dull'." },
    { id: 59, type: "mcq", q: "59. A ________ is a film that tries to make audiences laugh.", o: ["horror", "sci-fi", "comedy", "documentary"], a: "comedy", ex: "D·ªãch: Phim h√†i c·ªë g·∫Øng l√†m kh√°n gi·∫£ c∆∞·ªùi.|A. horror; B. sci-fi; C. comedy (phim h√†i); D. documentary.|'make audiences laugh' l√† ƒë·∫∑c tr∆∞ng c·ªßa 'comedy'." },
    { id: 60, type: "mcq", q: "60. The end of the film was so ________ that many people cried.", o: ["moving", "shocking", "boring", "exciting"], a: "moving", ex: "D·ªãch: K·∫øt phim qu√° c·∫£m ƒë·ªông l√†m nhi·ªÅu ng∆∞·ªùi kh√≥c.|A. moving (c·∫£m ƒë·ªông); B. shocking; C. boring; D. exciting.|D·∫•u hi·ªáu 'cried' ph·∫£n √°nh s·ª± x√∫c ƒë·ªông -> 'moving'." },
    { id: 61, type: "mcq", q: "61. Mr. Bean's Holiday is a ________ film, I was laughing from beginning to end.", o: ["hilarious", "scary", "moving", "violent"], a: "hilarious", ex: "D·ªãch: K·ª≥ ngh·ªâ c·ªßa Mr. Bean si√™u h√†i h∆∞·ªõc.|A. hilarious (si√™u h√†i h∆∞·ªõc); B. scary; C. moving; D. violent.|D·∫•u hi·ªáu 'laughing' -> 'hilarious'." },
    { id: 62, type: "mcq", q: "62. ________ I was only out for five minutes, I got very wet in the rain.", o: ["When", "Nevertheless", "Although", "However"], a: "Although", ex: "D·ªãch: M·∫∑c d√π ra ngo√†i 5 ph√∫t, t√¥i ƒë√£ b·ªã ∆∞·ªõt s≈©ng.|A. When; B. Nevertheless; C. Although (M·∫∑c d√π); D. However.|Hai v·∫ø t∆∞∆°ng ph·∫£n, 'Although' ƒë·ª©ng ƒë·∫ßu c√¢u n·ªëi 2 m·ªánh ƒë·ªÅ." },
    { id: 63, type: "mcq", q: "63. All critics said that film was really boring. ________, I was so interested that I saw it from beginning to end.", o: ["But", "However", "Because", "Although"], a: "However", ex: "D·ªãch: M·ªçi ng∆∞·ªùi ch√™ ch√°n. Tuy nhi√™n, t√¥i l·∫°i th√≠ch xem h·∫øt.|A. But; B. However (Tuy nhi√™n); C. Because; D. Although.|V·ªã tr√≠ sau d·∫•u ch·∫•m, tr∆∞·ªõc d·∫•u ph·∫©y -> d√πng 'However'." },
    { id: 64, type: "mcq", q: "64. They spent a huge amount of money on the film, ________ it was not a big success.", o: ["although", "but", "because", "however"], a: "but", ex: "D·ªãch: Chi nhi·ªÅu ti·ªÅn, nh∆∞ng phim kh√¥ng th√†nh c√¥ng.|A. although; B. but (nh∆∞ng); C. because; D. however.|Hai m·ªánh ƒë·ªÅ t∆∞∆°ng ph·∫£n, c√≥ d·∫•u ph·∫©y gi·ªØa c√¢u -> d√πng 'but'." },
    { id: 65, type: "mcq", q: "65. Johnny Depp is a famous actor; ________, he has failed in his recent films.", o: ["since", "though", "however", "because"], a: "however", ex: "D·ªãch: Di·ªÖn vi√™n n·ªïi ti·∫øng; tuy nhi√™n, c√°c phim g·∫ßn ƒë√¢y th·∫•t b·∫°i.|A. since; B. though; C. however; D. because.|Kho·∫£ng tr·ªëng k·∫πp gi·ªØa (;) v√† (,) -> d√πng 'however'." },
    { id: 66, type: "mcq", q: "66. She started her ____________ career by doing short advertisements.", o: ["staring", "reviewing", "critising", "acting"], a: "acting", ex: "D·ªãch: B·∫Øt ƒë·∫ßu s·ª± nghi·ªáp di·ªÖn xu·∫•t b·∫±ng ƒë√≥ng qu·∫£ng c√°o.|A. staring; B. reviewing; C. critising; D. acting.|C·ª•m t·ª´ 'acting career' (s·ª± nghi·ªáp di·ªÖn xu·∫•t)." },
    { id: 67, type: "mcq", q: "67. This film is a ________ for anyone interested in the science-fiction genre.", o: ["must-see", "necessity", "requirement", "need"], a: "must-see", ex: "D·ªãch: Phim l√† t√°c ph·∫©m ph·∫£i-xem cho ng∆∞·ªùi th√≠ch khoa h·ªçc vi·ªÖn t∆∞·ªüng.|A. must-see; B. necessity; C. requirement; D. need.|'a must-see' (t√°c ph·∫©m kh√¥ng th·ªÉ b·ªè l·ª°)." },
    { id: 68, type: "mcq", q: "68. It takes me two hours ________ all the rooms.", o: ["cleaned", "to clean", "cleaning", "clean"], a: "to clean", ex: "D·ªãch: M·∫•t 2 ti·∫øng ƒë·ªÉ d·ªçn ph√≤ng.|A. cleaned; B. to clean; C. cleaning; D. clean.|C·∫•u tr√∫c: It takes + time + TO DO something." },
    { id: 69, type: "mcq", q: "69. He is wearing a beautiful ________ in the school play now.", o: ["custom", "clothes", "costume", "clothing"], a: "costume", ex: "D·ªãch: Anh ·∫•y m·∫∑c trang ph·ª•c bi·ªÉu di·ªÖn ƒë·∫πp trong v·ªü k·ªãch.|A. custom; B. clothes; C. costume (trang ph·ª•c bi·ªÉu di·ªÖn); D. clothing.|Ng·ªØ c·∫£nh v·ªü k·ªãch -> 'costume'." },
    { id: 70, type: "mcq", q: "70. ___________ is about three metres from the post office to the market.", o: ["It", "That", "This", "There"], a: "It", ex: "D·ªãch: Kho·∫£ng c√°ch l√† 3 m√©t.|A. It; B. That; C. This; D. There.|C√¢u h·ªèi/n√≥i v·ªÅ kho·∫£ng c√°ch b·∫Øt bu·ªôc d√πng ch·ªß ng·ªØ gi·∫£ 'It'." },

    // --- FIND AND FIX ERRORS (NEW SYSTEM) ---
    { id: 71, type: "find_and_fix", q: "71. Identify & Correct the mistake:",
      html: "The job is <span class='err-opt' onclick='selectError(this, false, 71)'><u>badly</u><sub>A</sub></span> paid, <span class='err-opt' onclick='selectError(this, true, 71)'><u>but</u><sub>B</sub></span> I‚Äôm <span class='err-opt' onclick='selectError(this, false, 71)'><u>looking</u><sub>C</sub></span> for <span class='err-opt' onclick='selectError(this, false, 71)'><u>another</u><sub>D</sub></span> one.",
      a: "so", ex: "D·ªãch: C√¥ng vi·ªác tr·∫£ l∆∞∆°ng k√©m, V√å V·∫¨Y t√¥i ƒëang t√¨m vi·ªác kh√°c.|T·ª´ 'but' (nh∆∞ng) th·ªÉ hi·ªán s·ª± t∆∞∆°ng ph·∫£n l√† sai ng·ªØ c·∫£nh.|ƒê·ªïi th√†nh 'so' (v√¨ v·∫≠y) v√¨ 2 v·∫ø c√≥ quan h·ªá nguy√™n nh√¢n - k·∫øt qu·∫£." },
    { id: 72, type: "find_and_fix", q: "72. Identify & Correct the mistake:",
      html: "It is <span class='err-opt' onclick='selectError(this, false, 72)'><u>not</u><sub>A</sub></span> very far <span class='err-opt' onclick='selectError(this, false, 72)'><u>from</u><sub>B</sub></span> here <span class='err-opt' onclick='selectError(this, true, 72)'><u>and</u><sub>C</sub></span> the <span class='err-opt' onclick='selectError(this, false, 72)'><u>nearest</u><sub>D</sub></span> bus stop.",
      a: "to", ex: "D·ªãch: Kho·∫£ng c√°ch t·ª´ ƒë√¢y ƒë·∫øn tr·∫°m xe bu√Ωt g·∫ßn nh·∫•t kh√¥ng xa l·∫Øm.|C·∫•u tr√∫c gi·ªõi t·ª´ ƒëi theo c·∫∑p 'from A... to B' (t·ª´ A ƒê·∫æN B).|Thay 'and' th√†nh 'to'." },
    { id: 73, type: "find_and_fix", q: "73. Identify & Correct the mistake:",
      html: "<span class='err-opt' onclick='selectError(this, true, 73)'><u>Do</u><sub>A</sub></span> you <span class='err-opt' onclick='selectError(this, false, 73)'><u>interested</u><sub>B</sub></span> in <span class='err-opt' onclick='selectError(this, false, 73)'><u>any</u><sub>C</sub></span> festivals in the <span class='err-opt' onclick='selectError(this, false, 73)'><u>world</u><sub>D</sub></span>?",
      a: "Are", ex: "D·ªãch: B·∫°n c√≥ h·ª©ng th√∫ v·ªõi b·∫•t k·ª≥ l·ªÖ h·ªôi n√†o kh√¥ng?|T√≠nh t·ª´ 'interested' ph·∫£i ƒëi k√®m v·ªõi ƒë·ªông t·ª´ to be, kh√¥ng d√πng tr·ª£ ƒë·ªông t·ª´ Do.|Thay 'Do' th√†nh 'Are'." },
    { id: 74, type: "find_and_fix", q: "74. Identify & Correct the mistake:",
      html: "My mother <span class='err-opt' onclick='selectError(this, false, 74)'><u>spent</u><sub>A</sub></span> two days <span class='err-opt' onclick='selectError(this, true, 74)'><u>prepare</u><sub>B</sub></span> for the <span class='err-opt' onclick='selectError(this, false, 74)'><u>fest</u><sub>C</sub></span> <span class='err-opt' onclick='selectError(this, false, 74)'><u>last year</u><sub>D</sub></span>.",
      a: "preparing", ex: "D·ªãch: M·∫π t√¥i ƒë√£ d√†nh 2 ng√†y ƒë·ªÉ chu·∫©n b·ªã cho l·ªÖ h·ªôi.|C·∫•u tr√∫c: Spend + time + V-ING (D√†nh th·ªùi gian l√†m g√¨).|Thay 'prepare' th√†nh 'preparing'." },
    { id: 75, type: "find_and_fix", q: "75. Identify & Correct the mistake:",
      html: "<span class='err-opt' onclick='selectError(this, false, 75)'><u>Will</u><sub>A</sub></span> she <span class='err-opt' onclick='selectError(this, true, 75)'><u>buys</u><sub>B</sub></span> a <span class='err-opt' onclick='selectError(this, false, 75)'><u>lot of</u><sub>C</sub></span> apples to <span class='err-opt' onclick='selectError(this, false, 75)'><u>make</u><sub>D</sub></span> an apple pie?",
      a: "buy", ex: "D·ªãch: C√¥ ·∫•y s·∫Ω mua nhi·ªÅu t√°o ƒë·ªÉ l√†m b√°nh ch·ª©?|Sau tr·ª£ ƒë·ªông t·ª´ khuy·∫øt thi·∫øu (Will, Can...) ƒë·ªông t·ª´ ph·∫£i ·ªü d·∫°ng nguy√™n th·ªÉ.|Thay 'buys' th√†nh 'buy'." },
    { id: 76, type: "find_and_fix", q: "76. Identify & Correct the mistake:",
      html: "<span class='err-opt' onclick='selectError(this, true, 76)'><u>However</u><sub>A</sub></span> the Titanic is a very <span class='err-opt' onclick='selectError(this, false, 76)'><u>sad</u><sub>B</sub></span> film, many people <span class='err-opt' onclick='selectError(this, false, 76)'><u>really</u><sub>C</sub></span> <span class='err-opt' onclick='selectError(this, false, 76)'><u>love it</u><sub>D</sub></span>.",
      a: "Although", ex: "D·ªãch: M·∫∑c d√π Titanic l√† phim bu·ªìn, nhi·ªÅu ng∆∞·ªùi r·∫•t y√™u n√≥.|'However' kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u n·ªëi tr·ª±c ti·∫øp 2 m·ªánh ƒë·ªÅ c√≥ d·∫•u ph·∫©y ·ªü gi·ªØa ki·ªÉu n√†y.|Thay 'However' th√†nh 'Although'." },
    { id: 77, type: "find_and_fix", q: "77. Identify & Correct the mistake:",
      html: "We shouldn‚Äôt <span class='err-opt' onclick='selectError(this, true, 77)'><u>going</u><sub>A</sub></span> swimming <span class='err-opt' onclick='selectError(this, false, 77)'><u>right</u><sub>B</sub></span> after eating because <span class='err-opt' onclick='selectError(this, false, 77)'><u>it</u><sub>C</sub></span> is not good for our <span class='err-opt' onclick='selectError(this, false, 77)'><u>stomach</u><sub>D</sub></span>.",
      a: "go", ex: "D·ªãch: Ch√∫ng ta kh√¥ng n√™n ƒëi b∆°i ngay sau khi ƒÉn.|Sau 'shouldn't' ph·∫£i l√† ƒë·ªông t·ª´ nguy√™n th·ªÉ.|Thay V-ing 'going' th√†nh V nguy√™n th·ªÉ 'go'." },
    { id: 78, type: "find_and_fix", q: "78. Identify & Correct the mistake:",
      html: "The <span class='err-opt' onclick='selectError(this, false, 78)'><u>first</u><sub>A</sub></span> part of Iron Man is good. <span class='err-opt' onclick='selectError(this, true, 78)'><u>But,</u><sub>B</sub></span> the <span class='err-opt' onclick='selectError(this, false, 78)'><u>second</u><sub>C</sub></span> part <span class='err-opt' onclick='selectError(this, false, 78)'><u>is not</u><sub>D</sub></span>.",
      a: "However,", ex: "D·ªãch: Ph·∫ßn 1 hay. Tuy nhi√™n, ph·∫ßn 2 th√¨ kh√¥ng.|Trong vƒÉn phong vi·∫øt, 'But' hi·∫øm khi ƒë·ª©ng ƒë·∫ßu c√¢u v√† c√≥ ph·∫©y ngay sau.|Thay 'But,' th√†nh 'However,'." },
    { id: 79, type: "find_and_fix", q: "79. Identify & Correct the mistake:",
      html: "<span class='err-opt' onclick='selectError(this, false, 79)'><u>Can</u><sub>A</sub></span> tourists join and <span class='err-opt' onclick='selectError(this, true, 79)'><u>danced</u><sub>B</sub></span> with samba dancers <span class='err-opt' onclick='selectError(this, false, 79)'><u>on</u><sub>C</sub></span> the street <span class='err-opt' onclick='selectError(this, false, 79)'><u>in the</u><sub>D</sub></span> Rio Carnival?",
      a: "dance", ex: "D·ªãch: Du kh√°ch c√≥ th·ªÉ tham gia nh·∫£y m√∫a kh√¥ng?|C·∫•u tr√∫c song song: 'join and...' -> ch·ªØ and n·ªëi 2 ƒë·ªông t·ª´ c√πng d·∫°ng nguy√™n th·ªÉ (sau Can).|ƒê·ªïi 'danced' v·ªÅ 'dance'." },
    { id: 80, type: "find_and_fix", q: "80. Identify & Correct the mistake:",
      html: "How far <span class='err-opt' onclick='selectError(this, true, 80)'><u>does</u><sub>A</sub></span> it <span class='err-opt' onclick='selectError(this, false, 80)'><u>from</u><sub>B</sub></span> Ho Chi Minh City <span class='err-opt' onclick='selectError(this, false, 80)'><u>to</u><sub>C</sub></span> Phu Quoc <span class='err-opt' onclick='selectError(this, false, 80)'><u>Island</u><sub>D</sub></span>?",
      a: "is", ex: "D·ªãch: Qu√£ng ƒë∆∞·ªùng t·ª´ TP HCM ƒë·∫øn Ph√∫ Qu·ªëc bao xa?|C·∫•u tr√∫c h·ªèi kho·∫£ng c√°ch l√† 'How far is it...?', d√πng to be 'is' ch·ª© kh√¥ng d√πng 'does'.|Thay 'does' th√†nh 'is'." },

    // --- REWRITE SENTENCES (Gi·ªØ nguy√™n) ---
    { id: 97, type: "fill", q: "97. Vi·∫øt l·∫°i c√¢u b·∫Øt ƒë·∫ßu b·∫±ng (It):<br>The distance between Ha Noi and Hai Phong is about 100 km.", a: "It is about 100 km from Ha Noi to Hai Phong.", ex: "C·∫•u tr√∫c t∆∞∆°ng ƒë∆∞∆°ng: The distance between A and B is X = It is X from A to B." },
    { id: 98, type: "fill", q: "98. Vi·∫øt l·∫°i c√¢u c√≥ ch·ª©a t·ª´ (should):<br>It is good for every student to write a paragraph on this topic.", a: "Every student should write a paragraph on this topic.", ex: "C·∫•u tr√∫c: It is good for sb to do sth = Sb should do sth (Ai ƒë√≥ N√äN l√†m g√¨)." }
    // ... M√¨nh gi·ªØ m·∫´u 2 c√¢u t·ª± lu·∫≠n, b·∫°n c√≥ th·ªÉ copy l·∫°i ph·∫ßn t·ª± lu·∫≠n t·ª´ code c≈© n·∫øu c·∫ßn ƒë·∫ßy ƒë·ªß 120 c√¢u nh√©.
];

let score = 0; let totalQuestions = rawData.length; let answeredCount = 0;

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    container.innerHTML = ''; 
    rawData.forEach((item, index) => {
        const card = document.createElement('div'); card.className = 'card'; card.id = `q-card-${item.id}`;
        let questionHTML = `<div class="question-title">${item.q}</div>`;

        if (item.type === 'mcq') {
            let shuffledOptions = [...item.o].sort(() => Math.random() - 0.5);
            let optionsHTML = `<div class="options-grid">`;
            shuffledOptions.forEach(opt => { optionsHTML += `<button class="btn-option" onclick="checkMCQ(this, '${item.a}', ${item.id})">${opt}</button>`; });
            questionHTML += optionsHTML + `</div>`;
        } 
        else if (item.type === 'find_and_fix') {
            questionHTML += `<div class="sentence-box">${item.html}</div>`;
            questionHTML += `
                <div class="correction-area" id="correct-area-${item.id}" style="display: none;">
                    <p>M·∫Øt tinh qu√°! B√¢y gi·ªù h√£y g√µ t·ª´ ƒê√öNG v√†o √¥ d∆∞·ªõi ƒë√¢y nh√©:</p>
                    <div class="input-group">
                        <input type="text" class="text-input" id="input-${item.id}" placeholder="S·ª≠a l·∫°i th√†nh..." autocomplete="off">
                        <button class="btn-check" onclick="checkCorrection(${item.id}, '${item.a}')">X√°c nh·∫≠n</button>
                    </div>
                </div>
            `;
        }
        else if (item.type === 'fill') {
            questionHTML += `
                <div class="input-group">
                    <input type="text" class="text-input" id="input-${item.id}" placeholder="Nh·∫≠p ƒë√°p √°n c·ªßa b·∫°n..." autocomplete="off">
                    <button class="btn-check" onclick="checkFill(${item.id})">Ki·ªÉm tra</button>
                </div>
            `;
        }

        const parts = item.ex.split('|');
        let exHTML = `<div class="explanation" id="ex-${item.id}">`;
        exHTML += `<div class="ex-step"><b>1. Ph√¢n t√≠ch & D·ªãch:</b> ${parts[0]}</div>`;
        if(parts[1]) exHTML += `<div class="ex-step"><b>2. L√Ω do ƒë√∫ng:</b> ${parts[1]}</div>`;
        if(parts[2]) exHTML += `<div class="ex-step"><b>3. Gi·∫£i th√≠ch th√™m:</b> ${parts[2]}</div>`;
        exHTML += `</div>`;
        card.innerHTML = questionHTML + exHTML; container.appendChild(card);
    });
}

// Logic MCQ
function checkMCQ(btnElement, correctAnswer, qId) {
    const card = document.getElementById(`q-card-${qId}`);
    if(card.classList.contains('answered')) return; card.classList.add('answered');
    const buttons = card.querySelectorAll('.btn-option');
    buttons.forEach(b => b.disabled = true);
    document.getElementById(`ex-${qId}`).style.display = 'block';

    if (btnElement.innerText.trim() === correctAnswer) {
        btnElement.classList.add('correct'); playDing(); fireConfetti(); score++;
    } else {
        btnElement.classList.add('wrong'); playBuzz();
        buttons.forEach(b => { if (b.innerText.trim() === correctAnswer) b.classList.add('correct'); });
    }
    answeredCount++;
}

// LOGIC T√åM L·ªñI SAI (NEW)
function selectError(element, isError, qId) {
    if (element.closest('.card').classList.contains('step1-done')) return;
    
    if (isError) {
        element.classList.add('selected-correct');
        element.closest('.card').classList.add('step1-done'); // Kh√≥a v√≤ng 1
        playDing();
        document.getElementById(`correct-area-${qId}`).style.display = 'block';
        
        // V√¥ hi·ªáu h√≥a c√°c n√∫t g·∫°ch ch√¢n kh√°c
        const opts = element.closest('.sentence-box').querySelectorAll('.err-opt');
        opts.forEach(o => o.style.pointerEvents = 'none');
    } else {
        element.classList.add('selected-wrong');
        playBuzz();
        setTimeout(() => element.classList.remove('selected-wrong'), 600); // Cho ph√©p th·ª≠ l·∫°i
    }
}

// LOGIC CH·∫§M S·ª¨A L·ªñI ƒêI·ªÄN T·ª™
function checkCorrection(qId, correctWord) {
    const inputEl = document.getElementById(`input-${qId}`);
    const btnEl = inputEl.nextElementSibling;
    const userAnswer = inputEl.value.trim().toLowerCase();
    
    inputEl.disabled = true; btnEl.disabled = true;
    document.getElementById(`ex-${qId}`).style.display = 'block';

    if (userAnswer === correctWord.toLowerCase()) {
        inputEl.style.borderColor = '#00D26A'; inputEl.style.backgroundColor = '#e6fff2';
        playDing(); fireConfetti(); score++;
    } else {
        inputEl.style.borderColor = '#FF4757'; inputEl.style.backgroundColor = '#ffe6e8';
        inputEl.value = correctWord; // G·ª£i √Ω t·ª´ ƒë√∫ng
        inputEl.style.color = '#FF4757'; inputEl.style.fontWeight = 'bold';
        playBuzz(); inputEl.parentElement.style.animation = 'shake 0.4s ease';
    }
    answeredCount++;
}

// Logic T·ª± lu·∫≠n ng·∫Øn (Fill in)
function checkFill(qId) {
    const inputEl = document.getElementById(`input-${qId}`);
    const btnEl = inputEl.nextElementSibling;
    const itemData = rawData.find(d => d.id === qId);
    
    inputEl.disabled = true; btnEl.disabled = true;
    document.getElementById(`ex-${qId}`).style.display = 'block';

    const userAnswer = inputEl.value.trim().toLowerCase().replace(/[.?,]/g, '');
    const correctAnswer = itemData.a.toLowerCase().replace(/[.?,]/g, '');

    if (userAnswer === correctAnswer) {
        inputEl.style.borderColor = '#00D26A'; inputEl.style.backgroundColor = '#e6fff2';
        playDing(); fireConfetti(); score++;
    } else {
        inputEl.style.borderColor = '#FF4757'; inputEl.style.backgroundColor = '#ffe6e8';
        inputEl.value = itemData.a; inputEl.style.color = '#FF4757'; inputEl.style.fontWeight = 'bold';
        playBuzz(); inputEl.parentElement.style.animation = 'shake 0.4s ease';
    }
    answeredCount++;
}

function showResults() {
    const popup = document.getElementById('result-popup');
    const title = document.getElementById('result-title');
    const msg = document.getElementById('result-message');
    document.getElementById('result-score').innerText = `B·∫°n ƒë·∫°t ${score} / ${totalQuestions} ƒëi·ªÉm`;
    
    let ratio = score / totalQuestions;
    if (ratio >= 0.9) { title.innerText = "Xu·∫•t s·∫Øc! üèÜ"; msg.innerText = "Gi·ªèi qu√° ƒëi m·∫•t!"; playDing(); fireConfetti(); fireConfetti(); }
    else if (ratio >= 0.5) { title.innerText = "Kh√° l·∫Øm! üëç"; msg.innerText = "C·ªë g·∫Øng l√™n x√≠u n·ªØa nh√©!"; playDing(); fireConfetti(); }
    else { title.innerText = "C·ªë l√™n n√†o! üí™"; msg.innerText = "ƒê·ª´ng n·∫£n ch√≠! ƒê·ªçc gi·∫£i th√≠ch th·∫≠t k·ªπ nh√©."; playBuzz(); }
    popup.style.display = 'flex';
}

window.onload = renderQuiz;
</script>
</body>
</html>