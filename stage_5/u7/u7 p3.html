<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Gi·ªõi T·ª´ Part 2 - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-color: #00D26A;
            --wrong-color: #FF4757;
            --bg-color: #E0F7FA;
            --card-bg: #ffffff;
            --text-color: #2d3436;
            --accent-yellow: #FFC312;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: 
                linear-gradient(45deg, #f1f2f6 25%, transparent 25%, transparent 75%, #f1f2f6 75%, #f1f2f6),
                linear-gradient(45deg, #f1f2f6 25%, transparent 25%, transparent 75%, #f1f2f6 75%, #f1f2f6);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 25px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.05);
            border: 3px solid var(--primary-purple);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(136,84,192,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        h1 {
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-purple);
            font-size: 1.8rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }
        
        .teacher-badge {
            background: var(--primary-teal);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-top: 10px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        /* Quiz Card */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.05);
            position: relative;
            border: 2px solid #fff;
            transition: transform 0.3s ease;
        }

        .question-tag {
            background: var(--accent-yellow);
            color: #333;
            padding: 8px 20px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 30px;
            line-height: 1.5;
            color: #2d3436;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 3px solid #f1f2f6;
            border-radius: 18px;
            padding: 18px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: #57606f;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary-purple);
            transform: translateY(-3px);
            color: var(--primary-purple);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        /* Logic Styles */
        .option-btn.correct {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
            box-shadow: 0 5px 15px rgba(0, 210, 106, 0.4);
        }

        .option-btn.wrong {
            background-color: var(--wrong-color);
            color: white;
            border-color: var(--wrong-color);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Explanation Section */
        .explanation-box {
            display: none;
            margin-top: 30px;
            background: #fff0f6; /* Light pink bg */
            border: 2px dashed var(--primary-purple);
            padding: 25px;
            border-radius: 20px;
            animation: popIn 0.4s ease-out;
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .teacher-avatar {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(0,0,0,0.05);
            padding-bottom: 10px;
        }

        .teacher-avatar i {
            font-size: 2rem;
            color: var(--primary-purple);
            background: white;
            padding: 10px;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .exp-title {
            font-weight: 800;
            color: var(--primary-purple);
            font-size: 1.1rem;
        }

        .vocab-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.95rem;
        }

        .vocab-table th, .vocab-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .vocab-table th {
            background: var(--primary-teal);
            color: white;
            font-weight: 700;
        }

        .reason-block {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .highlight-green { color: var(--correct-color); font-weight: 800; }
        .highlight-red { color: var(--wrong-color); font-weight: 800; }

        /* Visual Question Elements */
        .store-sign {
            background: #2c3e50;
            color: #f1c40f;
            width: 80%;
            margin: 20px auto;
            padding: 20px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border: 5px solid #bdc3c7;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transform: rotate(1deg);
        }

        .chat-bubble {
            background: #007AFF;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            border-bottom-right-radius: 5px;
            max-width: 70%;
            margin: 20px auto;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            position: relative;
        }
        .chat-bubble::after {
            content: 'Delivered';
            position: absolute;
            bottom: -20px;
            right: 0;
            font-size: 0.7rem;
            color: #999;
        }

        /* Footer */
        .footer-controls {
            text-align: center;
            margin-top: 50px;
            padding-bottom: 50px;
        }

        .submit-btn {
            background: linear-gradient(to right, var(--primary-purple), var(--primary-teal));
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.3rem;
            font-weight: 800;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.4);
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(136, 84, 192, 0.5);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 450px;
            animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 10px solid var(--primary-purple);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-purple);
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>B√†i T·∫≠p Gi·ªõi T·ª´ (Part 2)</h1>
        <div class="teacher-badge"><i class="fas fa-star"></i> Gi√°o vi√™n: Ms Mai An ULIS</div>
    </header>

    <div id="quiz-area">
        </div>

    <div class="footer-controls">
        <button class="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI & NH·∫¨N QU√Ä <i class="fas fa-gift"></i></button>
    </div>
</div>

<div id="scoreModal" class="modal">
    <div class="modal-content">
        <div class="score-circle" id="finalScore">0/30</div>
        <h2 id="feedbackTitle">K·∫æT QU·∫¢</h2>
        <p id="feedbackMessage" style="font-size: 1.1rem; color: #666; margin-bottom: 25px;">...</p>
        <button class="submit-btn" onclick="location.reload()">L√ÄM L·∫†I ƒê·ªÄ M·ªöI <i class="fas fa-redo"></i></button>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI (30 C√¢u - ƒê·ªïi ng·ªØ c·∫£nh) ---
    const questionData = [
        {
            q: "The shops are usually closed ______ midnight.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i (th·ªùi ƒëi·ªÉm)", d:"ƒê·∫øn"},
            trans: "C√°c c·ª≠a h√†ng th∆∞·ªùng ƒë√≥ng c·ª≠a l√∫c n·ª≠a ƒë√™m.",
            why_true: "D√πng 'at' cho c√°c th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong ng√†y: at midnight, at noon, at night.",
            why_false: "Midnight l√† th·ªùi ƒëi·ªÉm, kh√¥ng d√πng in/on."
        },
        {
            q: "My favorite cartoon starts ______ 7:30 p.m.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"L√∫c (gi·ªù)", d:"ƒê·∫øn"},
            trans: "B·ªô phim ho·∫°t h√¨nh y√™u th√≠ch c·ªßa t√¥i b·∫Øt ƒë·∫ßu l√∫c 7:30 t·ªëi.",
            why_true: "D√πng 'at' tr∆∞·ªõc gi·ªù ƒë·ªìng h·ªì c·ª• th·ªÉ (at 7:30 p.m.).",
            why_false: "In/On kh√¥ng d√πng cho gi·ªù gi·∫•c."
        },
        {
            q: "We moved to this city ______ 2021.",
            a: "in", b: "on", c: "at", d: "since", correct: "a",
            vocab: {a:"V√†o (nƒÉm)", b:"V√†o (ng√†y)", c:"T·∫°i", d:"K·ªÉ t·ª´"},
            trans: "Ch√∫ng t√¥i chuy·ªÉn ƒë·∫øn th√†nh ph·ªë n√†y v√†o nƒÉm 2021.",
            why_true: "D√πng 'in' tr∆∞·ªõc nƒÉm (in 2021, in 1999).",
            why_false: "On d√πng cho ng√†y, At d√πng cho gi·ªù."
        },
        {
            q: "Do you have any plans ______ Tuesday?",
            a: "in", b: "on", c: "at", d: "of", correct: "b",
            vocab: {a:"Trong", b:"V√†o (th·ª©)", c:"T·∫°i", d:"C·ªßa"},
            trans: "B·∫°n c√≥ k·∫ø ho·∫°ch g√¨ v√†o th·ª© Ba kh√¥ng?",
            why_true: "D√πng 'on' tr∆∞·ªõc c√°c th·ª© trong tu·∫ßn (on Monday, on Tuesday...).",
            why_false: "In d√πng cho th√°ng/nƒÉm, At d√πng cho gi·ªù."
        },
        {
            q: "Leaves often fall ______ autumn.",
            a: "in", b: "on", c: "at", d: "to", correct: "a",
            vocab: {a:"V√†o (m√πa)", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "L√° th∆∞·ªùng r·ª•ng v√†o m√πa thu.",
            why_true: "D√πng 'in' tr∆∞·ªõc c√°c m√πa (in spring, in summer, in autumn, in winter).",
            why_false: "M√πa l√† kho·∫£ng th·ªùi gian d√†i, d√πng 'in', kh√¥ng d√πng on/at."
        },
        {
            q: "The children are playing ______ the moment.",
            a: "in", b: "on", c: "at", d: "with", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"V·ªõi"},
            trans: "B·ªçn tr·∫ª ƒëang ch∆°i ƒë√πa ngay l√∫c n√†y.",
            why_true: "C·ª•m c·ªë ƒë·ªãnh: 'at the moment' = now (ngay b√¢y gi·ªù).",
            why_false: "In the moment l√† sai ng·ªØ ph√°p trong ng·ªØ c·∫£nh n√†y."
        },
        {
            q: "Can you finish the report ______ 10 minutes?",
            a: "in", b: "on", c: "at", d: "for", correct: "a",
            vocab: {a:"Trong (t∆∞∆°ng lai)", b:"Tr√™n", c:"T·∫°i", d:"Kho·∫£ng"},
            trans: "B·∫°n c√≥ th·ªÉ ho√†n th√†nh b√°o c√°o trong 10 ph√∫t n·ªØa kh√¥ng?",
            why_true: "D√πng 'in' + kho·∫£ng th·ªùi gian ƒë·ªÉ ch·ªâ t∆∞∆°ng lai (bao l√¢u n·ªØa th√¨ xong vi·ªác g√¨).",
            why_false: "For 10 minutes nghƒ©a l√† l√†m vi·ªác ƒë√≥ k√©o d√†i 10 ph√∫t, c√≤n 'in' nghƒ©a l√† sau 10 ph√∫t n·ªØa s·∫Ω xong."
        },
        {
            q: "We usually visit the pagoda ______ the first day of the Lunar New Year.",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"V√†o (ng√†y)", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "Ch√∫ng t√¥i th∆∞·ªùng ƒëi ch√πa v√†o ng√†y ƒë·∫ßu ti√™n c·ªßa T·∫øt Nguy√™n ƒê√°n.",
            why_true: "D√π c√¢u d√†i, nh∆∞ng danh t·ª´ ch√≠nh l√† 'Day' (The first day) -> D√πng 'on'.",
            why_false: "C·ª© c√≥ ch·ªØ 'Day' ch·ªâ ng√†y c·ª• th·ªÉ l√† d√πng On."
        },
        {
            q: "I often feel sleepy ______ the afternoon.",
            a: "in", b: "on", c: "at", d: "to", correct: "a",
            vocab: {a:"V√†o (bu·ªïi)", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "T√¥i th∆∞·ªùng c·∫£m th·∫•y bu·ªìn ng·ªß v√†o bu·ªïi chi·ªÅu.",
            why_true: "D√πng 'in' cho c√°c bu·ªïi trong ng√†y: in the morning, in the afternoon, in the evening.",
            why_false: "At noon/night, c√≤n afternoon ph·∫£i d√πng in."
        },
        {
            q: "Halloween is celebrated ______ October.",
            a: "in", b: "on", c: "at", d: "of", correct: "a",
            vocab: {a:"Trong (th√°ng)", b:"V√†o (ng√†y)", c:"T·∫°i", d:"C·ªßa"},
            trans: "L·ªÖ Halloween ƒë∆∞·ª£c t·ªï ch·ª©c v√†o th√°ng 10.",
            why_true: "D√πng 'in' tr∆∞·ªõc th√°ng (in January, in October).",
            why_false: "N·∫øu c√≥ ng√†y (October 31st) m·ªõi d√πng On. Ch·ªâ c√≥ th√°ng th√¨ d√πng In."
        },
        {
            q: "My father drives ______ work every day.",
            a: "in", b: "on", c: "at", d: "to", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "B·ªë t√¥i l√°i xe ƒëi l√†m m·ªói ng√†y.",
            why_true: "Drive (ƒë·ªông t·ª´ chuy·ªÉn ƒë·ªông) + to + ƒë·ªãa ƒëi·ªÉm (work). Drive to work = L√°i xe ƒëi l√†m.",
            why_false: "At work l√† 'ƒëang ·ªü ch·ªó l√†m' (v·ªã tr√≠), c√≤n l√°i xe 'ƒë·∫øn' th√¨ ph·∫£i d√πng to."
        },
        {
            q: "Please turn off your phone ______ the meeting.",
            a: "in", b: "on", c: "at", d: "during", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"Trong su·ªët"},
            trans: "Vui l√≤ng t·∫Øt ƒëi·ªán tho·∫°i trong su·ªët cu·ªôc h·ªçp.",
            why_true: "'During' d√πng ƒë·ªÉ ch·ªâ h√†nh ƒë·ªông x·∫£y ra trong su·ªët m·ªôt s·ª± ki·ªán. (In c≈©ng c√≥ th·ªÉ ch·∫•p nh·∫≠n nh∆∞ng During ch√≠nh x√°c h∆°n v·ªÅ ng·ªØ nghƒ©a th·ªùi gian k√©o d√†i). Trong b√†i t·∫≠p in/on/at c∆° b·∫£n, 'in the meeting' c≈©ng d√πng ƒë∆∞·ª£c, nh∆∞ng n·∫øu ƒë·ªÅ l√† 'in/on/at/during' th√¨ during t·ªët nh·∫•t.",
            why_false: "Tuy nhi√™n, ƒë·ªÅ b√†i n√†y t·∫≠p trung in/on/at. N·∫øu ƒë√°p √°n ch·ªâ c√≥ in/on/at -> Ch·ªçn 'in'. ·ªû ƒë√¢y t√¥i ƒë·ªÉ 'during' l√†m ƒë√°p √°n ƒë√∫ng ƒë·ªÉ m·ªü r·ªông, nh∆∞ng n·∫øu b·∫Øt bu·ªôc in/on/at/to th√¨ d√πng 'in'."
        },
        {
            q: "Wait! I think someone is standing ______ the gate.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "ƒê·ª£i ƒë√£! T√¥i nghƒ© c√≥ ai ƒë√≥ ƒëang ƒë·ª©ng ·ªü c·ªïng.",
            why_true: "Ch·ªâ v·ªã tr√≠ t·∫°i m·ªôt ƒëi·ªÉm m·ªëc (at the gate, at the door, at the bus stop).",
            why_false: "On the gate (ng·ªìi tr√™n c√°i c·ªïng?), In the gate (trong kh·ªëi v·∫≠t ch·∫•t c·ªßa c√°i c·ªïng?)."
        },
        {
            q: "Computers became popular ______ the 20th century.",
            a: "in", b: "on", c: "at", d: "to", correct: "a",
            vocab: {a:"Trong (th·∫ø k·ª∑)", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "M√°y t√≠nh tr·ªü n√™n ph·ªï bi·∫øn v√†o th·∫ø k·ª∑ 20.",
            why_true: "D√πng 'in' tr∆∞·ªõc th·∫ø k·ª∑ (in the 20th century).",
            why_false: "Th·∫ø k·ª∑ l√† kho·∫£ng th·ªùi gian d√†i -> d√πng In."
        },
        {
            q: "Are you going ______ the supermarket now?",
            a: "in", b: "on", c: "at", d: "to", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "B√¢y gi·ªù b·∫°n ƒëang ƒëi ƒë·∫øn si√™u th·ªã √†?",
            why_true: "Go (ƒë·ªông t·ª´ chuy·ªÉn ƒë·ªông) + to + ƒë·ªãa ƒëi·ªÉm.",
            why_false: "Go at/in/on l√† sai v·ªõi nghƒ©a di chuy·ªÉn."
        },
        {
            q: "We will meet ______ lunchtime.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"V√†o l√∫c", d:"ƒê·∫øn"},
            trans: "Ch√∫ng ta s·∫Ω g·∫∑p nhau v√†o gi·ªù ƒÉn tr∆∞a.",
            why_true: "Lunchtime l√† m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong ng√†y -> D√πng 'at'.",
            why_false: "Gi·ªëng nh∆∞ 'at noon'."
        },
        {
            q: "He runs ______ the park every morning to exercise.",
            a: "in", b: "at", c: "to", d: "on", correct: "a",
            vocab: {a:"Trong (ƒë·ªãa ƒëi·ªÉm)", b:"T·∫°i", c:"ƒê·∫øn", d:"Tr√™n"},
            trans: "Anh ·∫•y ch·∫°y b·ªô trong c√¥ng vi√™n m·ªói s√°ng ƒë·ªÉ t·∫≠p th·ªÉ d·ª•c.",
            why_true: "Run in the park = Ch·∫°y b√™n trong khu√¥n vi√™n c√¥ng vi√™n. (Kh√°c v·ªõi Run to the park = Ch·∫°y t·ª´ nh√† ƒë·∫øn c√¥ng vi√™n). Ng·ªØ c·∫£nh t·∫≠p th·ªÉ d·ª•c th∆∞·ªùng l√† ch·∫°y b√™n trong.",
            why_false: "D√πng 'to' n·∫øu mu·ªën n√≥i ƒë√≠ch ƒë·∫øn. Nh∆∞ng 'exercise' th∆∞·ªùng di·ªÖn ra 'in' (b√™n trong)."
        },
        {
            q: "I'll see you ______ next week!",
            a: "in", b: "on", c: "at", d: "X (no word)", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"X (kh√¥ng ƒëi·ªÅn)"},
            trans: "G·∫∑p b·∫°n tu·∫ßn sau nh√©!",
            why_true: "Kh√¥ng d√πng gi·ªõi t·ª´ tr∆∞·ªõc 'next', 'last', 'this' (next week, last month, this year).",
            why_false: "In/On next week l√† l·ªói sai ph·ªï bi·∫øn c·ªßa ng∆∞·ªùi Vi·ªát."
        },
        {
            q: "The cat is sleeping ______ the sofa.",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "Con m√®o ƒëang ng·ªß tr√™n gh·∫ø s√¥-pha.",
            why_true: "Sofa l√† b·ªÅ m·∫∑t -> D√πng 'on'.",
            why_false: "In the sofa (chui v√†o trong ƒë·ªám?), At the sofa (ng·ªìi c·∫°nh?). On l√† chu·∫©n nh·∫•t."
        },
        {
            q: "My birthday is ______ July 20th.",
            a: "in", b: "on", c: "at", d: "of", correct: "b",
            vocab: {a:"Trong", b:"V√†o (ng√†y)", c:"T·∫°i", d:"C·ªßa"},
            trans: "Sinh nh·∫≠t t√¥i l√† v√†o ng√†y 20 th√°ng 7.",
            why_true: "Ng√†y th√°ng c·ª• th·ªÉ -> D√πng 'on'.",
            why_false: "C√≥ th√°ng nh∆∞ng c√≥ c·∫£ ng√†y th√¨ 'On' m·∫°nh h∆°n 'In'."
        },
        {
            q: "Can you come ______ my party on Saturday?",
            a: "in", b: "on", c: "at", d: "to", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "B·∫°n c√≥ th·ªÉ ƒë·∫øn b·ªØa ti·ªác c·ªßa m√¨nh v√†o th·ª© B·∫£y kh√¥ng?",
            why_true: "Come (ƒë·∫øn) + to + s·ª± ki·ªán/ƒë·ªãa ƒëi·ªÉm.",
            why_false: "Come at/in l√† sai."
        },
        {
            q: "It is dangerous to go out alone ______ night.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"V√†o", d:"ƒê·∫øn"},
            trans: "ƒêi ra ngo√†i m·ªôt m√¨nh v√†o ban ƒë√™m r·∫•t nguy hi·ªÉm.",
            why_true: "C·ª•m c·ªë ƒë·ªãnh: 'at night'.",
            why_false: "In the night (c√≥ d√πng nh∆∞ng √≠t ph·ªï bi·∫øn h∆°n v√† mang nghƒ©a c·ª• th·ªÉ ƒë√™m ƒë√≥, c√≤n n√≥i chung chung l√† at night)."
        },
        {
            q: "Put your books ______ the table, please.",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "L√†m ∆°n ƒë·∫∑t s√°ch c·ªßa b·∫°n l√™n tr√™n b√†n.",
            why_true: "M·∫∑t b√†n l√† b·ªÅ m·∫∑t -> D√πng 'on'.",
            why_false: "In the table (trong ngƒÉn b√†n - ph·∫£i n√≥i r√µ l√† drawer). Table th∆∞·ªùng d√πng On."
        },
        {
            q: "We stayed in a hotel ______ the beach.",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "Ch√∫ng t√¥i ƒë√£ ·ªü m·ªôt kh√°ch s·∫°n tr√™n b√£i bi·ªÉn.",
            why_true: "C·ª•m c·ªë ƒë·ªãnh: 'on the beach' (n·∫±m tr√™n b√£i bi·ªÉn/s√°t bi·ªÉn).",
            why_false: "In the beach (trong c√°t?), At the beach (c≈©ng d√πng ƒë∆∞·ª£c ch·ªâ v·ªã tr√≠ chung chung, nh∆∞ng 'on the beach' ph·ªï bi·∫øn h∆°n khi n√≥i v·ªÅ v·ªã tr√≠ ƒë·ªãa l√Ω c·ªßa kh√°ch s·∫°n view bi·ªÉn)."
        },
        {
            q: "Don't worry! I will be there ______ time.",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"ƒê√∫ng", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "ƒê·ª´ng lo! T√¥i s·∫Ω ·ªü ƒë√≥ ƒë√∫ng gi·ªù.",
            why_true: "On time = ƒê√∫ng gi·ªù (ch√≠nh x√°c). (In time = K·ªãp gi·ªù). Trong ng·ªØ c·∫£nh h·ª©a h·∫πn, 'on time' th∆∞·ªùng ƒë∆∞·ª£c d√πng.",
            why_false: "At time (sai), To time (sai)."
        },
        {
            q: "They got married ______ Easter.",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"V√†o", c:"V√†o d·ªãp", d:"ƒê·∫øn"},
            trans: "H·ªç k·∫øt h√¥n v√†o d·ªãp l·ªÖ Ph·ª•c Sinh.",
            why_true: "Easter (L·ªÖ Ph·ª•c Sinh) l√† d·ªãp l·ªÖ, kh√¥ng c√≥ ch·ªØ 'Day' -> D√πng 'at' (At Easter, At Christmas).",
            why_false: "N·∫øu l√† 'Easter Day' th√¨ d√πng On. Kh√¥ng c√≥ Day d√πng At."
        },
        {
            q: "The office is open from 8 a.m. ______ 5 p.m.",
            a: "in", b: "on", c: "at", d: "to", correct: "d",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "VƒÉn ph√≤ng m·ªü c·ª≠a t·ª´ 8 gi·ªù s√°ng ƒë·∫øn 5 gi·ªù chi·ªÅu.",
            why_true: "C·∫•u tr√∫c: 'From... to...' (T·ª´... ƒë·∫øn...).",
            why_false: "From... at/in l√† sai c·∫•u tr√∫c."
        },
        {
            q: "See you ______ Monday morning!",
            a: "in", b: "on", c: "at", d: "to", correct: "b",
            vocab: {a:"Trong", b:"V√†o", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "H·∫πn g·∫∑p l·∫°i v√†o s√°ng th·ª© Hai!",
            why_true: "C√≥ 'Monday' (th·ª©) l√† d√πng 'on', d√π ph√≠a sau c√≥ morning.",
            why_false: "∆Øu ti√™n Th·ª© -> D√πng On."
        },
        // Visual 1
        {
            q: "OPENING HOURS:<br>Lunch Break: ______ 12:00",
            type: "visual-sign",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"L√∫c", d:"ƒê·∫øn"},
            trans: "GI·ªú M·ªû C·ª¨A: Ngh·ªâ tr∆∞a l√∫c 12:00.",
            why_true: "12:00 l√† gi·ªù c·ª• th·ªÉ -> D√πng 'at'.",
            why_false: "Gi·ªù ƒë·ªìng h·ªì b·∫Øt bu·ªôc d√πng At."
        },
        // Visual 2
        {
            q: "I'm busy ______ the moment. Call you later!",
            type: "visual-chat",
            a: "in", b: "on", c: "at", d: "to", correct: "c",
            vocab: {a:"Trong", b:"Tr√™n", c:"T·∫°i", d:"ƒê·∫øn"},
            trans: "T√¥i ƒëang b·∫≠n l√∫c n√†y. G·ªçi l·∫°i sau nh√©!",
            why_true: "C·ª•m 'at the moment'.",
            why_false: "C√°c gi·ªõi t·ª´ kh√°c kh√¥ng ƒëi v·ªõi 'moment'."
        }
    ];

    // --- LOGIC X·ª¨ L√ù (GI·ªÆ NGUY√äN T·ª™ PH·∫¶N TR∆Ø·ªöC) ---
    
    // Shuffle Function
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    let score = 0;
    const audioCorrect = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');
    const audioWrong = new Audio('https://actions.google.com/sounds/v1/cartoon/clown_horn.ogg');

    window.onload = function() {
        shuffleArray(questionData);
        renderQuiz();
    }

    function renderQuiz() {
        const area = document.getElementById('quiz-area');
        area.innerHTML = '';

        questionData.forEach((item, index) => {
            let qContent = item.q;
            if (item.type === 'visual-sign') {
                qContent = `<div class="store-sign">${item.q}</div>`;
            } else if (item.type === 'visual-chat') {
                qContent = `<div class="chat-bubble">${item.q}</div>`;
            }

            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.innerHTML = `
                <span class="question-tag">C√¢u h·ªèi ${index + 1}</span>
                <div class="question-text">${qContent}</div>
                <div class="options-grid">
                    <button class="option-btn" onclick="check(this, '${item.correct}', ${index})">A. ${item.a}</button>
                    <button class="option-btn" onclick="check(this, '${item.correct}', ${index})">B. ${item.b}</button>
                    <button class="option-btn" onclick="check(this, '${item.correct}', ${index})">C. ${item.c}</button>
                    <button class="option-btn" onclick="check(this, '${item.correct}', ${index})">D. ${item.d}</button>
                </div>
                
                <div class="explanation-box" id="exp-${index}">
                    <div class="teacher-avatar">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <div>
                            <div class="exp-title">C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</div>
                            <small>ƒê·ªçc k·ªπ ƒë·ªÉ hi·ªÉu b√†i con nh√©!</small>
                        </div>
                    </div>

                    <table class="vocab-table">
                        <tr><th>T·ª´ v·ª±ng</th><th>Nghƒ©a ti·∫øng Vi·ªát</th></tr>
                        <tr><td>A. ${item.a}</td><td>${item.vocab.a}</td></tr>
                        <tr><td>B. ${item.b}</td><td>${item.vocab.b}</td></tr>
                        <tr><td>C. ${item.c}</td><td>${item.vocab.c}</td></tr>
                        <tr><td>D. ${item.d}</td><td>${item.vocab.d}</td></tr>
                    </table>

                    <p style="font-style: italic; color: #007AFF;"><strong>üëâ D·ªãch c√¢u:</strong> "${item.trans}"</p>
                    
                    <div class="reason-block">
                        <div class="highlight-green">‚úÖ T·∫†I SAO ƒê√öNG?</div>
                        <p>${item.why_true}</p>
                        <div class="highlight-red" style="margin-top:10px;">‚ùå T·∫†I SAO SAI?</div>
                        <p>${item.why_false}</p>
                    </div>
                </div>
            `;
            area.appendChild(card);
        });
    }

    function check(btn, correctVal, index) {
        // Prevent multiple clicks
        const parent = btn.parentElement;
        const allBtns = parent.getElementsByClassName('option-btn');
        let isCorrect = false;

        // Check content of button (A, B, C, D) starts with correctVal
        const chosenVal = btn.innerText.charAt(0).toLowerCase();

        if (chosenVal === correctVal) {
            btn.classList.add('correct');
            isCorrect = true;
            score++;
            audioCorrect.currentTime = 0;
            audioCorrect.play();
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#8854C0', '#00C9A7', '#FFC312']
            });
        } else {
            btn.classList.add('wrong');
            audioWrong.currentTime = 0;
            audioWrong.play();
            // Show correct answer
            for(let b of allBtns) {
                if (b.innerText.charAt(0).toLowerCase() === correctVal) {
                    b.classList.add('correct');
                }
            }
        }

        // Disable all
        for(let b of allBtns) b.disabled = true;

        // Show Explanation
        document.getElementById(`exp-${index}`).style.display = 'block';
    }

    function submitQuiz() {
        const modal = document.getElementById('scoreModal');
        const scoreTxt = document.getElementById('finalScore');
        const msg = document.getElementById('feedbackMessage');
        const title = document.getElementById('feedbackTitle');

        scoreTxt.innerText = `${score}/30`;
        
        if (score === 30) {
            title.innerText = "XU·∫§T S·∫ÆC! üèÜ";
            msg.innerText = "Con ƒë√£ n·∫Øm v·ªØng to√†n b·ªô ki·∫øn th·ª©c v·ªÅ Gi·ªõi t·ª´! C√¥ Mai An r·∫•t t·ª± h√†o!";
        } else if (score >= 20) {
            title.innerText = "L√ÄM T·ªêT L·∫ÆM! üéâ";
            msg.innerText = "Ki·∫øn th·ª©c c·ªßa con kh√° v·ªØng, ch·ªâ c·∫ßn c·∫©n th·∫≠n h∆°n m·ªôt ch√∫t n·ªØa th√¥i.";
        } else {
            title.innerText = "C·ªê L√äN NH√â! üí™";
            msg.innerText = "ƒê·ª´ng n·∫£n l√≤ng! H√£y ƒë·ªçc l·∫°i ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt ƒë·ªÉ hi·ªÉu r√µ h∆°n nh√©.";
        }

        modal.style.display = 'flex';
        if (score > 15) {
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.5 }
            });
        }
    }
</script>

</body>
</html>