<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - English Practice Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* H·ªìng t√≠m pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --text-dark: #2f3542;
            --bg-pattern: radial-gradient(#ffffff 15%, transparent 16%) 0 0, radial-gradient(#ffffff 15%, transparent 16%) 8px 8px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px, radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;
            --bg-color: #f3e5f5;
        }

        * {
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: var(--bg-pattern);
            background-size: 20px 20px;
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px dashed #e0e0e0;
            padding-bottom: 20px;
        }

        h1 {
            color: var(--primary);
            font-family: 'Quicksand', sans-serif;
            font-weight: 800;
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
        }

        .teacher-name {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        /* Question Section */
        .section-title {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
            box-shadow: 0 4px 0 #6c4299;
        }

        .question-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 40px;
            transition: all 0.3s ease;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .reading-passage {
            background: #f8f9fa;
            border-left: 5px solid var(--secondary);
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Quicksand', sans-serif;
            line-height: 1.6;
            border-radius: 10px;
            white-space: pre-line;
            font-size: 1.05rem;
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media(min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            box-shadow: 0 5px 0 #ddd;
            color: #555;
        }

        .option-btn:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--secondary);
            background: #f0fffc;
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(5px);
            box-shadow: none;
        }

        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: var(--correct);
            box-shadow: 0 5px 0 #00a352;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: var(--wrong);
            box-shadow: 0 5px 0 #c43240;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            cursor: not-allowed;
            opacity: 0.7;
            pointer-events: none;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 20px;
            background: #fff8e1;
            border: 2px solid #ffecb3;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-header {
            font-weight: 800;
            color: #ff6f00;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-detail {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .exp-detail strong {
            color: var(--primary);
        }

        /* Glossary Table */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .glossary-table th {
            background: var(--secondary);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            50% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Score & Submit */
        .controls {
            margin-top: 30px;
            text-align: center;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #00967d;
            font-weight: 800;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #00967d;
        }

        .submit-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* Confetti Canvas */
        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Result Popup */
        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 90%;
        }

        .result-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .result-score {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 10px 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

    </style>
</head>
<body>

<canvas id="confetti"></canvas>
<div class="overlay" id="overlay"></div>

<div class="container">
    <header>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <h1>ENGLISH PRACTICE GAME</h1>
        <p style="color: #888">Interactive Quiz for Students</p>
    </header>

    <div id="quiz-content">
        </div>

    <div class="controls">
        <button class="submit-btn" onclick="finishQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
    </div>
</div>

<div class="result-popup" id="resultPopup">
    <h2 style="color: var(--secondary)">K·∫æT QU·∫¢ C·ª¶A CON</h2>
    <div class="result-score" id="scoreDisplay">0/0</div>
    <p id="feedbackText" style="font-size: 1.2rem; color: #555;">L√†m t·ªët l·∫Øm!</p>
    <button class="submit-btn" onclick="closePopup()">Xem l·∫°i b√†i l√†m</button>
</div>

<script>
    // --- AUDIO SYSTEM (Pure JS - No external files) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High pitch sine wave sequence)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
            fireConfetti();
        } else if (type === 'wrong') {
            // Buzz sound (Low pitch sawtooth)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- DATA ---
    const quizData = [
        // --- Exercise 1: Stress Pattern ---
        {
            type: "sorting",
            title: "Exercise 1. Stress Pattern",
            instruction: "Put the words in the correct column according to their stress pattern.",
            questions: [
                { id: "s1", word: "illegal", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…™ÀàliÀê.…°…ôl/. Ti·ªÅn t·ªë 'il-' th∆∞·ªùng kh√¥ng nh·∫≠n tr·ªçng √¢m." },
                { id: "s2", word: "celebrate", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààsel.…ô.bre…™t/. ƒê·ªông t·ª´ 3 √¢m ti·∫øt k·∫øt th√∫c -ate tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 3 t·ª´ d∆∞·ªõi l√™n." },
                { id: "s3", word: "available", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…ôÀàve…™.l…ô.b…ôl/." },
                { id: "s4", word: "festival", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààfes.t…™.v…ôl/." },
                { id: "s5", word: "consumption", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /k…ônÀàs åmp. É…ôn/. T·ª´ c√≥ ƒëu√¥i -tion tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt ngay tr∆∞·ªõc n√≥." },
                { id: "s6", word: "electric", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /iÀàlek.tr…™k/. ƒêu√¥i -ic tr·ªçng √¢m r∆°i v√†o √¢m tr∆∞·ªõc n√≥." },
                { id: "s7", word: "performance", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /p…ôÀàf…îÀê.m…ôns/." },
                { id: "s8", word: "performer", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /p…ôÀàf…îÀê.m…ôr/." },
                { id: "s9", word: "generate", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààd íen.…ô.re…™t/. ƒêu√¥i -ate 3 √¢m ti·∫øt." },
                { id: "s10", word: "effective", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…™Ààfek.t…™v/. ƒêu√¥i -tive th∆∞·ªùng kh√¥ng ·∫£nh h∆∞·ªüng, g·ªëc 'effect' tr·ªçng √¢m 2." },
                { id: "s11", word: "imagine", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…™Ààm√¶d í.…™n/." },
                { id: "s12", word: "convenient", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /k…ônÀàviÀê.ni.…ônt/." },
                { id: "s13", word: "exhausted", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…™…°Ààz…îÀê.st…™d/." },
                { id: "s14", word: "comfortable", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààk åmf.t…ô.b…ôl/ (l∆∞u √Ω t·ª´ n√†y hay b·ªã ƒë·ªçc sai)." },
                { id: "s15", word: "library", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààla…™.br…ôr.i/." },
                { id: "s16", word: "improvement", correct: "2nd", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 2: /…™mÀàpruÀêv.m…ônt/." },
                { id: "s17", word: "relative", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààrel.…ô.t…™v/." },
                { id: "s18", word: "fortunate", correct: "1st", options: ["1st Syllable", "2nd Syllable"], explain: "√Çm ti·∫øt 1: /Ààf…îÀê.t É…ôn.…ôt/." }
            ]
        },
        // --- Exercise 2: Communication ---
        {
            type: "mcq",
            title: "Exercise 1. Choose the correct response.",
            instruction: "Practice the short exchanges in pairs.",
            questions: [
                {
                    id: "c1",
                    text: "<b>A:</b> Why didn‚Äôt you turn off the TV when you were away?<br><b>B:</b> ...",
                    options: [
                        { text: "a) I‚Äôll come back tomorrow.", correct: false },
                        { text: "b) Sorry, I‚Äôll do it next time", correct: true }
                    ],
                    explanation: {
                        trans: "A: T·∫°i sao con kh√¥ng t·∫Øt TV khi ra ngo√†i? <br> B: Xin l·ªói, l·∫ßn sau con s·∫Ω l√†m ·∫°.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> ƒê√¢y l√† c√¢u tr·∫£ l·ªùi xin l·ªói v√† h·ª©a s·ª≠a sai, ph√π h·ª£p ng·ªØ c·∫£nh b·ªã ph√†n n√†n.<br><b>T·∫°i sao sai:</b> C√¢u (a) 'Con s·∫Ω quay l·∫°i ng√†y mai' kh√¥ng li√™n quan ƒë·∫øn vi·ªác qu√™n t·∫Øt TV."
                    }
                },
                {
                    id: "c2",
                    text: "<b>A:</b> Which source of energy will our homes rely on in the future?<br><b>B:</b> ...",
                    options: [
                        { text: "a) I think we use a lot of solar energy.", correct: true },
                        { text: "b) We rely on non-renewable as usual.", correct: false }
                    ],
                    explanation: {
                        trans: "A: Nh√† ch√∫ng ta s·∫Ω ph·ª• thu·ªôc v√†o ngu·ªìn nƒÉng l∆∞·ª£ng n√†o trong t∆∞∆°ng lai? <br> B: T·ªõ nghƒ© ch√∫ng ta s·∫Ω d√πng nhi·ªÅu nƒÉng l∆∞·ª£ng m·∫∑t tr·ªùi.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (a):</b> D·ª± ƒëo√°n v·ªÅ t∆∞∆°ng lai th∆∞·ªùng h∆∞·ªõng t·ªõi nƒÉng l∆∞·ª£ng s·∫°ch (solar energy).<br><b>T·∫°i sao sai:</b> C√¢u (b) n√≥i v·ªÅ nƒÉng l∆∞·ª£ng kh√¥ng t√°i t·∫°o (non-renewable) l√† ƒëi ng∆∞·ª£c xu h∆∞·ªõng ph√°t tri·ªÉn."
                    }
                },
                {
                    id: "c3",
                    text: "<b>A:</b> Do you think wind energy is good?<br><b>B:</b> ...",
                    options: [
                        { text: "a) I don‚Äôt think so. It‚Äôs clean.", correct: false },
                        { text: "b) It‚Äôs green energy, I think.", correct: true }
                    ],
                    explanation: {
                        trans: "A: C·∫≠u c√≥ nghƒ© nƒÉng l∆∞·ª£ng gi√≥ t·ªët kh√¥ng? <br> B: T·ªõ nghƒ© n√≥ l√† nƒÉng l∆∞·ª£ng xanh.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> ƒê·ªìng √Ω r·∫±ng n√≥ t·ªët v√¨ l√† 'green energy'.<br><b>T·∫°i sao sai:</b> C√¢u (a) M√¢u thu·∫´n ('T√¥i kh√¥ng nghƒ© v·∫≠y' nh∆∞ng l·∫°i khen 'n√≥ s·∫°ch')."
                    }
                },
                {
                    id: "c4",
                    text: "<b>A:</b> Are you practising anything to save energy?<br><b>B:</b> ...",
                    options: [
                        { text: "a) I ride to school every morning.", correct: true },
                        { text: "b) I use a lot of electric appliances.", correct: false }
                    ],
                    explanation: {
                        trans: "A: C·∫≠u c√≥ ƒëang l√†m g√¨ ƒë·ªÉ ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng kh√¥ng? <br> B: T·ªõ ƒë·∫°p xe ƒëi h·ªçc m·ªói s√°ng.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (a):</b> ƒê·∫°p xe thay v√¨ ƒëi xe m√°y/√¥ t√¥ l√† c√°ch ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng.<br><b>T·∫°i sao sai:</b> C√¢u (b) 'D√πng nhi·ªÅu thi·∫øt b·ªã ƒëi·ªán' l√† l√£ng ph√≠, kh√¥ng ph·∫£i ti·∫øt ki·ªám."
                    }
                },
                {
                    id: "c5",
                    text: "<b>A:</b> Why do we take showers instead of baths?<br><b>B:</b> ...",
                    options: [
                        { text: "a) It‚Äôs more comfortable.", correct: false },
                        { text: "b) It can save water.", correct: true }
                    ],
                    explanation: {
                        trans: "A: T·∫°i sao ch√∫ng ta n√™n t·∫Øm v√≤i sen thay v√¨ t·∫Øm b·ªìn? <br> B: N√≥ gi√∫p ti·∫øt ki·ªám n∆∞·ªõc.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> L√Ω do ch√≠nh c·ªßa vi·ªác t·∫Øm v√≤i sen (showers) trong ng·ªØ c·∫£nh b·∫£o v·ªá m√¥i tr∆∞·ªùng l√† ti·∫øt ki·ªám n∆∞·ªõc.<br><b>T·∫°i sao sai:</b> C√¢u (a) 'Tho·∫£i m√°i h∆°n' l√† √Ω ki·∫øn ch·ªß quan, kh√¥ng ph·∫£i l√Ω do m√¥i tr∆∞·ªùng."
                    }
                },
                {
                    id: "c6",
                    text: "<b>A:</b> I have just changed to low energy light bulbs.<br><b>B:</b> ...",
                    options: [
                        { text: "a) Good idea. Your carbon footprint will be bigger.", correct: false },
                        { text: "b) Great idea. It saves a lot of energy.", correct: true }
                    ],
                    explanation: {
                        trans: "A: T·ªõ v·ª´a ƒë·ªïi sang b√≥ng ƒë√®n ti·∫øt ki·ªám ƒëi·ªán. <br> B: √ù hay ƒë√≥. N√≥ ti·∫øt ki·ªám r·∫•t nhi·ªÅu nƒÉng l∆∞·ª£ng.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> Khen ng·ª£i v√† n√™u l·ª£i √≠ch ƒë√∫ng.<br><b>T·∫°i sao sai:</b> C√¢u (a) sai v√¨ n·∫øu ti·∫øt ki·ªám ƒëi·ªán th√¨ 'carbon footprint' (d·∫•u ch√¢n carbon) ph·∫£i nh·ªè ƒëi, kh√¥ng ph·∫£i 'bigger' (l·ªõn h∆°n)."
                    }
                },
                {
                    id: "c7",
                    text: "<b>A:</b> We should rely on fossil fuels.<br><b>B:</b> ...",
                    options: [
                        { text: "a) Yes. It‚Äôs cheap and limited.", correct: false },
                        { text: "b) But they run out soon.", correct: true }
                    ],
                    explanation: {
                        trans: "A: Ch√∫ng ta n√™n ph·ª• thu·ªôc v√†o nhi√™n li·ªáu h√≥a th·∫°ch. <br> B: Nh∆∞ng ch√∫ng s·∫Ω s·ªõm c·∫°n ki·ªát th√¥i.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> Ph·∫£n bi·ªán h·ª£p l√Ω v√¨ nhi√™n li·ªáu h√≥a th·∫°ch c√≥ h·∫°n.<br><b>T·∫°i sao sai:</b> C√¢u (a) ƒê·ªìng √Ω nh∆∞ng l·∫°i n√≥i 'limited' (c√≥ h·∫°n) l√† m√¢u thu·∫´n trong l·∫≠p lu·∫≠n ·ªßng h·ªô."
                    }
                },
                {
                    id: "c8",
                    text: "<b>A:</b> Some people in the country use biogas.<br><b>B:</b> ...",
                    options: [
                        { text: "a) I think it‚Äôs limited.", correct: false },
                        { text: "b) Good, it's clean and cheap.", correct: true }
                    ],
                    explanation: {
                        trans: "A: M·ªôt s·ªë ng∆∞·ªùi ·ªü n√¥ng th√¥n d√πng kh√≠ sinh h·ªçc (biogas). <br> B: T·ªët qu√°, n√≥ s·∫°ch v√† r·∫ª.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (b):</b> Biogas l√† nƒÉng l∆∞·ª£ng t√°i t·∫°o, s·∫°ch v√† r·∫ª (t·∫≠n d·ª•ng ch·∫•t th·∫£i).<br><b>T·∫°i sao sai:</b> C√¢u (a) sai v√¨ Biogas l√† t√°i t·∫°o ƒë∆∞·ª£c (renewable), kh√¥ng ph·∫£i 'limited'."
                    }
                },
                {
                    id: "c9",
                    text: "<b>A:</b> Why do some nations stop using nuclear energy?<br><b>B:</b> ...",
                    options: [
                        { text: "a) Because it‚Äôs sometimes dangerous.", correct: true },
                        { text: "b) Because it‚Äôs abundant and renewable.", correct: false }
                    ],
                    explanation: {
                        trans: "A: T·∫°i sao m·ªôt s·ªë qu·ªëc gia ng·ª´ng s·ª≠ d·ª•ng nƒÉng l∆∞·ª£ng h·∫°t nh√¢n? <br> B: B·ªüi v√¨ ƒë√¥i khi n√≥ nguy hi·ªÉm.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (a):</b> Lo ng·∫°i v·ªÅ an to√†n (r√≤ r·ªâ ph√≥ng x·∫°) l√† l√Ω do ch√≠nh.<br><b>T·∫°i sao sai:</b> C√¢u (b) N·∫øu n√≥ d·ªìi d√†o v√† t√°i t·∫°o th√¨ ng∆∞·ªùi ta ƒë√£ d√πng ti·∫øp, kh√¥ng ng·ª´ng l·∫°i."
                    }
                },
                {
                    id: "c10",
                    text: "<b>A:</b> Why do we try to save energy?<br><b>B:</b> ...",
                    options: [
                        { text: "a) Because it‚Äôs good for the environment.", correct: true },
                        { text: "b) Because we can rely on renewable energy.", correct: false }
                    ],
                    explanation: {
                        trans: "A: T·∫°i sao ch√∫ng ta c·ªë g·∫Øng ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng? <br> B: V√¨ n√≥ t·ªët cho m√¥i tr∆∞·ªùng.",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (a):</b> Ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng gi√∫p gi·∫£m kh√≠ th·∫£i, b·∫£o v·ªá m√¥i tr∆∞·ªùng.<br><b>T·∫°i sao sai:</b> C√¢u (b) Kh√¥ng tr·∫£ l·ªùi tr·ª±c ti·∫øp cho c√¢u h·ªèi 'T·∫°i sao'."
                    }
                }
            ]
        },
        // --- Exercise 3: Reading ---
        {
            type: "reading",
            title: "Exercise 1. Read the text and choose the correct answer.",
            passage: `Producing electricity from wind energy has many advantages. Firstly, it brings money into poor rural areas around the country. It creates thousands of jobs for the local people. Wind energy is an easy crop for farmers to sell. Farmers do not have to depend on water or sun to make money. Farmers can receive a lot of money from farm renting. Secondly, wind power does not produce pollutants, so the costs for health care also decrease. The American Lung Association is in favor of wind energy because it keeps the air clean and free from pollution. They also launch a Healthy Air Campaign to promote the use of wind energy.
            Wind energy also keeps energy bills down for the users. It is becoming more competitive with other types of energy in terms of cost. Wind farms leave most of the farmer‚Äôs land free for other uses while providing a steady income.`,
            glossary: [
                { word: "Advantages", type: "n", mean: "L·ª£i √≠ch, ∆∞u ƒëi·ªÉm" },
                { word: "Rural areas", type: "n", mean: "V√πng n√¥ng th√¥n" },
                { word: "Depend on", type: "v", mean: "Ph·ª• thu·ªôc v√†o" },
                { word: "Pollutants", type: "n", mean: "Ch·∫•t g√¢y √¥ nhi·ªÖm" },
                { word: "In favor of", type: "idm", mean: "·ª¶ng h·ªô" },
                { word: "Launch", type: "v", mean: "Ph√°t ƒë·ªông, kh·ªüi ƒë·ªông" },
                { word: "Promote", type: "v", mean: "Th√∫c ƒë·∫©y, khuy·∫øn kh√≠ch" },
                { word: "Competitive", type: "adj", mean: "C√≥ t√≠nh c·∫°nh tranh" },
                { word: "Steady income", type: "n", mean: "Thu nh·∫≠p ·ªïn ƒë·ªãnh" },
                { word: "Campaign", type: "n", mean: "Chi·∫øn d·ªãch" }
            ],
            questions: [
                {
                    id: "r1",
                    text: "1. This text is about _______.",
                    options: [
                        { text: "A. the disadvantages of wind energy", correct: false },
                        { text: "B. the benefits of wind energy", correct: true },
                        { text: "C. the production of wind energy", correct: false },
                        { text: "D. producing electricity", correct: false }
                    ],
                    explanation: {
                        trans: "ƒêo·∫°n vƒÉn n√†y n√≥i v·ªÅ...",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (B):</b> L·ª£i √≠ch c·ªßa nƒÉng l∆∞·ª£ng gi√≥.<br><b>T·∫°i sao ƒë√∫ng:</b> C√¢u ƒë·∫ßu ti√™n ch·ªët √Ω to√†n b√†i: 'Producing electricity from wind energy has many advantages.' (S·∫£n xu·∫•t ƒëi·ªán gi√≥ c√≥ nhi·ªÅu l·ª£i √≠ch).<br><b>T·∫°i sao sai:</b> A sai v√¨ b√†i n√≥i v·ªÅ advantages, kh√¥ng ph·∫£i disadvantages. C v√† D qu√° chung chung ho·∫∑c ch·ªâ l√† m·ªôt ph·∫ßn nh·ªè."
                    }
                },
                {
                    id: "r2",
                    text: "2. Wind energy helps the farmers_______.",
                    options: [
                        { text: "A. get more jobs", correct: false },
                        { text: "B. grow more crops", correct: false },
                        { text: "C. earn less money", correct: false },
                        { text: "D. earn more money", correct: true }
                    ],
                    explanation: {
                        trans: "NƒÉng l∆∞·ª£ng gi√≥ gi√∫p ng∆∞·ªùi n√¥ng d√¢n...",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (D):</b> Ki·∫øm th√™m ti·ªÅn.<br><b>T·∫°i sao ƒë√∫ng:</b> D·∫´n ch·ª©ng: 'It brings money into poor rural areas... Farmers can receive a lot of money from farm renting.' (N√¥ng d√¢n nh·∫≠n ƒë∆∞·ª£c nhi·ªÅu ti·ªÅn t·ª´ vi·ªác cho thu√™ ƒë·∫•t l√†m trang tr·∫°i gi√≥).<br><b>T·∫°i sao sai:</b> A n√≥i v·ªÅ jobs cho local people (chung chung), B n√≥i v·ªÅ tr·ªìng tr·ªçt l√† sai nghƒ©a b√≥ng 'crop' trong b√†i."
                    }
                },
                {
                    id: "r3",
                    text: "3. Another advantage of wind power is _________.",
                    options: [
                        { text: "A. clean and safe for health", correct: true },
                        { text: "B. reducing pollutants", correct: false },
                        { text: "C. cleaning the water", correct: false },
                        { text: "D. cleaning the air", correct: false }
                    ],
                    explanation: {
                        trans: "M·ªôt l·ª£i √≠ch kh√°c c·ªßa ƒëi·ªán gi√≥ l√†...",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (A):</b> S·∫°ch v√† an to√†n cho s·ª©c kh·ªèe.<br><b>T·∫°i sao ƒë√∫ng:</b> D·∫´n ch·ª©ng: 'wind power does not produce pollutants, so the costs for health care also decrease.' (Kh√¥ng sinh ra ch·∫•t √¥ nhi·ªÖm n√™n chi ph√≠ y t·∫ø gi·∫£m -> t·ªët cho s·ª©c kh·ªèe).<br><b>L∆∞u √Ω:</b> B v√† D c≈©ng ƒë√∫ng v·ªÅ m·∫∑t √Ω nghƒ©a nh∆∞ng A bao qu√°t nh·∫•t v·ªÅ kh√≠a c·∫°nh 'Advantage' (l·ª£i √≠ch t·ªïng th·ªÉ)."
                    }
                },
                {
                    id: "r4",
                    text: "4. The campaign of the American Lung Association aims at ______",
                    options: [
                        { text: "A. advertising the wind turbines", correct: false },
                        { text: "B. supporting the growth of wind energy", correct: true },
                        { text: "C. cleaning the air", correct: false },
                        { text: "D. reducing pollutants", correct: false }
                    ],
                    explanation: {
                        trans: "Chi·∫øn d·ªãch c·ªßa Hi·ªáp h·ªôi Ph·ªïi Hoa K·ª≥ nh·∫±m m·ª•c ƒë√≠ch...",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (B):</b> ·ª¶ng h·ªô s·ª± ph√°t tri·ªÉn c·ªßa nƒÉng l∆∞·ª£ng gi√≥.<br><b>T·∫°i sao ƒë√∫ng:</b> D·∫´n ch·ª©ng: 'promote the use of wind energy' (th√∫c ƒë·∫©y vi·ªác s·ª≠ d·ª•ng nƒÉng l∆∞·ª£ng gi√≥) = supporting the growth.<br><b>T·∫°i sao sai:</b> A sai (qu·∫£ng c√°o tua bin). C v√† D l√† k·∫øt qu·∫£, kh√¥ng ph·∫£i m·ª•c ƒë√≠ch tr·ª±c ti·∫øp c·ªßa chi·∫øn d·ªãch 'promote wind energy'."
                    }
                },
                {
                    id: "r5",
                    text: "5. The price of wind energy is _______.",
                    options: [
                        { text: "A. increasing", correct: false },
                        { text: "B. decreasing", correct: true },
                        { text: "C. staying the same", correct: false },
                        { text: "D. reducing", correct: false }
                    ],
                    explanation: {
                        trans: "Gi√° c·ªßa nƒÉng l∆∞·ª£ng gi√≥ ƒëang...",
                        detail: "<b>ƒê√°p √°n ƒë√∫ng (B):</b> Gi·∫£m xu·ªëng.<br><b>T·∫°i sao ƒë√∫ng:</b> D·∫´n ch·ª©ng: 'Wind energy also keeps energy bills down... becoming more competitive' (Gi·ªØ h√≥a ƒë∆°n th·∫•p, c·∫°nh tranh h∆°n -> t·ª©c l√† gi√° r·∫ª ƒëi/gi·∫£m).<br><b>L∆∞u √Ω:</b> 'Decreasing' th∆∞·ªùng d√πng cho xu h∆∞·ªõng gi√° c·∫£. 'Reducing' l√† ngo·∫°i ƒë·ªông t·ª´ (l√†m gi·∫£m c√°i g√¨ ƒë√≥)."
                    }
                }
            ]
        }
    ];

    let totalScore = 0;
    let maxScore = 0;
    let questionsAnswered = 0;
    let totalQuestions = 0;

    // --- RENDER FUNCTIONS ---

    function renderQuiz() {
        const container = document.getElementById('quiz-content');
        
        quizData.forEach((section, index) => {
            const sectionDiv = document.createElement('div');
            
            // Section Title
            const titleHtml = `<div style="text-align: center;"><div class="section-title">${section.title}</div><p>${section.instruction}</p></div>`;
            sectionDiv.innerHTML += titleHtml;

            // Reading Passage & Glossary if available
            if (section.type === "reading") {
                // Glossary HTML builder
                let glossaryHtml = `
                    <table class="glossary-table">
                        <thead><tr><th>Word</th><th>Type</th><th>Meaning</th></tr></thead>
                        <tbody>
                `;
                section.glossary.forEach(g => {
                    glossaryHtml += `<tr><td><b>${g.word}</b></td><td><i>${g.type}</i></td><td>${g.mean}</td></tr>`;
                });
                glossaryHtml += `</tbody></table>`;

                sectionDiv.innerHTML += `
                    <div class="reading-passage">
                        ${section.passage}
                        <h4 style="margin-top:20px; color:var(--primary)">üìù Glossary (T·ª´ v·ª±ng Academic):</h4>
                        ${glossaryHtml}
                    </div>
                `;
            }

            // Questions Loop
            section.questions.forEach(q => {
                totalQuestions++;
                maxScore++;
                const card = document.createElement('div');
                card.className = 'question-card';
                
                let qContent = '';

                // Format depending on type
                if (section.type === "sorting") {
                    qContent = `
                        <div class="question-text">Word: <span style="color:var(--primary); font-size:1.5rem">${q.word}</span></div>
                        <div class="options-grid" id="opts-${q.id}">
                            ${q.options.map((opt, i) => `
                                <button class="option-btn" onclick="checkSorting('${q.id}', '${q.correct}', ${i}, this)">
                                    ${opt}
                                </button>
                            `).join('')}
                        </div>
                    `;
                } else {
                    // MCQ
                    qContent = `
                        <div class="question-text">${q.text}</div>
                        <div class="options-grid" id="opts-${q.id}">
                            ${q.options.map((opt, i) => `
                                <button class="option-btn" onclick="checkMCQ('${q.id}', ${opt.correct}, this)">
                                    ${opt.text}
                                </button>
                            `).join('')}
                        </div>
                    `;
                }

                // Add Explanation Block
                let expContent = '';
                if(section.type === "sorting") {
                     expContent = `
                        <div class="explanation-box" id="exp-${q.id}">
                            <div class="explanation-header">üí° Ms Mai An gi·∫£i th√≠ch:</div>
                            <div class="exp-detail">${q.explain}</div>
                        </div>
                    `;
                } else {
                     expContent = `
                        <div class="explanation-box" id="exp-${q.id}">
                            <div class="explanation-header">üí° Ms Mai An gi·∫£i th√≠ch:</div>
                            <div class="exp-detail">
                                <i>${q.explanation.trans}</i><br><br>
                                ${q.explanation.detail}
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = qContent + expContent;
                sectionDiv.appendChild(card);
            });

            container.appendChild(sectionDiv);
        });
    }

    // --- INTERACTION LOGIC ---

    function checkSorting(id, correctVal, chosenIndex, btn) {
        const parent = document.getElementById(`opts-${id}`);
        const btns = parent.getElementsByClassName('option-btn');
        
        // Disable all
        for(let b of btns) b.classList.add('disabled');

        const isCorrect = (correctVal === "1st" && chosenIndex === 0) || (correctVal === "2nd" && chosenIndex === 1);

        if (isCorrect) {
            btn.classList.add('correct');
            playSound('correct');
            totalScore++;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Highlight correct
            if(correctVal === "1st") btns[0].classList.add('correct');
            else btns[1].classList.add('correct');
        }

        document.getElementById(`exp-${id}`).style.display = 'block';
        questionsAnswered++;
    }

    function checkMCQ(id, isCorrect, btn) {
        const parent = document.getElementById(`opts-${id}`);
        const btns = parent.getElementsByClassName('option-btn');
        
        // Disable all
        for(let b of btns) b.classList.add('disabled');

        if (isCorrect) {
            btn.classList.add('correct');
            playSound('correct');
            totalScore++;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Find and highlight correct one
            // We need to look at data again or simpler: find the one with onclick containing true? 
            // Better: Scan DOM isn't ideal but works. Let's look at logic.
            // Actually, in generated HTML, I passed `true` or `false` to the function.
            // I need to find the button that has `true` in its handler.
            // A simple hack: The data is generated in order.
            // Let's just find the correct button by index from data? No, simpler:
            // The generated HTML has onclick="checkMCQ(..., true, ...)"
            for(let b of btns) {
                if(b.getAttribute('onclick').includes('true')) {
                    b.classList.add('correct');
                }
            }
        }

        document.getElementById(`exp-${id}`).style.display = 'block';
        questionsAnswered++;
    }

    function finishQuiz() {
        if(questionsAnswered < totalQuestions) {
            if(!confirm(`Con m·ªõi l√†m ƒë∆∞·ª£c ${questionsAnswered}/${totalQuestions} c√¢u. Con c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`)) {
                return;
            }
        }
        
        const scoreEl = document.getElementById('scoreDisplay');
        const feedback = document.getElementById('feedbackText');
        const popup = document.getElementById('resultPopup');
        const overlay = document.getElementById('overlay');

        scoreEl.innerText = `${totalScore}/${maxScore}`;
        
        const percentage = (totalScore / maxScore) * 100;
        if (percentage === 100) feedback.innerText = "Xu·∫•t s·∫Øc! Con l√† thi√™n t√†i ti·∫øng Anh! üåü";
        else if (percentage >= 80) feedback.innerText = "Gi·ªèi l·∫Øm! Ch·ªâ sai m·ªôt x√≠u th√¥i! üí™";
        else if (percentage >= 50) feedback.innerText = "Kh√° t·ªët! C·ªë g·∫Øng xem k·ªπ l·∫°i gi·∫£i th√≠ch nh√©! üìö";
        else feedback.innerText = "ƒê·ª´ng bu·ªìn nh√©! H√£y xem k·ªπ gi·∫£i th√≠ch ƒë·ªÉ ti·∫øn b·ªô h∆°n! ‚ù§Ô∏è";

        overlay.classList.add('show');
        popup.classList.add('show');
        playSound('correct'); // Celebration sound
    }

    function closePopup() {
        document.getElementById('resultPopup').classList.remove('show');
        document.getElementById('overlay').classList.remove('show');
    }

    // --- CONFETTI EFFECT ---
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let particles = [];

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function fireConfetti() {
        for (let i = 0; i < 50; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: -10,
                r: Math.random() * 8 + 2,
                d: Math.random() * 5 + 2,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                tilt: Math.floor(Math.random() * 10) - 10,
                tiltAngle: 0,
                tiltAngleIncremental: (Math.random() * 0.07) + 0.05
            });
        }
    }

    function drawConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach((p, index) => {
            p.tiltAngle += p.tiltAngleIncremental;
            p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
            p.x += Math.sin(0);
            p.tilt = Math.sin(p.tiltAngle) * 15;

            ctx.beginPath();
            ctx.lineWidth = p.r;
            ctx.strokeStyle = p.color;
            ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
            ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
            ctx.stroke();

            if (p.y > canvas.height) particles.splice(index, 1);
        });
        requestAnimationFrame(drawConfetti);
    }
    drawConfetti();

    // Start
    renderQuiz();

</script>
</body>
</html>