<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra: Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Default Theme Colors (Will be changed by JS) */
            --primary-color: #6c5ce7;
            --secondary-color: #a29bfe;
            --bg-gradient-start: #f5f6fa;
            --bg-gradient-end: #dfe6e9;
            --text-color: #2d3436;
            --correct-color: #00b894;
            --wrong-color: #ff7675;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Nunito', sans-serif;
            height: 100vh;
            overflow: hidden; /* Prevent body scroll, handle in split panels */
            background-color: #f0f2f5;
            transition: background 1s ease;
        }

        /* DYNAMIC BACKGROUND SVG GENERATED VIA CSS */
        .dynamic-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            transition: opacity 0.5s ease;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
        }

        /* --- HEADER --- */
        header {
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: fixed;
            top: 0; width: 100%;
            z-index: 100;
        }

        .teacher-brand {
            position: absolute;
            left: 20px;
            font-weight: 800;
            color: var(--primary-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-container {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3436;
            background: #dfe6e9;
            padding: 5px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-container:hover { transform: scale(1.05); }
        .timer-container.urgent { color: #d63031; animation: pulse 1s infinite; }

        /* --- MAIN LAYOUT --- */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
            margin-top: 60px;
        }

        .split-panel {
            width: 50%;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.4); }

        /* --- LEFT PANEL: READING --- */
        .reading-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: transform 0.3s;
            border-left: 5px solid var(--primary-color);
        }

        .reading-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            border-bottom: 2px dashed #b2bec3;
            padding-bottom: 10px;
        }

        .reading-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2d3436;
            text-align: justify;
        }

        .reading-content span.gap {
            font-weight: 800;
            color: var(--primary-color);
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 5px;
        }

        .translate-btn {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: 700;
            box-shadow: 0 4px 0 #4834d4;
            transition: all 0.1s;
        }
        .translate-btn:active { transform: translateY(4px); box-shadow: none; }

        .translation-box {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e1f5fe;
            border-radius: 10px;
            color: #0277bd;
            font-style: italic;
        }

        /* GLOSSARY TABLE */
        .glossary-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .glossary-table th { background: var(--primary-color); color: white; padding: 10px; text-align: left; }
        .glossary-table td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        .glossary-table tr:last-child td { border-bottom: none; }

        /* --- RIGHT PANEL: EXERCISES --- */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            border: 2px solid #f0f0f0;
            position: relative;
            transition: all 0.3s;
        }

        .question-card:hover { transform: translateY(-5px); }

        .q-header {
            font-weight: 800;
            color: #636e72;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe6e9;
            border-radius: 15px;
            padding: 15px;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #dfe6e9;
            text-align: left;
        }

        .option-btn:hover:not(.disabled) {
            transform: scale(1.02);
            border-color: var(--primary-color);
        }

        .option-btn:active:not(.disabled) {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* States */
        .option-btn.correct {
            background: var(--correct-color);
            color: white;
            border-color: #008f72;
            box-shadow: 0 4px 0 #008f72;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .option-btn.wrong {
            background: var(--wrong-color);
            color: white;
            border-color: #d63031;
            box-shadow: 0 4px 0 #d63031;
            animation: shake 0.5s;
        }

        .disabled { pointer-events: none; opacity: 0.7; }

        /* EXPLANATION AREA */
        .explanation-area {
            display: none; /* Hidden initially */
            margin-top: 20px;
            border-top: 2px dashed #dfe6e9;
            padding-top: 15px;
            animation: slideDown 0.5s ease;
        }

        .teacher-avatar {
            width: 40px; height: 40px;
            background: #ffeaa7;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 10px;
            border: 2px solid #fdcb6e;
        }

        .feedback-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .mini-btn {
            padding: 5px 15px;
            border-radius: 15px;
            border: none;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            opacity: 0.8;
            transition: 0.2s;
        }
        .mini-btn:hover { opacity: 1; transform: scale(1.05); }
        
        .btn-explain { background: #ffeaa7; color: #d35400; }
        .btn-trans { background: #74b9ff; color: #0984e3; }
        .btn-vocab { background: #55efc4; color: #00b894; }

        .detail-box {
            background: #fdfdfd;
            border-left: 4px solid var(--primary-color);
            padding: 10px;
            margin-top: 10px;
            font-size: 0.95rem;
            color: #2d3436;
            display: none; /* Toggled */
        }

        /* --- ANIMATIONS --- */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }
        @keyframes pop {
            0% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* CONFETTI OVERLAY */
        #confetti-canvas {
            position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999;
        }

        /* MODAL SCOREBOARD */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .scoreboard {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: pop 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;
        }
        .score-circle {
            width: 150px; height: 150px;
            background: var(--primary-color);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 25px rgba(108, 92, 231, 0.4);
        }
        .score-number { font-size: 3rem; font-weight: 800; }
        .score-label { font-size: 1rem; opacity: 0.9; }
        .teacher-comment { font-style: italic; color: #636e72; margin-bottom: 20px; }
        .btn-finish {
            background: var(--primary-color); color: white;
            padding: 15px 30px; border: none; border-radius: 50px;
            font-size: 1.2rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2);
            transition: 0.2s;
        }
        .btn-finish:active { transform: translateY(6px); box-shadow: none; }

        /* Submit Button Fixed Bottom Right */
        .submit-float {
            position: fixed; bottom: 30px; right: 30px;
            background: #d63031; color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 800;
            box-shadow: 0 10px 20px rgba(214, 48, 49, 0.4);
            cursor: pointer;
            z-index: 101;
            transition: all 0.3s;
            border: 4px solid white;
        }
        .submit-float:hover { transform: scale(1.1); }
    </style>
</head>
<body>

<div id="dynamic-bg" class="dynamic-bg"></div>
<canvas id="confetti-canvas"></canvas>

<header>
    <div class="teacher-brand">
        <span>üë©‚Äçüè´</span> Ms Mai An ULIS
    </div>
    <div class="timer-container" onclick="toggleTimer()">
        <span id="timer-icon">‚è≥</span>
        <span id="time-display">10:00</span>
    </div>
</header>

<div class="main-container">
    
    <div class="split-panel" id="reading-panel">
        
        <div class="reading-section" id="passage-1" data-theme="sheep">
            <h2 class="reading-title">üêë Sheep can recognise faces!</h2>
            <div class="reading-content">
                <p>Many people think sheep aren‚Äôt very intelligent creatures. But in fact, <b>(1)...........</b> to new research, they may be cleverer than we think. For example, sheep can actually be trained to recognise human faces from photographs!</p>
                <p>Recognising faces is an important human social <b>(2)...........</b>. However, it seems that sheep are also social animals that can recognise other sheep as well as <b>(3)...........</b> humans. In experiments, researchers trained eight sheep to recognise the faces of celebrities from photographs. Training involved getting the sheep to <b>(4)...........</b> decisions about the photos they saw. At one end of a room, they would see two different photographs, and would receive a <b>(5)...........</b> of food for approaching the photograph of the celebrity; if they approached the wrong photograph, they got nothing. Over time, they learned to <b>(6)...........</b> getting food with the celebrity‚Äôs photograph. And after training, the sheep correctly chose the celebrity‚Äôs face eight times out of ten!</p>
            </div>
            <button class="translate-btn" onclick="toggleTrans('trans-1')">üáªüá≥ B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
            <div id="trans-1" class="translation-box">
                Nhi·ªÅu ng∆∞·ªùi nghƒ© r·∫±ng c·ª´u kh√¥ng ph·∫£i l√† lo√†i sinh v·∫≠t th√¥ng minh l·∫Øm. Nh∆∞ng th·ª±c t·∫ø, theo nghi√™n c·ª©u m·ªõi, ch√∫ng c√≥ th·ªÉ th√¥ng minh h∆°n ch√∫ng ta nghƒ©. V√≠ d·ª•, c·ª´u th·ª±c s·ª± c√≥ th·ªÉ ƒë∆∞·ª£c hu·∫•n luy·ªán ƒë·ªÉ nh·∫≠n di·ªán khu√¥n m·∫∑t ng∆∞·ªùi t·ª´ c√°c b·ª©c ·∫£nh!<br><br>
                Nh·∫≠n di·ªán khu√¥n m·∫∑t l√† m·ªôt k·ªπ nƒÉng x√£ h·ªôi quan tr·ªçng c·ªßa con ng∆∞·ªùi. Tuy nhi√™n, c√≥ v·∫ª nh∆∞ c·ª´u c≈©ng l√† ƒë·ªông v·∫≠t c√≥ t√≠nh x√£ h·ªôi, c√≥ th·ªÉ nh·∫≠n ra nh·ªØng con c·ª´u kh√°c c≈©ng nh∆∞ nh·ªØng ng∆∞·ªùi quen thu·ªôc. Trong c√°c th√≠ nghi·ªám, c√°c nh√† nghi√™n c·ª©u ƒë√£ hu·∫•n luy·ªán t√°m con c·ª´u ƒë·ªÉ nh·∫≠n di·ªán khu√¥n m·∫∑t c·ªßa nh·ªØng ng∆∞·ªùi n·ªïi ti·∫øng t·ª´ c√°c b·ª©c ·∫£nh. Qu√° tr√¨nh hu·∫•n luy·ªán bao g·ªìm vi·ªác khi·∫øn c·ª´u ƒë∆∞a ra quy·∫øt ƒë·ªãnh v·ªÅ nh·ªØng b·ª©c ·∫£nh ch√∫ng nh√¨n th·∫•y. ·ªû m·ªôt ƒë·∫ßu ph√≤ng, ch√∫ng s·∫Ω th·∫•y hai b·ª©c ·∫£nh kh√°c nhau v√† s·∫Ω nh·∫≠n ƒë∆∞·ª£c ph·∫ßn th∆∞·ªüng th·ª©c ƒÉn khi ti·∫øn l·∫°i g·∫ßn b·ª©c ·∫£nh c·ªßa ng∆∞·ªùi n·ªïi ti·∫øng; n·∫øu ch√∫ng ti·∫øn l·∫°i g·∫ßn b·ª©c ·∫£nh sai, ch√∫ng s·∫Ω kh√¥ng nh·∫≠n ƒë∆∞·ª£c g√¨. Theo th·ªùi gian, ch√∫ng h·ªçc c√°ch li√™n k·∫øt vi·ªác c√≥ th·ª©c ƒÉn v·ªõi b·ª©c ·∫£nh c·ªßa ng∆∞·ªùi n·ªïi ti·∫øng. V√† sau khi hu·∫•n luy·ªán, nh·ªØng con c·ª´u ƒë√£ ch·ªçn ƒë√∫ng khu√¥n m·∫∑t ng∆∞·ªùi n·ªïi ti·∫øng t√°m tr√™n m∆∞·ªùi l·∫ßn!
            </div>
            
            <table class="glossary-table">
                <thead><tr><th>Word</th><th>Type</th><th>Vietnamese Meaning</th></tr></thead>
                <tbody>
                    <tr><td>Intelligent</td><td>(adj)</td><td>Th√¥ng minh, s√°ng d·∫°</td></tr>
                    <tr><td>Creature</td><td>(n)</td><td>Sinh v·∫≠t, lo√†i v·∫≠t</td></tr>
                    <tr><td>Recognise</td><td>(v)</td><td>Nh·∫≠n ra, nh·∫≠n di·ªán</td></tr>
                    <tr><td>Celebrity</td><td>(n)</td><td>Ng∆∞·ªùi n·ªïi ti·∫øng</td></tr>
                    <tr><td>Experiment</td><td>(n)</td><td>Th√≠ nghi·ªám</td></tr>
                    <tr><td>Associate</td><td>(v)</td><td>Li√™n k·∫øt, li√™n t∆∞·ªüng</td></tr>
                </tbody>
            </table>
        </div>

        <div class="reading-section" id="passage-2" data-theme="ice">
            <h2 class="reading-title">‚ùÑÔ∏è Ice Sculptures</h2>
            <div class="reading-content">
                <p>Many cities have parks for people to enjoy. And it‚Äôs very <b>(1)...........</b> to find wonderful sculptures in them. However, some sculptures found in Fairbanks, Alaska, aren‚Äôt quite the same as in other cities. When the temperature <b>(2)...........</b> at the end of winter, they all disappear ‚Äì because they‚Äôre made of ice!</p>
                <p>Fairbanks has been the home of the World Ice Art Championship for over 20 years, and artists from many different countries come to create spectacular ice sculptures. The ice is brought from a lake <b>(3)...........</b> near the sculpture park. It‚Äôs said to be so clear that visitors can read a newspaper through it ‚Äì even though the individual pieces are over one metre <b>(4)...........</b>!</p>
                <p>Visitors also have the <b>(5)...........</b> to make their own ice sculptures if they wish, as special classes. There‚Äôs a children‚Äôs play park, too, where <b>(6)...........</b> everything is made of ice, including sculptures of favourite animals. It‚Äôs a great place to visit!</p>
            </div>
            <button class="translate-btn" onclick="toggleTrans('trans-2')">üáªüá≥ B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
            <div id="trans-2" class="translation-box">
                Nhi·ªÅu th√†nh ph·ªë c√≥ c√¥ng vi√™n ƒë·ªÉ m·ªçi ng∆∞·ªùi th∆∞·ªüng th·ª©c. V√† vi·ªác t√¨m th·∫•y nh·ªØng t√°c ph·∫©m ƒëi√™u kh·∫Øc tuy·ªát ƒë·∫πp trong ƒë√≥ l√† r·∫•t ph·ªï bi·∫øn. Tuy nhi√™n, m·ªôt s·ªë t√°c ph·∫©m ƒëi√™u kh·∫Øc ·ªü Fairbanks, Alaska l·∫°i kh√¥ng gi·ªëng ·ªü c√°c th√†nh ph·ªë kh√°c. Khi nhi·ªát ƒë·ªô tƒÉng l√™n v√†o cu·ªëi m√πa ƒë√¥ng, t·∫•t c·∫£ ch√∫ng ƒë·ªÅu bi·∫øn m·∫•t ‚Äì b·ªüi v√¨ ch√∫ng ƒë∆∞·ª£c l√†m b·∫±ng bƒÉng!<br><br>
                Fairbanks l√† n∆°i t·ªï ch·ª©c Gi·∫£i v√¥ ƒë·ªãch Ngh·ªá thu·∫≠t BƒÉng Th·∫ø gi·ªõi trong h∆°n 20 nƒÉm qua, v√† c√°c ngh·ªá sƒ© t·ª´ nhi·ªÅu qu·ªëc gia kh√°c nhau ƒë·∫øn ƒë·ªÉ t·∫°o ra nh·ªØng t√°c ph·∫©m ƒëi√™u kh·∫Øc bƒÉng ngo·∫°n m·ª•c. BƒÉng ƒë∆∞·ª£c l·∫•y t·ª´ m·ªôt h·ªì n·∫±m g·∫ßn c√¥ng vi√™n ƒëi√™u kh·∫Øc. Ng∆∞·ªùi ta n√≥i r·∫±ng bƒÉng trong ƒë·∫øn m·ª©c du kh√°ch c√≥ th·ªÉ ƒë·ªçc b√°o xuy√™n qua n√≥ ‚Äì m·∫∑c d√π c√°c kh·ªëi bƒÉng d√†y h∆°n m·ªôt m√©t!<br><br>
                Du kh√°ch c≈©ng c√≥ c∆° h·ªôi t·ª± l√†m c√°c t√°c ph·∫©m ƒëi√™u kh·∫Øc bƒÉng c·ªßa ri√™ng m√¨nh n·∫øu mu·ªën, th√¥ng qua c√°c l·ªõp h·ªçc ƒë·∫∑c bi·ªát. C≈©ng c√≥ m·ªôt c√¥ng vi√™n vui ch∆°i cho tr·∫ª em, n∆°i ho√†n to√†n m·ªçi th·ª© ƒë·ªÅu ƒë∆∞·ª£c l√†m b·∫±ng bƒÉng, bao g·ªìm c·∫£ c√°c t√°c ph·∫©m ƒëi√™u kh·∫Øc v·ªÅ nh·ªØng con v·∫≠t y√™u th√≠ch. ƒê√≥ l√† m·ªôt n∆°i tuy·ªát v·ªùi ƒë·ªÉ gh√© thƒÉm!
            </div>
            <table class="glossary-table">
                <thead><tr><th>Word</th><th>Type</th><th>Vietnamese Meaning</th></tr></thead>
                <tbody>
                    <tr><td>Sculpture</td><td>(n)</td><td>T√°c ph·∫©m ƒëi√™u kh·∫Øc</td></tr>
                    <tr><td>Temperature</td><td>(n)</td><td>Nhi·ªát ƒë·ªô</td></tr>
                    <tr><td>Spectacular</td><td>(adj)</td><td>H√πng vƒ©, ngo·∫°n m·ª•c</td></tr>
                    <tr><td>Opportunity</td><td>(n)</td><td>C∆° h·ªôi</td></tr>
                    <tr><td>Located</td><td>(adj)</td><td>T·ªça l·∫°c, n·∫±m ·ªü</td></tr>
                    <tr><td>Absolutely</td><td>(adv)</td><td>Tuy·ªát ƒë·ªëi, ho√†n to√†n</td></tr>
                </tbody>
            </table>
        </div>

    </div>

    <div class="split-panel" id="exercise-panel">
        </div>

</div>

<div class="submit-float" onclick="finishTest()">üì§ N·ªòP B√ÄI</div>

<div class="modal-overlay" id="score-modal">
    <div class="scoreboard">
        <div class="score-circle">
            <div class="score-number" id="final-score">0/12</div>
            <div class="score-label">CORRECT</div>
        </div>
        <h2 id="feedback-title">Great Job!</h2>
        <p class="teacher-comment" id="teacher-msg">...</p>
        <button class="btn-finish" onclick="closeModal()">Review Answers</button>
    </div>
</div>

<script>
    // --- DATA ---
    const quizData = [
        // Passage 1: Sheep
        {
            id: 1, passageId: "passage-1",
            q: "1. But in fact, (1)........... to new research...",
            options: { A: "regarding", B: "following", C: "resulting", D: "according" },
            correct: "D",
            explain: "C·∫•u tr√∫c 'According to + Noun' (Theo nh∆∞...) l√† c·ª•m c·ªë ƒë·ªãnh. C√°c t·ª´ c√≤n l·∫°i kh√¥ng ƒëi v·ªõi 'to' ƒë·ªÉ t·∫°o nghƒ©a ph√π h·ª£p trong ng·ªØ c·∫£nh tr√≠ch d·∫´n ngu·ªìn tin.",
            trans: "Nh∆∞ng th·ª±c t·∫ø, theo nghi√™n c·ª©u m·ªõi..."
        },
        {
            id: 2, passageId: "passage-1",
            q: "2. Recognising faces is an important human social (2)...........",
            options: { A: "skill", B: "talent", C: "knowledge", D: "method" },
            correct: "A",
            explain: "'Social skill' (K·ªπ nƒÉng x√£ h·ªôi) l√† m·ªôt collocations (c·ª•m t·ª´ hay ƒëi c√πng nhau). Nh·∫≠n di·ªán khu√¥n m·∫∑t l√† m·ªôt k·ªπ nƒÉng h·ªçc ƒë∆∞·ª£c ch·ª© kh√¥ng h·∫≥n l√† t√†i nƒÉng thi√™n b·∫©m (talent) hay ki·∫øn th·ª©c (knowledge).",
            trans: "Nh·∫≠n di·ªán khu√¥n m·∫∑t l√† m·ªôt k·ªπ nƒÉng x√£ h·ªôi quan tr·ªçng..."
        },
        {
            id: 3, passageId: "passage-1",
            q: "3. ...recognise other sheep as well as (3)........... humans.",
            options: { A: "ordinary", B: "usual", C: "familiar", D: "frequent" },
            correct: "C",
            explain: "'Familiar' (quen thu·ªôc). C·ª´u nh·∫≠n ra nh·ªØng ng∆∞·ªùi ch√∫ng ƒë√£ g·∫∑p (quen). 'Ordinary' (b√¨nh th∆∞·ªùng), 'Usual' (th√¥ng th∆∞·ªùng) kh√¥ng di·ªÖn t·∫£ √Ω nghƒ©a 'ƒë√£ bi·∫øt m·∫∑t'.",
            trans: "...nh·∫≠n ra nh·ªØng con c·ª´u kh√°c c≈©ng nh∆∞ nh·ªØng con ng∆∞·ªùi quen thu·ªôc."
        },
        {
            id: 4, passageId: "passage-1",
            q: "4. Training involved getting the sheep to (4)........... decisions...",
            options: { A: "set", B: "make", C: "have", D: "do" },
            correct: "B",
            explain: "Collocation: 'Make a decision' (ƒê∆∞a ra quy·∫øt ƒë·ªãnh). C√°c ƒë·ªông t·ª´ kh√°c kh√¥ng ƒëi v·ªõi decision trong ng·ªØ c·∫£nh n√†y.",
            trans: "...khi·∫øn nh·ªØng con c·ª´u ph·∫£i ƒë∆∞a ra quy·∫øt ƒë·ªãnh..."
        },
        {
            id: 5, passageId: "passage-1",
            q: "5. ...receive a (5)........... of food for approaching the photograph...",
            options: { A: "reward", B: "benefit", C: "tip", D: "goal" },
            correct: "A",
            explain: "'Reward' (ph·∫ßn th∆∞·ªüng). Th·ª©c ƒÉn l√† ph·∫ßn th∆∞·ªüng cho h√†nh ƒë·ªông ƒë√∫ng. 'Benefit' (l·ª£i √≠ch), 'Tip' (ti·ªÅn boa/m·∫πo), 'Goal' (m·ª•c ti√™u) kh√¥ng ph√π h·ª£p.",
            trans: "...nh·∫≠n ƒë∆∞·ª£c m·ªôt ph·∫ßn th∆∞·ªüng th·ª©c ƒÉn..."
        },
        {
            id: 6, passageId: "passage-1",
            q: "6. Over time, they learned to (6)........... getting food with the celebrity‚Äôs photograph.",
            options: { A: "attach", B: "join", C: "add", D: "connect" }, // Key says Connect (D) - usually associate but connect works conceptually as linking ideas
            correct: "D",
            explain: "Trong ng·ªØ c·∫£nh n√†y, 'connect A with B' c√≥ nghƒ©a l√† li√™n k·∫øt/k·∫øt n·ªëi √Ω t∆∞·ªüng n√†y v·ªõi √Ω t∆∞·ªüng kia (nh·∫≠n ra ·∫£nh -> c√≥ ƒÉn). (L∆∞u √Ω: Associate c≈©ng hay d√πng nh∆∞ng kh√¥ng c√≥ trong ƒë√°p √°n, Connect l√† l·ª±a ch·ªçn t·ªët nh·∫•t).",
            trans: "...ch√∫ng h·ªçc c√°ch li√™n k·∫øt vi·ªác nh·∫≠n th·ª©c ƒÉn v·ªõi b·ª©c ·∫£nh..."
        },
        // Passage 2: Ice
        {
            id: 7, passageId: "passage-2",
            q: "7. And it‚Äôs very (1)........... to find wonderful sculptures in them.",
            options: { A: "usual", B: "general", C: "common", D: "familiar" },
            correct: "C",
            explain: "'Common' (ph·ªï bi·∫øn/th√¥ng th∆∞·ªùng) d√πng ƒë·ªÉ ch·ªâ vi·ªác g√¨ ƒë√≥ x·∫£y ra th∆∞·ªùng xuy√™n ·ªü nhi·ªÅu n∆°i. 'Usual' th∆∞·ªùng ƒëi v·ªõi 'as usual', kh√¥ng ƒëi v·ªõi 'very'.",
            trans: "V√† r·∫•t ph·ªï bi·∫øn khi t√¨m th·∫•y..."
        },
        {
            id: 8, passageId: "passage-2",
            q: "8. When the temperature (2)........... at the end of winter...",
            options: { A: "develops", B: "rises", C: "grows", D: "builds" },
            correct: "B",
            explain: "Temperature rises (Nhi·ªát ƒë·ªô tƒÉng l√™n). ƒê√¢y l√† c√°ch d√πng t·ª´ ch√≠nh x√°c cho nhi·ªát ƒë·ªô. Grows/Develops d√πng cho s·ª± ph√°t tri·ªÉn c·ªßa sinh v·∫≠t/s·ª± vi·ªác.",
            trans: "Khi nhi·ªát ƒë·ªô tƒÉng l√™n v√†o cu·ªëi m√πa ƒë√¥ng..."
        },
        {
            id: 9, passageId: "passage-2",
            q: "9. The ice is brought from a lake (3)........... near the sculpture park.",
            options: { A: "located", B: "arranged", C: "contained", D: "attached" },
            correct: "A",
            explain: "'Located' (t·ªça l·∫°c/n·∫±m t·∫°i). H·ªì n∆∞·ªõc n·∫±m ·ªü g·∫ßn c√¥ng vi√™n. C√°c t·ª´ kh√°c kh√¥ng ch·ªâ v·ªã tr√≠ ƒë·ªãa l√Ω.",
            trans: "...t·ª´ m·ªôt c√°i h·ªì n·∫±m g·∫ßn c√¥ng vi√™n ƒëi√™u kh·∫Øc."
        },
        {
            id: 10, passageId: "passage-2",
            q: "10. ...even though the individual pieces are over one metre (4)...........!",
            options: { A: "heavy", B: "large", C: "strong", D: "thick" }, // Typo in prompt 'think' corrected to 'thick' based on logic
            correct: "D",
            explain: "'Thick' (d√†y). ƒêang m√¥ t·∫£ k√≠ch th∆∞·ªõc t·∫£ng bƒÉng (ƒë·ªô d√†y).",
            trans: "...m·∫∑c d√π c√°c kh·ªëi ri√™ng l·∫ª d√†y h∆°n m·ªôt m√©t!"
        },
        {
            id: 11, passageId: "passage-2",
            q: "11. Visitors also have the (5)........... to make their own ice sculptures...",
            options: { A: "occasion", B: "benefit", C: "opportunity", D: "ability" },
            correct: "C",
            explain: "'Have the opportunity' (c√≥ c∆° h·ªôi) l√†m g√¨ ƒë√≥. 'Occasion' l√† d·ªãp ƒë·∫∑c bi·ªát, kh√¥ng d√πng trong c·∫•u tr√∫c 'have the occasion to verb' ph·ªï bi·∫øn nh∆∞ opportunity.",
            trans: "Du kh√°ch c≈©ng c√≥ c∆° h·ªôi t·ª± l√†m..."
        },
        {
            id: 12, passageId: "passage-2",
            q: "12. ...where (6)........... everything is made of ice...",
            options: { A: "totally", B: "absolutely", C: "completely", D: "fully" },
            correct: "B",
            explain: "'Absolutely everything' l√† m·ªôt c·ª•m nh·∫•n m·∫°nh (collocation) r·∫•t t·ª± nhi√™n. C√°c t·ª´ kh√°c c≈©ng c√≥ nghƒ©a t∆∞∆°ng t·ª± nh∆∞ng 'absolutely' ƒëi v·ªõi 'everything' nghe t·ª± nhi√™n nh·∫•t v·ªõi ng∆∞·ªùi b·∫£n x·ª©.",
            trans: "...n∆°i m√† ho√†n to√†n m·ªçi th·ª© ƒë·ªÅu l√†m b·∫±ng bƒÉng..."
        }
    ];

    let userScore = 0;
    let timerInterval;
    let timeLeft = 600; // 10 minutes
    let isPaused = true; // Start paused

    // --- AUDIO SYSTEM (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High Sine)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
            triggerConfetti();
        } else {
            // Wrong sound (Low Sawtooth)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }
    }

    // --- RENDER QUESTIONS ---
    const exercisePanel = document.getElementById('exercise-panel');
    quizData.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.setAttribute('data-passage', item.passageId);
        
        card.innerHTML = `
            <div class="q-header">
                <span>C√¢u ${index + 1}</span>
                <span>${item.passageId === 'passage-1' ? 'üêë Sheep' : '‚ùÑÔ∏è Ice'}</span>
            </div>
            <p style="margin-bottom:15px; font-weight:600;">${item.q}</p>
            <div class="options-grid" id="q${item.id}-options">
                ${Object.entries(item.options).map(([key, val]) => 
                    `<button class="option-btn" onclick="checkAnswer(${item.id}, '${key}', this)">${key}. ${val}</button>`
                ).join('')}
            </div>
            
            <div class="explanation-area" id="explain-${item.id}">
                <div class="feedback-actions">
                    <div class="teacher-avatar">üë©‚Äçüè´</div>
                    <button class="mini-btn btn-explain" onclick="toggleDetail('exp-txt-${item.id}')">Gi·∫£i th√≠ch</button>
                    <button class="mini-btn btn-trans" onclick="toggleDetail('trans-txt-${item.id}')">D·ªãch</button>
                    <button class="mini-btn btn-vocab" onclick="toggleDetail('voc-txt-${item.id}')">T·ª´ v·ª±ng</button>
                </div>
                <div id="exp-txt-${item.id}" class="detail-box"><b>T·∫°i sao ch·ªçn ${item.correct}?</b><br>${item.explain}</div>
                <div id="trans-txt-${item.id}" class="detail-box"><b>D·ªãch nghƒ©a:</b><br>${item.trans}</div>
                <div id="voc-txt-${item.id}" class="detail-box"><b>T·ª´ m·ªõi:</b><br>H·ªçc sinh h√£y ch√∫ √Ω c√°c t·ª´ in ƒë·∫≠m trong ph·∫ßn gi·∫£i th√≠ch nh√©!</div>
            </div>
        `;
        exercisePanel.appendChild(card);
    });

    // --- INTERACTION LOGIC ---
    function checkAnswer(qId, choice, btn) {
        const qData = quizData.find(d => d.id === qId);
        const parent = document.getElementById(`q${qId}-options`);
        const btns = parent.getElementsByClassName('option-btn');

        // Disable all buttons in this card
        Array.from(btns).forEach(b => b.classList.add('disabled'));

        if (choice === qData.correct) {
            btn.classList.add('correct');
            playSound('correct');
            userScore++;
        } else {
            btn.classList.add('wrong');
            playSound('wrong');
            // Highlight correct answer
            Array.from(btns).forEach(b => {
                if(b.innerText.startsWith(qData.correct)) b.classList.add('correct');
            });
        }

        // Show Explanation
        document.getElementById(`explain-${qId}`).style.display = 'block';
    }

    function toggleDetail(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    function toggleTrans(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    // --- TIMER LOGIC ---
    function formatTime(s) {
        const m = Math.floor(s / 60).toString().padStart(2, '0');
        const sec = (s % 60).toString().padStart(2, '0');
        return `${m}:${sec}`;
    }

    function toggleTimer() {
        if (isPaused) {
            isPaused = false;
            document.getElementById('timer-icon').innerText = '‚è∏Ô∏è';
            timerInterval = setInterval(() => {
                timeLeft--;
                const display = document.getElementById('time-display');
                display.innerText = formatTime(timeLeft);
                if(timeLeft <= 60) document.querySelector('.timer-container').classList.add('urgent');
                if(timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("‚è∞ ƒê√£ h·∫øt gi·ªù l√†m b√†i! B·∫°n h√£y n·ªôp b√†i ƒë·ªÉ xem ƒëi·ªÉm nh√©.");
                }
            }, 1000);
        } else {
            isPaused = true;
            document.getElementById('timer-icon').innerText = '‚ñ∂Ô∏è';
            clearInterval(timerInterval);
        }
    }

    function finishTest() {
        clearInterval(timerInterval);
        document.getElementById('score-modal').style.display = 'flex';
        document.getElementById('final-score').innerText = `${userScore}/12`;
        
        const title = document.getElementById('feedback-title');
        const msg = document.getElementById('teacher-msg');
        
        if(userScore === 12) {
            title.innerText = "TUY·ªÜT ƒê·ªêI! üèÜ";
            msg.innerText = "Con l√† m·ªôt thi√™n t√†i ng√¥n ng·ªØ! Ms Mai An c·ª±c k·ª≥ t·ª± h√†o.";
        } else if (userScore >= 9) {
            title.innerText = "XU·∫§T S·∫ÆC! üåü";
            msg.innerText = "Con l√†m r·∫•t t·ªët, ch·ªâ su√Ωt so√°t ƒëi·ªÉm t·ªëi ƒëa th√¥i.";
        } else if (userScore >= 6) {
            title.innerText = "L√ÄM T·ªêT L·∫ÆM! üëç";
            msg.innerText = "Con ƒë√£ n·∫Øm ƒë∆∞·ª£c c∆° b·∫£n, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ gi·ªèi h∆°n nh√©.";
        } else {
            title.innerText = "C·ªê L√äN NH√â! üí™";
            msg.innerText = "ƒê·ª´ng bu·ªìn, quan tr·ªçng l√† con h·ªçc ƒë∆∞·ª£c g√¨ sau b√†i n√†y. H√£y ƒë·ªçc k·ªπ gi·∫£i th√≠ch c·ªßa c√¥ nh√©.";
        }
    }

    function closeModal() {
        document.getElementById('score-modal').style.display = 'none';
    }

    // --- DYNAMIC THEME OBSERVER ---
    // Change theme based on which passage is currently most visible in the left panel
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const theme = entry.target.getAttribute('data-theme');
                applyTheme(theme);
            }
        });
    }, { threshold: 0.5, root: document.getElementById('reading-panel') });

    observer.observe(document.getElementById('passage-1'));
    observer.observe(document.getElementById('passage-2'));

    function applyTheme(theme) {
        const root = document.documentElement;
        const bg = document.getElementById('dynamic-bg');
        
        if (theme === 'sheep') {
            root.style.setProperty('--primary-color', '#00b894'); // Green
            root.style.setProperty('--secondary-color', '#55efc4');
            // SVG Pattern: Green blobs + Sheep Emoji
            bg.style.backgroundImage = `
                radial-gradient(circle at 10% 20%, rgba(0, 184, 148, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(85, 239, 196, 0.1) 0%, transparent 20%),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ctext x='50%' y='50%' font-size='40' text-anchor='middle' dominant-baseline='middle' fill-opacity='0.1'%3Eüêë%3C/text%3E%3C/svg%3E")
            `;
        } else if (theme === 'ice') {
            root.style.setProperty('--primary-color', '#0984e3'); // Blue
            root.style.setProperty('--secondary-color', '#74b9ff');
            // SVG Pattern: Blue blobs + Ice Emoji
            bg.style.backgroundImage = `
                radial-gradient(circle at 10% 20%, rgba(9, 132, 227, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(116, 185, 255, 0.1) 0%, transparent 20%),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ctext x='50%' y='50%' font-size='40' text-anchor='middle' dominant-baseline='middle' fill-opacity='0.1'%3E‚ùÑÔ∏è%3C/text%3E%3C/svg%3E")
            `;
        }
    }

    // --- CONFETTI EFFECT (Simple JS) ---
    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;

    let particles = [];
    
    function triggerConfetti() {
        for (let i = 0; i < 50; i++) {
            particles.push({
                x: Math.random() * window.innerWidth,
                y: -10,
                r: Math.random() * 6 + 2,
                d: Math.random() * 5 + 2,
                color: `hsl(${Math.random()*360}, 100%, 50%)`,
                tilt: Math.floor(Math.random() * 10) - 10
            });
        }
    }

    function drawConfetti() {
        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
        particles.forEach((p, index) => {
            p.y += p.d;
            p.tilt += 1;
            ctx.beginPath();
            ctx.lineWidth = p.r;
            ctx.strokeStyle = p.color;
            ctx.moveTo(p.x + p.tilt, p.y);
            ctx.lineTo(p.x, p.y + p.tilt + p.r/2);
            ctx.stroke();

            if (p.y > window.innerHeight) particles.splice(index, 1);
        });
        requestAnimationFrame(drawConfetti);
    }
    drawConfetti();

    // Initial Theme
    applyTheme('sheep');

</script>

</body>
</html>