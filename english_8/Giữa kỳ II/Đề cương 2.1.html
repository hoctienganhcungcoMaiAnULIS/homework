<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Mastery Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --accent: #FFD166;
            --correct: #00D26A;
            --correct-shadow: #00994d;
            --wrong: #FF4757;
            --wrong-shadow: #cc0000;
            --text: #2d3436;
            --bg-light: rgba(255, 255, 255, 0.95);
        }

        body {
            margin: 0;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 99%, #FECFEF 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text);
            padding: 20px;
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header-small {
            text-align: center;
            font-size: 14px;
            color: var(--primary);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            background: #fff;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .main-title {
            text-align: center;
            font-size: 36px;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 0 var(--primary), -2px -2px 0 var(--primary), 2px -2px 0 var(--primary), -2px 2px 0 var(--primary), 0 4px 0 rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .section-title {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: 800;
            margin-top: 40px;
            margin-bottom: 20px;
            box-shadow: 0 5px 0 #5f3a87;
        }

        .card {
            background: var(--bg-light);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            transition: transform 0.3s;
            position: relative;
        }

        .question-text {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* MCQ Styles */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #e0e0e0;
            text-align: left;
        }

        .btn-option:hover:not(:disabled) {
            transform: scale(1.02);
            border-color: var(--secondary);
            box-shadow: 0 5px 0 var(--secondary);
        }

        .btn-option:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: 0 0 0 transparent;
        }

        .btn-option.correct {
            background: var(--correct);
            border-color: var(--correct);
            color: white;
            box-shadow: 0 5px 0 var(--correct-shadow);
        }

        .btn-option.wrong {
            background: var(--wrong);
            border-color: var(--wrong);
            color: white;
            box-shadow: 0 5px 0 var(--wrong-shadow);
            animation: shake 0.4s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Gap Fill Styles */
        .gap {
            display: inline-block;
            min-width: 80px;
            height: 35px;
            border-bottom: 3px solid var(--primary);
            background: #f0e6ff;
            border-radius: 8px 8px 0 0;
            margin: 0 5px;
            cursor: pointer;
            text-align: center;
            font-weight: 800;
            color: var(--primary);
            line-height: 35px;
            padding: 0 10px;
            transition: all 0.2s;
        }

        .gap:hover {
            background: var(--accent);
            border-bottom-color: #e6b800;
        }

        .gap.filled-correct {
            background: var(--correct);
            border-bottom-color: var(--correct-shadow);
            color: white;
            pointer-events: none;
        }
        
        .gap.filled-wrong {
            background: var(--wrong);
            border-bottom-color: var(--wrong-shadow);
            color: white;
            animation: shake 0.4s;
        }

        /* Sorting/Reorder Styles */
        .chip-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            min-height: 50px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ccc;
        }

        .chip {
            background: var(--secondary);
            color: white;
            padding: 10px 15px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 0 #009980;
            transition: all 0.2s;
        }
        .chip:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 transparent;
        }

        .check-order-btn {
            background: var(--accent);
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 16px;
            color: #d49a00;
            cursor: pointer;
            box-shadow: 0 5px 0 #d49a00;
            margin-top: 10px;
            transition: all 0.2s;
        }
        .check-order-btn:hover { transform: scale(1.05); }
        .check-order-btn:active { transform: translateY(5px); box-shadow: 0 0 0 transparent; }

        /* Explanation Box */
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fdfbf7;
            border: 2px solid #ffeaa7;
            border-left: 8px solid var(--accent);
            border-radius: 15px;
            font-size: 15px;
            line-height: 1.6;
            animation: slideDown 0.3s ease-out;
        }
        .explanation h4 {
            margin-top: 0;
            color: #d35400;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .explanation strong { color: var(--primary); }
        .explanation ul { padding-left: 20px; }
        .explanation li { margin-bottom: 8px; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Popup Modal for Gap Fill */
        #gapModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-btn {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 12px;
            border: none;
            background: var(--primary);
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 0 #5f3a87;
        }
        .modal-btn:active { transform: translateY(4px); box-shadow: 0 0 0 transparent; }

        /* Submit Button */
        .submit-container {
            text-align: center;
            margin: 40px 0;
        }
        .submit-btn {
            background: var(--primary);
            color: white;
            font-size: 24px;
            font-weight: 900;
            padding: 15px 40px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 0 #5f3a87;
            transition: all 0.2s;
            font-family: 'Nunito', sans-serif;
        }
        .submit-btn:hover { transform: scale(1.05); }
        .submit-btn:active { transform: translateY(8px); box-shadow: 0 0 0 transparent; }

        /* Result Popup */
        #resultModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .result-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        .result-score {
            font-size: 48px;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/bell_ding.ogg"></audio>
    <audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

    <div class="container" id="quiz-container">
        <div style="text-align: center;">
            <div class="header-small">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
            <div class="main-title">üåü ENGLISH MASTERY TEST üåü</div>
        </div>

        </div>

    <div class="submit-container">
        <button class="submit-btn" onclick="showResults()"><i class="fas fa-flag-checkered"></i> N·ªòP B√ÄI!</button>
    </div>

    <div id="gapModal">
        <div class="modal-content" id="gapModalContent">
            <h3 style="margin-top:0; color: var(--primary);">Ch·ªçn ƒë√°p √°n ƒë√∫ng</h3>
            <div id="gapOptionsContainer"></div>
            <button onclick="closeGapModal()" style="margin-top:15px; padding:10px; border-radius:10px; border:none; background:#ccc; cursor:pointer;">H·ªßy</button>
        </div>
    </div>

    <div id="resultModal">
        <div class="result-content">
            <h2 style="color: var(--primary); font-size: 32px;"><i class="fas fa-crown"></i> CH√öC M·ª™NG!</h2>
            <p style="font-size: 18px; color: #666;">B·∫°n ƒë√£ ho√†n th√†nh xu·∫•t s·∫Øc b√†i ki·ªÉm tra!</p>
            <div class="result-score" id="finalScore">0 / 0</div>
            <p id="resultMessage" style="font-size: 20px; font-weight: 700; color: var(--secondary);"></p>
            <button class="submit-btn" style="font-size: 18px; padding: 10px 30px;" onclick="location.reload()">L√†m L·∫°i Nh√©!</button>
        </div>
    </div>

<script>
// ==========================================
// C∆† S·ªû D·ªÆ LI·ªÜU C√ÇU H·ªéI & GI·∫¢I TH√çCH SI√äU CHI TI·∫æT
// ==========================================
const quizData = [
    {
        section: "I. Find the word which has a different stress position from the others.",
        questions: [
            {
                type: "mcq",
                q: "1. A. culture B. farmer C. native D. arrive",
                options: ["A. culture", "B. farmer", "C. native", "D. arrive"],
                answer: "D. arrive",
                exp: `1. <strong>D·ªãch c√¢u h·ªèi:</strong> T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i.<br>
                      2. <strong>Ph√¢n t√≠ch 4 ƒë√°p √°n:</strong><br>
                      - A. culture /Ààk ål.t É…ôr/ (n): vƒÉn h√≥a -> Tr·ªçng √¢m √¢m ti·∫øt 1.<br>
                      - B. farmer /Ààf…ëÀê.m…ôr/ (n): n√¥ng d√¢n -> Tr·ªçng √¢m √¢m ti·∫øt 1.<br>
                      - C. native /Ààne…™.t…™v/ (adj): b·∫£n ƒë·ªãa -> Tr·ªçng √¢m √¢m ti·∫øt 1.<br>
                      - D. arrive /…ôÀàra…™v/ (v): ƒë·∫øn -> Tr·ªçng √¢m √¢m ti·∫øt 2.<br>
                      3. <strong>T·∫°i sao ch·ªçn D?</strong> V√¨ 'arrive' c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2, trong khi c√°c t·ª´ c√≤n l·∫°i r∆°i v√†o √¢m ti·∫øt 1.<br>
                      4. <strong>T·∫°i sao 3 ƒë√°p √°n c√≤n l·∫°i sai?</strong> V√¨ ch√∫ng ƒë·ªÅu c√≥ chung quy lu·∫≠t tr·ªçng √¢m (r∆°i v√†o √¢m 1), kh√¥ng ph·∫£i l√† t·ª´ c√≥ s·ª± kh√°c bi·ªát.`
            },
            {
                type: "mcq",
                q: "2. A. species B. until C. complete D. throughout",
                options: ["A. species", "B. until", "C. complete", "D. throughout"],
                answer: "A. species",
                exp: `1. <strong>D·ªãch c√¢u h·ªèi:</strong> T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c bi·ªát.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      - A. species /ÀàspiÀê. ÉiÀêz/ (n): gi·ªëng, lo√†i -> Tr·ªçng √¢m 1.<br>
                      - B. until /…ônÀàt…™l/ (prep): cho ƒë·∫øn khi -> Tr·ªçng √¢m 2.<br>
                      - C. complete /k…ômÀàpliÀêt/ (v/adj): ho√†n th√†nh -> Tr·ªçng √¢m 2.<br>
                      - D. throughout /Œ∏ruÀêÀàa ät/ (prep): xuy√™n su·ªët -> Tr·ªçng √¢m 2.<br>
                      3. <strong>T·∫°i sao ch·ªçn A?</strong> Tr·ªçng √¢m c·ªßa 'species' r∆°i v√†o √¢m 1, c√°c t·ª´ c√≤n l·∫°i √¢m 2.<br>
                      4. <strong>T·∫°i sao sai?</strong> B, C, D ƒë·ªÅu c√≥ chung tr·ªçng √¢m 2.`
            },
            {
                type: "mcq",
                q: "3. A. honesty B. variety C. usually D. musical",
                options: ["A. honesty", "B. variety", "C. usually", "D. musical"],
                answer: "B. variety",
                exp: `1. <strong>D·ªãch:</strong> T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c bi·ªát.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      - A. honesty /Àà…ín.…ô.sti/ (n): s·ª± trung th·ª±c -> Tr·ªçng √¢m 1.<br>
                      - B. variety /v…ôÀàra…™.…ô.ti/ (n): s·ª± ƒëa d·∫°ng -> Tr·ªçng √¢m 2. (Quy t·∫Øc: t·ª´ t·∫≠n c√πng ƒëu√¥i -ety tr·ªçng √¢m r∆°i v√†o tr∆∞·ªõc n√≥).<br>
                      - C. usually /ÀàjuÀê. íu.…ô.li/ (adv): th∆∞·ªùng xuy√™n -> Tr·ªçng √¢m 1.<br>
                      - D. musical /ÀàmjuÀê.z…™.k…ôl/ (adj): thu·ªôc v·ªÅ √¢m nh·∫°c -> Tr·ªçng √¢m 1.<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt 2, kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i r∆°i v√†o √¢m 1.`
            },
            {
                type: "mcq",
                q: "4. A. yesterday B. occasion C. generous D. evening",
                options: ["A. yesterday", "B. occasion", "C. generous", "D. evening"],
                answer: "B. occasion",
                exp: `1. <strong>D·ªãch:</strong> T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c bi·ªát.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      - A. yesterday /Ààjes.t…ô.de…™/ (n/adv): ng√†y h√¥m qua -> Tr·ªçng √¢m 1.<br>
                      - B. occasion /…ôÀàke…™. í…ôn/ (n): d·ªãp, c∆° h·ªôi -> Tr·ªçng √¢m 2. (T·ª´ ƒëu√¥i -ion tr·ªçng √¢m r∆°i v√†o ngay tr∆∞·ªõc n√≥).<br>
                      - C. generous /Ààd íen.…ôr.…ôs/ (adj): h√†o ph√≥ng -> Tr·ªçng √¢m 1.<br>
                      - D. evening /ÀàiÀêv.n…™≈ã/ (n): bu·ªïi t·ªëi -> Tr·ªçng √¢m 1.<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> 'occasion' c√≥ tr·ªçng √¢m 2, kh√°c v·ªõi ph·∫ßn c√≤n l·∫°i c√≥ tr·ªçng √¢m 1.`
            },
            {
                type: "mcq",
                q: "5. A. disadvantage B. environment C. speciality D. nationality",
                options: ["A. disadvantage", "B. environment", "C. speciality", "D. nationality"],
                answer: "B. environment",
                exp: `1. <strong>D·ªãch:</strong> T√¨m t·ª´ c√≥ tr·ªçng √¢m kh√°c bi·ªát.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      - A. disadvantage /Àåd…™s.…ôdÀàv…ëÀên.t…™d í/ (n): b·∫•t l·ª£i -> Tr·ªçng √¢m ch√≠nh r∆°i v√†o √¢m 3.<br>
                      - B. environment /…™nÀàva…™.r…ôn.m…ônt/ (n): m√¥i tr∆∞·ªùng -> Tr·ªçng √¢m 2.<br>
                      - C. speciality /Àåspe É.iÀà√¶l.…ô.ti/ (n): ƒë·∫∑c s·∫£n -> Tr·ªçng √¢m 3 (ƒëu√¥i -ity).<br>
                      - D. nationality /Àån√¶ É.…ônÀà√¶l.…ô.ti/ (n): qu·ªëc t·ªãch -> Tr·ªçng √¢m 3 (ƒëu√¥i -ity).<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> 'environment' c√≥ tr·ªçng √¢m 2, trong khi c√°c t·ª´ c√≤n l·∫°i c√≥ tr·ªçng √¢m ch√≠nh r∆°i v√†o √¢m ti·∫øt th·ª© 3.`
            }
        ]
    },
    {
        section: "II. Complete the sentences with the correct form of the words in brackets. (GAP FILL)",
        questions: [
            {
                type: "gap",
                text: "1. The tornado [gap] lots of roofs in our village. (damage)",
                options: ["damage", "damaged", "damages", "damaging"],
                answer: "damaged",
                exp: `1. <strong>D·ªãch c√¢u:</strong> C∆°n l·ªëc xo√°y ƒë√£ l√†m h∆∞ h·ªèng nhi·ªÅu m√°i nh√† trong l√†ng c·ªßa ch√∫ng t√¥i.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> T·ª´ g·ªëc "damage" (ƒë·ªông t·ª´/danh t·ª´). C·∫ßn ƒëi·ªÅn m·ªôt ƒë·ªông t·ª´. C√°c d·∫°ng: damage (V1), damaged (V-ed), damages (V-s), damaging (V-ing).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'damaged'?</strong> S·ª± vi·ªác "c∆°n l·ªëc xo√°y t√†n ph√°" ƒë√£ x·∫£y ra trong qu√° kh·ª©, n√™n ph·∫£i chia th√¨ Qu√° kh·ª© ƒë∆°n (Past Simple).<br>
                      4. <strong>T·∫°i sao c√°c d·∫°ng kh√°c sai?</strong> 'damage'/'damages' (hi·ªán t·∫°i) sai ng·ªØ c·∫£nh, 'damaging' thi·∫øu to be (was damaging).`
            },
            {
                type: "gap",
                text: "2. I want to [gap] about this problem with your manager. (complaint)",
                options: ["complain", "complaint", "complained", "complaining"],
                answer: "complain",
                exp: `1. <strong>D·ªãch c√¢u:</strong> T√¥i mu·ªën ph√†n n√†n v·ªÅ v·∫•n ƒë·ªÅ n√†y v·ªõi qu·∫£n l√Ω c·ªßa b·∫°n.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> T·ª´ g·ªëc "complaint" (Danh t·ª´: l·ªùi ph√†n n√†n). ƒê·ªông t·ª´ t∆∞∆°ng ·ª©ng l√† "complain" (ph√†n n√†n).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'complain'?</strong> C·∫•u tr√∫c <strong>want to + V(nguy√™n th·ªÉ)</strong>. Do ƒë√≥ ta c·∫ßn ƒë·ªïi danh t·ª´ complaint th√†nh ƒë·ªông t·ª´ nguy√™n th·ªÉ complain.<br>
                      4. <strong>T·∫°i sao sai?</strong> 'complaint' l√† danh t·ª´ kh√¥ng ƒë·ª©ng sau 'to' ·ªü ƒë√¢y. 'complained' / 'complaining' sai d·∫°ng ƒë·ªông t·ª´ sau 'to'.`
            },
            {
                type: "gap",
                text: "3. There is a [gap] store at the end of the street. (convenient)",
                options: ["convenient", "convenience", "conveniently", "inconvenient"],
                answer: "convenience",
                exp: `1. <strong>D·ªãch c√¢u:</strong> C√≥ m·ªôt c·ª≠a h√†ng ti·ªán l·ª£i ·ªü cu·ªëi con ph·ªë.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "convenient" (T√≠nh t·ª´: ti·ªán l·ª£i). Danh t·ª´ l√† "convenience".<br>
                      3. <strong>T·∫°i sao ch·ªçn 'convenience'?</strong> Trong ti·∫øng Anh c√≥ Collocation (c·ª•m t·ª´ c·ªë ƒë·ªãnh) l√† <strong>"convenience store"</strong> (c·ª≠a h√†ng ti·ªán l·ª£i), s·ª≠ d·ª•ng danh t·ª´ gh√©p.<br>
                      4. <strong>T·∫°i sao sai?</strong> Kh√¥ng d√πng t√≠nh t·ª´ 'convenient store' d√π d·ªãch ra ti·∫øng Vi·ªát nghe c√≥ v·∫ª h·ª£p l√Ω. ƒê√¢y l√† b·∫´y c·ª•m t·ª´ c·ªë ƒë·ªãnh.`
            },
            {
                type: "gap",
                text: "4. She gave us practical tips about treating [gap] wastes. (poison)",
                options: ["poison", "poisonous", "poisoned", "poisoning"],
                answer: "poisonous",
                exp: `1. <strong>D·ªãch c√¢u:</strong> C√¥ ·∫•y ƒë√£ cho ch√∫ng t√¥i nh·ªØng m·∫πo th·ª±c t·∫ø v·ªÅ c√°ch x·ª≠ l√Ω ch·∫•t th·∫£i ƒë·ªôc h·∫°i.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "poison" (Danh t·ª´: ch·∫•t ƒë·ªôc). T√≠nh t·ª´ l√† "poisonous" (c√≥ ƒë·ªôc).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'poisonous'?</strong> Ch·ªó tr·ªëng ƒë·ª©ng tr∆∞·ªõc danh t·ª´ "wastes" (ch·∫•t th·∫£i), n√™n ta c·∫ßn m·ªôt <strong>T√≠nh t·ª´ (Adjective)</strong> ƒë·ªÉ b·ªï nghƒ©a cho n√≥ (ch·∫•t th·∫£i nh∆∞ th·∫ø n√†o? -> ch·∫•t th·∫£i c√≥ ƒë·ªôc).<br>
                      4. <strong>T·∫°i sao sai?</strong> 'poison' l√† danh t·ª´. 'poisoned' (b·ªã nhi·ªÖm ƒë·ªôc - th∆∞·ªùng d√πng cho ng∆∞·ªùi/v·∫≠t b·ªã ƒë·∫ßu ƒë·ªôc).`
            },
            {
                type: "gap",
                text: "5. A lot of buildings [gap] during the earthquake last month. (collapse)",
                options: ["collapse", "collapsed", "are collapsing", "collapses"],
                answer: "collapsed",
                exp: `1. <strong>D·ªãch c√¢u:</strong> Nhi·ªÅu t√≤a nh√† ƒë√£ s·ª•p ƒë·ªï trong tr·∫≠n ƒë·ªông ƒë·∫•t th√°ng tr∆∞·ªõc.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "collapse" (ƒê·ªông t·ª´: s·ª•p ƒë·ªï).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'collapsed'?</strong> D·∫•u hi·ªáu nh·∫≠n bi·∫øt th√¨ Qu√° kh·ª© ƒë∆°n: <strong>"last month"</strong> (th√°ng tr∆∞·ªõc). Do ƒë√≥ ƒë·ªông t·ª´ th√™m -ed.<br>
                      4. <strong>T·∫°i sao sai?</strong> 'collapse', 'collapses', 'are collapsing' ƒë·ªÅu l√† c√°c th√¨ ·ªü hi·ªán t·∫°i, kh√¥ng ph√π h·ª£p v·ªõi m·ªëc th·ªùi gian trong qu√° kh·ª©.`
            },
            {
                type: "gap",
                text: "6. Air [gap] is a serious problem that the government needs to care about. (pollute)",
                options: ["pollute", "pollutes", "pollution", "polluted"],
                answer: "pollution",
                exp: `1. <strong>D·ªãch c√¢u:</strong> √î nhi·ªÖm kh√¥ng kh√≠ l√† m·ªôt v·∫•n ƒë·ªÅ nghi√™m tr·ªçng m√† ch√≠nh ph·ªß c·∫ßn quan t√¢m.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "pollute" (ƒê·ªông t·ª´: l√†m √¥ nhi·ªÖm). Danh t·ª´ l√† "pollution".<br>
                      3. <strong>T·∫°i sao ch·ªçn 'pollution'?</strong> Ch·ªó tr·ªëng ƒë√≥ng vai tr√≤ l√†m Ch·ªß ng·ªØ trong c√¢u, k·∫øt h·ª£p v·ªõi "Air" t·∫°o th√†nh danh t·ª´ gh√©p <strong>"Air pollution"</strong> (S·ª± √¥ nhi·ªÖm kh√¥ng kh√≠).<br>
                      4. <strong>T·∫°i sao sai?</strong> 'pollute', 'polluted' l√† ƒë·ªông t·ª´/t√≠nh t·ª´, kh√¥ng th·ªÉ ƒë√≥ng vai tr√≤ l√†m danh t·ª´ ch√≠nh trong c·ª•m ch·ªß ng·ªØ n√†y.`
            },
            {
                type: "gap",
                text: "7. She doesn‚Äôt like [gap] at the market because it is crowded and dirty. (shop)",
                options: ["shop", "shopped", "shopping", "shops"],
                answer: "shopping",
                exp: `1. <strong>D·ªãch c√¢u:</strong> C√¥ ·∫•y kh√¥ng th√≠ch mua s·∫Øm ·ªü ch·ª£ v√¨ n√≥ ƒë√¥ng ƒë√∫c v√† b·∫©n th·ªâu.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "shop" (ƒê·ªông t·ª´: mua s·∫Øm).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'shopping'?</strong> C·∫•u tr√∫c ng·ªØ ph√°p: <strong>like / don't like + V-ing</strong> (Th√≠ch/Kh√¥ng th√≠ch l√†m g√¨ ƒë√≥ nh∆∞ m·ªôt s·ªü th√≠ch/th√≥i quen). Do ƒë√≥ shop -> shopping (g·∫•p ƒë√¥i ph·ª• √¢m 'p').<br>
                      4. <strong>T·∫°i sao sai?</strong> 'shop' (nguy√™n th·ªÉ) sai ng·ªØ ph√°p sau like. 'shopped' l√† qu√° kh·ª©.`
            },
            {
                type: "gap",
                text: "8. Our system can [gap] predict when a natural disaster will occur. (accurate)",
                options: ["accurate", "accurately", "accuracy", "inaccurate"],
                answer: "accurately",
                exp: `1. <strong>D·ªãch c√¢u:</strong> H·ªá th·ªëng c·ªßa ch√∫ng t√¥i c√≥ th·ªÉ d·ª± ƒëo√°n m·ªôt c√°ch ch√≠nh x√°c khi n√†o th·∫£m h·ªça thi√™n nhi√™n s·∫Ω x·∫£y ra.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "accurate" (T√≠nh t·ª´: ch√≠nh x√°c). Tr·∫°ng t·ª´ l√† "accurately".<br>
                      3. <strong>T·∫°i sao ch·ªçn 'accurately'?</strong> Ch·ªó tr·ªëng ƒë·ª©ng gi·ªØa tr·ª£ ƒë·ªông t·ª´ "can" v√† ƒë·ªông t·ª´ ch√≠nh "predict" (d·ª± ƒëo√°n). Ta c·∫ßn m·ªôt <strong>Tr·∫°ng t·ª´ (Adverb)</strong> ƒë·ªÉ b·ªï nghƒ©a cho ƒë·ªông t·ª´ "predict" (d·ª± ƒëo√°n nh∆∞ th·∫ø n√†o? -> d·ª± ƒëo√°n m·ªôt c√°ch ch√≠nh x√°c).<br>
                      4. <strong>T·∫°i sao sai?</strong> 'accurate' l√† t√≠nh t·ª´ (ch·ªâ b·ªï nghƒ©a cho danh t·ª´), 'accuracy' l√† danh t·ª´.`
            },
            {
                type: "gap",
                text: "9. Population growth is causing [gap] of wildlife habitats throughout the world. (destruct)",
                options: ["destruct", "destructive", "destroy", "destruction"],
                answer: "destruction",
                exp: `1. <strong>D·ªãch c√¢u:</strong> S·ª± gia tƒÉng d√¢n s·ªë ƒëang g√¢y ra s·ª± ph√° h·ªßy m√¥i tr∆∞·ªùng s·ªëng c·ªßa ƒë·ªông v·∫≠t hoang d√£ tr√™n to√†n th·∫ø gi·ªõi.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "destruct" (g·ªëc t·ª´). Danh t·ª´ l√† "destruction" (s·ª± ph√° h·ªßy).<br>
                      3. <strong>T·∫°i sao ch·ªçn 'destruction'?</strong> ƒê·ª©ng sau ƒë·ªông t·ª´ "causing" (g√¢y ra) c·∫ßn m·ªôt <strong>Danh t·ª´ (Noun)</strong> l√†m t√¢n ng·ªØ (g√¢y ra C√ÅI G√å?). Do ƒë√≥ ta d√πng "destruction".<br>
                      4. <strong>T·∫°i sao sai?</strong> 'destructive' l√† t√≠nh t·ª´, 'destroy' l√† ƒë·ªông t·ª´.`
            },
            {
                type: "gap",
                text: "10. I think protecting the [gap] is the duty of everyone in the community. (environmental)",
                options: ["environment", "environmental", "environmentally", "environments"],
                answer: "environment",
                exp: `1. <strong>D·ªãch c√¢u:</strong> T√¥i nghƒ© b·∫£o v·ªá m√¥i tr∆∞·ªùng l√† nghƒ©a v·ª• c·ªßa m·ªçi ng∆∞·ªùi trong c·ªông ƒë·ªìng.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´:</strong> "environmental" (T√≠nh t·ª´: thu·ªôc v·ªÅ m√¥i tr∆∞·ªùng). Danh t·ª´ l√† "environment".<br>
                      3. <strong>T·∫°i sao ch·ªçn 'environment'?</strong> Sau m·∫°o t·ª´ <strong>"the"</strong> ta b·∫Øt bu·ªôc ph·∫£i d√πng m·ªôt <strong>Danh t·ª´ (Noun)</strong>. "Protecting the environment" = B·∫£o v·ªá m√¥i tr∆∞·ªùng.<br>
                      4. <strong>T·∫°i sao sai?</strong> 'environmental' l√† t√≠nh t·ª´ kh√¥ng ƒë·ª©ng m·ªôt m√¨nh sau 'the' ·ªü ƒë√¢y. 'environments' (s·ªë nhi·ªÅu) kh√¥ng h·ª£p ng·ªØ c·∫£nh b·∫£o v·ªá m√¥i tr∆∞·ªùng chung chung.`
            }
        ]
    },
    {
        section: "III. Put the verbs in brackets into the past simple or past continuous. (GAP FILL)",
        questions: [
            {
                type: "gap",
                text: "1. [gap] (you, swim) when someone [gap] (steal) your wallet?",
                options: ["Were you swimming|stole", "Did you swim|was stealing", "Are you swimming|steals", "Was you swimming|stole"],
                answer: ["Were you swimming", "stole"],
                exp: `1. <strong>D·ªãch:</strong> B·∫°n c√≥ ƒëang b∆°i khi ai ƒë√≥ l·∫•y c·∫Øp v√≠ c·ªßa b·∫°n kh√¥ng?<br>
                      2. <strong>Ph√¢n t√≠ch:</strong> C√¢u h·ªèi c√≥ t·ª´ "when" n·ªëi 2 h√†nh ƒë·ªông trong qu√° kh·ª©.<br>
                      3. <strong>T·∫°i sao ch·ªçn:</strong> H√†nh ƒë·ªông "b∆°i" ƒëang di·ªÖn ra k√©o d√†i -> d√πng Qu√° kh·ª© ti·∫øp di·ªÖn (Were you swimming). H√†nh ƒë·ªông "l·∫•y v√≠" chen ngang ƒë·ªôt ng·ªôt -> d√πng Qu√° kh·ª© ƒë∆°n (stole).<br>
                      4. <strong>L·ªói sai th∆∞·ªùng g·∫∑p:</strong> Chia ng∆∞·ª£c l·∫°i (Did you swim when someone was stealing) l√† sai logic (b·∫°n c√≥ b∆°i khi ai ƒë√≥ ƒëang l·∫•y v√≠ kh√¥ng -> v√¥ l√Ω).`
            },
            {
                type: "gap",
                text: "2. The dragon [gap] (fly) over the castle when he [gap] (hear) a girl crying.",
                options: ["flew|was hearing", "was flying|heard", "flies|hears", "flew|heard"],
                answer: ["was flying", "heard"],
                exp: `1. <strong>D·ªãch:</strong> Con r·ªìng ƒëang bay qua l√¢u ƒë√†i th√¨ nghe th·∫•y ti·∫øng m·ªôt c√¥ g√°i kh√≥c.<br>
                      2. <strong>Ph√¢n t√≠ch c·∫•u tr√∫c:</strong> H√†nh ƒë·ªông ƒëang di·ªÖn ra (Past Continuous) + WHEN + H√†nh ƒë·ªông chen ngang (Past Simple).<br>
                      3. <strong>T·∫°i sao ch·ªçn:</strong> R·ªìng "ƒëang bay" (was flying - h√†nh ƒë·ªông n·ªÅn). B·∫•t ch·ª£t "nghe th·∫•y" (heard - chen ngang, ƒë·ªông t·ª´ tri gi√°c hear kh√¥ng chia V-ing).`
            },
            {
                type: "gap",
                text: "3. Cinderella [gap] (hear) the chimes of midnight while she [gap] (dance) with the prince.",
                options: ["heard|was dancing", "was hearing|danced", "hears|is dancing", "heard|danced"],
                answer: ["heard", "was dancing"],
                exp: `1. <strong>D·ªãch:</strong> L·ªç Lem nghe th·∫•y ti·∫øng chu√¥ng ƒëi·ªÉm n·ª≠a ƒë√™m trong khi c√¥ ·∫•y ƒëang khi√™u v≈© v·ªõi ho√†ng t·ª≠.<br>
                      2. <strong>C·∫•u tr√∫c:</strong> WHILE + Qu√° kh·ª© ti·∫øp di·ªÖn (h√†nh ƒë·ªông ƒëang x·∫£y ra).<br>
                      3. <strong>T·∫°i sao ch·ªçn:</strong> "while she was dancing" (trong khi ƒëang khi√™u v≈©). H√†nh ƒë·ªông nghe th·∫•y chu√¥ng l√† h√†nh ƒë·ªông ng·∫Øn, chen ngang -> "heard". (Hear kh√¥ng chia ti·∫øp di·ªÖn).`
            },
            {
                type: "gap",
                text: "4. Snow White [gap] (sing) softly beside the well when suddenly she [gap] (see) a dwarf.",
                options: ["sang|saw", "was singing|saw", "was singing|was seeing", "sings|sees"],
                answer: ["was singing", "saw"],
                exp: `1. <strong>D·ªãch:</strong> B·∫°ch Tuy·∫øt ƒëang h√°t d·ªãu d√†ng b√™n gi·∫øng th√¨ ƒë·ªôt nhi√™n c√¥ nh√¨n th·∫•y m·ªôt ch√∫ l√πn.<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> "was singing" (ƒëang h√°t - h√†nh ƒë·ªông d√†i). "suddenly she saw" (ƒë·ªôt nhi√™n nh√¨n th·∫•y - h√†nh ƒë·ªông chen ngang, qu√° kh·ª© ƒë∆°n).<br>
                      3. <strong>L∆∞u √Ω:</strong> T·ª´ "suddenly" (ƒë·ªôt nhi√™n) l√† d·∫•u hi·ªáu kinh ƒëi·ªÉn c·ªßa th√¨ Qu√° kh·ª© ƒë∆°n (chen ngang).`
            },
            {
                type: "gap",
                text: "5. While the hunter [gap] (pass) near by the hut, he [gap] (notice) the wolf.",
                options: ["passed|noticed", "was passing|was noticing", "was passing|noticed", "passes|notices"],
                answer: ["was passing", "noticed"],
                exp: `1. <strong>D·ªãch:</strong> Trong khi ng∆∞·ªùi th·ª£ sƒÉn ƒëang ƒëi ngang qua t√∫p l·ªÅu, anh ta ch√∫ √Ω th·∫•y con s√≥i.<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> Sau 'While' d√πng Qu√° kh·ª© ti·∫øp di·ªÖn cho h√†nh ƒë·ªông n·ªÅn "was passing" (ƒëang ƒëi ngang qua). H√†nh ƒë·ªông "notice" (ƒë·ªÉ √Ω, nh·∫≠n ra) l√† h√†nh ƒë·ªông ng·∫Øn, gi√°c quan -> d√πng Qu√° kh·ª© ƒë∆°n "noticed".`
            },
            {
                type: "gap",
                text: "6. As the Queen [gap] (bathe), a frog [gap] (jump) out of the water and [gap] (talk) to her.",
                options: ["was bathing|jumped|talked", "bathed|was jumping|talked", "was bathing|jumped|was talking", "bathed|jumped|talked"],
                answer: ["was bathing", "jumped", "talked"],
                exp: `1. <strong>D·ªãch:</strong> Khi N·ªØ ho√†ng ƒëang t·∫Øm, m·ªôt con ·∫øch nh·∫£y ra kh·ªèi n∆∞·ªõc v√† n√≥i chuy·ªán v·ªõi b√†.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong> "As" ·ªü ƒë√¢y gi·ªëng "While". H√†nh ƒë·ªông ƒëang t·∫Øm l√† h√†nh ƒë·ªông d√†i -> "was bathing".<br>
                      3. <strong>Hai ch·ªó tr·ªëng sau:</strong> Hai h√†nh ƒë·ªông "jump" v√† "talk" c·ªßa con ·∫øch l√† chu·ªói h√†nh ƒë·ªông li√™n ti·∫øp, ng·∫Øn g·ªçn, c·∫Øt ngang vi·ªác t·∫Øm -> C·∫£ 2 chia Qu√° kh·ª© ƒë∆°n: "jumped" and "talked".`
            },
            {
                type: "gap",
                text: "7. The princess [gap] (try) to tell the prince the truth but he [gap] (not, listen).",
                options: ["tried|wasn't listening", "was trying|didn't listen", "tried|didn't listen", "was trying|wasn't listening"],
                answer: ["tried", "wasn't listening"],
                exp: `1. <strong>D·ªãch:</strong> C√¥ng ch√∫a ƒë√£ c·ªë g·∫Øng n√≥i cho ho√†ng t·ª≠ s·ª± th·∫≠t nh∆∞ng ch√†ng kh√¥ng ch·ªãu l·∫Øng nghe.<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> "tried" (Qu√° kh·ª© ƒë∆°n - k·ªÉ l·∫°i n·ªó l·ª±c c·ªßa c√¥ng ch√∫a). H√†nh ƒë·ªông kh√¥ng l·∫Øng nghe l√† m·ªôt tr·∫°ng th√°i k√©o d√†i, th·ªÉ hi·ªán s·ª± t·ª´ ch·ªëi ti·∫øp nh·∫≠n th√¥ng tin l√∫c ƒë√≥ -> "wasn't listening" (Qu√° kh·ª© ti·∫øp di·ªÖn). <em>(Ho·∫∑c didn't listen c≈©ng ƒë∆∞·ª£c ch·∫•p nh·∫≠n t√πy ng·ªØ c·∫£nh, nh∆∞ng ·ªü ƒë√¢y d√πng wasn't listening nh·∫•n m·∫°nh th√°i ƒë·ªô ph·ªõt l·ªù t·∫°i th·ªùi ƒëi·ªÉm ƒë√≥).</em>`
            },
            {
                type: "gap",
                text: "8. While Mendel [gap] (revise) his lesson, his sister [gap] (read) fables.",
                options: ["revised|read", "was revising|was reading", "revised|was reading", "was revising|read"],
                answer: ["was revising", "was reading"],
                exp: `1. <strong>D·ªãch:</strong> Trong khi Mendel ƒëang √¥n b√†i, em g√°i c·∫≠u ·∫•y ƒëang ƒë·ªçc truy·ªán ng·ª• ng√¥n.<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> ƒê√¢y l√† 2 h√†nh ƒë·ªông x·∫£y ra <strong>song song c√πng m·ªôt l√∫c</strong> trong qu√° kh·ª©. C·∫£ 2 ƒë·ªÅu d√πng Qu√° kh·ª© ti·∫øp di·ªÖn -> "was revising" v√† "was reading".`
            },
            {
                type: "gap",
                text: "9. [gap] (Jane, practise) the piano when you [gap] (walk) into her room?",
                options: ["Did Jane practise|were walking", "Was Jane practising|walked", "Is Jane practising|walk", "Did Jane practise|walked"],
                answer: ["Was Jane practising", "walked"],
                exp: `1. <strong>D·ªãch:</strong> C√≥ ph·∫£i Jane ƒëang t·∫≠p piano khi b·∫°n b∆∞·ªõc v√†o ph√≤ng c√¥ ·∫•y kh√¥ng?<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> H√†nh ƒë·ªông n·ªÅn l√† Jane ƒëang t·∫≠p ƒë√†n -> "Was Jane practising". H√†nh ƒë·ªông chen ngang ƒë·ªôt ng·ªôt l√† b·∫°n b∆∞·ªõc v√†o -> Qu√° kh·ª© ƒë∆°n "walked".`
            },
            {
                type: "gap",
                text: "10. When I [gap] (knock) on the door, there [gap] (be) no answer.",
                options: ["knocked|was", "was knocking|was", "knocked|were", "was knocking|were"],
                answer: ["knocked", "was"],
                exp: `1. <strong>D·ªãch:</strong> Khi t√¥i g√µ c·ª≠a, kh√¥ng c√≥ ti·∫øng tr·∫£ l·ªùi.<br>
                      2. <strong>T·∫°i sao ch·ªçn:</strong> "knock" l√† h√†nh ƒë·ªông d·ª©t kho√°t, ng·∫Øn -> Qu√° kh·ª© ƒë∆°n "knocked". ƒê·ªông t·ª´ to-be ch·ªâ tr·∫°ng th√°i t·ªìn t·∫°i trong qu√° kh·ª© lu√¥n d√πng qu√° kh·ª© ƒë∆°n (kh√¥ng d√πng V-ing) -> "was" (v√¨ answer l√† s·ªë √≠t).`
            }
        ]
    },
    {
        section: "IV. Choose the best answer A, B, C or D.",
        questions: [
            {
                type: "mcq",
                q: "1. Hoa __________ for her mother.",
                options: ["A. rarely cooks", "B. cooks rarely", "C. rarely cook", "D. cook rarely"],
                answer: "A. rarely cooks",
                exp: `1. <strong>D·ªãch:</strong> Hoa hi·∫øm khi n·∫•u ƒÉn cho m·∫π c√¥ ·∫•y.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      A. rarely cooks: ƒë√∫ng v·ªã tr√≠ tr·∫°ng t·ª´ v√† chia ƒë·ªông t·ª´ chu·∫©n.<br>
                      B. cooks rarely: sai v·ªã tr√≠ tr·∫°ng t·ª´.<br>
                      C/D. rarely cook / cook rarely: sai v√¨ ch·ªß ng·ªØ Hoa (ng√¥i th·ª© 3 s·ªë √≠t) th√¨ ƒë·ªông t·ª´ ph·∫£i th√™m 's'.<br>
                      3. <strong>T·∫°i sao ch·ªçn A?</strong> Tr·∫°ng t·ª´ ch·ªâ t·∫ßn su·∫•t (rarely, always, often...) ph·∫£i ƒë·ª©ng <strong>TR∆Ø·ªöC</strong> ƒë·ªông t·ª´ th∆∞·ªùng (cook). V√¨ ch·ªß ng·ªØ l√† "Hoa" n√™n ƒë·ªông t·ª´ cook ph·∫£i th√™m "s" -> rarely cooks.`
            },
            {
                type: "mcq",
                q: "2. My cat __________ after a mouse at that time.",
                options: ["A. ran", "B. runs", "C. was running", "D. will run"],
                answer: "C. was running",
                exp: `1. <strong>D·ªãch:</strong> Con m√®o c·ªßa t√¥i ƒëang ƒëu·ªïi theo m·ªôt con chu·ªôt v√†o l√∫c ƒë√≥.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      A. ran: Qu√° kh·ª© ƒë∆°n.<br>
                      B. runs: Hi·ªán t·∫°i ƒë∆°n.<br>
                      C. was running: Qu√° kh·ª© ti·∫øp di·ªÖn.<br>
                      D. will run: T∆∞∆°ng lai ƒë∆°n.<br>
                      3. <strong>T·∫°i sao ch·ªçn C?</strong> D·∫•u hi·ªáu nh·∫≠n bi·∫øt: <strong>"at that time"</strong> (v√†o l√∫c ƒë√≥ trong qu√° kh·ª©) -> Ch·ªâ m·ªôt h√†nh ƒë·ªông ƒëang di·ªÖn ra t·∫°i m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong qu√° kh·ª© -> D√πng th√¨ Qu√° kh·ª© ti·∫øp di·ªÖn.`
            },
            {
                type: "mcq",
                q: "3. Nga was watching TV while her sister __________ the piano.",
                options: ["A. is playing", "B. was playing", "C. will play", "D. plays"],
                answer: "B. was playing",
                exp: `1. <strong>D·ªãch:</strong> Nga ƒëang xem TV trong khi ch·ªã c√¥ ·∫•y ƒëang ch∆°i piano.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      A, C, D sai th√¨ (ƒëang ·ªü qu√° kh·ª© m√† l·∫°i d√πng hi·ªán t·∫°i/t∆∞∆°ng lai).<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> T·ª´ n·ªëi "while" di·ªÖn t·∫£ 2 h√†nh ƒë·ªông x·∫£y ra <strong>song song c√πng m·ªôt l√∫c</strong> trong qu√° kh·ª©. V·∫ø tr∆∞·ªõc ƒë√£ d√πng "was watching" (Qu√° kh·ª© ti·∫øp di·ªÖn), n√™n v·∫ø sau c≈©ng d√πng "was playing".`
            },
            {
                type: "mcq",
                q: "4. __________ borrow books from the school library?",
                options: ["A. Do you often", "B. Do often you", "C. Will often you", "D. Will you often"],
                answer: "A. Do you often",
                exp: `1. <strong>D·ªãch:</strong> B·∫°n c√≥ th∆∞·ªùng m∆∞·ª£n s√°ch t·ª´ th∆∞ vi·ªán tr∆∞·ªùng kh√¥ng?<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      H·ªèi v·ªÅ m·ªôt th√≥i quen ·ªü hi·ªán t·∫°i -> D√πng th√¨ Hi·ªán t·∫°i ƒë∆°n.<br>
                      3. <strong>T·∫°i sao ch·ªçn A?</strong> C·∫•u tr√∫c c√¢u h·ªèi Hi·ªán t·∫°i ƒë∆°n: <strong>Do/Does + S + Tr·∫°ng t·ª´ t·∫ßn su·∫•t + V(nguy√™n th·ªÉ)?</strong> -> Do you often borrow...?<br>
                      4. <strong>T·∫°i sao sai?</strong> B, C sai tr·∫≠t t·ª± t·ª´. D d√πng th√¨ t∆∞∆°ng lai kh√¥ng h·ª£p l√Ω ƒë·ªÉ h·ªèi th√≥i quen.`
            },
            {
                type: "mcq",
                q: "5. The flight to London __________ off in five minutes.",
                options: ["A. will take", "B. takes", "C. took", "D. was taking"],
                answer: "B. takes",
                exp: `1. <strong>D·ªãch:</strong> Chuy·∫øn bay t·ªõi London s·∫Ω c·∫•t c√°nh trong 5 ph√∫t n·ªØa.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      A. will take: T∆∞∆°ng lai (c√≥ th·ªÉ d√πng nh∆∞ng ch∆∞a ch√≠nh x√°c nh·∫•t).<br>
                      B. takes: Hi·ªán t·∫°i ƒë∆°n.<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> ƒê·ªëi v·ªõi <strong>l·ªãch tr√¨nh t√†u xe, m√°y bay</strong>, d√π s·ª± vi·ªác x·∫£y ra trong t∆∞∆°ng lai (in five minutes) ta v·∫´n s·ª≠ d·ª•ng th√¨ <strong>Hi·ªán t·∫°i ƒë∆°n (Present Simple)</strong> ƒë·ªÉ di·ªÖn ƒë·∫°t l·ªãch tr√¨nh c·ªë ƒë·ªãnh. Do ƒë√≥ d√πng "takes".`
            },
            {
                type: "mcq",
                q: "6. __________ kites in the park at 5 o‚Äôclock yesterday afternoon?",
                options: ["A. Were you flying", "B. Are you flying", "C. Did you fly", "D. Will you fly"],
                answer: "A. Were you flying",
                exp: `1. <strong>D·ªãch:</strong> B·∫°n c√≥ ƒëang th·∫£ di·ªÅu trong c√¥ng vi√™n v√†o l√∫c 5 gi·ªù chi·ªÅu h√¥m qua kh√¥ng?<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      D·∫•u hi·ªáu th·ªùi gian: <strong>"at 5 o'clock yesterday afternoon"</strong> (m·ªôt th·ªùi ƒëi·ªÉm ch√≠nh x√°c, c·ª• th·ªÉ trong qu√° kh·ª©).<br>
                      3. <strong>T·∫°i sao ch·ªçn A?</strong> H√†nh ƒë·ªông ƒëang di·ªÖn ra t·∫°i m·ªôt th·ªùi ƒëi·ªÉm x√°c ƒë·ªãnh trong qu√° kh·ª© ph·∫£i d√πng th√¨ Qu√° kh·ª© ti·∫øp di·ªÖn -> Were you flying.<br>
                      4. <strong>T·∫°i sao sai?</strong> C (Did you fly) l√† qu√° kh·ª© ƒë∆°n, ch·ªâ d√πng khi n√≥i chung chung "h√¥m qua" (yesterday), kh√¥ng c√≥ m·ªëc gi·ªù c·ª• th·ªÉ.`
            },
            {
                type: "mcq",
                q: "7. The summer sales __________ next Saturday.",
                options: ["A. started", "B. will start", "C. start", "D. starts"],
                answer: "C. start",
                exp: `1. <strong>D·ªãch:</strong> ƒê·ª£t gi·∫£m gi√° m√πa h√® b·∫Øt ƒë·∫ßu v√†o th·ª© B·∫£y t·ªõi.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      "next Saturday" (th·ª© 7 t·ªõi) -> T∆∞∆°ng lai.<br>
                      3. <strong>T·∫°i sao ch·ªçn C?</strong> T∆∞∆°ng t·ª± c√¢u 5, s·ª± ki·ªán khai tr∆∞∆°ng/khuy·∫øn m√£i ƒë√£ ƒë∆∞·ª£c <strong>l√™n l·ªãch tr√¨nh s·∫µn c·ªë ƒë·ªãnh (timetable/schedule)</strong>, ta d√πng th√¨ <strong>Hi·ªán t·∫°i ƒë∆°n</strong> ƒë·ªÉ di·ªÖn ƒë·∫°t. V√¨ "sales" l√† s·ªë nhi·ªÅu -> ƒë·ªông t·ª´ gi·ªØ nguy√™n "start".<br>
                      4. <strong>T·∫°i sao sai?</strong> D (starts) sai v√¨ chia s·ªë √≠t. B (will start) kh√¥ng sai ho√†n to√†n nh∆∞ng trong vƒÉn ph·∫°m ti·∫øng Anh chu·∫©n th√¨ l·ªãch tr√¨nh chu·ªông hi·ªán t·∫°i ƒë∆°n h∆°n.`
            },
            {
                type: "mcq",
                q: "8. There __________ only a few houses left standing after the tornado hit.",
                options: ["A. was", "B. is", "C. were", "D. be"],
                answer: "C. were",
                exp: `1. <strong>D·ªãch:</strong> Ch·ªâ c√≤n l·∫°i v√†i ng√¥i nh√† ƒë·ª©ng v·ªØng sau khi c∆°n l·ªëc xo√°y t√†n ph√°.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      "after the tornado hit" (sau khi l·ªëc xo√°y t√†n ph√°) -> S·ª± vi·ªác trong qu√° kh·ª© -> D√πng to be ·ªü Qu√° kh·ª©.<br>
                      3. <strong>T·∫°i sao ch·ªçn C?</strong> C·∫•u tr√∫c There + to-be ph·ª• thu·ªôc v√†o danh t·ª´ ƒë·ª©ng sau. "a few houses" (m·ªôt v√†i ng√¥i nh√†) l√† <strong>danh t·ª´ s·ªë nhi·ªÅu</strong>. Do ƒë√≥ to be qu√° kh·ª© s·ªë nhi·ªÅu l√† <strong>"were"</strong>.`
            },
            {
                type: "mcq",
                q: "9. I __________ how to use the computer until my father taught me.",
                options: ["A. don‚Äôt know", "B. didn't know", "C. know", "D. won‚Äôt know"],
                answer: "B. didn't know",
                exp: `1. <strong>D·ªãch:</strong> T√¥i ƒë√£ kh√¥ng bi·∫øt c√°ch s·ª≠ d·ª•ng m√°y t√≠nh cho ƒë·∫øn khi b·ªë d·∫°y t√¥i.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      V·∫ø sau: "until my father <strong>taught</strong> me" (taught l√† V2 c·ªßa teach - Qu√° kh·ª©).<br>
                      3. <strong>T·∫°i sao ch·ªçn B?</strong> V√¨ s·ª± vi·ªác x·∫£y ra trong qu√° kh·ª©, n√™n ƒë·ªông t·ª´ ·ªü v·∫ø tr∆∞·ªõc c≈©ng ph·∫£i l√πi v·ªÅ Qu√° kh·ª© ƒë∆°n (ph·ªß ƒë·ªãnh) -> didn't know.<br>
                      4. <strong>T·∫°i sao sai?</strong> A, C, D l√† c√°c th√¨ Hi·ªán t·∫°i / T∆∞∆°ng lai, sai s·ª± h√≤a h·ª£p v·ªÅ th√¨ (Sequence of Tenses).`
            },
            {
                type: "mcq",
                q: "10. Listen to the announcement. The train __________ till 12:00.",
                options: ["A. leaves", "B. left", "C. won‚Äôt leave", "D. doesn‚Äôt leave"],
                answer: "D. doesn‚Äôt leave",
                exp: `1. <strong>D·ªãch:</strong> H√£y nghe th√¥ng b√°o k√¨a. Chuy·∫øn t√†u s·∫Ω kh√¥ng r·ªùi ƒëi cho ƒë·∫øn t·∫≠n 12:00.<br>
                      2. <strong>Ph√¢n t√≠ch:</strong><br>
                      "The train... till 12:00" -> L·ªãch tr√¨nh t√†u ch·∫°y.<br>
                      3. <strong>T·∫°i sao ch·ªçn D?</strong> L·ªãch tr√¨nh t√†u xe lu√¥n s·ª≠ d·ª•ng th√¨ <strong>Hi·ªán t·∫°i ƒë∆°n</strong> ƒë·ªÉ ch·ªâ t∆∞∆°ng lai. Th·ªÉ ph·ªß ƒë·ªãnh c·ªßa The train (s·ªë √≠t) ·ªü hi·ªán t·∫°i ƒë∆°n l√† <strong>doesn't leave</strong>.<br>
                      4. <strong>T·∫°i sao sai?</strong> C (won't leave) l√† t∆∞∆°ng lai ƒë∆°n, kh√¥ng d√πng cho l·ªãch tr√¨nh c·ªë ƒë·ªãnh c·ªßa ph∆∞∆°ng ti·ªán giao th√¥ng.`
            }
        ]
    },
    {
        section: "VIII. Reorder the words and phrases to make complete sentences.",
        questions: [
            {
                type: "reorder",
                words: "example / A / a / is / an / marine ecosystem / of / coral reef /.",
                answer: "A coral reef is an example of a marine ecosystem.",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> R·∫°n san h√¥ l√† m·ªôt v√≠ d·ª• v·ªÅ h·ªá sinh th√°i bi·ªÉn.<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´ v·ª±ng/ng·ªØ ph√°p:</strong><br>
                      - "A coral reef": R·∫°n san h√¥ (Ch·ªß ng·ªØ).<br>
                      - "is an example of": l√† m·ªôt v√≠ d·ª• c·ªßa (C·ª•m c·∫•u tr√∫c c·ªë ƒë·ªãnh).<br>
                      - "a marine ecosystem": m·ªôt h·ªá sinh th√°i bi·ªÉn (T√¢n ng·ªØ).<br>
                      3. <strong>T·∫°i sao s·∫Øp x·∫øp v·∫≠y?</strong> Ch·ªß ng·ªØ (A coral reef) + ƒê·ªông t·ª´ to be (is) + C·ª•m danh t·ª´ b·ªï ng·ªØ (an example of a marine ecosystem). Nh·ªõ vi·∫øt hoa ch·ªØ A ƒë·∫ßu c√¢u.`
            },
            {
                type: "reorder",
                words: "species / The / is / endangered / sea turtle / an /.",
                answer: "The sea turtle is an endangered species.",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> R√πa bi·ªÉn l√† m·ªôt lo√†i ƒëang b·ªã ƒëe d·ªça (c√≥ nguy c∆° tuy·ªát ch·ªßng).<br>
                      2. <strong>Ph√¢n t√≠ch t·ª´ v·ª±ng/ng·ªØ ph√°p:</strong><br>
                      - "The sea turtle": R√πa bi·ªÉn (Ch·ªß ng·ªØ ƒë·∫°i di·ªán cho c·∫£ lo√†i).<br>
                      - "an endangered species": m·ªôt lo√†i c√≥ nguy c∆° tuy·ªát ch·ªßng.<br>
                      3. <strong>C·∫•u tr√∫c:</strong> S + is + N. T√≠nh t·ª´ 'endangered' ƒë·ª©ng tr∆∞·ªõc danh t·ª´ 'species'. V√¨ 'endangered' b·∫Øt ƒë·∫ßu b·∫±ng nguy√™n √¢m 'e' n√™n ph·∫£i d√πng m·∫°o t·ª´ 'an'.`
            },
            {
                type: "reorder",
                words: "kind / of / What / disasters / are / talking / about, / they / or manmade / natural / ?",
                answer: "What kind of disasters are they talking about, natural or manmade?",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> H·ªç ƒëang n√≥i v·ªÅ lo·∫°i th·∫£m h·ªça n√†o, thi√™n nhi√™n hay nh√¢n t·∫°o?<br>
                      2. <strong>Ph√¢n t√≠ch c·∫•u tr√∫c:</strong><br>
                      - C·∫•u tr√∫c c√¢u h·ªèi: "What kind of + Danh t·ª´ s·ªë nhi·ªÅu" (Lo·∫°i ... n√†o?). -> What kind of disasters...<br>
                      - Hi·ªán t·∫°i ti·∫øp di·ªÖn: ...are they talking about...?<br>
                      - C·ª•m li·ªát k√™ l·ª±a ch·ªçn: natural or manmade (thi√™n nhi√™n hay nh√¢n t·∫°o).<br>
                      3. <strong>T·∫°i sao s·∫Øp x·∫øp v·∫≠y?</strong> B·∫Øt ƒë·∫ßu b·∫±ng t·ª´ ƒë·ªÉ h·ªèi (What), gh√©p c·ª•m t·ª´ h·ªèi (What kind of disasters), ƒë·∫£o to be (are) l√™n tr∆∞·ªõc ch·ªß ng·ªØ (they), ƒë·ªông t·ª´ (talking about), v√† cu·ªëi c√πng l√† c·ª•m li·ªát k√™.`
            },
            {
                type: "reorder",
                words: "watch / Can / bought / return / the / that / I / I / yesterday / your / shop / from?",
                answer: "Can I return the watch that I bought from your shop yesterday?",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> T√¥i c√≥ th·ªÉ tr·∫£ l·∫°i chi·∫øc ƒë·ªìng h·ªì m√† t√¥i ƒë√£ mua t·ª´ c·ª≠a h√†ng c·ªßa b·∫°n h√¥m qua kh√¥ng?<br>
                      2. <strong>Ph√¢n t√≠ch ng·ªØ ph√°p (M·ªánh ƒë·ªÅ quan h·ªá):</strong><br>
                      - C√¢u h·ªèi l·ªãch s·ª±: Can I return the watch...?<br>
                      - M·ªánh ƒë·ªÅ quan h·ªá b·ªï nghƒ©a cho 'the watch': "that I bought from your shop yesterday".<br>
                      3. <strong>L·ªói th∆∞·ªùng g·∫∑p:</strong> H·ªçc sinh hay nh·∫ßm ƒë·ªÉ 'yesterday' v√†o gi·ªØa c√¢u. Tr·∫°ng t·ª´ ch·ªâ th·ªùi gian (yesterday) th∆∞·ªùng ƒë·ª©ng cu·ªëi c√¢u.`
            },
            {
                type: "reorder",
                words: "sell / People / at / the / a lot of / open-air market / local specialities /.",
                answer: "People sell a lot of local specialities at the open-air market.",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> Ng∆∞·ªùi ta b√°n r·∫•t nhi·ªÅu ƒë·∫∑c s·∫£n ƒë·ªãa ph∆∞∆°ng ·ªü khu ch·ª£ ngo√†i tr·ªùi.<br>
                      2. <strong>Ph√¢n t√≠ch th√†nh ph·∫ßn c√¢u:</strong><br>
                      - Ch·ªß ng·ªØ: People (Ng∆∞·ªùi ta).<br>
                      - ƒê·ªông t·ª´: sell (b√°n).<br>
                      - T√¢n ng·ªØ (B√°n c√°i g√¨?): a lot of local specialities (nhi·ªÅu ƒë·∫∑c s·∫£n ƒë·ªãa ph∆∞∆°ng).<br>
                      - Tr·∫°ng ng·ªØ ch·ªâ n∆°i ch·ªën: at the open-air market (t·∫°i ch·ª£ ngo√†i tr·ªùi).<br>
                      3. <strong>C·∫•u tr√∫c:</strong> S + V + O + N∆°i ch·ªën.`
            },
            {
                type: "reorder",
                words: "participate / More and more / activities / people / Earth Day / in /.",
                answer: "More and more people participate in Earth Day activities.",
                exp: `1. <strong>D·ªãch c√¢u ho√†n ch·ªânh:</strong> Ng√†y c√†ng c√≥ nhi·ªÅu ng∆∞·ªùi tham gia v√†o c√°c ho·∫°t ƒë·ªông c·ªßa Ng√†y Tr√°i ƒê·∫•t.<br>
                      2. <strong>Ph√¢n t√≠ch c·ª•m t·ª´:</strong><br>
                      - C·ª•m so s√°nh k√©p: "More and more people" (Ng√†y c√†ng nhi·ªÅu ng∆∞·ªùi).<br>
                      - Collocation: "participate in" (tham gia v√†o).<br>
                      - C·ª•m danh t·ª´: "Earth Day activities" (c√°c ho·∫°t ƒë·ªông Ng√†y Tr√°i ƒê·∫•t).<br>
                      3. <strong>T·∫°i sao s·∫Øp x·∫øp v·∫≠y?</strong> Ch·ªß ng·ªØ (More and more people) + ƒê·ªông t·ª´ (participate in) + T√¢n ng·ªØ (Earth Day activities).`
            }
        ]
    }
];

// ==========================================
// RENDER & LOGIC ƒêI·ªÄU KHI·ªÇN
// ==========================================
let totalQuestions = 0;
let correctAnswers = 0;
let isAnswered = {}; // Tr·∫°ng th√°i l∆∞u c√¢u n√†o ƒë√£ l√†m
let currentGapTarget = null; // Qu·∫£n l√Ω gap ƒëang click

const container = document.getElementById('quiz-container');

// H√†m tr·ªôn m·∫£ng (Shuffle array)
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Kh·ªüi t·∫°o giao di·ªán
function initQuiz() {
    let qIndex = 0;
    quizData.forEach((sec, secIndex) => {
        // Render Section Title
        const secTitle = document.createElement('div');
        secTitle.className = 'section-title';
        secTitle.innerHTML = `<i class="fas fa-star" style="color:#FFD166;"></i> ${sec.section}`;
        container.appendChild(secTitle);

        sec.questions.forEach((q, qLocalIndex) => {
            qIndex++;
            totalQuestions++;
            isAnswered[qIndex] = false;

            const card = document.createElement('div');
            card.className = 'card';
            card.id = `card-${qIndex}`;

            // Render d·ª±a tr√™n Type (mcq, gap, reorder)
            if (q.type === 'mcq') {
                let optionsHtml = '';
                // Shuffle options
                const shuffledOpts = shuffleArray([...q.options]);
                shuffledOpts.forEach(opt => {
                    optionsHtml += `<button class="btn-option" onclick="checkMCQ('${opt}', '${q.answer}', ${qIndex}, this)">${opt}</button>`;
                });

                card.innerHTML = `
                    <div class="question-text">${q.q}</div>
                    <div class="options-grid" id="options-${qIndex}">${optionsHtml}</div>
                    <div class="explanation" id="exp-${qIndex}">
                        <h4><i class="fas fa-lightbulb"></i> GI·∫¢I TH√çCH CHI TI·∫æT</h4>
                        ${q.exp}
                    </div>
                `;
            } 
            else if (q.type === 'gap') {
                let renderedText = q.text;
                // N·∫øu l√† gap c√≥ nhi·ªÅu ch·ªó tr·ªëng (VD: past simple vs continuous)
                const gapsAnswer = Array.isArray(q.answer) ? q.answer : [q.answer];
                
                gapsAnswer.forEach((ans, idx) => {
                    const optsString = Array.isArray(q.options) ? q.options.join('|') : q.options;
                    // Build special data structure to pass to popup
                    renderedText = renderedText.replace('[gap]', `<span class="gap" data-qindex="${qIndex}" data-gapindex="${idx}" data-answer="${ans}" data-options="${optsString}" onclick="openGapModal(this)">___</span>`);
                });

                card.innerHTML = `
                    <div class="question-text">${renderedText}</div>
                    <div class="explanation" id="exp-${qIndex}">
                        <h4><i class="fas fa-lightbulb"></i> GI·∫¢I TH√çCH CHI TI·∫æT</h4>
                        ${q.exp}
                    </div>
                `;
            }
            else if (q.type === 'reorder') {
                const words = shuffleArray(q.words.split(' / ').filter(w => w !== '.' && w !== '?' && w !== ''));
                let chipsHtml = '';
                words.forEach((w, wIdx) => {
                    chipsHtml += `<div class="chip" onclick="moveChip(this, 'bank-${qIndex}', 'answer-${qIndex}')">${w}</div>`;
                });

                // X·ª≠ l√Ω d·∫•u c√¢u cu·ªëi (n·∫øu c√≥)
                const endMark = q.words.includes('?') ? '?' : '.';

                card.innerHTML = `
                    <div class="question-text"><i class="fas fa-sort-amount-down-alt" style="color:var(--primary)"></i> S·∫Øp x·∫øp l·∫°i c√¢u (B·∫•m v√†o t·ª´ ƒë·ªÉ di chuy·ªÉn):</div>
                    <div class="chip-container" id="bank-${qIndex}">${chipsHtml}</div>
                    <div class="question-text">C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</div>
                    <div class="chip-container" id="answer-${qIndex}" style="background:#fff; border-color:var(--primary);"></div>
                    <button class="check-order-btn" onclick="checkReorder(${qIndex}, '${q.answer.replace(/'/g, "\\'")}', '${endMark}')"><i class="fas fa-check-circle"></i> Ki·ªÉm tra</button>
                    <div class="explanation" id="exp-${qIndex}">
                        <h4><i class="fas fa-lightbulb"></i> GI·∫¢I TH√çCH CHI TI·∫æT</h4>
                        ${q.exp}
                    </div>
                `;
            }
            container.appendChild(card);
        });
    });
}

// Play Sound function
function playSound(type) {
    try {
        const audio = document.getElementById(`sound-${type}`);
        audio.currentTime = 0;
        audio.play();
    } catch(e) {}
}

// Trigger Confetti
function shootConfetti() {
    confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#8854C0', '#00C9A7', '#FFD166']
    });
}

// Ki·ªÉm tra Multiple Choice
function checkMCQ(selected, correct, qIndex, btnEl) {
    if (isAnswered[qIndex]) return;
    isAnswered[qIndex] = true;

    const optionsDiv = document.getElementById(`options-${qIndex}`);
    const buttons = optionsDiv.getElementsByTagName('button');

    for (let btn of buttons) {
        btn.disabled = true;
        if (btn.innerText === correct) {
            btn.classList.add('correct');
        } else if (btn === btnEl && selected !== correct) {
            btn.classList.add('wrong');
        }
    }

    if (selected === correct) {
        correctAnswers++;
        playSound('correct');
        shootConfetti();
    } else {
        playSound('wrong');
    }

    // Hi·ªÉn th·ªã gi·∫£i th√≠ch
    document.getElementById(`exp-${qIndex}`).style.display = 'block';
}

// Logic cho Gap Fill
function openGapModal(gapEl) {
    if (gapEl.classList.contains('filled-correct') || gapEl.classList.contains('filled-wrong')) return; // ƒê√£ ƒëi·ªÅn xong
    
    currentGapTarget = gapEl;
    const optionsRaw = gapEl.getAttribute('data-options').split('|');
    
    // N·∫øu option c√≥ d·∫°ng "Were you swimming|stole", ta ph·∫£i c·∫Øt ra t√πy v√†o v·ªã tr√≠ gap
    const gapIndex = parseInt(gapEl.getAttribute('data-gapindex') || 0);
    
    const container = document.getElementById('gapOptionsContainer');
    container.innerHTML = '';

    // X·ª≠ l√Ω options: Tr·ªôn m·∫£ng ƒë·ªÉ t·∫°o s·ª± b·∫•t ng·ªù
    const finalOptions = [];
    optionsRaw.forEach(optString => {
        const parts = optString.split('|');
        if (parts.length > 1) {
            finalOptions.push(parts[gapIndex]);
        } else {
            finalOptions.push(optString);
        }
    });

    // L·ªçc tr√πng v√† tr·ªôn
    const uniqueOptions = shuffleArray([...new Set(finalOptions)]);

    uniqueOptions.forEach(opt => {
        container.innerHTML += `<button class="modal-btn" onclick="selectGapOption('${opt.replace(/'/g, "\\'")}')">${opt}</button>`;
    });

    document.getElementById('gapModal').style.display = 'flex';
}

function closeGapModal() {
    document.getElementById('gapModal').style.display = 'none';
    currentGapTarget = null;
}

function selectGapOption(selectedText) {
    if(!currentGapTarget) return;

    const correctText = currentGapTarget.getAttribute('data-answer');
    const qIndex = currentGapTarget.getAttribute('data-qindex');
    currentGapTarget.innerText = selectedText;

    if (selectedText === correctText) {
        currentGapTarget.classList.add('filled-correct');
        playSound('correct');
    } else {
        currentGapTarget.classList.add('filled-wrong');
        playSound('wrong');
    }

    closeGapModal();

    // Ki·ªÉm tra xem t·∫•t c·∫£ c√°c gap c·ªßa c√¢u h·ªèi n√†y ƒë√£ ƒë∆∞·ª£c ƒëi·ªÅn ch∆∞a
    checkAllGaps(qIndex);
}

function checkAllGaps(qIndex) {
    const card = document.getElementById(`card-${qIndex}`);
    const gaps = card.querySelectorAll('.gap');
    let allFilled = true;
    let allCorrect = true;

    gaps.forEach(g => {
        if (!g.classList.contains('filled-correct') && !g.classList.contains('filled-wrong')) {
            allFilled = false;
        }
        if (g.innerText !== g.getAttribute('data-answer')) {
            allCorrect = false;
        }
    });

    if (allFilled) {
        isAnswered[qIndex] = true;
        document.getElementById(`exp-${qIndex}`).style.display = 'block';
        if (allCorrect) {
            correctAnswers++;
            shootConfetti();
        }
    }
}

// Logic cho Reorder (S·∫Øp x·∫øp)
function moveChip(chipEl, fromId, toId) {
    const targetBox = document.getElementById(chipEl.parentElement.id === fromId ? toId : fromId);
    targetBox.appendChild(chipEl);
}

function checkReorder(qIndex, correctAnswer, endMark) {
    if (isAnswered[qIndex]) return;

    const answerBox = document.getElementById(`answer-${qIndex}`);
    const chips = answerBox.querySelectorAll('.chip');
    let userSentence = Array.from(chips).map(c => c.innerText).join(' ');
    
    // Th√™m d·∫•u c√¢u v√†o cu·ªëi n·∫øu c·∫ßn ƒë·ªÉ so kh·ªõp ch√≠nh x√°c
    if(userSentence.length > 0) userSentence += endMark;

    const isCorrect = (userSentence.toLowerCase().replace(/\s+/g, '') === correctAnswer.toLowerCase().replace(/\s+/g, ''));

    if (isCorrect) {
        playSound('correct');
        shootConfetti();
        correctAnswers++;
        answerBox.style.backgroundColor = 'var(--correct)';
        answerBox.style.color = 'white';
        // V√¥ hi·ªáu h√≥a click
        chips.forEach(c => c.style.pointerEvents = 'none');
    } else {
        playSound('wrong');
        answerBox.style.animation = 'none';
        setTimeout(() => answerBox.style.animation = 'shake 0.4s', 10);
        answerBox.style.backgroundColor = '#ffebe6';
        answerBox.style.borderColor = 'var(--wrong)';
    }

    isAnswered[qIndex] = true;
    document.getElementById(`exp-${qIndex}`).style.display = 'block';
}

// Submit Result
function showResults() {
    let msg = "";
    const percentage = (correctAnswers / totalQuestions) * 100;
    
    if (percentage === 100) msg = "Tuy·ªát ƒë·ªânh! B·∫°n l√† m·ªôt Master Ti·∫øng Anh th·ª±c th·ª•! üèÜ";
    else if (percentage >= 80) msg = "Qu√° gi·ªèi! C·ªë g·∫Øng ch√∫t x√≠u n·ªØa l√† ƒë·∫°t ƒëi·ªÉm tuy·ªát ƒë·ªëi r·ªìi! üåü";
    else if (percentage >= 50) msg = "L√†m t·ªët l·∫Øm! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ ti·∫øn b·ªô h∆°n nh√©! üëç";
    else msg = "ƒê·ª´ng n·∫£n ch√≠! H·ªçc ti·∫øng Anh l√† m·ªôt h√†nh tr√¨nh d√†i. Th·ª≠ l·∫°i nh√©! üí™";

    document.getElementById('finalScore').innerText = `${correctAnswers} / ${totalQuestions}`;
    document.getElementById('resultMessage').innerText = msg;
    document.getElementById('resultModal').style.display = 'flex';
    shootConfetti();
    setTimeout(shootConfetti, 500);
    setTimeout(shootConfetti, 1000);
}

// Initialize on load
window.onload = initQuiz;

</script>
</body>
</html>