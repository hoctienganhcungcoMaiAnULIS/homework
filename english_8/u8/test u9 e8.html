<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B√†i Ki·ªÉm Tra - Ms Mai An ULIS</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #8854C0; /* H·ªìng t√≠m pastel */
        --secondary: #00C9A7; /* Xanh ng·ªçc */
        --accent: #FF9F43; /* Cam n·ªïi */
        --correct: #00D26A; /* Xanh l√° */
        --wrong: #FF4757; /* ƒê·ªè cam */
        --bg: #F0F3F9;
        --card-bg: #FFFFFF;
        --text: #2D3436;
    }

    body {
        font-family: 'Nunito', sans-serif;
        background-color: var(--bg);
        background-image: radial-gradient(#dfe4ea 2px, transparent 2px);
        background-size: 20px 20px;
        color: var(--text);
        margin: 0;
        padding: 20px;
        line-height: 1.6;
    }

    .container {
        max-width: 900px;
        margin: 0 auto;
    }

    /* HEADER */
    header {
        text-align: center;
        background: white;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 8px 0 rgba(0,0,0,0.05);
        margin-bottom: 30px;
        border: 2px solid #fff;
    }

    h1 {
        color: var(--primary);
        font-weight: 800;
        margin: 0;
        font-size: 1.8rem;
        text-transform: uppercase;
    }

    .teacher-name {
        font-family: 'Quicksand', sans-serif;
        font-size: 1rem;
        color: #888;
        margin-top: 5px;
    }

    /* CARD STYLES */
    .card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 0 #E2E6EA;
        position: relative;
        border: 2px solid #F1F2F6;
        transition: transform 0.2s;
    }

    h2 {
        color: var(--secondary);
        border-bottom: 3px dashed #eee;
        padding-bottom: 10px;
        margin-top: 0;
    }

    /* READING PASSAGE */
    .reading-box {
        background: #FFF8E1;
        padding: 20px;
        border-radius: 15px;
        border-left: 5px solid var(--accent);
        font-size: 1.1rem;
        margin-bottom: 20px;
        line-height: 1.8;
    }

    /* GLOSSARY TABLE */
    .glossary-container {
        margin-top: 20px;
        border: 2px solid var(--primary);
        border-radius: 15px;
        overflow: hidden;
    }
    .glossary-header {
        background: var(--primary);
        color: white;
        padding: 10px 20px;
        font-weight: bold;
        text-align: center;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }
    th, td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    tr:last-child td { border-bottom: none; }
    th { color: var(--primary); background: #f8f0ff; }
    .word-type { color: #888; font-style: italic; font-size: 0.9em; }

    /* GAP FILL BUTTONS IN TEXT */
    .gap-btn {
        display: inline-block;
        min-width: 60px;
        padding: 2px 10px;
        margin: 0 4px;
        background: #eee;
        border: none;
        border-bottom: 3px solid #ccc;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: var(--primary);
        font-family: 'Nunito', sans-serif;
        font-size: 1rem;
        transition: all 0.2s;
    }
    .gap-btn:hover { transform: scale(1.1); background: #e0e0e0; }
    .gap-btn.correct { background: var(--correct); color: white; border-color: #00b85c; }
    .gap-btn.wrong { background: var(--wrong); color: white; border-color: #e04050; }

    /* MULTIPLE CHOICE BUTTONS */
    .options-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
    }
    @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

    .option-btn {
        background: white;
        border: 2px solid #eee;
        padding: 15px;
        border-radius: 15px;
        font-size: 1rem;
        font-weight: 700;
        color: var(--text);
        cursor: pointer;
        text-align: left;
        box-shadow: 0 5px 0 #ddd;
        transition: all 0.1s;
        font-family: 'Nunito', sans-serif;
    }
    .option-btn:hover { transform: scale(1.02); border-color: var(--secondary); }
    .option-btn:active { transform: translateY(4px); box-shadow: none; }
    
    .option-btn.correct { background: var(--correct); color: white; border-color: #00a854; box-shadow: 0 5px 0 #00a854; }
    .option-btn.wrong { background: var(--wrong); color: white; border-color: #d63031; box-shadow: 0 5px 0 #d63031; animation: shake 0.5s; }

    /* EXPLANATION BOX */
    .explanation {
        display: none;
        margin-top: 15px;
        background: #F0F3FF;
        border: 2px solid #D6E0FF;
        border-radius: 12px;
        padding: 20px;
        animation: slideDown 0.3s ease-out;
    }
    .exp-header { font-weight: 800; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .exp-step { margin-bottom: 8px; }
    .exp-label { color: var(--primary); font-weight: bold; text-decoration: underline; }

    /* MATCHING GAME UI */
    .matching-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9f9f9;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 12px;
        border: 1px solid #eee;
    }
    .def-text { width: 60%; font-weight: 600; }
    .match-select {
        width: 35%;
        padding: 10px;
        border-radius: 10px;
        border: 2px solid var(--secondary);
        font-family: 'Nunito', sans-serif;
        font-weight: bold;
        color: var(--text);
    }

    /* MODAL POPUP */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 25px;
        width: 90%;
        max-width: 400px;
        text-align: center;
        animation: popIn 0.3s;
        box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    }
    .modal-options { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
    .modal-opt-btn {
        padding: 15px;
        border: 2px solid #eee;
        border-radius: 12px;
        background: white;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
    }
    .modal-opt-btn:hover { background: var(--secondary); color: white; border-color: var(--secondary); }

    /* ANIMATIONS */
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-10px); }
        75% { transform: translateX(10px); }
    }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    /* CONFETTI CANVAS */
    #confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }

    .submit-btn {
        display: block;
        width: 100%;
        max-width: 300px;
        margin: 40px auto;
        padding: 15px;
        background: var(--primary);
        color: white;
        font-size: 1.2rem;
        font-weight: 800;
        border: none;
        border-radius: 50px;
        box-shadow: 0 8px 0 #6c429c;
        cursor: pointer;
        transition: 0.2s;
    }
    .submit-btn:hover { transform: scale(1.05); }
    .submit-btn:active { transform: translateY(5px); box-shadow: 0 3px 0 #6c429c; }

</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="container">
    <header>
        <h1>English Masterclass</h1>
        <div class="teacher-name">Designed by: Ms Mai An ULIS</div>
    </header>

    <div class="card">
        <h2>IX. Gap Fill: Hurricane Dorian</h2>
        <p><i>Choose the word or phrase which best fits each gap. Click on the numbered buttons to answer.</i></p>
        
        

        <div class="reading-box">
            Hurricane Dorian was the strongest hurricane on record to <button class="gap-btn" id="btn-1" onclick="openGapModal(1)">(1)</button> the Bahamas, and is regarded as the worst natural disaster in the country‚Äôs history. On 1 September 2019, Dorian hit the Abaco Islands with sustained winds <button class="gap-btn" id="btn-2" onclick="openGapModal(2)">(2)</button> 185 mph (295 km/h). It made landfall as a <button class="gap-btn" id="btn-3" onclick="openGapModal(3)">(3)</button> 5 hurricane on Elbow Cay, just east of Great Abaco Island, and went on to strike Grand Bahama at similar intensity, stalling just north of the territory with unrelenting winds for at least 24 hours. Damage in the Bahamas was catastrophic <button class="gap-btn" id="btn-4" onclick="openGapModal(4)">(4)</button> the prolonged and intense storm conditions, including heavy rainfall, high winds and storm surge with thousands of homes destroyed, 70,000 people <button class="gap-btn" id="btn-5" onclick="openGapModal(5)">(5)</button> homeless, and at least 58 deaths recorded. As of September 28, 600 people still remain missing. Dorian is <button class="gap-btn" id="btn-6" onclick="openGapModal(6)">(6)</button> the costliest disaster in Bahamian history, estimated to have left behind an exceptional $7 billion in property damage. <button class="gap-btn" id="btn-7" onclick="openGapModal(7)">(7)</button> its ravages through the Bahamas, Dorian proceeded along the coasts of the Southeastern United States and Atlantic Canada, leaving behind considerable damage and economic <button class="gap-btn" id="btn-8" onclick="openGapModal(8)">(8)</button> in those regions.
        </div>

        <div id="gap-explanations"></div>
    </div>

    <div class="card">
        <h2>X. Reading Comprehension: Tsunamis</h2>
        <p><i>Read the passage carefully and complete the tasks below.</i></p>

        

[Image of tsunami formation diagram]


        <div class="reading-box">
            Elephants on the coast of Thailand are acting strange. They stamp their feet and motion toward the hills. The sea draws back from the beaches. Fish flop in the mud. Suddenly, a huge wave appears. This is no ordinary wave. It is a tsunami!<br><br>
            Tsunami waves are larger and faster than normal surface waves. A tsunami wave can travel as fast as a jet plane and can be as tall as a ten-story building. For a tsunami to occur, there must be some kind of force that causes the ocean water to become displaced. Most tsunamis are caused by underwater earthquakes. However, volcanoes, landslides, large icebergs, and even meteorites are capable of causing one of these mighty waves. Tsunamis are extremely powerful. Because tsunami waves are so strong, they can kill people, damage property, and completely ruin an ecosystem in just one hour.<br><br>
            Scientists have no way of predicting when a tsunami will hit. However, if a powerful enough earthquake occurs, scientists can issue a warning or a watch. A warning means that a tsunami will very likely hit soon. A watch means that conditions are favourable for a tsunami. When people are notified about a watch or a warning, they have more time to prepare. It is best not to get caught unaware when a tsunami is on the way!
        </div>

        <div class="glossary-container">
            <div class="glossary-header">üìñ ACADEMIC GLOSSARY (T·ª´ v·ª±ng n√¢ng cao)</div>
            <table>
                <tr><th>Word</th><th>Type</th><th>Meaning</th></tr>
                <tr><td>Motion</td><td><span class="word-type">(v)</span></td><td>Ra hi·ªáu, di chuy·ªÉn v·ªÅ h∆∞·ªõng</td></tr>
                <tr><td>Displace</td><td><span class="word-type">(v)</span></td><td>D·ªùi ch·ªó, chuy·ªÉn d·ªãch (n∆∞·ªõc)</td></tr>
                <tr><td>Landslide</td><td><span class="word-type">(n)</span></td><td>S·∫°t l·ªü ƒë·∫•t</td></tr>
                <tr><td>Meteorite</td><td><span class="word-type">(n)</span></td><td>Thi√™n th·∫°ch</td></tr>
                <tr><td>Mighty</td><td><span class="word-type">(adj)</span></td><td>H√πng m·∫°nh, to l·ªõn</td></tr>
                <tr><td>Ecosystem</td><td><span class="word-type">(n)</span></td><td>H·ªá sinh th√°i</td></tr>
                <tr><td>Favourable</td><td><span class="word-type">(adj)</span></td><td>Thu·∫≠n l·ª£i (ƒëi·ªÅu ki·ªán)</td></tr>
                <tr><td>Issue</td><td><span class="word-type">(v)</span></td><td>Ph√°t h√†nh, ƒë∆∞a ra (c·∫£nh b√°o)</td></tr>
                <tr><td>Unaware</td><td><span class="word-type">(adj)</span></td><td>Kh√¥ng hay bi·∫øt, b·∫•t ng·ªù</td></tr>
                <tr><td>Draw back</td><td><span class="word-type">(phr.v)</span></td><td>R√∫t lui, r√∫t n∆∞·ªõc ra xa</td></tr>
            </table>
        </div>

        <h3 style="margin-top:40px; color:var(--primary);">A. Match the definitions with words from the text</h3>
        <p><i>Select the correct word found in the text for each definition.</i></p>
        
        <div id="matching-area">
            </div>
        <div id="matching-explanations"></div>

        <h3 style="margin-top:40px; color:var(--primary);">B. Multiple Choice Questions</h3>
        <div id="mcq-area">
            </div>
    </div>

    <button class="submit-btn" onclick="showFinalScore()">N·ªòP B√ÄI (SUBMIT)</button>
</div>

<div class="modal-overlay" id="gapModal">
    <div class="modal-content">
        <h3 id="modal-title">Question 1</h3>
        <div class="modal-options" id="modal-options-container">
            </div>
        <button style="margin-top:15px; background:none; border:none; color:#888; text-decoration:underline; cursor:pointer;" onclick="closeModal()">ƒê√≥ng (Close)</button>
    </div>
</div>

<script>
    // DATA CONFIGURATION
    const gapData = {
        1: {
            question: "strike / catch / occur / enter",
            options: {a: "strike", b: "catch", c: "occur", d: "enter"},
            key: "a",
            expl: `<b>D·ªãch:</b> B√£o Dorian l√† c∆°n b√£o m·∫°nh nh·∫•t ƒë∆∞·ª£c ghi nh·∫≠n t·ª´ng <u>t·∫•n c√¥ng</u> Bahamas.<br>
            <b>A. Strike (v):</b> T·∫•n c√¥ng/ƒë·ªï b·ªô (d√πng cho thi√™n tai)<br>
            <b>B. Catch (v):</b> B·∫Øt l·∫•y<br>
            <b>C. Occur (v):</b> X·∫£y ra<br>
            <b>D. Enter (v):</b> ƒêi v√†o<br>
            <b>T·∫°i sao ƒê√öNG:</b> Collocation <i>"Hurricane strikes [place]"</i> l√† c√°ch d√πng chu·∫©n ƒë·ªÉ ch·ªâ b√£o ƒë·ªï b·ªô v√†o ƒë√¢u.`
        },
        2: {
            question: "at / to / from / of",
            options: {a: "at", b: "to", c: "from", d: "of"},
            key: "d",
            expl: `<b>D·ªãch:</b> ...v·ªõi s·ª©c gi√≥ <u>c·ªßa/ƒë·∫°t m·ª©c</u> 185 mph.<br>
            <b>T·∫°i sao ƒê√öNG:</b> C·∫•u tr√∫c <i>"winds of [speed]"</i> (gi√≥ ƒë·∫°t v·∫≠n t·ªëc...).<br>
            <b>T·∫°i sao SAI:</b> Kh√¥ng d√πng <i>winds at</i> trong ng·ªØ c·∫£nh m√¥ t·∫£ v·∫≠n t·ªëc thu·ªôc t√≠nh c·ªßa gi√≥ ·ªü ƒë√¢y.`
        },
        3: {
            question: "magnitude / category / measure / extension",
            options: {a: "magnitude", b: "category", c: "measure", d: "extension"},
            key: "b",
            expl: `<b>D·ªãch:</b> N√≥ ƒë·ªï b·ªô nh∆∞ m·ªôt c∆°n b√£o <u>c·∫•p</u> 5.<br>
            <b>T·∫°i sao ƒê√öNG:</b> <i>Category 5 hurricane</i> l√† thu·∫≠t ng·ªØ chuy√™n ng√†nh (Thang Saffir-Simpson).<br>
            <b>A. Magnitude:</b> D√πng cho ƒë·ªông ƒë·∫•t (Richter).`
        },
        4: {
            question: "because / due to / although / despite",
            options: {a: "because", b: "due to", c: "although", d: "despite"},
            key: "b",
            expl: `<b>D·ªãch:</b> Thi·ªát h·∫°i th·∫£m kh·ªëc <u>do</u> c√°c ƒëi·ªÅu ki·ªán b√£o k√©o d√†i...<br>
            <b>T·∫°i sao ƒê√öNG:</b> <i>Due to + Noun Phrase</i> (the prolonged... conditions).<br>
            <b>A. Because:</b> Ph·∫£i c·ªông v·ªõi m·ªánh ƒë·ªÅ (S + V).`
        },
        5: {
            question: "left / made / found / stayed",
            options: {a: "left", b: "made", c: "found", d: "stayed"},
            key: "a",
            expl: `<b>D·ªãch:</b> ...v·ªõi 70,000 ng∆∞·ªùi <u>b·ªã b·ªè l·∫°i/l√¢m v√†o c·∫£nh</u> v√¥ gia c∆∞.<br>
            <b>T·∫°i sao ƒê√öNG:</b> C·∫•u tr√∫c <i>Leave + O + Adj</i> (ƒê·ªÉ l·∫°i ai ƒë√≥ trong t√¨nh tr·∫°ng n√†o).<br>
            <b>B. Made:</b> Make someone homeless c≈©ng ƒë√∫ng nh∆∞ng <i>left</i> mang nghƒ©a h·∫≠u qu·∫£ b·ªã ƒë·ªông sau c∆°n b√£o chu·∫©n h∆°n trong ng·ªØ c·∫£nh "disaster".`
        },
        6: {
            question: "by turns / by the way / by chance / by far",
            options: {a: "by turns", b: "by the way", c: "by chance", d: "by far"},
            key: "d",
            expl: `<b>D·ªãch:</b> Dorian <u>cho ƒë·∫øn nay/r√µ r√†ng</u> l√† th·∫£m h·ªça t·ªën k√©m nh·∫•t.<br>
            <b>T·∫°i sao ƒê√öNG:</b> <i>By far + Superlative (The costliest)</i>: D√πng ƒë·ªÉ nh·∫•n m·∫°nh so s√°nh nh·∫•t (nh·∫•t h∆°n h·∫≥n).`
        },
        7: {
            question: "When / While / After / Since",
            options: {a: "When", b: "While", c: "After", d: "Since"},
            key: "c",
            expl: `<b>D·ªãch:</b> <u>Sau</u> s·ª± t√†n ph√° qua Bahamas, Dorian ti·∫øp t·ª•c di chuy·ªÉn...<br>
            <b>T·∫°i sao ƒê√öNG:</b> Ch·ªâ tr√¨nh t·ª± th·ªùi gian (Sequence). T√†n ph√° xong r·ªìi m·ªõi ƒëi ti·∫øp.`
        },
        8: {
            question: "shortages / losses / changes / crisis",
            options: {a: "shortages", b: "losses", c: "changes", d: "crisis"},
            key: "b",
            expl: `<b>D·ªãch:</b> ...ƒë·ªÉ l·∫°i thi·ªát h·∫°i ƒë√°ng k·ªÉ v√† <u>t·ªïn th·∫•t</u> kinh t·∫ø.<br>
            <b>T·∫°i sao ƒê√öNG:</b> Collocation <i>"Economic losses"</i> (Thi·ªát h·∫°i/t·ªïn th·∫•t kinh t·∫ø).`
        }
    };

    const matchingData = [
        { def: "saying that something will happen before it happens", key: "predicting", expl: "Predicting (v): D·ª± ƒëo√°n." },
        { def: "move in a loose, heavy, and uncontrolled way", key: "flop", expl: "Flop (v): Qu·∫´y, ƒë·∫≠p (c√° m·∫Øc c·∫°n)." },
        { def: "not knowing or realizing that something is happening", key: "unaware", expl: "Unaware (adj): Kh√¥ng hay bi·∫øt." },
        { def: "very strong and powerful", key: "mighty", expl: "Mighty (adj): H√πng m·∫°nh, to l·ªõn (mighty waves)." },
        { def: "good for something and making it likely to be successful", key: "favourable", expl: "Favourable (adj): Thu·∫≠n l·ª£i (conditions are favourable)." },
        { def: "moved out of the usual or proper place", key: "displaced", expl: "Displaced (adj/v): B·ªã d·ªùi ch·ªó (n∆∞·ªõc bi·ªÉn)." },
        { def: "all the plants and living creatures in a particular area", key: "ecosystem", expl: "Ecosystem (n): H·ªá sinh th√°i." }
    ];
    
    const wordBank = ["predicting", "flop", "unaware", "mighty", "favourable", "displaced", "ecosystem", "motion", "warning"];

    const mcqData = [
        {
            q: "1. Why are the elephants acting strange?",
            options: {
                a: "They are not used to seeing fish.",
                b: "They dislike wading into the ocean.",
                c: "They can sense something out of the ordinary.",
                d: "They see the ocean drawing back from the beaches."
            },
            key: "c",
            expl: "<b>Ch·ªçn C.</b> D·∫´n ch·ª©ng: Voi d·∫≠m ch√¢n v√† h∆∞·ªõng v·ªÅ ph√≠a ƒë·ªìi (motion toward hills) tr∆∞·ªõc khi s√≥ng ƒë·∫øn -> Ch√∫ng c·∫£m nh·∫≠n ƒë∆∞·ª£c ƒëi·ªÅu b·∫•t th∆∞·ªùng.<br><b>D sai</b> v√¨ b√†i kh√¥ng n√≥i voi 'nh√¨n th·∫•y' bi·ªÉn r√∫t, m√† l√† bi·ªÉn r√∫t x·∫£y ra ƒë·ªìng th·ªùi."
        },
        {
            q: "2. What is this passage mostly about?",
            options: {
                a: "How to prepare for tsunamis.",
                b: "Scientists who predict tsunami waves.",
                c: "Similarities and differences between wave types.",
                d: "Causes and effects of tsunamis."
            },
            key: "d",
            expl: "<b>Ch·ªçn D.</b> B√†i vƒÉn n√≥i v·ªÅ ƒë·ªãnh nghƒ©a, nguy√™n nh√¢n (causes: earthquake, volcano...) v√† h·∫≠u qu·∫£ (effects: kill people, ruin ecosystem) c·ªßa s√≥ng th·∫ßn."
        },
        {
            q: "3. Which does not cause a tsunami?",
            options: {
                a: "earthquakes",
                b: "mudslides",
                c: "volcanic eruptions",
                d: "meteorites"
            },
            key: "b",
            expl: "<b>Ch·ªçn B.</b> B√†i li·ªát k√™: <i>underwater earthquakes, volcanoes, landslides, large icebergs, and even meteorites</i>. <br>L∆∞u √Ω: <b>Landslide</b> (s·∫°t l·ªü ƒë·∫•t) kh√°c v·ªõi <b>Mudslide</b> (l≈© b√πn). D√π g·∫ßn gi·ªëng nhau nh∆∞ng b√†i thi y√™u c·∫ßu chi ti·∫øt ch√≠nh x√°c t·ª´ b√†i ƒë·ªçc, b√†i ƒë·ªçc kh√¥ng nh·∫Øc ƒë·∫øn 'mudslides'."
        },
        {
            q: "4. Tsunamis cause so much destruction because they ________.",
            options: {
                a: "can be predicted by scientists",
                b: "break on the coast, unlike normal waves",
                c: "are caused by volcanoes, landslides and meteorites",
                d: "can be as tall as a ten-story building"
            },
            key: "d",
            expl: "<b>Ch·ªçn D.</b> D·∫´n ch·ª©ng: <i>'Because tsunami waves are so strong... A tsunami wave... can be as tall as a ten-story building.'</i> S·ª©c m·∫°nh h·ªßy di·ªát ƒë·∫øn t·ª´ k√≠ch th∆∞·ªõc kh·ªïng l·ªì v√† t·ªëc ƒë·ªô."
        },
        {
            q: "5. We can conclude from the last paragraph that ________.",
            options: {
                a: "a tsunami warning is more serious than a watch",
                b: "a tsunami watch is more serious than a warning",
                c: "a tsunami warning and watch are equally serious",
                d: "a tsunami warning and watch both mean a tsunami has formed"
            },
            key: "a",
            expl: "<b>Ch·ªçn A.</b> <br>Warning (C·∫£nh b√°o) = 'tsunami will very likely hit soon' (S·∫Øp ·∫≠p ƒë·∫øn).<br>Watch (Theo d√µi) = 'conditions are favourable' (ƒêi·ªÅu ki·ªán thu·∫≠n l·ª£i ƒë·ªÉ h√¨nh th√†nh).<br>-> Warning nghi√™m tr·ªçng v√† kh·∫©n c·∫•p h∆°n Watch."
        }
    ];

    // INITIALIZATION
    document.addEventListener('DOMContentLoaded', () => {
        renderMatching();
        renderMCQ();
    });

    let currentGapId = null;

    // --- GAP FILL LOGIC ---
    function openGapModal(id) {
        currentGapId = id;
        const modal = document.getElementById('gapModal');
        const optionsDiv = document.getElementById('modal-options-container');
        document.getElementById('modal-title').innerText = `Question ${id}: Choose the best answer`;
        
        optionsDiv.innerHTML = '';
        const opts = gapData[id].options;
        for (let key in opts) {
            const btn = document.createElement('button');
            btn.className = 'modal-opt-btn';
            btn.innerHTML = `<b>${key.toUpperCase()}.</b> ${opts[key]}`;
            btn.onclick = () => checkGap(id, key);
            optionsDiv.appendChild(btn);
        }
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('gapModal').style.display = 'none';
    }

    function checkGap(id, selectedKey) {
        closeModal();
        const correctKey = gapData[id].key;
        const btn = document.getElementById(`btn-${id}`);
        const container = document.getElementById('gap-explanations');
        
        // Remove old explanation for this ID if exists
        const oldExp = document.getElementById(`exp-gap-${id}`);
        if(oldExp) oldExp.remove();

        const expDiv = document.createElement('div');
        expDiv.id = `exp-gap-${id}`;
        expDiv.className = 'explanation';
        expDiv.style.display = 'block';

        if (selectedKey === correctKey) {
            btn.className = 'gap-btn correct';
            btn.innerText = `(${id}) ${gapData[id].options[selectedKey]}`;
            playSound(true);
            fireConfetti();
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--correct)">‚úÖ CORRECT!</div>` + gapData[id].expl;
        } else {
            btn.className = 'gap-btn wrong';
            btn.innerText = `(${id}) ${gapData[id].options[selectedKey]}`;
            playSound(false);
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--wrong)">‚ùå OH NO! (ƒê√°p √°n ƒë√∫ng: ${gapData[id].options[correctKey]})</div>` + gapData[id].expl;
        }
        
        // Insert explanation after text box or append to container
        container.prepend(expDiv);
    }

    // --- MATCHING LOGIC ---
    function renderMatching() {
        const container = document.getElementById('matching-area');
        matchingData.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'matching-row';
            
            // Create options HTML
            let optionsHtml = `<option value="">-- Choose word --</option>`;
            wordBank.forEach(w => {
                optionsHtml += `<option value="${w}">${w}</option>`;
            });

            row.innerHTML = `
                <div class="def-text">${index + 1}. ${item.def}</div>
                <select class="match-select" id="match-${index}" onchange="checkMatch(${index}, this.value)">
                    ${optionsHtml}
                </select>
            `;
            container.appendChild(row);
        });
    }

    function checkMatch(index, value) {
        if(!value) return;
        const item = matchingData[index];
        const select = document.getElementById(`match-${index}`);
        const expContainer = document.getElementById('matching-explanations');
        
        // Clear specific old explanation
        const oldExp = document.getElementById(`exp-match-${index}`);
        if(oldExp) oldExp.remove();

        const expDiv = document.createElement('div');
        expDiv.id = `exp-match-${index}`;
        expDiv.className = 'explanation';
        expDiv.style.display = 'block';

        if (value === item.key) {
            select.style.borderColor = 'var(--correct)';
            select.style.background = '#e6fffa';
            select.disabled = true;
            playSound(true);
            fireConfetti();
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--correct)">‚úÖ Ch√≠nh x√°c!</div>${item.expl}`;
        } else {
            select.style.borderColor = 'var(--wrong)';
            select.style.background = '#fff0f0';
            playSound(false);
            // Reset value after short delay
            setTimeout(() => { select.value = ""; select.style.borderColor = "var(--secondary)"; select.style.background = "white"; }, 1000);
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--wrong)">‚ùå Sai r·ªìi! Th·ª≠ l·∫°i nh√©.</div>`;
        }
        expContainer.prepend(expDiv);
    }

    // --- MCQ LOGIC ---
    function renderMCQ() {
        const container = document.getElementById('mcq-area');
        mcqData.forEach((item, index) => {
            const qBlock = document.createElement('div');
            qBlock.style.marginBottom = "30px";
            qBlock.style.borderBottom = "1px solid #eee";
            qBlock.style.paddingBottom = "20px";

            qBlock.innerHTML = `
                <p style="font-weight:700; font-size:1.1rem;">${item.q}</p>
                <div class="options-grid">
                    <button class="option-btn" onclick="checkMCQ(this, 'a', ${index})">A. ${item.options.a}</button>
                    <button class="option-btn" onclick="checkMCQ(this, 'b', ${index})">B. ${item.options.b}</button>
                    <button class="option-btn" onclick="checkMCQ(this, 'c', ${index})">C. ${item.options.c}</button>
                    <button class="option-btn" onclick="checkMCQ(this, 'd', ${index})">D. ${item.options.d}</button>
                </div>
                <div id="exp-mcq-${index}" class="explanation"></div>
            `;
            container.appendChild(qBlock);
        });
    }

    function checkMCQ(btn, choice, index) {
        const item = mcqData[index];
        const expDiv = document.getElementById(`exp-mcq-${index}`);
        const allBtns = btn.parentElement.querySelectorAll('.option-btn');
        
        // Reset styles
        allBtns.forEach(b => b.classList.remove('correct', 'wrong'));
        
        expDiv.style.display = 'block';

        if (choice === item.key) {
            btn.classList.add('correct');
            playSound(true);
            fireConfetti();
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--correct)">‚úÖ Xu·∫•t s·∫Øc!</div>${item.expl}`;
        } else {
            btn.classList.add('wrong');
            playSound(false);
            expDiv.innerHTML = `<div class="exp-header" style="color:var(--wrong)">‚ùå Ti·∫øc qu√°!</div>${item.expl}`;
        }
    }

    // --- SOUND & EFFECTS ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(isCorrect) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (isCorrect) {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // CONFETTI
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];

    function fireConfetti() {
        for(let i=0; i<60; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random()*360}, 100%, 50%)`,
                size: Math.random() * 8 + 4,
                speed: Math.random() * 5 + 3,
                angle: Math.random() * 6
            });
        }
        animateConfetti();
    }

    function animateConfetti() {
        ctx.clearRect(0,0, canvas.width, canvas.height);
        particles.forEach((p, i) => {
            p.y += p.speed;
            p.x += Math.sin(p.angle);
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if(p.y > canvas.height) particles.splice(i, 1);
        });
        if(particles.length > 0) requestAnimationFrame(animateConfetti);
    }

    function showFinalScore() {
        const totalCorrect = document.querySelectorAll('.correct').length; // Counts gaps + mcq + matches
        // Note: Matching "correct" is style-based in select, might need adjustment logic or simple alert.
        // For simplicity in single file, we count elements with class 'correct' (MCQ, Gaps) + disabled selects (Matches).
        
        const matchedCorrect = document.querySelectorAll('.match-select[disabled]').length;
        const totalScore = document.querySelectorAll('.gap-btn.correct').length + document.querySelectorAll('.option-btn.correct').length + matchedCorrect;
        
        const totalQuestions = 8 + 7 + 5; // 8 gaps, 7 matches, 5 mcq = 20
        
        let msg = "";
        if(totalScore === totalQuestions) msg = "PERFECT! C√¥ Mai An t·ª± h√†o v·ªÅ em! üåü";
        else if(totalScore > 15) msg = "R·∫•t t·ªët! Em s·∫Øp ƒë·∫°t ƒëi·ªÉm t·ªëi ƒëa r·ªìi! üí™";
        else msg = "C·ªë g·∫Øng l√™n! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üìö";

        alert(`T·ªîNG K·∫æT:\nS·ªë c√¢u ƒë√∫ng: ${totalScore} / ${totalQuestions}\n${msg}`);
    }

</script>
</body>
</html>