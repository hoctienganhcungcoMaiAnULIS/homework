<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Phonetics Challenge - Ms Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-pastel: #F3F0FF;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-pastel);
            background-image: radial-gradient(#8854C0 1.5px, transparent 1.5px), radial-gradient(#8854C0 1.5px, #F3F0FF 1.5px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            color: #4b5563;
        }

        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* 3D Button Styles */
        .btn-3d {
            transition: all 0.1s;
            border-bottom: 5px solid rgba(0, 0, 0, 0.15);
            transform: translateY(0);
        }

        .btn-3d:active {
            transform: translateY(3px);
            border-bottom: 2px solid rgba(0, 0, 0, 0.15);
        }

        .btn-option {
            background-color: white;
            border: 2px solid #E5E7EB;
            border-bottom: 5px solid #E5E7EB;
            color: #374151;
            transition: all 0.2s;
        }

        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-purple);
            color: var(--primary-purple);
            background-color: #F3E8FF;
        }

        .btn-option.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00A855;
            border-bottom-color: #008542;
        }

        .btn-option.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #D63031;
            border-bottom-color: #B82526;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px) rotate(-2deg); }
            75% { transform: translateX(8px) rotate(2deg); }
        }

        .shake-element {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .explanation-box {
            animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #C4B5FD;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #8854C0;
        }

        u {
            text-decoration: none;
            border-bottom: 3px solid var(--primary-purple);
            padding-bottom: 1px;
            font-weight: 800;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50 border-b-4 border-purple-200">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-2xl border-2 border-purple-500 text-purple-600">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800 leading-tight">Ms Mai An ULIS</h1>
                    <p class="text-xs text-purple-600 font-bold tracking-wider uppercase">English Phonetics Quiz</p>
                </div>
            </div>
            <div class="bg-teal-100 px-4 py-2 rounded-2xl border-2 border-teal-400 text-teal-700 font-bold flex items-center gap-2">
                <i class="fa-solid fa-star text-yellow-500"></i>
                <span id="score-display">0</span> / <span id="total-display">0</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="quiz-container" class="max-w-3xl mx-auto px-4 py-8 space-y-8">
        <!-- Questions will be injected here by JS -->
    </main>

    <!-- Floating Submit Button -->
    <div class="fixed bottom-6 right-6 z-40">
        <button onclick="finishQuiz()" class="btn-3d bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl flex items-center gap-3 text-lg animate-bounce">
            <i class="fa-solid fa-flag-checkered"></i>
            N·ªòP B√ÄI & XEM ƒêI·ªÇM
        </button>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full text-center card-shadow border-4 border-purple-200 transform scale-95 transition-transform duration-300">
            <div class="mb-6">
                <img src="https://cdn-icons-png.flaticon.com/512/742/742751.png" alt="Trophy" class="w-24 h-24 mx-auto drop-shadow-lg">
            </div>
            <h2 class="text-3xl font-extrabold text-purple-700 mb-2">T·ªïng K·∫øt!</h2>
            <p id="feedback-text" class="text-gray-600 mb-6 font-semibold">B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-green-100 p-4 rounded-xl border-2 border-green-400">
                    <p class="text-green-700 text-sm font-bold uppercase">ƒê√∫ng</p>
                    <p id="modal-score" class="text-3xl font-black text-green-600">0</p>
                </div>
                <div class="bg-red-100 p-4 rounded-xl border-2 border-red-400">
                    <p class="text-red-700 text-sm font-bold uppercase">Sai</p>
                    <p id="modal-wrong" class="text-3xl font-black text-red-600">0</p>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full btn-3d bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-xl text-lg">
                <i class="fa-solid fa-rotate-right mr-2"></i> L√†m l·∫°i b√†i
            </button>
        </div>
    </div>

    <!-- Audio Effects -->
    <audio id="sound-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <script>
        // --- DATA SOURCE ---
        const quizData = {
          "questions": [
            {
              "questionNumber": 1,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'c').\nA. cave\nB. canyon\nC. coast\nD. circle",
              "imageUrl": null,
              "answerOptions": [
                {
                  "text": "circle",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. cave (n): hang ƒë·ªông\n- B. canyon (n): h·∫ªm n√∫i\n- C. coast (n): b·ªù bi·ªÉn\n- D. circle (n): v√≤ng tr√≤n\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. cave /ke…™v/ (√¢m /k/)\n- B. canyon /Ààk√¶nj…ôn/ (√¢m /k/)\n- C. coast /k…ô äst/ (√¢m /k/)\n- D. circle /Ààs…úÀêkl/ (√¢m /s/)\n\n=> ƒê√°p √°n D ph√°t √¢m l√† /s/, c√°c t·ª´ c√≤n l·∫°i ph√°t √¢m l√† /k/.",
                  "isCorrect": true
                },
                { "text": "cave", "isCorrect": false },
                { "text": "canyon", "isCorrect": false },
                { "text": "coast", "isCorrect": false }
              ],
              "hint": "Pay attention to the letter 'c'. Is it a hard 'c' /k/ or a soft 'c' /s/?"
            },
            {
              "questionNumber": 2,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: ending sound/vowel).\nA. river\nB. water\nC. wonder\nD. heritage",
              "answerOptions": [
                {
                  "text": "heritage",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. river (n): d√≤ng s√¥ng\n- B. water (n): n∆∞·ªõc\n- C. wonder (n): k·ª≥ quan\n- D. heritage (n): di s·∫£n\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\nC√¢u n√†y ki·ªÉm tra ph·∫ßn ƒëu√¥i t·ª´.\n- A. river /Ààr…™v…ôr/ (ƒëu√¥i /…ôr/)\n- B. water /Ààw…îÀêt…ôr/ (ƒëu√¥i /…ôr/)\n- C. wonder /Ààw ånd…ôr/ (ƒëu√¥i /…ôr/)\n- D. heritage /Ààher…™t…™d í/ (ƒëu√¥i /…™d í/)\n\n=> ƒê√°p √°n D c√≥ ph·∫ßn ƒëu√¥i ph√°t √¢m kh√°c bi·ªát ho√†n to√†n so v·ªõi 3 t·ª´ c√≤n l·∫°i.",
                  "isCorrect": true
                },
                { "text": "river", "isCorrect": false },
                { "text": "water", "isCorrect": false },
                { "text": "wonder", "isCorrect": false }
              ],
              "hint": "Look at the ending of each word. Three words end with the same 'er' sound."
            },
            {
              "questionNumber": 3,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'g').\nA. ground\nB. green\nC. grass\nD. geography",
              "answerOptions": [
                {
                  "text": "geography",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. ground (n): m·∫∑t ƒë·∫•t\n- B. green (adj/n): m√†u xanh l√°\n- C. grass (n): c·ªè\n- D. geography (n): ƒë·ªãa l√Ω\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. ground /…°ra änd/ (√¢m /…°/ - g c·ª©ng)\n- B. green /…°riÀên/ (√¢m /…°/ - g c·ª©ng)\n- C. grass /…°r…ëÀês/ (√¢m /…°/ - g c·ª©ng)\n- D. geography /d íiÀà…í…°r…ôfi/ (√¢m /d í/ - g m·ªÅm, gi·ªëng √¢m 'j')\n\n=> ƒê√°p √°n D ph√°t √¢m l√† /d í/.",
                  "isCorrect": true
                },
                { "text": "ground", "isCorrect": false },
                { "text": "green", "isCorrect": false },
                { "text": "grass", "isCorrect": false }
              ],
              "hint": "Is the 'g' sound hard like in 'go' or soft like in 'giant'?"
            },
            {
              "questionNumber": 4,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'c').\nA. volcano\nB. ocean\nC. coral\nD. tropical",
              "answerOptions": [
                {
                  "text": "ocean",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. volcano (n): n√∫i l·ª≠a\n- B. ocean (n): ƒë·∫°i d∆∞∆°ng\n- C. coral (n): san h√¥\n- D. tropical (adj): thu·ªôc nhi·ªát ƒë·ªõi\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. volcano /v…ílÀàke…™n…ô ä/ (√¢m /k/)\n- B. ocean /Àà…ô ä Én/ (√¢m / É/ - gi·ªëng √¢m 's' n·∫∑ng)\n- C. coral /Ààk…ír…ôl/ (√¢m /k/)\n- D. tropical /Ààtr…íp…™kl/ (√¢m /k/)\n\n=> ƒê√°p √°n B ph√°t √¢m l√† / É/.",
                  "isCorrect": true
                },
                { "text": "volcano", "isCorrect": false },
                { "text": "coral", "isCorrect": false },
                { "text": "tropical", "isCorrect": false }
              ],
              "hint": "Check the sound of 'c'. In one word, it sounds like 'sh' / É/."
            },
            {
              "questionNumber": 5,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 's').\nA. island\nB. forest\nC. fossil\nD. waterfalls",
              "answerOptions": [
                {
                  "text": "island",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. island (n): h√≤n ƒë·∫£o\n- B. forest (n): r·ª´ng\n- C. fossil (n): h√≥a th·∫°ch\n- D. waterfalls (n): th√°c n∆∞·ªõc (s·ªë nhi·ªÅu)\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. island /Ààa…™l…ônd/ (√¢m 's' b·ªã c√¢m - silent s)\n- B. forest /Ààf…ír…™st/ (√¢m /s/)\n- C. fossil /Ààf…ísl/ (√¢m /s/)\n- D. waterfalls /Ààw…îÀêt…ôf…îÀêlz/ (√¢m cu·ªëi l√† /z/, nh∆∞ng √¢m 's' trong island ƒë·∫∑c bi·ªát nh·∫•t v√¨ n√≥ c√¢m ho√†n to√†n).\n\n=> ƒê√°p √°n A l√† kh√°c bi·ªát nh·∫•t v√¨ ch·ªØ 's' kh√¥ng ƒë∆∞·ª£c ph√°t √¢m.",
                  "isCorrect": true
                },
                { "text": "forest", "isCorrect": false },
                { "text": "fossil", "isCorrect": false },
                { "text": "waterfalls", "isCorrect": false }
              ],
              "hint": "In one of these words, the 's' is silent (not pronounced at all)."
            },
            {
              "questionNumber": 6,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'th').\nA. thunder\nB. earth\nC. thousand\nD. weather",
              "answerOptions": [
                {
                  "text": "weather",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. thunder (n): s·∫•m s√©t\n- B. earth (n): tr√°i ƒë·∫•t\n- C. thousand (number): m·ªôt ngh√¨n\n- D. weather (n): th·ªùi ti·∫øt\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. thunder /ÀàŒ∏ ånd…ôr/ (√¢m /Œ∏/ - th v√¥ thanh)\n- B. earth /…úÀêŒ∏/ (√¢m /Œ∏/ - th v√¥ thanh)\n- C. thousand /ÀàŒ∏a äznd/ (√¢m /Œ∏/ - th v√¥ thanh)\n- D. weather /Ààwe√∞…ôr/ (√¢m /√∞/ - th h·ªØu thanh, gi·ªëng 'ƒë' nh∆∞ng rung c·ªï h·ªçng)\n\n=> ƒê√°p √°n D ph√°t √¢m l√† /√∞/.",
                  "isCorrect": true
                },
                { "text": "thunder", "isCorrect": false },
                { "text": "earth", "isCorrect": false },
                { "text": "thousand", "isCorrect": false }
              ],
              "hint": "Identify the voiced 'th' /√∞/ (vibrates throat) vs unvoiced 'th' /Œ∏/."
            },
            {
              "questionNumber": 7,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'a').\nA. lake\nB. waterfall\nC. nature\nD. wave",
              "answerOptions": [
                {
                  "text": "waterfall",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. lake (n): h·ªì n∆∞·ªõc\n- B. waterfall (n): th√°c n∆∞·ªõc\n- C. nature (n): thi√™n nhi√™n\n- D. wave (n): con s√≥ng\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. lake /le…™k/ (√¢m /e…™/)\n- B. waterfall /Ààw…îÀêt…ôf…îÀêl/ (√¢m /…îÀê/ - o tr√≤n mi·ªáng)\n- C. nature /Ààne…™t É…ôr/ (√¢m /e…™/)\n- D. wave /we…™v/ (√¢m /e…™/)\n\n=> ƒê√°p √°n B ph√°t √¢m l√† /…îÀê/.",
                  "isCorrect": true
                },
                { "text": "lake", "isCorrect": false },
                { "text": "nature", "isCorrect": false },
                { "text": "wave", "isCorrect": false }
              ],
              "hint": "Listen to the vowel sound 'a'. Which one is not /e…™/?"
            },
            {
              "questionNumber": 8,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'ea').\nA. sea\nB. beach\nC. reach\nD. break",
              "answerOptions": [
                {
                  "text": "break",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. sea (n): bi·ªÉn\n- B. beach (n): b√£i bi·ªÉn\n- C. reach (v): v·ªõi t·ªõi/ƒë·∫øn n∆°i\n- D. break (v/n): l√†m v·ª°/gi·ªù ngh·ªâ\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. sea /siÀê/ (√¢m /iÀê/ - y d√†i)\n- B. beach /biÀêt É/ (√¢m /iÀê/)\n- C. reach /riÀêt É/ (√¢m /iÀê/)\n- D. break /bre…™k/ (√¢m /e…™/)\n\n=> ƒê√°p √°n D ph√°t √¢m l√† /e…™/.",
                  "isCorrect": true
                },
                { "text": "sea", "isCorrect": false },
                { "text": "beach", "isCorrect": false },
                { "text": "reach", "isCorrect": false }
              ],
              "hint": "Most of these 'ea' words sound like /iÀê/ (long e). One sounds like /e…™/."
            },
            {
              "questionNumber": 9,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'ou').\nA. cloud\nB. mountain\nC. south\nD. young",
              "answerOptions": [
                {
                  "text": "young",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. cloud (n): ƒë√°m m√¢y\n- B. mountain (n): ng·ªçn n√∫i\n- C. south (n): ph√≠a nam\n- D. young (adj): tr·∫ª\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. cloud /kla äd/ (√¢m /a ä/)\n- B. mountain /Ààma änt…™n/ (√¢m /a ä/)\n- C. south /sa äŒ∏/ (√¢m /a ä/)\n- D. young /j å≈ã/ (√¢m / å/ - √¢m √°)\n\n=> ƒê√°p √°n D ph√°t √¢m l√† / å/.",
                  "isCorrect": true
                },
                { "text": "cloud", "isCorrect": false },
                { "text": "mountain", "isCorrect": false },
                { "text": "south", "isCorrect": false }
              ],
              "hint": "Which word has the 'ou' sound pronounced as / å/ (like in 'sun')?"
            },
            {
              "questionNumber": 10,
              "question": "Mark the letter A, B, C, or D to indicate the word whose underlined part differs from the other three in pronunciation (Focus: 'ch').\nA. beach\nB. channel\nC. archipelago\nD. charming",
              "answerOptions": [
                {
                  "text": "archipelago",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. beach (n): b√£i bi·ªÉn\n- B. channel (n): k√™nh ƒë√†o/k√™nh\n- C. archipelago (n): qu·∫ßn ƒë·∫£o\n- D. charming (adj): quy·∫øn r≈©/thu h√∫t\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. beach /biÀêt É/ (√¢m /t É/ - ch nh·∫π)\n- B. channel /Ààt É√¶nl/ (√¢m /t É/)\n- C. archipelago /Àå…ëÀêk…™Ààpel…ô…°…ô ä/ (√¢m /k/)\n- D. charming /Ààt É…ëÀêm…™≈ã/ (√¢m /t É/)\n\n=> ƒê√°p √°n C ph√°t √¢m l√† /k/.",
                  "isCorrect": true
                },
                { "text": "beach", "isCorrect": false },
                { "text": "channel", "isCorrect": false },
                { "text": "charming", "isCorrect": false }
              ],
              "hint": "One word has 'ch' pronounced as /k/."
            },
            {
              "questionNumber": 11,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. desert\nB. island\nC. volcano\nD. canyon",
              "answerOptions": [
                {
                  "text": "volcano",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. desert (n): sa m·∫°c\n- B. island (n): h√≤n ƒë·∫£o\n- C. volcano (n): n√∫i l·ª≠a\n- D. canyon (n): h·∫ªm n√∫i\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. desert /Ààdez…ôt/ (tr·ªçng √¢m 1)\n- B. island /Ààa…™l…ônd/ (tr·ªçng √¢m 1)\n- C. volcano /v…ílÀàke…™n…ô ä/ (tr·ªçng √¢m 2)\n- D. canyon /Ààk√¶nj…ôn/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n C tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "desert", "isCorrect": false },
                { "text": "island", "isCorrect": false },
                { "text": "canyon", "isCorrect": false }
              ],
              "hint": "Three words are stressed on the 1st syllable, one is on the 2nd."
            },
            {
              "questionNumber": 12,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. waterfall\nB. glacier\nC. coral\nD. lagoon",
              "answerOptions": [
                {
                  "text": "lagoon",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. waterfall (n): th√°c n∆∞·ªõc\n- B. glacier (n): s√¥ng bƒÉng\n- C. coral (n): san h√¥\n- D. lagoon (n): ph√°/ƒë·∫ßm n∆∞·ªõc m·∫∑n\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. waterfall /Ààw…îÀêt…ôf…îÀêl/ (tr·ªçng √¢m 1)\n- B. glacier /Àà…°l√¶si…ôr/ (tr·ªçng √¢m 1)\n- C. coral /Ààk…ír…ôl/ (tr·ªçng √¢m 1)\n- D. lagoon /l…ôÀà…°uÀên/ (tr·ªçng √¢m 2)\n\n=> ƒê√°p √°n D tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "waterfall", "isCorrect": false },
                { "text": "glacier", "isCorrect": false },
                { "text": "coral", "isCorrect": false }
              ],
              "hint": "The word ending in 'oon' typically takes the stress."
            },
            {
              "questionNumber": 13,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. erosion\nB. valley\nC. forest\nD. mountain",
              "answerOptions": [
                {
                  "text": "erosion",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. erosion (n): s·ª± x√≥i m√≤n\n- B. valley (n): thung l≈©ng\n- C. forest (n): r·ª´ng\n- D. mountain (n): n√∫i\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. erosion /…™Ààr…ô ä ín/ (tr·ªçng √¢m 2 - quy t·∫Øc ƒëu√¥i -sion nh·∫•n tr∆∞·ªõc n√≥)\n- B. valley /Ààv√¶li/ (tr·ªçng √¢m 1)\n- C. forest /Ààf…ír…™st/ (tr·ªçng √¢m 1)\n- D. mountain /Ààma änt…™n/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n A tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "valley", "isCorrect": false },
                { "text": "forest", "isCorrect": false },
                { "text": "mountain", "isCorrect": false }
              ],
              "hint": "Words ending in '-sion' usually have the stress on the syllable immediately before it."
            },
            {
              "questionNumber": 14,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. nature\nB. safari\nC. wonder\nD. climate",
              "answerOptions": [
                {
                  "text": "safari",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. nature (n): thi√™n nhi√™n\n- B. safari (n): chuy·∫øn ƒëi d√£ ngo·∫°i quan s√°t ƒë·ªông v·∫≠t\n- C. wonder (n): k·ª≥ quan\n- D. climate (n): kh√≠ h·∫≠u\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. nature /Ààne…™t É…ôr/ (tr·ªçng √¢m 1)\n- B. safari /s…ôÀàf…ëÀêri/ (tr·ªçng √¢m 2)\n- C. wonder /Ààw ånd…ôr/ (tr·ªçng √¢m 1)\n- D. climate /Ààkla…™m…ôt/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n B tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "nature", "isCorrect": false },
                { "text": "wonder", "isCorrect": false },
                { "text": "climate", "isCorrect": false }
              ],
              "hint": "'Safari' sounds like sa-FA-ri."
            },
            {
              "questionNumber": 15,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. ocean\nB. jungle\nC. oasis\nD. cavern",
              "answerOptions": [
                {
                  "text": "oasis",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. ocean (n): ƒë·∫°i d∆∞∆°ng\n- B. jungle (n): r·ª´ng nhi·ªát ƒë·ªõi\n- C. oasis (n): ·ªëc ƒë·∫£o\n- D. cavern (n): hang l·ªõn\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. ocean /Àà…ô ä Én/ (tr·ªçng √¢m 1)\n- B. jungle /Ààd í å≈ã…°l/ (tr·ªçng √¢m 1)\n- C. oasis /…ô äÀàe…™s…™s/ (tr·ªçng √¢m 2)\n- D. cavern /Ààk√¶v…ôn/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n C tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "ocean", "isCorrect": false },
                { "text": "jungle", "isCorrect": false },
                { "text": "cavern", "isCorrect": false }
              ],
              "hint": "Oasis is stressed on the second syllable: o-A-sis."
            },
            {
              "questionNumber": 16,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. horizon\nB. summit\nC. crater\nD. landscape",
              "answerOptions": [
                {
                  "text": "horizon",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. horizon (n): ƒë∆∞·ªùng ch√¢n tr·ªùi\n- B. summit (n): ƒë·ªânh n√∫i\n- C. crater (n): mi·ªáng n√∫i l·ª≠a\n- D. landscape (n): phong c·∫£nh\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. horizon /h…ôÀàra…™zn/ (tr·ªçng √¢m 2)\n- B. summit /Ààs åm…™t/ (tr·ªçng √¢m 1)\n- C. crater /Ààkre…™t…ôr/ (tr·ªçng √¢m 1)\n- D. landscape /Ààl√¶ndske…™p/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n A tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "summit", "isCorrect": false },
                { "text": "crater", "isCorrect": false },
                { "text": "landscape", "isCorrect": false }
              ],
              "hint": "Horizon is pronounced /h…ôÀàra…™zn/."
            },
            {
              "questionNumber": 17,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. natural\nB. tropical\nC. amazing\nD. beautiful",
              "answerOptions": [
                {
                  "text": "amazing",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. natural (adj): thu·ªôc t·ª± nhi√™n\n- B. tropical (adj): thu·ªôc nhi·ªát ƒë·ªõi\n- C. amazing (adj): kinh ng·∫°c/tuy·ªát v·ªùi\n- D. beautiful (adj): xinh ƒë·∫πp\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. natural /Ààn√¶t Ér…ôl/ (tr·ªçng √¢m 1)\n- B. tropical /Ààtr…íp…™kl/ (tr·ªçng √¢m 1)\n- C. amazing /…ôÀàme…™z…™≈ã/ (tr·ªçng √¢m 2)\n- D. beautiful /ÀàbjuÀêt…™fl/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n C tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "natural", "isCorrect": false },
                { "text": "tropical", "isCorrect": false },
                { "text": "beautiful", "isCorrect": false }
              ],
              "hint": "Listen for the rhythm. Which word starts with a weak sound /…ô/?"
            },
            {
              "questionNumber": 18,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. meadow\nB. bamboo\nC. coastline\nD. wildlife",
              "answerOptions": [
                {
                  "text": "bamboo",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. meadow (n): ƒë·ªìng c·ªè\n- B. bamboo (n): c√¢y tre\n- C. coastline (n): ƒë∆∞·ªùng b·ªù bi·ªÉn\n- D. wildlife (n): cu·ªôc s·ªëng hoang d√£\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. meadow /Ààmed…ô ä/ (tr·ªçng √¢m 1)\n- B. bamboo /Àåb√¶mÀàbuÀê/ (tr·ªçng √¢m 2)\n- C. coastline /Ààk…ô ästla…™n/ (tr·ªçng √¢m 1)\n- D. wildlife /Ààwa…™ldla…™f/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n B tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "meadow", "isCorrect": false },
                { "text": "coastline", "isCorrect": false },
                { "text": "wildlife", "isCorrect": false }
              ],
              "hint": "Words ending in 'oo' often take the stress on that syllable."
            },
            {
              "questionNumber": 19,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. explore\nB. protect\nC. enjoy\nD. travel",
              "answerOptions": [
                {
                  "text": "travel",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. explore (v): kh√°m ph√°\n- B. protect (v): b·∫£o v·ªá\n- C. enjoy (v): th∆∞·ªüng th·ª©c/t·∫≠n h∆∞·ªüng\n- D. travel (v): du l·ªãch\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. explore /…™kÀàspl…îÀêr/ (tr·ªçng √¢m 2 - ƒë·ªông t·ª´ 2 √¢m ti·∫øt th∆∞·ªùng nh·∫•n √¢m 2)\n- B. protect /pr…ôÀàtekt/ (tr·ªçng √¢m 2)\n- C. enjoy /…™nÀàd í…î…™/ (tr·ªçng √¢m 2)\n- D. travel /Ààtr√¶vl/ (tr·ªçng √¢m 1 - ngo·∫°i l·ªá c·ªßa ƒë·ªông t·ª´ 2 √¢m ti·∫øt)\n\n=> ƒê√°p √°n D tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1.",
                  "isCorrect": true
                },
                { "text": "explore", "isCorrect": false },
                { "text": "protect", "isCorrect": false },
                { "text": "enjoy", "isCorrect": false }
              ],
              "hint": "Most 2-syllable verbs are stressed on the 2nd syllable, but 'travel' is an exception."
            },
            {
              "questionNumber": 20,
              "question": "Mark the letter A, B, C, or D to indicate the word that differs from the other three in the position of primary stress.\nA. waterway\nB. rainforest\nC. adventure\nD. ecosystem",
              "answerOptions": [
                {
                  "text": "adventure",
                  "rationale": "**D·ªãch & Lo·∫°i t·ª´:**\n- A. waterway (n): ƒë∆∞·ªùng th·ªßy\n- B. rainforest (n): r·ª´ng m∆∞a nhi·ªát ƒë·ªõi\n- C. adventure (n): cu·ªôc phi√™u l∆∞u\n- D. ecosystem (n): h·ªá sinh th√°i\n\n**Gi·∫£i th√≠ch chi ti·∫øt:**\n- A. waterway /Ààw…îÀêt…ôwe…™/ (tr·ªçng √¢m 1 - danh t·ª´ gh√©p th∆∞·ªùng nh·∫•n t·ª´ ƒë·∫ßu)\n- B. rainforest /Ààre…™nf…ír…™st/ (tr·ªçng √¢m 1 - danh t·ª´ gh√©p)\n- C. adventure /…ôdÀàvent É…ôr/ (tr·ªçng √¢m 2)\n- D. ecosystem /ÀàiÀêk…ô äs…™st…ôm/ (tr·ªçng √¢m 1)\n\n=> ƒê√°p √°n C tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
                  "isCorrect": true
                },
                { "text": "waterway", "isCorrect": false },
                { "text": "rainforest", "isCorrect": false },
                { "text": "ecosystem", "isCorrect": false }
              ],
              "hint": "Compound nouns (like waterway, rainforest) usually have stress on the first part."
            }
          ]
        };

        // --- STATE MANAGEMENT ---
        let currentScore = 0;
        let answeredCount = 0;
        const totalQuestions = quizData.questions.length;
        const container = document.getElementById('quiz-container');

        // --- UTILS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Parse markdown-like syntax in text
        function parseText(text) {
            if (!text) return "";
            // Bold
            let html = text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-purple-700">$1</strong>');
            // New lines
            html = html.replace(/\n/g, '<br>');
            return html;
        }

        // Helper to underline target sound if Focus is mentioned
        function formatOptionText(text, questionText) {
            // Extract content inside Focus: '...'
            const focusMatch = questionText.match(/Focus:\s*['"](.+?)['"]/i);
            if (focusMatch && focusMatch[1]) {
                const target = focusMatch[1];
                // Careful regex to replace only the first occurrence or specific patterns if possible
                // For simplicity and safety in phonetics, we might just display text normally
                // OR try to replace the target string
                // But for things like "ea" or "th", simple replace works well enough for display
                try {
                    // Create a regex that finds the target string
                    const regex = new RegExp(`(${target})`, 'i'); 
                    // Note: This replaces the first match. Pronunciation quizzes usually focus on the highlighted part.
                    // However, sometimes it replaces the wrong part if the letter appears twice.
                    // Given constraints, I will replace ALL occurrences to be safe or just the first. 
                    // Let's replace the first one as is standard in multiple choice text.
                    return text.replace(regex, '<u>$1</u>');
                } catch(e) {
                    return text;
                }
            }
            // Fallback for Stress questions or if no focus found
            return text;
        }

        // --- INITIALIZATION ---
        function initQuiz() {
            // Shuffle questions
            const questions = shuffleArray([...quizData.questions]);
            document.getElementById('total-display').innerText = totalQuestions;

            questions.forEach((q, index) => {
                const card = createQuestionCard(q, index + 1);
                container.appendChild(card);
            });
        }

        // --- RENDER CARD ---
        function createQuestionCard(q, index) {
            const card = document.createElement('div');
            card.className = "bg-white rounded-3xl p-6 md:p-8 card-shadow border border-gray-100 relative overflow-hidden group";
            
            // Decorative Number
            const numberBadge = document.createElement('div');
            numberBadge.className = "absolute -top-4 -left-4 w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center text-white font-black text-2xl shadow-lg transform group-hover:scale-110 transition-transform z-10";
            numberBadge.innerText = index;
            card.appendChild(numberBadge);

            // Question Text
            const questionText = document.createElement('h3');
            questionText.className = "text-xl md:text-2xl font-bold text-gray-800 mb-6 pl-8 leading-relaxed";
            // Highlight the "Focus" part in the question title
            const highlightedTitle = q.question.replace(/\(Focus:.*?\)/, (match) => `<span class="text-purple-600 bg-purple-100 px-2 py-1 rounded-lg text-base align-middle ml-2">${match}</span>`);
            // Handle new lines in question text (like A. B. C. D. listing removal)
            // We want to remove the static A. B. C. D. lines from the question text string if they exist, 
            // because we are rendering buttons.
            const cleanQuestionText = highlightedTitle.split('\n')[0]; // Take only the instruction line
            questionText.innerHTML = cleanQuestionText;
            card.appendChild(questionText);

            // Options Container (Grid)
            const optionsGrid = document.createElement('div');
            optionsGrid.className = "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6";

            // Find correct answer object to extract rationale later
            const correctAnswerObj = q.answerOptions.find(opt => opt.isCorrect);
            const explanationHTML = parseText(correctAnswerObj.rationale);

            // Shuffle Options logic needs to preserve mapping to original data
            // We clone options to shuffle
            let displayOptions = [...q.answerOptions];
            // Don't shuffle for this specific type if A,B,C,D order matters strictly, 
            // but for Gamification, shuffling position is better.
            displayOptions = shuffleArray(displayOptions);

            displayOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "btn-3d btn-option py-4 px-6 rounded-2xl text-lg font-bold text-left relative overflow-hidden";
                
                // Store correctness for easy retrieval later
                btn.dataset.isCorrect = opt.isCorrect;

                // Format text with underline if needed
                const formattedText = formatOptionText(opt.text, q.question);
                btn.innerHTML = `<span class="z-10 relative">${formattedText}</span>`;

                btn.onclick = () => handleAnswer(btn, opt, card, optionsGrid, explanationHTML, q.hint);
                optionsGrid.appendChild(btn);
            });
            card.appendChild(optionsGrid);

            // Explanation Area (Hidden initially)
            const explainBox = document.createElement('div');
            explainBox.className = "hidden explanation-box bg-purple-50 border-2 border-purple-200 rounded-2xl p-6 text-gray-700 mt-4";
            explainBox.innerHTML = `
                <div class="flex items-center gap-2 mb-3 text-purple-700 font-bold uppercase tracking-wider text-sm border-b pb-2 border-purple-200">
                    <i class="fa-solid fa-chalkboard-user"></i> Gi·∫£i th√≠ch chi ti·∫øt c·ªßa c√¥ Mai An
                </div>
                <div class="prose prose-purple max-w-none text-base leading-relaxed">
                    ${explanationHTML}
                </div>
            `;
            if (q.hint) {
                const hintDiv = document.createElement('div');
                hintDiv.className = "mt-3 text-sm text-teal-600 font-semibold italic";
                hintDiv.innerHTML = `<i class="fa-regular fa-lightbulb mr-1"></i> M·∫πo: ${q.hint}`;
                explainBox.querySelector('.prose').appendChild(hintDiv);
            }
            card.appendChild(explainBox);

            return card;
        }

        // --- HANDLE ANSWER ---
        function handleAnswer(btn, optionObj, cardElement, gridElement, explanationHTML, hint) {
            // Prevent multiple clicks
            const allBtns = gridElement.querySelectorAll('button');
            allBtns.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-70', 'cursor-not-allowed');
            });
            btn.classList.remove('opacity-70');

            const explainBox = cardElement.querySelector('.explanation-box');
            explainBox.classList.remove('hidden');

            answeredCount++;
            
            if (optionObj.isCorrect) {
                // CORRECT
                btn.classList.add('correct');
                btn.innerHTML += ` <i class="fa-solid fa-check-circle float-right text-2xl"></i>`;
                currentScore++;
                updateScoreDisplay();
                playSound('correct');
                triggerConfetti(btn);
            } else {
                // WRONG
                btn.classList.add('wrong', 'shake-element');
                btn.innerHTML += ` <i class="fa-solid fa-circle-xmark float-right text-2xl"></i>`;
                playSound('wrong');
                
                // Highlight the correct one automatically so user knows
                allBtns.forEach(b => {
                    if (b.dataset.isCorrect === 'true') {
                        b.classList.add('correct');
                        b.classList.remove('opacity-70'); // Make it clear
                        if (!b.innerHTML.includes('fa-check-circle')) {
                            b.innerHTML += ` <i class="fa-solid fa-check-circle float-right text-2xl"></i>`;
                        }
                    }
                });
            }
        }

        function updateScoreDisplay() {
            const scoreEl = document.getElementById('score-display');
            scoreEl.innerText = currentScore;
            scoreEl.classList.add('scale-150', 'text-teal-600');
            setTimeout(() => scoreEl.classList.remove('scale-150', 'text-teal-600'), 200);
        }

        // --- AUDIO ---
        function playSound(type) {
            const audioMap = {
                'correct': document.getElementById('sound-correct'),
                'wrong': document.getElementById('sound-wrong'),
                'finish': document.getElementById('sound-finish')
            };
            const audio = audioMap[type];
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Audio autoplay prevented"));
            }
        }

        // --- EFFECTS ---
        function triggerConfetti(element) {
            const rect = element.getBoundingClientRect();
            // Normalized coordinates
            const x = (rect.left + rect.width / 2) / window.innerWidth;
            const y = (rect.top + rect.height / 2) / window.innerHeight;

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { x: x, y: y },
                colors: ['#8854C0', '#00C9A7', '#FFEB3B']
            });
        }

        // --- FINISH ---
        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const feedbackText = document.getElementById('feedback-text');
            const scoreText = document.getElementById('modal-score');
            const wrongText = document.getElementById('modal-wrong');

            scoreText.innerText = currentScore;
            wrongText.innerText = totalQuestions - currentScore;

            // Feedback Logic
            const percentage = (currentScore / totalQuestions) * 100;
            if (percentage === 100) {
                feedbackText.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i ng·ªØ √¢m! üèÜ";
                playSound('finish');
                confetti({ particleCount: 500, spread: 100, origin: { y: 0.6 } });
            } else if (percentage >= 80) {
                feedbackText.innerText = "Gi·ªèi l·∫Øm! Ch·ªâ m·ªôt ch√∫t n·ªØa l√† ho√†n h·∫£o! üåü";
                playSound('finish');
            } else if (percentage >= 50) {
                feedbackText.innerText = "C·ªë g·∫Øng l√™n! √în l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üí™";
            } else {
                feedbackText.innerText = "ƒê·ª´ng n·∫£n ch√≠! H√£y ƒë·ªçc k·ªπ gi·∫£i th√≠ch v√† l√†m l·∫°i n√†o! üå±";
            }

            modal.classList.remove('hidden');
        }

        // Start
        initQuiz();

    </script>
</body>
</html>
