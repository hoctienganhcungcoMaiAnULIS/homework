<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Arrangement Challenge - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #F0F4F8;
            --text-color: #2D3436;
            --card-bg: #FFFFFF;
            --sentence-bg: #F3E5F5;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* H·∫°n ch·∫ø b√¥i ƒëen ƒë·ªÉ t·∫≠p trung click */
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #E0F7FA;
            /* H·ªça ti·∫øt ch·∫•m bi m·ªù */
            background-image: radial-gradient(#00C9A7 15%, transparent 16%), radial-gradient(#8854C0 15%, transparent 16%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            padding-bottom: 100px;
        }

        h1, h2, h3 {
            font-family: 'Quicksand', sans-serif;
            text-align: center;
            color: var(--primary-pink);
            text-shadow: 2px 2px 0px #fff;
            margin: 10px 0;
        }

        .header-title {
            background: #fff;
            display: inline-block;
            padding: 8px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 3px solid var(--primary-teal);
        }

        .teacher-badge {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
            font-weight: 700;
        }

        /* --- Layout Styles --- */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .section-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 10px 0 rgba(136, 84, 192, 0.2);
            border: 4px solid #fff;
            position: relative;
            overflow: hidden;
        }

        .section-header {
            background: var(--primary-pink);
            color: white;
            padding: 10px 25px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 800;
            font-size: 1.2rem;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
            border: 2px solid white;
        }

        /* --- Sentence List Styling --- */
        .sentence-list {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }

        .sentence-item {
            background: var(--sentence-bg);
            margin-bottom: 8px;
            padding: 10px 15px;
            border-radius: 10px;
            border-left: 5px solid var(--primary-teal);
            font-size: 1.05rem;
            line-height: 1.5;
        }

        .sentence-label {
            font-weight: 800;
            color: var(--primary-pink);
            margin-right: 8px;
            display: inline-block;
            width: 20px;
        }

        /* --- Glossary Table --- */
        .glossary-container {
            margin-top: 15px;
            margin-bottom: 20px;
            border: 2px dashed #ccc;
            border-radius: 15px;
            padding: 15px;
            background: #fff;
            display: none; /* Hide if empty */
        }
        
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
        }

        .glossary-table th {
            background: var(--primary-teal);
            color: white;
            padding: 8px;
            text-align: left;
            font-family: 'Quicksand', sans-serif;
            font-size: 0.9rem;
        }

        .glossary-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .type-tag {
            background: #eee;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            color: #555;
            font-family: monospace;
        }

        /* --- Options Grid --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 5px 0 #ccc;
            text-align: center;
            letter-spacing: 1px;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-pink);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            box-shadow: 0 0 0 #ccc;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-green) !important;
            color: white !important;
            border-color: #00A653 !important;
            box-shadow: 0 5px 0 #008E47 !important;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red) !important;
            color: white !important;
            border-color: #D63031 !important;
            box-shadow: 0 5px 0 #B82829 !important;
            animation: shake 0.5s;
        }

        .option-btn:disabled {
            cursor: default;
            opacity: 0.7;
        }

        /* --- Explanation Box --- */
        .explanation-box {
            display: none; /* Hidden by default */
            margin-top: 25px;
            background: #FFFDE7; /* Very light yellow */
            border: 2px solid #FBC02D;
            padding: 20px;
            border-radius: 15px;
            animation: slideDown 0.4s ease-out;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .exp-header {
            font-weight: 800;
            color: #F57F17;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px dashed #FBC02D;
            padding-bottom: 10px;
        }

        .exp-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-pink);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .exp-content p {
            margin: 8px 0;
            line-height: 1.6;
        }

        .exp-label {
            font-weight: 800;
            color: var(--primary-pink);
            text-transform: uppercase;
            font-size: 0.8rem;
            background: #E1D4F9;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }

        .highlight-text {
            color: #D84315;
            font-weight: bold;
            background: #FFCCBC;
            padding: 0 4px;
            border-radius: 3px;
        }

        /* --- Footer / Result --- */
        .submit-section {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.5rem;
            font-weight: 800;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #5E328F;
            transition: transform 0.2s;
            font-family: 'Quicksand', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .submit-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #5E328F;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* Popup Score */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            border: 6px solid var(--primary-teal);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        .score-display {
            font-size: 4rem;
            color: var(--primary-pink);
            font-weight: 900;
            font-family: 'Quicksand', sans-serif;
            margin: 10px 0;
            text-shadow: 3px 3px 0 #eee;
        }

        .comment-text {
            font-size: 1.3rem;
            margin-top: 10px;
            margin-bottom: 20px;
            color: #555;
            font-weight: 600;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <center>
            <div class="header-title">
                <h1>SENTENCE ARRANGEMENT</h1>
                <div class="teacher-badge">Created by: Ms. Mai An ULIS</div>
            </div>
            <p style="font-weight: 600; color: #555; margin-bottom: 30px;">Exercise 5: Mark the letter A, B, C or D to indicate the correct arrangement.</p>
        </center>

        <div id="questions-area"></div>

        <div class="submit-section">
            <button class="submit-btn" onclick="showFinalResult()">N·ªòP B√ÄI & XEM ƒêI·ªÇM üèÜ</button>
        </div>
    </div>

    <div id="resultModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-pink)">K·∫æT QU·∫¢ C·ª¶A B·∫†N</h2>
            <div class="score-display" id="finalScore">0/4</div>
            <p class="comment-text" id="finalComment">C·ªë g·∫Øng l√™n nh√©!</p>
            <button class="submit-btn" style="font-size: 1rem; padding: 10px 30px;" onclick="closeModal()">Xem l·∫°i b√†i l√†m</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const quizData = [
            {
                id: 1,
                sentences: {
                    a: "First, candy wrappers, plastic bottles, and food scraps get blown around by the wind, making the park look messy.",
                    b: "However, there are ways to fix this!",
                    c: "Everyone can do their part by throwing away their trash in the bins provided. If we all work together, we can keep our park clean and safe for everyone.",
                    d: "Second, this litter can harm wildlife if animals eat it or get tangled in it.",
                    e: "The local park is a great place to relax and play, but there's a big problem with litter."
                },
                options: { A: "e-d-a-b-c", B: "a-c-e-b-d", C: "a-d-b-c-d", D: "e-a-d-b-c" },
                correct: "D",
                glossary: [
                    {word: "Litter", type: "n", mean: "R√°c th·∫£i"},
                    {word: "Scrap", type: "n", mean: "M·∫£nh v·ª•n, ƒë·ªì th·ª´a"},
                    {word: "Tangled", type: "adj", mean: "B·ªã m·∫Øc k·∫πt, r·ªëi"},
                    {word: "Messy", type: "adj", mean: "L·ªôn x·ªôn, b·ª´a b√£i"}
                ],
                explanation: `
                    <p><span class="exp-label">D·ªãch c√°c c√¢u:</span><br>
                    (e) C√¥ng vi√™n ƒë·ªãa ph∆∞∆°ng l√† n∆°i tuy·ªát v·ªùi ƒë·ªÉ th∆∞ gi√£n, nh∆∞ng c√≥ m·ªôt v·∫•n ƒë·ªÅ l·ªõn v·ªÅ r√°c th·∫£i.<br>
                    (a) ƒê·∫ßu ti√™n, v·ªè k·∫πo, chai nh·ª±a... b·ªã gi√≥ th·ªïi bay, l√†m c√¥ng vi√™n tr√¥ng b·ª´a b·ªôn.<br>
                    (d) Th·ª© hai, r√°c n√†y c√≥ th·ªÉ h·∫°i ƒë·ªông v·∫≠t hoang d√£...<br>
                    (b) Tuy nhi√™n, c√≥ nh·ªØng c√°ch ƒë·ªÉ s·ª≠a ch·ªØa ƒëi·ªÅu n√†y!<br>
                    (c) M·ªçi ng∆∞·ªùi c√≥ th·ªÉ g√≥p s·ª©c b·∫±ng c√°ch v·ª©t r√°c ƒë√∫ng n∆°i...</p>
                    
                    <p><span class="exp-label">T·∫°i sao ƒê√öNG (D):</span><br>
                    1. <strong>(e)</strong>: C√¢u ch·ªß ƒë·ªÅ gi·ªõi thi·ªáu v·∫•n ƒë·ªÅ (problem with litter).<br>
                    2. <strong>(a)</strong>: N√™u h·∫≠u qu·∫£ th·ª© nh·∫•t (First,... messy).<br>
                    3. <strong>(d)</strong>: N√™u h·∫≠u qu·∫£ th·ª© hai (Second,... harm wildlife).<br>
                    4. <strong>(b)</strong>: C√¢u chuy·ªÉn √Ω sang gi·∫£i ph√°p (However,... ways to fix).<br>
                    5. <strong>(c)</strong>: Gi·∫£i ph√°p c·ª• th·ªÉ v√† k·∫øt lu·∫≠n.</p>
                `
            },
            {
                id: 2,
                sentences: {
                    a: "The Green Club would be a great way to meet new friends who share your passion for the environment.",
                    b: "If so, then a Green Club might be just for you! In this club, we'd get together to brainstorm ideas for making our school and community more eco-friendly.",
                    c: "Together, we can make a real difference and help keep our world green and healthy!",
                    d: "Do you love being outside and taking care of our planet?",
                    e: "We could have fun activities like planting trees, organizing clean-up days, or even learning how to make our own recycled crafts."
                },
                options: { A: "b-a-c-d-e", B: "d-a-b-e-c", C: "d-b-e-a-c", D: "b-d-c-a-e" },
                correct: "C",
                glossary: [
                    {word: "Passion", type: "n", mean: "Ni·ªÅm ƒëam m√™"},
                    {word: "Brainstorm", type: "v", mean: "ƒê·ªông n√£o, t√¨m √Ω t∆∞·ªüng"},
                    {word: "Eco-friendly", type: "adj", mean: "Th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng"},
                    {word: "Craft", type: "n", mean: "ƒê·ªì th·ªß c√¥ng"}
                ],
                explanation: `
                    <p><span class="exp-label">D·ªãch c√°c c√¢u:</span><br>
                    (d) B·∫°n c√≥ y√™u th√≠ch vi·ªác ·ªü ngo√†i tr·ªùi v√† chƒÉm s√≥c h√†nh tinh kh√¥ng?<br>
                    (b) N·∫øu v·∫≠y, CLB Xanh c√≥ th·ªÉ d√†nh cho b·∫°n...<br>
                    (e) Ch√∫ng ta c√≥ th·ªÉ c√≥ c√°c ho·∫°t ƒë·ªông vui nh∆∞ tr·ªìng c√¢y...<br>
                    (a) CLB Xanh s·∫Ω l√† c√°ch tuy·ªát v·ªùi ƒë·ªÉ g·∫∑p b·∫°n m·ªõi...<br>
                    (c) C√πng nhau, ch√∫ng ta c√≥ th·ªÉ t·∫°o ra s·ª± kh√°c bi·ªát...</p>

                    <p><span class="exp-label">T·∫°i sao ƒê√öNG (C):</span><br>
                    1. <strong>(d)</strong>: C√¢u h·ªèi m·ªü ƒë·∫ßu (Hook) ƒë·ªÉ thu h√∫t s·ª± ch√∫ √Ω.<br>
                    2. <strong>(b)</strong>: Tr·∫£ l·ªùi c√¢u h·ªèi v√† gi·ªõi thi·ªáu CLB (If so,...).<br>
                    3. <strong>(e)</strong>: Li·ªát k√™ chi ti·∫øt c√°c ho·∫°t ƒë·ªông c·ª• th·ªÉ.<br>
                    4. <strong>(a)</strong>: N√™u th√™m l·ª£i √≠ch x√£ h·ªôi (meet new friends).<br>
                    5. <strong>(c)</strong>: C√¢u k·∫øt lu·∫≠n mang t√≠nh k√™u g·ªçi (Together...).</p>
                `
            },
            {
                id: 3,
                sentences: {
                    a: "We can plant new trees, build special crossings for animals on roads, and protect areas where animals naturally live.",
                    b: "This disrupts the environment and makes it hard for animals to find food and shelter.",
                    c: "By working together, we can create a healthier world for both people and wildlife.",
                    d: "However, there are several solutions to reverse these problems!",
                    e: "Many human activities, like cutting down forests, farming, and building roads, can destroy animal homes."
                },
                options: { A: "e-b-d-a-c", B: "e-b-a-d-c", C: "e-d-c-b-a", D: "e-c-d-b-a" },
                correct: "A",
                glossary: [
                    {word: "Disrupt", type: "v", mean: "Ph√° v·ª°, l√†m gi√°n ƒëo·∫°n"},
                    {word: "Shelter", type: "n", mean: "N∆°i tr√∫ ·∫©n"},
                    {word: "Reverse", type: "v", mean: "ƒê·∫£o ng∆∞·ª£c, kh·∫Øc ph·ª•c"},
                    {word: "Crossing", type: "n", mean: "L·ªëi ƒëi bƒÉng qua ƒë∆∞·ªùng"}
                ],
                explanation: `
                    <p><span class="exp-label">D·ªãch c√°c c√¢u:</span><br>
                    (e) Nhi·ªÅu ho·∫°t ƒë·ªông c·ªßa con ng∆∞·ªùi... c√≥ th·ªÉ ph√° h·ªßy nh√† c·ªßa ƒë·ªông v·∫≠t.<br>
                    (b) ƒêi·ªÅu n√†y ph√° v·ª° m√¥i tr∆∞·ªùng v√† khi·∫øn ƒë·ªông v·∫≠t kh√≥ t√¨m th·ª©c ƒÉn...<br>
                    (d) Tuy nhi√™n, c√≥ m·ªôt v√†i gi·∫£i ph√°p ƒë·ªÉ ƒë·∫£o ng∆∞·ª£c v·∫•n ƒë·ªÅ n√†y!<br>
                    (a) Ch√∫ng ta c√≥ th·ªÉ tr·ªìng c√¢y m·ªõi, x√¢y l·ªëi ƒëi cho ƒë·ªông v·∫≠t...<br>
                    (c) B·∫±ng c√°ch l√†m vi·ªác c√πng nhau, ch√∫ng ta c√≥ th·ªÉ t·∫°o ra th·∫ø gi·ªõi kh·ªèe m·∫°nh h∆°n...</p>

                    <p><span class="exp-label">T·∫°i sao ƒê√öNG (A):</span><br>
                    1. <strong>(e)</strong>: N√™u nguy√™n nh√¢n/v·∫•n ƒë·ªÅ (human activities destroy homes).<br>
                    2. <strong>(b)</strong>: N√™u h·∫≠u qu·∫£ (This disrupts...). "This" thay th·∫ø cho c√°c ho·∫°t ƒë·ªông ·ªü c√¢u (e).<br>
                    3. <strong>(d)</strong>: Chuy·ªÉn √Ω sang gi·∫£i ph√°p (However,... solutions).<br>
                    4. <strong>(a)</strong>: Li·ªát k√™ c√°c gi·∫£i ph√°p c·ª• th·ªÉ.<br>
                    5. <strong>(c)</strong>: K·∫øt lu·∫≠n √Ω nghƒ©a chung.</p>
                `
            },
            {
                id: 4,
                sentences: {
                    a: "We should protect these places to ensure a good life for future generations. Together, we can make a difference!",
                    b: "I hope you are having a wonderful day!",
                    c: "Furthermore, forests help keep the climate stable and provide homes for many animals.",
                    d: "Firstly, we need to remember that nature provides us with clean air and fresh water.",
                    e: "Looking forward to hearing your thoughts!"
                },
                options: { A: "b-a-c-d-e", B: "d-a-b-e-c", C: "d-b-e-a-c", D: "b-d-c-a-e" },
                correct: "D",
                glossary: [
                    {word: "Ensure", type: "v", mean: "ƒê·∫£m b·∫£o"},
                    {word: "Generation", type: "n", mean: "Th·∫ø h·ªá"},
                    {word: "Stable", type: "adj", mean: "·ªîn ƒë·ªãnh"},
                    {word: "Furthermore", type: "adv", mean: "H∆°n n·ªØa"}
                ],
                explanation: `
                    <p><span class="exp-label">D·ªãch c√°c c√¢u:</span><br>
                    Dear Sue,<br>
                    (b) Hy v·ªçng b·∫°n c√≥ m·ªôt ng√†y tuy·ªát v·ªùi!<br>
                    (d) ƒê·∫ßu ti√™n, ch√∫ng ta c·∫ßn nh·ªõ r·∫±ng thi√™n nhi√™n cung c·∫•p kh√¥ng kh√≠ s·∫°ch...<br>
                    (c) H∆°n n·ªØa, r·ª´ng gi√∫p gi·ªØ kh√≠ h·∫≠u ·ªïn ƒë·ªãnh...<br>
                    (a) Ch√∫ng ta n√™n b·∫£o v·ªá nh·ªØng n∆°i n√†y... C√πng nhau t·∫°o s·ª± kh√°c bi·ªát!<br>
                    (e) Mong s·ªõm nghe suy nghƒ© c·ªßa b·∫°n!</p>

                    <p><span class="exp-label">T·∫°i sao ƒê√öNG (D):</span><br>
                    1. <strong>(b)</strong>: L·ªùi ch√†o h·ªèi m·ªü ƒë·∫ßu th∆∞ (Greeting).<br>
                    2. <strong>(d)</strong>: √ù ch√≠nh th·ª© nh·∫•t (Firstly...).<br>
                    3. <strong>(c)</strong>: √ù ch√≠nh th·ª© hai, b·ªï sung th√™m (Furthermore...).<br>
                    4. <strong>(a)</strong>: L·ªùi k√™u g·ªçi h√†nh ƒë·ªông/K·∫øt lu·∫≠n n·ªôi dung.<br>
                    5. <strong>(e)</strong>: L·ªùi ch√†o k·∫øt th∆∞ (Sign-off).</p>
                `
            }
        ];

        // --- SOUNDS (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderQuestions() {
            const container = document.getElementById('questions-area');
            
            quizData.forEach((item, index) => {
                // Prepare glossary html
                let glossaryHtml = '';
                if(item.glossary && item.glossary.length > 0) {
                    glossaryHtml = `
                    <div class="glossary-container" style="display:block">
                        <h4 style="margin:0 0 10px 0; color:var(--primary-teal)">üìö Mini Glossary</h4>
                        <table class="glossary-table">
                            ${item.glossary.map(g => `
                                <tr>
                                    <td style="width: 30%"><strong>${g.word}</strong> <span class="type-tag">${g.type}</span></td>
                                    <td>${g.mean}</td>
                                </tr>
                            `).join('')}
                        </table>
                    </div>`;
                }

                // Render Sentences List
                let sentencesHtml = '<ul class="sentence-list">';
                for (const [key, val] of Object.entries(item.sentences)) {
                    sentencesHtml += `<li class="sentence-item"><span class="sentence-label">${key}.</span> ${val}</li>`;
                }
                sentencesHtml += '</ul>';

                // Render Options
                let optionsHtml = '<div class="options-grid">';
                for (const [key, val] of Object.entries(item.options)) {
                    optionsHtml += `<button class="option-btn" onclick="checkAnswer(${item.id}, '${key}', '${item.correct}')">${key}. ${val}</button>`;
                }
                optionsHtml += '</div>';

                const html = `
                    <div class="section-card" id="q-block-${item.id}">
                        <div class="section-header">Question ${index + 1}</div>
                        ${glossaryHtml}
                        ${sentencesHtml}
                        ${optionsHtml}
                        <div class="explanation-box" id="exp-${item.id}">
                            <div class="exp-header">
                                <div class="exp-avatar">Ms</div>
                                <span>C√¥ Mai An gi·∫£i th√≠ch:</span>
                            </div>
                            <div class="exp-content">
                                ${item.explanation}
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // Initialize Rendering
        renderQuestions();

        // --- LOGIC FUNCTIONS ---
        let score = 0;
        const totalQuestions = quizData.length;

        function checkAnswer(id, selected, correct) {
            const block = document.getElementById(`q-block-${id}`);
            const buttons = block.querySelectorAll('.option-btn');
            const expBox = document.getElementById(`exp-${id}`);

            // Disable buttons
            buttons.forEach(btn => {
                btn.disabled = true;
                const btnText = btn.innerText; 
                // btnText format "A. e-d-c..." -> check first char
                const btnLetter = btnText.charAt(0);

                if (btnLetter === correct) {
                    btn.classList.add('correct');
                }
                if (btnLetter === selected && selected !== correct) {
                    btn.classList.add('wrong');
                }
            });

            // Logic
            if (selected === correct) {
                score++;
                playSound('correct');
                fireConfetti();
            } else {
                playSound('wrong');
            }

            // Show Explanation
            expBox.style.display = 'block';
        }

        function showFinalResult() {
            const modal = document.getElementById('resultModal');
            const scoreText = document.getElementById('finalScore');
            const comment = document.getElementById('finalComment');
            
            scoreText.innerText = `${score} / ${totalQuestions}`;
            
            if(score === totalQuestions) {
                comment.innerText = "Tuy·ªát v·ªùi! Em s·∫Øp x·∫øp c√¢u qu√° ƒë·ªânh! üåü";
                fireConfetti();
            } else if (score >= 2) {
                comment.innerText = "L√†m t·ªët l·∫Øm! ƒê·ªçc k·ªπ gi·∫£i th√≠ch ƒë·ªÉ gi·ªèi h∆°n nh√©! üî•";
            } else {
                comment.innerText = "C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! H√£y xem k·ªπ logic c·ªßa t·ª´ng c√¢u! üí™";
            }

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // --- CONFETTI EFFECT ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for (let i = 0; i < 80; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 4 + 2,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    size: Math.random() * 8 + 4
                });
            }

            let animationId;
            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let active = false;
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.y < canvas.height) {
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, p.size, p.size);
                        active = true;
                    }
                });

                if (active) {
                    animationId = requestAnimationFrame(update);
                } else {
                    cancelAnimationFrame(animationId);
                }
            }
            update();
        }

        window.addEventListener('resize', () => {
            const canvas = document.getElementById('confetti-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

    </script>
</body>
</html>

