<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms. Mai An ULIS - English 9 Quiz</title>
    <!-- Google Fonts: Nunito for rounded, friendly look -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8854C0',    /* T√≠m h·ªìng nh·∫°t */
                        secondary: '#00C9A7',  /* Xanh ng·ªçc */
                        correct: '#00D26A',    /* Xanh l√° chu·∫©n */
                        wrong: '#FF4757',      /* ƒê·ªè cam */
                        bgPattern: '#F0F3F9',
                        cardBg: '#FFFFFF',
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        display: ['Quicksand', 'sans-serif'],
                    },
                    boxShadow: {
                        '3d': '0 6px 0px rgba(0,0,0,0.15)',
                        '3d-active': '0 2px 0px rgba(0,0,0,0.15)',
                        'card': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #dfdbfb;
            background-image: radial-gradient(#8854C0 1px, transparent 1px), radial-gradient(#8854C0 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
        }
        
        /* Animation: Shake for wrong answer */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        .shake-anim {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Animation: Pop In */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .pop-in {
            animation: popIn 0.3s ease-out forwards;
        }

        /* 3D Button Styles */
        .btn-option {
            transition: all 0.15s ease;
            border: 2px solid #E2E8F0;
        }
        .btn-option:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 0px rgba(0,0,0,0.1);
            border-color: #8854C0;
            background-color: #F8F5FF;
        }
        .btn-option:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0px rgba(0,0,0,0.1);
        }

        /* State Styles */
        .btn-correct {
            background-color: #00D26A !important;
            color: white !important;
            border-color: #00B85C !important;
            box-shadow: 0 6px 0px #008F47 !important;
        }
        .btn-wrong {
            background-color: #FF4757 !important;
            color: white !important;
            border-color: #E03646 !important;
            box-shadow: 0 6px 0px #B82C3A !important;
        }
        .disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #8854C0; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6c4298; 
        }
    </style>
</head>
<body class="min-h-screen text-slate-700 pb-20">

    <!-- Header -->
    <header class="bg-white shadow-3d sticky top-0 z-50 border-b-4 border-slate-200">
        <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white text-2xl border-2 border-white shadow-md">
                    <i class="fa-solid fa-graduation-cap"></i>
                </div>
                <div>
                    <h1 class="font-display font-bold text-xl text-primary">Ms. Mai An ULIS</h1>
                    <p class="text-xs text-gray-500 font-bold tracking-wide">ENGLISH 9 - UNIT 9 QUIZ</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex flex-col items-end">
                    <span class="text-xs text-gray-400 font-bold uppercase">Score</span>
                    <span id="score-display" class="font-display font-black text-2xl text-secondary">0/0</span>
                </div>
                <button onclick="scrollToResult()" class="bg-secondary hover:bg-teal-500 text-white font-bold py-2 px-4 rounded-xl shadow-3d active:shadow-3d-active transform active:translate-y-1 transition-all">
                    <i class="fa-solid fa-flag-checkered mr-2"></i>N·ªôp b√†i
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-4 py-8 space-y-8" id="quiz-container">
        <!-- Introduction Card -->
        <div class="bg-white rounded-3xl p-6 shadow-card border-2 border-slate-100 text-center pop-in">
            <h2 class="text-2xl font-display font-bold text-gray-800 mb-2">B√†i t·∫≠p Unit 9: Relative Clauses</h2>
            <p class="text-gray-500 mb-4">K·∫øt h·ª£p c√¢u & Vi·∫øt l·∫°i c√¢u (Sentence Combination & Rewriting)</p>
            <div class="flex justify-center gap-2 text-sm font-semibold">
                <span class="px-3 py-1 bg-green-100 text-green-600 rounded-lg">16 C√¢u h·ªèi</span>
                <span class="px-3 py-1 bg-purple-100 text-purple-600 rounded-lg">Gi·∫£i th√≠ch chi ti·∫øt</span>
                <span class="px-3 py-1 bg-orange-100 text-orange-600 rounded-lg">Gamification</span>
            </div>
        </div>

        <!-- Questions will be injected here via JS -->
    </main>

    <!-- Result Modal (Hidden by default) -->
    <div id="result-modal" class="fixed inset-0 bg-black/60 z-[100] hidden items-center justify-center backdrop-blur-sm px-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center relative border-4 border-white transform transition-all scale-100">
            <div class="absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 bg-secondary rounded-full flex items-center justify-center border-4 border-white shadow-lg text-4xl text-white animate-bounce">
                <i class="fa-solid fa-trophy"></i>
            </div>
            
            <h2 class="mt-10 text-3xl font-display font-black text-gray-800 mb-2">Ho√†n th√†nh!</h2>
            <p id="feedback-message" class="text-gray-500 mb-6 font-semibold">B·∫°n l√†m r·∫•t t·ªët!</p>
            
            <div class="bg-slate-50 rounded-2xl p-6 mb-8 border border-slate-200">
                <div class="text-sm text-gray-400 font-bold uppercase tracking-wider mb-1">T·ªïng ƒëi·ªÉm</div>
                <div class="text-5xl font-black text-primary" id="final-score">0/16</div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="restartQuiz()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl shadow-3d active:shadow-3d-active active:translate-y-1 transition-all">
                    <i class="fa-solid fa-rotate-right mr-2"></i>L√†m l·∫°i
                </button>
                <button onclick="closeModal()" class="w-full bg-primary hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-xl shadow-3d active:shadow-3d-active active:translate-y-1 transition-all">
                    <i class="fa-solid fa-eye mr-2"></i>Xem l·∫°i
                </button>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="sound-correct" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>
    <audio id="sound-win" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

    <script>
        // --- DATA ---
        // D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi v√† l√†m gi√†u ph·∫ßn gi·∫£i th√≠ch theo chu·∫©n "Ms. Mai An"
        const rawQuestions = [
            {
                id: 1,
                label: "Ex 3-1",
                question: "The tourists visited a local market. The market sold beautiful handmade crafts.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "The tourists visited a local market, which sold beautiful handmade crafts.",
                    "The tourists who visited a market sold beautiful handmade crafts.",
                    "Tourists visited the beautiful handmade crafts sold at a local market.",
                    "A local market sold beautiful handmade crafts which the tourists visited."
                ],
                correct: 0,
                explanation: {
                    translateQ: "Du kh√°ch ƒë√£ gh√© thƒÉm m·ªôt khu ch·ª£ ƒë·ªãa ph∆∞∆°ng. Khu ch·ª£ n√†y b√°n nh·ªØng m√≥n ƒë·ªì th·ªß c√¥ng tuy·ªát ƒë·∫πp.",
                    analysis: [
                        "A. ...which sold... (M·ªánh ƒë·ªÅ quan h·ªá b·ªï nghƒ©a cho 'market' - ƒê√öNG)",
                        "B. ...who visited... sold... (Sai nghƒ©a: Du kh√°ch b√°n ƒë·ªì th·ªß c√¥ng)",
                        "C. ...visited the crafts... (Sai nghƒ©a: Du kh√°ch ƒëi thƒÉm ƒë·ªì v·∫≠t ch·ª© kh√¥ng ph·∫£i thƒÉm ch·ª£)",
                        "D. ...which the tourists visited (Ng·ªØ ph√°p ƒë√∫ng nh∆∞ng ƒë·∫£o ng∆∞·ª£c √Ω ch√≠nh c·ªßa c√¢u g·ªëc)"
                    ],
                    whyCorrect: "D√πng ƒë·∫°i t·ª´ quan h·ªá <b>'which'</b> thay th·∫ø cho danh t·ª´ ch·ªâ v·∫≠t <b>'local market'</b> l√†m ch·ªß ng·ªØ cho ƒë·ªông t·ª´ 'sold'.",
                    whyWrong: "C√°c ƒë√°p √°n kh√°c l√†m sai l·ªách √Ω nghƒ©a c·ªßa c√¢u g·ªëc ho·∫∑c s·∫Øp x·∫øp tr·∫≠t t·ª± t·ª´ kh√¥ng h·ª£p l√Ω."
                }
            },
            {
                id: 2,
                label: "Ex 3-2",
                question: "We stayed at a hotel with a rooftop pool. Its view was incredible.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "The view from the pool, which was incredible, was the hotel we stayed at.",
                    "We stayed at a hotel with a rooftop pool whose view was incredible.",
                    "The incredible view from the pool made the hotel we stayed at unforgettable.",
                    "With an incredible view, the rooftop pool was located at the hotel where we stayed."
                ],
                correct: 1,
                explanation: {
                    translateQ: "Ch√∫ng t√¥i ·ªü t·∫°i m·ªôt kh√°ch s·∫°n c√≥ h·ªì b∆°i tr√™n s√¢n th∆∞·ª£ng. T·∫ßm nh√¨n c·ªßa n√≥ th·∫≠t ƒë√°ng kinh ng·∫°c.",
                    analysis: [
                        "A. ...was the hotel (Sai nghƒ©a: T·∫ßm nh√¨n... l√† c√°i kh√°ch s·∫°n)",
                        "B. ...whose view was incredible (ƒê√öNG: T·∫ßm nh√¨n c·ªßa c√°i h·ªì b∆°i)",
                        "C. ...made the hotel... unforgettable (Sai: Th√™m t·ª´ 'unforgettable' kh√¥ng c√≥ trong b√†i)",
                        "D. C·∫•u tr√∫c ph·ª©c t·∫°p, kh√¥ng d√πng MƒêQH n·ªëi tr·ª±c ti·∫øp."
                    ],
                    whyCorrect: "D√πng ƒë·∫°i t·ª´ quan h·ªá ch·ªâ s·ªü h·ªØu <b>'whose'</b> thay th·∫ø cho t√≠nh t·ª´ s·ªü h·ªØu <b>'Its'</b> (Its view -> whose view).",
                    whyWrong: "ƒê√°p √°n A sai logic. ƒê√°p √°n C th√™m th·∫Øt √Ω. ƒê√°p √°n D kh√¥ng s√°t y√™u c·∫ßu b√†i t·∫≠p."
                }
            },
            {
                id: 3,
                label: "Ex 3-3",
                question: "The restaurant served fresh seafood. We ordered dishes from there.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "We ordered dishes from the restaurant where the fresh seafood was served.",
                    "The fresh seafood we ordered from a restaurant that served delicious dishes.",
                    "We enjoyed fresh seafood at a restaurant where we placed our order.",
                    "Serving fresh seafood, the restaurant received many orders from us."
                ],
                correct: 0,
                explanation: {
                    translateQ: "Nh√† h√†ng ph·ª•c v·ª• h·∫£i s·∫£n t∆∞∆°i. Ch√∫ng t√¥i ƒë√£ g·ªçi m√≥n t·ª´ ƒë√≥.",
                    analysis: [
                        "A. ...where the fresh seafood was served (ƒê√öNG: N∆°i ph·ª•c v·ª• h·∫£i s·∫£n)",
                        "B. C√¢u ch∆∞a ho√†n ch·ªânh (Thi·∫øu ƒë·ªông t·ª´ ch√≠nh)",
                        "C. ...enjoyed fresh seafood... (Sai: ƒê·ªïi 'ordered' th√†nh 'enjoyed' sai nghƒ©a g·ªëc)",
                        "D. ...received many orders... (Sai: Th√™m √Ω 'many orders' kh√¥ng c√≥ trong b√†i)"
                    ],
                    whyCorrect: "D√πng tr·∫°ng t·ª´ quan h·ªá n∆°i ch·ªën <b>'where'</b> thay th·∫ø cho c·ª•m <b>'from there/at the restaurant'</b>. C√¢u ƒë∆∞·ª£c chuy·ªÉn sang b·ªã ƒë·ªông ƒë·ªÉ vƒÉn phong m∆∞·ª£t m√† h∆°n.",
                    whyWrong: "B sai ng·ªØ ph√°p. C v√† D sai nghƒ©a ho·∫∑c th√™m th√¥ng tin kh√¥ng c√≥."
                }
            },
            {
                id: 4,
                label: "Ex 3-4",
                question: "The tour guide spoke perfect English. He explained the history of the city.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "The tour guide explained the history of the city with perfect English.",
                    "The tour guide‚Äôs English explanation of the city‚Äôs history was perfect.",
                    "The tour guide who spoke perfect English explained the city‚Äôs history to us.",
                    "The tour guide explained the city‚Äôs history for US spoke English perfectly."
                ],
                correct: 2,
                explanation: {
                    translateQ: "H∆∞·ªõng d·∫´n vi√™n n√≥i ti·∫øng Anh ho√†n h·∫£o. Anh ·∫•y gi·∫£i th√≠ch l·ªãch s·ª≠ th√†nh ph·ªë.",
                    analysis: [
                        "A. C√¢u ƒë∆°n, kh√¥ng d√πng MƒêQH (Ch∆∞a t·ªëi ∆∞u cho b√†i t·∫≠p Unit 9)",
                        "B. ƒê·ªïi c·∫•u tr√∫c qu√° nhi·ªÅu (Noun phrase)",
                        "C. ...who spoke perfect English... (ƒê√öNG: M·ªánh ƒë·ªÅ quan h·ªá b·ªï nghƒ©a cho ng∆∞·ªùi)",
                        "D. Sai ng·ªØ ph√°p tr·∫ßm tr·ªçng (Run-on sentence)"
                    ],
                    whyCorrect: "D√πng ƒë·∫°i t·ª´ quan h·ªá <b>'who'</b> thay th·∫ø cho danh t·ª´ ch·ªâ ng∆∞·ªùi <b>'The tour guide'</b>.",
                    whyWrong: "A ƒë√∫ng nghƒ©a nh∆∞ng kh√¥ng ph·∫£i c√¢u gh√©p d√πng MƒêQH. D sai c·∫•u tr√∫c c√¢u."
                }
            },
            {
                id: 5,
                label: "Ex 3-5",
                question: "The museum displayed ancient artifacts. They came from all over the world.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "Artifacts coming from all over the world, where the museum displayed.",
                    "They came from all over the world, the museum displayed ancient artifacts.",
                    "The artifacts came from all over the world which were displayed at the museum.",
                    "The museum displayed ancient artifacts, which came from all over the world."
                ],
                correct: 3,
                explanation: {
                    translateQ: "B·∫£o t√†ng tr∆∞ng b√†y c√°c c·ªï v·∫≠t. Ch√∫ng ƒë·∫øn t·ª´ kh·∫Øp n∆°i tr√™n th·∫ø gi·ªõi.",
                    analysis: [
                        "A. Sai ng·ªØ ph√°p (where d√πng sai, c√¢u thi·∫øu ƒë·ªông t·ª´ ch√≠nh)",
                        "B. L·ªói Run-on sentence (Hai c√¢u ƒë∆°n n·ªëi b·∫±ng d·∫•u ph·∫©y)",
                        "C. ƒê·∫£o l·ªôn tr·∫≠t t·ª± ch√≠nh ph·ª• (C√¢u g·ªëc nh·∫•n m·∫°nh vi·ªác tr∆∞ng b√†y)",
                        "D. ...artifacts, which came... (ƒê√öNG)"
                    ],
                    whyCorrect: "D√πng <b>'which'</b> thay th·∫ø cho <b>'They'</b> (ch·ªâ v·∫≠t 'ancient artifacts'). D√πng d·∫•u ph·∫©y v√¨ c·ª•m danh t·ª´ ƒë√£ x√°c ƒë·ªãnh (t√πy ng·ªØ c·∫£nh, nh∆∞ng ·ªü ƒë√¢y n·ªëi ti·∫øp √Ω r·∫•t t·ª± nhi√™n).",
                    whyWrong: "A v√† B sai ng·ªØ ph√°p c∆° b·∫£n. C l√†m thay ƒë·ªïi tr·ªçng t√¢m c√¢u."
                }
            },
            {
                id: 6,
                label: "Ex 3-6",
                question: "Last month, we attended the festival. It celebrates the local culture.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "We attended the festival which celebrated the local culture last month.",
                    "The festival celebrated last month by US was about local culture.",
                    "The local culture was celebrated by a festival that we attended last month.",
                    "It was a festival celebrating the local culture which we attended last month."
                ],
                correct: 0,
                explanation: {
                    translateQ: "Th√°ng tr∆∞·ªõc, ch√∫ng t√¥i tham d·ª± l·ªÖ h·ªôi. N√≥ t√¥n vinh vƒÉn h√≥a ƒë·ªãa ph∆∞∆°ng.",
                    analysis: [
                        "A. ...festival which celebrated... (ƒê√öNG: which thay cho festival)",
                        "B. C√¢u b·ªã ƒë·ªông, ƒë√∫ng nghƒ©a nh∆∞ng c·∫•u tr√∫c kh√°c b√†i h·ªçc",
                        "C. B·ªã ƒë·ªông h√≥a ch·ªß ng·ªØ 'local culture', m·∫•t ch·ªß ng·ªØ 'We'",
                        "D. C·∫•u tr√∫c Cleft sentence (C√¢u ch·∫ª) h∆°i r∆∞·ªùm r√†"
                    ],
                    whyCorrect: "D√πng <b>'which'</b> ƒë·ªÉ n·ªëi hai c√¢u. ƒê·ªông t·ª´ 'celebrates' (hi·ªán t·∫°i) ƒë∆∞·ª£c chuy·ªÉn th√†nh 'celebrated' (qu√° kh·ª©) ƒë·ªÉ h√≤a h·ª£p th√¨ v·ªõi 'attended'.",
                    whyWrong: "C√°c ƒë√°p √°n kh√°c ƒë√∫ng nghƒ©a nh∆∞ng c·∫•u tr√∫c ph·ª©c t·∫°p ho·∫∑c kh√¥ng s√°t v·ªõi m·ª•c ti√™u luy·ªán t·∫≠p MƒêQH."
                }
            },
            {
                id: 7,
                label: "Ex 3-7",
                question: "Tour guides are knowledgeable about the area. They can show you the best attractions.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "Tour guides who are knowledgeable about the area can show you the best attractions.",
                    "Even when the tour guides are knowledgeable..., they are unable...",
                    "Despite their knowledge..., few tour guides can...",
                    "Tour guides can show you... even though they know little..."
                ],
                correct: 0,
                explanation: {
                    translateQ: "H∆∞·ªõng d·∫´n vi√™n am hi·ªÉu v·ªÅ khu v·ª±c. H·ªç c√≥ th·ªÉ ch·ªâ cho b·∫°n nh·ªØng ƒëi·ªÉm tham quan t·ªët nh·∫•t.",
                    analysis: [
                        "A. ...who are knowledgeable... (ƒê√öNG)",
                        "B. Sai nghƒ©a (unable - kh√¥ng th·ªÉ)",
                        "C. Sai nghƒ©a (few - r·∫•t √≠t)",
                        "D. Sai nghƒ©a (know little - bi·∫øt √≠t)"
                    ],
                    whyCorrect: "K·∫øt h·ª£p hai c√¢u kh·∫≥ng ƒë·ªãnh mang nghƒ©a b·ªï sung cho nhau b·∫±ng ƒë·∫°i t·ª´ quan h·ªá <b>'who'</b>.",
                    whyWrong: "C√°c ƒë√°p √°n B, C, D ƒë·ªÅu d√πng t·ª´ n·ªëi mang nghƒ©a t∆∞∆°ng ph·∫£n (Even when, Despite, Even though) ho·∫∑c t·ª´ ph·ªß ƒë·ªãnh (unable, few, little) l√†m sai l·ªách nghƒ©a t√≠ch c·ª±c c·ªßa c√¢u g·ªëc."
                }
            },
            {
                id: 8,
                label: "Ex 3-8",
                question: "Locals are friendly and welcoming. They are always ready to assist tourists.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "Locals are friendly and welcoming, but not all of them are ready to assist tourists.",
                    "Locals who are friendly and welcoming are always ready to assist tourists.",
                    "Even though locals are friendly and welcoming, not all of them are ready to assist tourists.",
                    "Only the locals whose friends are welcoming are ready to assist tourists."
                ],
                correct: 1,
                explanation: {
                    translateQ: "Ng∆∞·ªùi d√¢n ƒë·ªãa ph∆∞∆°ng th√¢n thi·ªán v√† hi·∫øu kh√°ch. H·ªç lu√¥n s·∫µn s√†ng h·ªó tr·ª£ du kh√°ch.",
                    analysis: [
                        "A. Sai nghƒ©a (but not all - nh∆∞ng kh√¥ng ph·∫£i t·∫•t c·∫£)",
                        "B. ...who are friendly... (ƒê√öNG)",
                        "C. Sai nghƒ©a (not all)",
                        "D. Sai ho√†n to√†n (whose friends - b·∫°n c·ªßa h·ªç)"
                    ],
                    whyCorrect: "Hai c√¢u g·ªëc ƒë·ªÅu mang nghƒ©a t√≠ch c·ª±c, h·ªó tr·ª£ nhau -> D√πng <b>'who'</b> ƒë·ªÉ k·∫øt n·ªëi.",
                    whyWrong: "C√°c ƒë√°p √°n kh√°c c·ªë t√¨nh th√™m √Ω ph·ªß ƒë·ªãnh ho·∫∑c sai l·ªách ch·ªß ng·ªØ."
                }
            },
            {
                id: 9,
                label: "Ex 3-9",
                question: "The hotel's rooms overlook the ocean. The hotel offers breathtaking view to guests.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "The guests who want rooms overlooking the ocean can ask the hotel to offer them.",
                    "Only the guests who want rooms overlooking the ocean may get the hotel offers.",
                    "The hotel whose rooms overlook the ocean offers breathtaking views to guests.",
                    "The breathtaking view is offered to the guests who stay at the hotel for a long time."
                ],
                correct: 2,
                explanation: {
                    translateQ: "C√°c ph√≤ng c·ªßa kh√°ch s·∫°n nh√¨n ra bi·ªÉn. Kh√°ch s·∫°n cung c·∫•p t·∫ßm nh√¨n ngo·∫°n m·ª•c cho kh√°ch.",
                    analysis: [
                        "A. Sai nghƒ©a so v·ªõi c√¢u g·ªëc.",
                        "B. Sai nghƒ©a.",
                        "C. ...whose rooms overlook... (ƒê√öNG: Ph√≤ng c·ªßa kh√°ch s·∫°n)",
                        "D. Sai nghƒ©a (th√™m √Ω 'stay for a long time')"
                    ],
                    whyCorrect: "D√πng ƒë·∫°i t·ª´ s·ªü h·ªØu <b>'whose'</b> thay th·∫ø cho <b>'The hotel's'</b>.",
                    whyWrong: "A, B, D ƒë·ªÅu t·ª± √Ω th√™m th·∫Øt c√°c ƒëi·ªÅu ki·ªán kh√¥ng c√≥ trong c√¢u g·ªëc."
                }
            },
            {
                id: 10,
                label: "Ex 3-10",
                question: "The tour guide shares fascinating stories. The tour guide's expertise in history is impressive.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "Despite his lack of expertise in history, the tour guide shares fascinating stories.",
                    "The tour guide fails to share fascinating stories however impressive his expertise is.",
                    "The tour guide's expertise in history is good, but he fails to share interesting story.",
                    "The tour guide, whose expertise in history is impressive, shares fascinating stories."
                ],
                correct: 3,
                explanation: {
                    translateQ: "H∆∞·ªõng d·∫´n vi√™n chia s·∫ª nh·ªØng c√¢u chuy·ªán h·∫•p d·∫´n. Chuy√™n m√¥n l·ªãch s·ª≠ c·ªßa anh ·∫•y r·∫•t ·∫•n t∆∞·ª£ng.",
                    analysis: [
                        "A. Sai nghƒ©a (lack of expertise - thi·∫øu chuy√™n m√¥n)",
                        "B. Sai nghƒ©a (fails to share - th·∫•t b·∫°i chia s·∫ª)",
                        "C. Sai nghƒ©a (fails to share)",
                        "D. ...whose expertise... (ƒê√öNG)"
                    ],
                    whyCorrect: "D√πng <b>'whose'</b> ch·ªâ s·ªü h·ªØu (The tour guide's expertise). C√¢u n√†y d√πng d·∫•u ph·∫©y v√¨ 'The tour guide' ƒë√£ x√°c ƒë·ªãnh ho·∫∑c coi nh∆∞ th√¥ng tin th√™m.",
                    whyWrong: "A, B, C ƒë·ªÅu mang nghƒ©a ph·ªß ƒë·ªãnh ng∆∞·ª£c l·∫°i v·ªõi c√¢u g·ªëc."
                }
            },
            {
                id: 11,
                label: "Ex 3-11",
                question: "The market sells fresh produce and local crafts. It is a great place to explore.",
                task: "Choose the sentence that best combines the original ones.",
                options: [
                    "The market is a great place which sell fresh produce and local crafts.",
                    "The market which sells fresh produce and local crafts is a great place to explore.",
                    "It is a great place to explore which sell fresh produce and local crafts.",
                    "The market is a great place to explore which sell fresh produce and local crafts."
                ],
                correct: 1,
                explanation: {
                    translateQ: "Khu ch·ª£ b√°n n√¥ng s·∫£n t∆∞∆°i v√† ƒë·ªì th·ªß c√¥ng. ƒê√≥ l√† m·ªôt n∆°i tuy·ªát v·ªùi ƒë·ªÉ kh√°m ph√°.",
                    analysis: [
                        "A. Sai ng·ªØ ph√°p ('which sell' - market l√† s·ªë √≠t ph·∫£i l√† 'sells', v·∫£ l·∫°i place d√πng 'where' hay h∆°n)",
                        "B. ...which sells... is a great place... (ƒê√öNG)",
                        "C. Sai ng·ªØ ph√°p (which sell)",
                        "D. Sai ng·ªØ ph√°p (which sell)"
                    ],
                    whyCorrect: "D√πng <b>'which'</b> l√†m ch·ªß ng·ªØ cho m·ªánh ƒë·ªÅ quan h·ªá 'sells fresh produce...', c·∫£ c·ª•m n√†y b·ªï nghƒ©a cho 'The market'.",
                    whyWrong: "C√°c c√¢u kh√°c ƒë·ªÅu sai s·ª± h√≤a h·ª£p ch·ªß ng·ªØ - ƒë·ªông t·ª´ (market - sells)."
                }
            },
            {
                id: 12,
                label: "Ex 4-1",
                question: "The tour includes a visit to a nature reserve where you can see endangered animals.",
                task: "Circle the correct answer which is closest in meaning to the original one.",
                options: [
                    "The tour includes a visit to a nature reserve when you can see endangered animals.",
                    "The tour involving a visit to a nature reserve which you can see endangered animals.",
                    "The tour which includes a visit to a nature reserve where you can see endangered animals.",
                    "The tour involves a trip to a nature reserve where you can see animals at risk."
                ],
                correct: 3,
                explanation: {
                    translateQ: "Chuy·∫øn ƒëi bao g·ªìm chuy·∫øn thƒÉm khu b·∫£o t·ªìn thi√™n nhi√™n n∆°i b·∫°n c√≥ th·ªÉ th·∫•y ƒë·ªông v·∫≠t c√≥ nguy c∆° tuy·ªát ch·ªßng.",
                    analysis: [
                        "A. Sai t·ª´ 'when' (khi) thay v√¨ 'where' (n∆°i)",
                        "B. Sai ng·ªØ ph√°p (Thi·∫øu ƒë·ªông t·ª´ ch√≠nh)",
                        "C. Sai ng·ªØ ph√°p (C·∫£ c√¢u bi·∫øn th√†nh m·ªôt c·ª•m danh t·ª´ d√†i, thi·∫øu ƒë·ªông t·ª´ ch√≠nh)",
                        "D. ...involves a trip... animals at risk (ƒê√öNG)"
                    ],
                    whyCorrect: "Paraphrase (Vi·∫øt l·∫°i c√¢u d√πng t·ª´ ƒë·ªìng nghƒ©a): 'includes a visit' = 'involves a trip', 'endangered animals' = 'animals at risk'.",
                    whyWrong: "A sai t·ª´ quan h·ªá. B v√† C sai c·∫•u tr√∫c c√¢u (Fragment)."
                }
            },
            {
                id: 13,
                label: "Ex 4-2",
                question: "The tour guide in charge introduced the scenic and special points of the areas.",
                task: "Circle the correct answer which is closest in meaning to the original one.",
                options: [
                    "The tour guide who was in charged introduced the scenic and special points of the areas.",
                    "The tour guide whose was in charged will introduce the scenic and special points of the areas.",
                    "The tour guide which was in charged introduced the scenic and special points of the areas.",
                    "The tour guide what was in charged introduced the scenic and special points of the areas."
                ],
                correct: 0,
                explanation: {
                    translateQ: "H∆∞·ªõng d·∫´n vi√™n ph·ª• tr√°ch ƒë√£ gi·ªõi thi·ªáu c√°c ƒëi·ªÉm c·∫£nh quan ƒë·∫∑c bi·ªát.",
                    analysis: [
                        "A. ...who was in charged... (ƒê√öNG: Vi·∫øt l·∫°i c·ª•m danh t·ª´ th√†nh MƒêQH)",
                        "B. Sai ng·ªØ ph√°p (whose was -> sai, will introduce -> sai th√¨)",
                        "C. Sai (Which d√πng cho v·∫≠t)",
                        "D. Sai (What kh√¥ng d√πng l√†m ƒë·∫°i t·ª´ quan h·ªá)"
                    ],
                    whyCorrect: "D√πng <b>'who was in charge'</b> ƒë·ªÉ gi·∫£i th√≠ch r√µ cho c·ª•m 'The tour guide in charge'. (L∆∞u √Ω: ƒê·ªÅ g·ªëc c√≥ l·ªói ch√≠nh t·∫£ 'charged', ƒë√°p √°n gi·ªØ nguy√™n theo ƒë·ªÅ).",
                    whyWrong: "B, C, D sai ƒë·∫°i t·ª´ quan h·ªá ho·∫∑c sai th√¨."
                }
            },
            {
                id: 14,
                label: "Ex 4-3",
                question: "A self-guided tour requiring more time and effort is often selected by the young.",
                task: "Circle the correct answer which is closest in meaning to the original one.",
                options: [
                    "A self-guided tour, who requires more time and effort, is often selected by the young.",
                    "A self-guided tour, where requires more time and effort, is often selected by the young.",
                    "A self-guided tour, which requires more time and effort, is often selected by the young.",
                    "A self-guided tour, that more time and effort, is often selected by the young."
                ],
                correct: 2,
                explanation: {
                    translateQ: "M·ªôt chuy·∫øn du l·ªãch t·ª± t√∫c ƒë√≤i h·ªèi nhi·ªÅu th·ªùi gian v√† c√¥ng s·ª©c th∆∞·ªùng ƒë∆∞·ª£c gi·ªõi tr·∫ª l·ª±a ch·ªçn.",
                    analysis: [
                        "A. Sai (Who d√πng cho ng∆∞·ªùi)",
                        "B. Sai (Where kh√¥ng l√†m ch·ªß ng·ªØ cho ƒë·ªông t·ª´ requires)",
                        "C. ...which requires... (ƒê√öNG)",
                        "D. Sai ng·ªØ ph√°p (Thi·∫øu ƒë·ªông t·ª´)"
                    ],
                    whyCorrect: "Chuy·ªÉn t·ª´ m·ªánh ƒë·ªÅ r√∫t g·ªçn (V-ing: requiring) sang m·ªánh ƒë·ªÅ ƒë·∫ßy ƒë·ªß <b>'which requires'</b>.",
                    whyWrong: "A, B sai ƒë·∫°i t·ª´ quan h·ªá. D sai c·∫•u tr√∫c."
                }
            },
            {
                id: 15,
                label: "Ex 4-4",
                question: "A package tour offering more convenience is more favourable for people lazy to arrange.",
                task: "Circle the correct answer which is closest in meaning to the original one.",
                options: [
                    "A package tour, that offers more convenience, is more favourable for people lazy to arrange.",
                    "A package tour offers more convenience, yet is more favourable for people lazy to arrange.",
                    "A package tour offers more convenience is being more favourable for people lazy to arrange.",
                    "A package tour, which more convenience, is more favourable for people lazy to arrange."
                ],
                correct: 0,
                explanation: {
                    translateQ: "M·ªôt tour tr·ªçn g√≥i cung c·∫•p s·ª± ti·ªán l·ª£i th√¨ thu·∫≠n ti·ªán h∆°n cho ng∆∞·ªùi l∆∞·ªùi s·∫Øp x·∫øp.",
                    analysis: [
                        "A. ...that offers... (ƒê√öNG v·ªÅ nghƒ©a chuy·ªÉn ƒë·ªïi)",
                        "B. Sai nghƒ©a ('yet' = nh∆∞ng/tuy nhi√™n, t·∫°o s·ª± t∆∞∆°ng ph·∫£n v√¥ l√Ω)",
                        "C. Sai ng·ªØ ph√°p (Th·ª´a ƒë·ªông t·ª´ 'is being')",
                        "D. Sai ng·ªØ ph√°p (Thi·∫øu ƒë·ªông t·ª´ trong MƒêQH)"
                    ],
                    whyCorrect: "Chuy·ªÉn 'offering' (V-ing) th√†nh 'that offers' (M·ªánh ƒë·ªÅ quan h·ªá). <br><i>*L∆∞u √Ω: Trong ng·ªØ ph√°p chu·∫©n, 'that' kh√¥ng ƒë·ª©ng sau d·∫•u ph·∫©y, nh∆∞ng ƒë√¢y l√† ƒë√°p √°n t·ªët nh·∫•t trong 4 l·ª±a ch·ªçn c·ªßa b√†i t·∫≠p tr·∫Øc nghi·ªám n√†y.*</i>",
                    whyWrong: "B sai nghƒ©a logic. C v√† D sai ng·ªØ ph√°p nghi√™m tr·ªçng."
                }
            },
            {
                id: 16,
                label: "Ex 4-5",
                question: "Although visitors can reduce stress in a package tour, they have to follow a fixed itinerary.",
                task: "Circle the correct answer which is closest in meaning to the original one.",
                options: [
                    "Despite visitors reducing stress in a package tour, they have to follow a fixed itinerary.",
                    "Despite reducing stress in a package tour, visitors have to follow a fixed itinerary.",
                    "Although reducing stress in a package tour, visitors have to follow a fixed itinerary.",
                    "Visitors can reduce stress in a package tour, despite they have to follow a fixed itinerary."
                ],
                correct: 1,
                explanation: {
                    translateQ: "M·∫∑c d√π du kh√°ch c√≥ th·ªÉ gi·∫£m cƒÉng th·∫≥ng trong tour tr·ªçn g√≥i, h·ªç ph·∫£i tu√¢n theo l·ªãch tr√¨nh c·ªë ƒë·ªãnh.",
                    analysis: [
                        "A. ƒê√∫ng ng·ªØ ph√°p nh∆∞ng l·∫∑p t·ª´ (visitors... they) ch∆∞a hay b·∫±ng B.",
                        "B. Despite reducing stress... (ƒê√öNG: R√∫t g·ªçn ch·ªß ng·ªØ)",
                        "C. Sai ng·ªØ ph√°p (Although th∆∞·ªùng ƒëi v·ªõi m·ªánh ƒë·ªÅ, √≠t khi ƒëi tr·ª±c ti·∫øp V-ing ·ªü ƒë·∫ßu c√¢u nh∆∞ n√†y)",
                        "D. Sai ng·ªØ ph√°p (Despite kh√¥ng ƒëi v·ªõi m·ªánh ƒë·ªÅ S + V)"
                    ],
                    whyCorrect: "C·∫•u tr√∫c: <b>Although S + V -> Despite + V-ing</b> (khi hai v·∫ø c√πng ch·ªß ng·ªØ 'visitors' v√† 'they').",
                    whyWrong: "D l√† l·ªói sai ph·ªï bi·∫øn nh·∫•t (Despite + M·ªánh ƒë·ªÅ). C d√πng sai t·ª´ n·ªëi."
                }
            }
        ];

        // Global State
        let currentQuestions = [];
        let score = 0;
        let answeredCount = 0;

        // Shuffle Function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize Quiz
        function initQuiz() {
            // Shuffle questions but keep track of logic via ID/Label if needed. 
            // Here we clone deep to avoid mutating original structure when we might shuffle options too
            currentQuestions = JSON.parse(JSON.stringify(rawQuestions));
            
            // Optional: Shuffle the Question Order itself? The prompt asked for shuffle algorithm.
            // Let's shuffle questions to prevent rote learning.
            shuffleArray(currentQuestions);

            // Also Shuffle Options for each question?
            // This requires mapping the correct index to the new position.
            currentQuestions.forEach(q => {
                let optionsWithIndex = q.options.map((opt, idx) => ({ txt: opt, originalIdx: idx }));
                shuffleArray(optionsWithIndex);
                q.options = optionsWithIndex.map(o => o.txt);
                // Find new index of the correct answer
                q.correct = optionsWithIndex.findIndex(o => o.originalIdx === q.correct);
            });

            renderQuiz();
            updateScoreDisplay();
        }

        // Render Quiz
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            // Keep the intro card, remove old questions
            const introCard = container.firstElementChild;
            container.innerHTML = '';
            container.appendChild(introCard);

            currentQuestions.forEach((q, index) => {
                const qEl = document.createElement('div');
                qEl.className = 'bg-white rounded-3xl p-6 shadow-card border-2 border-slate-100 relative overflow-hidden transition-all duration-300 hover:shadow-xl';
                qEl.id = `question-${index}`;
                
                // HTML for Options
                let optionsHTML = '';
                q.options.forEach((opt, optIdx) => {
                    optionsHTML += `
                        <button onclick="checkAnswer(${index}, ${optIdx})" 
                            class="btn-option w-full text-left p-4 rounded-xl mb-3 flex items-start gap-3 bg-white text-slate-600 font-semibold text-lg relative group">
                            <div class="w-8 h-8 rounded-full bg-slate-100 flex-shrink-0 flex items-center justify-center font-bold text-slate-400 group-hover:bg-primary group-hover:text-white transition-colors border border-slate-200">
                                ${String.fromCharCode(65 + optIdx)}
                            </div>
                            <span class="pt-0.5">${opt}</span>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 opacity-0 transition-opacity result-icon">
                                <!-- Icons injected via JS -->
                            </div>
                        </button>
                    `;
                });

                // HTML for Explanation (Hidden initially)
                const explanationHTML = `
                    <div id="explanation-${index}" class="hidden mt-6 bg-slate-50 rounded-xl p-5 border-2 border-slate-200 border-dashed animate-[popIn_0.5s_ease-out]">
                        <div class="flex items-center gap-2 mb-3">
                            <img src="https://cdn-icons-png.flaticon.com/512/194/194935.png" class="w-8 h-8 rounded-full border border-slate-300">
                            <span class="font-bold text-primary">C√¥ Mai An gi·∫£i th√≠ch:</span>
                        </div>
                        
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-white rounded-lg border border-indigo-100 shadow-sm">
                                <span class="font-bold text-indigo-500 block mb-1"><i class="fa-solid fa-language mr-1"></i> D·ªãch c√¢u h·ªèi:</span>
                                <p class="text-slate-700 italic">"${q.explanation.translateQ}"</p>
                            </div>
                            
                            <div class="p-3 bg-white rounded-lg border border-orange-100 shadow-sm">
                                <span class="font-bold text-orange-500 block mb-1"><i class="fa-solid fa-list-check mr-1"></i> Ph√¢n t√≠ch ƒë√°p √°n:</span>
                                <ul class="list-none space-y-1 text-slate-600">
                                    ${q.explanation.analysis.map(line => `<li>${line}</li>`).join('')}
                                </ul>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div class="p-3 bg-green-50 rounded-lg border border-green-200">
                                    <span class="font-bold text-green-600 block mb-1"><i class="fa-solid fa-circle-check mr-1"></i> T·∫°i sao ƒê√öNG?</span>
                                    <p class="text-slate-700">${q.explanation.whyCorrect}</p>
                                </div>
                                <div class="p-3 bg-red-50 rounded-lg border border-red-200">
                                    <span class="font-bold text-red-500 block mb-1"><i class="fa-solid fa-circle-xmark mr-1"></i> T·∫°i sao SAI?</span>
                                    <p class="text-slate-700">${q.explanation.whyWrong}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                qEl.innerHTML = `
                    <div class="absolute top-0 right-0 bg-primary text-white text-xs font-bold px-3 py-1 rounded-bl-xl shadow-sm">
                        ${q.label}
                    </div>
                    <div class="mb-5 pr-8">
                        <h3 class="text-lg font-bold text-slate-800 leading-relaxed"><i class="fa-regular fa-circle-question text-primary mr-2"></i>${q.question.replace(/\n/g, '<br>')}</h3>
                        <p class="text-sm text-slate-500 mt-2 font-display italic"><i class="fa-solid fa-pen-nib mr-1"></i>${q.task}</p>
                    </div>
                    
                    <div class="options-container" id="options-${index}">
                        ${optionsHTML}
                    </div>

                    ${explanationHTML}
                `;

                container.appendChild(qEl);
            });
        }

        // Handle Answer
        function checkAnswer(qIndex, optIndex) {
            const container = document.getElementById(`options-${qIndex}`);
            const buttons = container.querySelectorAll('button');
            const qData = currentQuestions[qIndex];

            // Prevent multiple clicks
            if (container.classList.contains('answered')) return;
            container.classList.add('answered');
            answeredCount++;

            const selectedBtn = buttons[optIndex];
            const correctBtn = buttons[qData.correct];
            const questionCard = document.getElementById(`question-${qIndex}`);

            // Logic
            if (optIndex === qData.correct) {
                // Correct
                score++;
                updateScoreDisplay();
                playSound('correct');
                triggerConfetti(selectedBtn);
                
                selectedBtn.classList.add('btn-correct');
                selectedBtn.querySelector('.result-icon').innerHTML = '<i class="fa-solid fa-check text-white text-xl"></i>';
                selectedBtn.querySelector('.result-icon').classList.remove('opacity-0');
            } else {
                // Wrong
                playSound('wrong');
                selectedBtn.classList.add('btn-wrong');
                selectedBtn.querySelector('.result-icon').innerHTML = '<i class="fa-solid fa-xmark text-white text-xl"></i>';
                selectedBtn.querySelector('.result-icon').classList.remove('opacity-0');
                
                // Highlight correct one
                correctBtn.classList.add('btn-correct'); // Or maybe a softer green to show it was the right one? Let's stick to consistent green.
                correctBtn.querySelector('.result-icon').innerHTML = '<i class="fa-solid fa-check text-white text-xl"></i>';
                correctBtn.querySelector('.result-icon').classList.remove('opacity-0');

                // Shake animation
                questionCard.classList.add('shake-anim');
                setTimeout(() => questionCard.classList.remove('shake-anim'), 500);
            }

            // Disable all buttons
            buttons.forEach(btn => btn.classList.add('disabled'));

            // Show Explanation
            document.getElementById(`explanation-${qIndex}`).classList.remove('hidden');
        }

        // Utilities
        function updateScoreDisplay() {
            document.getElementById('score-display').innerText = `${score}/${rawQuestions.length}`;
            document.getElementById('final-score').innerText = `${score}/${rawQuestions.length}`;
        }

        function playSound(type) {
            const audio = document.getElementById(`sound-${type}`);
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Audio play failed interaction required"));
            }
        }

        function triggerConfetti(element) {
            const rect = element.getBoundingClientRect();
            // Calculate position relative to viewport
            const x = (rect.left + rect.width / 2) / window.innerWidth;
            const y = (rect.top + rect.height / 2) / window.innerHeight;

            confetti({
                particleCount: 100,
                spread: 70,
                origin: { x: x, y: y },
                colors: ['#8854C0', '#00C9A7', '#FF4757', '#ffffff']
            });
        }

        function scrollToResult() {
            if (answeredCount < rawQuestions.length) {
                const confirmSubmit = confirm(`B·∫°n m·ªõi l√†m ${answeredCount}/${rawQuestions.length} c√¢u. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i kh√¥ng?`);
                if (!confirmSubmit) return;
            }
            
            // Generate Feedback Message
            const percentage = (score / rawQuestions.length) * 100;
            let message = "";
            if (percentage === 100) message = "Tuy·ªát ƒë·ªëi! B·∫°n l√† thi√™n t√†i Ti·∫øng Anh! üåüüèÜ";
            else if (percentage >= 80) message = "L√†m t·ªët l·∫Øm! Ch·ªâ m·ªôt ch√∫t n·ªØa th√¥i! üî•";
            else if (percentage >= 50) message = "C·ªë g·∫Øng l√™n! √în l·∫°i ki·∫øn th·ª©c nh√©! üìö";
            else message = "ƒê·ª´ng bu·ªìn, h√£y xem k·ªπ l·∫°i gi·∫£i th√≠ch nha! üí™";
            
            document.getElementById('feedback-message').innerText = message;
            
            // Play sound
            if (percentage >= 50) playSound('win');
            
            document.getElementById('result-modal').classList.remove('hidden');
            document.getElementById('result-modal').classList.add('flex');
            triggerConfetti(document.body); // Big confetti
        }

        function closeModal() {
            document.getElementById('result-modal').classList.add('hidden');
            document.getElementById('result-modal').classList.remove('flex');
        }

        function restartQuiz() {
            closeModal();
            score = 0;
            answeredCount = 0;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            initQuiz();
        }

        // Start
        window.onload = initQuiz;

    </script>
</body>
</html>
