<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Gi·ªõi T·ª´ - Ms Mai An ULIS</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Confetti Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #F0F4F8;
            background-image: radial-gradient(#E2E8F0 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        /* Custom Colors & Shadows for Gamification */
        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0px 6px 0px 0px rgba(0,0,0,0.2);
            transform: translateY(0);
        }
        .btn-3d:active {
            transform: translateY(6px);
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.2);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .shake-animation {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Status Colors */
        .correct-bg { background-color: #00D26A !important; border-color: #00B85C !important; color: white !important; }
        .wrong-bg { background-color: #FF4757 !important; border-color: #E03B4B !important; color: white !important; }
        
        .choice-btn {
            border: 2px solid #E2E8F0;
        }
        .choice-btn:hover:not(:disabled) {
            transform: scale(1.02);
            background-color: #EDF2F7;
        }

        /* Explanations */
        .explanation-box {
            display: none;
            border-left: 5px solid #8854C0;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #C4C4C4; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #A0A0A0; 
        }
    </style>
</head>
<body class="min-h-screen text-gray-800 pb-20">

    <!-- Header -->
    <header class="bg-[#8854C0] text-white py-6 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-3xl md:text-4xl font-extrabold font-['Quicksand'] tracking-wide">
                üéì B√ÄI KI·ªÇM TRA GI·ªöI T·ª™
            </h1>
            <p class="text-lg mt-2 opacity-90">Prepositions: In, On, At...</p>
            <div class="mt-2 text-sm font-bold bg-white/20 inline-block px-4 py-1 rounded-full">
                Gi√°o vi√™n: Ms Mai An ULIS
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 mt-8 max-w-4xl">
        
        <!-- Score Board (Sticky Small) -->
        <div class="fixed top-24 right-4 z-40 hidden lg:block">
            <div class="bg-white p-4 rounded-xl shadow-xl border-2 border-purple-100 text-center">
                <p class="text-xs text-gray-500 uppercase font-bold">ƒêi·ªÉm s·ªë</p>
                <p id="live-score" class="text-3xl font-bold text-[#00C9A7]">0/0</p>
            </div>
        </div>

        <div id="quiz-container" class="space-y-8">
            <!-- Questions will be injected here by JS -->
        </div>

        <!-- Submit Button -->
        <div class="mt-12 text-center">
            <button onclick="finishQuiz()" class="btn-3d bg-[#00C9A7] hover:bg-[#00b596] text-white font-bold text-xl py-4 px-12 rounded-2xl shadow-[0_6px_0_#009e86] transition-all transform active:translate-y-1 active:shadow-none w-full md:w-auto">
                üéâ N·ªòP B√ÄI & XEM K·∫æT QU·∫¢
            </button>
        </div>

    </main>

    <!-- Result Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black/60 z-[100] hidden flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full text-center relative pop-in shadow-2xl border-4 border-[#8854C0]">
            <div class="absolute -top-12 left-1/2 transform -translate-x-1/2 bg-[#FFD700] rounded-full p-4 border-4 border-white shadow-lg">
                <span class="text-4xl">üèÜ</span>
            </div>
            <h2 class="text-3xl font-extrabold text-[#8854C0] mt-6 mb-2 font-['Quicksand']">K·∫øt Qu·∫£</h2>
            <p id="final-message" class="text-gray-600 mb-6 font-semibold">B·∫°n ƒë√£ l√†m r·∫•t t·ªët!</p>
            
            <div class="bg-gray-100 rounded-xl p-6 mb-8">
                <div class="text-5xl font-bold text-[#00C9A7] mb-2" id="final-score">0/30</div>
                <div class="text-sm text-gray-500 font-bold uppercase tracking-wider">C√¢u tr·∫£ l·ªùi ƒë√∫ng</div>
            </div>

            <button onclick="closeModal()" class="w-full btn-3d bg-[#FF4757] text-white font-bold py-3 rounded-xl shadow-[0_4px_0_#d63030]">
                Xem l·∫°i b√†i l√†m
            </button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="sound-correct" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>
    <audio id="sound-wrong" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" preload="auto"></audio>
    <audio id="sound-finish" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

    <script>
        // --- DATA ---
        const quizData = {
            "questions": [
                {
                    "questionNumber": 1,
                    "question": "Ex 4 - Q1: Are you (at/ in) school now?",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> B√¢y gi·ªù b·∫°n c√≥ ƒëang <b>·ªü</b> tr∆∞·ªùng kh√¥ng?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at school</b>: ·ªü tr∆∞·ªùng (ch·ªâ v·ªã tr√≠ ƒë·ªãa ƒëi·ªÉm chung ho·∫∑c ƒëang tham gia ho·∫°t ƒë·ªông t·∫°i tr∆∞·ªùng).<br>- <b>in school</b>: ƒëang ƒëi h·ªçc (ch·ªâ t√¨nh tr·∫°ng l√† h·ªçc sinh/sinh vi√™n, kh√¥ng nh·∫•t thi·∫øt ƒëang ·ªü v·ªã tr√≠ tr∆∞·ªùng).<br><br><b>Gi·∫£i th√≠ch:</b> Trong ng·ªØ c·∫£nh h·ªèi v·ªã tr√≠ hi·ªán t·∫°i 'now', 'at school' l√† c√°ch d√πng ch√≠nh x√°c nh·∫•t ƒë·ªÉ h·ªèi ai ƒë√≥ c√≥ ƒëang hi·ªán di·ªán ·ªü ƒë·ªãa ƒëi·ªÉm tr∆∞·ªùng h·ªçc hay kh√¥ng." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'In school' th∆∞·ªùng d√πng ƒë·ªÉ n√≥i v·ªÅ vi·ªác ai ƒë√≥ ƒëang ·ªü ƒë·ªô tu·ªïi ƒëi h·ªçc ho·∫∑c l√† h·ªçc sinh, √≠t d√πng ƒë·ªÉ ch·ªâ v·ªã tr√≠ c·ª• th·ªÉ ngay l√∫c n√†y." }
                    ]
                },
                {
                    "questionNumber": 2,
                    "question": "Ex 4 - Q2: The spaghetti is (for/ on) lunch.",
                    "answerOptions": [
                        { "text": "for", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> M√≥n m√¨ √ù l√† <b>cho</b> b·ªØa tr∆∞a.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>for lunch/dinner/breakfast</b>: cho b·ªØa tr∆∞a/t·ªëi/s√°ng (ch·ªâ m·ª•c ƒë√≠ch).<br>- <b>on</b>: tr√™n (ch·ªâ v·ªã tr√≠ b·ªÅ m·∫∑t).<br><br><b>Gi·∫£i th√≠ch:</b> D√πng gi·ªõi t·ª´ 'for' ƒë·ªÉ ch·ªâ m·ª•c ƒë√≠ch m√≥n ƒÉn d√†nh cho b·ªØa n√†o." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On lunch' kh√¥ng c√≥ nghƒ©a. Ta c√≥ th·ªÉ n√≥i 'on the table' (tr√™n b√†n) nh∆∞ng kh√¥ng n√≥i m√≥n ƒÉn 'tr√™n b·ªØa tr∆∞a'." }
                    ]
                },
                {
                    "questionNumber": 3,
                    "question": "Ex 4 - Q3: She can‚Äôt soak (in/ under) the water for too long.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> C√¥ ·∫•y kh√¥ng th·ªÉ ng√¢m m√¨nh <b>trong</b> n∆∞·ªõc qu√° l√¢u.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>soak in water</b>: ng√¢m m√¨nh trong n∆∞·ªõc.<br>- <b>under</b>: ·ªü b√™n d∆∞·ªõi.<br><br><b>Gi·∫£i th√≠ch:</b> 'In the water' di·ªÖn t·∫£ tr·∫°ng th√°i c∆° th·ªÉ ƒë∆∞·ª£c bao b·ªçc b·ªüi n∆∞·ªõc xung quanh." },
                        { "text": "under", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'Under water' l√† l·∫∑n h·∫≥n xu·ªëng d∆∞·ªõi m·∫∑t n∆∞·ªõc, c√≤n h√†nh ƒë·ªông 'soak' (ng√¢m) th∆∞·ªùng d√πng v·ªõi gi·ªõi t·ª´ 'in'." }
                    ]
                },
                {
                    "questionNumber": 4,
                    "question": "Ex 4 - Q4: He came and sat (between/ next to) me.",
                    "answerOptions": [
                        { "text": "next to", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Anh ·∫•y ƒë·∫øn v√† ng·ªìi <b>b√™n c·∫°nh</b> t√¥i.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>next to + O</b>: b√™n c·∫°nh ai/c√°i g√¨.<br>- <b>between</b>: gi·ªØa (th∆∞·ªùng ƒëi v·ªõi c·∫•u tr√∫c 'between A and B').<br><br><b>Gi·∫£i th√≠ch:</b> ·ªû ƒë√¢y ch·ªâ c√≥ 1 t√¢n ng·ªØ 'me', kh√¥ng c√≥ ƒë·ªëi t∆∞·ª£ng th·ª© 2 ƒë·ªÉ k·∫πp gi·ªØa, n√™n d√πng 'next to'." },
                        { "text": "between", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'Between' c·∫ßn √≠t nh·∫•t 2 ƒë·ªëi t∆∞·ª£ng ho·∫∑c danh t·ª´ s·ªë nhi·ªÅu (V√≠ d·ª•: between us, between Lan and Mai)." }
                    ]
                },
                {
                    "questionNumber": 5,
                    "question": "Ex 4 - Q5: Is her house (between/ behind) Van Lang University?",
                    "answerOptions": [
                        { "text": "behind", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Nh√† c√¥ ·∫•y c√≥ ph·∫£i ·ªü <b>ph√≠a sau</b> ƒê·∫°i h·ªçc VƒÉn Lang kh√¥ng?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>behind + ƒë·ªãa ƒëi·ªÉm</b>: ·ªü ph√≠a sau.<br>- <b>between</b>: ·ªü gi·ªØa.<br><br><b>Gi·∫£i th√≠ch:</b> Ch·ªâ c√≥ 1 ƒë·ªãa ƒëi·ªÉm l√†m m·ªëc l√† 'Van Lang University', n√™n d√πng 'behind'. N·∫øu d√πng 'between' ph·∫£i c√≥ 2 ƒë·ªãa ƒëi·ªÉm." },
                        { "text": "between", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Thi·∫øu ƒë·ªãa ƒëi·ªÉm th·ª© 2 ƒë·ªÉ t·∫°o th√†nh c·∫•u tr√∫c '·ªü gi·ªØa'." }
                    ]
                },
                {
                    "questionNumber": 6,
                    "question": "Ex 4 - Q6: She twirled around (under/ in front of) the mirror.",
                    "answerOptions": [
                        { "text": "in front of", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> C√¥ ·∫•y xoay v√≤ng <b>tr∆∞·ªõc</b> g∆∞∆°ng.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in front of</b>: ·ªü ph√≠a tr∆∞·ªõc.<br>- <b>under</b>: ·ªü b√™n d∆∞·ªõi.<br><br><b>Gi·∫£i th√≠ch:</b> H√†nh ƒë·ªông soi g∆∞∆°ng ho·∫∑c ng·∫Øm m√¨nh trong g∆∞∆°ng th√¨ ph·∫£i ƒë·ª©ng 'tr∆∞·ªõc' g∆∞∆°ng." },
                        { "text": "under", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'Under the mirror' nghƒ©a l√† chui xu·ªëng g·∫ßm g∆∞∆°ng, kh√¥ng h·ª£p l√Ω v·ªõi ng·ªØ c·∫£nh xoay v√≤ng ng·∫Øm ngh√≠a." }
                    ]
                },
                {
                    "questionNumber": 7,
                    "question": "Ex 4 - Q7: We often play basketball (at/ in) break time.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ch√∫ng t√¥i th∆∞·ªùng ch∆°i b√≥ng r·ªï <b>v√†o</b> gi·ªù gi·∫£i lao.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at break time / at lunchtime</b>: v√†o gi·ªù ngh·ªâ/gi·ªù tr∆∞a.<br><br><b>Gi·∫£i th√≠ch:</b> ƒê√¢y l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh ch·ªâ th·ªùi ƒëi·ªÉm c·ª• th·ªÉ trong ng√†y." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Kh√¥ng d√πng 'in break time'. Ta c√≥ th·ªÉ d√πng 'in the break' nh∆∞ng ph·ªï bi·∫øn nh·∫•t l√† 'at break time'." }
                    ]
                },
                {
                    "questionNumber": 8,
                    "question": "Ex 4 - Q8: I think smart phones will change (on/ in) ten years.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> T√¥i nghƒ© ƒëi·ªán tho·∫°i th√¥ng minh s·∫Ω thay ƒë·ªïi <b>trong v√≤ng</b> m∆∞·ªùi nƒÉm n·ªØa.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in + kho·∫£ng th·ªùi gian</b>: d√πng cho th√¨ t∆∞∆°ng lai ƒë·ªÉ ch·ªâ 'trong bao l√¢u n·ªØa'.<br><br><b>Gi·∫£i th√≠ch:</b> ƒê·ªÉ di·ªÖn t·∫£ s·ª± vi·ªác s·∫Ω x·∫£y ra sau m·ªôt kho·∫£ng th·ªùi gian trong t∆∞∆°ng lai, ta d√πng gi·ªõi t·ª´ 'in'." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On' th∆∞·ªùng d√πng cho ng√†y, th·ª©, ho·∫∑c b·ªÅ m·∫∑t, kh√¥ng d√πng cho kho·∫£ng th·ªùi gian t∆∞∆°ng lai." }
                    ]
                },
                {
                    "questionNumber": 9,
                    "question": "Ex 4 - Q9: My room is (behind/ between) Lan‚Äôs and Mai‚Äôs.",
                    "answerOptions": [
                        { "text": "between", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ph√≤ng t√¥i n·∫±m <b>gi·ªØa</b> ph√≤ng c·ªßa Lan v√† ph√≤ng c·ªßa Mai.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>between A and B</b>: gi·ªØa A v√† B.<br><br><b>Gi·∫£i th√≠ch:</b> C√≥ 2 ƒë·ªëi t∆∞·ª£ng x√°c ƒë·ªãnh l√† 'Lan's' (ph√≤ng Lan) v√† 'Mai's' (ph√≤ng Mai), n√™n d√πng 'between' l√† ch√≠nh x√°c." },
                        { "text": "behind", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'Behind' nghƒ©a l√† ph√≠a sau, n·∫øu d√πng 'behind' th∆∞·ªùng kh√¥ng ƒëi v·ªõi c·∫•u tr√∫c 'and' li·ªát k√™ 2 b√™n nh∆∞ v·∫≠y." }
                    ]
                },
                {
                    "questionNumber": 10,
                    "question": "Ex 4 - Q10: Can you find that small village (on/ at) the map?",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> B·∫°n c√≥ th·ªÉ t√¨m th·∫•y ng√¥i l√†ng nh·ªè ƒë√≥ <b>tr√™n</b> b·∫£n ƒë·ªì kh√¥ng?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on the map</b>: tr√™n b·∫£n ƒë·ªì.<br><br><b>Gi·∫£i th√≠ch:</b> B·∫£n ƒë·ªì ƒë∆∞·ª£c xem l√† m·ªôt b·ªÅ m·∫∑t ph·∫≥ng, n√™n ta d√πng gi·ªõi t·ª´ 'on'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'At the map' th∆∞·ªùng ch·ªâ v·ªã tr√≠ ng∆∞·ªùi ƒë·ª©ng t·∫°i ch·ªó t·∫•m b·∫£n ƒë·ªì treo t∆∞·ªùng, kh√¥ng d√πng ƒë·ªÉ ch·ªâ th√¥ng tin in 'tr√™n' b·∫£n ƒë·ªì." }
                    ]
                },
                {
                    "questionNumber": 11,
                    "question": "Ex 4 - Q11: She is doing yoga (on/ at) the club.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> C√¥ ·∫•y ƒëang t·∫≠p yoga <b>t·∫°i</b> c√¢u l·∫°c b·ªô.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at the club</b>: t·∫°i c√¢u l·∫°c b·ªô (ƒë·ªãa ƒëi·ªÉm/t·ªï ch·ª©c).<br><br><b>Gi·∫£i th√≠ch:</b> D√πng 'at' ƒë·ªÉ ch·ªâ m·ªôt ƒë·ªãa ƒëi·ªÉm, ƒëi·ªÉm ƒë·∫øn c·ª• th·ªÉ cho m·ªôt ho·∫°t ƒë·ªông." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On the club' nghƒ©a l√† ·ªü tr√™n n√≥c c√¢u l·∫°c b·ªô, kh√¥ng h·ª£p l√Ω." }
                    ]
                },
                {
                    "questionNumber": 12,
                    "question": "Ex 4 - Q12: The math finished (at/ on) 3 o‚Äôclock.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ti·∫øt to√°n k·∫øt th√∫c <b>l√∫c</b> 3 gi·ªù.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at + gi·ªù c·ª• th·ªÉ</b> (at 3 o'clock, at 5pm).<br><br><b>Gi·∫£i th√≠ch:</b> Quy t·∫Øc c∆° b·∫£n: Gi·ªù d√πng AT, Ng√†y d√πng ON, Th√°ng/NƒÉm d√πng IN." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On' d√πng cho ng√†y (on Monday, on May 1st), kh√¥ng d√πng cho gi·ªù." }
                    ]
                },
                {
                    "questionNumber": 13,
                    "question": "Ex 4 - Q13: Her brother learned English (in/ at) the USA.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Anh trai c√¥ ·∫•y ƒë√£ h·ªçc ti·∫øng Anh <b>·ªü</b> M·ªπ.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in + ƒë·∫•t n∆∞·ªõc/th√†nh ph·ªë</b>.<br><br><b>Gi·∫£i th√≠ch:</b> USA (M·ªπ) l√† m·ªôt qu·ªëc gia, kh√¥ng gian r·ªông l·ªõn n√™n d√πng 'in'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'At' d√πng cho ƒë·ªãa ƒëi·ªÉm nh·ªè, c·ª• th·ªÉ (s√¢n bay, tr∆∞·ªùng h·ªçc), kh√¥ng d√πng cho t√™n qu·ªëc gia." }
                    ]
                },
                {
                    "questionNumber": 14,
                    "question": "Ex 4 - Q14: He is watching a movie with his girlfriend (at/ in) the moment.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Anh ·∫•y ƒëang xem phim v·ªõi b·∫°n g√°i <b>v√†o l√∫c n√†y</b>.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at the moment</b> = now (ngay b√¢y gi·ªù).<br><br><b>Gi·∫£i th√≠ch:</b> ƒê√¢y l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh (Fixed Expression/Idiom)." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'In a moment' nghƒ©a l√† 'trong ch·ªëc l√°t n·ªØa' (t∆∞∆°ng lai g·∫ßn), nh∆∞ng c·ª•m t·ª´ ph·ªï bi·∫øn ch·ªâ hi·ªán t·∫°i ti·∫øp di·ªÖn l√† 'at the moment'." }
                    ]
                },
                {
                    "questionNumber": 15,
                    "question": "Ex 4 - Q15: My clothes aren‚Äôt (in/ on) the sofa. Where are they?",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Qu·∫ßn √°o c·ªßa t√¥i kh√¥ng c√≥ ·ªü <b>tr√™n</b> gh·∫ø sofa. Ch√∫ng ƒë√¢u r·ªìi?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on the sofa</b>: tr√™n b·ªÅ m·∫∑t gh·∫ø sofa.<br><br><b>Gi·∫£i th√≠ch:</b> Qu·∫ßn √°o th∆∞·ªùng ƒë∆∞·ª£c ƒë·∫∑t/v·ª©t l√™n tr√™n m·∫∑t gh·∫ø." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> D√πng 'in the sofa' khi v·∫≠t g√¨ ƒë√≥ b·ªã k·∫πt v√†o khe gh·∫ø ho·∫∑c gh·∫ø c√≥ ngƒÉn ch·ª©a ƒë·ªì b√™n trong, √≠t ph·ªï bi·∫øn v·ªõi qu·∫ßn √°o ƒë·ªÉ b√¨nh th∆∞·ªùng." }
                    ]
                },
                {
                    "questionNumber": 16,
                    "question": "Ex 4 - Q16: What happened (at/ on) your school yesterday morning?",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Chuy·ªán g√¨ ƒë√£ x·∫£y ra <b>·ªü</b> tr∆∞·ªùng b·∫°n s√°ng h√¥m qua v·∫≠y?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at school</b>: ·ªü tr∆∞·ªùng (ƒë·ªãa ƒëi·ªÉm).<br><br><b>Gi·∫£i th√≠ch:</b> School ƒë∆∞·ª£c xem l√† m·ªôt ƒëi·ªÉm ƒë·∫øn/ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ n√™n d√πng 'at'." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On' kh√¥ng d√πng cho school tr·ª´ khi n√≥i 'on the school roof' (tr√™n m√°i tr∆∞·ªùng)." }
                    ]
                },
                {
                    "questionNumber": 17,
                    "question": "Ex 4 - Q17: We will have a big party (on/ in) our wedding day.",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ch√∫ng t√¥i s·∫Ω c√≥ m·ªôt b·ªØa ti·ªác l·ªõn <b>v√†o</b> ng√†y c∆∞·ªõi.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on + Day/Date</b> (ng√†y).<br><br><b>Gi·∫£i th√≠ch:</b> V√¨ c√≥ t·ª´ 'day' (ng√†y) n√™n b·∫Øt bu·ªôc d√πng gi·ªõi t·ª´ 'on'." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'In' d√πng cho th√°ng, nƒÉm, m√πa, bu·ªïi (in the morning), kh√¥ng d√πng cho m·ªôt ng√†y c·ª• th·ªÉ." }
                    ]
                },
                {
                    "questionNumber": 18,
                    "question": "Ex 4 - Q18: He was born (in/ at) the spring of 2012.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> C·∫≠u ·∫•y sinh <b>v√†o</b> m√πa xu√¢n nƒÉm 2012.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in + m√πa</b> (in spring, in summer...).<br><br><b>Gi·∫£i th√≠ch:</b> Spring (m√πa xu√¢n) l√† m·ªôt m√πa trong nƒÉm, d√πng gi·ªõi t·ª´ 'in'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'At' kh√¥ng d√πng cho m√πa." }
                    ]
                },
                {
                    "questionNumber": 19,
                    "question": "Ex 4 - Q19: We don‚Äôt have maths (on/ in) Tuesdays and Fridays.",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ch√∫ng t√¥i kh√¥ng c√≥ m√¥n to√°n <b>v√†o</b> c√°c ng√†y th·ª© Ba v√† th·ª© S√°u.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on + Th·ª© trong tu·∫ßn</b>.<br><br><b>Gi·∫£i th√≠ch:</b> Tuesdays, Fridays l√† c√°c th·ª© trong tu·∫ßn, quy t·∫Øc b·∫Øt bu·ªôc d√πng 'on'." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai quy t·∫Øc ng·ªØ ph√°p c∆° b·∫£n." }
                    ]
                },
                {
                    "questionNumber": 20,
                    "question": "Ex 4 - Q20: His graduation party is held (on/ at) a restaurant (in/ on) District 1.",
                    "answerOptions": [
                        { "text": "at / in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Ti·ªác t·ªët nghi·ªáp c·ªßa anh ·∫•y ƒë∆∞·ª£c t·ªï ch·ª©c <b>t·∫°i</b> m·ªôt nh√† h√†ng <b>·ªü</b> Qu·∫≠n 1.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at a restaurant</b>: t·∫°i m·ªôt ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ.<br>- <b>in District 1</b>: trong m·ªôt qu·∫≠n (khu v·ª±c h√†nh ch√≠nh r·ªông).<br><br><b>Gi·∫£i th√≠ch:</b> V·ªã tr√≠ 1 l√† ƒëi·ªÉm c·ª• th·ªÉ -> At. V·ªã tr√≠ 2 l√† khu v·ª±c -> In." },
                        { "text": "on / at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On a restaurant' sai (tr√™n nh√† h√†ng). 'At District 1' sai (Qu·∫≠n l√† v√πng r·ªông, d√πng In)." }
                    ]
                },
                {
                    "questionNumber": 21,
                    "question": "Ex 5 - Q1: They were __________________ home yesterday.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> H·ªç ƒë√£ <b>·ªü</b> nh√† ng√†y h√¥m qua.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at home</b>: ·ªü nh√†.<br><br><b>Gi·∫£i th√≠ch:</b> ƒê√¢y l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh ch·ªâ v·ªã tr√≠ t·∫°i gia ƒë√¨nh." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Kh√¥ng d√πng 'in home'." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Kh√¥ng d√πng 'on home'." }
                    ]
                },
                {
                    "questionNumber": 22,
                    "question": "Ex 5 - Q2: Her caf√© is __________________ the end of the street.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Qu√°n c√† ph√™ c·ªßa c√¥ ·∫•y ·ªü <b>cu·ªëi</b> ph·ªë.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at the end of...</b>: ·ªü ph·∫ßn cu·ªëi c·ªßa c√°i g√¨ ƒë√≥.<br><br><b>Gi·∫£i th√≠ch:</b> C·ª•m t·ª´ ch·ªâ v·ªã tr√≠ ƒëi·ªÉm cu·ªëi c√πng c·ªßa con ƒë∆∞·ªùng." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'In the end' mang nghƒ©a l√† 'cu·ªëi c√πng th√¨' (ch·ªâ k·∫øt qu·∫£), kh√¥ng ch·ªâ v·ªã tr√≠ ƒë·ªãa l√Ω." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai c·∫•u tr√∫c." }
                    ]
                },
                {
                    "questionNumber": 23,
                    "question": "Ex 5 - Q3: Can you see the green hat __________________ that shelf?",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> B·∫°n c√≥ th·∫•y c√°i m≈© xanh <b>tr√™n</b> c√°i k·ªá kia kh√¥ng?<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on the shelf</b>: tr√™n k·ªá.<br><br><b>Gi·∫£i th√≠ch:</b> K·ªá (shelf) l√† m·ªôt b·ªÅ m·∫∑t ƒë·ªÉ ƒë·ªì v·∫≠t l√™n tr√™n -> D√πng 'on'." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> D√πng 'in' n·∫øu l√† t·ªß c√≥ c·ª≠a ƒë√≥ng k√≠n ho·∫∑c h·ªôc t·ªß." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai gi·ªõi t·ª´." }
                    ]
                },
                {
                    "questionNumber": 24,
                    "question": "Ex 5 - Q4: Mary lives __________________ Ho Chi Minh City.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Mary s·ªëng <b>·ªü</b> TP. H·ªì Ch√≠ Minh.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in + Th√†nh ph·ªë l·ªõn/ƒê·∫•t n∆∞·ªõc</b>.<br><br><b>Gi·∫£i th√≠ch:</b> TP.HCM l√† m·ªôt th√†nh ph·ªë l·ªõn, d√πng gi·ªõi t·ª´ 'in'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'At' d√πng cho ƒë·ªãa ch·ªâ nh√† c·ª• th·ªÉ (c√≥ s·ªë nh√†)." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'On' d√πng cho t√™n ƒë∆∞·ªùng (kh√¥ng c√≥ s·ªë nh√†)." }
                    ]
                },
                {
                    "questionNumber": 25,
                    "question": "Ex 5 - Q5: I often surf the Internet when I‚Äôm __________________ the bus.",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> T√¥i th∆∞·ªùng l∆∞·ªõt web khi ·ªü <b>tr√™n</b> xe bu√Ωt.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on the bus/train/plane</b>: tr√™n xe bu√Ωt/t√†u/m√°y bay.<br><br><b>Gi·∫£i th√≠ch:</b> V·ªõi c√°c ph∆∞∆°ng ti·ªán c√¥ng c·ªông l·ªõn, c√≥ s√†n ƒë·ªÉ ƒëi l·∫°i, ta d√πng 'on'." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> 'In' d√πng cho ph∆∞∆°ng ti·ªán c√° nh√¢n nh·ªè, ph·∫£i c√∫i ng∆∞·ªùi khi v√†o nh∆∞ 'in the car', 'in a taxi'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai gi·ªõi t·ª´." }
                    ]
                },
                {
                    "questionNumber": 26,
                    "question": "Ex 5 - Q6: My family were __________________ Canada last summer.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Gia ƒë√¨nh t√¥i ƒë√£ ·ªü Canada m√πa h√® nƒÉm ngo√°i.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in + ƒê·∫•t n∆∞·ªõc</b>.<br><br><b>Gi·∫£i th√≠ch:</b> Canada l√† qu·ªëc gia -> D√πng 'in'." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." }
                    ]
                },
                {
                    "questionNumber": 27,
                    "question": "Ex 5 - Q7: Turn right and the supermarket is __________________ the left.",
                    "answerOptions": [
                        { "text": "on", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> R·∫Ω ph·∫£i v√† si√™u th·ªã n·∫±m ·ªü <b>b√™n</b> tr√°i.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>on the left/right</b>: ·ªü b√™n tr√°i/ph·∫£i.<br><br><b>Gi·∫£i th√≠ch:</b> C·ª•m t·ª´ ch·ªâ ph∆∞∆°ng h∆∞·ªõng c·ªë ƒë·ªãnh." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." }
                    ]
                },
                {
                    "questionNumber": 28,
                    "question": "Ex 5 - Q8: All the stories __________________ the book are very interesting.",
                    "answerOptions": [
                        { "text": "in", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> T·∫•t c·∫£ nh·ªØng c√¢u chuy·ªán <b>trong</b> cu·ªën s√°ch ƒë·ªÅu r·∫•t th√∫ v·ªã.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>in the book</b>: trong s√°ch (ch·ªâ n·ªôi dung b√™n trong).<br><br><b>Gi·∫£i th√≠ch:</b> C√¢u chuy·ªán n·∫±m ch·ª©a ƒë·ª±ng b√™n trong cu·ªën s√°ch." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> D√πng 'on the book' n·∫øu n√≥i v·ªÅ v·∫≠t g√¨ ƒë·∫∑t tr√™n b√¨a s√°ch (v√≠ d·ª•: b·ª•i, c√°i b√∫t)." },
                        { "text": "at", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." }
                    ]
                },
                {
                    "questionNumber": 29,
                    "question": "Ex 5 - Q9: She was __________________ the airport one hour ago.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> C√¥ ·∫•y ƒë√£ ·ªü s√¢n bay m·ªôt gi·ªù tr∆∞·ªõc.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at the airport</b>: t·∫°i s√¢n bay.<br><br><b>Gi·∫£i th√≠ch:</b> S√¢n bay l√† m·ªôt ƒëi·ªÉm trung chuy·ªÉn/ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ, d√πng 'at'." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> √çt d√πng, tr·ª´ khi mu·ªën nh·∫•n m·∫°nh ƒëang ·ªü b√™n trong t√≤a nh√† ga (inside the terminal)." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." }
                    ]
                },
                {
                    "questionNumber": 30,
                    "question": "Ex 5 - Q10: He works __________________ 58 Hai Ba Trung street.",
                    "answerOptions": [
                        { "text": "at", "isCorrect": true, "rationale": "<b>D·ªãch nghƒ©a:</b> Anh ·∫•y l√†m vi·ªác <b>t·∫°i</b> s·ªë 58 ƒë∆∞·ªùng Hai B√† Tr∆∞ng.<br><br><b>Ph√¢n t√≠ch:</b><br>- <b>at + S·ªë nh√† + T√™n ƒë∆∞·ªùng</b>.<br><br><b>Gi·∫£i th√≠ch:</b> V√¨ c√≥ s·ªë nh√† c·ª• th·ªÉ (58) n√™n d√πng 'at'." },
                        { "text": "on", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> D√πng 'on + T√™n ƒë∆∞·ªùng' khi KH√îNG c√≥ s·ªë nh√† (Ex: on Hai Ba Trung street)." },
                        { "text": "in", "isCorrect": false, "rationale": "<b>T·∫°i sao SAI:</b> Sai." }
                    ]
                }
            ]
        };

        // --- GAME STATE ---
        let currentScore = 0;
        const totalQuestions = quizData.questions.length;
        const soundCorrect = document.getElementById('sound-correct');
        const soundWrong = document.getElementById('sound-wrong');
        const soundFinish = document.getElementById('sound-finish');

        // --- RENDER LOGIC ---
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            
            quizData.questions.forEach((q, index) => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-2xl p-6 md:p-8 card-shadow border-2 border-transparent hover:border-purple-100 transition-all relative overflow-hidden";
                card.id = `card-${index}`;

                // Question Header
                const header = document.createElement('div');
                header.className = "flex items-start gap-4 mb-6";
                
                const qNum = document.createElement('div');
                qNum.className = "flex-shrink-0 w-10 h-10 md:w-12 md:h-12 bg-[#8854C0] text-white rounded-full flex items-center justify-center font-bold text-lg md:text-xl shadow-md";
                qNum.innerText = q.questionNumber;

                const qText = document.createElement('h3');
                qText.className = "text-lg md:text-2xl font-bold text-gray-800 leading-snug pt-1";
                qText.innerHTML = q.question; // Allow HTML just in case

                header.appendChild(qNum);
                header.appendChild(qText);
                card.appendChild(header);

                // Answer Options Container
                const optionsGrid = document.createElement('div');
                optionsGrid.className = "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6";

                q.answerOptions.forEach((opt, optIndex) => {
                    const btn = document.createElement('button');
                    btn.className = `choice-btn btn-3d w-full py-4 px-6 rounded-xl text-left font-bold text-lg text-gray-700 bg-white transition-all`;
                    btn.innerText = opt.text;
                    btn.setAttribute('data-q-index', index);
                    btn.setAttribute('data-is-correct', opt.isCorrect);
                    
                    // Click Event
                    btn.onclick = (e) => handleAnswerClick(e, btn, index, opt.isCorrect, q);
                    
                    optionsGrid.appendChild(btn);
                });

                card.appendChild(optionsGrid);

                // Explanation Box (Hidden initially)
                const explanation = document.createElement('div');
                explanation.id = `explanation-${index}`;
                explanation.className = "explanation-box bg-purple-50 p-5 rounded-r-xl text-gray-700 text-base md:text-lg leading-relaxed shadow-inner mt-4";
                
                // Content will be injected when answered to keep DOM light initially or standard text
                // Actually we can inject it now but hide it.
                // Find the correct rationale
                const correctOpt = q.answerOptions.find(o => o.isCorrect);
                let explanationHTML = `<div class="font-bold text-[#8854C0] mb-2 uppercase text-sm tracking-widest">üìù Gi·∫£i th√≠ch chi ti·∫øt c·ªßa C√¥ Mai An:</div>`;
                
                // Combine correct rationale and basic info
                explanationHTML += correctOpt.rationale;
                
                explanation.innerHTML = explanationHTML;
                card.appendChild(explanation);

                container.appendChild(card);
            });

            // Update Score Display
            updateScoreBoard();
        }

        // --- INTERACTION HANDLERS ---
        function handleAnswerClick(e, btn, index, isCorrect, questionData) {
            // Prevent multiple clicks on the same question
            const card = document.getElementById(`card-${index}`);
            const buttons = card.querySelectorAll('button');
            
            // If already answered, do nothing
            if (card.getAttribute('data-answered') === 'true') return;

            // Mark as answered
            card.setAttribute('data-answered', 'true');
            buttons.forEach(b => b.disabled = true); // Disable all buttons

            // Reveal correctness
            if (isCorrect) {
                btn.classList.add('correct-bg');
                btn.innerHTML += ' <span class="float-right">‚ú®</span>';
                playSound(soundCorrect);
                fireConfetti(btn);
                currentScore++;
            } else {
                btn.classList.add('wrong-bg', 'shake-animation');
                btn.innerHTML += ' <span class="float-right">üò¢</span>';
                playSound(soundWrong);
                
                // Highlight the correct answer
                buttons.forEach(b => {
                    if (b.getAttribute('data-is-correct') === 'true') {
                        b.classList.add('correct-bg', 'opacity-75'); // Dim correct one slightly to focus on user error? No, highlight it properly.
                        b.classList.remove('opacity-75');
                        b.style.border = "2px solid #00D26A";
                    }
                });
            }

            updateScoreBoard();

            // Show Explanation with animation
            const expBox = document.getElementById(`explanation-${index}`);
            expBox.style.display = 'block';
            expBox.classList.add('pop-in');
        }

        function playSound(audio) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Audio play failed interaction required"));
        }

        function fireConfetti(element) {
            const rect = element.getBoundingClientRect();
            // Normalize coordinates to 0-1 range for confetti
            const x = (rect.left + rect.width / 2) / window.innerWidth;
            const y = (rect.top + rect.height / 2) / window.innerHeight;

            confetti({
                particleCount: 60,
                spread: 70,
                origin: { x: x, y: y },
                colors: ['#00C9A7', '#8854C0', '#FFD700'],
                disableForReducedMotion: true
            });
        }

        function updateScoreBoard() {
            document.getElementById('live-score').innerText = `${currentScore}/${totalQuestions}`;
        }

        function finishQuiz() {
            const modal = document.getElementById('result-modal');
            const scoreText = document.getElementById('final-score');
            const message = document.getElementById('final-message');
            
            scoreText.innerText = `${currentScore}/${totalQuestions}`;
            
            const percentage = (currentScore / totalQuestions) * 100;
            
            if (percentage === 100) {
                message.innerText = "Xu·∫•t s·∫Øc! B·∫°n l√† thi√™n t√†i gi·ªõi t·ª´! üåü";
                playSound(soundFinish);
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (percentage >= 80) {
                message.innerText = "Gi·ªèi l·∫Øm! Ch·ªâ sai m·ªôt x√≠u th√¥i! üí™";
                playSound(soundFinish);
            } else if (percentage >= 50) {
                message.innerText = "C·ªë g·∫Øng th√™m nh√©! H√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch! üìö";
            } else {
                message.innerText = "ƒê·ª´ng bu·ªìn! L√†m l·∫°i ƒë·ªÉ nh·ªõ l√¢u h∆°n nh√©! üî•";
            }

            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('result-modal').classList.add('hidden');
        }

        // Initialize
        window.onload = renderQuiz;

    </script>
</body>
</html>
