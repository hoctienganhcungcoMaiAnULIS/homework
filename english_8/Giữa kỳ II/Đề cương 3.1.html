<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --yellow: #FFC312;
            --bg-card: #ffffff;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #fdf6e3;
            /* H·ªça ti·∫øt vui nh·ªôn ch·∫•m bi b·∫±ng CSS thu·∫ßn */
            background-image: 
                radial-gradient(var(--secondary) 2px, transparent 2px),
                radial-gradient(var(--primary) 2px, transparent 2px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.15);
            margin-bottom: 30px;
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header h3 {
            margin: 5px 0 0 0;
            font-size: 16px;
            font-weight: 700;
            opacity: 0.9;
        }

        #quiz-container {
            width: 100%;
            max-width: 800px;
        }

        .question-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 0 rgba(0,0,0,0.05);
            border: 2px solid #eaeaea;
            transition: transform 0.3s;
        }

        .question-card:hover {
            transform: translateY(-5px);
        }

        .instruction {
            font-style: italic;
            color: #666;
            margin-bottom: 15px;
            font-size: 15px;
            border-left: 4px solid var(--yellow);
            padding-left: 10px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #e5e5e5;
            border-bottom: 6px solid #e5e5e5;
            border-radius: 15px;
            padding: 15px;
            font-size: 16px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: #444;
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.02);
            border-bottom-width: 8px;
            border-color: var(--secondary);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .option-btn.correct {
            background: var(--correct);
            border-color: #00b35a;
            color: white;
        }

        .option-btn.wrong {
            background: var(--wrong);
            border-color: #e03e4d;
            color: white;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Gap Fill Style */
        .gap-btn {
            background: #f1f2f6;
            border: 2px dashed var(--primary);
            border-radius: 10px;
            padding: 5px 15px;
            font-size: 18px;
            font-weight: 900;
            color: var(--primary);
            cursor: pointer;
            margin: 0 5px;
            transition: 0.2s;
        }
        .gap-btn:hover {
            background: #eccc68;
            color: #333;
        }
        .gap-btn.filled-correct { background: var(--correct); color: white; border-style: solid; border-color: #00b35a; }
        .gap-btn.filled-wrong { background: var(--wrong); color: white; border-style: solid; border-color: #e03e4d; }

        /* Khung Gi·∫£i Th√≠ch */
        .explanation {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background: #fffbdf;
            border: 2px dashed var(--yellow);
            border-radius: 15px;
            font-size: 15px;
            color: #333;
            animation: slideDown 0.4s ease-out;
        }

        .explanation-title {
            font-weight: 900;
            color: #ff5252;
            font-size: 18px;
            margin-bottom: 12px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .expl-step {
            margin-bottom: 10px;
            line-height: 1.6;
            background: rgba(255,255,255,0.6);
            padding: 10px;
            border-radius: 10px;
        }

        /* CSS Animation */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px) rotate(-1deg); }
            40%, 80% { transform: translateX(6px) rotate(1deg); }
        }
        .shake { animation: shake 0.4s ease-in-out; }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            z-index: 9999;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

        /* CSS Cho N√∫t Submit */
        .submit-btn {
            background: linear-gradient(135deg, #ff4757, #ff6b81);
            color: white;
            font-size: 22px;
            font-weight: 900;
            padding: 20px 50px;
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 0 #c0392b;
            cursor: pointer;
            margin: 30px 0 50px 0;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 13px 0 #c0392b; }
        .submit-btn:active { transform: translateY(7px); box-shadow: 0 3px 0 #c0392b; }

        /* Modal K·∫øt Qu·∫£ */
        #result-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            animation: slideDown 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-content h2 { font-size: 30px; color: var(--primary); margin-top: 0; }
        .modal-content p { font-size: 18px; color: #555; font-weight: bold; }
        .close-modal {
            margin-top: 20px;
            padding: 12px 25px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
        }

        /* CSS V·∫Ω Bi·ªÉn B√°o Q29 & Q30 */
        .css-sign-q29 {
            border: 5px solid #FF4757; border-radius: 12px; width: max-content; 
            padding: 15px; text-align: center; margin: 15px auto; background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .css-sign-q29-icon {
            position: relative; width: 90px; height: 90px; border: 6px solid #FF4757; 
            border-radius: 50%; margin: 0 auto; display: flex; align-items: center; 
            justify-content: center; overflow: hidden; font-size: 40px;
        }
        .css-sign-q29-slash {
            position: absolute; width: 120%; height: 6px; background: #FF4757; 
            transform: rotate(-45deg);
        }
        .css-sign-q30 {
            border: 4px solid #3b82f6; border-radius: 8px; background-color: #fef08a; 
            padding: 20px; width: max-content; text-align: center; margin: 15px auto; 
            box-shadow: 3px 3px 0 rgba(0,0,0,0.1); font-family: 'Times New Roman', serif;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>B√ÄI KI·ªÇM TRA TI·∫æNG ANH</h1>
        <h3>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h3>
    </div>

    <div id="quiz-container"></div>

    <button class="submit-btn" onclick="showResults()">N·ªòP B√ÄI L·∫§Y ƒêI·ªÇM üöÄ</button>

    <div id="result-modal">
        <div class="modal-content">
            <h2>üéâ HO√ÄN TH√ÄNH! üéâ</h2>
            <p id="score-text"></p>
            <p id="feedback-text"></p>
            <button class="close-modal" onclick="document.getElementById('result-modal').style.display='none'">ƒê√≥ng</button>
        </div>
    </div>

<script>
    // --- 1. H·ªÜ TH·ªêNG D·ªÆ LI·ªÜU C√ÇU H·ªéI (20 C√ÇU) ---
    const rawQuizData = [
        {
            id: 1, type: "mcq",
            instruction: "Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.",
            question: "Question 1:",
            options: [
                { text: "br<u>a</u>nd", isCorrect: true, expl: "(n): th∆∞∆°ng hi·ªáu (ph√°t √¢m l√† /√¶/)" },
                { text: "r<u>a</u>nge", isCorrect: false, expl: "(n): ph·∫°m vi (ph√°t √¢m l√† /e…™/)" },
                { text: "s<u>a</u>le", isCorrect: false, expl: "(n): vi·ªác b√°n h√†ng (ph√°t √¢m l√† /e…™/)" },
                { text: "b<u>a</u>ke", isCorrect: false, expl: "(v): n∆∞·ªõng b√°nh (ph√°t √¢m l√† /e…™/)" }
            ],
            translation: "Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c v·ªõi 3 t·ª´ c√≤n l·∫°i.",
            correctReason: "T·ª´ n√†y c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m l√† /√¶/, kh√°c bi·ªát so v·ªõi √¢m /e…™/.",
            wrongReason: "ph·∫ßn g·∫°ch ch√¢n c·ªßa ch√∫ng ƒë·ªÅu ƒë∆∞·ª£c ph√°t √¢m gi·ªëng nhau l√† /e…™/."
        },
        {
            id: 2, type: "mcq",
            instruction: "Mark the letter A, B, C or D to indicate the word whose underlined part differs from the other three in pronunciation.",
            question: "Question 2:",
            options: [
                { text: "ret<u>u</u>rn", isCorrect: false, expl: "(v): quay l·∫°i (ph√°t √¢m l√† /…úÀê/)" },
                { text: "f<u>u</u>rther", isCorrect: false, expl: "(adj): xa h∆°n (ph√°t √¢m l√† /…úÀê/)" },
                { text: "sched<u>u</u>le", isCorrect: true, expl: "(n): l·ªãch tr√¨nh (ph√°t √¢m l√† /juÀê/ ho·∫∑c /…ô/)" },
                { text: "p<u>u</u>rchase", isCorrect: false, expl: "(v): mua s·∫Øm (ph√°t √¢m l√† /…úÀê/)" }
            ],
            translation: "Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m kh√°c v·ªõi 3 t·ª´ c√≤n l·∫°i.",
            correctReason: "T·ª´ n√†y c√≥ √¢m 'u' ph√°t √¢m l√† /juÀê/ (ho·∫∑c √¢m ti·∫øt nh·∫π), kh√°c bi·ªát so v·ªõi √¢m /…úÀê/.",
            wrongReason: "ph·∫ßn g·∫°ch ch√¢n ƒë·ªÅu ƒë∆∞·ª£c ph√°t √¢m l√† √¢m d√†i /…úÀê/."
        },
        {
            id: 3, type: "mcq",
            instruction: "Mark the letter A, B, C or D to indicate the word that differs from the other three in the position of primary stress.",
            question: "Question 3:",
            options: [
                { text: "develop", isCorrect: true, expl: "(v): ph√°t tri·ªÉn (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2)" },
                { text: "funnel", isCorrect: false, expl: "(n): c√°i ph·ªÖu (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1)" },
                { text: "damage", isCorrect: false, expl: "(n/v): thi·ªát h·∫°i (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1)" },
                { text: "funnel (2)", isCorrect: false, expl: "(n): c√°i ph·ªÖu (L·∫∑p l·∫°i trong ƒë·ªÅ g·ªëc, tr·ªçng √¢m 1)" }
            ],
            translation: "Ch·ªçn t·ª´ c√≥ v·ªã tr√≠ tr·ªçng √¢m kh√°c v·ªõi 3 t·ª´ c√≤n l·∫°i.",
            correctReason: "T·ª´ n√†y c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2.",
            wrongReason: "ch√∫ng ƒë·ªÅu c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt ƒë·∫ßu ti√™n."
        },
        {
            id: 4, type: "mcq",
            instruction: "Mark the letter A, B, C or D to indicate the word that differs from the other three in the position of primary stress.",
            question: "Question 4:",
            options: [
                { text: "builder", isCorrect: false, expl: "(n): th·ª£ x√¢y (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1)" },
                { text: "teacher", isCorrect: false, expl: "(n): gi√°o vi√™n (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1)" },
                { text: "writer", isCorrect: false, expl: "(n): nh√† vƒÉn (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 1)" },
                { text: "career", isCorrect: true, expl: "(n): s·ª± nghi·ªáp (Tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2)" }
            ],
            translation: "Ch·ªçn t·ª´ c√≥ v·ªã tr√≠ tr·ªçng √¢m kh√°c v·ªõi 3 t·ª´ c√≤n l·∫°i.",
            correctReason: "T·ª´ n√†y c√≥ tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt th·ª© 2, th∆∞·ªùng th·∫•y ·ªü c√°c t·ª´ k·∫øt th√∫c b·∫±ng h·∫≠u t·ªë '-eer'.",
            wrongReason: "ch√∫ng ƒë·ªÅu l√† danh t·ª´ ch·ªâ ng∆∞·ªùi c√≥ 2 √¢m ti·∫øt k·∫øt th√∫c b·∫±ng '-er', tr·ªçng √¢m r∆°i v√†o √¢m ti·∫øt ƒë·∫ßu ti√™n."
        },
        {
            id: 5, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 5: People should not throw rubbish into rivers in order to reduce GAP_PLACEHOLDER pollution.",
            options: [
                { text: "air", isCorrect: false, expl: "(n): kh√¥ng kh√≠" },
                { text: "water", isCorrect: true, expl: "(n): n∆∞·ªõc" },
                { text: "carbon", isCorrect: false, expl: "(n): c√°c-bon" },
                { text: "soil", isCorrect: false, expl: "(n): ƒë·∫•t" }
            ],
            translation: "M·ªçi ng∆∞·ªùi kh√¥ng n√™n v·ª©t r√°c xu·ªëng s√¥ng ƒë·ªÉ gi·∫£m thi·ªÉu √¥ nhi·ªÖm ________.",
            correctReason: "Ng·ªØ c·∫£nh nh·∫Øc ƒë·∫øn 'rivers' (nh·ªØng con s√¥ng) n√™n c·∫ßn m·ªôt t·ª´ li√™n quan ƒë·∫øn n∆∞·ªõc. Collocation 'water pollution' nghƒ©a l√† √¥ nhi·ªÖm n∆∞·ªõc.",
            wrongReason: "kh√¥ng ph√π h·ª£p v·ªõi ng·ªØ c·∫£nh 's√¥ng ng√≤i' (rivers) trong c√¢u."
        },
        {
            id: 6, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 6: We can conserve energy by using GAP_PLACEHOLDER appliances and following sustainable practices.",
            options: [
                { text: "energy-efficient", isCorrect: true, expl: "(adj): ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng" },
                { text: "energy-consuming", isCorrect: false, expl: "(adj): ti√™u th·ª• nhi·ªÅu nƒÉng l∆∞·ª£ng" },
                { text: "energy-costing", isCorrect: false, expl: "(adj): t·ªën k√©m nƒÉng l∆∞·ª£ng (c·ª•m t·ª´ kh√¥ng t·ª± nhi√™n)" },
                { text: "energy-saved", isCorrect: false, expl: "(adj): sai ng·ªØ ph√°p, c·∫•u tr√∫c ƒë√∫ng th∆∞·ªùng d√πng V-ing ho·∫∑c t√≠nh t·ª´ gh√©p chu·∫©n." }
            ],
            translation: "Ch√∫ng ta c√≥ th·ªÉ b·∫£o t·ªìn nƒÉng l∆∞·ª£ng b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c thi·∫øt b·ªã ________ v√† tu√¢n theo c√°c ho·∫°t ƒë·ªông b·ªÅn v·ªØng.",
            correctReason: "C·ª•m 'energy-efficient appliances' l√† collocation c·ªë ƒë·ªãnh ch·ªâ 'c√°c thi·∫øt b·ªã ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng', ph√π h·ª£p ho√†n to√†n v·ªõi v·∫ø tr∆∞·ªõc 'conserve energy' (b·∫£o t·ªìn nƒÉng l∆∞·ª£ng).",
            wrongReason: "mang nghƒ©a ti√™u c·ª±c (ti√™u th·ª•/t·ªën) ho·∫∑c sai c·∫•u tr√∫c ng·ªØ ph√°p t√≠nh t·ª´ gh√©p."
        },
        {
            id: 7, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 7: GAP_PLACEHOLDER Jimmy is often naughty, he studies very well at school.",
            options: [
                { text: "Despite", isCorrect: false, expl: "(prep): m·∫∑c d√π (C·ªông v·ªõi V-ing ho·∫∑c Noun phrase)" },
                { text: "Until", isCorrect: false, expl: "(conj): cho ƒë·∫øn khi" },
                { text: "Because", isCorrect: false, expl: "(conj): b·ªüi v√¨" },
                { text: "Although", isCorrect: true, expl: "(conj): m·∫∑c d√π (C·ªông v·ªõi m·ªôt M·ªánh ƒë·ªÅ - Clause)" }
            ],
            translation: "________ Jimmy th∆∞·ªùng xuy√™n ngh·ªãch ng·ª£m, c·∫≠u ·∫•y h·ªçc r·∫•t gi·ªèi ·ªü tr∆∞·ªùng.",
            correctReason: "Hai v·∫ø c√¢u mang nghƒ©a ƒë·ªëi l·∫≠p (ngh·ªãch ng·ª£m >< h·ªçc gi·ªèi) -> c·∫ßn t·ª´ ch·ªâ s·ª± nh∆∞·ª£ng b·ªô. Ph√≠a sau ch·ªó tr·ªëng l√† m·ªôt m·ªánh ƒë·ªÅ ho√†n ch·ªânh (S + V) n√™n ph·∫£i d√πng 'Although'.",
            wrongReason: "sai ng·ªØ ph√°p (Despite c·∫ßn Noun/V-ing) ho·∫∑c sai v·ªÅ m·∫∑t logic ng·ªØ nghƒ©a (Until, Because)."
        },
        {
            id: 8, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 8: She couldn‚Äôt explain the reason GAP_PLACEHOLDER she decided to leave her hometown.",
            options: [
                { text: "what", isCorrect: false, expl: "(pronoun): c√°i g√¨" },
                { text: "where", isCorrect: false, expl: "(adv): n∆°i m√†" },
                { text: "that", isCorrect: false, expl: "(pronoun): r·∫±ng / thay th·∫ø chung" },
                { text: "why", isCorrect: true, expl: "(adv): t·∫°i sao / l√Ω do m√†" }
            ],
            translation: "C√¥ ·∫•y kh√¥ng th·ªÉ gi·∫£i th√≠ch l√Ω do ________ c√¥ ·∫•y quy·∫øt ƒë·ªãnh r·ªùi b·ªè qu√™ h∆∞∆°ng.",
            correctReason: "Danh t·ª´ ƒë·ª©ng tr∆∞·ªõc l√† 'the reason' (l√Ω do). Tr·∫°ng t·ª´ quan h·ªá ƒëi k√®m c·ªë ƒë·ªãnh v·ªõi 'the reason' l√† 'why' (the reason why = l√Ω do t·∫°i sao).",
            wrongReason: "kh√¥ng ph·∫£i l√† c√°c ƒë·∫°i t·ª´/tr·∫°ng t·ª´ quan h·ªá ph√π h·ª£p b·ªï nghƒ©a cho danh t·ª´ ch·ªâ l√Ω do."
        },
        {
            id: 9, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 9: Tom: ‚ÄúDo you drink coffee every day?‚Äù - Lan: ‚ÄúNot really. I drink it GAP_PLACEHOLDER, only a few times a week.‚Äù",
            options: [
                { text: "usually", isCorrect: false, expl: "(adv): th∆∞·ªùng xuy√™n" },
                { text: "sometimes", isCorrect: true, expl: "(adv): th·ªânh tho·∫£ng" },
                { text: "rarely", isCorrect: false, expl: "(adv): hi·∫øm khi" },
                { text: "never", isCorrect: false, expl: "(adv): kh√¥ng bao gi·ªù" }
            ],
            translation: "Tom: 'B·∫°n c√≥ u·ªëng c√† ph√™ m·ªói ng√†y kh√¥ng?' - Lan: 'Kh√¥ng h·∫≥n. T√¥i ________ u·ªëng, ch·ªâ v√†i l·∫ßn m·ªôt tu·∫ßn th√¥i.'",
            correctReason: "V·∫ø sau c√≥ c·ª•m 'only a few times a week' (ch·ªâ v√†i l·∫ßn m·ªôt tu·∫ßn). T·∫ßn su·∫•t n√†y kh·ªõp nh·∫•t v·ªõi 'sometimes' (th·ªânh tho·∫£ng).",
            wrongReason: "di·ªÖn t·∫£ t·∫ßn su·∫•t qu√° cao (usually) ho·∫∑c qu√° th·∫•p/kh√¥ng c√≥ (rarely, never)."
        },
        {
            id: 10, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 10: Many people are tempted to buy products just because they are GAP_PLACEHOLDER.",
            options: [
                { text: "in sale", isCorrect: false, expl: "(phrase): kh√¥ng c√≥ c·ª•m n√†y trong ti·∫øng Anh chu·∫©n" },
                { text: "on sale", isCorrect: true, expl: "(phrase): ƒëang ƒë∆∞·ª£c gi·∫£m gi√°" },
                { text: "off sale", isCorrect: false, expl: "(phrase): ng·ª´ng b√°n" },
                { text: "up sale", isCorrect: false, expl: "(phrase): b√°n th√™m (upsell - nh∆∞ng vi·∫øt sai d·∫°ng)" }
            ],
            translation: "Nhi·ªÅu ng∆∞·ªùi b·ªã c√°m d·ªó mua s·∫£n ph·∫©m ch·ªâ v√¨ ch√∫ng ƒëang ________.",
            correctReason: "Th√†nh ng·ªØ 'on sale' c√≥ nghƒ©a l√† 'ƒëang ƒë∆∞·ª£c gi·∫£m gi√°/khuy·∫øn m√£i', l√† m·ªôt c·ª•m t·ª´ r·∫•t ph·ªï bi·∫øn trong ng·ªØ c·∫£nh mua s·∫Øm.",
            wrongReason: "l√† c√°c gi·ªõi t·ª´ ƒëi k√®m sai c·∫•u tr√∫c ho·∫∑c mang nghƒ©a kh√¥ng ph√π h·ª£p ng·ªØ c·∫£nh 'b·ªã c√°m d·ªó mua'."
        },
        {
            id: 11, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 11: He is very talented GAP_PLACEHOLDER meteorology.",
            options: [
                { text: "on", isCorrect: false, expl: "(prep): tr√™n" },
                { text: "in", isCorrect: false, expl: "(prep): trong" },
                { text: "at", isCorrect: true, expl: "(prep): ·ªü / t·∫°i (d√πng ch·ªâ kh·∫£ nƒÉng)" },
                { text: "for", isCorrect: false, expl: "(prep): cho" }
            ],
            translation: "Anh ·∫•y r·∫•t c√≥ t√†i ________ kh√≠ t∆∞·ª£ng h·ªçc.",
            correctReason: "C·∫•u tr√∫c gi·ªõi t·ª´ c·ªë ƒë·ªãnh (Collocation): 'talented at + Noun/V-ing' nghƒ©a l√† c√≥ t√†i nƒÉng, gi·ªèi v·ªÅ lƒ©nh v·ª±c g√¨ ƒë√≥ (t∆∞∆°ng t·ª± 'good at').",
            wrongReason: "l√† c√°c gi·ªõi t·ª´ kh√¥ng k·∫øt h·ª£p ƒë√∫ng v·ªõi t√≠nh t·ª´ 'talented'."
        },
        {
            id: 12, type: "gap-fill",
            instruction: "Mark the letter A, B, C or D to indicate the correct answer.",
            questionText: "Question 12: The GAP_PLACEHOLDER caused serious damage in the area, destroying buildings and cracking roads.",
            options: [
                { text: "earthquake", isCorrect: true, expl: "(n): tr·∫≠n ƒë·ªông ƒë·∫•t" },
                { text: "shock", isCorrect: false, expl: "(n): c√∫ s·ªëc / ch·∫•n ƒë·ªông" },
                { text: "tornado", isCorrect: false, expl: "(n): l·ªëc xo√°y" },
                { text: "thunderstorm", isCorrect: false, expl: "(n): b√£o c√≥ s·∫•m s√©t" }
            ],
            translation: "C∆°n/Tr·∫≠n ________ ƒë√£ g√¢y ra thi·ªát h·∫°i nghi√™m tr·ªçng trong khu v·ª±c, ph√° h·ªßy c√°c t√≤a nh√† v√† l√†m n·ª©t ƒë∆∞·ªùng.",
            correctReason: "T·ª´ kh√≥a quy·∫øt ƒë·ªãnh l√† 'cracking roads' (l√†m n·ª©t ƒë∆∞·ªùng). Hi·ªán t∆∞·ª£ng thi√™n nhi√™n duy nh·∫•t trong 4 ƒë√°p √°n c√≥ kh·∫£ nƒÉng l√†m n·ª©t m·∫∑t ƒë·∫•t m·∫°nh m·∫Ω nh∆∞ v·∫≠y l√† ƒë·ªông ƒë·∫•t (earthquake).",
            wrongReason: "tuy c√≥ g√¢y thi·ªát h·∫°i cho t√≤a nh√† nh∆∞ng kh√¥ng c√≥ ƒë·∫∑c t√≠nh ti√™u bi·ªÉu l√† 'l√†m n·ª©t m·∫∑t ƒë∆∞·ªùng'."
        },
        {
            id: 17, type: "mcq",
            instruction: "Choose the correct answer to indicate the correct ordering.",
            question: "Question 17: S·∫Øp x·∫øp c√°c c√¢u sau th√†nh m·ªôt b·ª©c th∆∞ logic:<br><br>a. Moreover, she has shown excellence in her product knowledge and customer service skills.<br>b. Erica has been an absolute joy to work with. She is very pleasant and courteous to our customers.<br>c. Dear Sir/ Madam,<br>d. Besides, Erica demonstrates the characters and qualities that you look for in an employee.<br>e. Sincerely,<br>f. It is with great pleasure that I write this recommendation letter for Erica Rudi. I have been Errica‚Äôs supervisor for the last five years.",
            options: [
                { text: "c-f-d-a-b-e", isCorrect: false, expl: "Sai logic t·ª´ n·ªëi (Besides tr∆∞·ªõc Moreover)." },
                { text: "c-a-f-b-d-e", isCorrect: false, expl: "Sai c·∫•u tr√∫c (Khen ng·ª£i Moreover ngay sau L·ªùi ch√†o)." },
                { text: "c-f-b-d-a-e", isCorrect: true, expl: "H·ª£p l√Ω nh·∫•t (Ch√†o -> L√Ω do -> Khen t·ªïng quan -> Khen th√™m -> Khen n·ªØa -> K·∫øt th√∫c)." },
                { text: "c-b-f-a-d-e", isCorrect: false, expl: "Sai c·∫•u tr√∫c (Khen tr∆∞·ªõc khi n√™u l√Ω do vi·∫øt th∆∞)." }
            ],
            translation: "Ch·ªçn th·ª© t·ª± ƒë√∫ng ƒë·ªÉ gh√©p c√°c c√¢u th√†nh m·ªôt b·ª©c th∆∞ ho√†n ch·ªânh.",
            correctReason: "C·∫•u tr√∫c chu·∫©n c·ªßa th∆∞ gi·ªõi thi·ªáu: L·ªùi ch√†o (c) -> M·ª•c ƒë√≠ch vi·∫øt th∆∞ (f) -> L·ªùi khen t·ªïng quan (b) -> L·ªùi khen chi ti·∫øt k·∫øt n·ªëi b·∫±ng c√°c t·ª´ 'Besides' v√† 'Moreover'. Trong c√°c ph∆∞∆°ng √°n, c-f-b-d-a-e l√† logic nh·∫•t.",
            wrongReason: "ch√∫ng vi ph·∫°m c·∫•u tr√∫c c∆° b·∫£n c·ªßa th∆∞ trang tr·ªçng (nh∆∞ ƒë∆∞a ra lu·∫≠n ƒëi·ªÉm tr∆∞·ªõc l√Ω do) ho·∫∑c sai tr√¨nh t·ª± t·ª´ n·ªëi."
        },
        {
            id: 18, type: "mcq",
            instruction: "Choose the correct answer to indicate the correct ordering.",
            question: "Question 18: S·∫Øp x·∫øp c√°c c√¢u sau th√†nh m·ªôt email logic:<br><br>a. Shall we meet at 10 a.m?<br>b. I am so glad to come and try some recipes from the book with you.<br>c. Hi Gloria ,<br>d. Please tell me if I need to buy something in advance<br>e. Thank you for inviting me to your house this Sunday.",
            options: [
                { text: "c-a-e-d-b", isCorrect: false, expl: "H·ªèi gi·ªù h·∫πn ngay sau l·ªùi ch√†o l√† thi·∫øu t·ª± nhi√™n." },
                { text: "c-e-a-b-d", isCorrect: false, expl: "Logic l·ªôn x·ªôn gi·ªØa vi·ªác c·∫£m ∆°n v√† x√°c nh·∫≠n ƒë·∫øn." },
                { text: "c-e-b-a-d", isCorrect: true, expl: "H·ª£p l√Ω (Ch√†o -> C·∫£m ∆°n m·ªùi -> ƒê·ªìng √Ω ƒë·∫øn -> H·ªèi gi·ªù h·∫πn -> H·ªèi c√≥ c·∫ßn mua g√¨ kh√¥ng)." },
                { text: "c-e-a-d-b", isCorrect: false, expl: "Sai logic (H·ªèi mua ƒë·ªì tr∆∞·ªõc khi n√≥i s·∫Ω ƒë·∫øn)." }
            ],
            translation: "Ch·ªçn th·ª© t·ª± ƒë√∫ng ƒë·ªÉ gh√©p c√°c c√¢u th√†nh m·ªôt email ho√†n ch·ªânh.",
            correctReason: "Tr√¨nh t·ª± t·ª± nhi√™n nh·∫•t c·ªßa m·ªôt ph·∫£n h·ªìi l·ªùi m·ªùi: Ch√†o (c) -> C·∫£m ∆°n v√¨ ƒë√£ m·ªùi (e) -> B√†y t·ªè ni·ªÅm vui ƒë∆∞·ª£c tham gia (b) -> Ch·ªët th·ªùi gian (a) -> ƒê·ªÅ ngh·ªã mang th√™m ƒë·ªì (d).",
            wrongReason: "ch√∫ng t·∫°o ra m·∫°ch giao ti·∫øp thi·∫øu t·ª± nhi√™n, v√≠ d·ª• nh∆∞ ƒë·ªÅ ngh·ªã mang ƒë·ªì tr∆∞·ªõc khi n√≥i r√µ l√† m√¨nh c√≥ ƒë·∫øn hay kh√¥ng."
        },
        {
            id: 25, type: "mcq",
            instruction: "Indicate the sentence that is closest in meaning to the given sentence.",
            question: "Question 25: I was studying for my exam. My brother was playing video games in his room.",
            options: [
                { text: "I studied for my exam while my brother played video games in his room.", isCorrect: false, expl: "S·ª≠ d·ª•ng th√¨ Qu√° kh·ª© ƒë∆°n kh√¥ng ph·∫£n √°nh t·ªët s·ª± k√©o d√†i c·ªßa h√†nh ƒë·ªông." },
                { text: "While I was studying for my exam, my brother was playing video games in his room.", isCorrect: true, expl: "S·ª≠ d·ª•ng chu·∫©n c·∫•u tr√∫c While + Past Continuous." },
                { text: "When I was studying for my exam, my brother was playing video games in his room.", isCorrect: false, expl: "When √≠t ƒë∆∞·ª£c d√πng ∆∞u ti√™n h∆°n While khi t·∫£ 2 h√†nh ƒë·ªông song song." },
                { text: "While I studied for my exam, my brother was playing video games in his room.", isCorrect: false, expl: "Sai s·ª± nh·∫•t qu√°n v·ªÅ th√¨." }
            ],
            translation: "T√¥i ƒëang h·ªçc thi. Anh trai t√¥i ƒëang ch∆°i ƒëi·ªán t·ª≠ trong ph√≤ng.",
            correctReason: "C·∫•u tr√∫c 'While + Qu√° kh·ª© ti·∫øp di·ªÖn, Qu√° kh·ª© ti·∫øp di·ªÖn' l√† chu·∫©n x√°c nh·∫•t ƒë·ªÉ m√¥ t·∫£ hai h√†nh ƒë·ªông ƒëang x·∫£y ra song song c√πng m·ªôt l√∫c trong qu√° kh·ª©.",
            wrongReason: "s·ª≠ d·ª•ng sai th√¨ Qu√° kh·ª© ƒë∆°n ho·∫∑c d√πng li√™n t·ª´ 'When' kh√¥ng nh·∫•n m·∫°nh ƒë∆∞·ª£c t√≠nh song song k√©o d√†i t·ªët b·∫±ng 'While'."
        },
        {
            id: 26, type: "mcq",
            instruction: "Indicate the sentence that is closest in meaning to the given sentence.",
            question: "Question 26: Due to the supermarket‚Äôs set prices, I am unable to bargain there.",
            options: [
                { text: "Because the fixed prices at supermarkets, I can never haggle there.", isCorrect: false, expl: "Sai c·∫•u tr√∫c. Ph·∫£i l√† 'Because of'." },
                { text: "Since grocery pricing are set, I can never haggle there.", isCorrect: true, expl: "Truy·ªÅn t·∫£i ƒë√∫ng nghƒ©a 'V√¨ gi√° ƒë√£ ƒë∆∞·ª£c ni√™m y·∫øt...' (M·∫∑c d√π 'pricing are' trong ƒë·ªÅ g·ªëc c√≥ l·ªói sai ng·ªØ ph√°p nh·ªè v·ªÅ s·ªë √≠t/nhi·ªÅu nh∆∞ng ƒë√¢y l√† ƒë√°p √°n s√°t nghƒ©a nh·∫•t)." },
                { text: "I can never bargain at a supermarket because the prices is fixed.", isCorrect: false, expl: "Sai ng·ªØ ph√°p (prices s·ªë nhi·ªÅu ƒëi v·ªõi is)." },
                { text: "Since grocery pricing are fixed, I never can haggle there.", isCorrect: false, expl: "V·ªã tr√≠ tr·∫°ng t·ª´ 'never can' k√©m t·ª± nhi√™n h∆°n 'can never'." }
            ],
            translation: "Do gi√° c·∫£ ·ªü si√™u th·ªã ƒë√£ ƒë∆∞·ª£c thi·∫øt l·∫≠p (ni√™m y·∫øt), t√¥i kh√¥ng th·ªÉ m·∫∑c c·∫£ ·ªü ƒë√≥.",
            correctReason: "ƒê√°p √°n n√†y gi·ªØ ƒë∆∞·ª£c √Ω nghƒ©a nguy√™n b·∫£n b·∫±ng c√°ch d√πng c·∫•u tr√∫c 'Since + M·ªánh ƒë·ªÅ' (b·ªüi v√¨). 'Haggle' l√† t·ª´ ƒë·ªìng nghƒ©a ch√≠nh x√°c c·ªßa 'bargain' (m·∫∑c c·∫£).",
            wrongReason: "m·∫Øc l·ªói ng·ªØ ph√°p c∆° b·∫£n r√µ r·ªát h∆°n nh∆∞ thi·∫øu 'of' sau 'Because' ho·∫∑c chia sai ƒë·ªông t·ª´ tobe."
        },
        {
            id: 27, type: "mcq",
            instruction: "Indicate the sentence that is made from the given cues.",
            question: "Question 27: She / decide / attend / the party / although / she / not / enjoy / it",
            options: [
                { text: "She decided to attend the party although she didn‚Äôt enjoy it.", isCorrect: true, expl: "Chia th√¨ Qu√° kh·ª© ƒë√∫ng, d√πng ƒë√∫ng 'decide to V'." },
                { text: "She decided to attend the party if although she didn‚Äôt enjoy.", isCorrect: false, expl: "Th·ª´a ch·ªØ 'if', thi·∫øu t√¢n ng·ªØ 'it'." },
                { text: "She decided attending the party although she didn‚Äôt enjoy it.", isCorrect: false, expl: "Sai c·∫•u tr√∫c: Decide + to V (kh√¥ng d√πng V-ing)." }
            ],
            translation: "C√¥ ·∫•y / quy·∫øt ƒë·ªãnh / tham d·ª± / b·ªØa ti·ªác / m·∫∑c d√π / c√¥ ·∫•y / kh√¥ng / th√≠ch / n√≥.",
            correctReason: "C·∫•u tr√∫c chu·∫©n: 'decide + to V' (quy·∫øt ƒë·ªãnh l√†m g√¨). Ng·ªØ c·∫£nh k·ªÉ l·∫°i s·ª± vi·ªác n√™n d√πng th√¨ Qu√° kh·ª© ƒë∆°n (decided / didn't enjoy).",
            wrongReason: "ch√∫ng d√πng sai c·∫•u tr√∫c ƒë·ªông t·ª´ (decide + V-ing) ho·∫∑c th·ª´a t·ª´/thi·∫øu t√¢n ng·ªØ v√¥ l√Ω."
        },
        {
            id: 28, type: "mcq",
            instruction: "Indicate the sentence that is made from the given cues.",
            question: "Question 28: Scientists / can forecast / many / natural disasters / in advance",
            options: [
                { text: "Scientists can forecast many of natural disasters in advance.", isCorrect: false, expl: "Sai c·∫•u tr√∫c (many of + the/t√≠nh t·ª´ s·ªü h·ªØu)." },
                { text: "Scientists can forecast many the natural disasters in advance.", isCorrect: false, expl: "Sai c·∫•u tr√∫c (many + Noun kh√¥ng c√≥ the, ho·∫∑c many of the)." },
                { text: "Scientists can forecast many of the natural disasters in advance time.", isCorrect: false, expl: "Th·ª´a ch·ªØ 'time' (ch·ªâ c·∫ßn 'in advance')." },
                { text: "Scientists can forecast many natural disasters in advance.", isCorrect: true, expl: "C√¢u ƒë√∫ng ng·ªØ ph√°p t·ª± nhi√™n nh·∫•t (L∆∞u √Ω ƒë·ªÅ g·ªëc ph∆∞∆°ng √°n D c√≥ ch·ªØ 'of the', nh∆∞ng ƒë√¢y l√† d·∫°ng s·ª≠a chu·∫©n)." }
            ],
            translation: "C√°c nh√† khoa h·ªçc / c√≥ th·ªÉ d·ª± b√°o / nhi·ªÅu / th·∫£m h·ªça thi√™n nhi√™n / tr∆∞·ªõc.",
            correctReason: "S·ª≠ d·ª•ng ƒë√∫ng l∆∞·ª£ng t·ª´ 'many + Danh t·ª´ s·ªë nhi·ªÅu ƒë·∫øm ƒë∆∞·ª£c' (many natural disasters). C·ª•m 'in advance' mang nghƒ©a 'tr∆∞·ªõc' l√† ho√†n to√†n ch√≠nh x√°c.",
            wrongReason: "ch√∫ng s·ª≠ d·ª•ng sai c·∫•u tr√∫c 'many of' (thi·∫øu m·∫°o t·ª´ the) ho·∫∑c d√πng th·ª´a t·ª´ ng·ªØ kh√¥ng c·∫ßn thi·∫øt."
        },
        {
            id: 29, type: "image",
            instruction: "What does the notice say?",
            questionHtml: `
                <div class="css-sign-q29">
                    <div class="css-sign-q29-icon">
                        üçîü•§
                        <div class="css-sign-q29-slash"></div>
                    </div>
                    <div style="font-weight: 900; font-family: 'Arial', sans-serif; margin-top: 15px; font-size: 24px; line-height: 1.1; color: black;">
                        NO FOOD<br>OR<br>DRINK
                    </div>
                </div>
            `,
            options: [
                { text: "You are allowed to eat and drink here without any restrictions.", isCorrect: false, expl: "Nghƒ©a: B·∫°n ƒë∆∞·ª£c ph√©p ƒÉn u·ªëng kh√¥ng gi·ªõi h·∫°n." },
                { text: "Eating and drinking are not permitted in this area at all times.", isCorrect: true, expl: "Nghƒ©a: Vi·ªác ƒÉn u·ªëng kh√¥ng ƒë∆∞·ª£c ph√©p t·∫°i ƒë√¢y." },
                { text: "You can bring drinks but not food into this area.", isCorrect: false, expl: "Nghƒ©a: B·∫°n ƒë∆∞·ª£c mang ƒë·ªì u·ªëng nh∆∞ng c·∫•m ƒë·ªì ƒÉn." },
                { text: "Food is permitted but drinks are not allowed in this area.", isCorrect: false, expl: "Nghƒ©a: ƒê·ªì ƒÉn ƒë∆∞·ª£c ph√©p nh∆∞ng c·∫•m ƒë·ªì u·ªëng." }
            ],
            translation: "Bi·ªÉn b√°o n√†y c√≥ √Ω nghƒ©a g√¨? (H√¨nh ·∫£nh: C·∫•m ƒë·ªì ƒÉn th·ª©c u·ªëng).",
            correctReason: "H√¨nh ·∫£nh bi·ªÉn b√°o c√≥ ch·ªØ 'NO FOOD OR DRINK' v√† bi·ªÉu t∆∞·ª£ng th·ª©c ƒÉn/n∆∞·ªõc u·ªëng b·ªã g·∫°ch ch√©o ƒë·ªè. ƒêi·ªÅu n√†y mang √Ω nghƒ©a c·∫•m ho√†n to√†n vi·ªác ƒÉn u·ªëng, t∆∞∆°ng ƒë∆∞∆°ng v·ªõi 'Eating and drinking are not permitted...'",
            wrongReason: "ch√∫ng cho ph√©p ƒÉn, u·ªëng, ho·∫∑c m·ªôt trong hai, tr√°i ng∆∞·ª£c ho√†n to√†n v·ªõi th√¥ng ƒëi·ªáp c·∫•m (NO) c·ªßa bi·ªÉn b√°o."
        },
        {
            id: 30, type: "image",
            instruction: "Question 30. What does the notice say?",
            questionHtml: `
                <div class="css-sign-q30">
                    "The garden is closed for planting.<br>Will be open to visitors next week"
                </div>
            `,
            options: [
                { text: "You can visit the garden any day, not just next week.", isCorrect: false, expl: "Nghƒ©a: B·∫°n c√≥ th·ªÉ tham quan b·∫•t k·ª≥ ng√†y n√†o." },
                { text: "The garden is open for planting and visitors are allowed in now.", isCorrect: false, expl: "Nghƒ©a: V∆∞·ªùn ƒëang m·ªü v√† du kh√°ch ƒë∆∞·ª£c v√†o ngay b√¢y gi·ªù." },
                { text: "The garden is always open and is not closed for planting.", isCorrect: false, expl: "Nghƒ©a: V∆∞·ªùn lu√¥n m·ªü v√† kh√¥ng ƒë√≥ng c·ª≠a." },
                { text: "The garden will be open after planting is completed.", isCorrect: true, expl: "Nghƒ©a: V∆∞·ªùn s·∫Ω ƒë∆∞·ª£c m·ªü sau khi tr·ªìng c√¢y xong (tu·∫ßn t·ªõi)." }
            ],
            translation: "Th√¥ng b√°o n√≥i g√¨? ('Khu v∆∞·ªùn ƒëang ƒë√≥ng c·ª≠a ƒë·ªÉ tr·ªìng c√¢y. S·∫Ω m·ªü c·ª≠a cho du kh√°ch v√†o tu·∫ßn t·ªõi').",
            correctReason: "Th√¥ng b√°o cho bi·∫øt v∆∞·ªùn hi·ªán ƒëang ƒë√≥ng c·ª≠a (closed for planting) v√† s·∫Ω m·ªü l·∫°i v√†o tu·∫ßn t·ªõi (open next week). T·ª©c l√† sau khi c√¥ng vi·ªác tr·ªìng c√¢y ho√†n t·∫•t th√¨ v∆∞·ªùn m·ªõi m·ªü, ph√π h·ª£p v·ªõi √Ω nghƒ©a c·ªßa ƒë√°p √°n ƒë√∫ng.",
            wrongReason: "ch√∫ng ƒë·ªÅu kh·∫≥ng ƒë·ªãnh v∆∞·ªùn ƒëang m·ªü c·ª≠a ho·∫∑c lu√¥n lu√¥n m·ªü c·ª≠a, ƒëi ng∆∞·ª£c l·∫°i v·ªõi t·ª´ 'closed' trong bi·ªÉn b√°o."
        }
    ];

    let correctCount = 0;
    const totalQuestions = rawQuizData.length;
    let audioCtx;

    // --- 2. H·ªÜ TH·ªêNG √ÇM THANH & HI·ªÜU ·ª®NG ---
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }
    // K√≠ch ho·∫°t audio khi user t∆∞∆°ng t√°c l·∫ßn ƒë·∫ßu
    document.addEventListener('click', initAudio, { once: true });

    function playSound(type) {
        if (!audioCtx) return;
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // √Çm 'Ding' vui tai
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        } else {
            // √Çm 'T√©o t√®o' b√°o l·ªói
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.3);
        }
    }

    function createConfetti() {
        const colors = ['#00C9A7', '#FF4757', '#8854C0', '#FFC312', '#00D26A'];
        for (let i = 0; i < 40; i++) {
            let conf = document.createElement('div');
            conf.classList.add('confetti');
            conf.style.left = Math.random() * 100 + 'vw';
            conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            conf.style.animationDuration = (Math.random() * 2 + 1) + 's';
            // T·∫°o k√≠ch th∆∞·ªõc ng·∫´u nhi√™n
            let size = Math.random() * 10 + 5;
            conf.style.width = size + 'px';
            conf.style.height = size + 'px';
            document.body.appendChild(conf);
            setTimeout(() => conf.remove(), 3000);
        }
    }

    // --- 3. RENDER GIAO DI·ªÜN & LOGIC ---
    function renderQuiz() {
        const container = document.getElementById('quiz-container');
        
        rawQuizData.forEach((q, qIndex) => {
            // X√°o tr·ªôn ng·∫´u nhi√™n ƒë√°p √°n cho m·ªói ng∆∞·ªùi ch∆°i
            q.shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
            
            let card = document.createElement('div');
            card.className = 'question-card';
            card.id = `q-card-${q.id}`;

            let htmlContent = `<div class="instruction">${q.instruction}</div>`;

            // X·ª≠ l√Ω lo·∫°i c√¢u h·ªèi
            if (q.type === 'gap-fill') {
                // Bi·∫øn ƒë·ªïi c√¢u h·ªèi Gap Fill
                let parts = q.questionText.split('GAP_PLACEHOLDER');
                htmlContent += `
                    <div class="question-text">
                        ${parts[0]} <button class="gap-btn" id="gap-${q.id}">[ B·∫•m Ch·ªçn T·ª´ ]</button> ${parts[1] || ''}
                    </div>
                `;
            } else if (q.type === 'image') {
                htmlContent += `<div class="question-text">${q.questionHtml}</div>`;
            } else {
                htmlContent += `<div class="question-text">${q.question}</div>`;
            }

            // Sinh khung ƒë√°p √°n Grid
            htmlContent += `<div class="options-grid" id="grid-${q.id}">`;
            const letters = ['A', 'B', 'C', 'D'];
            
            q.shuffledOptions.forEach((opt, optIndex) => {
                let letter = letters[optIndex];
                htmlContent += `
                    <button class="option-btn" onclick="handleSelect(${qIndex}, ${optIndex}, this)">
                        <b>${letter}.</b> ${opt.text}
                    </button>
                `;
            });
            htmlContent += `</div>`;

            // Khung gi·∫£i th√≠ch (·∫©n ban ƒë·∫ßu)
            htmlContent += `<div class="explanation" id="expl-${q.id}"></div>`;

            card.innerHTML = htmlContent;
            container.appendChild(card);
        });
    }

    // H√†m X·ª≠ l√Ω khi ng∆∞·ªùi d√πng b·∫•m ch·ªçn ƒë√°p √°n
    function handleSelect(qIndex, optIndex, btnElement) {
        initAudio();
        const q = rawQuizData[qIndex];
        const selectedOption = q.shuffledOptions[optIndex];
        const card = document.getElementById(`q-card-${q.id}`);
        const grid = document.getElementById(`grid-${q.id}`);
        const explDiv = document.getElementById(`expl-${q.id}`);
        const gapBtn = document.getElementById(`gap-${q.id}`);

        // V√¥ hi·ªáu h√≥a c√°c n√∫t kh√°c trong c√¢u n√†y
        const buttons = grid.querySelectorAll('.option-btn');
        buttons.forEach(btn => btn.disabled = true);

        // Sinh ph·∫ßn gi·∫£i th√≠ch SI√äU CHI TI·∫æT t·ª± ƒë·ªông kh·ªõp v·ªõi th·ª© t·ª± ch·ªØ c√°i ƒê√É X√ÅO TR·ªòN
        const letters = ['A', 'B', 'C', 'D'];
        let correctLetter = '';
        let wrongLetters = [];
        let optionAnalysis = '';

        q.shuffledOptions.forEach((opt, idx) => {
            let l = letters[idx];
            if (opt.isCorrect) correctLetter = l;
            else wrongLetters.push(l);
            
            optionAnalysis += `<b>${l}. ${opt.text}</b> ${opt.expl}<br>`;
        });

        // 4 B∆∞·ªõc gi·∫£i th√≠ch kh·∫Øt khe
        explDiv.innerHTML = `
            <div class="explanation-title">üìù GI·∫¢I TH√çCH CHI TI·∫æT:</div>
            <div class="expl-step"><b>1. D·ªãch c√¢u h·ªèi:</b> ${q.translation}</div>
            <div class="expl-step"><b>2. Ph√¢n t√≠ch 4 ƒë√°p √°n:</b><br>${optionAnalysis}</div>
            <div class="expl-step"><b>3. T·∫°i sao ch·ªçn ${correctLetter}?</b><br>${q.correctReason}</div>
            <div class="expl-step"><b>4. T·∫°i sao 3 ƒë√°p √°n c√≤n l·∫°i sai?</b><br>Lo·∫°i ${wrongLetters.join(', ')} v√¨ ${q.wrongReason}</div>
        `;

        // Ki·ªÉm tra ƒë√∫ng / sai
        if (selectedOption.isCorrect) {
            btnElement.classList.add('correct');
            if(gapBtn) {
                gapBtn.innerHTML = selectedOption.text;
                gapBtn.classList.add('filled-correct');
            }
            playSound('correct');
            createConfetti();
            correctCount++;
        } else {
            btnElement.classList.add('wrong');
            card.classList.add('shake');
            setTimeout(() => card.classList.remove('shake'), 400); // X√≥a class ƒë·ªÉ c√≥ th·ªÉ shake l·∫°i n·∫øu c·∫ßn
            if(gapBtn) {
                gapBtn.innerHTML = selectedOption.text;
                gapBtn.classList.add('filled-wrong');
            }
            playSound('wrong');
            
            // Hi·ªÉn th·ªã th√™m m√†u xanh cho n√∫t ƒë√∫ng ƒë·ªÉ h·ªçc sinh bi·∫øt
            q.shuffledOptions.forEach((opt, idx) => {
                if(opt.isCorrect) {
                    buttons[idx].style.border = "3px solid var(--correct)";
                }
            });
        }

        // Hi·ªán khung gi·∫£i th√≠ch ngay l·∫≠p t·ª©c
        explDiv.style.display = 'block';
    }

    // --- 4. T√çNH ƒêI·ªÇM & T·ªîNG K·∫æT ---
    function showResults() {
        const modal = document.getElementById('result-modal');
        const scoreText = document.getElementById('score-text');
        const feedbackText = document.getElementById('feedback-text');

        scoreText.innerHTML = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng <span style="color:var(--correct); font-size:24px;">${correctCount} / ${totalQuestions}</span> c√¢u!`;

        let feedback = "";
        if (correctCount === totalQuestions) {
            feedback = "üèÜ Xu·∫•t s·∫Øc! B·∫°n ƒë√∫ng l√† THI√äN T√ÄI Ti·∫øng Anh!";
            createConfetti(); createConfetti();
        } else if (correctCount >= totalQuestions * 0.7) {
            feedback = "üî• R·∫•t gi·ªèi! Kh·∫£ nƒÉng ngo·∫°i ng·ªØ c·ªßa b·∫°n r·∫•t tuy·ªát v·ªùi!";
            createConfetti();
        } else if (correctCount >= totalQuestions * 0.5) {
            feedback = "üëç Kh√° l·∫Øm! H√£y xem k·ªπ ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ ti·∫øn b·ªô h∆°n nh√©!";
        } else {
            feedback = "üí™ ƒê·ª´ng bu·ªìn nh√©! C·ªë g·∫Øng luy·ªán t·∫≠p th√™m, Ms Mai An tin b·∫°n s·∫Ω l√†m t·ªët h∆°n ·ªü l·∫ßn sau!";
        }

        feedbackText.innerHTML = feedback;
        modal.style.display = 'flex';
    }

    // Kh·ªüi t·∫°o Quiz khi load trang
    window.onload = renderQuiz;

</script>
</body>
</html>