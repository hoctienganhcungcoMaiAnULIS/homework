<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30 C√¢u Luy·ªán Thi Ti·∫øng Anh - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0;
            --primary-dark: #6c429c;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg: #f4f7f6;
            --text: #2d3436;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(136, 84, 192, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 201, 167, 0.1) 0%, transparent 20%);
            margin: 0;
            padding: 20px;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 30px;
            position: relative;
            border-top: 8px solid var(--primary);
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px dashed #eee;
            padding-bottom: 20px;
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .teacher-name {
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
            box-shadow: 0 3px 0 #009e82;
        }

        /* Progress */
        .progress-wrapper {
            background: #eee;
            height: 12px;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            width: 0%;
            transition: width 0.4s ease;
        }

        /* Question Card */
        .q-card {
            animation: fadeIn 0.5s;
        }

        .q-header {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 6px solid var(--primary);
            margin-bottom: 20px;
        }

        .q-number {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 8px;
            display: block;
        }

        .q-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3436;
        }

        /* Options */
        .options-list {
            display: grid;
            gap: 15px;
        }

        .option-item {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 18px 25px;
            border-radius: 16px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #e0e0e0;
            font-weight: 600;
        }

        .option-item:hover:not(.disabled) {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: 0 7px 0 #e0e0e0;
        }

        .option-item:active:not(.disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #e0e0e0;
        }

        .option-item.correct {
            background: #d1fae5;
            border-color: var(--correct);
            color: #065f46;
            box-shadow: 0 4px 0 #059669;
        }

        .option-item.wrong {
            background: #fee2e2;
            border-color: var(--wrong);
            color: #991b1b;
            box-shadow: 0 4px 0 #b91c1c;
            animation: shake 0.5s;
        }

        .disabled {
            pointer-events: none;
        }

        /* Explanation */
        .explanation {
            display: none;
            margin-top: 25px;
            background: #fff;
            border: 2px solid var(--primary);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.1);
        }

        .exp-title {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-body {
            padding: 20px;
        }

        .exp-row {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-right: 8px;
        }

        .tag-vocab { background: #e0f2fe; color: #0284c7; }
        .tag-grammar { background: #f3e8ff; color: #9333ea; }
        .tag-trap { background: #fee2e2; color: #dc2626; }

        /* Controls */
        .controls {
            margin-top: 30px;
            text-align: right;
        }

        .btn-next {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 0 var(--primary-dark);
            transition: all 0.2s;
            display: none;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 var(--primary-dark);
        }

        .btn-next:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 var(--primary-dark);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .result-box {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: zoomIn 0.4s;
        }

        .score-big {
            font-size: 4rem;
            font-weight: 800;
            color: var(--secondary);
            margin: 10px 0;
            text-shadow: 2px 2px 0 #009e82;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        #confetti { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="container">
    <header>
        <h1>B√†i T·∫≠p Ti·∫øng Anh T∆∞∆°ng T√°c</h1>
        <div class="teacher-name">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
    </header>

    <div class="progress-wrapper">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div id="quizContainer">
        </div>

    <div class="controls">
        <button class="btn-next" id="nextBtn" onclick="nextQuestion()">C√¢u ti·∫øp theo ‚ûú</button>
    </div>
</div>

<div class="overlay" id="resultOverlay">
    <div class="result-box">
        <h2 style="color:var(--primary)">K·∫æT QU·∫¢ CHUNG CU·ªòC</h2>
        <div class="score-big" id="finalScore">0/30</div>
        <p id="finalMsg" style="font-size: 1.1rem; line-height: 1.5; color: #555;"></p>
        <button class="btn-next" style="display:inline-block; margin-top:15px" onclick="location.reload()">L√†m l·∫°i b√†i thi</button>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI (30 C√ÇU) ---
    // C·∫•u tr√∫c: Question + Correct Answer + 3 Distractors (Sai)
    // H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông tr·ªôn v·ªã tr√≠ ƒë√°p √°n ƒë·ªÉ KH√îNG PH·∫¢I L√öC N√ÄO C≈®NG L√Ä A.
    const rawData = [
        // --- EXERCISE 10 (10 c√¢u) ---
        {
            type: "S·∫Øp x·∫øp c√¢u (Reorder)",
            q: "call / I / will / you / I / arrive / as soon as the /airport/ at /",
            correct: "I will call you as soon as I arrive at the airport.",
            wrong: [
                "I will call you as soon as I at the airport arrive.",
                "As soon as I arrive at the airport I will call you.", 
                "I will you call as soon as I arrive at the airport."
            ],
            explain: {
                trans: "T√¥i s·∫Ω g·ªçi cho b·∫°n ngay khi t√¥i ƒë·∫øn s√¢n bay.",
                vocab: "As soon as (Ngay khi), Arrive at (ƒê·∫øn ƒë·ªãa ƒëi·ªÉm nh·ªè)",
                why: "C·∫•u tr√∫c: T∆∞∆°ng lai ƒë∆°n + as soon as + Hi·ªán t·∫°i ƒë∆°n. 'I will call you' l√† m·ªánh ƒë·ªÅ ch√≠nh.",
                wrong: "C√°c c√¢u sai do ƒë·∫∑t sai v·ªã tr√≠ tr·∫°ng ng·ªØ ch·ªâ n∆°i ch·ªën (at the airport) ho·∫∑c ƒë·∫£o sai tr·∫≠t t·ª± ƒë·ªông t·ª´."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "them / should / You / they / help / if / need /.",
            correct: "You should help them if they need.",
            wrong: [
                "If you need them, they should help.",
                "You should help if they need them.",
                "They should help you if need them."
            ],
            explain: {
                trans: "B·∫°n n√™n gi√∫p h·ªç n·∫øu h·ªç c·∫ßn.",
                vocab: "Should (N√™n), If (N·∫øu)",
                why: "M·ªánh ƒë·ªÅ ch√≠nh khuy√™n b·∫£o: S + should + V. M·ªánh ƒë·ªÅ ƒëi·ªÅu ki·ªán: if + S + V.",
                wrong: "C√°c c√¢u sai l√†m thay ƒë·ªïi ho√†n to√†n nghƒ©a g·ªëc (ai gi√∫p ai) ho·∫∑c thi·∫øu ch·ªß ng·ªØ."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "will / We/frozen/be/ you / temperature / unless / increase / the /.",
            correct: "We will be frozen unless you increase the temperature.",
            wrong: [
                "Unless you increase the temperature we will be frozen.", 
                "We will frozen be unless the temperature increase you.",
                "You increase the temperature unless we will be frozen."
            ],
            explain: {
                trans: "Ch√∫ng ta s·∫Ω b·ªã ƒë√≥ng bƒÉng tr·ª´ khi b·∫°n tƒÉng nhi·ªát ƒë·ªô l√™n.",
                vocab: "Frozen (ƒê√≥ng bƒÉng), Unless (Tr·ª´ khi = If not)",
                why: "M·ªánh ƒë·ªÅ ch√≠nh (T∆∞∆°ng lai b·ªã ƒë·ªông): We will be frozen. M·ªánh ƒë·ªÅ ƒëi·ªÅu ki·ªán: unless + S + V.",
                wrong: "C√¢u b·∫Øt ƒë·∫ßu b·∫±ng Unless c·∫ßn d·∫•u ph·∫©y (trong b√†i kh√¥ng cho). C√°c c√¢u kh√°c sai tr·∫≠t t·ª± t·ª´ nghi√™m tr·ªçng."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "after / The / the /shop/ closed / had left / last customer/.",
            correct: "The shop closed after the last customer had left.",
            wrong: [
                "After the shop closed the last customer had left.",
                "The last customer had left after the shop closed.",
                "The shop had left after the last customer closed."
            ],
            explain: {
                trans: "C·ª≠a h√†ng ƒë√≥ng c·ª≠a sau khi v·ªã kh√°ch cu·ªëi c√πng ƒë√£ r·ªùi ƒëi.",
                vocab: "Last customer (Kh√°ch cu·ªëi), Had left (ƒê√£ r·ªùi - QKHT)",
                why: "H√†nh ƒë·ªông x·∫£y ra tr∆∞·ªõc (kh√°ch ƒëi) d√πng Qu√° kh·ª© ho√†n th√†nh. H√†nh ƒë·ªông sau (ƒë√≥ng c·ª≠a) d√πng Qu√° kh·ª© ƒë∆°n.",
                wrong: "Sai v·ªÅ s·ª± ph·ªëi th√¨ (Sequence of tenses) ho·∫∑c sai logic th·ª±c t·∫ø (c·ª≠a h√†ng kh√¥ng th·ªÉ 'r·ªùi ƒëi')."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "must/You / stop / when / the /turn / red / traffic lights/.",
            correct: "You must stop when the traffic lights turn red.",
            wrong: [
                "When you stop the traffic lights must turn red.",
                "The traffic lights must stop when you turn red.",
                "You must turn red when the traffic lights stop."
            ],
            explain: {
                trans: "B·∫°n ph·∫£i d·ª´ng l·∫°i khi ƒë√®n giao th√¥ng chuy·ªÉn ƒë·ªè.",
                vocab: "Traffic lights (ƒê√®n giao th√¥ng), Turn red (Chuy·ªÉn ƒë·ªè)",
                why: "C·∫•u tr√∫c m·ªánh ƒë·ªÅ th·ªùi gian v·ªõi 'When'. Ch·ªß ng·ªØ l√† ng∆∞·ªùi (You) th·ª±c hi·ªán h√†nh ƒë·ªông d·ª´ng (stop).",
                wrong: "C√°c c√¢u sai mang nghƒ©a v√¥ l√Ω (B·∫°n bi·∫øn th√†nh m√†u ƒë·ªè, ho·∫∑c ƒë√®n d·ª´ng l·∫°i)."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "always makes / My / breakfast / mother/ for / me / before / goes / to / she / work/.",
            correct: "My mother always makes breakfast for me before she goes to work.",
            wrong: [
                "Before my mother goes to work she always makes breakfast for me.",
                "My mother goes to work before she always makes breakfast for me.",
                "She always makes breakfast for me before my mother goes to work."
            ],
            explain: {
                trans: "M·∫π t√¥i lu√¥n l√†m b·ªØa s√°ng cho t√¥i tr∆∞·ªõc khi b√† ƒëi l√†m.",
                vocab: "Make breakfast (L√†m b·ªØa s√°ng), Go to work (ƒêi l√†m)",
                why: "Tr·∫°ng t·ª´ t·∫ßn su·∫•t 'always' ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ th∆∞·ªùng 'makes'. M·ªánh ƒë·ªÅ 'before' chia hi·ªán t·∫°i ƒë∆°n.",
                wrong: "C√¢u b·∫Øt ƒë·∫ßu b·∫±ng Before c·∫ßn d·∫•u ph·∫©y. C√¢u C sai tham chi·∫øu (d√πng She tr∆∞·ªõc My mother nghe kh√¥ng thu·∫≠n)."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "is / her / doing / Mai / homework / Nga / while / to / music / is / listening /.",
            correct: "Mai is doing her homework while Nga is listening to music.",
            wrong: [
                "Nga is doing her homework while Mai is listening to music.",
                "Mai is listening to music while Nga is doing her homework.",
                "While Mai is doing her homework Nga is listening to music."
            ],
            explain: {
                trans: "Mai ƒëang l√†m b√†i t·∫≠p trong khi Nga ƒëang nghe nh·∫°c.",
                vocab: "Do homework (L√†m BTVN), Listen to music (Nghe nh·∫°c)",
                why: "Hai h√†nh ƒë·ªông song song ·ªü hi·ªán t·∫°i ti·∫øp di·ªÖn d√πng 'While'. L∆∞u √Ω: ƒê·ªÅ b√†i vi·∫øt hoa Mai -> Mai ƒë·ª©ng ƒë·∫ßu.",
                wrong: "Sai ch·ªß ng·ªØ so v·ªõi t·ª´ vi·∫øt hoa g·ª£i √Ω, ho·∫∑c thi·∫øu d·∫•u ph·∫©y n·∫øu ƒë·∫£o While l√™n ƒë·∫ßu."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "come/to/ She / decided/ even though/to/ didn't/like/the/ party / she / it /.",
            correct: "She decided to come to the party even though she didn't like it.",
            wrong: [
                "Even though she didn't like it she decided to come to the party.",
                "She decided not to come to the party even though she liked it.",
                "She didn't like the party even though she decided to come to it."
            ],
            explain: {
                trans: "C√¥ ·∫•y quy·∫øt ƒë·ªãnh ƒë·∫øn b·ªØa ti·ªác d√π c√¥ ·∫•y kh√¥ng th√≠ch n√≥.",
                vocab: "Decide to V (Quy·∫øt ƒë·ªãnh l√†m g√¨), Even though (M·∫∑c d√π)",
                why: "M·ªánh ƒë·ªÅ nh∆∞·ª£ng b·ªô: M·ªánh ƒë·ªÅ ch√≠nh + even though + M·ªánh ƒë·ªÅ ph·ª•.",
                wrong: "ƒê·∫£o Even though l√™n ƒë·∫ßu thi·∫øu d·∫•u ph·∫©y. C√°c c√¢u kh√°c s·∫Øp x·∫øp l·ªôn x·ªôn t·ª´ 'decided' v√† 'didn't'."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "Can / help / me / you / the / the dishes / wash / while / cleaning / I'm/ floor/?",
            correct: "Can you help me wash the dishes while I'm cleaning the floor?",
            wrong: [
                "Can you help me cleaning the floor while I'm wash the dishes?",
                "While I'm cleaning the floor can you help me wash the dishes?",
                "Can you help me clean the floor while I'm washing the dishes?"
            ],
            explain: {
                trans: "B·∫°n c√≥ th·ªÉ gi√∫p t√¥i r·ª≠a b√°t trong khi t√¥i lau nh√† kh√¥ng?",
                vocab: "Wash dishes (R·ª≠a b√°t), Clean floor (Lau s√†n)",
                why: "Help sb (to) V (help me wash). While + Ti·∫øp di·ªÖn (I'm cleaning).",
                wrong: "Sai c·∫•u tr√∫c Help + Ving, ho·∫∑c d√πng t·ª´ kh√¥ng c√≥ trong ƒë·ªÅ (washing - ƒë·ªÅ ch·ªâ cho wash)."
            }
        },
        {
            type: "S·∫Øp x·∫øp c√¢u",
            q: "lots of / She /eat/ fried food / not good / shouldn't / as /for/your/it/is/ health /.",
            correct: "She shouldn't eat lots of fried food as it is not good for your health.", // Note: 'your' in source implies general advice context mixing
            wrong: [
                "As it is not good for your health she shouldn't eat lots of fried food.",
                "She shouldn't eat fried food as it is lots of not good for your health.",
                "She eat shouldn't lots of fried food as it is not good for your health."
            ],
            explain: {
                trans: "C√¥ ·∫•y kh√¥ng n√™n ƒÉn nhi·ªÅu ƒë·ªì chi√™n r√°n v√¨ n√≥ kh√¥ng t·ªët cho s·ª©c kh·ªèe.",
                vocab: "Fried food (ƒê·ªì chi√™n), As (= Because: V√¨)",
                why: "Shouldn't + V nguy√™n th·ªÉ. As + m·ªánh ƒë·ªÅ gi·∫£i th√≠ch nguy√™n nh√¢n.",
                wrong: "Sai tr·∫≠t t·ª± 'eat shouldn't' ho·∫∑c ƒë·∫∑t m·ªánh ƒë·ªÅ As l√™n ƒë·∫ßu thi·∫øu d·∫•u ph·∫©y."
            }
        },

        // --- EXERCISE 11 (20 c√¢u ƒë·∫ßu) ---
        {
            type: "N·ªëi c√¢u (Combine)",
            q: "A serious road accident happened. We were waiting for the bus yesterday. (while)",
            correct: "A serious road accident happened while we were waiting for the bus yesterday.",
            wrong: [
                "While a serious road accident happened, we were waiting for the bus yesterday.",
                "A serious road accident happened while we waited for the bus yesterday.",
                "We were waiting for the bus yesterday while a serious road accident happened."
            ],
            explain: {
                trans: "M·ªôt v·ª• tai n·∫°n nghi√™m tr·ªçng x·∫£y ra khi ch√∫ng t√¥i ƒëang ƒë·ª£i xe bu√Ωt.",
                vocab: "Accident (Tai n·∫°n), Wait for (ƒê·ª£i)",
                why: "H√†nh ƒë·ªông ng·∫Øn (happened) xen v√†o h√†nh ƒë·ªông d√†i (were waiting). While ƒëi v·ªõi h√†nh ƒë·ªông d√†i.",
                wrong: "D√πng While v·ªõi h√†nh ƒë·ªông ng·∫Øn (happened) l√† kh√¥ng t·ª± nhi√™n trong b·ªëi c·∫£nh n√†y."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "I had to get the mop. I spilled my juice. (since)",
            correct: "I had to get the mop since I spilled my juice.",
            wrong: [
                "Since I had to get the mop, I spilled my juice.",
                "I spilled my juice since I had to get the mop.",
                "I had to get the mop since I spill my juice."
            ],
            explain: {
                trans: "T√¥i ph·∫£i ƒëi l·∫•y c√¢y lau nh√† v√¨ t√¥i l√†m ƒë·ªï n∆∞·ªõc √©p.",
                vocab: "Since (= Because), Mop (C√¢y lau nh√†), Spill (L√†m ƒë·ªï)",
                why: "Since + Nguy√™n nh√¢n (l√†m ƒë·ªï n∆∞·ªõc). M·ªánh ƒë·ªÅ k·∫øt qu·∫£ (l·∫•y c√¢y lau nh√†) ƒë·ª©ng tr∆∞·ªõc ho·∫∑c sau.",
                wrong: "ƒê·∫£o l·ªôn nh√¢n qu·∫£ (L√†m ƒë·ªï n∆∞·ªõc V√å ph·∫£i ƒëi l·∫•y c√¢y lau nh√† -> V√¥ l√Ω)."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "He fell down the ladder. His leg was broken. (and)",
            correct: "He fell down the ladder and his leg was broken.",
            wrong: [
                "His leg was broken and he fell down the ladder.",
                "He fell down the ladder and break his leg.",
                "He fell down the ladder and his leg is broken."
            ],
            explain: {
                trans: "Anh ·∫•y ng√£ thang v√† ch√¢n b·ªã g√£y.",
                vocab: "Ladder (C√°i thang), Broken (B·ªã g√£y)",
                why: "D√πng AND n·ªëi chu·ªói s·ª± ki·ªán theo th·ªùi gian: Ng√£ tr∆∞·ªõc -> G√£y ch√¢n sau.",
                wrong: "Sai tr√¨nh t·ª± th·ªùi gian ho·∫∑c d√πng sai th√¨ (is broken/break) so v·ªõi qu√° kh·ª©."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "We had picked up trash. We left the campsite. (before)",
            correct: "We had picked up trash before we left the campsite.",
            wrong: [
                "Before we had picked up trash, we left the campsite.",
                "We left the campsite before we had picked up trash.",
                "We had picked up trash before we leave the campsite."
            ],
            explain: {
                trans: "Ch√∫ng t√¥i ƒë√£ nh·∫∑t r√°c tr∆∞·ªõc khi r·ªùi khu c·∫Øm tr·∫°i.",
                vocab: "Pick up trash (Nh·∫∑t r√°c), Campsite (Khu tr·∫°i)",
                why: "H√†nh ƒë·ªông x·∫£y ra tr∆∞·ªõc (QKHT): had picked up. H√†nh ƒë·ªông sau (QKƒê): left. Before + h√†nh ƒë·ªông sau.",
                wrong: "Sai v·ªÅ nghƒ©a (R·ªùi ƒëi tr∆∞·ªõc khi nh·∫∑t r√°c) ho·∫∑c sai th√¨."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "It started raining. They were putting up the tent. (when)",
            correct: "It started raining when they were putting up the tent.",
            wrong: [
                "When it started raining, they put up the tent.",
                "They were putting up the tent when it start raining.",
                "It started raining when they put up the tent."
            ],
            explain: {
                trans: "Tr·ªùi b·∫Øt ƒë·∫ßu m∆∞a khi h·ªç ƒëang d·ª±ng l·ªÅu.",
                vocab: "Put up tent (D·ª±ng l·ªÅu)",
                why: "When + m·ªánh ƒë·ªÅ ƒëang di·ªÖn ra (ho·∫∑c m·ªánh ƒë·ªÅ c·∫Øt ngang). ·ªû ƒë√¢y m∆∞a xen v√†o l√∫c ƒëang d·ª±ng l·ªÅu.",
                wrong: "Thay ƒë·ªïi th√¨ c·ªßa h√†nh ƒë·ªông ƒëang di·ªÖn ra (were putting -> put) l√†m m·∫•t √Ω nghƒ©a ti·∫øp di·ªÖn."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "I get my parents' permission. I will go out with my friends. (after)",
            correct: "I will go out with my friends after I get my parents' permission.",
            wrong: [
                "After I will go out with my friends, I get my parents' permission.",
                "I get my parents' permission after I will go out with my friends.",
                "I went out with my friends after I got my parents' permission."
            ],
            explain: {
                trans: "T√¥i s·∫Ω ƒëi ch∆°i sau khi xin ph√©p b·ªë m·∫π.",
                vocab: "Permission (S·ª± cho ph√©p)",
                why: "M·ªánh ƒë·ªÅ th·ªùi gian t∆∞∆°ng lai: After + Hi·ªán t·∫°i ƒë∆°n, T∆∞∆°ng lai ƒë∆°n.",
                wrong: "Sai logic (ƒêi ch∆°i r·ªìi m·ªõi xin ph√©p) ho·∫∑c d√πng sai th√¨ (Will kh√¥ng ƒë·ª©ng sau After)."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "The weather was bad. We were on holiday last month. (when)",
            correct: "The weather was bad when we were on holiday last month.",
            wrong: [
                "We were on holiday last month when the weather is bad.",
                "When the weather was bad, we are on holiday last month.",
                "The weather is bad when we were on holiday last month."
            ],
            explain: {
                trans: "Th·ªùi ti·∫øt r·∫•t t·ªá khi ch√∫ng t√¥i ƒëi ngh·ªâ th√°ng tr∆∞·ªõc.",
                vocab: "Holiday (K·ª≥ ngh·ªâ), Last month (Th√°ng tr∆∞·ªõc)",
                why: "C·∫£ 2 v·∫ø ƒë·ªÅu ·ªü Qu√° kh·ª© ƒë∆°n (was/were) di·ªÖn t·∫£ s·ª± ki·ªán ƒë√£ qua.",
                wrong: "Tr·ªôn l·∫´n th√¨ hi·ªán t·∫°i (is/are) v√†o c√¢u k·ªÉ qu√° kh·ª©."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "I will call my mom. I get the result. (as soon as)",
            correct: "I will call my mom as soon as I get the result.",
            wrong: [
                "As soon as I will call my mom, I get the result.",
                "I call my mom as soon as I will get the result.",
                "I will call my mom as soon as I got the result."
            ],
            explain: {
                trans: "T√¥i s·∫Ω g·ªçi m·∫π ngay khi c√≥ k·∫øt qu·∫£.",
                vocab: "Result (K·∫øt qu·∫£)",
                why: "As soon as + Hi·ªán t·∫°i ƒë∆°n (get), T∆∞∆°ng lai ƒë∆°n (will call).",
                wrong: "Will kh√¥ng ƒë·ª©ng trong m·ªánh ƒë·ªÅ ch·ªâ th·ªùi gian (sau as soon as)."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "It rains. My father usually drives me to school. (when)",
            correct: "When it rains, my father usually drives me to school.",
            wrong: [
                "My father usually drives me to school when it rained.",
                "When my father usually drives me to school, it rains.",
                "It rains when my father usually drove me to school."
            ],
            explain: {
                trans: "Khi tr·ªùi m∆∞a, b·ªë th∆∞·ªùng ch·ªü t√¥i ƒëi h·ªçc.",
                vocab: "Usually (Th∆∞·ªùng xuy√™n), Drive (L√°i xe)",
                why: "C√¢u ch·ªâ th√≥i quen hi·ªán t·∫°i -> D√πng hi·ªán t·∫°i ƒë∆°n c·∫£ 2 v·∫ø.",
                wrong: "Ng∆∞·ª£c logic nh√¢n qu·∫£ (B·ªë ch·ªü ƒëi th√¨ tr·ªùi m·ªõi m∆∞a) ho·∫∑c sai th√¨ (rained)."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "Jack can't play games. He finishes his homework. (before)",
            correct: "Jack can't play games before he finishes his homework.",
            wrong: [
                "Before Jack can't play games, he finishes his homework.",
                "Jack finishes his homework before he can't play games.",
                "Jack couldn't play games before he finishes his homework."
            ],
            explain: {
                trans: "Jack kh√¥ng th·ªÉ ch∆°i game tr∆∞·ªõc khi l√†m xong b√†i t·∫≠p.",
                vocab: "Finish (Ho√†n th√†nh)",
                why: "ƒêi·ªÅu ki·ªán th·ªùi gian ·ªü hi·ªán t·∫°i. Before + V(s/es).",
                wrong: "Nghƒ©a v√¥ l√Ω ho·∫∑c sai th√¨."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "You are in Ha Noi again. You must come and see us then. (when)",
            correct: "When you are in Ha Noi again, you must come and see us.",
            wrong: [
                "You must come and see us when you will be in Ha Noi again.",
                "When you must come and see us, you are in Ha Noi again.",
                "You are in Ha Noi again when you must come and see us."
            ],
            explain: {
                trans: "Khi n√†o b·∫°n ·ªü H√† N·ªôi l·∫ßn n·ªØa, b·∫°n ph·∫£i ƒë·∫øn thƒÉm ch√∫ng t√¥i.",
                vocab: "Come and see (ƒê·∫øn thƒÉm)",
                why: "M·ªánh ƒë·ªÅ th·ªùi gian d√πng hi·ªán t·∫°i ƒë∆°n (are) ƒë·ªÉ ch·ªâ t∆∞∆°ng lai.",
                wrong: "D√πng 'will be' sau When l√† sai ng·ªØ ph√°p trong m·ªánh ƒë·ªÅ th·ªùi gian."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "He finds somewhere to live. Then he'll give his parents the address. (when)",
            correct: "When he finds somewhere to live, he'll give his parents the address.",
            wrong: [
                "He'll give his parents the address when he will find somewhere to live.",
                "When he'll give his parents the address, he finds somewhere to live.",
                "He finds somewhere to live when he'll give his parents the address."
            ],
            explain: {
                trans: "Khi anh ·∫•y t√¨m ƒë∆∞·ª£c n∆°i ·ªü, anh ·∫•y s·∫Ω ƒë∆∞a ƒë·ªãa ch·ªâ cho b·ªë m·∫π.",
                vocab: "Address (ƒê·ªãa ch·ªâ), Find (T√¨m)",
                why: "Tr√¨nh t·ª±: T√¨m nh√† tr∆∞·ªõc (M·ªánh ƒë·ªÅ When - Hi·ªán t·∫°i ƒë∆°n) -> ƒê∆∞a ƒë·ªãa ch·ªâ sau (T∆∞∆°ng lai ƒë∆°n).",
                wrong: "L·ªói ph·ªï bi·∫øn: D√πng th√¨ t∆∞∆°ng lai 'will' ngay sau 'When'."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "I do the shopping. Then I will come back home. (after)",
            correct: "After I do the shopping, I will come back home.",
            wrong: [
                "I do the shopping after I will come back home.",
                "After I will come back home, I do the shopping.",
                "I will come back home after I will do the shopping."
            ],
            explain: {
                trans: "Sau khi t√¥i ƒëi mua s·∫Øm, t√¥i s·∫Ω v·ªÅ nh√†.",
                vocab: "Do shopping (Mua s·∫Øm)",
                why: "After + h√†nh ƒë·ªông x·∫£y ra tr∆∞·ªõc (chia Hi·ªán t·∫°i ƒë∆°n/ho√†n th√†nh). M·ªánh ƒë·ªÅ ch√≠nh T∆∞∆°ng lai ƒë∆°n.",
                wrong: "Sai tr√¨nh t·ª± (V·ªÅ nh√† r·ªìi m·ªõi ƒëi mua s·∫Øm) ho·∫∑c sai ng·ªØ ph√°p (will do)."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "It starts raining. Let's go home before that. (before)",
            correct: "Let's go home before it starts raining.",
            wrong: [
                "Before let's go home, it starts raining.",
                "It starts raining before let's go home.",
                "Let's go home before it will start raining."
            ],
            explain: {
                trans: "H√£y v·ªÅ nh√† tr∆∞·ªõc khi tr·ªùi m∆∞a.",
                vocab: "Let's (H√£y - r·ªß r√™)",
                why: "Before + M·ªánh ƒë·ªÅ th·ªùi gian (Hi·ªán t·∫°i ƒë∆°n).",
                wrong: "C·∫•u tr√∫c Let's kh√¥ng ƒë·ª©ng sau Before. Kh√¥ng d√πng 'will start'."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "She must apologize to him first. He won't speak to her until then. (until)",
            correct: "He won't speak to her until she apologizes to him.",
            wrong: [
                "Until he won't speak to her, she apologizes to him.",
                "She must apologize to him until he won't speak to her.",
                "He won't speak to her until she will apologize to him."
            ],
            explain: {
                trans: "Anh ·∫•y s·∫Ω kh√¥ng n√≥i chuy·ªán cho t·ªõi khi c√¥ ·∫•y xin l·ªói.",
                vocab: "Apologize (Xin l·ªói), Until (Cho t·ªõi khi)",
                why: "Until n·ªëi h√†nh ƒë·ªông ch·ªù ƒë·ª£i. Until + Hi·ªán t·∫°i ƒë∆°n (apologizes).",
                wrong: "L∆∞u √Ω 'apologizes' ph·∫£i th√™m 's' v·ªõi ch·ªß ng·ªØ She. Kh√¥ng d√πng 'will apologize'."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "You leave. I will make you a cup of tea. (before)",
            correct: "I will make you a cup of tea before you leave.",
            wrong: [
                "Before I will make you a cup of tea, you leave.",
                "You leave before I will make you a cup of tea.",
                "I make you a cup of tea before you will leave."
            ],
            explain: {
                trans: "T√¥i s·∫Ω pha tr√† cho b·∫°n tr∆∞·ªõc khi b·∫°n ƒëi.",
                vocab: "Make tea (Pha tr√†)",
                why: "H√†nh ƒë·ªông pha tr√† x·∫£y ra tr∆∞·ªõc l√∫c ƒëi. M·ªánh ƒë·ªÅ ch√≠nh (Will make) + before + Hi·ªán t·∫°i ƒë∆°n (leave).",
                wrong: "ƒê·∫£o l·ªôn tr·∫≠t t·ª± logic (B·∫°n ƒëi r·ªìi m·ªõi pha tr√†??) ho·∫∑c sai ng·ªØ ph√°p."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "She will stay at her aunt's house. She is in London. (while)",
            correct: "She will stay at her aunt's house while she is in London.",
            wrong: [
                "While she will stay at her aunt's house, she is in London.",
                "She is in London while she will stay at her aunt's house.",
                "She will stay at her aunt's house while she will be in London."
            ],
            explain: {
                trans: "C√¥ ·∫•y s·∫Ω ·ªü nh√† d√¨ trong khi c√¥ ·∫•y ·ªü London.",
                vocab: "Aunt (D√¨/C√¥)",
                why: "While + M·ªánh ƒë·ªÅ tr·∫°ng th√°i/k√©o d√†i (is in London).",
                wrong: "Kh√¥ng d√πng 'will be' sau While trong m·ªánh ƒë·ªÅ th·ªùi gian."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "He has read the newspaper. I will borrow it from him. (as soon as)",
            correct: "I will borrow the newspaper from him as soon as he has read it.",
            wrong: [
                "As soon as I will borrow the newspaper, he has read it.",
                "He has read the newspaper as soon as I will borrow it.",
                "I borrow the newspaper from him as soon as he had read it."
            ],
            explain: {
                trans: "T√¥i s·∫Ω m∆∞·ª£n b√°o ngay khi anh ·∫•y ƒë·ªçc xong.",
                vocab: "Borrow (M∆∞·ª£n)",
                why: "Nh·∫•n m·∫°nh vi·ªác ho√†n t·∫•t d√πng Hi·ªán t·∫°i ho√†n th√†nh (has read) sau As soon as. M·ªánh ƒë·ªÅ ch√≠nh T∆∞∆°ng lai ƒë∆°n.",
                wrong: "Logic sai (M∆∞·ª£n r·ªìi m·ªõi ƒë·ªçc xong) ho·∫∑c sai th√¨."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "I have decided the issue. I will let you know. (when)",
            correct: "When I have decided the issue, I will let you know.",
            wrong: [
                "I will let you know when I will decide the issue.",
                "When I let you know, I have decided the issue.",
                "I have decided the issue when I will let you know."
            ],
            explain: {
                trans: "Khi t√¥i quy·∫øt ƒë·ªãnh xong v·∫•n ƒë·ªÅ, t√¥i s·∫Ω cho b·∫°n bi·∫øt.",
                vocab: "Issue (V·∫•n ƒë·ªÅ), Let know (Th√¥ng b√°o)",
                why: "D√πng th√¨ HTHT (have decided) sau When ƒë·ªÉ nh·∫•n m·∫°nh vi·ªác 'quy·∫øt ƒë·ªãnh' ph·∫£i xong xu√¥i r·ªìi m·ªõi b√°o.",
                wrong: "Sai logic h√†nh ƒë·ªông."
            }
        },
        {
            type: "N·ªëi c√¢u",
            q: "They have built a new road. The traffic will be better. (when)",
            correct: "The traffic will be better when they have built a new road.", // Or 'when they build' but source implies completion first
            wrong: [
                "When the traffic will be better, they have built a new road.",
                "They have built a new road when the traffic will be better.",
                "The traffic is better when they had built a new road."
            ],
            explain: {
                trans: "Giao th√¥ng s·∫Ω t·ªët h∆°n khi h·ªç l√†m xong con ƒë∆∞·ªùng m·ªõi.",
                vocab: "Traffic (Giao th√¥ng)",
                why: "ƒêi·ªÅu ki·ªán - K·∫øt qu·∫£. K·∫øt qu·∫£ (T∆∞∆°ng lai) x·∫£y ra sau khi ƒêi·ªÅu ki·ªán (HTHT - l√†m xong) ho√†n t·∫•t.",
                wrong: "Ng∆∞·ª£c logic (Giao th√¥ng t·ªët r·ªìi m·ªõi l√†m ƒë∆∞·ªùng)."
            }
        }
    ];

    // --- GAME LOGIC ---
    let shuffledQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let canAnswer = true;

    // √Çm thanh
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        if(type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
        }
    }

    // Hi·ªáu ·ª©ng ph√°o gi·∫•y
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
    let particles = [];

    function fireConfetti() {
        for(let i=0; i<60; i++) {
            particles.push({
                x: window.innerWidth/2, y: window.innerHeight/2,
                vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
                color: `hsl(${Math.random()*360}, 100%, 50%)`,
                life: 100
            });
        }
    }

    function animateConfetti() {
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        particles.forEach((p,i) => {
            p.x += p.vx; p.y += p.vy; p.vy += 0.5; p.life--;
            ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 8, 8);
            if(p.life <= 0) particles.splice(i,1);
        });
        requestAnimationFrame(animateConfetti);
    }
    animateConfetti();

    // Init Logic
    function init() {
        // Tr·ªôn c√¢u h·ªèi (n·∫øu mu·ªën) - ·ªû ƒë√¢y gi·ªØ th·ª© t·ª± ƒë·ªÉ d·ªÖ theo d√µi b√†i 10 -> 11
        // Nh∆∞ng quan tr·ªçng nh·∫•t l√† TR·ªòN ƒê√ÅP √ÅN
        shuffledQuestions = rawData.map((item, index) => {
            // T·∫°o m·∫£ng ƒë√°p √°n g·ªìm: 1 ƒë√∫ng + c√°c c√¢u sai
            let allOpts = [
                { text: item.correct, isCorrect: true },
                ...item.wrong.map(w => ({ text: w, isCorrect: false }))
            ];
            // Shuffle ƒë√°p √°n
            for (let i = allOpts.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allOpts[i], allOpts[j]] = [allOpts[j], allOpts[i]];
            }
            return { ...item, opts: allOpts, id: index };
        });
        
        loadQuestion();
    }

    function loadQuestion() {
        canAnswer = true;
        const q = shuffledQuestions[currentIdx];
        const percent = ((currentIdx)/rawData.length)*100;
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('nextBtn').style.display = 'none';

        const container = document.getElementById('quizContainer');
        container.innerHTML = `
            <div class="q-card">
                <div class="q-header">
                    <span class="q-number">C√¢u ${currentIdx + 1}/30 (${q.type})</span>
                    <div class="q-text">${q.q}</div>
                </div>
                <div class="options-list">
                    ${q.opts.map((opt, i) => `
                        <div class="option-item" onclick="check(${i}, ${opt.isCorrect})">
                            <span style="font-weight:800; color:var(--primary)">${String.fromCharCode(65+i)}.</span> ${opt.text}
                        </div>
                    `).join('')}
                </div>
                <div class="explanation" id="expBox">
                    <div class="exp-title">üìù GI·∫¢I TH√çCH CHI TI·∫æT C√î MAI AN</div>
                    <div class="exp-body">
                        <div class="exp-row"><strong>üáªüá≥ D·ªãch c√¢u:</strong> ${q.explain.trans}</div>
                        <div class="exp-row"><span class="tag tag-vocab">T·ª´ v·ª±ng</span> ${q.explain.vocab}</div>
                        <div class="exp-row"><span class="tag tag-grammar">Ng·ªØ ph√°p</span> ${q.explain.why}</div>
                        <div class="exp-row" style="background:#fff5f5; padding:10px; border-radius:8px; border:1px dashed #fab1a0">
                            <span class="tag tag-trap">T·∫°i sao c√¢u kia sai?</span> ${q.explain.wrong}
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function check(index, isCorrect) {
        if (!canAnswer) return;
        canAnswer = false;

        const opts = document.querySelectorAll('.option-item');
        opts[index].classList.add(isCorrect ? 'correct' : 'wrong');
        
        // Hi·ªán ƒë√°p √°n ƒë√∫ng n·∫øu ch·ªçn sai
        opts.forEach((opt, i) => {
            opt.classList.add('disabled');
            if(shuffledQuestions[currentIdx].opts[i].isCorrect) {
                opt.classList.add('correct');
            }
        });

        if (isCorrect) {
            score++;
            playTone('correct');
            fireConfetti();
        } else {
            playTone('wrong');
        }

        document.getElementById('expBox').style.display = 'block';
        document.getElementById('expBox').scrollIntoView({behavior: "smooth", block: "nearest"});
        document.getElementById('nextBtn').style.display = 'inline-block';
    }

    function nextQuestion() {
        if (currentIdx < rawData.length - 1) {
            currentIdx++;
            loadQuestion();
            window.scrollTo(0,0);
        } else {
            document.getElementById('finalScore').innerText = `${score}/30`;
            let msg = score >= 25 ? "Xu·∫•t s·∫Øc! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em! üåü" : 
                      score >= 15 ? "Kh√° t·ªët, nh∆∞ng c·∫ßn √¥n l·∫°i c√°c c√¢u sai nh√©! üìö" : 
                      "C·ªë l√™n! H√£y l√†m l·∫°i ƒë·ªÉ n·∫Øm ch·∫Øc ki·∫øn th·ª©c h∆°n nh√©! üí™";
            document.getElementById('finalMsg').innerText = msg;
            document.getElementById('resultOverlay').style.display = 'flex';
            if(score >= 15) fireConfetti();
        }
    }

    // Start
    init();

</script>
</body>
</html>