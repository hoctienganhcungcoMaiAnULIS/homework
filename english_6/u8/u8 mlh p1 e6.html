<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive English Quiz - Ms. Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8854C0; /* T√≠m h·ªìng */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --wrong: #FF4757; /* ƒê·ªè cam */
            --bg: #f0f3f8;
            --card-bg: #ffffff;
            --text: #2f3542;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(#dfe4ea 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-weight: 800;
            font-size: 2.5rem;
        }

        h3 {
            color: #57606f;
            margin-top: 5px;
            font-weight: 600;
        }

        .teacher-badge {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-top: 10px;
            font-weight: bold;
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.1);
            border: 1px solid #e1e1e1;
            position: relative;
        }

        .section-title {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 700;
            margin-bottom: 20px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        /* Question Styles */
        .question-block {
            margin-bottom: 25px;
            border-bottom: 2px dashed #f1f2f6;
            padding-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2f3542;
        }

        /* Buttons & Options */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #dfe4ea;
            padding: 15px;
            border-radius: 15px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #dfe4ea;
            text-align: center;
            position: relative;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #dfe4ea;
        }

        .option-btn.correct {
            background: var(--correct);
            color: white;
            border-color: #00b85b;
            box-shadow: 0 5px 0 #00b85b;
        }

        .option-btn.wrong {
            background: var(--wrong);
            color: white;
            border-color: #ff2e40;
            box-shadow: 0 5px 0 #ff2e40;
            animation: shake 0.5s;
        }

        /* SORT GAME CSS (NEW) */
        .sort-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }
        .sort-card {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 10px;
            text-align: center;
            transition: 0.3s;
        }
        .sort-word {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
            display: block;
        }
        .sort-btns {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .sort-btn-mini {
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .sort-btn-mini:hover { background: #f0f0f0; }
        .sort-btn-mini.correct { background: var(--correct); color: white; border-color: var(--correct); }
        .sort-btn-mini.wrong { background: var(--wrong); color: white; border-color: var(--wrong); }


        /* Gap Fill */
        .gap-fill-container {
            line-height: 2;
            font-size: 1.1rem;
        }
        
        .gap-input {
            border: none;
            border-bottom: 2px solid var(--primary);
            background: #f0f3f8;
            padding: 5px 10px;
            border-radius: 5px;
            color: var(--primary);
            font-weight: bold;
            cursor: pointer;
            min-width: 100px;
            text-align: center;
        }

        /* Explanation Box */
        .explanation {
            display: none;
            background: #fff8e1;
            border-left: 5px solid #ffa502;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            animation: slideDown 0.3s ease-out;
        }

        .explanation h4 {
            margin: 0 0 10px 0;
            color: #d35400;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Animations */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            50% { transform: translateX(5px) rotate(5deg); }
            75% { transform: translateX(-5px) rotate(-5deg); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Glossary Table */
        .glossary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .glossary-table th { background: var(--secondary); color: white; padding: 10px; text-align: left; }
        .glossary-table td { padding: 10px; border-bottom: 1px solid #eee; }

        /* Footer */
        .submit-area {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #6c429c;
            transition: all 0.2s;
        }
        .submit-btn:active { transform: translateY(4px); box-shadow: 0 4px 0 #6c429c; }

        /* Popup */
        .popup {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            z-index: 1000;
            text-align: center;
            width: 80%;
            max-width: 400px;
            border: 5px solid var(--secondary);
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        /* Image Placeholder for Sports */
        .sport-img-placeholder {
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }
        
    </style>
</head>
<body>

<canvas id="confetti" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999;"></canvas>

<div class="container">
    <header>
        <h1>ENGLISH QUIZ</h1>
        <div class="teacher-badge">Gi√°o vi√™n: Ms. Mai An (ULIS)</div>
        <h3>Sports and Games - Phonetics & Vocabulary</h3>
    </header>

    <div class="card">
        <div class="section-title">A. PHONETICS</div>
        
        <div class="question-block">
            <div class="question-text">I. Ch·ªçn nh√≥m √¢m ƒë√∫ng (/e…ô/ ho·∫∑c /…™…ô/) cho t·ª´ng t·ª´ d∆∞·ªõi ƒë√¢y:</div>
            <p><i>Click v√†o n√∫t b√™n d∆∞·ªõi m·ªói t·ª´ ƒë·ªÉ ph√¢n lo·∫°i.</i></p>
            
            <div id="sort-game-area" class="sort-grid">
                </div>
            
            <button class="option-btn" style="margin-top:20px; width:100%; background:#f1f2f6; border-color:#ddd;" onclick="toggleDisplay('phonetic-expl')">Xem Quy T·∫Øc Ph√°t √Çm</button>
            <div id="phonetic-expl" class="explanation">
                <h4><span style="font-size:1.5rem">üë©‚Äçüè´</span> Ms. Mai An gi·∫£i th√≠ch:</h4>
                <p><b>1. √Çm /e…ô/ (Air - Kh√¥ng kh√≠):</b> Th∆∞·ªùng g·∫∑p ·ªü c√°c t·ª´ c√≥ ƒëu√¥i <i>-are, -air, -ear</i> (trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p).</p>
                <ul><li>VD: there, where, share, care, air, stair, square, spare, bear, fare, their.</li></ul>
                <p><b>2. √Çm /…™…ô/ (Ear - C√°i tai):</b> Th∆∞·ªùng g·∫∑p ·ªü c√°c t·ª´ c√≥ ƒëu√¥i <i>-ear, -eer, -ere</i>.</p>
                <ul><li>VD: here, idea, aerobics, near, beer, sphere, hear, career, really, cheer.</li></ul>
            </div>
        </div>

        <div class="question-text">II. Ch·ªçn t·ª´ c√≥ ph·∫ßn g·∫°ch ch√¢n ph√°t √¢m KH√ÅC v·ªõi c√°c t·ª´ c√≤n l·∫°i.</div>
        <div id="quiz-part-2"></div>
    </div>

    <div class="card">
        <div class="section-title">B. VOCABULARY & GRAMMAR</div>
        
        <div class="question-block">
            <div class="question-text">I. ƒê·∫∑t t√™n cho c√°c m√¥n th·ªÉ thao d·ª±a tr√™n h√¨nh ·∫£nh.</div>
            <div id="quiz-part-images" class="options-grid"></div>
        </div>

        <div class="question-block">
            <div class="question-text">II. Ph√¢n lo·∫°i: D√πng PLAY, GO hay DO?</div>
            <p><i>Click v√†o nh√≥m ƒë√∫ng cho t·ª´ v·ª±ng hi·ªÉn th·ªã b√™n d∆∞·ªõi:</i></p>
            
            <div style="text-align:center; margin-bottom:15px;">
                <h2 id="pgd-current-word" style="color:var(--primary); font-size:2rem; border: 2px solid var(--secondary); display:inline-block; padding:10px 30px; border-radius:15px;">badminton</h2>
            </div>

            <div class="options-grid">
                <button class="option-btn" onclick="checkPGD('PLAY')">PLAY</button>
                <button class="option-btn" onclick="checkPGD('GO')">GO</button>
                <button class="option-btn" onclick="checkPGD('DO')">DO</button>
            </div>
            <div id="pgd-expl" class="explanation"></div>
            <p style="text-align:center; margin-top:10px; color:#aaa;">(C√¢u h·ªèi s·∫Ω t·ª± ƒë·ªông chuy·ªÉn sau khi ch·ªçn ƒë√∫ng)</p>
        </div>
    </div>

    <div class="card">
        <div class="section-title">C. READING & WRITING</div>

        <div class="question-text">III. Ho√†n th√†nh c√¢u v·ªõi t·ª´ trong khung.</div>
        <div style="background:#fff3cd; padding:15px; border-radius:10px; margin-bottom:20px; text-align:center; font-weight:bold; color:#856404;">
            goggles | racket | skateboard | skis | ring | paddle | running shoes | gloves
        </div>

        <div id="gap-fill-container"></div>
    </div>

    <div class="card">
        <div class="section-title">D. MULTIPLE CHOICE (READING)</div>
        <div class="question-text">IV. ƒê·ªçc ƒëo·∫°n vƒÉn v√† ch·ªçn ƒë√°p √°n ƒë√∫ng.</div>
        
        <div style="line-height: 1.8; font-size: 1.1rem; text-align: justify;">
            You want to do sport, but you don't know which sport to choose.
            (1) <span id="mc-1"></span> is fun, but it's expensive and you can only do it in winter. 
            Cycling is good exercise, but you must buy a (2) <span id="mc-2"></span> and a (3) <span id="mc-3"></span>.
            How about (4) <span id="mc-4"></span>? It doesn't cost any money and you can do it any time and any place. 
            You only need some good trainers, some comfortable clothes - and the Runkeeper smartphone app. 
            With this app you can see your distance and your speed. 
            Do you prefer to exercise at a sports club? You don't need an expensive personal trainer. 
            You can use Runkeeper while you are (5) <span id="mc-5"></span> on an exercise bike or while you are jumping and kicking in a (6) <span id="mc-6"></span> lesson. 
            You can't lose with this incredible app!
        </div>

        <div class="glossary-table-container">
            <h4>üìñ GLOSSARY (B·∫£ng t·ª´ v·ª±ng B1-C2)</h4>
            <table class="glossary-table">
                <thead><tr><th>Word</th><th>Type</th><th>Meaning</th></tr></thead>
                <tbody>
                    <tr><td>expensive</td><td>(adj)</td><td>ƒê·∫Øt ƒë·ªè, t·ªën k√©m</td></tr>
                    <tr><td>comfortable</td><td>(adj)</td><td>Tho·∫£i m√°i, d·ªÖ ch·ªãu</td></tr>
                    <tr><td>distance</td><td>(n)</td><td>Kho·∫£ng c√°ch, qu√£ng ƒë∆∞·ªùng</td></tr>
                    <tr><td>incredible</td><td>(adj)</td><td>Kh√¥ng th·ªÉ tin ƒë∆∞·ª£c (tuy·ªát v·ªùi)</td></tr>
                    <tr><td>personal trainer</td><td>(n)</td><td>Hu·∫•n luy·ªán vi√™n c√° nh√¢n</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="submit-area">
        <button class="submit-btn" onclick="submitQuiz()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button>
    </div>

</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="result-popup">
    <h2>K·∫æT QU·∫¢</h2>
    <p style="font-size:3rem; margin:10px 0;" id="final-score">0/0</p>
    <p id="feedback-msg">C·ªë l√™n nh√©!</p>
    <button class="option-btn" onclick="closePopup()">Xem l·∫°i b√†i</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
    // --- DATA ---
    const sortWordsData = [
        {w:"here", g:"ie"}, {w:"there", g:"ea"}, {w:"idea", g:"ie"}, {w:"where", g:"ea"},
        {w:"aerobics", g:"ie"}, {w:"near", g:"ie"}, {w:"share", g:"ea"}, {w:"beer", g:"ie"},
        {w:"care", g:"ea"}, {w:"air", g:"ea"}, {w:"stair", g:"ea"}, {w:"sphere", g:"ie"},
        {w:"hear", g:"ie"}, {w:"career", g:"ie"}, {w:"square", g:"ea"}, {w:"really", g:"ie"},
        {w:"cheer", g:"ie"}, {w:"spare", g:"ea"}, {w:"bear", g:"ea"}, {w:"fare", g:"ea"},
        {w:"their", g:"ea"}
    ];

    const part2Data = [
        {
            q: "1. a. f<u>ear</u>, b. n<u>ear</u>, c. r<u>ea</u>lly, d. w<u>ea</u>r",
            options: [{text: "fear", type: "A"}, {text: "near", type: "B"}, {text: "really", type: "C"}, {text: "wear", type: "D"}],
            correct: 3, 
            expl: {vocab: "A. fear /f…™…ô/; B. near /n…™…ô/; C. really /Ààr…™…ôli/; D. wear /we…ô/.", trans: "T√¨m t·ª´ ph√°t √¢m kh√°c.", why: "D l√† /e…ô/, c√≤n l·∫°i /…™…ô/.", wrong: "A, B, C ƒë·ªÅu /…™…ô/."}
        },
        {
            q: "2. a. th<u>ei</u>r, b. h<u>ai</u>r, c. s<u>e</u>ries, d. th<u>e</u>re",
            options: [{text: "their", type: "A"}, {text: "hair", type: "B"}, {text: "series", type: "C"}, {text: "there", type: "D"}],
            correct: 2,
            expl: {vocab: "A. their /√∞e…ô/; B. hair /he…ô/; C. series /Ààs…™…ôriÀêz/; D. there /√∞e…ô/.", trans: "T√¨m t·ª´ ph√°t √¢m kh√°c.", why: "C l√† /…™…ô/, c√≤n l·∫°i /e…ô/.", wrong: "A, B, D ƒë·ªÅu /e…ô/."}
        },
        {
            q: "3. a. sp<u>a</u>re, b. pl<u>a</u>y, c. g<u>a</u>me, d. t<u>a</u>ble",
            options: [{text: "spare", type: "A"}, {text: "play", type: "B"}, {text: "game", type: "C"}, {text: "table", type: "D"}],
            correct: 0,
            expl: {vocab: "A. spare /spe…ô/; B. play /ple…™/; C. game /ge…™m/; D. table /Ààte…™bl/.", trans: "T√¨m t·ª´ ph√°t √¢m kh√°c.", why: "A l√† /e…ô/, c√≤n l·∫°i /e…™/.", wrong: "B, C, D ƒë·ªÅu /e…™/."}
        },
        {
            q: "4. a. k<u>ee</u>p, b. ch<u>ee</u>r, c. m<u>ee</u>t, d. w<u>ee</u>k",
            options: [{text: "keep", type: "A"}, {text: "cheer", type: "B"}, {text: "meet", type: "C"}, {text: "week", type: "D"}],
            correct: 1,
            expl: {vocab: "A. keep /kiÀêp/; B. cheer /t É…™…ô/; C. meet /miÀêt/; D. week /wiÀêk/.", trans: "T√¨m t·ª´ ph√°t √¢m kh√°c.", why: "B l√† /…™…ô/, c√≤n l·∫°i /iÀê/.", wrong: "A, C, D ƒë·ªÅu /iÀê/."}
        },
        {
            q: "5. a. sph<u>e</u>re, b. s<u>e</u>ries, c. h<u>e</u>re, d. wh<u>e</u>re",
            options: [{text: "sphere", type: "A"}, {text: "series", type: "B"}, {text: "here", type: "C"}, {text: "where", type: "D"}],
            correct: 3,
            expl: {vocab: "A. sphere /sf…™…ô/; B. series /Ààs…™…ôriÀêz/; C. here /h…™…ô/; D. where /we…ô/.", trans: "T√¨m t·ª´ ph√°t √¢m kh√°c.", why: "D l√† /e…ô/, c√≤n l·∫°i /…™…ô/.", wrong: "A, B, C ƒë·ªÅu /…™…ô/."}
        }
    ];

    const imageQuizData = [
        { img: "ü•ã", label: "Fighting (Two people)", ans: "judo", opts: ["judo", "boxing", "karate"], correct: "karate", note: "H√¨nh 1: ƒê·ªì v√µ tr·∫Øng -> Karate." },
        { img: "üèì", label: "Table + Bat + Ball", ans: "table tennis", opts: ["tennis", "table tennis", "badminton"], correct: "table tennis", note: "H√¨nh 2: B√†n b√≥ng b√†n -> Table tennis." },
        { img: "üö¥", label: "Bikes on slope", ans: "cycling", opts: ["cycling", "driving", "riding"], correct: "cycling", note: "H√¨nh 3: ƒê·∫°p xe -> Cycling." },
        { img: "‚õ∑Ô∏è", label: "Snow + Sticks", ans: "skiing", opts: ["skating", "skiing", "hiking"], correct: "skiing", note: "H√¨nh 4: Tr∆∞·ª£t tuy·∫øt -> Skiing." },
        { img: "ü•ä", label: "Gloves + Punching", ans: "boxing", opts: ["boxing", "karate", "wrestling"], correct: "boxing", note: "H√¨nh 5: ƒê·∫•m b·ªëc -> Boxing." },
        { img: "ü§∏", label: "Stretching/Dancing", ans: "aerobics", opts: ["yoga", "aerobics", "gymnastics"], correct: "aerobics", note: "H√¨nh 6: Th·ªÉ d·ª•c nh·ªãp ƒëi·ªáu -> Aerobics." },
        { img: "üõπ", label: "Boy on board", ans: "skateboarding", opts: ["skating", "skateboarding", "cycling"], correct: "skateboarding", note: "H√¨nh 7: Tr∆∞·ª£t v√°n -> Skateboarding." },
        { img: "üèÉ", label: "Many people running", ans: "marathon", opts: ["jogging", "marathon", "walking"], correct: "marathon", note: "H√¨nh 8: Ch·∫°y ƒëua ƒë∆∞·ªùng d√†i -> Marathon." },
        { img: "üéæ", label: "Racket + Yellow ball", ans: "tennis", opts: ["badminton", "tennis", "golf"], correct: "tennis", note: "H√¨nh 9: Qu·∫ßn v·ª£t -> Tennis." },
        { img: "üèê", label: "Net + Jumping + Ball", ans: "volleyball", opts: ["basketball", "volleyball", "football"], correct: "volleyball", note: "H√¨nh 10: B√≥ng chuy·ªÅn -> Volleyball." }
    ];

    const pgdWords = [
        {w: "badminton", t: "PLAY", e: "M√¥n th·ªÉ thao c√≥ b√≥ng/c·∫ßu v√† ƒë·ªëi kh√°ng."},
        {w: "karate", t: "DO", e: "M√¥n v√µ thu·∫≠t (Martial arts) d√πng DO."},
        {w: "football", t: "PLAY", e: "M√¥n b√≥ng ƒë√° (Team sport) d√πng PLAY."},
        {w: "cycling", t: "GO", e: "ƒê·ªông t·ª´ V-ing (ho·∫°t ƒë·ªông di chuy·ªÉn) d√πng GO."},
        {w: "yoga", t: "DO", e: "B√†i t·∫≠p t·∫°i ch·ªó/th·ªÉ d·ª•c nh·ªãp ƒëi·ªáu d√πng DO."},
        {w: "swimming", t: "GO", e: "ƒêu√¥i -ing -> Go swimming."},
        {w: "boxing", t: "DO", e: "V√µ thu·∫≠t d√πng DO."},
        {w: "tennis", t: "PLAY", e: "M√¥n c√≥ b√≥ng/v·ª£t -> Play."},
        {w: "aerobics", t: "DO", e: "Th·ªÉ d·ª•c nh·ªãp ƒëi·ªáu -> Do aerobics."},
        {w: "skateboarding", t: "GO", e: "ƒêu√¥i -ing -> Go skateboarding."},
        {w: "basketball", t: "PLAY", e: "M√¥n b√≥ng r·ªï -> Play."},
        {w: "hiking", t: "GO", e: "ƒêi b·ªô ƒë∆∞·ªùng d√†i (-ing) -> Go hiking."},
        {w: "judo", t: "DO", e: "V√µ thu·∫≠t -> Do judo."},
        {w: "skiing", t: "GO", e: "Tr∆∞·ª£t tuy·∫øt (-ing) -> Go skiing."},
        {w: "soccer", t: "PLAY", e: "B√≥ng ƒë√° -> Play."},
        {w: "gymnastics", t: "DO", e: "Th·ªÉ d·ª•c d·ª•ng c·ª• -> Do gymnastics."},
        {w: "jogging", t: "GO", e: "Ch·∫°y b·ªô (-ing) -> Go jogging."},
        {w: "golf", t: "PLAY", e: "M√¥n g√¥n -> Play golf."}
    ];

    const gapFillData = [
        { q: "1. All we need to run is good __________.", a: "running shoes", expl: "Run -> c·∫ßn 'running shoes'." },
        { q: "2. They fight in a square area with ropes around it, called a boxing __________.", a: "ring", expl: "S√†n boxing -> 'boxing ring'." },
        { q: "3. __________ are special glasses that fit closely to the face to protect the eyes...", a: "goggles", expl: "K√≠nh b·∫£o v·ªá m·∫Øt -> 'goggles'." },
        { q: "4. In boxing, the fighters wear large leather boxing __________ on their hands.", a: "gloves", expl: "GƒÉng tay -> 'gloves'." },
        { q: "5. Shall we play table tennis? - Great! Can you lend me a __________?", a: "paddle", expl: "V·ª£t b√≥ng b√†n -> 'paddle'." },
        { q: "6. He threw his tennis __________ across the court in anger.", a: "racket", expl: "V·ª£t tennis -> 'racket'." },
        { q: "7. When we put __________ on we can move over snow easily.", a: "skis", expl: "V√°n tr∆∞·ª£t tuy·∫øt -> 'skis'." },
        { q: "8. He sometimes rides his __________ to school.", a: "skateboard", expl: "Tr∆∞·ª£t v√°n -> 'skateboard'." }
    ];

    const mcReadingData = [
        {id: "mc-1", opts: ["Gymnastics", "Surfing", "Skiing"], ans: "Skiing", expl: "'Only in winter' -> Skiing."},
        {id: "mc-2", opts: ["racket", "bicycle", "net"], ans: "bicycle", expl: "'Cycling' -> Bicycle."},
        {id: "mc-3", opts: ["helmet", "swimming cap", "skateboard"], ans: "helmet", expl: "ƒê·∫°p xe c·∫ßn 'helmet' (m≈© b·∫£o hi·ªÉm)."},
        {id: "mc-4", opts: ["bowling", "running", "scuba diving"], ans: "running", expl: "'No cost, good trainers' -> Running."},
        {id: "mc-5", opts: ["cycling", "surfing", "weightlifting"], ans: "cycling", expl: "'Exercise bike' -> cycling."},
        {id: "mc-6", opts: ["karate", "volleyball", "basketball"], ans: "karate", expl: "'Kicking' -> Karate."}
    ];

    // --- LOGIC ---
    let totalScore = 0;
    // Calculate total possible score
    let maxScore = sortWordsData.length + part2Data.length + imageQuizData.length + pgdWords.length + gapFillData.length + mcReadingData.length;
    let currentPGDIndex = 0;

    function playSound(isCorrect) {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        if(isCorrect) {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(500, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        }
    }

    function toggleDisplay(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    // --- NEW: RENDER SORTING GAME (PART 1) ---
    function renderSortGame() {
        const container = document.getElementById('sort-game-area');
        sortWordsData.forEach((item, index) => {
            const html = `
            <div class="sort-card" id="sort-card-${index}">
                <span class="sort-word">${item.w}</span>
                <div class="sort-btns">
                    <button class="sort-btn-mini" onclick="checkSort(${index}, 'ea', this)">/e…ô/</button>
                    <button class="sort-btn-mini" onclick="checkSort(${index}, 'ie', this)">/…™…ô/</button>
                </div>
            </div>`;
            container.innerHTML += html;
        });
    }

    function checkSort(index, type, btn) {
        const item = sortWordsData[index];
        const card = document.getElementById(`sort-card-${index}`);
        const buttons = card.querySelectorAll('.sort-btn-mini');
        
        // Disable buttons
        buttons.forEach(b => b.disabled = true);

        if (type === item.g) {
            btn.classList.add('correct');
            card.style.borderColor = 'var(--correct)';
            card.style.background = '#e6fffa';
            playSound(true);
            totalScore++;
        } else {
            btn.classList.add('wrong');
            card.style.borderColor = 'var(--wrong)';
            card.style.animation = 'shake 0.5s';
            playSound(false);
            // Highlight correct one
            buttons.forEach(b => {
                if(b.innerText.includes(item.g === 'ea' ? 'e…ô' : '…™…ô')) {
                    b.style.border = "2px solid var(--correct)";
                    b.style.color = "var(--correct)";
                }
            });
        }
    }

    // --- RENDER PART 2 ---
    function renderPart2() {
        const container = document.getElementById('quiz-part-2');
        part2Data.forEach((item, index) => {
            let html = `<div class="question-block">
                <div class="question-text">${item.q}</div>
                <div class="options-grid">`;
            item.options.forEach((opt, optIndex) => {
                html += `<button class="option-btn" id="p2-q${index}-o${optIndex}" onclick="checkPart2(${index}, ${optIndex})">${opt.text}</button>`;
            });
            html += `</div>
                <div id="p2-expl-${index}" class="explanation">
                    <h4>üë©‚Äçüè´ Ms. Mai An gi·∫£i th√≠ch:</h4>
                    <p><b>D·ªãch:</b> ${item.expl.vocab}</p>
                    <p><b>T·∫°i sao:</b> ${item.expl.why}</p>
                </div>
            </div>`;
            container.innerHTML += html;
        });
    }

    function checkPart2(qIndex, optIndex) {
        const item = part2Data[qIndex];
        const correct = item.correct;
        for(let i=0; i<4; i++) {
            const btn = document.getElementById(`p2-q${qIndex}-o${i}`);
            btn.disabled = true;
            if(i === correct) btn.classList.add('correct');
            else if(i === optIndex) btn.classList.add('wrong');
        }
        const isCorrect = (optIndex === correct);
        playSound(isCorrect);
        if(isCorrect) {
            confetti({ particleCount: 30, spread: 60, origin: { y: 0.6 } });
            totalScore++;
        }
        document.getElementById(`p2-expl-${qIndex}`).style.display = 'block';
    }

    // --- RENDER IMAGES QUIZ ---
    function renderImageQuiz() {
        const container = document.getElementById('quiz-part-images');
        imageQuizData.forEach((item, index) => {
            let optsHtml = '';
            item.opts.forEach(opt => {
                optsHtml += `<option value="${opt}">${opt}</option>`;
            });

            const html = `
            <div style="background:#fff; padding:15px; border-radius:15px; text-align:center; border:1px solid #eee;">
                <div class="sport-img-placeholder">${item.img}</div>
                <p style="font-size:0.8rem; color:#aaa;">${item.label}</p>
                <select id="img-q${index}" onchange="checkImage(${index}, this)" style="padding:10px; border-radius:10px; border:2px solid #ddd; width:100%;">
                    <option value="">-- Ch·ªçn t√™n --</option>
                    ${optsHtml}
                </select>
                <div id="img-res-${index}" style="margin-top:5px; font-weight:bold;"></div>
            </div>`;
            container.innerHTML += html;
        });
    }

    function checkImage(index, select) {
        const val = select.value;
        const item = imageQuizData[index];
        const resDiv = document.getElementById(`img-res-${index}`);
        if(val === item.correct) {
            select.style.borderColor = 'var(--correct)';
            select.style.background = '#e6fffa';
            resDiv.innerHTML = `<span style="color:var(--correct)">‚úî ${item.correct}</span>`;
            playSound(true);
            totalScore++;
            select.disabled = true;
        } else {
            select.style.borderColor = 'var(--wrong)';
            resDiv.innerHTML = `<span style="color:var(--wrong)">‚úò Th·ª≠ l·∫°i!</span>`;
            playSound(false);
        }
    }

    // --- PLAY GO DO ---
    function checkPGD(choice) {
        if(currentPGDIndex >= pgdWords.length) return;
        const currentWord = pgdWords[currentPGDIndex];
        const explDiv = document.getElementById('pgd-expl');
        if(choice === currentWord.t) {
            playSound(true);
            explDiv.style.display = 'block';
            explDiv.innerHTML = `<span style="color:green; font-weight:bold;">‚úî CH√çNH X√ÅC!</span> ${currentWord.w.toUpperCase()} ƒëi v·ªõi ${currentWord.t}. (${currentWord.e})`;
            totalScore++;
            setTimeout(() => {
                currentPGDIndex++;
                if(currentPGDIndex < pgdWords.length) {
                    document.getElementById('pgd-current-word').innerText = pgdWords[currentPGDIndex].w;
                    explDiv.style.display = 'none';
                } else {
                    document.getElementById('pgd-current-word').innerText = "HO√ÄN TH√ÄNH!";
                    explDiv.innerHTML = "Ch√∫c m·ª´ng b·∫°n ƒë√£ ho√†n th√†nh!";
                }
            }, 1500);
        } else {
            playSound(false);
            explDiv.style.display = 'block';
            explDiv.innerHTML = `<span style="color:red; font-weight:bold;">‚úò SAI!</span> ${currentWord.w} kh√¥ng ƒëi v·ªõi ${choice}.`;
        }
    }

    // --- GAP FILL ---
    function renderGapFill() {
        const container = document.getElementById('gap-fill-container');
        gapFillData.forEach((item, index) => {
            const html = `
            <div style="margin-bottom:15px; background:#fafbff; padding:15px; border-radius:10px;">
                <p><b>Q${index+1}:</b> ${item.q.replace('__________', `<select id="gf-${index}" onchange="checkGapFill(${index}, this)">
                    <option value="">...</option>
                    <option value="running shoes">running shoes</option>
                    <option value="ring">ring</option>
                    <option value="goggles">goggles</option>
                    <option value="gloves">gloves</option>
                    <option value="paddle">paddle</option>
                    <option value="racket">racket</option>
                    <option value="skis">skis</option>
                    <option value="skateboard">skateboard</option>
                </select>`)}</p>
                <div id="gf-expl-${index}" class="explanation"></div>
            </div>`;
            container.innerHTML += html;
        });
    }

    function checkGapFill(index, select) {
        const val = select.value;
        const item = gapFillData[index];
        const explDiv = document.getElementById(`gf-expl-${index}`);
        if(val === item.a) {
            select.style.background = '#00D26A'; select.style.color = 'white';
            explDiv.style.display = 'block';
            explDiv.innerHTML = `<h4>üëè Ms. Mai An gi·∫£i th√≠ch:</h4> ${item.expl}`;
            playSound(true);
            totalScore++;
            select.disabled = true;
        } else {
            select.style.background = '#FF4757'; select.style.color = 'white';
            playSound(false);
        }
    }

    // --- READING MC ---
    function renderReadingMC() {
        mcReadingData.forEach(item => {
            const span = document.getElementById(item.id);
            let html = '';
            item.opts.forEach(opt => {
                html += `<button class="option-btn" style="padding:5px 10px; margin:2px; font-size:0.9rem;" onclick="checkMCReading('${item.id}', '${opt}', '${item.ans}', this, '${item.expl.replace(/'/g, "\\'")}')">${opt}</button>`;
            });
            span.innerHTML = html;
        });
    }

    function checkMCReading(id, selected, correct, btn, explText) {
        const parent = document.getElementById(id);
        const buttons = parent.getElementsByTagName('button');
        for(let b of buttons) {
            b.disabled = true;
            if(b.innerText === correct) b.classList.add('correct');
            else if(b.innerText === selected) b.classList.add('wrong');
        }
        if(selected === correct) {
            playSound(true);
            totalScore++;
            confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
        } else {
            playSound(false);
        }
        if(!parent.querySelector('.mc-expl')) {
            const div = document.createElement('div');
            div.className = 'explanation mc-expl';
            div.style.display = 'block'; div.style.marginTop = '10px';
            div.innerHTML = `<b>üí° Gi·∫£i th√≠ch:</b> ${explText}`;
            parent.parentNode.insertBefore(div, parent.nextSibling);
        }
    }

    // --- SUBMIT ---
    function submitQuiz() {
        const popup = document.getElementById('result-popup');
        const overlay = document.getElementById('overlay');
        const scoreText = document.getElementById('final-score');
        const feedback = document.getElementById('feedback-msg');

        scoreText.innerText = `${totalScore} / ${maxScore}`;
        
        if(totalScore > maxScore * 0.8) feedback.innerText = "Tuy·ªát v·ªùi! B·∫°n l√† si√™u nh√¢n ti·∫øng Anh! üèÜ";
        else if (totalScore > maxScore * 0.5) feedback.innerText = "L√†m t·ªët l·∫Øm! C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! üí™";
        else feedback.innerText = "ƒê·ª´ng bu·ªìn, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch nh√©! üìö";

        popup.style.display = 'block';
        overlay.style.display = 'block';
        confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
    }

    function closePopup() {
        document.getElementById('result-popup').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    // INIT
    renderSortGame();
    renderPart2();
    renderImageQuiz();
    renderGapFill();
    renderReadingMC();

</script>
</body>
</html>