<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i T·∫≠p Li√™n T·ª´ - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #8854C0; /* H·ªìng nh·∫°t / T√≠m Pastel */
            --secondary: #00C9A7; /* Xanh ng·ªçc */
            --correct: #00D26A; /* Xanh l√° */
            --incorrect: #FF4757; /* ƒê·ªè cam */
            --bg-color: #f8f4ff;
            --text-main: #333333;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; font-family: 'Nunito', sans-serif; }

        body {
            margin: 0; padding: 20px; background-color: var(--bg-color);
            background-image: radial-gradient(var(--secondary) 10%, transparent 11%), radial-gradient(var(--secondary) 10%, transparent 11%);
            background-size: 60px 60px; background-position: 0 0, 30px 30px;
            background-attachment: fixed; color: var(--text-main);
        }

        .header-container {
            background: linear-gradient(135deg, var(--primary), #a675e8);
            color: white; text-align: center; padding: 20px; border-radius: 20px;
            box-shadow: 0 8px 0 #6a3a9e; margin: 0 auto 40px auto; max-width: 900px;
        }
        .header-container h1 { margin: 0; font-family: 'Quicksand', sans-serif; font-weight: 900; font-size: 28px; }

        .quiz-container { max-width: 900px; margin: 0 auto; }
        .part-title {
            background-color: var(--secondary); color: #fff; display: inline-block; padding: 10px 25px;
            border-radius: 15px; font-weight: 800; font-size: 20px; box-shadow: 0 5px 0 #009e83;
            margin: 30px 0 20px 0; width: 100%; text-align: center; text-transform: uppercase;
        }

        .question-card {
            background: var(--card-bg); border-radius: 20px; padding: 25px; margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1); border: 3px solid #eee; transition: transform 0.2s;
        }
        .question-card:hover { border-color: var(--secondary); }

        .question-text { font-size: 20px; font-weight: 800; margin-bottom: 20px; line-height: 1.5; color: #2d3436; }
        .question-text span.blank { display: inline-block; min-width: 80px; border-bottom: 3px dashed var(--primary); text-align: center; color: var(--primary); padding: 0 10px; font-weight: 900;}

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .option-btn {
            background: #fff; border: 2px solid #e0e0e0; border-radius: 15px; padding: 15px 20px;
            font-size: 18px; font-weight: 700; color: #555; cursor: pointer; box-shadow: 0 6px 0 #e0e0e0;
            transition: all 0.1s ease; text-align: left; display: flex; align-items: center; line-height: 1.4;
        }
        .option-btn .opt-letter {
            background: #f1f2f6; min-width: 30px; height: 30px; display: flex; align-items: center;
            justify-content: center; border-radius: 50%; margin-right: 15px; font-weight: 900; color: #999; flex-shrink: 0;
        }
        .option-btn:hover:not(:disabled) { transform: translateY(2px); box-shadow: 0 4px 0 #e0e0e0; border-color: var(--secondary); }
        .option-btn:active:not(:disabled) { transform: translateY(6px); box-shadow: 0 0px 0 #e0e0e0; }
        
        .option-btn.correct { background: var(--correct); border-color: var(--correct); color: white; box-shadow: 0 6px 0 #00a653; }
        .option-btn.correct .opt-letter { background: rgba(255,255,255,0.3); color: white;}
        .option-btn.incorrect { background: var(--incorrect); border-color: var(--incorrect); color: white; box-shadow: 0 6px 0 #cc3945; }
        .option-btn.incorrect .opt-letter { background: rgba(255,255,255,0.3); color: white;}
        .option-btn:disabled { cursor: not-allowed; opacity: 0.9; }

        .explanation-box {
            display: none; margin-top: 20px; background: #fdf2f8; border: 2px dashed var(--primary);
            border-radius: 15px; padding: 20px; animation: fadeIn 0.5s ease-in-out;
        }
        .explanation-box h4 { margin-top: 0; color: var(--primary); font-family: 'Quicksand', sans-serif; font-size: 20px; }
        .explanation-box p { margin: 10px 0; font-size: 16px; line-height: 1.6; }
        .tag-correct { color: var(--correct); font-weight: 800; }
        .tag-incorrect { color: var(--incorrect); font-weight: 800; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25%, 75% { transform: translateX(-8px) rotate(-1deg); }
            50% { transform: translateX(8px) rotate(1deg); }
        }
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }

        .submit-area { text-align: center; margin: 50px 0; }
        .btn-submit {
            background: linear-gradient(135deg, var(--secondary), #009e83); color: white; font-size: 24px; font-weight: 900;
            padding: 15px 50px; border: none; border-radius: 25px; cursor: pointer; box-shadow: 0 8px 0 #007a65;
            text-transform: uppercase; transition: all 0.2s;
        }
        .btn-submit:hover { transform: translateY(3px); box-shadow: 0 5px 0 #007a65; }
        .btn-submit:active { transform: translateY(8px); box-shadow: 0 0 0 #007a65; }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;
        }
        .score-modal {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 500px; width: 90%; animation: fadeIn 0.3s;
        }
        .score-modal h2 { color: var(--primary); font-size: 32px; margin-bottom: 10px; }
        .score-number { font-size: 60px; font-weight: 900; color: var(--correct); margin: 20px 0; }
        
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="header-container">
        <h1><i class="fas fa-link"></i> Ms Mai An ULIS - Connectors Quiz</h1>
        <p>Th√†nh th·∫°o Although, However, Despite, In spite of</p>
    </div>

    <div class="quiz-container" id="quiz-container"></div>

    <div class="submit-area">
        <button class="btn-submit" onclick="showScore()"><i class="fas fa-flag-checkered"></i> N·ªôp B√†i Ngay</button>
    </div>

    <div class="modal-overlay" id="scoreModal">
        <div class="score-modal">
            <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n!</h2>
            <p id="score-message"></p>
            <div class="score-number" id="score-display">0/0</div>
            <button class="btn-submit" style="font-size: 18px; padding: 10px 30px;" onclick="location.reload()">Luy·ªán T·∫≠p L·∫°i</button>
        </div>
    </div>

<script>
// --- AUDIO ENGINE ---
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function initAudio() { if (!audioCtx) audioCtx = new AudioContext(); }
function playSound(type) {
    initAudio(); if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator(); const gainNode = audioCtx.createGain();
    osc.connect(gainNode); gainNode.connect(audioCtx.destination);
    if (type === 'correct') {
        osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    } else {
        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.3);
        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start(); osc.stop(audioCtx.currentTime + 0.4);
    }
}

// --- FULL DATABASE (30 C√ÇU H·ªéI SI√äU CHI TI·∫æT) ---
const quizData = [
    { type: 'title', text: "Part 4: Connectors (although/though vs however/nevertheless)" },
    {
        id: 1, q: "I am going shopping. ________, It rains.",
        opts: ["However", "Although", "Despite", "Because"], ans: 0,
        trans: "T√¥i s·∫Ω ƒëi mua s·∫Øm. Tuy nhi√™n, tr·ªùi l·∫°i m∆∞a.",
        optTrans: "A. However: Tuy nhi√™n | B. Although: M·∫∑c d√π (+ M·ªánh ƒë·ªÅ) | C. Despite: M·∫∑c d√π (+ N/V-ing) | D. Because: B·ªüi v√¨",
        right: "Ch·ªó tr·ªëng ƒë·ª©ng sau d·∫•u ch·∫•m (.) v√† tr∆∞·ªõc d·∫•u ph·∫©y (,), k·∫øt n·ªëi 2 c√¢u ƒë·ªôc l·∫≠p mang nghƒ©a t∆∞∆°ng ph·∫£n. Ch·ªâ c√≥ <b>However</b> (ho·∫∑c Nevertheless) l√† ph√π h·ª£p lu·∫≠t d·∫•u c√¢u n√†y.",
        wrong: "Although v√† Because d√πng ƒë·ªÉ n·ªëi 2 m·ªánh ƒë·ªÅ trong c√πng m·ªôt c√¢u, kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u th·ª© hai r·ªìi ph·∫©y m·ªôt c√°i. Despite ph·∫£i ƒëi v·ªõi C·ª•m danh t·ª´."
    },
    {
        id: 2, q: "I have studied hard for the exam. I, ________, failed.",
        opts: ["however", "although", "despite", "therefore"], ans: 0,
        trans: "T√¥i ƒë√£ h·ªçc r·∫•t chƒÉm ch·ªâ cho k·ª≥ thi. Tuy nhi√™n, t√¥i ƒë√£ tr∆∞·ª£t.",
        optTrans: "A. however: Tuy nhi√™n | B. although: M·∫∑c d√π | C. despite: M·∫∑c d√π | D. therefore: V√¨ v·∫≠y",
        right: "ƒê√¢y l√† c·∫•u tr√∫c ch√™m xen (Parenthetical insertion). <b>However</b> c√≥ th·ªÉ ƒë·ª©ng k·∫πp gi·ªØa ch·ªß ng·ªØ 'I' v√† ƒë·ªông t·ª´ 'failed', ƒë∆∞·ª£c ngƒÉn c√°ch b·ªüi hai d·∫•u ph·∫©y (, however,). √ù nghƒ©a t∆∞∆°ng ph·∫£n.",
        wrong: "Although v√† Despite tuy·ªát ƒë·ªëi kh√¥ng ƒë∆∞·ª£c ch√®n v√†o gi·ªØa ch·ªß ng·ªØ v√† ƒë·ªông t·ª´ nh∆∞ th·∫ø n√†y. Therefore sai nghƒ©a (H·ªçc chƒÉm -> V√¨ v·∫≠y tr∆∞·ª£t? V√¥ l√Ω!)."
    },
    {
        id: 3, q: "________ Aylin knew the post office's address, he didn't tell me.",
        opts: ["Although", "However", "In spite of", "Nevertheless"], ans: 0,
        trans: "M·∫∑c d√π Aylin bi·∫øt ƒë·ªãa ch·ªâ b∆∞u ƒëi·ªán, anh ·∫•y ƒë√£ kh√¥ng n√≥i cho t√¥i.",
        optTrans: "A. Although: M·∫∑c d√π | B. However: Tuy nhi√™n | C. In spite of: M·∫∑c d√π (+ N/V-ing) | D. Nevertheless: Tuy nhi√™n",
        right: "Ch·ªó tr·ªëng ƒë·ª©ng ·ªü ƒë·∫ßu c√¢u, theo sau l√† m·ªôt M·ªÜNH ƒê·ªÄ ho√†n ch·ªânh c√≥ Ch·ªß ng·ªØ (Aylin) + ƒê·ªông t·ª´ (knew). Do ƒë√≥ ta ch·ªçn <b>Although</b> (ho·∫∑c Though).",
        wrong: "However/Nevertheless kh√¥ng ƒë·ª©ng ƒë·∫ßu c√¢u n·ªëi 2 m·ªánh ƒë·ªÅ b·∫±ng d·∫•u ph·∫©y. In spite of ph·∫£i ƒëi k√®m C·ª•m danh t·ª´ ho·∫∑c V-ing, kh√¥ng ƒëi k√®m m·ªánh ƒë·ªÅ."
    },
    {
        id: 4, q: "Hakan drank two cups of coffee ________ he drank a cup of coffee before.",
        opts: ["although", "however", "despite", "therefore"], ans: 0,
        trans: "Hakan ƒë√£ u·ªëng 2 t√°ch c√† ph√™ m·∫∑c d√π anh ·∫•y ƒë√£ u·ªëng 1 t√°ch tr∆∞·ªõc ƒë√≥.",
        optTrans: "A. although: M·∫∑c d√π | B. however: Tuy nhi√™n | C. despite: M·∫∑c d√π | D. therefore: V√¨ v·∫≠y",
        right: "N·ªëi 2 m·ªánh ƒë·ªÅ (S+V) mang nghƒ©a t∆∞∆°ng ph·∫£n trong c√πng m·ªôt c√¢u (kh√¥ng c√≥ d·∫•u ch·∫•m) -> Ch·ªçn <b>although</b> (ho·∫∑c though).",
        wrong: "However v√† Therefore c·∫ßn d·∫•u ch·∫•m ph·∫©y (;) ph√≠a tr∆∞·ªõc v√† d·∫•u ph·∫©y (,) ph√≠a sau. Despite ƒëi v·ªõi danh t·ª´/V-ing."
    },
    {
        id: 5, q: "Sevgi went to school ________ she was ill.",
        opts: ["though", "however", "in spite of", "nevertheless"], ans: 0,
        trans: "Sevgi v·∫´n ƒëi h·ªçc m·∫∑c d√π c√¥ ·∫•y b·ªã ·ªëm.",
        optTrans: "A. though: M·∫∑c d√π | B. however: Tuy nhi√™n | C. in spite of: M·∫∑c d√π | D. nevertheless: Tuy nhi√™n",
        right: "T∆∞∆°ng t·ª± c√¢u tr√™n, theo sau l√† M·ªánh ƒë·ªÅ 'she (S) was (V) ill' -> Ch·ªçn <b>though</b> (ho·∫∑c although).",
        wrong: "In spite of kh√¥ng c·ªông M·ªánh ƒë·ªÅ. However/Nevertheless sai lu·∫≠t d·∫•u c√¢u."
    },
    {
        id: 6, q: "________ the exam is so difficult, I had good mark.",
        opts: ["Although", "However", "Despite", "Nevertheless"], ans: 0,
        trans: "M·∫∑c d√π b√†i thi r·∫•t kh√≥, t√¥i v·∫´n ƒë·∫°t ƒëi·ªÉm cao.",
        optTrans: "A. Although: M·∫∑c d√π | B. However: Tuy nhi√™n | C. Despite: M·∫∑c d√π (+ N) | D. Nevertheless: Tuy nhi√™n",
        right: "ƒê·ª©ng ƒë·∫ßu c√¢u, ph√≠a sau l√† M·ªánh ƒë·ªÅ 'the exam (S) is (V)...' mang nghƒ©a nh∆∞·ª£ng b·ªô -> Ch·ªçn <b>Although</b>.",
        wrong: "Despite c·ªông danh t·ª´/V-ing. However kh√¥ng n·ªëi 2 v·∫ø b·∫±ng d·∫•u ph·∫©y ki·ªÉu n√†y."
    },
    {
        id: 7, q: "I missed the bus. ________, I wasn't late for school.",
        opts: ["However", "Although", "In spite of", "Though"], ans: 0,
        trans: "T√¥i b·ªã l·ª° xe bu√Ωt. Tuy nhi√™n, t√¥i kh√¥ng b·ªã mu·ªôn h·ªçc.",
        optTrans: "A. However: Tuy nhi√™n | B. Although: M·∫∑c d√π | C. In spite of: M·∫∑c d√π | D. Though: M·∫∑c d√π",
        right: "ƒê·ª©ng sau d·∫•u ch·∫•m, tr∆∞·ªõc d·∫•u ph·∫©y -> Ch·∫Øc ch·∫Øn l√† <b>However</b> ho·∫∑c <b>Nevertheless</b>.",
        wrong: "Although, Though kh√¥ng bao gi·ªù ƒë·ª©ng ƒë·ªôc l·∫≠p tr∆∞·ªõc d·∫•u ph·∫©y."
    },
    {
        id: 8, q: "We don't like camping. We, ________, love fishing.",
        opts: ["nevertheless", "although", "despite", "because"], ans: 0,
        trans: "Ch√∫ng t√¥i kh√¥ng th√≠ch c·∫Øm tr·∫°i. Tuy nhi√™n, ch√∫ng t√¥i l·∫°i y√™u c√¢u c√°.",
        optTrans: "A. nevertheless: Tuy nhi√™n | B. although: M·∫∑c d√π | C. despite: M·∫∑c d√π | D. because: B·ªüi v√¨",
        right: "C·∫•u tr√∫c ch√™m xen gi·ªØa Ch·ªß ng·ªØ 'We' v√† ƒê·ªông t·ª´ 'love'. Ch·ªâ c√≥ <b>nevertheless</b> (ho·∫∑c however) m·ªõi ƒë∆∞·ª£c ph√©p k·∫πp gi·ªØa 2 d·∫•u ph·∫©y nh∆∞ v·∫≠y.",
        wrong: "Although, Despite, Because kh√¥ng ƒë∆∞·ª£c ph√©p ƒë·ª©ng ch√™m v√†o gi·ªØa c√¢u."
    },
    {
        id: 9, q: "We still fed the cat ________ it wasn't hungry.",
        opts: ["although", "however", "despite", "so"], ans: 0,
        trans: "Ch√∫ng t√¥i v·∫´n cho con m√®o ƒÉn m·∫∑c d√π n√≥ kh√¥ng ƒë√≥i.",
        optTrans: "A. although: M·∫∑c d√π | B. however: Tuy nhi√™n | C. despite: M·∫∑c d√π | D. so: V√¨ v·∫≠y",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ 'it (S) wasn't (V) hungry' mang nghƒ©a tr√°i ng∆∞·ª£c -> <b>although</b>.",
        wrong: "Despite + V-ing/N. However sai d·∫•u c√¢u. So sai nghƒ©a (N√≥ kh√¥ng ƒë√≥i n√™n cho ƒÉn?)."
    },
    {
        id: 10, q: "He decided to buy that car ________ it was so expensive.",
        opts: ["though", "however", "in spite of", "therefore"], ans: 0,
        trans: "Anh ·∫•y quy·∫øt ƒë·ªãnh mua chi·∫øc √¥ t√¥ ƒë√≥ m·∫∑c d√π n√≥ r·∫•t ƒë·∫Øt.",
        optTrans: "A. though: M·∫∑c d√π | B. however: Tuy nhi√™n | C. in spite of: M·∫∑c d√π | D. therefore: V√¨ v·∫≠y",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ 'it (S) was (V) so expensive' -> Ch·ªçn <b>though</b> (ho·∫∑c although).",
        wrong: "In spite of kh√¥ng c·ªông M·ªánh ƒë·ªÅ. However/Therefore c·∫ßn ch·∫•m ph·∫©y (;)."
    },
    {
        id: 11, q: "________ he is 30 already, he doesn't want to work to earn money.",
        opts: ["Although", "However", "Despite", "Nevertheless"], ans: 0,
        trans: "M·∫∑c d√π anh ·∫•y ƒë√£ 30 tu·ªïi, anh ·∫•y v·∫´n kh√¥ng mu·ªën l√†m vi·ªác ki·∫øm ti·ªÅn.",
        optTrans: "A. Although: M·∫∑c d√π | B. However: Tuy nhi√™n | C. Despite: M·∫∑c d√π (+ N) | D. Nevertheless: Tuy nhi√™n",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ 'he is 30 already' -> Ch·ªçn <b>Although</b>.",
        wrong: "Despite c·ªông danh t·ª´. However/Nevertheless ƒë·ª©ng sau d·∫•u ch·∫•m ho·∫∑c k·∫πp gi·ªØa 2 m·ªánh ƒë·ªÅ v·ªõi d·∫•u ch·∫•m ph·∫©y."
    },
    {
        id: 12, q: "I don't know how to play chess. ________, I really want to learn it.",
        opts: ["However", "Although", "Despite", "Because"], ans: 0,
        trans: "T√¥i kh√¥ng bi·∫øt ch∆°i c·ªù. Tuy nhi√™n, t√¥i th·ª±c s·ª± mu·ªën h·ªçc n√≥.",
        optTrans: "A. However: Tuy nhi√™n | B. Although: M·∫∑c d√π | C. Despite: M·∫∑c d√π | D. Because: B·ªüi v√¨",
        right: "ƒê·ª©ng sau d·∫•u ch·∫•m c√¢u v√† tr∆∞·ªõc d·∫•u ph·∫©y -> Ch·∫Øc ch·∫Øn 100% l√† <b>However</b>.",
        wrong: "Although, Despite, Because kh√¥ng d√πng c·∫•u tr√∫c ch·∫•m r·ªìi ph·∫©y nh∆∞ v·∫≠y."
    },
    {
        id: 13, q: "________ it was late, we still went out for a while.",
        opts: ["Though", "However", "In spite of", "Nevertheless"], ans: 0,
        trans: "M·∫∑c d√π ƒë√£ mu·ªôn, ch√∫ng t√¥i v·∫´n ƒëi ch∆°i m·ªôt l√°t.",
        optTrans: "A. Though: M·∫∑c d√π | B. However: Tuy nhi√™n | C. In spite of: M·∫∑c d√π (+ N) | D. Nevertheless: Tuy nhi√™n",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ 'it was late' -> Ch·ªçn <b>Though</b>.",
        wrong: "In spite of c·ªông c·ª•m danh t·ª´. However kh√¥ng d√πng ph·∫©y n·ªëi 2 v·∫ø."
    },
    {
        id: 14, q: "________ we didn't have much money, we went shopping very often.",
        opts: ["Although", "However", "Despite", "Therefore"], ans: 0,
        trans: "M·∫∑c d√π ch√∫ng t√¥i kh√¥ng c√≥ nhi·ªÅu ti·ªÅn, ch√∫ng t√¥i v·∫´n ƒëi mua s·∫Øm r·∫•t th∆∞·ªùng xuy√™n.",
        optTrans: "A. Although: M·∫∑c d√π | B. However: Tuy nhi√™n | C. Despite: M·∫∑c d√π (+ N) | D. Therefore: V√¨ v·∫≠y",
        right: "M·ªánh ƒë·ªÅ 'we didn't have much money' mang nghƒ©a nh∆∞·ª£ng b·ªô -> Ch·ªçn <b>Although</b>.",
        wrong: "Despite + Danh t·ª´. However/Therefore sai lu·∫≠t d·∫•u c√¢u."
    },
    {
        id: 15, q: "We managed to do it ________ he is absent from work.",
        opts: ["although", "however", "in spite of", "nevertheless"], ans: 0,
        trans: "Ch√∫ng t√¥i ƒë√£ xoay s·ªü ƒë·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥ m·∫∑c d√π anh ·∫•y v·∫Øng m·∫∑t.",
        optTrans: "A. although: M·∫∑c d√π | B. however: Tuy nhi√™n | C. in spite of: M·∫∑c d√π (+ N) | D. nevertheless: Tuy nhi√™n",
        right: "M·ªánh ƒë·ªÅ 'he is absent' -> D√πng <b>although</b>.",
        wrong: "In spite of kh√¥ng ƒëi v·ªõi m·ªánh ƒë·ªÅ. However sai d·∫•u c√¢u."
    },

    { type: 'title', text: "Part 6: Connectors (although, in spite of, however...)" },
    {
        id: 16, q: "She went on walking ________ she was terribly tired.",
        opts: ["although", "in spite of", "however", "despite"], ans: 0,
        trans: "C√¥ ·∫•y v·∫´n ti·∫øp t·ª•c ƒëi b·ªô m·∫∑c d√π c√¥ ·∫•y v√¥ c√πng m·ªát m·ªèi.",
        optTrans: "A. although: M·∫∑c d√π (+ S+V) | B. in spite of: M·∫∑c d√π (+ N/V-ing) | C. however: Tuy nhi√™n | D. despite: M·∫∑c d√π (+ N/V-ing)",
        right: "Ph√≠a sau l√† m·ªánh ƒë·ªÅ (S = she, V = was) -> D√πng <b>although</b>.",
        wrong: "In spite of v√† Despite ch·ªâ c·ªông danh t·ª´ ho·∫∑c V-ing, kh√¥ng c·ªông m·ªánh ƒë·ªÅ. However sai d·∫•u c√¢u."
    },
    {
        id: 17, q: "It is raining; ________, we went out.",
        opts: ["however", "although", "despite", "because"], ans: 0,
        trans: "Tr·ªùi ƒëang m∆∞a; tuy nhi√™n, ch√∫ng t√¥i v·∫´n ra ngo√†i.",
        optTrans: "A. however: Tuy nhi√™n | B. although: M·∫∑c d√π | C. despite: M·∫∑c d√π | D. because: B·ªüi v√¨",
        right: "Ng·ªØ ph√°p kinh ƒëi·ªÉn: N·ªëi 2 v·∫ø c√¢u b·∫±ng <b>d·∫•u ch·∫•m ph·∫©y (;)</b> v√† <b>d·∫•u ph·∫©y (,)</b> th√¨ B·∫ÆT BU·ªòC d√πng <b>however</b> ho·∫∑c <b>nevertheless</b>.",
        wrong: "Although, Despite, Because KH√îNG bao gi·ªù ƒë·ª©ng sau d·∫•u ch·∫•m ph·∫©y ƒë·ªÉ n·ªëi c√¢u."
    },
    {
        id: 18, q: "The food of this restaurant isn't delicious. I like the decoration, ________",
        opts: ["though", "although", "despite", "because"], ans: 0,
        trans: "ƒê·ªì ƒÉn c·ªßa nh√† h√†ng n√†y kh√¥ng ngon. Tuy nhi√™n t√¥i l·∫°i th√≠ch c√°ch trang tr√≠.",
        optTrans: "A. though: Tuy nhi√™n/M·∫∑c d√π | B. although | C. despite | D. because",
        right: "ƒê√¢y l√† c·∫•u tr√∫c giao ti·∫øp c·ª±c ph·ªï bi·∫øn: <b>Though</b> ƒë·ª©ng ·ªü cu·ªëi c√¢u mang nghƒ©a l√† 'Tuy nhi√™n' (gi·ªëng However).",
        wrong: "Although, Despite, Because KH√îNG BAO GI·ªú ƒë∆∞·ª£c ph√©p ƒë·ª©ng m·ªôt m√¨nh ·ªü cu·ªëi c√¢u c√≥ d·∫•u ph·∫©y ch·∫∑n tr∆∞·ªõc nh∆∞ th·∫ø n√†y."
    },
    {
        id: 19, q: "________ his sickness, he still had to go to school.",
        opts: ["In spite of", "Although", "Though", "However"], ans: 0,
        trans: "M·∫∑c d√π b·ªã ·ªëm, anh ·∫•y v·∫´n ph·∫£i ƒëi h·ªçc.",
        optTrans: "A. In spite of (+ N) | B. Although (+ S+V) | C. Though (+ S+V) | D. However: Tuy nhi√™n",
        right: "'his sickness' (cƒÉn b·ªánh c·ªßa anh ·∫•y) l√† m·ªôt C·ª•m Danh T·ª´ -> Ch·ªçn <b>In spite of</b> (ho·∫∑c Despite).",
        wrong: "Although/Though ph·∫£i c·ªông m·ªánh ƒë·ªÅ (S+V)."
    },
    {
        id: 20, q: "I knew what he wanted ________ not understanding the words.",
        opts: ["despite", "although", "though", "however"], ans: 0,
        trans: "T√¥i bi·∫øt anh ·∫•y mu·ªën g√¨ m·∫∑c d√π kh√¥ng hi·ªÉu t·ª´ ng·ªØ anh ·∫•y n√≥i.",
        optTrans: "A. despite (+ V-ing) | B. although (+ S+V) | C. though (+ S+V) | D. however: Tuy nhi√™n",
        right: "Ph√≠a sau ch·ªó tr·ªëng l√† V-ing ('not understanding') -> Ch·ªçn <b>despite</b> (ho·∫∑c in spite of).",
        wrong: "Although/Though ph·∫£i ƒëi v·ªõi M·ªánh ƒë·ªÅ ho√†n ch·ªânh (S+V)."
    },
    {
        id: 21, q: "________ he behaves impolitely, everybody still loves him.",
        opts: ["Although", "Despite", "In spite of", "However"], ans: 0,
        trans: "M·∫∑c d√π anh ·∫•y c∆∞ x·ª≠ thi·∫øu l·ªãch s·ª±, m·ªçi ng∆∞·ªùi v·∫´n y√™u qu√Ω anh ·∫•y.",
        optTrans: "A. Although (+ S+V) | B. Despite (+ N) | C. In spite of (+ N) | D. However: Tuy nhi√™n",
        right: "Theo sau l√† m·ªánh ƒë·ªÅ 'he behaves impolitely' -> Ch·ªçn <b>Although</b>.",
        wrong: "Despite / In spite of c·ªông danh t·ª´. However kh√¥ng n·ªëi 2 m·ªánh ƒë·ªÅ b·∫±ng d·∫•u ph·∫©y."
    },
    {
        id: 22, q: "________ the traffic jam, we went home early.",
        opts: ["Despite", "Although", "Though", "However"], ans: 0,
        trans: "M·∫∑c d√π t·∫Øc ƒë∆∞·ªùng, ch√∫ng t√¥i ƒë√£ v·ªÅ nh√† s·ªõm.",
        optTrans: "A. Despite (+ N) | B. Although (+ S+V) | C. Though (+ S+V) | D. However: Tuy nhi√™n",
        right: "'the traffic jam' (v·ª• t·∫Øc ƒë∆∞·ªùng) l√† C·ª•m Danh T·ª´ -> Ch·ªçn <b>Despite</b> (ho·∫∑c In spite of).",
        wrong: "Although/Though ph·∫£i c·ªông m·ªánh ƒë·ªÅ."
    },
    {
        id: 23, q: "________ I studied very hard, I failed the placement test.",
        opts: ["Although", "In spite of", "Despite", "Nevertheless"], ans: 0,
        trans: "M·∫∑c d√π t√¥i ƒë√£ h·ªçc r·∫•t chƒÉm ch·ªâ, t√¥i v·∫´n thi tr∆∞·ª£t b√†i ki·ªÉm tra x·∫øp l·ªõp.",
        optTrans: "A. Although (+ S+V) | B. In spite of (+ N) | C. Despite (+ N) | D. Nevertheless: Tuy nhi√™n",
        right: "Theo sau l√† m·ªánh ƒë·ªÅ 'I studied very hard' -> Ch·ªçn <b>Although</b>.",
        wrong: "In spite of/Despite c·ªông danh t·ª´."
    },
    {
        id: 24, q: "She could not forget him, ________ hard she tried.",
        opts: ["however", "although", "despite", "no matter"], ans: 0,
        trans: "C√¥ ·∫•y kh√¥ng th·ªÉ qu√™n ƒë∆∞·ª£c anh ·∫•y, cho d√π c√¥ ·∫•y c√≥ c·ªë g·∫Øng ƒë·∫øn ƒë√¢u.",
        optTrans: "A. however | B. although | C. despite | D. no matter",
        right: "C·∫•u tr√∫c kinh ƒëi·ªÉn: <b>However + Adj/Adv + S + V</b> (Cho d√π ... ƒë·∫øn ƒë√¢u). ·ªû ƒë√¢y c√≥ tr·∫°ng t·ª´ 'hard' -> d√πng <b>however</b>.",
        wrong: "Although v√† Despite kh√¥ng ƒë·ª©ng tr∆∞·ªõc t√≠nh t·ª´/tr·∫°ng t·ª´ nh∆∞ v·∫≠y. N·∫øu d√πng 'no matter' th√¨ ph·∫£i l√† 'no matter how'."
    },
    {
        id: 25, q: "I knew everything. I, ________, tried to pretend I didn't know.",
        opts: ["nevertheless", "although", "despite", "because"], ans: 0,
        trans: "T√¥i bi·∫øt m·ªçi th·ª©. Tuy nhi√™n, t√¥i v·∫´n c·ªë gi·∫£ v·ªù nh∆∞ kh√¥ng bi·∫øt.",
        optTrans: "A. nevertheless: Tuy nhi√™n | B. although | C. despite | D. because",
        right: "C·∫•u tr√∫c ch√™m xen. <b>Nevertheless</b> (ho·∫∑c however) k·∫πp gi·ªØa 2 d·∫•u ph·∫©y ƒë·ªÉ n·ªëi ti·∫øp m·∫°ch vƒÉn ph·∫£n bi·ªán.",
        wrong: "C√°c li√™n t·ª´ kh√°c kh√¥ng ƒë·ª©ng ch√™m xen gi·ªØa ch·ªß ng·ªØ v√† ƒë·ªông t·ª´."
    },
    {
        id: 26, q: "She was really bad at cooking. Everyone is still satisfied with the meal, ________",
        opts: ["though", "although", "despite", "in spite of"], ans: 0,
        trans: "C√¥ ·∫•y n·∫•u ƒÉn r·∫•t t·ªá. D√π v·∫≠y, m·ªçi ng∆∞·ªùi v·∫´n h√†i l√≤ng v·ªõi b·ªØa ƒÉn.",
        optTrans: "A. though: D√π v·∫≠y | B. although | C. despite | D. in spite of",
        right: "Nh·ªõ k·ªπ m·∫πo c·ªßa c√¥: Ch·ªâ c√≥ <b>Though</b> m·ªõi ƒë∆∞·ª£c ph√©p ƒë·ª©ng l·∫ª loi m·ªôt m√¨nh ·ªü CU·ªêI C√ÇU mang nghƒ©a 'Tuy nhi√™n / D√π v·∫≠y'.",
        wrong: "Although, Despite tuy·ªát ƒë·ªëi kh√¥ng ƒë·ª©ng cu·ªëi c√¢u."
    },
    {
        id: 27, q: "I feel a little scared; ________, I will talk to him.",
        opts: ["however", "although", "despite", "so"], ans: 0,
        trans: "T√¥i c·∫£m th·∫•y h∆°i s·ª£; tuy nhi√™n, t√¥i s·∫Ω n√≥i chuy·ªán v·ªõi anh ·∫•y.",
        optTrans: "A. however: Tuy nhi√™n | B. although: M·∫∑c d√π | C. despite: M·∫∑c d√π | D. so: V√¨ v·∫≠y",
        right: "D·∫•u <b>ch·∫•m ph·∫©y (;)</b> v√† <b>d·∫•u ph·∫©y (,)</b> -> Ch·∫Øc ch·∫Øn l√† ƒë·∫•t di·ªÖn c·ªßa <b>however</b> (ho·∫∑c nevertheless).",
        wrong: "Although, Despite, So kh√¥ng ƒëi v·ªõi d·∫•u ch·∫•m ph·∫©y."
    },
    {
        id: 28, q: "________ Mike drove carefully, Mike couldn't avoid the accident.",
        opts: ["Although", "In spite of", "Despite", "However"], ans: 0,
        trans: "M·∫∑c d√π Mike l√°i xe c·∫©n th·∫≠n, anh ·∫•y v·∫´n kh√¥ng th·ªÉ tr√°nh kh·ªèi tai n·∫°n.",
        optTrans: "A. Although (+ S+V) | B. In spite of (+ N) | C. Despite (+ N) | D. However: Tuy nhi√™n",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ (Mike drove carefully) -> Ch·ªçn <b>Although</b>.",
        wrong: "In spite of/Despite c·ªông c·ª•m danh t·ª´."
    },
    {
        id: 29, q: "Lisa finished the cake ________ she said she didn't like sweets.",
        opts: ["though", "however", "despite", "in spite of"], ans: 0,
        trans: "Lisa ƒë√£ ƒÉn h·∫øt c√°i b√°nh m·∫∑c d√π c√¥ ·∫•y n√≥i c√¥ ·∫•y kh√¥ng th√≠ch ƒë·ªì ng·ªçt.",
        optTrans: "A. though (+ S+V) | B. however: Tuy nhi√™n | C. despite (+ N) | D. in spite of (+ N)",
        right: "Theo sau l√† M·ªánh ƒë·ªÅ 'she said...' -> Ch·ªçn <b>though</b> (ho·∫∑c although).",
        wrong: "Despite/In spite of c·ªông danh t·ª´. However sai d·∫•u c√¢u."
    },
    {
        id: 30, q: "The sky was gray and cloudy. ________, we went to the beach.",
        opts: ["Nevertheless", "Although", "Despite", "In spite of"], ans: 0,
        trans: "B·∫ßu tr·ªùi x√°m x·ªãt v√† nhi·ªÅu m√¢y. Tuy nhi√™n, ch√∫ng t√¥i v·∫´n ƒëi bi·ªÉn.",
        optTrans: "A. Nevertheless: Tuy nhi√™n | B. Although: M·∫∑c d√π | C. Despite: M·∫∑c d√π | D. In spite of: M·∫∑c d√π",
        right: "ƒê·ª©ng sau d·∫•u ch·∫•m (.) v√† tr∆∞·ªõc d·∫•u ph·∫©y (,) n·ªëi 2 c√¢u ph·∫£n bi·ªán logic -> <b>Nevertheless</b> (ho·∫∑c However).",
        wrong: "Although, Despite kh√¥ng d√πng c·∫•u tr√∫c ch·∫•m ph·∫©y n√†y."
    }
];

let totalScore = 0; let answeredQuestions = 0;
const totalQuestions = quizData.filter(q => q.id).length;

function shuffleArray(array) {
    let arr = array.map((item, index) => ({ item, index }));
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function renderQuiz() {
    const container = document.getElementById('quiz-container');
    let html = ''; const letters = ['A', 'B', 'C', 'D'];

    quizData.forEach((data) => {
        if (data.type === 'title') {
            html += `<div class="part-title">${data.text}</div>`;
        } else {
            const shuffledOpts = shuffleArray(data.opts);
            let questionHTML = data.q.replace('________', `<span class="blank" id="blank-${data.id}">?</span>`);
            
            html += `
            <div class="question-card" id="card-${data.id}">
                <div class="question-text">${data.id}. ${questionHTML}</div>
                <div class="options-grid">
            `;

            shuffledOpts.forEach((optObj, idx) => {
                const isCorrect = optObj.index === data.ans;
                const safeText = data.opts[data.ans].replace(/'/g, "\\'");
                html += `
                    <button class="option-btn" onclick="checkAnswer(${data.id}, this, ${isCorrect}, '${safeText}')">
                        <span class="opt-letter">${letters[idx]}</span> ${optObj.item}
                    </button>
                `;
            });

            const formattedOpts = data.optTrans.split('|').join('<br>');

            html += `
                </div>
                <div class="explanation-box" id="exp-${data.id}">
                    <h4><i class="fas fa-magic"></i> C√¥ Mai An gi·∫£i th√≠ch:</h4>
                    <p><strong><i class="fas fa-language"></i> D·ªãch:</strong> ${data.trans}</p>
                    <p><strong><i class="fas fa-search"></i> Ph√¢n t√≠ch:</strong><br>${formattedOpts}</p>
                    <p><span class="tag-correct"><i class="fas fa-check-circle"></i> V√¨ sao ƒê√öNG?</span> ${data.right}</p>
                    <p><span class="tag-incorrect"><i class="fas fa-times-circle"></i> V√¨ sao SAI?</span> ${data.wrong}</p>
                </div>
            </div>`;
        }
    });
    container.innerHTML = html;
}

function checkAnswer(qId, btnElement, isCorrect, correctText) {
    const card = document.getElementById(`card-${qId}`);
    const buttons = card.querySelectorAll('.option-btn');
    const blank = document.getElementById(`blank-${qId}`);
    const expBox = document.getElementById(`exp-${qId}`);

    buttons.forEach(btn => btn.disabled = true);
    answeredQuestions++;

    let answerText = btnElement.innerText.substring(2).trim();
    if (blank) blank.innerText = answerText;

    if (isCorrect) {
        playSound('correct'); btnElement.classList.add('correct');
        if(blank) { blank.style.color = 'var(--correct)'; blank.style.borderColor = 'var(--correct)'; }
        totalScore++;
        const rect = btnElement.getBoundingClientRect();
        const x = (rect.left + rect.width / 2) / window.innerWidth; const y = (rect.top + rect.height / 2) / window.innerHeight;
        confetti({ particleCount: 60, spread: 60, origin: { x: x, y: y }, colors: ['#00D26A', '#FFC312', '#00C9A7'] });
    } else {
        playSound('incorrect'); btnElement.classList.add('incorrect'); card.classList.add('shake');
        if(blank) { blank.style.color = 'var(--incorrect)'; blank.style.borderColor = 'var(--incorrect)'; }
        
        buttons.forEach(btn => { if (btn.innerText.includes(correctText)) btn.classList.add('correct'); });
        setTimeout(() => card.classList.remove('shake'), 500);
    }
    expBox.style.display = 'block';
}

function showScore() {
    const modal = document.getElementById('scoreModal');
    const scoreDisplay = document.getElementById('score-display');
    const msg = document.getElementById('score-message');

    scoreDisplay.innerText = `${totalScore}/${totalQuestions}`;
    if (totalScore === totalQuestions) {
        msg.innerText = "ƒê·ªânh c·ªßa ch√≥p! Tr·ªçn v·∫πn 30/30 c√¢u. Em n·∫Øm qu√° v·ªØng ki·∫øn th·ª©c Li√™n t·ª´ r·ªìi! üèÜ";
        confetti({ particleCount: 300, spread: 150, origin: {y: 0.3}});
    } else if (totalScore > totalQuestions / 2) {
        msg.innerText = "Gi·ªèi l·∫Øm! Ph·∫ßn li√™n t·ª´ r·∫•t hay b·∫´y d·∫•u c√¢u. Em ƒë·ªçc k·ªπ gi·∫£i th√≠ch c·ªßa c√¥ ƒë·ªÉ l·∫•y 10 ƒëi·ªÉm tuy·ªát ƒë·ªëi nh√©! üåü";
        confetti({ particleCount: 100, spread: 70, origin: {y: 0.3}});
    } else {
        msg.innerText = "D·∫°ng b√†i n√†y b·∫´y ng·ªØ ph√°p kh√° nhi·ªÅu. C·ª© b√¨nh tƒ©nh ƒë·ªçc k·ªπ 'C√¥ Mai An gi·∫£i th√≠ch' l√† s·∫Ω hi·ªÉu ngay th√¥i! üí™";
    }
    modal.style.display = 'flex';
}

window.onload = renderQuiz;
</script>
</body>
</html>