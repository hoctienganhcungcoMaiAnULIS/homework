<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán t·∫≠p Giao ti·∫øp Ti·∫øng Anh (Exchanges) - Ms Mai An ULIS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-purple: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#d7d7d7 1px, transparent 1px), radial-gradient(#d7d7d7 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            border: 2px solid #eee;
        }

        h1 {
            color: var(--primary-purple);
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            font-weight: 800;
            font-size: 1.8rem;
        }

        .sub-header {
            color: #7f8c8d;
            font-size: 1rem;
            margin-top: 5px;
        }

        /* Progress Bar */
        .progress-container {
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 15px;
            width: 100%;
            margin-bottom: 25px;
            overflow: hidden;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background-color: var(--primary-teal);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-in-out;
            border-radius: 10px;
        }

        /* Question Card */
        .quiz-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(136, 84, 192, 0.15);
            margin-bottom: 30px;
            border: 2px solid #fff;
            position: relative;
            animation: fadeIn 0.5s ease-out;
        }

        .question-number {
            display: inline-block;
            background: var(--primary-purple);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            line-height: 1.5;
            margin-bottom: 25px;
            color: #2c3e50;
            white-space: pre-wrap; /* Preserve line breaks in dialogues */
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* 3D Button Styles */
        .option-btn {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-bottom: 6px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.1s;
            text-align: left;
            position: relative;
            display: flex;
            align-items: center;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            border-color: var(--primary-purple);
            border-bottom-color: var(--primary-purple);
            color: var(--primary-purple);
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .option-btn:disabled {
            cursor: default;
            transform: none !important;
        }

        /* Correct/Wrong States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00a352;
            border-bottom-color: #008f48;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #d63031;
            border-bottom-color: #c0392b;
            animation: shake 0.5s;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 25px;
            background-color: #f1f9ff;
            border: 2px solid #dbe9f6;
            border-left: 5px solid var(--primary-purple);
            border-radius: 10px;
            padding: 20px;
            display: none; /* Hidden initially */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-box.show {
            display: block;
        }

        .explanation-title {
            font-weight: 800;
            color: var(--primary-purple);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-content {
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .explanation-content strong {
            color: #2c3e50;
        }

        /* Submit Button */
        .submit-btn {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 40px auto;
            background-color: var(--primary-teal);
            color: white;
            border: none;
            border-bottom: 6px solid #009e82;
            padding: 15px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 10px 20px rgba(0, 201, 167, 0.3);
        }

        .submit-btn:hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }

        .submit-btn:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
            box-shadow: none;
        }

        /* Result Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid var(--primary-purple);
        }

        .modal-overlay.active .result-card {
            transform: scale(1);
        }

        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-purple);
            margin: 20px 0;
        }

        .praise-text {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 30px;
        }

        .restart-btn {
            background-color: var(--primary-purple);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(136, 84, 192, 0.4);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Utility */
        .hidden { display: none !important; }
        
        /* Markdown styling in rationale */
        .rationale-text ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .rationale-text li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><i class="fas fa-graduation-cap"></i> Ms Mai An ULIS</h1>
        <div class="sub-header">Luy·ªán t·∫≠p Giao ti·∫øp Ti·∫øng Anh (Exchanges) - Daily English</div>
    </header>

    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div id="quiz-area">
        <!-- Questions will be injected here by JS -->
    </div>

    <button class="submit-btn hidden" id="submit-btn" onclick="showResults()">
        <i class="fas fa-paper-plane"></i> N·ªôp B√†i & Xem ƒêi·ªÉm
    </button>
</div>

<!-- Result Modal -->
<div class="modal-overlay" id="result-modal">
    <div class="result-card">
        <i class="fas fa-trophy" style="font-size: 4rem; color: #f1c40f; margin-bottom: 10px;"></i>
        <h2>K·∫øt Qu·∫£ C·ªßa B·∫°n</h2>
        <div class="score-display" id="final-score">0/10</div>
        <div class="praise-text" id="praise-text">Tuy·ªát v·ªùi!</div>
        <button class="restart-btn" onclick="location.reload()">
            <i class="fas fa-redo"></i> L√†m L·∫°i
        </button>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU ƒê·ªÄ B√ÄI (T·ª´ Prompt) ---
    const rawData = {
        "questions": [
            {
                "questionNumber": 1,
                "question": "1. Tom: \"Have you ever visited Ha Long Bay?\"\nMai: \"____________________\"",
                "answerOptions": [
                    { "text": "A. Ha Long Bay is in Quang Ninh province.", "isCorrect": false },
                    { "text": "B. Yes, I went there last summer with my family.", "isCorrect": true },
                    { "text": "C. It has thousands of limestone islands.", "isCorrect": false },
                    { "text": "D. Many tourists go there every year.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. V·ªãnh H·∫° Long n·∫±m ·ªü t·ªânh Qu·∫£ng Ninh. (Fact - S·ª± th·∫≠t)\n- B. C√≥, t·ªõ ƒë√£ ƒë·∫øn ƒë√≥ m√πa h√® nƒÉm ngo√°i c√πng gia ƒë√¨nh. (Answer - C√¢u tr·∫£ l·ªùi tr·ª±c ti·∫øp)\n- C. N√≥ c√≥ h√†ng ngh√¨n ƒë·∫£o ƒë√° v√¥i. (Description - M√¥ t·∫£)\n- D. Nhi·ªÅu du kh√°ch ƒë·∫øn ƒë√≥ h√†ng nƒÉm. (Fact - S·ª± th·∫≠t)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng \"Have you ever...?\" (B·∫°n ƒë√£ bao gi·ªù... ch∆∞a?), ƒë√¢y l√† c√¢u h·ªèi v·ªÅ tr·∫£i nghi·ªám c√° nh√¢n (Yes/No). ƒê√°p √°n B l√† c√¢u tr·∫£ l·ªùi ph√π h·ª£p nh·∫•t v√¨ n√≥ x√°c nh·∫≠n (Yes) v√† ƒë∆∞a ra th√¥ng tin c·ª• th·ªÉ v·ªÅ th·ªùi gian.\n\n**D·ªãch h·ªôi tho·∫°i:**\nTom: \"C·∫≠u ƒë√£ bao gi·ªù ƒë·∫øn thƒÉm V·ªãnh H·∫° Long ch∆∞a?\"\nMai: \"C√≥, t·ªõ ƒë√£ ƒë·∫øn ƒë√≥ m√πa h√® nƒÉm ngo√°i c√πng gia ƒë√¨nh.\""
            },
            {
                "questionNumber": 2,
                "question": "2. Sarah: \"What do you think about the Grand Canyon?\"\nJohn: \"____________________\"",
                "answerOptions": [
                    { "text": "A. It's located in Arizona.", "isCorrect": false },
                    { "text": "B. Millions of people visit it.", "isCorrect": false },
                    { "text": "C. It was formed millions of years ago.", "isCorrect": false },
                    { "text": "D. It's absolutely breathtaking!", "isCorrect": true }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. N√≥ n·∫±m ·ªü Arizona. (Location - V·ªã tr√≠)\n- B. H√†ng tri·ªáu ng∆∞·ªùi ƒë·∫øn thƒÉm n√≥. (Statistic - S·ªë li·ªáu)\n- C. N√≥ ƒë∆∞·ª£c h√¨nh th√†nh t·ª´ h√†ng tri·ªáu nƒÉm tr∆∞·ªõc. (History - L·ªãch s·ª≠)\n- D. N√≥ ho√†n to√†n ngo·∫°n m·ª•c! (Opinion - √ù ki·∫øn)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi \"What do you think about...?\" d√πng ƒë·ªÉ h·ªèi √Ω ki·∫øn/c·∫£m nghƒ©. ƒê√°p √°n A, B, C ch·ªâ l√† c√°c s·ª± ki·ªán th·ª±c t·∫ø. Ch·ªâ c√≥ ƒë√°p √°n D th·ªÉ hi·ªán c·∫£m x√∫c/ƒë√°nh gi√° c√° nh√¢n (\"breathtaking\" - ƒë·∫πp ƒë·∫øn n√≠n th·ªü).\n\n**D·ªãch h·ªôi tho·∫°i:**\nSarah: \"C·∫≠u nghƒ© g√¨ v·ªÅ Grand Canyon?\"\nJohn: \"N√≥ ho√†n to√†n ngo·∫°n m·ª•c!\""
            },
            {
                "questionNumber": 3,
                "question": "3. Lisa: \"How can we protect coral reefs from damage?\"\nDavid: \"____________________\"",
                "answerOptions": [
                    { "text": "A. Coral reefs are very colorful.", "isCorrect": false },
                    { "text": "B. They are found in warm waters.", "isCorrect": false },
                    { "text": "C. We should stop using harmful sunscreens.", "isCorrect": true },
                    { "text": "D. Many fish live in coral reefs.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. C√°c r·∫°n san h√¥ r·∫•t s·∫∑c s·ª°. (Description - M√¥ t·∫£)\n- B. Ch√∫ng ƒë∆∞·ª£c t√¨m th·∫•y ·ªü v√πng n∆∞·ªõc ·∫•m. (Location - V·ªã tr√≠)\n- C. Ch√∫ng ta n√™n ng·ª´ng s·ª≠ d·ª•ng kem ch·ªëng n·∫Øng ƒë·ªôc h·∫°i. (Solution - Gi·∫£i ph√°p)\n- D. Nhi·ªÅu lo√†i c√° s·ªëng trong c√°c r·∫°n san h√¥. (Fact - S·ª± th·∫≠t)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi \"How can we...?\" h·ªèi v·ªÅ ph∆∞∆°ng ph√°p ho·∫∑c gi·∫£i ph√°p. ƒê√°p √°n C ƒë∆∞a ra m·ªôt h√†nh ƒë·ªông c·ª• th·ªÉ (\"stop using harmful sunscreens\") ƒë·ªÉ b·∫£o v·ªá san h√¥.\n\n**D·ªãch h·ªôi tho·∫°i:**\nLisa: \"L√†m th·∫ø n√†o ch√∫ng ta c√≥ th·ªÉ b·∫£o v·ªá c√°c r·∫°n san h√¥ kh·ªèi b·ªã h∆∞ h·∫°i?\"\nDavid: \"Ch√∫ng ta n√™n ng·ª´ng s·ª≠ d·ª•ng c√°c lo·∫°i kem ch·ªëng n·∫Øng ƒë·ªôc h·∫°i.\""
            },
            {
                "questionNumber": 4,
                "question": "4. Peter: \"Would you like to join our trip to the national park?\"\nAnna: \"____________________\"",
                "answerOptions": [
                    { "text": "A. The park has many animals.", "isCorrect": false },
                    { "text": "B. National parks are important.", "isCorrect": false },
                    { "text": "C. I'd love to! When are you going?", "isCorrect": true },
                    { "text": "D. The park is very large.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. C√¥ng vi√™n c√≥ nhi·ªÅu ƒë·ªông v·∫≠t. (Fact - S·ª± th·∫≠t)\n- B. C√°c c√¥ng vi√™n qu·ªëc gia r·∫•t quan tr·ªçng. (Opinion - √ù ki·∫øn chung)\n- C. T·ªõ r·∫•t th√≠ch! Khi n√†o c√°c c·∫≠u ƒëi? (Acceptance - Ch·∫•p nh·∫≠n l·ªùi m·ªùi)\n- D. C√¥ng vi√™n r·∫•t r·ªông. (Description - M√¥ t·∫£)\n\n**Gi·∫£i th√≠ch:** \"Would you like to...?\" l√† c√¢u m·ªùi m·ªçc. ƒê√°p √°n C th·ªÉ hi·ªán s·ª± ƒë·ªìng √Ω v√† h√†o h·ª©ng (\"I'd love to\") k√®m theo c√¢u h·ªèi chi ti·∫øt v·ªÅ chuy·∫øn ƒëi, ƒë√¢y l√† ph·∫£n h·ªìi t·ª± nhi√™n nh·∫•t.\n\n**D·ªãch h·ªôi tho·∫°i:**\nPeter: \"C·∫≠u c√≥ mu·ªën tham gia chuy·∫øn ƒëi ƒë·∫øn c√¥ng vi√™n qu·ªëc gia c√πng b·ªçn t·ªõ kh√¥ng?\"\nAnna: \"T·ªõ r·∫•t th√≠ch! Khi n√†o c√°c c·∫≠u ƒëi?\""
            },
            {
                "questionNumber": 5,
                "question": "5. Mike: \"Why is the Amazon rainforest important?\"\nEmma: \"____________________\"",
                "answerOptions": [
                    { "text": "A. It is home to incredible biodiversity and helps regulate the climate.", "isCorrect": true },
                    { "text": "B. It's in South America.", "isCorrect": false },
                    { "text": "C. Many tourists visit it.", "isCorrect": false },
                    { "text": "D. The Amazon river is very long.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. N√≥ l√† nh√† c·ªßa s·ª± ƒëa d·∫°ng sinh h·ªçc ƒë√°ng kinh ng·∫°c v√† gi√∫p ƒëi·ªÅu h√≤a kh√≠ h·∫≠u. (Reason - L√Ω do)\n- B. N√≥ ·ªü Nam M·ªπ. (Location - V·ªã tr√≠)\n- C. Nhi·ªÅu du kh√°ch ƒë·∫øn thƒÉm n√≥. (Fact - S·ª± th·∫≠t)\n- D. S√¥ng Amazon r·∫•t d√†i. (Fact - S·ª± th·∫≠t)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi \"Why\" (T·∫°i sao) y√™u c·∫ßu m·ªôt l√Ω do ho·∫∑c gi·∫£i th√≠ch. ƒê√°p √°n A gi·∫£i th√≠ch vai tr√≤ quan tr·ªçng c·ªßa r·ª´ng Amazon (ƒëa d·∫°ng sinh h·ªçc, ƒëi·ªÅu h√≤a kh√≠ h·∫≠u).\n\n**D·ªãch h·ªôi tho·∫°i:**\nMike: \"T·∫°i sao r·ª´ng m∆∞a nhi·ªát ƒë·ªõi Amazon l·∫°i quan tr·ªçng?\"\nEmma: \"N√≥ l√† n∆°i tr√∫ ng·ª• c·ªßa h·ªá sinh th√°i ƒëa d·∫°ng ƒë√°ng kinh ng·∫°c v√† gi√∫p ƒëi·ªÅu h√≤a kh√≠ h·∫≠u.\""
            },
            {
                "questionNumber": 6,
                "question": "6. Kate: \"The Northern Lights are amazing!\"\nBen: \"____________________\"",
                "answerOptions": [
                    { "text": "A. They happen in northern countries.", "isCorrect": false },
                    { "text": "B. I totally agree! They're magical.", "isCorrect": true },
                    { "text": "C. They are also called Aurora Borealis.", "isCorrect": false },
                    { "text": "D. Many photographers take pictures of them.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. Ch√∫ng x·∫£y ra ·ªü c√°c n∆∞·ªõc ph∆∞∆°ng b·∫Øc. (Fact - S·ª± th·∫≠t)\n- B. T·ªõ ho√†n to√†n ƒë·ªìng √Ω! Ch√∫ng th·∫≠t k·ª≥ di·ªáu. (Agreement - S·ª± ƒë·ªìng t√¨nh)\n- C. Ch√∫ng c√≤n ƒë∆∞·ª£c g·ªçi l√† Aurora Borealis. (Name - T√™n g·ªçi)\n- D. Nhi·ªÅu nhi·∫øp ·∫£nh gia ch·ª•p ·∫£nh ch√∫ng. (Fact - S·ª± th·∫≠t)\n\n**Gi·∫£i th√≠ch:** Kate ƒëang ƒë∆∞a ra m·ªôt l·ªùi khen/c·∫£m th√°n (\"amazing\"). Ph·∫£n h·ªìi t·ª± nhi√™n nh·∫•t c·ªßa Ben l√† th·ªÉ hi·ªán s·ª± ƒë·ªìng t√¨nh ho·∫∑c chia s·∫ª c·∫£m x√∫c ƒë√≥. ƒê√°p √°n B (\"I totally agree\") l√† ph√π h·ª£p nh·∫•t.\n\n**D·ªãch h·ªôi tho·∫°i:**\nKate: \"B·∫Øc C·ª±c Quang th·∫≠t tuy·ªát v·ªùi!\"\nBen: \"T·ªõ ho√†n to√†n ƒë·ªìng √Ω! Ch√∫ng th·∫≠t k·ª≥ di·ªáu.\""
            },
            {
                "questionNumber": 7,
                "question": "7. Tour guide: \"Please don't touch the coral when diving.\"\nTourist: \"____________________\"",
                "answerOptions": [
                    { "text": "A. The water is very clear here.", "isCorrect": false },
                    { "text": "B. There are many types of fish.", "isCorrect": false },
                    { "text": "C. I understand. I'll be careful.", "isCorrect": true },
                    { "text": "D. Diving is very exciting.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. N∆∞·ªõc ·ªü ƒë√¢y r·∫•t trong. (Observation - Quan s√°t)\n- B. C√≥ r·∫•t nhi·ªÅu lo·∫°i c√°. (Observation - Quan s√°t)\n- C. T√¥i hi·ªÉu r·ªìi. T√¥i s·∫Ω c·∫©n th·∫≠n. (Compliance - Tu√¢n th·ªß)\n- D. L·∫∑n bi·ªÉn r·∫•t th√∫ v·ªã. (Opinion - √ù ki·∫øn)\n\n**Gi·∫£i th√≠ch:** H∆∞·ªõng d·∫´n vi√™n ƒë∆∞a ra m·ªôt y√™u c·∫ßu/c·∫£nh b√°o (\"Please don't...\"). Du kh√°ch c·∫ßn ph·∫£n h·ªìi x√°c nh·∫≠n ƒë√£ hi·ªÉu v√† s·∫Ω tu√¢n th·ªß. ƒê√°p √°n C l√† ph√π h·ª£p nh·∫•t.\n\n**D·ªãch h·ªôi tho·∫°i:**\nH∆∞·ªõng d·∫´n vi√™n: \"L√†m ∆°n ƒë·ª´ng ch·∫°m v√†o san h√¥ khi l·∫∑n.\"\nDu kh√°ch: \"T√¥i hi·ªÉu r·ªìi. T√¥i s·∫Ω c·∫©n th·∫≠n.\""
            },
            {
                "questionNumber": 8,
                "question": "8. Jane: \"How long does it take to climb Mount Everest?\"\nGuide: \"____________________\"",
                "answerOptions": [
                    { "text": "A. Mount Everest is the highest mountain.", "isCorrect": false },
                    { "text": "B. Usually about two months including preparation.", "isCorrect": true },
                    { "text": "C. It's located between Nepal and Tibet.", "isCorrect": false },
                    { "text": "D. Many climbers attempt it every year.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. ƒê·ªânh Everest l√† ng·ªçn n√∫i cao nh·∫•t. (Fact - S·ª± th·∫≠t)\n- B. Th∆∞·ªùng m·∫•t kho·∫£ng hai th√°ng bao g·ªìm c·∫£ chu·∫©n b·ªã. (Duration - Th·ªùi l∆∞·ª£ng)\n- C. N√≥ n·∫±m gi·ªØa Nepal v√† T√¢y T·∫°ng. (Location - V·ªã tr√≠)\n- D. Nhi·ªÅu ng∆∞·ªùi leo n√∫i th·ª≠ s·ª©c h√†ng nƒÉm. (Fact - S·ª± th·∫≠t)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi \"How long\" h·ªèi v·ªÅ kho·∫£ng th·ªùi gian. ƒê√°p √°n B cung c·∫•p th√¥ng tin th·ªùi gian (\"about two months\").\n\n**D·ªãch h·ªôi tho·∫°i:**\nJane: \"M·∫•t bao l√¢u ƒë·ªÉ leo l√™n ƒë·ªânh Everest?\"\nH∆∞·ªõng d·∫´n vi√™n: \"Th∆∞·ªùng m·∫•t kho·∫£ng hai th√°ng bao g·ªìm c·∫£ c√¥ng t√°c chu·∫©n b·ªã.\""
            },
            {
                "questionNumber": 9,
                "question": "9. Mark: \"I'm worried about endangered animals in national parks.\"\nLucy: \"____________________\"",
                "answerOptions": [
                    { "text": "A. National parks have many visitors.", "isCorrect": false },
                    { "text": "B. Animals live in their natural habitat.", "isCorrect": false },
                    { "text": "C. Parks are open all year round.", "isCorrect": false },
                    { "text": "D. Me too. We need stronger protection laws.", "isCorrect": true }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. C√°c c√¥ng vi√™n qu·ªëc gia c√≥ nhi·ªÅu du kh√°ch. (Fact - S·ª± th·∫≠t)\n- B. ƒê·ªông v·∫≠t s·ªëng trong m√¥i tr∆∞·ªùng t·ª± nhi√™n c·ªßa ch√∫ng. (Fact - S·ª± th·∫≠t)\n- C. C√°c c√¥ng vi√™n m·ªü c·ª≠a quanh nƒÉm. (Fact - S·ª± th·∫≠t)\n- D. T·ªõ c≈©ng v·∫≠y. Ch√∫ng ta c·∫ßn lu·∫≠t b·∫£o v·ªá m·∫°nh m·∫Ω h∆°n. (Agreement/Empathy - ƒê·ªìng c·∫£m)\n\n**Gi·∫£i th√≠ch:** Mark ƒëang chia s·∫ª m·ªôt n·ªói lo l·∫Øng (\"I'm worried\"). Lucy n√™n th·ªÉ hi·ªán s·ª± ƒë·ªìng c·∫£m ho·∫∑c c√πng quan ƒëi·ªÉm. ƒê√°p √°n D (\"Me too\") th·ªÉ hi·ªán s·ª± ƒë·ªìng t√¨nh v√† ƒë·ªÅ xu·∫•t gi·∫£i ph√°p.\n\n**D·ªãch h·ªôi tho·∫°i:**\nMark: \"T·ªõ lo l·∫Øng v·ªÅ c√°c lo√†i ƒë·ªông v·∫≠t c√≥ nguy c∆° tuy·ªát ch·ªßng trong c√°c c√¥ng vi√™n qu·ªëc gia.\"\nLucy: \"T·ªõ c≈©ng v·∫≠y. Ch√∫ng ta c·∫ßn nh·ªØng lu·∫≠t l·ªá b·∫£o v·ªá m·∫°nh m·∫Ω h∆°n.\""
            },
            {
                "questionNumber": 10,
                "question": "10. Amy: \"What should I bring for tomorrow's waterfall trip?\"\nJack: \"____________________\"",
                "answerOptions": [
                    { "text": "A. The waterfall is 50 meters high.", "isCorrect": false },
                    { "text": "B. Don't forget comfortable shoes and a raincoat.", "isCorrect": true },
                    { "text": "C. Many people visit the waterfall.", "isCorrect": false },
                    { "text": "D. The waterfall is in the forest.", "isCorrect": false }
                ],
                "rationale": "**D·ªãch chi ti·∫øt:**\n- A. Th√°c n∆∞·ªõc cao 50 m√©t. (Fact - S·ª± th·∫≠t)\n- B. ƒê·ª´ng qu√™n gi√†y tho·∫£i m√°i v√† √°o m∆∞a nh√©. (Advice - L·ªùi khuy√™n)\n- C. Nhi·ªÅu ng∆∞·ªùi ƒë·∫øn thƒÉm th√°c n∆∞·ªõc. (Fact - S·ª± th·∫≠t)\n- D. Th√°c n∆∞·ªõc n·∫±m trong r·ª´ng. (Location - V·ªã tr√≠)\n\n**Gi·∫£i th√≠ch:** C√¢u h·ªèi \"What should I bring...?\" l√† xin l·ªùi khuy√™n v·ªÅ ƒë·ªì ƒë·∫°c c·∫ßn mang. ƒê√°p √°n B ƒë∆∞a ra l·ªùi khuy√™n c·ª• th·ªÉ (\"Don't forget...\") v·ªÅ c√°c v·∫≠t d·ª•ng c·∫ßn thi·∫øt.\n\n**D·ªãch h·ªôi tho·∫°i:**\nAmy: \"T·ªõ n√™n mang g√¨ cho chuy·∫øn ƒëi th√°c n∆∞·ªõc ng√†y mai?\"\nJack: \"ƒê·ª´ng qu√™n gi√†y tho·∫£i m√°i v√† √°o m∆∞a nh√©.\""
            }
        ]
    };

    // Shuffle Function
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // State
    let quizData = shuffleArray([...rawData.questions]);
    let userScore = 0;
    let answeredCount = 0;
    const totalQuestions = quizData.length;

    // --- SOUND ENGINE (Web Audio API) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding! High pitch sine
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else if (type === 'wrong') {
            // Buzz! Low pitch sawtooth
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // --- MARKDOWN PARSER (Simple) ---
    function parseMarkdown(text) {
        let html = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
            .replace(/\n/g, '<br>') // Newlines
            .replace(/- /g, '‚Ä¢ '); // Lists
        return html;
    }

    // --- RENDER LOGIC ---
    function initQuiz() {
        const quizArea = document.getElementById('quiz-area');
        quizArea.innerHTML = '';

        quizData.forEach((q, index) => {
            // Create Card
            const card = document.createElement('div');
            card.className = 'quiz-card';
            
            // Question Text
            const qNum = document.createElement('div');
            qNum.className = 'question-number';
            qNum.innerText = `C√¢u h·ªèi ${index + 1}`;
            
            const qText = document.createElement('div');
            qText.className = 'question-text';
            qText.innerText = q.question;

            // Options Grid
            const grid = document.createElement('div');
            grid.className = 'options-grid';

            q.answerOptions.forEach((opt, optIndex) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span style="margin-right:10px; font-weight:800;"></span> ${opt.text}`;
                btn.onclick = () => handleAnswer(index, optIndex, btn, q.rationale, opt.isCorrect);
                grid.appendChild(btn);
            });

            // Explanation Box
            const expl = document.createElement('div');
            expl.className = 'explanation-box';
            expl.id = `expl-${index}`;
            expl.innerHTML = `
                <div class="explanation-title"><i class="fas fa-lightbulb"></i> Gi·∫£i th√≠ch chi ti·∫øt c·ªßa Ms Mai An:</div>
                <div class="explanation-content rationale-text">${parseMarkdown(q.rationale)}</div>
            `;

            card.appendChild(qNum);
            card.appendChild(qText);
            card.appendChild(grid);
            card.appendChild(expl);
            quizArea.appendChild(card);
        });
    }

    function handleAnswer(qIndex, optIndex, btnElement, rationale, isCorrect) {
        // Prevent re-answering logic if desired, but here we disable siblings
        const card = btnElement.closest('.quiz-card');
        const buttons = card.querySelectorAll('.option-btn');
        
        // Check if already answered
        let alreadyAnswered = false;
        buttons.forEach(b => {
            if (b.disabled) alreadyAnswered = true;
        });
        if (alreadyAnswered) return;

        // Disable all buttons in this card
        buttons.forEach(b => b.disabled = true);

        // UI Feedback
        if (isCorrect) {
            btnElement.classList.add('correct');
            btnElement.innerHTML += ' <i class="fas fa-check-circle" style="margin-left:auto;"></i>';
            playSound('correct');
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#00C9A7', '#8854C0', '#F1C40F']
            });
            userScore++;
        } else {
            btnElement.classList.add('wrong');
            btnElement.innerHTML += ' <i class="fas fa-times-circle" style="margin-left:auto;"></i>';
            playSound('wrong');
            // Highlight correct one
            quizData[qIndex].answerOptions.forEach((opt, i) => {
                if (opt.isCorrect) {
                    buttons[i].classList.add('correct');
                    buttons[i].innerHTML += ' <i class="fas fa-check-circle" style="margin-left:auto;"></i>';
                }
            });
        }

        // Show Explanation Immediately
        const explBox = document.getElementById(`expl-${qIndex}`);
        explBox.classList.add('show');

        // Update Progress
        answeredCount++;
        updateProgress();

        // Check if all answered
        if (answeredCount === totalQuestions) {
            document.getElementById('submit-btn').classList.remove('hidden');
            // Scroll to submit button smoothly
            setTimeout(() => {
                document.getElementById('submit-btn').scrollIntoView({ behavior: 'smooth' });
            }, 500);
        }
    }

    function updateProgress() {
        const percent = (answeredCount / totalQuestions) * 100;
        document.getElementById('progress-bar').style.width = `${percent}%`;
    }

    function showResults() {
        const modal = document.getElementById('result-modal');
        const scoreText = document.getElementById('final-score');
        const praise = document.getElementById('praise-text');

        scoreText.innerText = `${userScore}/${totalQuestions}`;
        
        const percentage = (userScore / totalQuestions) * 100;
        if (percentage === 100) praise.innerText = "Xu·∫•t s·∫Øc! C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em! üåü";
        else if (percentage >= 80) praise.innerText = "L√†m r·∫•t t·ªët! Em n·∫Øm b√†i r·∫•t ch·∫Øc ch·∫Øn! üéâ";
        else if (percentage >= 50) praise.innerText = "C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! Em l√†m ƒë∆∞·ª£c m√†! üí™";
        else praise.innerText = "ƒê·ª´ng bu·ªìn nh√©, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch ƒë·ªÉ hi·ªÉu b√†i h∆°n! üìö";

        modal.classList.add('active');
        playSound('correct'); // Victory sound
        confetti({
            particleCount: 200,
            spread: 100,
            origin: { y: 0.6 }
        });
    }

    // Init
    initQuiz();

</script>

</body>
</html>
