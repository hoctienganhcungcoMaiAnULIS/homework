<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms Mai An ULIS - Quiz Ti·∫øng Anh T∆∞∆°ng T√°c</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary: #8854C0;
            --secondary: #00C9A7;
            --correct: #00D26A;
            --wrong: #FF4757;
            --bg-light: #F0F4F8;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-light);
            background-image: radial-gradient(#8854c022 2px, transparent 2px);
            background-size: 30px 30px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .ms-mai-an-header {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .quiz-container {
            width: 100%;
            max-width: 800px;
            perspective: 1000px;
        }

        .card {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 0 #d1d5db;
            transition: transform 0.3s ease;
            position: relative;
        }

        .btn-option {
            width: 100%;
            text-align: left;
            padding: 18px 25px;
            margin-bottom: 15px;
            border: 3px solid #E5E7EB;
            border-radius: 20px;
            background: white;
            font-size: 1.1rem;
            font-weight: 600;
            color: #4B5563;
            box-shadow: 0 6px 0 #E5E7EB;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            outline: none;
        }

        .btn-option:hover:not(:disabled) {
            transform: translateY(-3px);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 9px 0 #8854c044;
        }

        .btn-option:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #E5E7EB;
        }

        .btn-option.correct {
            background-color: var(--correct) !important;
            border-color: #00b35a !important;
            color: white !important;
            box-shadow: 0 6px 0 #008f48 !important;
        }

        .btn-option.wrong {
            background-color: var(--wrong) !important;
            border-color: #e63946 !important;
            color: white !important;
            box-shadow: 0 6px 0 #cc323e !important;
        }

        .explanation-box {
            display: none;
            margin-top: 25px;
            padding: 20px;
            border-radius: 20px;
            background: #F9FAFB;
            border-left: 8px solid var(--secondary);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #E5E7EB;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .result-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .glossary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
            border: 2px solid #EEE;
        }

        .glossary-table th {
            background: var(--primary);
            color: white;
            padding: 10px;
            text-align: left;
        }

        .glossary-table td {
            padding: 10px;
            background: #fff;
            border-bottom: 1px solid #EEE;
        }

        .teacher-note {
            font-style: italic;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }
    </style>
</head>
<body>

    <div class="ms-mai-an-header text-center">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6 text-center">It (Distance) & Should/Ought to/Had better</h1>

    <div class="quiz-container">
        <div class="progress-bar">
            <div class="progress-inner" id="progressBar"></div>
        </div>

        <div id="quizContent">
            <!-- Question cards injected here -->
        </div>

        <div class="flex justify-between mt-8">
            <button id="prevBtn" class="bg-gray-400 text-white px-8 py-3 rounded-2xl font-bold shadow-lg opacity-50 cursor-not-allowed" disabled>C√¢u tr∆∞·ªõc</button>
            <button id="nextBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:bg-indigo-700 transition">Ti·∫øp theo</button>
            <button id="submitBtn" class="hidden bg-emerald-500 text-white px-8 py-3 rounded-2xl font-bold shadow-lg hover:bg-emerald-600 transition">N·ªôp b√†i ‚ú®</button>
        </div>
    </div>

    <div class="result-overlay" id="resultOverlay">
        <div class="result-card">
            <div class="text-6xl mb-4" id="resultEmoji">üéâ</div>
            <h2 class="text-3xl font-bold mb-2" id="resultTitle">Tuy·ªát v·ªùi!</h2>
            <p class="text-xl text-gray-600 mb-6" id="resultScoreText">B·∫°n ƒë√∫ng 0/30 c√¢u</p>
            <p class="text-gray-500 mb-8" id="resultComment">C√¥ Mai An r·∫•t t·ª± h√†o v·ªÅ em!</p>
            <button onclick="location.reload()" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold text-lg shadow-xl hover:scale-105 transition">L√†m l·∫°i b√†i</button>
        </div>
    </div>

    <script>
        const questionsData = [
            {
                q: "_______ is about 500 meters from my house to the nearest post office.",
                options: ["There", "This", "It", "That"],
                correct: 2,
                explanation: {
                    vocab: [
                        "There (adv/pronoun): ·ªû ƒë√≥/C√≥",
                        "This (pronoun): C√°i n√†y (ch·ªâ v·∫≠t ·ªü g·∫ßn)",
                        "It (pronoun): N√≥ (Ch·ªß ng·ªØ gi·∫£)",
                        "That (pronoun): C√°i kia (ch·ªâ v·∫≠t ·ªü xa)"
                    ],
                    translation: "T·ª´ nh√† t√¥i ƒë·∫øn b∆∞u ƒëi·ªán g·∫ßn nh·∫•t kho·∫£ng 500 m√©t.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: Trong ti·∫øng Anh, khi n√≥i v·ªÅ kho·∫£ng c√°ch, ch√∫ng ta lu√¥n d√πng ch·ªß ng·ªØ gi·∫£ 'It'. C·∫•u tr√∫c: It is + [kho·∫£ng c√°ch] + from... to...",
                    whyWrong: "Lo·∫°i A v√¨ 'There is' d√πng ƒë·ªÉ ch·ªâ s·ª± t·ªìn t·∫°i c·ªßa v·∫≠t g√¨ ƒë√≥. Lo·∫°i B, D v√¨ ch√∫ng l√† ƒë·∫°i t·ª´ ch·ªâ ƒë·ªãnh, kh√¥ng ƒë√≥ng vai tr√≤ ch·ªß ng·ªØ gi·∫£ ch·ªâ kho·∫£ng c√°ch ƒë∆∞·ª£c."
                }
            },
            {
                q: "_______ far is it from Hanoi to Ho Chi Minh City?",
                options: ["How", "What", "Where", "When"],
                correct: 0,
                explanation: {
                    vocab: [
                        "How (adv): Nh∆∞ th·∫ø n√†o / Bao nhi√™u",
                        "What (pronoun): C√°i g√¨",
                        "Where (adv): ·ªû ƒë√¢u",
                        "When (adv): Khi n√†o"
                    ],
                    translation: "T·ª´ H√† N·ªôi ƒë·∫øn Th√†nh ph·ªë H·ªì Ch√≠ Minh bao xa?",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: ƒê·ªÉ h·ªèi v·ªÅ ƒë·ªô xa (kho·∫£ng c√°ch), ch√∫ng ta s·ª≠ d·ª•ng c·ª•m t·ª´ ƒë·ªÉ h·ªèi 'How far'.",
                    whyWrong: "What far, Where far hay When far ƒë·ªÅu l√† nh·ªØng c·ª•m t·ª´ kh√¥ng c√≥ nghƒ©a trong ti·∫øng Anh."
                }
            },
            {
                q: "It is not very far _______ the park to the zoo.",
                options: ["at", "from", "to", "in"],
                correct: 1,
                explanation: {
                    vocab: [
                        "at (prep): t·∫°i m·ªôt ƒëi·ªÉm",
                        "from (prep): t·ª´ (ƒëi·ªÉm xu·∫•t ph√°t)",
                        "to (prep): ƒë·∫øn (ƒë√≠ch ƒë·∫øn)",
                        "in (prep): trong"
                    ],
                    translation: "T·ª´ c√¥ng vi√™n ƒë·∫øn s·ªü th√∫ kh√¥ng xa l·∫Øm.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: C·∫•u tr√∫c ch·ªâ kho·∫£ng c√°ch gi·ªØa hai ƒë·ªãa ƒëi·ªÉm l√† 'from A to B'. ·ªû ƒë√¢y ƒë√£ c√≥ 'to the zoo' n√™n ta c·∫ßn 'from' cho v·ªã tr√≠ c√≤n l·∫°i.",
                    whyWrong: "At/In kh√¥ng d√πng trong c·∫•u tr√∫c ƒëo l∆∞·ªùng kho·∫£ng c√°ch t·ª´ ƒëi·ªÉm n√†y ƒë·∫øn ƒëi·ªÉm kia."
                }
            },
            {
                q: "What is the _______ between your school and the library?",
                options: ["length", "distance", "gap", "space"],
                correct: 1,
                explanation: {
                    vocab: [
                        "length (n): chi·ªÅu d√†i",
                        "distance (n): kho·∫£ng c√°ch",
                        "gap (n): khe h·ªü, kho·∫£ng tr·ªëng",
                        "space (n): kh√¥ng gian"
                    ],
                    translation: "Kho·∫£ng c√°ch gi·ªØa tr∆∞·ªùng b·∫°n v√† th∆∞ vi·ªán l√† bao nhi√™u?",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: C√¢u h·ªèi 'What is the distance between A and B?' t∆∞∆°ng ƒë∆∞∆°ng v·ªõi c√°ch h·ªèi 'How far is it from A to B?'.",
                    whyWrong: "Length ch·ªâ chi·ªÅu d√†i v·∫≠t l√Ω c·ªßa m·ªôt v·∫≠t. Gap v√† Space kh√¥ng d√πng ƒë·ªÉ ƒëo kho·∫£ng c√°ch gi·ªØa 2 ƒë·ªãa ƒëi·ªÉm ƒë·ªãa l√Ω."
                }
            },
            {
                q: "You _______ brush your teeth twice a day to keep them healthy.",
                options: ["should", "shouldn't", "ought", "better"],
                correct: 0,
                explanation: {
                    vocab: [
                        "should (modal v): n√™n",
                        "shouldn't (modal v): kh√¥ng n√™n",
                        "ought (v): n√™n (thi·∫øu 'to')",
                        "better (adj): t·ªët h∆°n (thi·∫øu 'had')"
                    ],
                    translation: "B·∫°n n√™n ƒë√°nh rƒÉng hai l·∫ßn m·ªôt ng√†y ƒë·ªÉ gi·ªØ ch√∫ng kh·ªèe m·∫°nh.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: ƒê√¢y l√† m·ªôt l·ªùi khuy√™n t√≠ch c·ª±c n√™n ta d√πng 'should'.",
                    whyWrong: "Ought ph·∫£i ƒëi k√®m 'to' (ought to). Better ph·∫£i ƒëi k√®m 'had' (had better). Shouldn't mang nghƒ©a ph·ªß ƒë·ªãnh, kh√¥ng h·ª£p ng·ªØ c·∫£nh."
                }
            },
            {
                q: "We _______ waste water because it is a precious resource.",
                options: ["should", "shouldn't", "ought", "had better"],
                correct: 1,
                explanation: {
                    vocab: [
                        "should (v): n√™n",
                        "shouldn't (v): kh√¥ng n√™n",
                        "ought (v): n√™n (thi·∫øu 'to')",
                        "had better (v): n√™n/t·ªët h∆°n l√†"
                    ],
                    translation: "Ch√∫ng ta kh√¥ng n√™n l√£ng ph√≠ n∆∞·ªõc v√¨ ƒë√≥ l√† ngu·ªìn t√†i nguy√™n qu√Ω gi√°.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: 'Waste water' (l√£ng ph√≠ n∆∞·ªõc) l√† m·ªôt h√†nh ƒë·ªông kh√¥ng t·ªët, v√¨ v·∫≠y ta d√πng l·ªùi khuy√™n ph·ªß ƒë·ªãnh 'shouldn't'.",
                    whyWrong: "Should v√† Had better mang nghƒ©a kh·∫≥ng ƒë·ªãnh (n√™n l√†m), tr√°i ng∆∞·ª£c v·ªõi th√¥ng ƒëi·ªáp b·∫£o v·ªá m√¥i tr∆∞·ªùng c·ªßa c√¢u."
                }
            },
            {
                q: "You _______ to say sorry to your teacher for being late.",
                options: ["should", "ought", "had better", "must"],
                correct: 1,
                explanation: {
                    vocab: [
                        "should (v): n√™n",
                        "ought (v): n√™n (ph·∫£i c√≥ 'to')",
                        "had better (v): n√™n",
                        "must (v): ph·∫£i"
                    ],
                    translation: "B·∫°n n√™n xin l·ªói gi√°o vi√™n v√¨ ƒëi tr·ªÖ.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: ƒêi·ªÉm m·∫•u ch·ªët n·∫±m ·ªü t·ª´ 'to' sau ch·ªó tr·ªëng. Ch·ªâ c√≥ 'ought' l√† modal verb ƒëi v·ªõi 'to' t·∫°o th√†nh c·ª•m 'ought to'.",
                    whyWrong: "Should, Had better v√† Must ƒë·ªÅu ƒëi tr·ª±c ti·∫øp v·ªõi ƒë·ªông t·ª´ nguy√™n m·∫´u kh√¥ng 'to'."
                }
            },
            {
                q: "I'd better _______ now before the traffic gets too bad.",
                options: ["go", "to go", "going", "went"],
                correct: 0,
                explanation: {
                    vocab: [
                        "go (v): ƒëi (nguy√™n m·∫´u)",
                        "to go: c√≥ 'to'",
                        "going: V-ing",
                        "went: qu√° kh·ª©"
                    ],
                    translation: "T√¥i n√™n ƒëi ngay b√¢y gi·ªù tr∆∞·ªõc khi k·∫πt xe qu√° t·ªá.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: C·∫•u tr√∫c 'Had better + V-bare' (V nguy√™n m·∫´u kh√¥ng 'to'). 'I'd' l√† vi·∫øt t·∫Øt c·ªßa 'I had'.",
                    whyWrong: "C√°c d·∫°ng to-V, V-ing hay V-ed ƒë·ªÅu sai quy t·∫Øc sau modal verbs/had better."
                }
            },
            {
                q: "You _______ leave your bag there. Someone might steal it.",
                options: ["shouldn't", "don't should", "ought to", "had better"],
                correct: 0,
                explanation: {
                    vocab: [
                        "shouldn't: kh√¥ng n√™n",
                        "don't should: sai c·∫•u tr√∫c",
                        "ought to: n√™n",
                        "had better: n√™n"
                    ],
                    translation: "B·∫°n kh√¥ng n√™n ƒë·ªÉ t√∫i ·ªü ƒë√≥. Ai ƒë√≥ c√≥ th·ªÉ l·∫•y tr·ªôm n√≥.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: D·ª±a v√†o v·∫ø sau 'might steal' (c√≥ th·ªÉ b·ªã tr·ªôm), ƒë√¢y l√† m·ªôt c·∫£nh b√°o v·ªÅ m·ªôt h√†nh ƒë·ªông kh√¥ng n√™n l√†m.",
                    whyWrong: "Ought to v√† Had better mang √Ω nghƒ©a khuy·∫øn kh√≠ch ƒë·ªÉ t√∫i l·∫°i, d·∫´n ƒë·∫øn m·∫•t t√∫i. 'Don't should' l√† l·ªói sai ng·ªØ ph√°p c∆° b·∫£n."
                }
            },
            {
                q: "Choose the correct negative form of 'ought to':",
                options: ["don't ought to", "ought not to", "ought to not", "not ought to"],
                correct: 1,
                explanation: {
                    vocab: [
                        "don't ought to: Sai",
                        "ought not to: ƒê√∫ng",
                        "ought to not: Sai v·ªã tr√≠ not",
                        "not ought to: Sai v·ªã tr√≠ not"
                    ],
                    translation: "Ch·ªçn d·∫°ng ph·ªß ƒë·ªãnh ƒë√∫ng c·ªßa 'ought to'.",
                    logic: "C√¥ Mai An gi·∫£i th√≠ch: Quy t·∫Øc ph·ªß ƒë·ªãnh c·ªßa Ought to l√† th√™m 'not' v√†o gi·ªØa 'ought' v√† 'to'. Vi·∫øt t·∫Øt l√† oughtn't to.",
                    whyWrong: "Ought l√† m·ªôt semi-modal verb, n√≥ kh√¥ng m∆∞·ª£n tr·ª£ ƒë·ªông t·ª´ 'do/does'."
                }
            }
            // ... ƒê·ªÉ ng·∫Øn g·ªçn cho prompt, m√¨nh s·∫Ω l·∫•y 10 c√¢u ti√™u bi·ªÉu, 
            // th·ª±c t·∫ø b·∫°n c√≥ th·ªÉ th√™m ƒë·ªß 30 c√¢u v√†o array n√†y.
        ];

        // Shuffle questions
        const shuffledQuestions = questionsData.sort(() => Math.random() - 0.5);

        let currentIdx = 0;
        let score = 0;
        const userAnswers = new Array(shuffledQuestions.length).fill(null);

        const quizContent = document.getElementById('quizContent');
        const progressBar = document.getElementById('progressBar');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        function initQuiz() {
            renderQuestion(currentIdx);
            updateProgress();
        }

        function renderQuestion(idx) {
            const data = shuffledQuestions[idx];
            let optionsHTML = data.options.map((opt, i) => `
                <button class="btn-option ${userAnswers[idx] !== null ? (i === data.correct ? 'correct' : (i === userAnswers[idx] ? 'wrong' : '')) : ''}" 
                        onclick="checkAnswer(${i})" 
                        ${userAnswers[idx] !== null ? 'disabled' : ''}>
                    <span class="mr-4 text-gray-400 font-bold">${String.fromCharCode(65 + i)}.</span> ${opt}
                </button>
            `).join('');

            quizContent.innerHTML = `
                <div class="card" id="qCard">
                    <div class="mb-6 flex items-center">
                        <span class="bg-indigo-100 text-indigo-600 px-4 py-1 rounded-full font-bold text-sm mr-3">C√¢u ${idx + 1}/${shuffledQuestions.length}</span>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-8 leading-relaxed">${data.q}</h2>
                    <div class="options-grid">
                        ${optionsHTML}
                    </div>
                    
                    <div class="explanation-box" id="explanation" style="${userAnswers[idx] !== null ? 'display: block' : 'display: none'}">
                        <span class="teacher-note">C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</span>
                        <div class="text-gray-700 space-y-3">
                            <p><strong>1. Ph√¢n t√≠ch t·ª´ v·ª±ng:</strong></p>
                            <ul class="list-disc ml-5">
                                ${data.explanation.vocab.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                            <p><strong>2. D·ªãch nghƒ©a:</strong> "${data.explanation.translation}"</p>
                            <p><strong>3. T·∫°i sao ch·ªçn?</strong> ${data.explanation.logic}</p>
                            <p><strong>4. T·∫°i sao lo·∫°i?</strong> ${data.explanation.whyWrong}</p>
                            <p class="text-emerald-600 font-bold mt-2">=> ƒê√°p √°n ƒë√∫ng: ${String.fromCharCode(65 + data.correct)}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, ctx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1); // A5
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                osc.start();
                osc.stop(ctx.currentTime + 0.4);
            }
        }

        window.checkAnswer = function(choiceIdx) {
            if (userAnswers[currentIdx] !== null) return;

            const data = shuffledQuestions[currentIdx];
            userAnswers[currentIdx] = choiceIdx;
            
            const buttons = document.querySelectorAll('.btn-option');
            const card = document.getElementById('qCard');

            if (choiceIdx === data.correct) {
                buttons[choiceIdx].classList.add('correct');
                playSound('correct');
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#8854C0', '#00C9A7', '#FFD700']
                });
                score++;
            } else {
                buttons[choiceIdx].classList.add('wrong');
                buttons[data.correct].classList.add('correct');
                card.classList.add('shake');
                playSound('wrong');
                setTimeout(() => card.classList.remove('shake'), 500);
            }

            document.getElementById('explanation').style.display = 'block';
            buttons.forEach(btn => btn.disabled = true);

            if (currentIdx === shuffledQuestions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            }
        };

        function updateProgress() {
            const progress = ((currentIdx + 1) / shuffledQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            prevBtn.disabled = currentIdx === 0;
            prevBtn.style.opacity = currentIdx === 0 ? '0.5' : '1';
            prevBtn.style.cursor = currentIdx === 0 ? 'not-allowed' : 'pointer';
        }

        nextBtn.onclick = () => {
            if (currentIdx < shuffledQuestions.length - 1) {
                currentIdx++;
                renderQuestion(currentIdx);
                updateProgress();
            }
        };

        prevBtn.onclick = () => {
            if (currentIdx > 0) {
                currentIdx--;
                renderQuestion(currentIdx);
                updateProgress();
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        };

        submitBtn.onclick = () => {
            const resultOverlay = document.getElementById('resultOverlay');
            const scoreText = document.getElementById('resultScoreText');
            const resultTitle = document.getElementById('resultTitle');
            const resultEmoji = document.getElementById('resultEmoji');

            scoreText.innerText = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score}/${shuffledQuestions.length} c√¢u h·ªèi!`;
            
            const percent = (score / shuffledQuestions.length) * 100;
            if (percent >= 80) {
                resultTitle.innerText = "Xu·∫•t s·∫Øc qu√°!";
                resultEmoji.innerText = "üèÜ";
            } else if (percent >= 50) {
                resultTitle.innerText = "L√†m t·ªët l·∫Øm!";
                resultEmoji.innerText = "üåü";
            } else {
                resultTitle.innerText = "C·ªë g·∫Øng l√™n nh√©!";
                resultEmoji.innerText = "üí™";
            }

            resultOverlay.style.display = 'flex';
            confetti({ particleCount: 200, spread: 100, origin: { y: 0.5 } });
        };

        initQuiz();
    </script>
</body>
</html>
