<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Quiz - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0; /* M√†u loang theo y√™u c·∫ßu */
            --primary-mint: #00C9A7;
            --primary-yellow: #FDCB6E;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-dark: #2d3436;
        }

        body {
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
            /* H·ªça ti·∫øt n·ªÅn vui nh·ªôn: Ng√¥i sao, k·∫πo ng·ªçt, mix m√†u loang */
            background: linear-gradient(135deg, rgba(136,84,192,0.8) 0%, rgba(253,203,110,0.8) 50%, rgba(0,201,167,0.8) 100%), 
                        url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 15 L58 35 L80 35 L62 48 L68 70 L50 55 L32 70 L38 48 L20 35 L42 35 Z" fill="rgba(255,255,255,0.2)"/><circle cx="80" cy="80" r="10" fill="rgba(255,255,255,0.15)"/><circle cx="20" cy="80" r="5" fill="rgba(255,255,255,0.2)"/></svg>');
            background-blend-mode: overlay;
            color: var(--text-dark);
            padding-bottom: 120px;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 0 0 30px 30px;
            margin-bottom: 40px;
            border-bottom: 5px solid var(--primary-mint);
        }

        .header h5 { margin: 0; color: var(--primary-pink); font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        .header h1 { margin: 10px 0 0; color: var(--primary-mint); font-size: 2.2rem; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); }

        .container { max-width: 900px; margin: 0 auto; padding: 0 15px; }

        /* L√Ω thuy·∫øt Box */
        .theory-box {
            background: #fff; border: 4px dashed var(--primary-pink);
            border-radius: 20px; padding: 25px; margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15); position: relative;
        }
        .theory-title {
            background: var(--primary-pink); color: white; padding: 10px 25px;
            border-radius: 15px; display: inline-block; font-size: 1.5rem;
            font-weight: 900; margin-top: -45px; box-shadow: 0 5px 0 #5f27cd;
        }
        .theory-content h3 { color: var(--primary-mint); font-size: 1.3rem; margin-top: 20px;}
        .theory-content p { font-size: 1.1rem; line-height: 1.6;}
        
        .theory-table {
            width: 100%; border-collapse: collapse; margin-top: 10px;
            border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            background: white;
        }
        .theory-table th { background: var(--primary-mint); color: white; padding: 12px; font-size: 1.1rem; border: 1px solid #00A388;}
        .theory-table td { padding: 12px; border: 1px solid #eee; font-weight: bold; vertical-align: top;}
        .theory-table tr:nth-child(even) td { background: #f1f8f6; }
        
        .ex-box { background: #fff3cd; padding: 10px; border-left: 5px solid var(--primary-yellow); border-radius: 5px; margin-top: 5px; font-weight: normal;}

        .section-title {
            background: var(--primary-yellow); color: #2d3436; padding: 12px 25px;
            border-radius: 20px; display: inline-block; margin-top: 20px;
            box-shadow: 0 5px 0 #e1b12c; border: 3px solid white; font-size: 1.4rem; font-weight: 900;
        }

        .question-card {
            background: var(--card-bg); border-radius: 20px; padding: 25px; margin: 20px 0;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1); border: 2px solid #eee; transition: transform 0.2s;
        }

        .question-text { font-size: 1.3rem; font-weight: 800; margin-bottom: 20px; color: var(--primary-pink); }

        /* MCQ Options */
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .option-btn {
            background: white; border: 2px solid #e0e0e0; padding: 15px;
            border-radius: 15px; font-size: 1.2rem; font-weight: 800; color: var(--text-dark);
            cursor: pointer; box-shadow: 0 6px 0 #e0e0e0; transition: all 0.1s;
            font-family: 'Nunito', sans-serif; text-align: left;
        }
        .option-btn:hover { transform: scale(1.02) translateY(-2px); box-shadow: 0 8px 0 #e0e0e0; }
        .option-btn:active { transform: scale(0.98) translateY(4px); box-shadow: 0 2px 0 #e0e0e0; }
        .option-btn.correct { background: var(--correct-green); border-color: #00A355; color: white; box-shadow: 0 6px 0 #00A355; }
        .option-btn.wrong { background: var(--wrong-red); border-color: #D63031; color: white; box-shadow: 0 6px 0 #D63031; }

        /* Explanations */
        .explanation {
            display: none; margin-top: 25px; padding: 20px; background: #fdfbfb;
            border-left: 6px solid var(--primary-mint); border-radius: 12px;
            animation: slideDown 0.3s ease-out; line-height: 1.6; font-size: 1.1rem;
        }
        .explanation h4 { margin: 0 0 12px 0; color: var(--primary-pink); font-size: 1.3rem; text-transform: uppercase;}
        .explanation p { margin: 8px 0; }
        .explanation .highlight { font-weight: 900; color: var(--primary-mint); }

        /* Text Inputs (Ex 2, 3, 4) */
        .input-group { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-top: 10px;}
        .write-input {
            flex: 1; min-width: 250px; padding: 15px; border: 3px solid #dfe6e9; border-radius: 15px;
            font-family: 'Nunito'; font-size: 1.2rem; font-weight: bold;
            color: var(--primary-pink); outline: none; transition: 0.3s;
        }
        .write-input:focus { border-color: var(--primary-mint); }
        .write-input.correct { background: rgba(0,210,106,0.1); border-color: var(--correct-green); color: var(--correct-green); }
        .write-input.wrong { background: rgba(255,71,87,0.1); border-color: var(--wrong-red); color: var(--wrong-red); }
        
        .check-btn {
            background: var(--primary-mint); border: none; padding: 15px 30px;
            border-radius: 15px; font-weight: 900; font-size: 1.2rem; cursor: pointer; color: white;
            box-shadow: 0 6px 0 #00A388; transition: 0.1s; font-family: 'Nunito';
        }
        .check-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #00A388; }

        /* Animations */
        @keyframes slideDown { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px) rotate(-3deg); }
            75% { transform: translateX(8px) rotate(3deg); }
        }
        .shake { animation: shake 0.4s; }

        /* Submit Bar & Modal */
        .submit-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.15);
            text-align: center; z-index: 100; box-sizing: border-box;
        }
        .submit-btn {
            background: var(--primary-pink); color: white; border: none; padding: 15px 50px;
            font-size: 1.6rem; font-weight: 900; border-radius: 30px; cursor: pointer;
            box-shadow: 0 6px 0 #5f27cd; font-family: 'Nunito'; transition: 0.2s; text-transform: uppercase;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 0 #5f27cd; }
        .submit-btn:active { transform: translateY(6px); box-shadow: 0 0 0 #5f27cd; }
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 40px; border-radius: 25px; text-align: center; max-width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 5px solid var(--primary-mint);}
        .modal-content h2 { color: var(--primary-pink); margin-top: 0; font-size: 2.5rem; }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<div class="header">
    <h5>Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</h5>
    <h1>ƒê·ªânh Cao So S√°nh Tr·∫°ng T·ª´ üèÜ</h1>
</div>

<div class="container" id="quiz-container">

    <div class="theory-box">
        <div class="theory-title">I. So s√°nh v·ªõi tr·∫°ng t·ª´ üìö</div>
        <div class="theory-content">
            <h3>1. C·∫•u tr√∫c c√¢u so s√°nh h∆°n v·ªõi tr·∫°ng t·ª´</h3>
            <table class="theory-table">
                <tr>
                    <th>ƒê·ªëi v·ªõi tr·∫°ng t·ª´ ng·∫Øn</th>
                    <th>ƒê·ªëi v·ªõi tr·∫°ng t·ª´ d√†i</th>
                </tr>
                <tr>
                    <td><strong>S1 + V + adv + er + than + S2</strong><br><br>
                        V·ªõi c√°c tr·∫°ng t·ª´ ng·∫Øn (1 √¢m ti·∫øt), ta th√™m <strong>‚Äúer‚Äù</strong> v√†o sau.<br>
                        <div class="ex-box">V√≠ d·ª•:<br>- They work harder than I do.<br>- She runs faster than he does<br>- My mother gets up earlier than me.<br>- I go to school later than my friends do</div>
                    </td>
                    <td><strong>S1 + V + more / less + adv-ly gi·ªØ nguy√™n + than + S2</strong><br><br>
                        V·ªõi tr·∫°ng t·ª´ d√†i (2 √¢m ti·∫øt tr·ªü l√™n c√≥ ƒëu√¥i ‚Äúly‚Äù), ta th√™m <strong>‚Äúmore‚Äù</strong> (nhi·ªÅu h∆°n) v√†o tr∆∞·ªõc tr·∫°ng t·ª´.<br>
                        <div class="ex-box">V√≠ d·ª•:<br>- My friend did the test more carefully than I did.<br>- My father talks more slowly than my mother does.</div>
                    </td>
                </tr>
            </table>

            <h3>2. C·∫•u tr√∫c c√¢u so s√°nh nh·∫•t v·ªõi tr·∫°ng t·ª´</h3>
            <p><em>(L∆∞u √Ω: Ti√™u ƒë·ªÅ g·ªëc ghi "so s√°nh h∆°n" nh∆∞ng c√¥ng th·ª©c l√† so s√°nh nh·∫•t, c√¥ Mai An gi·ªØ nguy√™n ƒë·ªÅ b√†i g·ªëc ƒë·ªÉ c√°c con ƒë·ªëi chi·∫øu nh√©!)</em></p>
            <table class="theory-table">
                <tr>
                    <th>ƒê·ªëi v·ªõi tr·∫°ng t·ª´ ng·∫Øn</th>
                    <th>ƒê·ªëi v·ªõi tr·∫°ng t·ª´ d√†i</th>
                </tr>
                <tr>
                    <td><strong>S1 + V + the + adv + est + than + S2</strong> <em>(L∆∞u √Ω: So s√°nh nh·∫•t th∆∞·ªùng b·ªè "than")</em><br><br>
                        V·ªõi c√°c tr·∫°ng t·ª´ ng·∫Øn, ta th√™m <strong>‚Äúest‚Äù</strong> v√†o sau tr·∫°ng t·ª´.<br>
                        <div class="ex-box">V√≠ d·ª•:<br>- They work the hardest.<br>- She runs the fastest in the class.<br>- My mother gets up the earliest in my house</div>
                    </td>
                    <td><strong>S1 + V + the most + adv-ly gi·ªØ nguy√™n</strong><br><br>
                        V·ªõi tr·∫°ng t·ª´ d√†i, ta th√™m <strong>‚Äúthe most‚Äù</strong> (nhi·ªÅu nh·∫•t) v√†o tr∆∞·ªõc tr·∫°ng t·ª´.<br>
                        <div class="ex-box">V√≠ d·ª•:<br>- My friend did the test the most carefully in the class.<br>- My father talks the most slowly in my house.</div>
                    </td>
                </tr>
            </table>

            <h3>3. M·ªôt v√†i tr·∫°ng t·ª´ c√≥ d·∫°ng ƒë·∫∑c bi·ªát</h3>
            <table class="theory-table" style="text-align: center;">
                <tr>
                    <th>Tr·∫°ng t·ª´</th>
                    <th>D·∫°ng so s√°nh h∆°n</th>
                    <th>D·∫°ng so s√°nh nh·∫•t</th>
                </tr>
                <tr><td>well (t·ªët, hay)</td><td style="color:var(--primary-pink)">Better</td><td style="color:var(--primary-mint)">the best</td></tr>
                <tr><td>badly (t·ªá)</td><td style="color:var(--primary-pink)">Worse</td><td style="color:var(--primary-mint)">the worst</td></tr>
                <tr><td>far (xa)</td><td style="color:var(--primary-pink)">Farther / further</td><td style="color:var(--primary-mint)">the farthest / the furthest</td></tr>
                <tr><td>early (s·ªõm)</td><td style="color:var(--primary-pink)">Earlier</td><td style="color:var(--primary-mint)">the earliest</td></tr>
            </table>
        </div>
    </div>

    <h2 class="section-title">B√†i t·∫≠p 1: Ch·ªçn ƒë√°p √°n ƒë√∫ng nh·∫•t (10 c√¢u)</h2>
    <p><em>M·ª•c ti√™u: Nh·∫≠n di·ªán c·∫•u tr√∫c so s√°nh h∆°n v√† so s√°nh nh·∫•t c·ªßa tr·∫°ng t·ª´ ng·∫Øn, tr·∫°ng t·ª´ d√†i v√† c√°c d·∫°ng b·∫•t quy t·∫Øc.</em></p>
    <div id="ex1-container"></div>

    <h2 class="section-title">B√†i t·∫≠p 2: Chia d·∫°ng ƒë√∫ng c·ªßa tr·∫°ng t·ª´ (10 c√¢u)</h2>
    <p><em>M·ª•c ti√™u: Th·ª±c h√†nh t·ª± vi·∫øt ƒë√∫ng quy t·∫Øc th√™m "er/est" ho·∫∑c "more/most" v√† c√°c t·ª´ ƒë·∫∑c bi·ªát.</em></p>
    <div id="ex2-container"></div>

    <h2 class="section-title">B√†i t·∫≠p 3: Vi·∫øt l·∫°i c√¢u sao cho nghƒ©a kh√¥ng ƒë·ªïi (5 c√¢u)</h2>
    <p><em>M·ª•c ti√™u: V·∫≠n d·ª•ng c·∫•u tr√∫c so s√°nh ƒë·ªÉ di·ªÖn ƒë·∫°t l·∫°i √Ω m·ªôt c√°ch linh ho·∫°t. G√µ to√†n b·ªô c√¢u ph√≠a sau m≈©i t√™n ‚ûî nh√©!</em></p>
    <div id="ex3-container"></div>

    <h2 class="section-title">B√†i t·∫≠p 4: T√¨m v√† s·ª≠a l·ªói sai (5 c√¢u)</h2>
    <p><em>M·ª•c ti√™u: Luy·ªán t·∫≠p s·ª± ch√∫ √Ω v√†o chi ti·∫øt, ph√°t hi·ªán c√°c l·ªói sai ph·ªï bi·∫øn. Nh·∫≠p t·ª´ sai v√†o √¥ 1 v√† t·ª´ ƒë√∫ng v√†o √¥ 2.</em></p>
    <div id="ex4-container"></div>

</div>

<div class="submit-bar">
    <button class="submit-btn" id="submitBtn">N·ªòP B√ÄI & XEM ƒêI·ªÇM üèÜ</button>
</div>

<div class="modal" id="scoreModal">
    <div class="modal-content">
        <h2>üéâ HO√ÄN TH√ÄNH üéâ</h2>
        <p id="scoreText" style="font-size: 1.8rem; font-weight: 900; color: #2d3436;"></p>
        <p id="complimentText" style="color: var(--primary-mint); font-size: 1.3rem; font-weight: bold;"></p>
        <button class="check-btn" onclick="location.reload()" style="margin-top:20px; width:100%; font-size: 1.5rem;">L√†m l·∫°i b√†i nh√© üîÑ</button>
    </div>
</div>

<script>
    /* --- AUDIO EFFECTS (WEB AUDIO API) --- */
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = new AudioContext();

    function playDing() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1600, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
    }

    function playBuzz() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    /* --- CONFETTI EFFECT --- */
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let particles = [];
    function fireConfetti() {
        const colors = ['#00D26A', '#FF4757', '#FDCB6E', '#00C9A7', '#8854C0'];
        for(let i=0; i<80; i++) {
            particles.push({
                x: window.innerWidth / 2, y: window.innerHeight / 2,
                r: Math.random() * 8 + 4, dx: Math.random() * 16 - 8, dy: Math.random() * -16 - 8,
                color: colors[Math.floor(Math.random() * colors.length)], tilt: Math.random() * 10
            });
        }
    }
    function animateConfetti() {
        requestAnimationFrame(animateConfetti);
        ctx.clearRect(0,0,canvas.width, canvas.height);
        particles.forEach((p, index) => {
            p.dy += 0.4; p.x += p.dx; p.y += p.dy; p.tilt += 0.15;
            ctx.beginPath(); ctx.lineWidth = p.r; ctx.strokeStyle = p.color;
            ctx.moveTo(p.x + p.tilt + p.r, p.y); ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r); ctx.stroke();
            if(p.y > canvas.height) particles.splice(index, 1);
        });
    }
    animateConfetti();

    /* --- GLOBAL LOGIC --- */
    let score = 0;
    const TOTAL_QUESTIONS = 30;

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function cleanStr(str) { 
        return str.toLowerCase().replace(/[.,!?]/g, '').replace(/\s+/g, ' ').trim(); 
    }

    /* =========================================
       DATA & RENDER B√ÄI T·∫¨P 1 (MCQ)
    ========================================= */
    const ex1Data = [
        { q: "My brother runs ________ than I do.", opts: ["A. fast", "B. faster", "C. more fast"], ans: "B. faster", 
          vn: "Anh trai t√¥i ch·∫°y nhanh h∆°n t√¥i.", 
          p: "A. fast: nhanh (t·ª´ g·ªëc). B. faster: nhanh h∆°n. C. more fast: sai c·∫•u tr√∫c.", 
          r: "C√¢u c√≥ ch·ªØ 'than' n√™n d√πng so s√°nh h∆°n. Tr·∫°ng t·ª´ 'fast' l√† tr·∫°ng t·ª´ ng·∫Øn (1 √¢m ti·∫øt) -> th√™m ƒëu√¥i '-er' th√†nh 'faster'.", 
          w: "A thi·∫øu so s√°nh. C sai v√¨ tr·∫°ng t·ª´ ng·∫Øn kh√¥ng ƒëi v·ªõi 'more'." },
        
        { q: "Of all the students in my class, Lan studies ________.", opts: ["A. the hardest", "B. harder", "C. the most hard"], ans: "A. the hardest", 
          vn: "Trong t·∫•t c·∫£ h·ªçc sinh l·ªõp t√¥i, Lan h·ªçc chƒÉm ch·ªâ nh·∫•t.", 
          p: "A. the hardest: chƒÉm nh·∫•t. B. harder: chƒÉm h∆°n. C. the most hard: sai c·∫•u tr√∫c.", 
          r: "C·ª•m 'Of all the students' (Trong t·∫•t c·∫£ h·ªçc sinh) d·∫•u hi·ªáu c·ªßa so s√°nh nh·∫•t. 'hard' l√† tr·∫°ng t·ª´ ng·∫Øn -> th√™m 'the + est' th√†nh 'the hardest'.", 
          w: "B l√† so s√°nh h∆°n. C sai v√¨ 'hard' kh√¥ng d√πng 'the most'." },

        { q: "Please speak ________ so that everyone can hear you.", opts: ["A. more clearly", "B. clear", "C. clearlyer"], ans: "A. more clearly", 
          vn: "L√†m ∆°n h√£y n√≥i r√µ r√†ng h∆°n ƒë·ªÉ m·ªçi ng∆∞·ªùi c√≥ th·ªÉ nghe th·∫•y b·∫°n.", 
          p: "A. more clearly: r√µ r√†ng h∆°n. B. clear: r√µ r√†ng (t√≠nh t·ª´). C. clearlyer: sai c·∫•u tr√∫c.", 
          r: "C√¢u mang √Ω so s√°nh ng·∫ßm (n√≥i r√µ h∆°n l√∫c n√£y). ƒê·ªông t·ª´ 'speak' c·∫ßn tr·∫°ng t·ª´ 'clearly'. ƒê√¢y l√† tr·∫°ng t·ª´ d√†i ƒëu√¥i '-ly' -> th√™m 'more'.", 
          w: "B l√† t√≠nh t·ª´ kh√¥ng ƒë·ª©ng sau ƒë·ªông t·ª´ th∆∞·ªùng. C sai v√¨ t·ª´ d√†i kh√¥ng th√™m '-er'." },

        { q: "Nam plays football ________ than his friends.", opts: ["A. more well", "B. gooder", "C. better"], ans: "C. better", 
          vn: "Nam ch∆°i b√≥ng ƒë√° gi·ªèi h∆°n b·∫°n b√® c·ªßa anh ·∫•y.", 
          p: "A. more well: sai. B. gooder: sai. C. better: t·ªët h∆°n/gi·ªèi h∆°n.", 
          r: "C√≥ 'than' -> So s√°nh h∆°n. Tr·∫°ng t·ª´ c·ªßa 'play' l√† 'well'. 'Well' l√† tr∆∞·ªùng h·ª£p B·∫§T QUY T·∫ÆC, d·∫°ng so s√°nh h∆°n c·ªßa n√≥ l√† 'better'.", 
          w: "A v√† B ƒë·ªÅu l√† nh·ªØng t·ª´ t·ª± b·ªãa ra, kh√¥ng c√≥ trong ti·∫øng Anh." },

        { q: "She smiled ________ than anyone else in the room.", opts: ["A. the most happily", "B. more happily", "C. happily"], ans: "B. more happily", 
          vn: "C√¥ ·∫•y ƒë√£ m·ªâm c∆∞·ªùi h·∫°nh ph√∫c h∆°n b·∫•t k·ª≥ ai kh√°c trong ph√≤ng.", 
          p: "A. the most happily: h·∫°nh ph√∫c nh·∫•t. B. more happily: h·∫°nh ph√∫c h∆°n. C. happily: h·∫°nh ph√∫c (g·ªëc).", 
          r: "D·∫•u hi·ªáu r√µ r√†ng l√† ch·ªØ 'than' (h∆°n). 'happily' l√† tr·∫°ng t·ª´ d√†i c√≥ ƒëu√¥i '-ly' -> th√™m 'more' ph√≠a tr∆∞·ªõc.", 
          w: "A l√† so s√°nh nh·∫•t (kh√¥ng ƒëi v·ªõi than). C thi·∫øu d·∫°ng so s√°nh." },

        { q: "Who gets up ________ in your family?", opts: ["A. early", "B. the earliest", "C. the most early"], ans: "B. the earliest", 
          vn: "Ai th·ª©c d·∫≠y s·ªõm nh·∫•t trong gia ƒë√¨nh b·∫°n?", 
          p: "A. early: s·ªõm. B. the earliest: s·ªõm nh·∫•t. C. the most early: sai.", 
          r: "H·ªèi ai nh·∫•t 'in your family' -> So s√°nh nh·∫•t. 'Early' l√† t·ª´ ƒë·∫∑c bi·ªát, ƒë∆∞·ª£c coi nh∆∞ tr·∫°ng t·ª´ ng·∫Øn -> ƒë·ªïi 'y' th√†nh 'i' v√† th√™m 'est'.", 
          w: "C sai v√¨ 'early' kh√¥ng d√πng v·ªõi 'the most'. A thi·∫øu so s√°nh." },

        { q: "I did the test ________ than my sister did.", opts: ["A. worse", "B. badder", "C. the worst"], ans: "A. worse", 
          vn: "T√¥i l√†m b√†i ki·ªÉm tra t·ªá h∆°n ch·ªã g√°i t√¥i.", 
          p: "A. worse: t·ªá h∆°n. B. badder: sai. C. the worst: t·ªá nh·∫•t.", 
          r: "C√≥ ch·ªØ 'than' -> So s√°nh h∆°n. Tr·∫°ng t·ª´ g·ªëc l√† 'badly' (l√†m b√†i t·ªá). 'badly' l√† t·ª´ B·∫§T QUY T·∫ÆC, so s√°nh h∆°n bi·∫øn th√†nh 'worse'.", 
          w: "B kh√¥ng t·ªìn t·∫°i. C l√† so s√°nh nh·∫•t, kh√¥ng ƒëi v·ªõi than." },

        { q: "He drives ________ of all the drivers I know.", opts: ["A. more carefully", "B. the most carefully", "C. the carefully"], ans: "B. the most carefully", 
          vn: "Anh ·∫•y l√°i xe c·∫©n th·∫≠n nh·∫•t trong s·ªë t·∫•t c·∫£ t√†i x·∫ø t√¥i bi·∫øt.", 
          p: "A. more carefully: c·∫©n th·∫≠n h∆°n. B. the most carefully: c·∫©n th·∫≠n nh·∫•t. C. the carefully: sai.", 
          r: "C·ª•m 'of all the drivers' (trong t·∫•t c·∫£...) -> So s√°nh nh·∫•t. 'carefully' l√† tr·∫°ng t·ª´ d√†i -> th√™m 'the most' ph√≠a tr∆∞·ªõc.", 
          w: "A l√† so s√°nh h∆°n. C sai ng·ªØ ph√°p ho√†n to√†n." },

        { q: "Jim threw the ball ________ than Peter.", opts: ["A. farther", "B. the farthest", "C. farer"], ans: "A. farther", 
          vn: "Jim n√©m qu·∫£ b√≥ng xa h∆°n Peter.", 
          p: "A. farther: xa h∆°n. B. the farthest: xa nh·∫•t. C. farer: sai.", 
          r: "C√≥ 'than' -> So s√°nh h∆°n. Tr·∫°ng t·ª´ 'far' (xa) l√† tr∆∞·ªùng h·ª£p ƒê·∫∂C BI·ªÜT, ƒë·ªïi th√†nh 'farther' ho·∫∑c 'further'.", 
          w: "B l√† so s√°nh nh·∫•t. C sai v√¨ kh√¥ng c√≥ t·ª´ 'farer'." },

        { q: "We need to work ________ if we want to finish this project on time.", opts: ["A. more hard", "B. harder", "C. the hardest"], ans: "B. harder", 
          vn: "Ch√∫ng ta c·∫ßn l√†m vi·ªác chƒÉm ch·ªâ h∆°n n·∫øu mu·ªën ho√†n th√†nh d·ª± √°n n√†y ƒë√∫ng h·∫°n.", 
          p: "A. more hard: sai. B. harder: chƒÉm h∆°n. C. the hardest: chƒÉm nh·∫•t.", 
          r: "Ng·ªØ c·∫£nh √°m ch·ªâ s·ª± so s√°nh ng·∫ßm (ph·∫£i l√†m chƒÉm h∆°n b√¨nh th∆∞·ªùng). 'hard' l√† tr·∫°ng t·ª´ ng·∫Øn -> th√™m 'er' th√†nh 'harder'.", 
          w: "A sai v√¨ 'hard' kh√¥ng ƒëi v·ªõi 'more'. C sai ng·ªØ c·∫£nh (kh√¥ng c·∫ßn d√πng m·ª©c nh·∫•t ·ªü ƒë√¢y)." }
    ];

    const ex1Container = document.getElementById('ex1-container');
    ex1Data.forEach((item, index) => {
        let shuffledOpts = shuffleArray([...item.opts]);
        let btnHtml = shuffledOpts.map(opt => `<button class="option-btn" data-val="${opt}">${opt}</button>`).join('');
        
        let html = `
        <div class="question-card mcq-card" data-ans="${item.ans}">
            <div class="question-text">${index + 1}. ${item.q}</div>
            <div class="options-grid">${btnHtml}</div>
            <div class="explanation">
                <h4>üí° Gi·∫£i th√≠ch si√™u chi ti·∫øt:</h4>
                <p><strong>1. D·ªãch c√¢u:</strong> ${item.vn}</p>
                <p><strong>2. Ph√¢n t√≠ch 3 ƒë√°p √°n:</strong> ${item.p}</p>
                <p><strong>3. T·∫°i sao ƒë√∫ng?</strong> <span class="highlight">${item.r}</span></p>
                <p><strong>4. T·∫°i sao sai?</strong> ${item.w}</p>
            </div>
        </div>`;
        ex1Container.innerHTML += html;
    });

    document.querySelectorAll('.mcq-card').forEach(card => {
        const btns = card.querySelectorAll('.option-btn');
        const correctAns = card.getAttribute('data-ans');
        const exp = card.querySelector('.explanation');
        let answered = false;

        btns.forEach(btn => {
            btn.addEventListener('click', () => {
                if(answered) return;
                answered = true;
                if(btn.getAttribute('data-val') === correctAns) {
                    btn.classList.add('correct'); playDing(); fireConfetti(); score++;
                } else {
                    btn.classList.add('wrong'); card.classList.add('shake'); playBuzz();
                    btns.forEach(b => { if(b.getAttribute('data-val') === correctAns) b.classList.add('correct'); });
                }
                exp.style.display = 'block';
            });
        });
    });

    /* =========================================
       DATA & RENDER B√ÄI T·∫¨P 2 (GAP FILL)
    ========================================= */
    const ex2Data = [
        { q: "She sings (beautifully) _______________ than her sister.", ans: ["more beautifully"], vn: "C√¥ ·∫•y h√°t hay h∆°n ch·ªã g√°i c√¥ ·∫•y.", p: "T·ª´ g·ªëc: beautifully (hay, ƒë·∫πp) - Tr·∫°ng t·ª´ d√†i ƒëu√¥i '-ly'.", r: "C√≥ 'than' -> so s√°nh h∆°n. Tr·∫°ng t·ª´ d√†i th√™m 'more' ph√≠a tr∆∞·ªõc.", w: "Kh√¥ng th√™m '-er' hay 'most' v√†o tr·∫°ng t·ª´ d√†i ƒëu√¥i -ly ·ªü d·∫°ng so s√°nh h∆°n." },
        { q: "Tom runs (fast) _______________ in his school.", ans: ["the fastest"], vn: "Tom ch·∫°y nhanh nh·∫•t trong tr∆∞·ªùng anh ·∫•y.", p: "T·ª´ g·ªëc: fast (nhanh) - Tr·∫°ng t·ª´ ng·∫Øn 1 √¢m.", r: "C√≥ 'in his school' -> so s√°nh nh·∫•t. Tr·∫°ng t·ª´ ng·∫Øn th√™m 'the + est'.", w: "Kh√¥ng d√πng 'more' hay 'most' cho tr·∫°ng t·ª´ ng·∫Øn." },
        { q: "I speak English (fluently) _______________ now than I did last year.", ans: ["more fluently"], vn: "B√¢y gi·ªù t√¥i n√≥i ti·∫øng Anh tr√¥i ch·∫£y h∆°n nƒÉm ngo√°i.", p: "T·ª´ g·ªëc: fluently (tr√¥i ch·∫£y) - Tr·∫°ng t·ª´ d√†i.", r: "C√≥ 'than' -> so s√°nh h∆°n. Tr·∫°ng t·ª´ d√†i th√™m 'more' ph√≠a tr∆∞·ªõc.", w: "Kh√¥ng bao gi·ªù c√≥ d·∫°ng 'fluentlyer'." },
        { q: "Of all the girls, Mary dances (well) _______________.", ans: ["the best"], vn: "Trong t·∫•t c·∫£ c√°c c√¥ g√°i, Mary nh·∫£y ƒë·∫πp nh·∫•t.", p: "T·ª´ g·ªëc: well (t·ªët/ƒë·∫πp) - Tr·∫°ng t·ª´ b·∫•t quy t·∫Øc.", r: "C√≥ 'Of all' -> so s√°nh nh·∫•t. 'well' chuy·ªÉn th√†nh 'the best'.", w: "C·∫•m d√πng 'the wellest' hay 'the most well' nh√©!" },
        { q: "My father drives (slowly) _______________ than my mother.", ans: ["more slowly"], vn: "B·ªë t√¥i l√°i xe ch·∫≠m h∆°n m·∫π t√¥i.", p: "T·ª´ g·ªëc: slowly (ch·∫≠m ch·∫°p) - Tr·∫°ng t·ª´ d√†i ƒëu√¥i '-ly'.", r: "C√≥ 'than' -> so s√°nh h∆°n. Tr·∫°ng t·ª´ d√†i th√™m 'more'.", w: "Tr√°nh b·∫´y: Tuy g·ªëc l√† 'slow' th√™m 'er' ƒë∆∞·ª£c, nh∆∞ng ƒë√¢y l√† tr·∫°ng t·ª´ 'slowly' n√™n ph·∫£i d√πng 'more slowly'." },
        { q: "You should write (carefully) _______________ if you want to get a high score.", ans: ["more carefully"], vn: "B·∫°n n√™n vi·∫øt c·∫©n th·∫≠n h∆°n n·∫øu mu·ªën ƒë∆∞·ª£c ƒëi·ªÉm cao.", p: "T·ª´ g·ªëc: carefully (c·∫©n th·∫≠n) - Tr·∫°ng t·ª´ d√†i.", r: "So s√°nh ng·∫ßm (h∆°n b√¨nh th∆∞·ªùng). Tr·∫°ng t·ª´ d√†i th√™m 'more'.", w: "Kh√¥ng d√πng 'most' v√¨ kh√¥ng ph·∫£i m·ª©c nh·∫•t tuy·ªát ƒë·ªëi." },
        { q: "Who lives (far) _______________ from school, you or Lan?", ans: ["farther", "further"], vn: "Ai s·ªëng xa tr∆∞·ªùng h∆°n, b·∫°n hay Lan?", p: "T·ª´ g·ªëc: far (xa) - B·∫•t quy t·∫Øc.", r: "So s√°nh gi·ªØa 2 ng∆∞·ªùi (b·∫°n v√† Lan) -> so s√°nh h∆°n. 'far' bi·∫øn th√†nh 'farther' ho·∫∑c 'further'.", w: "Kh√¥ng d√πng 'farer'." },
        { q: "My team played (badly) _______________ of all the teams in the tournament.", ans: ["the worst"], vn: "ƒê·ªôi t√¥i ch∆°i t·ªá nh·∫•t trong t·∫•t c·∫£ c√°c ƒë·ªôi ·ªü gi·∫£i ƒë·∫•u.", p: "T·ª´ g·ªëc: badly (t·ªá) - B·∫•t quy t·∫Øc.", r: "C√≥ 'of all the teams' -> so s√°nh nh·∫•t. 'badly' bi·∫øn th√†nh 'the worst'.", w: "C·∫•m d√πng 'the badliest' hay 'most badly'." },
        { q: "We arrived at the party (early) _______________ than the other guests.", ans: ["earlier"], vn: "Ch√∫ng t√¥i ƒë·∫øn b·ªØa ti·ªác s·ªõm h∆°n nh·ªØng v·ªã kh√°ch kh√°c.", p: "T·ª´ g·ªëc: early (s·ªõm) - Tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát.", r: "C√≥ 'than' -> so s√°nh h∆°n. 'early' coi nh∆∞ t·ª´ ng·∫Øn, ƒë·ªïi 'y' th√†nh 'i' r·ªìi th√™m 'er'.", w: "Kh√¥ng d√πng 'more early'." },
        { q: "He works (hard) _______________ than anyone else in the company.", ans: ["harder"], vn: "Anh ·∫•y l√†m vi·ªác chƒÉm ch·ªâ h∆°n b·∫•t k·ª≥ ai kh√°c trong c√¥ng ty.", p: "T·ª´ g·ªëc: hard (chƒÉm ch·ªâ) - Tr·∫°ng t·ª´ ng·∫Øn.", r: "C√≥ 'than' -> so s√°nh h∆°n. Th√™m '-er' th√†nh 'harder'.", w: "Tuy·ªát ƒë·ªëi kh√¥ng d√πng 'more hard' hay 'hardly' (hardly nghƒ©a l√† h·∫ßu nh∆∞ kh√¥ng)." }
    ];

    const ex2Container = document.getElementById('ex2-container');
    ex2Data.forEach((item, index) => {
        let qHtml = item.q.replace("_______________", `<input type="text" class="write-input" placeholder="G√µ t·ª´ v√†o ƒë√¢y...">`);
        let html = `
        <div class="question-card text-card">
            <div class="question-text">${index + 11}. ${qHtml}</div>
            <button class="check-btn" onclick="checkTypeIn(this, '${item.ans.join('|')}')">Ki·ªÉm tra ngay!</button>
            <div class="explanation">
                <h4>üí° Gi·∫£i th√≠ch si√™u chi ti·∫øt:</h4>
                <p><strong>1. D·ªãch c√¢u:</strong> ${item.vn}</p>
                <p><strong>2. Ph√¢n t√≠ch t·ª´ g·ªëc:</strong> ${item.p}</p>
                <p><strong>3. T·∫°i sao ƒëi·ªÅn <span class="highlight">"${item.ans[0]}"</span>?</strong> ${item.r}</p>
                <p><strong>4. Ch√∫ √Ω b·∫´y:</strong> ${item.w}</p>
            </div>
        </div>`;
        ex2Container.innerHTML += html;
    });

    /* =========================================
       DATA & RENDER B√ÄI T·∫¨P 3 (REWRITE)
    ========================================= */
    const ex3Data = [
        { q: "Nobody in my class runs faster than Peter.\n‚ûî Peter runs", ans: ["the fastest in my class", "the fastest in my class."], vn: "Kh√¥ng ai trong l·ªõp ch·∫°y nhanh h∆°n Peter -> Peter ch·∫°y nhanh nh·∫•t l·ªõp.", p: "A runs faster than B -> B runs the fastest.", r: "Chuy·ªÉn t·ª´ so s√°nh h∆°n (faster than) mang nghƒ©a ph·ªß ƒë·ªãnh sang so s√°nh nh·∫•t (the fastest).", w: "ƒê·ª´ng qu√™n ch·ªØ 'the' tr∆∞·ªõc so s√°nh nh·∫•t nh√©!" },
        { q: "My sister cooks worse than my mother.\n‚ûî My mother cooks", ans: ["better than my sister", "better than my sister."], vn: "Ch·ªã t√¥i n·∫•u ƒÉn t·ªá h∆°n m·∫π t√¥i -> M·∫π t√¥i n·∫•u ƒÉn ngon h∆°n ch·ªã t√¥i.", p: "A worse than B -> B better than A.", r: "L·∫≠t ng∆∞·ª£c ch·ªß ng·ªØ, t·ª´ tr√°i nghƒ©a c·ªßa 'worse' (t·ªá h∆°n) l√† 'better' (t·ªët h∆°n).", w: "Kh√¥ng d√πng 'more well' hay 'gooder'." },
        { q: "I don't drive as carefully as my father does.\n‚ûî My father drives", ans: ["more carefully than i do", "more carefully than i do.", "more carefully than me", "more carefully than me."], vn: "T√¥i kh√¥ng l√°i xe c·∫©n th·∫≠n b·∫±ng b·ªë t√¥i -> B·ªë t√¥i l√°i xe c·∫©n th·∫≠n h∆°n t√¥i.", p: "A not as + adv + as B -> B + adv(er) + than + A.", r: "Chuy·ªÉn t·ª´ so s√°nh b·∫±ng ph·ªß ƒë·ªãnh sang so s√°nh h∆°n. 'carefully' ƒë·ªïi th√†nh 'more carefully than'.", w: "Nh·ªõ gi·ªØ ƒë√∫ng tr·∫°ng t·ª´, ƒë·ª´ng bi·∫øn th√†nh t√≠nh t·ª´ 'careful'." },
        { q: "No one in the choir sings as beautifully as Sarah.\n‚ûî Sarah sings", ans: ["the most beautifully in the choir", "the most beautifully in the choir.", "the most beautifully"], vn: "Kh√¥ng ai trong d√†n h·ª£p x∆∞·ªõng h√°t hay b·∫±ng Sarah -> Sarah h√°t hay nh·∫•t.", p: "No one + as + adv + as A -> A + the most + adv.", r: "T∆∞∆°ng t·ª± c√¢u 21, chuy·ªÉn th√†nh so s√°nh nh·∫•t c·ªßa tr·∫°ng t·ª´ d√†i: 'the most beautifully'.", w: "Thi·∫øu 'the' ho·∫∑c ƒëu√¥i '-ly' ƒë·ªÅu b·ªã tr·ª´ ƒëi·ªÉm." },
        { q: "Lan gets up earlier than any other member in her family.\n‚ûî Lan gets up", ans: ["the earliest in her family", "the earliest in her family."], vn: "Lan d·∫≠y s·ªõm h∆°n b·∫•t k·ª≥ th√†nh vi√™n n√†o kh√°c -> Lan d·∫≠y s·ªõm nh·∫•t nh√†.", p: "A + adv(er) + than any other -> A + the + adv(est).", r: "C·∫•u tr√∫c n√†y t∆∞∆°ng ƒë∆∞∆°ng so s√°nh nh·∫•t. 'earlier' ƒë·ªïi th√†nh 'the earliest'.", w: "B·ªè c·ª•m 'any other member' ƒëi nh√©, thay b·∫±ng c·ª•m ch·ªâ ph·∫°m vi 'in her family'." }
    ];

    const ex3Container = document.getElementById('ex3-container');
    ex3Data.forEach((item, index) => {
        let parts = item.q.split('‚ûî');
        let html = `
        <div class="question-card text-card">
            <div class="question-text">${index + 21}. ${parts[0]}</div>
            <div class="input-group" style="align-items:stretch;">
                <div style="font-size:1.2rem; font-weight:bold; color:var(--primary-mint); display:flex; align-items:center;">‚ûî ${parts[1]}</div>
                <input type="text" class="write-input" placeholder="G√µ ti·∫øp ph·∫ßn c√≤n l·∫°i...">
            </div>
            <button class="check-btn" style="margin-top:15px;" onclick="checkTypeIn(this, '${item.ans.join('|')}')">Ki·ªÉm tra ngay!</button>
            <div class="explanation">
                <h4>üí° Gi·∫£i th√≠ch si√™u chi ti·∫øt:</h4>
                <p><strong>1. D·ªãch c√¢u:</strong> ${item.vn}</p>
                <p><strong>2. Ph√¢n t√≠ch:</strong> ${item.p}</p>
                <p><strong>3. T·∫°i sao vi·∫øt nh∆∞ v·∫≠y?</strong> <span class="highlight">${item.r}</span></p>
                <p><strong>4. Ch√∫ √Ω b·∫´y:</strong> ${item.w}</p>
            </div>
        </div>`;
        ex3Container.innerHTML += html;
    });

    /* =========================================
       DATA & RENDER B√ÄI T·∫¨P 4 (FIND & FIX)
    ========================================= */
    const ex4Data = [
        { q: "He worked more hard than the others to win the prize.", err: "more hard", fix: "harder", vn: "Anh ·∫•y ƒë√£ l√†m vi·ªác chƒÉm ch·ªâ h∆°n nh·ªØng ng∆∞·ªùi kh√°c ƒë·ªÉ gi√†nh gi·∫£i.", p: "T·ª´ 'hard' (chƒÉm ch·ªâ) l√† tr·∫°ng t·ª´ ng·∫Øn (1 √¢m ti·∫øt).", r: "Tr·∫°ng t·ª´ ng·∫Øn ph·∫£i th√™m '-er' th√†nh 'harder'.", w: "Kh√¥ng d√πng 'more' ƒëi k√®m v·ªõi tr·∫°ng t·ª´ ng·∫Øn." },
        { q: "She speaks English the most well in our club.", err: "the most well", fix: "the best", vn: "C√¥ ·∫•y n√≥i ti·∫øng Anh gi·ªèi nh·∫•t c√¢u l·∫°c b·ªô ch√∫ng t√¥i.", p: "T·ª´ 'well' l√† tr·∫°ng t·ª´ b·∫•t quy t·∫Øc.", r: "So s√°nh nh·∫•t c·ªßa 'well' b·∫Øt bu·ªôc ph·∫£i ƒë·ªïi th√†nh 'the best'.", w: "Kh√¥ng c√≥ c·ª•m t·ª´ 'the most well' trong ti·∫øng Anh." },
        { q: "My friend did the test more carefully I did.", err: "carefully i", fix: "carefully than i", ansErr: "carefully", ansFix: "carefully than", altErr:"more carefully", altFix:"more carefully than", vn: "B·∫°n t√¥i l√†m b√†i ki·ªÉm tra c·∫©n th·∫≠n h∆°n t√¥i.", p: "C√¢u n√†y c√≥ c·ª•m so s√°nh h∆°n 'more carefully'.", r: "Thi·∫øu t·ª´ kh√≥a n·ªëi c·ª±c k·ª≥ quan tr·ªçng l√† 'than' (h∆°n). S·ª≠a th√†nh: more carefully than I did.", w: "Thi·∫øu 'than' l√† l·ªói kinh ƒëi·ªÉn khi·∫øn c√¢u b·ªã g√£y ƒë√¥i." },
        { q: "I go to school more early than my best friend.", err: "more early", fix: "earlier", vn: "T√¥i ƒëi h·ªçc s·ªõm h∆°n b·∫°n th√¢n c·ªßa m√¨nh.", p: "T·ª´ 'early' k·∫øt th√∫c b·∫±ng 'y'.", r: "ƒê∆∞·ª£c coi l√† t·ª´ ng·∫Øn, ph·∫£i ƒë·ªïi 'y' th√†nh 'i' v√† th√™m '-er' th√†nh 'earlier'.", w: "Tuy·ªát ƒë·ªëi kh√¥ng d√πng 'more early'." },
        { q: "This is the farer I have ever run.", err: "farer", fix: "farthest", altFix:"furthest", vn: "ƒê√¢y l√† kho·∫£ng c√°ch xa nh·∫•t t√¥i t·ª´ng ch·∫°y.", p: "C·∫•u tr√∫c 'the + adv' l√† so s√°nh nh·∫•t. T·ª´ 'far' l√† t·ª´ b·∫•t quy t·∫Øc.", r: "ƒê·ªïi th√†nh 'the farthest' ho·∫∑c 'the furthest'.", w: "T·ª´ 'farer' t·ª± ch·∫ø ra l√† sai ho√†n to√†n nh√©!" }
    ];

    const ex4Container = document.getElementById('ex4-container');
    ex4Data.forEach((item, index) => {
        let html = `
        <div class="question-card double-input-card">
            <div class="question-text">${index + 26}. ${item.q}</div>
            <div class="input-group">
                <input type="text" class="write-input err-in" placeholder="L·ªói sai l√† t·ª´ g√¨?">
                <input type="text" class="write-input fix-in" placeholder="S·ª≠a th√†nh g√¨?">
                <button class="check-btn" onclick="checkEx4(this, '${item.err}|${item.altErr || ''}', '${item.fix}|${item.altFix || ''}|${item.ansFix || ''}')">Ki·ªÉm tra</button>
            </div>
            <div class="explanation">
                <h4>üí° Gi·∫£i th√≠ch si√™u chi ti·∫øt:</h4>
                <p><strong>1. D·ªãch c√¢u:</strong> ${item.vn}</p>
                <p><strong>2. L·ªói sai ·ªü ƒë√¢u?</strong> L·ªói sai n·∫±m ·ªü <span class="highlight">"${item.err.split('|')[0]}"</span>.</p>
                <p><strong>3. C√°ch s·ª≠a ƒë√∫ng:</strong> ${item.p} <span class="highlight">${item.r}</span></p>
                <p><strong>4. Nh·ªõ nh√©:</strong> ${item.w}</p>
            </div>
        </div>`;
        ex4Container.innerHTML += html;
    });

    /* --- CHECKING LOGIC FOR TEXT INPUTS --- */
    window.checkTypeIn = function(btn, validAnswersStr) {
        const card = btn.closest('.text-card');
        const input = card.querySelector('.write-input');
        const exp = card.querySelector('.explanation');
        const validAnswers = validAnswersStr.split('|');

        if(!input.value.trim()) return;

        btn.style.display = 'none'; input.disabled = true;
        const userVal = cleanStr(input.value);
        let isCorrect = validAnswers.some(ans => cleanStr(ans) === userVal);

        if(isCorrect) {
            input.classList.add('correct'); playDing(); fireConfetti(); score++;
        } else {
            input.classList.add('wrong'); card.classList.add('shake'); playBuzz();
            input.value = `Sai! S·ª≠a l·∫°i: ${validAnswers[0]}`;
        }
        exp.style.display = 'block';
    };

    window.checkEx4 = function(btn, validErrStr, validFixStr) {
        const card = btn.closest('.double-input-card');
        const inErr = card.querySelector('.err-in');
        const inFix = card.querySelector('.fix-in');
        const exp = card.querySelector('.explanation');
        
        if(!inErr.value.trim() || !inFix.value.trim()) return;

        btn.style.display = 'none'; inErr.disabled = true; inFix.disabled = true;

        const uErr = cleanStr(inErr.value);
        const uFix = cleanStr(inFix.value);
        
        const validErrs = validErrStr.split('|').filter(x=>x);
        const validFixs = validFixStr.split('|').filter(x=>x);

        // Ch√¢m ch∆∞·ªõc ch·∫•m ƒë√∫ng n·∫øu g√µ ch·ª©a t·ª´ kh√≥a c·ªët l√µi
        let errMatch = validErrs.some(e => uErr.includes(cleanStr(e)) || cleanStr(e).includes(uErr));
        let fixMatch = validFixs.some(f => uFix.includes(cleanStr(f)) || cleanStr(f).includes(uFix));

        if(errMatch && fixMatch) {
            inErr.classList.add('correct'); inFix.classList.add('correct');
            playDing(); fireConfetti(); score++;
        } else {
            inErr.classList.add('wrong'); inFix.classList.add('wrong');
            card.classList.add('shake'); playBuzz();
            inErr.value = "L·ªói: " + validErrs[0];
            inFix.value = "S·ª≠a: " + validFixs[0];
        }
        exp.style.display = 'block';
    };

    /* --- SUBMIT MODAL --- */
    document.getElementById('submitBtn').addEventListener('click', () => {
        const modal = document.getElementById('scoreModal');
        const scoreText = document.getElementById('scoreText');
        const compText = document.getElementById('complimentText');
        
        scoreText.innerText = `ƒê·∫°t: ${score} / ${TOTAL_QUESTIONS} ƒêi·ªÉm`;
        
        let msg = "";
        if(score === TOTAL_QUESTIONS) msg = "ƒê·ªânh c·ªßa ch√≥p! Con ch√≠nh l√† b·∫≠c th·∫ßy So s√°nh Tr·∫°ng t·ª´! üåüüåüüåü";
        else if(score >= 25) msg = "Xu·∫•t s·∫Øc! Con n·∫Øm v·ªØng quy t·∫Øc 'more/er' v√† t·ª´ b·∫•t quy t·∫Øc r·ªìi! üî•";
        else if(score >= 15) msg = "Kh√° l·∫Øm, ƒë·ªçc k·ªπ l·∫°i b·∫£ng t·ª´ b·∫•t quy t·∫Øc ·ªü ph·∫ßn L√Ω thuy·∫øt l√† 10 ƒëi·ªÉm ngay! üí™";
        else msg = "ƒê·ª´ng n·∫£n nh√©, xem k·ªπ ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt c·ªßa c√¥ Mai An l√† con s·∫Ω l√†m ƒë∆∞·ª£c th√¥i! ‚ù§Ô∏è";
        
        compText.innerText = msg;
        modal.style.display = 'flex';
        if(score >= 15) fireConfetti();
    });
</script>

</body>
</html>