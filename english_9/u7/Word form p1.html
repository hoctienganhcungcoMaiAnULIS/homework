<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Form Challenge - Ms Mai An ULIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0fdf4;
            background-image: radial-gradient(#00C9A7 1.5px, transparent 1.5px), radial-gradient(#8854C0 1.5px, #f0fdf4 1.5px);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: #333;
            overflow-x: hidden;
        }

        .card-shadow {
            box-shadow: 0 10px 0 #e2e8f0;
            transition: all 0.2s;
        }

        .btn-option {
            background-color: white;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 0 #cbd5e1;
            transition: all 0.1s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .btn-option:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #cbd5e1;
            border-color: #8854C0;
        }

        .btn-option:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 0 0 #cbd5e1;
        }

        .btn-correct {
            background-color: #d1fae5 !important;
            border-color: #00D26A !important;
            color: #065f46 !important;
            box-shadow: 0 4px 0 #059669 !important;
        }

        .btn-wrong {
            background-color: #ffe4e6 !important;
            border-color: #FF4757 !important;
            color: #881337 !important;
            box-shadow: 0 4px 0 #be123c !important;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .explanation-box {
            animation: slideIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }

        /* Custom Scrollbar for explanation */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #c084fc; 
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #8854C0; 
        }

        .highlight-text {
            background-color: #fef08a;
            padding: 0 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .title-gradient {
            background: linear-gradient(to right, #8854C0, #00C9A7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Header -->
    <header class="w-full max-w-3xl mb-4 flex justify-between items-center bg-white p-4 rounded-2xl shadow-lg border-b-4 border-purple-200">
        <div>
            <h1 class="text-2xl font-bold title-gradient">Word Form Practice</h1>
            <p class="text-sm text-gray-500 font-semibold">Teacher: Ms Mai An (ULIS)</p>
        </div>
        <div class="text-right">
            <div class="text-sm font-bold text-gray-400">SCORE</div>
            <div class="text-3xl font-bold text-purple-600" id="score-display">0</div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="w-full max-w-3xl bg-gray-200 rounded-full h-4 mb-6 border-2 border-white shadow-sm overflow-hidden">
        <div id="progress-bar" class="progress-bar-fill bg-[#00C9A7] h-full rounded-full" style="width: 0%"></div>
    </div>

    <!-- Quiz Container -->
    <main id="quiz-container" class="w-full max-w-3xl bg-white rounded-3xl p-6 md:p-8 card-shadow border-2 border-gray-100 relative min-h-[500px]">
        <!-- Question Area -->
        <div id="question-area">
            <div class="flex justify-between items-center mb-4">
                <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-bold">Question <span id="current-q-num">1</span>/<span id="total-q-num">16</span></span>
                <span id="streak-counter" class="hidden text-orange-500 font-bold"><i class="fas fa-fire"></i> Streak x2</span>
            </div>

            <h2 id="question-text" class="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed">
                Loading question...
            </h2>

            <!-- Options Grid -->
            <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Buttons will be injected here -->
            </div>

            <!-- Explanation Area (Initially Hidden) -->
            <div id="explanation-area" class="hidden mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg explanation-box">
                <h3 class="font-bold text-blue-600 mb-2 flex items-center">
                    <i class="fas fa-glasses mr-2"></i> Ms Mai An gi·∫£i th√≠ch chi ti·∫øt:
                </h3>
                <div id="explanation-content" class="text-gray-700 text-sm md:text-base leading-relaxed whitespace-pre-line custom-scroll max-h-[300px] overflow-y-auto pr-2">
                    <!-- Explanation content goes here -->
                </div>
                <div class="mt-4 text-right">
                    <button id="next-btn" class="bg-[#00C9A7] hover:bg-[#00a085] text-white font-bold py-2 px-6 rounded-xl shadow-[0_4px_0_#008f72] active:shadow-none active:translate-y-1 transition-all">
                        C√¢u ti·∫øp theo <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Result Area (Initially Hidden) -->
        <div id="result-area" class="hidden text-center py-10">
            <div class="text-6xl mb-4">üèÜ</div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Ho√†n th√†nh b√†i thi!</h2>
            <p id="final-message" class="text-gray-500 mb-8">B·∫°n l√†m r·∫•t t·ªët!</p>
            
            <div class="flex justify-center items-center gap-8 mb-8">
                <div class="text-center">
                    <p class="text-gray-400 text-sm font-bold uppercase">ƒêi·ªÉm s·ªë</p>
                    <p id="final-score" class="text-4xl font-bold text-purple-600">0</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm font-bold uppercase">Ch√≠nh x√°c</p>
                    <p id="final-percent" class="text-4xl font-bold text-[#00C9A7]">0%</p>
                </div>
            </div>

            <button onclick="location.reload()" class="bg-[#8854C0] hover:bg-[#7044a0] text-white font-bold py-3 px-8 rounded-2xl shadow-[0_6px_0_#5b3684] active:shadow-none active:translate-y-1 transition-all text-lg">
                <i class="fas fa-redo mr-2"></i> L√†m l·∫°i b√†i
            </button>
        </div>
    </main>

    <!-- Audio Elements (Generated via JS to ensure single file integrity, but using placeholder logic for prompt) -->
    
    <script>
        // --- DATA SOURCE ---
        const rawData = {
          "questions": [
            {
              "questionNumber": 15,
              "question": "The package tour is good for people who are not ___________ about using apps. (CONFIDENCE)",
              "answerOptions": [
                { "text": "confident", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. confident (adj): t·ª± tin\n- B. confidence (n): s·ª± t·ª± tin\n- C. confidential (adj): b·∫£o m·∫≠t/tuy·ªát m·∫≠t\n- D. confide (v): t√¢m s·ª±/chia s·∫ª b√≠ m·∫≠t\n\n**D·ªãch c√¢u:** Tour tr·ªçn g√≥i r·∫•t t·ªët cho nh·ªØng ng∆∞·ªùi kh√¥ng t·ª± tin v·ªÅ vi·ªác s·ª≠ d·ª•ng c√°c ·ª©ng d·ª•ng.\n\n**Gi·∫£i th√≠ch:** Ch·ªó tr·ªëng ƒë·ª©ng sau ƒë·ªông t·ª´ tobe 'are' v√† tr∆∞·ªõc gi·ªõi t·ª´ 'about'. C·∫•u tr√∫c: *be confident about doing sth* (t·ª± tin v·ªÅ vi·ªác l√†m g√¨).", "isCorrect": true },
                { "text": "confidence", "isCorrect": false },
                { "text": "confidential", "isCorrect": false },
                { "text": "confide", "isCorrect": false }
              ],
              "hint": "Adjective describing a feeling of being sure."
            },
            {
              "questionNumber": 16,
              "question": "One disadvantage of this tour is you have to follow a __________ itinerary. (FIX)",
              "answerOptions": [
                { "text": "fixed", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. fix (v): s·ª≠a ch·ªØa\n- B. fixed (adj/V3): c·ªë ƒë·ªãnh, ƒë√£ ƒë∆∞·ª£c s·∫Øp ƒë·∫∑t\n- C. fixation (n): s·ª± c·ªë ƒë·ªãnh/√°m ·∫£nh\n- D. fixture (n): ƒë·ªì ƒë·∫°c c·ªë ƒë·ªãnh\n\n**D·ªãch c√¢u:** M·ªôt nh∆∞·ª£c ƒëi·ªÉm c·ªßa tour n√†y l√† b·∫°n ph·∫£i tu√¢n theo m·ªôt l·ªãch tr√¨nh c·ªë ƒë·ªãnh.\n\n**Gi·∫£i th√≠ch:** Tr∆∞·ªõc danh t·ª´ 'itinerary' (l·ªãch tr√¨nh) c·∫ßn m·ªôt t√≠nh t·ª´. 'Fixed' mang nghƒ©a l√† ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh s·∫µn, kh√¥ng thay ƒë·ªïi.", "isCorrect": true },
                { "text": "fix", "isCorrect": false },
                { "text": "fixture", "isCorrect": false },
                { "text": "fixation", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 17,
              "question": "For self-guided tours, tourists can travel more ____________ than other tours. (FLEXIBILITY)",
              "answerOptions": [
                { "text": "flexibly", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. flexible (adj): linh ho·∫°t\n- B. flexibly (adv): m·ªôt c√°ch linh ho·∫°t\n- C. flexibility (n): s·ª± linh ho·∫°t\n- D. flex (v): u·ªën cong\n\n**D·ªãch c√¢u:** ƒê·ªëi v·ªõi c√°c tour t·ª± h∆∞·ªõng d·∫´n, du kh√°ch c√≥ th·ªÉ ƒëi du l·ªãch m·ªôt c√°ch linh ho·∫°t h∆°n so v·ªõi c√°c tour kh√°c.\n\n**Gi·∫£i th√≠ch:** Ch·ªó tr·ªëng b·ªï nghƒ©a cho ƒë·ªông t·ª´ 'travel'. ƒê·ªÉ b·ªï nghƒ©a cho ƒë·ªông t·ª´ th∆∞·ªùng, ta c·∫ßn m·ªôt tr·∫°ng t·ª´ (Adverb).", "isCorrect": true },
                { "text": "flexible", "isCorrect": false },
                { "text": "flexibility", "isCorrect": false },
                { "text": "flex", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 18,
              "question": "Many ___________ buildings have become UNESCO World Heritage Sites. (RUIN)",
              "answerOptions": [
                { "text": "ruined", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. ruin (v/n): ph√° h·ªßy/t√†n t√≠ch\n- B. ruined (adj/V3): b·ªã t√†n ph√°/ƒë·ªï n√°t\n- C. ruining (V-ing): ƒëang ph√° h·ªßy\n- D. ruins (n): c√°c t√†n t√≠ch\n\n**D·ªãch c√¢u:** Nhi·ªÅu t√≤a nh√† ƒë·ªï n√°t ƒë√£ tr·ªü th√†nh Di s·∫£n Th·∫ø gi·ªõi UNESCO.\n\n**Gi·∫£i th√≠ch:** Tr∆∞·ªõc danh t·ª´ 'buildings' c·∫ßn m·ªôt t√≠nh t·ª´ mi√™u t·∫£ tr·∫°ng th√°i. 'Ruined' (b·ªã h∆∞ h·∫°i, ƒë·ªï n√°t) l√† ƒë√°p √°n ph√π h·ª£p.", "isCorrect": true },
                { "text": "ruin", "isCorrect": false },
                { "text": "ruins", "isCorrect": false },
                { "text": "ruining", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 19,
              "question": "There are many ______________ rivers in this area. (CHARM)",
              "answerOptions": [
                { "text": "charming", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. charm (n/v): s·ª± quy·∫øn r≈©\n- B. charming (adj): quy·∫øn r≈©, ƒë·∫πp m√™ h·ªìn\n- C. charmed (adj): b·ªã m√™ ho·∫∑c\n- D. charmless (adj): kh√¥ng quy·∫øn r≈©\n\n**D·ªãch c√¢u:** C√≥ r·∫•t nhi·ªÅu d√≤ng s√¥ng th∆° m·ªông/quy·∫øn r≈© ·ªü khu v·ª±c n√†y.\n\n**Gi·∫£i th√≠ch:** C·∫ßn t√≠nh t·ª´ b·ªï nghƒ©a cho 'rivers'. D√πng V-ing (charming) ƒë·ªÉ ch·ªâ t√≠nh ch·∫•t c·ªßa s·ª± v·∫≠t (d√≤ng s√¥ng mang l·∫°i v·∫ª ƒë·∫πp).", "isCorrect": true },
                { "text": "charm", "isCorrect": false },
                { "text": "charmed", "isCorrect": false },
                { "text": "charmless", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 20,
              "question": "We should protect the environment for a _______________ development. (SUSTAINABILITY)",
              "answerOptions": [
                { "text": "sustainable", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. sustain (v): duy tr√¨\n- B. sustainable (adj): b·ªÅn v·ªØng\n- C. sustainably (adv): m·ªôt c√°ch b·ªÅn v·ªØng\n- D. sustainability (n): s·ª± b·ªÅn v·ªØng\n\n**D·ªãch c√¢u:** Ch√∫ng ta n√™n b·∫£o v·ªá m√¥i tr∆∞·ªùng v√¨ m·ªôt s·ª± ph√°t tri·ªÉn b·ªÅn v·ªØng.\n\n**Gi·∫£i th√≠ch:** Tr∆∞·ªõc danh t·ª´ 'development' c·∫ßn m·ªôt t√≠nh t·ª´. 'Sustainable development' l√† c·ª•m t·ª´ c·ªë ƒë·ªãnh (ph√°t tri·ªÉn b·ªÅn v·ªØng).", "isCorrect": true },
                { "text": "sustain", "isCorrect": false },
                { "text": "sustainably", "isCorrect": false },
                { "text": "sustainability", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 21,
              "question": "It was __________ for him to climb the peak. (RISK)",
              "answerOptions": [
                { "text": "risky", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. risk (n/v): r·ªßi ro\n- B. risky (adj): ƒë·∫ßy r·ªßi ro, nguy hi·ªÉm\n- C. riskily (adv): m·ªôt c√°ch li·ªÅu lƒ©nh\n- D. risked (v-ed): ƒë√£ li·ªÅu\n\n**D·ªãch c√¢u:** Vi·ªác anh ·∫•y leo l√™n ƒë·ªânh n√∫i th·∫≠t l√† m·∫°o hi·ªÉm.\n\n**Gi·∫£i th√≠ch:** C·∫•u tr√∫c *It was + Adj + for sb to do sth*. C·∫ßn t√≠nh t·ª´ 'risky'.", "isCorrect": true },
                { "text": "risk", "isCorrect": false },
                { "text": "riskily", "isCorrect": false },
                { "text": "risked", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 22,
              "question": "The best way to _________________ the Trang An is by boat. (EXPLORER)",
              "answerOptions": [
                { "text": "explore", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. explore (v): kh√°m ph√°\n- B. explorer (n): nh√† th√°m hi·ªÉm\n- C. exploration (n): s·ª± th√°m hi·ªÉm\n- D. exploratory (adj): c√≥ t√≠nh th√°m hi·ªÉm\n\n**D·ªãch c√¢u:** C√°ch t·ªët nh·∫•t ƒë·ªÉ kh√°m ph√° Tr√†ng An l√† ƒëi b·∫±ng thuy·ªÅn.\n\n**Gi·∫£i th√≠ch:** Sau 'The best way to...' c·∫ßn m·ªôt ƒë·ªông t·ª´ nguy√™n th·ªÉ (infinitive).", "isCorrect": true },
                { "text": "explorer", "isCorrect": false },
                { "text": "exploration", "isCorrect": false },
                { "text": "exploratory", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 23,
              "question": "Environmentalists ______________ support measures to save these heritage trees. (STRONG)",
              "answerOptions": [
                { "text": "strongly", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. strength (n): s·ª©c m·∫°nh\n- B. strong (adj): m·∫°nh m·∫Ω\n- C. strongly (adv): m·ªôt c√°ch m·∫°nh m·∫Ω\n- D. strengthen (v): c·ªßng c·ªë\n\n**D·ªãch c√¢u:** C√°c nh√† m√¥i tr∆∞·ªùng ·ªßng h·ªô m·∫°nh m·∫Ω c√°c bi·ªán ph√°p c·ª©u nh·ªØng c√¢y di s·∫£n n√†y.\n\n**Gi·∫£i th√≠ch:** Ch·ªó tr·ªëng ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´ 'support' ƒë·ªÉ b·ªï sung m·ª©c ƒë·ªô cho h√†nh ƒë·ªông n√†y -> C·∫ßn tr·∫°ng t·ª´ (Adverb).", "isCorrect": true },
                { "text": "strong", "isCorrect": false },
                { "text": "strength", "isCorrect": false },
                { "text": "strengthen", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 24,
              "question": "The government encourages people to protect the ____________ of their communities. (DIVERSE)",
              "answerOptions": [
                { "text": "diversity", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. diverse (adj): ƒëa d·∫°ng\n- B. diversity (n): s·ª± ƒëa d·∫°ng\n- C. diversify (v): ƒëa d·∫°ng h√≥a\n- D. diversification (n): s·ª± ƒëa d·∫°ng h√≥a (th∆∞·ªùng d√πng trong kinh doanh)\n\n**D·ªãch c√¢u:** Ch√≠nh ph·ªß khuy·∫øn kh√≠ch ng∆∞·ªùi d√¢n b·∫£o v·ªá s·ª± ƒëa d·∫°ng c·ªßa c·ªông ƒë·ªìng h·ªç.\n\n**Gi·∫£i th√≠ch:** Sau m·∫°o t·ª´ 'the' c·∫ßn m·ªôt danh t·ª´. 'Diversity' (s·ª± ƒëa d·∫°ng vƒÉn h√≥a/sinh h·ªçc) l√† t·ª´ ph√π h·ª£p nh·∫•t.", "isCorrect": true },
                { "text": "diverse", "isCorrect": false },
                { "text": "diversify", "isCorrect": false },
                { "text": "diversification", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 25,
              "question": "___________ between Israel and Jordan, the Dead Sea is the lowest place on Earth. (LOCATION)",
              "answerOptions": [
                { "text": "Located", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. Locate (v): ƒë·ªãnh v·ªã\n- B. Locating (V-ing): ƒëang ƒë·ªãnh v·ªã\n- C. Located (V3/adj): n·∫±m ·ªü/t·ªça l·∫°c t·∫°i\n- D. Location (n): v·ªã tr√≠\n\n**D·ªãch c√¢u:** N·∫±m gi·ªØa Israel v√† Jordan, Bi·ªÉn Ch·∫øt l√† n∆°i th·∫•p nh·∫•t tr√™n Tr√°i ƒê·∫•t.\n\n**Gi·∫£i th√≠ch:** ƒê√¢y l√† m·ªánh ƒë·ªÅ quan h·ªá r√∫t g·ªçn d·∫°ng b·ªã ƒë·ªông (Bi·ªÉn Ch·∫øt *ƒë∆∞·ª£c* ƒë·∫∑t t·∫°i...). D·∫°ng ƒë·∫ßy ƒë·ªß: 'Because it is located...'. R√∫t g·ªçn c√≤n 'Located...'.", "isCorrect": true },
                { "text": "Locating", "isCorrect": false },
                { "text": "Location", "isCorrect": false },
                { "text": "Locate", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 26,
              "question": "We need their ___________ to enter the cave. (PERMIT)",
              "answerOptions": [
                { "text": "permission", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. permit (v/n): cho ph√©p/gi·∫•y ph√©p\n- B. permission (n): s·ª± cho ph√©p\n- C. permissive (adj): d·ªÖ d√£i\n- D. permissibly (adv): ch·∫•p nh·∫≠n ƒë∆∞·ª£c\n\n**D·ªãch c√¢u:** Ch√∫ng t√¥i c·∫ßn s·ª± cho ph√©p c·ªßa h·ªç ƒë·ªÉ v√†o hang.\n\n**Gi·∫£i th√≠ch:** 'Permit' (danh t·ª´) l√† t·ªù gi·∫•y ph√©p (v·∫≠t l√Ω), 'Permission' (danh t·ª´) l√† s·ª± cho ph√©p (tr·ª´u t∆∞·ª£ng). Trong ng·ªØ c·∫£nh 'need their...' th∆∞·ªùng n√≥i v·ªÅ quy·ªÅn/s·ª± cho ph√©p.", "isCorrect": true },
                { "text": "permit", "isCorrect": false },
                { "text": "permissive", "isCorrect": false },
                { "text": "permissibly", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 27,
              "question": "This place is an ideal destination for ____________. (ADVENTURE)",
              "answerOptions": [
                { "text": "adventure", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. adventure (n): cu·ªôc phi√™u l∆∞u (ho·∫∑c s·ª± phi√™u l∆∞u)\n- B. adventurous (adj): th√≠ch phi√™u l∆∞u\n- C. adventurer (n): nh√† th√°m hi·ªÉm\n- D. adventurously (adv): m·ªôt c√°ch m·∫°o hi·ªÉm\n\n**D·ªãch c√¢u:** N∆°i n√†y l√† ƒëi·ªÉm ƒë·∫øn l√Ω t∆∞·ªüng cho du l·ªãch m·∫°o hi·ªÉm (s·ª± phi√™u l∆∞u).\n\n**Gi·∫£i th√≠ch:** 'Destination for adventure' l√† c·ª•m t·ª´ ph·ªï bi·∫øn. N·∫øu d√πng ch·ªâ ng∆∞·ªùi ph·∫£i l√† 'adventurers' (s·ªë nhi·ªÅu), nh∆∞ng 'adventure' (danh t·ª´ kh√¥ng ƒë·∫øm ƒë∆∞·ª£c ch·ªâ ho·∫°t ƒë·ªông) c≈©ng r·∫•t ph√π h·ª£p.", "isCorrect": true },
                { "text": "adventurous", "isCorrect": false },
                { "text": "adventurer", "isCorrect": false },
                { "text": "adventurously", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 28,
              "question": "It is one of the greatest tourist ___________ in the world. (ATTRACT)",
              "answerOptions": [
                { "text": "attractions", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. attract (v): thu h√∫t\n- B. attraction (n): s·ª± thu h√∫t (s·ªë √≠t)\n- C. attractions (n): c√°c ƒëi·ªÉm thu h√∫t (s·ªë nhi·ªÅu)\n- D. attractive (adj): h·∫•p d·∫´n\n\n**D·ªãch c√¢u:** ƒê√≥ l√† m·ªôt trong nh·ªØng ƒëi·ªÉm thu h√∫t kh√°ch du l·ªãch l·ªõn nh·∫•t th·∫ø gi·ªõi.\n\n**Gi·∫£i th√≠ch:** C·∫•u tr√∫c *one of the... + Noun (plural)* (m·ªôt trong nh·ªØng...). Do ƒë√≥ danh t·ª´ ph·∫£i ·ªü d·∫°ng s·ªë nhi·ªÅu -> 'attractions'.", "isCorrect": true },
                { "text": "attraction", "isCorrect": false },
                { "text": "attractive", "isCorrect": false },
                { "text": "attract", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 29,
              "question": "The mountain is so ____________. It is the most attractive mountain in the world. (MAJESTY)",
              "answerOptions": [
                { "text": "majestic", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. majesty (n): v·∫ª uy nghi/b·ªá h·∫°\n- B. majestic (adj): h√πng vƒ©, tr√°ng l·ªá\n- C. majestically (adv): m·ªôt c√°ch h√πng vƒ©\n- D. major (adj): ch√≠nh/l·ªõn\n\n**D·ªãch c√¢u:** Ng·ªçn n√∫i th·∫≠t h√πng vƒ©. N√≥ l√† ng·ªçn n√∫i h·∫•p d·∫´n nh·∫•t th·∫ø gi·ªõi.\n\n**Gi·∫£i th√≠ch:** Sau ƒë·ªông t·ª´ tobe 'is' v√† tr·∫°ng t·ª´ 'so' c·∫ßn m·ªôt t√≠nh t·ª´ ch·ªâ ƒë·∫∑c ƒëi·ªÉm.", "isCorrect": true },
                { "text": "majesty", "isCorrect": false },
                { "text": "majestically", "isCorrect": false },
                { "text": "major", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 30,
              "question": "When he reached the mountain peak, he found it covered with ___________ flags. (COUNT)",
              "answerOptions": [
                { "text": "countless", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. count (v): ƒë·∫øm\n- B. countable (adj): c√≥ th·ªÉ ƒë·∫øm ƒë∆∞·ª£c\n- C. countless (adj): v√¥ s·ªë/kh√¥ng ƒë·∫øm xu·ªÉ\n- D. counter (n): qu·∫ßy h√†ng\n\n**D·ªãch c√¢u:** Khi anh ·∫•y l√™n ƒë·∫øn ƒë·ªânh n√∫i, anh th·∫•y n√≥ ƒë∆∞·ª£c bao ph·ªß b·ªüi v√¥ s·ªë l√° c·ªù.\n\n**Gi·∫£i th√≠ch:** D·ª±a v√†o ng·ªØ c·∫£nh 'bao ph·ªß', ta hi·ªÉu l√† r·∫•t nhi·ªÅu c·ªù. 'Countless' (v√¥ s·ªë) l√† t√≠nh t·ª´ ph√π h·ª£p nh·∫•t.", "isCorrect": true },
                { "text": "countable", "isCorrect": false },
                { "text": "count", "isCorrect": false },
                { "text": "counter", "isCorrect": false }
              ]
            },
            {
              "questionNumber": 31,
              "question": "Natural wonders are our country‚Äôs valuable ____________. (POSSESS)",
              "answerOptions": [
                { "text": "possessions", "rationale": "**Ph√¢n t√≠ch ƒë√°p √°n:**\n- A. possess (v): s·ªü h·ªØu\n- B. possession (n): s·ª± s·ªü h·ªØu/v·∫≠t s·ªü h·ªØu (s·ªë √≠t)\n- C. possessions (n): t√†i s·∫£n/v·∫≠t s·ªü h·ªØu (s·ªë nhi·ªÅu)\n- D. possessive (adj): chi·∫øm h·ªØu\n\n**D·ªãch c√¢u:** C√°c k·ª≥ quan thi√™n nhi√™n l√† nh·ªØng t√†i s·∫£n qu√Ω gi√° c·ªßa ƒë·∫•t n∆∞·ªõc ch√∫ng ta.\n\n**Gi·∫£i th√≠ch:** 'Natural wonders' l√† s·ªë nhi·ªÅu, n√™n danh t·ª´ ph√≠a sau c≈©ng n√™n ·ªü d·∫°ng s·ªë nhi·ªÅu ƒë·ªÉ t∆∞∆°ng x·ª©ng -> 'possessions' (t√†i s·∫£n).", "isCorrect": true },
                { "text": "possess", "isCorrect": false },
                { "text": "possession", "isCorrect": false },
                { "text": "possessive", "isCorrect": false }
              ]
            }
          ]
        };

        // --- GAME LOGIC ---

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let hasAnswered = false;

        // Audio Context for Generating Sounds (No external files needed)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // High pitch Ding
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(1046.5, audioCtx.currentTime + 0.1); // C6
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else {
                // Low pitch Buzz
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize Game
        function initGame() {
            // Deep copy rawData to avoid mutating the original data structure
            questions = JSON.parse(JSON.stringify(rawData.questions));
            
            // Shuffle questions order
            questions = shuffleArray(questions);
            
            // Normalize data: Find rationale and SHUFFLE OPTIONS
            questions.forEach(q => {
                const correctOption = q.answerOptions.find(opt => opt.isCorrect);
                q.rationale = correctOption ? correctOption.rationale : "No explanation available.";
                
                // FIX: Shuffle the answer options so correct answer is random (not always A)
                q.answerOptions = shuffleArray(q.answerOptions);
            });

            currentQuestionIndex = 0;
            score = 0;
            updateUI();
            renderQuestion();
        }

        function updateUI() {
            document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
            document.getElementById('total-q-num').innerText = questions.length;
            document.getElementById('score-display').innerText = score;
            
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function renderQuestion() {
            hasAnswered = false;
            const q = questions[currentQuestionIndex];
            
            // Reset UI
            document.getElementById('question-area').classList.remove('hidden');
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('explanation-area').classList.add('hidden');
            document.getElementById('next-btn').parentElement.classList.add('hidden'); // Hide Next button initially
            
            // Format Question Text: Bold the word in parentheses
            let qText = q.question.replace(/\(([^)]+)\)/, '<span class="text-purple-600 font-bold">($1)</span>');
            qText = qText.replace(/_+/g, '<span class="inline-block border-b-4 border-purple-300 w-24 mx-1"></span>');
            document.getElementById('question-text').innerHTML = qText;

            // Render Options
            const optionsContainer = document.getElementById('options-grid');
            optionsContainer.innerHTML = '';

            // Map standard ABCD to the options (Assuming order in JSON is A, B, C, D)
            const labels = ['A', 'B', 'C', 'D'];
            
            q.answerOptions.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn-option w-full py-4 px-6 rounded-2xl text-left text-lg font-semibold flex items-center text-gray-700';
                btn.innerHTML = `
                    <span class="bg-gray-100 w-8 h-8 flex items-center justify-center rounded-full mr-4 text-sm font-bold text-gray-500 group-hover:bg-purple-100 group-hover:text-purple-600 transition-colors">${labels[index]}</span>
                    ${opt.text}
                `;
                btn.onclick = () => checkAnswer(opt.isCorrect, btn, q.rationale);
                optionsContainer.appendChild(btn);
            });
        }

        function checkAnswer(isCorrect, btnElement, rationale) {
            if (hasAnswered) return;
            hasAnswered = true;

            const allButtons = document.querySelectorAll('.btn-option');
            
            // Find correct button to highlight it even if wrong was clicked
            let correctBtn;
            questions[currentQuestionIndex].answerOptions.forEach((opt, idx) => {
                if (opt.isCorrect) correctBtn = allButtons[idx];
            });

            if (isCorrect) {
                score += 10;
                playSound('correct');
                btnElement.classList.add('btn-correct');
                // Confetti Effect
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#00C9A7', '#8854C0', '#F368E0']
                });
            } else {
                playSound('wrong');
                btnElement.classList.add('btn-wrong');
                correctBtn.classList.add('btn-correct'); // Show correct answer
            }

            // Disable all buttons
            allButtons.forEach(btn => btn.disabled = true);
            updateUI();

            // Show Explanation
            showExplanation(rationale);
        }

        function showExplanation(rationaleText) {
            const expArea = document.getElementById('explanation-area');
            const expContent = document.getElementById('explanation-content');
            const nextBtnContainer = document.getElementById('next-btn').parentElement;

            // Format Markdown-style text to HTML
            let formattedText = rationaleText
                .replace(/\*\*(.*?)\*\*/g, '<b class="text-gray-900">$1</b>') // Bold
                .replace(/- ([A-D]\.)/g, '<br><span class="font-bold text-purple-600">$1</span>') // Options A. B. C. D.
                .replace(/\n/g, '<br>'); // Line breaks

            expContent.innerHTML = formattedText;
            
            expArea.classList.remove('hidden');
            nextBtnContainer.classList.remove('hidden'); // Reveal Next Button
            
            // Scroll to explanation on mobile
            if(window.innerWidth < 768) {
                expArea.scrollIntoView({behavior: 'smooth', block: 'start'});
            }
        }

        document.getElementById('next-btn').addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                renderQuestion();
                // Update progress bar
                const progress = ((currentQuestionIndex) / questions.length) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
            } else {
                showResults();
            }
        });

        function showResults() {
            document.getElementById('quiz-container').classList.remove('card-shadow'); // Remove shadow for flat look
            document.getElementById('question-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('progress-bar').style.width = '100%';

            document.getElementById('final-score').innerText = score;
            const percent = Math.round((score / (questions.length * 10)) * 100);
            document.getElementById('final-percent').innerText = `${percent}%`;

            const message = document.getElementById('final-message');
            if (percent === 100) {
                message.innerText = "Tuy·ªát v·ªùi! Em l√† thi√™n t√†i ng·ªØ ph√°p! üåü";
                message.className = "text-green-500 font-bold text-xl mb-8";
                confetti({ particleCount: 200, spread: 100 });
            } else if (percent >= 80) {
                message.innerText = "L√†m t·ªët l·∫Øm! Em r·∫•t n·∫Øm ch·∫Øc b√†i! üéâ";
                message.className = "text-purple-500 font-bold text-xl mb-8";
            } else if (percent >= 50) {
                message.innerText = "C·ªë g·∫Øng th√™m ch√∫t n·ªØa nh√©! Em l√†m ƒë∆∞·ª£c m√†! üí™";
                message.className = "text-orange-500 font-bold text-xl mb-8";
            } else {
                message.innerText = "ƒê·ª´ng bu·ªìn, h√£y xem l·∫°i ph·∫ßn gi·∫£i th√≠ch v√† th·ª≠ l·∫°i nh√©! üìö";
                message.className = "text-gray-500 font-bold text-xl mb-8";
            }
        }

        // Start the game
        initGame();

    </script>
</body>
</html>
