<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* T·ª± ƒë·ªông t·∫°o b·∫£ng m√†u theo ch·ªß ƒë·ªÅ L≈© l·ª•t (Flood) */
            --primary-color: #0d47a1; /* Xanh ƒë·∫°i d∆∞∆°ng s·∫´m */
            --secondary-color: #00acc1; /* Xanh ng·ªçc / N∆∞·ªõc */
            --correct-color: #00D26A; /* Xanh l√° nh·∫°t - ƒê√∫ng */
            --wrong-color: #FF4757; /* ƒê·ªè cam - Sai */
            --bg-light: #f0f8ff;
            --text-dark: #2d3436;
            --card-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Quicksand', sans-serif;
        }

        body {
            /* T·ª± ƒë·ªông t·∫°o n·ªÅn SVG Background b·∫±ng k·ªπ thu·∫≠t data:image/svg+xml k·∫øt h·ª£p Gradient */
            background: radial-gradient(circle at center, rgba(0, 172, 193, 0.8) 0%, rgba(13, 71, 161, 0.9) 100%),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.1"><text x="10" y="40" font-size="30">üåßÔ∏è</text><text x="60" y="80" font-size="30">üåä</text><text x="30" y="90" font-size="20">üè†</text></svg>');
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Top Control Bar */
        .top-bar {
            background-color: var(--card-bg);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .header-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-color);
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timer-display {
            font-size: 24px;
            font-weight: 700;
            color: var(--wrong-color);
            background: #ffeaa7;
            padding: 5px 15px;
            border-radius: 10px;
            border: 2px solid #fdcb6e;
        }

        .btn-timer {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 0 #00838f;
            transition: all 0.1s;
        }

        .btn-timer:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #00838f;
        }

        /* Split Screen Layout */
        .split-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .left-panel {
            background-color: rgba(255, 255, 255, 0.95);
            border-right: 4px dashed var(--secondary-color);
        }

        .right-panel {
            background-color: transparent;
            padding: 20px 40px;
        }

        /* Reading Passage Styles */
        .passage-title {
            font-size: 26px;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .passage-content p {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: justify;
        }

        .btn-translate {
            background: #f1c40f;
            color: #2c3e50;
            border: none;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 3px 0 #f39c12;
            margin-bottom: 15px;
            transition: transform 0.1s;
        }

        .btn-translate:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        .translation-box {
            display: none;
            background: #fff9c4;
            padding: 15px;
            border-left: 5px solid #fbc02d;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            font-style: italic;
        }

        /* Glossary Table */
        .glossary-container {
            margin-top: 30px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .glossary-title {
            font-size: 20px;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 16px;
        }

        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: var(--secondary-color);
            color: white;
        }

        /* Exercise Cards (Right Panel) */
        .question-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.1);
            position: relative;
        }

        .question-text {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: #f5f6fa;
            border: 2px solid #dcdde1;
            padding: 15px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 15px;
            cursor: pointer;
            text-align: left;
            box-shadow: 0 5px 0 #dcdde1;
            transition: all 0.2s ease;
            color: var(--text-dark);
            position: relative;
        }

        .option-btn:hover {
            transform: scale(1.02);
            border-color: var(--secondary-color);
        }

        .option-btn:active {
            transform: translateY(5px) scale(1);
            box-shadow: 0 0 0 transparent;
        }

        .option-btn.correct {
            background: var(--correct-color);
            border-color: #00b85c;
            color: white;
            box-shadow: 0 5px 0 #00b85c;
        }

        .option-btn.wrong {
            background: var(--wrong-color);
            border-color: #ff3040;
            color: white;
            box-shadow: 0 5px 0 #ff3040;
        }

        /* Shake Animation */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            50% { transform: translateX(8px); }
            75% { transform: translateX(-8px); }
            100% { transform: translateX(0); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
        }

        /* Explanations */
        .explanation-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #eafaf1;
            border: 2px solid var(--correct-color);
            border-radius: 15px;
            animation: fadeIn 0.5s ease-in;
        }

        .explanation-box h4 {
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .explanation-box p, .explanation-box ul {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .explanation-box ul {
            padding-left: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Submit Button */
        .btn-submit {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            padding: 20px;
            font-size: 24px;
            font-weight: 700;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 0 #4834d4;
            margin-top: 20px;
            margin-bottom: 50px;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn-submit:active {
            transform: translateY(8px);
            box-shadow: none;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: scaleUp 0.3s ease-out;
        }

        @keyframes scaleUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-content h2 {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .score-display {
            font-size: 60px;
            font-weight: 800;
            color: var(--correct-color);
            margin: 20px 0;
        }

        .feedback-msg {
            font-size: 20px;
            color: #636e72;
            margin-bottom: 25px;
        }

        .btn-close-modal {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px 0 #00838f;
        }

        /* Canvas for Confetti */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        
        /* Responsive */
        @media (max-width: 900px) {
            .split-container { flex-direction: column; overflow-y: auto; }
            .panel { width: 100%; overflow-y: visible; }
            .left-panel { border-right: none; border-bottom: 4px dashed var(--secondary-color); }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="top-bar">
        <div class="header-title">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <div class="timer-container">
            <div class="timer-display" id="timer">10:00</div>
            <button class="btn-timer" id="btn-timer-toggle" onclick="toggleTimer()">B·∫ÆT ƒê·∫¶U T√çNH GI·ªú L√ÄM B√ÄI</button>
        </div>
    </div>

    <div class="split-container">
        <div class="panel left-panel">
            <h1 class="passage-title">What To Do During the Flood</h1>
            
            <div class="passage-content">
                <h3>If you evacuate</h3>
                <p>Avoid (1) .......... through flood water. Flood water can hide debris, sewage, electrical hazards and other (2) .......... . If your vehicle is trapped in (3) .......... moving water, stay inside. If the vehicle fills with water, seek (4) .......... on the roof. Avoid evacuating over (5) .......... spanning fast-moving water. These can fail without warning, taking you and your loved ones with them.</p>
                <button class="btn-translate" onclick="toggleTranslate('trans1')">üåç XEM B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div id="trans1" class="translation-box">
                    <strong>N·∫øu b·∫°n ph·∫£i s∆° t√°n:</strong> Tr√°nh di chuy·ªÉn qua d√≤ng n∆∞·ªõc l≈©. N∆∞·ªõc l≈© c√≥ th·ªÉ che gi·∫•u c√°c m·∫£nh v·ª°, n∆∞·ªõc th·∫£i, r·ªßi ro ch·∫≠p ƒëi·ªán v√† c√°c m·ªëi nguy hi·ªÉm kh√°c. N·∫øu xe c·ªßa b·∫°n b·ªã m·∫Øc k·∫πt trong d√≤ng n∆∞·ªõc ch·∫£y xi·∫øt, h√£y ·ªü l·∫°i b√™n trong. N·∫øu xe b·ªã ng·∫≠p ƒë·∫ßy n∆∞·ªõc, h√£y t√¨m n∆°i tr√∫ ·∫©n tr√™n n√≥c xe. Tr√°nh s∆° t√°n qua c√°c c√¢y c·∫ßu b·∫Øc ngang d√≤ng n∆∞·ªõc ch·∫£y xi·∫øt. Ch√∫ng c√≥ th·ªÉ s·∫≠p xu·ªëng m√† kh√¥ng c√≥ d·∫•u hi·ªáu b√°o tr∆∞·ªõc, c∆∞·ªõp ƒëi sinh m·∫°ng c·ªßa b·∫°n v√† nh·ªØng ng∆∞·ªùi th√¢n y√™u.
                </div>

                <h3>If you shelter in place</h3>
                <p>Move to the (6) .......... floors. Flood water against the lower floors can infiltrate the home, break windows (7) .......... cause generally dangerous conditions. Also, consider (8) .......... to a neighbor‚Äôs home on higher ground if you can safely do so. Stay aware of changing conditions and alerts by listening to the radio or periodically checking (9) .......... apps. If the (10) .......... continues to rise and make the home unsafe, carefully move to the roof and call 9-1-1 for help.</p>
                <button class="btn-translate" onclick="toggleTranslate('trans2')">üåç XEM B·∫¢N D·ªäCH ƒê·∫¶Y ƒê·ª¶</button>
                <div id="trans2" class="translation-box">
                    <strong>N·∫øu b·∫°n tr√∫ ·∫©n t·∫°i ch·ªó:</strong> H√£y di chuy·ªÉn l√™n c√°c t·∫ßng tr√™n. N∆∞·ªõc l≈© ƒë·∫≠p v√†o c√°c t·∫ßng d∆∞·ªõi c√≥ th·ªÉ x√¢m nh·∫≠p v√†o nh√†, l√†m v·ª° c·ª≠a s·ªï v√† g√¢y ra c√°c ƒëi·ªÅu ki·ªán nguy hi·ªÉm n√≥i chung. Ngo√†i ra, h√£y c√¢n nh·∫Øc vi·ªác di chuy·ªÉn ƒë·∫øn nh√† h√†ng x√≥m ·ªü v√πng ƒë·∫•t cao h∆°n n·∫øu b·∫°n c√≥ th·ªÉ l√†m ƒëi·ªÅu ƒë√≥ m·ªôt c√°ch an to√†n. C·∫≠p nh·∫≠t th√¥ng tin v·ªÅ c√°c ƒëi·ªÅu ki·ªán ƒëang thay ƒë·ªïi v√† c√°c c·∫£nh b√°o b·∫±ng c√°ch nghe ƒë√†i ho·∫∑c ki·ªÉm tra c√°c ·ª©ng d·ª•ng th·ªùi ti·∫øt ƒë·ªãnh k·ª≥. N·∫øu n∆∞·ªõc ti·∫øp t·ª•c d√¢ng cao v√† khi·∫øn ng√¥i nh√† tr·ªü n√™n kh√¥ng an to√†n, h√£y c·∫©n th·∫≠n di chuy·ªÉn l√™n m√°i nh√† v√† g·ªçi 9-1-1 ƒë·ªÉ ƒë∆∞·ª£c gi√∫p ƒë·ª°.
                </div>
            </div>

            <div class="glossary-container">
                <div class="glossary-title">üìö Academic Glossary (B·∫£ng t·ª´ v·ª±ng B1-C2)</div>
                <table>
                    <thead>
                        <tr>
                            <th>T·ª´ v·ª±ng</th>
                            <th>Lo·∫°i t·ª´</th>
                            <th>Nghƒ©a ti·∫øng Vi·ªát</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>1. Evacuate</td><td>Verb (ƒê·ªông t·ª´)</td><td>S∆° t√°n, di t·∫£n</td></tr>
                        <tr><td>2. Debris</td><td>Noun (Danh t·ª´)</td><td>M·∫£nh v·ª•n, ƒë·ªëng ƒë·ªï n√°t</td></tr>
                        <tr><td>3. Sewage</td><td>Noun (Danh t·ª´)</td><td>N∆∞·ªõc th·∫£i, ch·∫•t th·∫£i</td></tr>
                        <tr><td>4. Hazard</td><td>Noun (Danh t·ª´)</td><td>M·ªëi nguy hi·ªÉm, r·ªßi ro</td></tr>
                        <tr><td>5. Refuge</td><td>Noun (Danh t·ª´)</td><td>N∆°i tr√∫ ·∫©n, t·ªã n·∫°n</td></tr>
                        <tr><td>6. Span</td><td>Verb (ƒê·ªông t·ª´)</td><td>B·∫Øc ngang qua, v·∫Øt qua</td></tr>
                        <tr><td>7. Infiltrate</td><td>Verb (ƒê·ªông t·ª´)</td><td>X√¢m nh·∫≠p, th·∫•m v√†o</td></tr>
                        <tr><td>8. Periodically</td><td>Adverb (Tr·∫°ng t·ª´)</td><td>M·ªôt c√°ch ƒë·ªãnh k·ª≥, th∆∞·ªùng xuy√™n</td></tr>
                        <tr><td>9. Shelter</td><td>Verb/Noun</td><td>Tr√∫ ·∫©n / N∆°i tr√∫ ·∫©n</td></tr>
                        <tr><td>10. Vehicle</td><td>Noun (Danh t·ª´)</td><td>Ph∆∞∆°ng ti·ªán giao th√¥ng</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="panel right-panel" id="quiz-container">
            <button class="btn-submit" onclick="submitQuiz()">üöÄ N·ªòP B√ÄI</button>
        </div>
    </div>

    <div class="modal-overlay" id="result-modal">
        <div class="modal-content">
            <h2>üéâ HO√ÄN TH√ÄNH XU·∫§T S·∫ÆC! üéâ</h2>
            <div class="score-display" id="final-score">0/16</div>
            <div class="feedback-msg" id="feedback-msg">B·∫°n l√† m·ªôt thi√™n t√†i!</div>
            <button class="btn-close-modal" onclick="closeModal()">Xem l·∫°i ƒë√°p √°n</button>
        </div>
    </div>

    <script>
        // --- DATA & LOGIC TR·ªòN ƒê·ªÄ ---
        const rawQuestions = [
            // Cloze Test
            {
                id: 1, type: 'cloze', text: "1. Avoid (1) __________ through flood water.",
                options: [ {text: "move", correct: false}, {text: "moved", correct: false}, {text: "moving", correct: true}, {text: "to move", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'moving'?</h4><ul><li><b>Ng·ªØ ph√°p:</b> C·∫•u tr√∫c <b>Avoid + V-ing</b> (Tr√°nh l√†m vi·ªác g√¨ ƒë√≥).</li><li><b>Lo·∫°i tr·ª´:</b> 'move' (V-nguy√™n), 'moved' (V-ed), 'to move' (to-V) ƒë·ªÅu sai c·∫•u tr√∫c.</li><li><b>D·ªãch nghƒ©a:</b> Tr√°nh di chuy·ªÉn qua d√≤ng n∆∞·ªõc l≈©.</li></ul>"
            },
            {
                id: 2, type: 'cloze', text: "2. Flood water can hide debris, sewage, electrical hazards and other (2) _______ .",
                options: [ {text: "dangers", correct: true}, {text: "notices", correct: false}, {text: "warnings", correct: false}, {text: "benefits", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'dangers'?</h4><ul><li><b>T·ª´ v·ª±ng:</b> dangers (nh·ªØng m·ªëi nguy hi·ªÉm); notices (th√¥ng b√°o); warnings (c·∫£nh b√°o); benefits (l·ª£i √≠ch).</li><li><b>Ng·ªØ c·∫£nh:</b> C√¢u tr∆∞·ªõc li·ªát k√™ 'm·∫£nh v·ª°, n∆∞·ªõc th·∫£i, r·ªßi ro ch·∫≠p ƒëi·ªán' -> ƒê√¢y ƒë·ªÅu l√† c√°c m·ªëi nguy hi·ªÉm. C·ª•m t·ª´ 'other dangers' (c√°c m·ªëi nguy hi·ªÉm kh√°c) l√† h·ª£p l√Ω nh·∫•t.</li></ul>"
            },
            {
                id: 3, type: 'cloze', text: "3. If your vehicle is trapped in (3) _______ moving water...",
                options: [ {text: "frequent", correct: false}, {text: "frequently", correct: false}, {text: "rapid", correct: false}, {text: "rapidly", correct: true} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'rapidly'?</h4><ul><li><b>Ng·ªØ ph√°p:</b> 'moving' ·ªü ƒë√¢y ƒë√≥ng vai tr√≤ l√† t√≠nh t·ª´/hi·ªán t·∫°i ph√¢n t·ª´ b·ªï nghƒ©a cho 'water' (n∆∞·ªõc ƒëang ch·∫£y). ƒê·ªÉ b·ªï nghƒ©a cho 'moving', ta c·∫ßn m·ªôt <b>Tr·∫°ng t·ª´ (Adverb)</b>.</li><li><b>Ph√¢n t√≠ch:</b> rapid (t√≠nh t·ª´) -> rapidly (tr·∫°ng t·ª´). Nghƒ©a l√† 'nhanh, xi·∫øt'.</li><li><b>D·ªãch:</b> N∆∞·ªõc ch·∫£y xi·∫øt (rapidly moving water).</li></ul>"
            },
            {
                id: 4, type: 'cloze', text: "4. ...seek (4) __________ on the roof.",
                options: [ {text: "refuge", correct: true}, {text: "food", correct: false}, {text: "clothes", correct: false}, {text: "money", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'refuge'?</h4><ul><li><b>Collocation (C·ª•m t·ª´ c·ªë ƒë·ªãnh):</b> <b>Seek refuge</b> (T√¨m n∆°i tr√∫ ·∫©n).</li><li><b>Ng·ªØ c·∫£nh:</b> Khi xe ng·∫≠p n∆∞·ªõc, ng∆∞·ªùi ta ph·∫£i leo l√™n n√≥c xe ƒë·ªÉ t√¨m ch·ªó tr·ªën/an to√†n, ch·ª© kh√¥ng ph·∫£i t√¨m th·ª©c ƒÉn (food), qu·∫ßn √°o (clothes) hay ti·ªÅn (money).</li></ul>"
            },
            {
                id: 5, type: 'cloze', text: "5. Avoid evacuating over (5) __________ spanning fast-moving water.",
                options: [ {text: "flats", correct: false}, {text: "paths", correct: false}, {text: "bridges", correct: true}, {text: "buildings", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'bridges'?</h4><ul><li><b>D·∫•u hi·ªáu:</b> ƒê·ªông t·ª´ 'spanning' (b·∫Øc ngang qua, v·∫Øt qua) th∆∞·ªùng ƒëi v·ªõi s√¥ng, su·ªëi. V·∫≠t ki·∫øn tr√∫c b·∫Øc ngang qua n∆∞·ªõc ch·ªâ c√≥ th·ªÉ l√† <b>C√¢y c·∫ßu (bridges)</b>.</li><li><b>Lo·∫°i tr·ª´:</b> flats (cƒÉn h·ªô), paths (con ƒë∆∞·ªùng nh·ªè), buildings (t√≤a nh√†) kh√¥ng th·ªÉ b·∫Øc ngang qua d√≤ng n∆∞·ªõc.</li></ul>"
            },
            {
                id: 6, type: 'cloze', text: "6. Move to the (6) __________ floors.",
                options: [ {text: "lower", correct: false}, {text: "upper", correct: true}, {text: "under", correct: false}, {text: "behind", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'upper'?</h4><ul><li><b>Ng·ªØ c·∫£nh:</b> ƒêang c√≥ l≈© l·ª•t, c√¢u sau nh·∫Øc t·ªõi 'Flood water against the lower floors' (N∆∞·ªõc l≈© ƒë·∫≠p v√†o c√°c t·∫ßng d∆∞·ªõi). V·∫≠y ƒë·ªÉ an to√†n, ta ph·∫£i ch·∫°y l√™n c√°c t·∫ßng tr√™n (<b>upper floors</b>).</li></ul>"
            },
            {
                id: 7, type: 'cloze', text: "7. ...infiltrate the home, break windows (7) __________ cause generally dangerous conditions.",
                options: [ {text: "and", correct: true}, {text: "or", correct: false}, {text: "but", correct: false}, {text: "so", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'and'?</h4><ul><li><b>Ng·ªØ ph√°p:</b> C√¢u ƒëang li·ªát k√™ chu·ªói h√†nh ƒë·ªông c√πng t√≠nh ch·∫•t c·ªßa n∆∞·ªõc l≈©: x√¢m nh·∫≠p (infiltrate), l√†m v·ª° (break) <b>V√Ä</b> g√¢y ra (cause). D√πng li√™n t·ª´ 'and' ƒë·ªÉ n·ªëi c√°c ƒë·ªông t·ª´ song song.</li></ul>"
            },
            {
                id: 8, type: 'cloze', text: "8. Also, consider (8) __________ to a neighbor‚Äôs home...",
                options: [ {text: "cycling", correct: false}, {text: "moving", correct: true}, {text: "driving", correct: false}, {text: "walking", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'moving'?</h4><ul><li><b>Ng·ªØ ph√°p:</b> consider + V-ing (c√¢n nh·∫Øc vi·ªác g√¨). C·∫£ 4 ƒë√°p √°n ƒë·ªÅu V-ing.</li><li><b>Ng·ªØ c·∫£nh:</b> Trong l√∫c l≈© l·ª•t, kh√¥ng th·ªÉ ƒë·∫°p xe (cycling), l√°i xe (driving) hay ƒëi b·ªô b√¨nh th∆∞·ªùng (walking). D√πng t·ª´ chung nh·∫•t l√† <b>moving</b> (di chuy·ªÉn) ƒë·∫øn nh√† h√†ng x√≥m.</li></ul>"
            },
            {
                id: 9, type: 'cloze', text: "9. ...periodically checking (9)__________ apps.",
                options: [ {text: "game", correct: false}, {text: "shopping", correct: false}, {text: "travel", correct: false}, {text: "weather", correct: true} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'weather'?</h4><ul><li><b>Ng·ªØ c·∫£nh:</b> ƒêang tr√°nh b√£o l≈©, vi·ªác c·∫ßn l√†m l√† nghe ƒë√†i v√† ki·ªÉm tra c√°c ·ª©ng d·ª•ng <b>th·ªùi ti·∫øt (weather apps)</b> ƒë·ªÉ bi·∫øt t√¨nh h√¨nh. Kh√¥ng ai ƒëi ch∆°i game hay shopping l√∫c n√†y!</li></ul>"
            },
            {
                id: 10, type: 'cloze', text: "10. If the (10) __________ continues to rise...",
                options: [ {text: "water", correct: true}, {text: "speed", correct: false}, {text: "noise", correct: false}, {text: "temperature", correct: false} ],
                explanation: "<h4>T·∫°i sao ch·ªçn 'water'?</h4><ul><li><b>Ng·ªØ c·∫£nh:</b> ƒê·ªông t·ª´ 'rise' (d√¢ng l√™n). Trong b√£o l≈©, th·ª© d√¢ng l√™n ƒëe d·ªça ng√¥i nh√† ch√≠nh l√† <b>n∆∞·ªõc (water)</b>.</li></ul>"
            },
            // Reading Comprehension
            {
                id: 11, type: 'reading', text: "11. What can flood water hide?",
                options: [ 
                    {text: "Debris, money, electrical hazards and other dangers.", correct: false}, 
                    {text: "Debris, sewage, electrical hazards and other dangers.", correct: true}, 
                    {text: "Food, clean water, electrical hazards and other dangers.", correct: false}, 
                    {text: "Debris, sewage, electrical hazards and other good things.", correct: false} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>D·∫´n ch·ª©ng trong b√†i:</b> Ngay ƒëo·∫°n 1 d√≤ng 2: <i>'Flood water can hide debris, sewage, electrical hazards and other dangers.'</i></li><li><b>Ph√¢n t√≠ch:</b> C√°c l·ª±a ch·ªçn kh√°c b·ªã sai l·ªách t·ª´: 'money' (ti·ªÅn), 'food, clean water' (th·ª©c ƒÉn, n∆∞·ªõc s·∫°ch), 'good things' (nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp) -> Kh√¥ng c√≥ trong b√†i.</li></ul>"
            },
            {
                id: 12, type: 'reading', text: "12. What should you do if your vehicle is trapped in rapidly moving water?",
                options: [ 
                    {text: "Climb the tree.", correct: false}, 
                    {text: "Stay inside the vehicle.", correct: true}, 
                    {text: "Move through flood water.", correct: false}, 
                    {text: "Seek your raincoat in the vehicle.", correct: false} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>D·∫´n ch·ª©ng trong b√†i:</b> ƒêo·∫°n 1 d√≤ng 3 c√≥ vi·∫øt r√µ: <i>'If your vehicle is trapped in rapidly moving water, <b>stay inside</b>.'</i> (N·∫øu xe b·ªã k·∫πt trong n∆∞·ªõc ch·∫£y xi·∫øt, h√£y ·ªü l·∫°i b√™n trong).</li></ul>"
            },
            {
                id: 13, type: 'reading', text: "13. Why shouldn‚Äôt we evacuate over bridges spanning fast-moving water?",
                options: [ 
                    {text: "Because we can move rapidly.", correct: false}, 
                    {text: "Because we can become stronger.", correct: false}, 
                    {text: "Because we can be in danger.", correct: true}, 
                    {text: "Because we will be safe.", correct: false} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>D·∫´n ch·ª©ng:</b> Cu·ªëi ƒëo·∫°n 1: <i>'These can fail without warning, taking you and your loved ones with them.'</i> (Ch√∫ng c√≥ th·ªÉ s·∫≠p b·∫•t ng·ªù, c∆∞·ªõp ƒëi b·∫°n v√† ng∆∞·ªùi th√¢n).</li><li><b>Suy lu·∫≠n:</b> Vi·ªác s·∫≠p c·∫ßu c∆∞·ªõp ƒëi sinh m·∫°ng ch√≠nh l√† vi·ªác ch√∫ng ta g·∫∑p nguy hi·ªÉm (<b>be in danger</b>).</li></ul>"
            },
            {
                id: 14, type: 'reading', text: "14. Can flood water break windows?",
                options: [ 
                    {text: "Yes, it can.", correct: true}, 
                    {text: "No, it can‚Äôt.", correct: false}, 
                    {text: "Yes, they are.", correct: false}, 
                    {text: "No, they aren‚Äôt.", correct: false} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>D·∫´n ch·ª©ng:</b> ƒêo·∫°n 2 d√≤ng 2: <i>'Flood water... can infiltrate the home, <b>break windows</b>...'</i></li><li><b>Ng·ªØ ph√°p:</b> C√¢u h·ªèi b·∫Øt ƒë·∫ßu b·∫±ng 'Can flood water...' (Ng√¥i th·ª© 3 s·ªë √≠t, ƒë·ªông t·ª´ khuy·∫øt thi·∫øu Can). Tr·∫£ l·ªùi ph·∫£i l√† 'Yes, it can'. Lo·∫°i C, D v√¨ d√πng to be 'are/aren't'.</li></ul>"
            },
            {
                id: 15, type: 'reading', text: "15. What should we do if the water continues to rise?",
                options: [ 
                    {text: "Listen to the radio.", correct: false}, 
                    {text: "Carefully move to the roof.", correct: false}, 
                    {text: "Call 9-1-1 for help.", correct: false}, 
                    {text: "Both B and C.", correct: true} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>D·∫´n ch·ª©ng:</b> C√¢u cu·ªëi c√πng c·ªßa b√†i: <i>'If the water continues to rise... carefully <b>move to the roof</b> AND <b>call 9-1-1</b> for help.'</i></li><li><b>K·∫øt lu·∫≠n:</b> Ph·∫£i l√†m c·∫£ hai vi·ªác B v√† C. N√™n ƒë√°p √°n ƒë√∫ng nh·∫•t l√† D (C·∫£ B v√† C).</li></ul>"
            },
            {
                id: 16, type: 'reading', text: "16. Which of the following words is closest in meaning to ‚Äúunsafe‚Äù?",
                options: [ 
                    {text: "safe", correct: false}, 
                    {text: "cold", correct: false}, 
                    {text: "careful", correct: false}, 
                    {text: "dangerous", correct: true} 
                ],
                explanation: "<h4>Gi·∫£i th√≠ch chi ti·∫øt:</h4><ul><li><b>Ph√¢n t√≠ch t·ª´ v·ª±ng:</b> 'unsafe' = un (kh√¥ng) + safe (an to√†n) -> Kh√¥ng an to√†n, nguy hi·ªÉm.</li><li><b>ƒê·ªìng nghƒ©a:</b> T·ª´ ƒë·ªìng nghƒ©a v·ªõi 'kh√¥ng an to√†n' ch√≠nh l√† <b>dangerous</b> (nguy hi·ªÉm).</li></ul>"
            }
        ];

        let state = {
            answered: {}, // L∆∞u tr·∫°ng th√°i ƒë√£ tr·∫£ l·ªùi c·ªßa t·ª´ng c√¢u
            score: 0
        };

        // Thu·∫≠t to√°n x√°o tr·ªôn m·∫£ng (Fisher-Yates Shuffle)
        function shuffleArray(array) {
            let curId = array.length;
            while (0 !== curId) {
                let randId = Math.floor(Math.random() * curId);
                curId -= 1;
                let tmp = array[curId];
                array[curId] = array[randId];
                array[randId] = tmp;
            }
            return array;
        }

        // --- RENDER B√ÄI T·∫¨P ---
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            let htmlContent = '';

            rawQuestions.forEach((q, index) => {
                // X√°o tr·ªôn options nh∆∞ng gi·ªØ nguy√™n logic ƒë√∫ng sai
                let shuffledOptions = shuffleArray([...q.options]);
                
                let optionsHtml = '';
                const labels = ['A', 'B', 'C', 'D'];
                
                shuffledOptions.forEach((opt, i) => {
                    // Escape k√Ω t·ª± ƒë·ªÉ nh√∫ng v√†o function an to√†n
                    const isCorrect = opt.correct.toString();
                    optionsHtml += `
                        <button class="option-btn" id="btn-${q.id}-${i}" onclick="selectAnswer(${q.id}, ${i}, ${isCorrect})">
                            <b>${labels[i]}.</b> ${opt.text}
                        </button>
                    `;
                });

                htmlContent += `
                    <div class="question-card" id="card-${q.id}">
                        <div class="question-text">${q.text}</div>
                        <div class="options-grid">
                            ${optionsHtml}
                        </div>
                        <div class="explanation-box" id="expl-${q.id}">
                            ${q.explanation}
                        </div>
                    </div>
                `;
            });

            // Gi·ªØ l·∫°i n√∫t N·ªòP B√ÄI
            htmlContent += `<button class="btn-submit" onclick="submitQuiz()">üöÄ N·ªòP B√ÄI</button>`;
            container.innerHTML = htmlContent;
        }

        // --- H·ªÜ TH·ªêNG √ÇM THANH (WEB AUDIO API) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
        }

        function playSound(type) {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'correct') {
                // √Çm thanh 'Ding' vui tai
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'wrong') {
                // √Çm thanh 't√©o t√®o t√®o' r·ªõt ƒë√†i
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.setValueAtTime(250, now + 0.15);
                osc.frequency.setValueAtTime(200, now + 0.3);
                osc.frequency.setValueAtTime(150, now + 0.45);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.linearRampToValueAtTime(0.01, now + 0.6);
                osc.start(now);
                osc.stop(now + 0.6);
            }
        }

        // --- HI·ªÜU ·ª®NG PH√ÅO GI·∫§Y (CONFETTI VANILLA JS) ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particles = [];

        function fireConfetti() {
            particles = [];
            for(let i=0; i<100; i++){
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 10 + 5,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 2 - 1,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            particles.forEach(p => {
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += p.rotationSpeed;
                if (p.y < canvas.height) active = true;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                ctx.restore();
            });

            if(active) requestAnimationFrame(animateConfetti);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // C·∫≠p nh·∫≠t l·∫°i k√≠ch th∆∞·ªõc canvas khi resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // --- X·ª¨ L√ù LOGIC L√ÄM B√ÄI ---
        function selectAnswer(qId, btnIndex, isCorrect) {
            // N·∫øu ƒë√£ tr·∫£ l·ªùi c√¢u n√†y r·ªìi th√¨ kh√¥ng cho ch·ªçn l·∫°i
            if (state.answered[qId]) return;
            state.answered[qId] = true;

            const clickedBtn = document.getElementById(`btn-${qId}-${btnIndex}`);
            const card = document.getElementById(`card-${qId}`);
            const expl = document.getElementById(`expl-${qId}`);

            // T√¨m n√∫t ƒë√∫ng th·ª±c s·ª± trong DOM ƒë·ªÉ t√¥ s√°ng n·∫øu h·ªçc sinh ch·ªçn sai
            const allBtnsInCard = card.querySelectorAll('.option-btn');
            
            if (isCorrect) {
                clickedBtn.classList.add('correct');
                playSound('correct');
                fireConfetti();
                state.score++;
            } else {
                clickedBtn.classList.add('wrong');
                clickedBtn.classList.add('shake');
                playSound('wrong');
                
                // T√¥ xanh ƒë√°p √°n ƒë√∫ng ngay l·∫≠p t·ª©c
                allBtnsInCard.forEach(btn => {
                    // D·ª±a v√†o tham s·ªë onclick trong HTML ƒë·ªÉ t√¨m n√∫t true
                    if (btn.getAttribute('onclick').includes('true')) {
                        btn.classList.add('correct');
                    }
                });
            }

            // Hi·ªán gi·∫£i th√≠ch chi ti·∫øt
            expl.style.display = 'block';
            
            // Disable t·∫•t c·∫£ c√°c n√∫t trong c√¢u n√†y
            allBtnsInCard.forEach(btn => {
                btn.style.cursor = 'not-allowed';
                btn.onclick = null;
            });
        }

        // --- T√çNH NƒÇNG D·ªäCH THU·∫¨T ---
        function toggleTranslate(id) {
            const box = document.getElementById(id);
            if (box.style.display === 'block') {
                box.style.display = 'none';
            } else {
                box.style.display = 'block';
            }
        }

        // --- T√çNH NƒÇNG ƒê·ªíNG H·ªí ƒê·∫æM NG∆Ø·ª¢C ---
        let timerInterval;
        let timeLeft = 600; // 10 ph√∫t = 600 gi√¢y
        let isRunning = false;

        function updateTimerDisplay() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
        }

        function toggleTimer() {
            const btn = document.getElementById('btn-timer-toggle');
            if (isRunning) {
                clearInterval(timerInterval);
                btn.innerText = "TI·∫æP T·ª§C L√ÄM B√ÄI";
                btn.style.background = "#f39c12";
                isRunning = false;
            } else {
                btn.innerText = "T·∫†M D·ª™NG";
                btn.style.background = "#e74c3c";
                isRunning = true;
                timerInterval = setInterval(() => {
                    if (timeLeft > 0) {
                        timeLeft--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isRunning = false;
                        alert("H·∫æT GI·ªú! B·∫°n v·∫´n c√≥ th·ªÉ ti·∫øp t·ª•c l√†m, nh∆∞ng nh·ªõ l√† trong ph√≤ng thi th·∫≠t, b·∫°n ch·ªâ n√™n l√†m m·ªôt b√†i nh∆∞ th·∫ø n√†y trong 10 ph√∫t th√¥i nha.");
                    }
                }, 1000);
            }
        }

        // --- T√çNH NƒÇNG N·ªòP B√ÄI ---
        function submitQuiz() {
            const modal = document.getElementById('result-modal');
            const scoreDisplay = document.getElementById('final-score');
            const msgDisplay = document.getElementById('feedback-msg');
            
            const total = rawQuestions.length;
            scoreDisplay.innerText = `${state.score}/${total}`;

            let msg = "";
            let ratio = state.score / total;

            if (ratio === 1) msg = "Qu√° ƒë·ªânh! B·∫°n l√† THI√äN T√ÄI ti·∫øng Anh! üèÜ";
            else if (ratio >= 0.8) msg = "L√†m t·ªët l·∫Øm! Ki·∫øn th·ª©c c·ªßa b·∫°n r·∫•t v·ªØng! üåü";
            else if (ratio >= 0.5) msg = "Kh√° khen nha! Nh∆∞ng c·ªë g·∫Øng √¥n k·ªπ t·ª´ v·ª±ng h∆°n ch√∫t n·ªØa nh√©! üí™";
            else msg = "ƒê·ª´ng n·∫£n ch√≠! H√£y ƒë·ªçc k·ªπ ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt c·ªßa c√¥ Mai An b√™n d∆∞·ªõi nh√©! ‚ù§Ô∏è";

            msgDisplay.innerText = msg;
            modal.style.display = 'flex';
            
            if(ratio >= 0.5) fireConfetti();
        }

        function closeModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

        // Kh·ªüi t·∫°o ch·∫°y l√∫c t·∫£i trang
        window.onload = () => {
            renderQuiz();
            updateTimerDisplay();
        };

    </script>
</body>
</html>