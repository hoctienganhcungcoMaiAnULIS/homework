<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Thi Ti·∫øng Anh - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Default Theme (Will be overridden by JS) */
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #fdcb6e;
            --text-dark: #2d3436;
            --text-light: #ffffff;
            --success: #00b894; /* Green */
            --error: #d63031;   /* Red */
            --bg-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"></svg>');
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Nunito', sans-serif;
            height: 100vh;
            overflow: hidden;
            background-color: #f0f3f5;
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        header {
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 100;
            height: 70px;
        }
        .teacher-brand {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
            font-family: 'Quicksand', sans-serif;
        }
        .teacher-sub { font-size: 0.8rem; color: #636e72; font-weight: normal; }
        
        /* Timer */
        .timer-box {
            background: var(--text-dark);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .timer-controls button {
            background: var(--accent);
            border: none;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        /* Passage Selector (Tabs) */
        .passage-tabs {
            display: flex;
            gap: 10px;
        }
        .tab-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 700;
            color: var(--primary);
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        /* --- Main Layout Split Screen --- */
        main {
            display: flex;
            flex: 1;
            height: calc(100vh - 70px);
            background-image: var(--bg-pattern);
            background-size: cover;
            background-blend-mode: soft-light;
            transition: background 0.5s;
        }

        /* Left Panel: Reading */
        .panel-left {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.95);
            margin: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 10px solid var(--primary);
        }
        .reading-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px dashed #dfe6e9;
            padding-bottom: 10px;
        }
        .reading-content {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #2d3436;
            margin-bottom: 20px;
            text-align: justify;
        }
        
        /* Tools in Reading */
        .btn-translate {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        .translation-box {
            display: none;
            background: #f1f2f6;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
            font-style: italic;
            color: #57606f;
            margin-bottom: 20px;
        }
        .glossary-box {
            margin-top: 30px;
            border: 2px solid #dfe6e9;
            border-radius: 15px;
            padding: 15px;
        }
        .glossary-title { font-weight: 800; color: var(--primary); margin-bottom: 10px; }
        .glossary-table { width: 100%; border-collapse: collapse; }
        .glossary-table th, .glossary-table td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
        .glossary-word { color: #d63031; font-weight: bold; }
        .glossary-type { font-size: 0.8rem; color: #636e72; font-style: italic; background: #dfe6e9; padding: 2px 6px; border-radius: 4px; }

        /* Right Panel: Exercises */
        .panel-right {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            margin: 20px 20px 20px 0; /* No left margin */
        }

        .question-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 0 rgba(0,0,0,0.05);
            border: 1px solid #eee;
            transition: transform 0.2s;
        }
        .question-text {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-dark);
        }
        
        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .option-btn {
            background: white;
            border: 2px solid #dfe6e9;
            padding: 15px;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 0 #dfe6e9;
            font-family: 'Nunito', sans-serif;
            color: #636e72;
        }
        .option-btn:hover { transform: scale(1.02); border-color: var(--secondary); }
        .option-btn:active { transform: translateY(4px); box-shadow: none; }
        
        /* State Colors */
        .option-btn.correct {
            background: var(--success);
            color: white;
            border-color: #009476;
            box-shadow: 0 4px 0 #009476;
        }
        .option-btn.wrong {
            background: var(--error);
            color: white;
            border-color: #b71c1c;
            box-shadow: 0 4px 0 #b71c1c;
            animation: shake 0.5s;
        }
        .option-btn.disabled { pointer-events: none; opacity: 0.7; }

        /* Ms Mai An Explanation */
        .explanation {
            display: none;
            margin-top: 20px;
            background: #fff8e1; /* Light yellow */
            border: 2px solid #ffeaa7;
            padding: 15px;
            border-radius: 15px;
        }
        .explanation.show { display: block; animation: slideDown 0.4s ease-out; }
        .exp-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            color: #e17055;
            margin-bottom: 10px;
        }
        .exp-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            border: 2px solid #e17055;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }
        .exp-content p { margin-bottom: 8px; font-size: 0.95rem; }
        .exp-content strong { color: #2d3436; }

        /* Footer / Submit */
        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding-bottom: 50px;
        }
        .btn-submit {
            background: linear-gradient(to bottom, var(--primary), #5541d6);
            color: white;
            font-size: 1.5rem;
            padding: 15px 50px;
            border: none;
            border-radius: 50px;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 0 #3c2bb5;
            transition: transform 0.2s;
        }
        .btn-submit:active { transform: translateY(6px); box-shadow: 0 2px 0 #3c2bb5; }

        /* Result Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: pop 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;
            border: 5px solid var(--primary);
        }
        .score-display {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin: 20px 0;
        }
        .feedback-text { font-size: 1.2rem; color: #636e72; margin-bottom: 20px; }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pop {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            main { flex-direction: column; height: auto; overflow-y: auto; }
            .panel-left, .panel-right { overflow-y: visible; margin: 10px; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <div class="teacher-brand">
        Ms Mai An ULIS <br>
        <span class="teacher-sub">Master of English Education</span>
    </div>
    
    <div class="passage-tabs">
        <button class="tab-btn active" onclick="switchPassage(0)">PART 1: EASTER</button>
        <button class="tab-btn" onclick="switchPassage(1)">PART 2: DRIVING</button>
    </div>

    <div class="timer-box">
        <span id="timer">10:00</span>
        <div class="timer-controls">
            <button id="btnPause" onclick="toggleTimer()">‚è∏</button>
        </div>
    </div>
</header>

<main>
    <div class="panel-left" id="readingPanel">
        </div>

    <div class="panel-right" id="exercisePanel">
        </div>
</main>

<div class="modal-overlay" id="resultModal">
    <div class="modal-content">
        <h2>K·∫æT QU·∫¢ B√ÄI L√ÄM</h2>
        <div class="score-display" id="finalScore">0/0</div>
        <p class="feedback-text" id="finalFeedback">...</p>
        <button class="btn-submit" onclick="closeModal()">Xem l·∫°i b√†i</button>
    </div>
</div>

<canvas id="confetti-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;"></canvas>

<script>
    // --- DATA ---
    const db = [
        {
            id: "easter",
            topic: "Easter Festival",
            theme: {
                primary: "#FF9FF3", // Pink
                secondary: "#55E6C1", // Mint
                accent: "#feca57",
                bgEmojis: ["ü•ö", "üê∞", "üå∏", "üç´"]
            },
            content: `
                <div class="reading-title">Topic: Easter Festival</div>
                <div class="reading-content">
                    <p>Easter is an important Christian festival and holiday. It is held to celebrate the resurrection of Jesus Christ. Easter is not a fixed holiday. Its date varies between 22nd March and 25th April. People celebrate Easter around the world.</p>
                    <p>In the UK, Easter is a public holiday. People give Easter chocolate eggs to their friends and family. There are also egg hunts for kids. In the US, Easter is a national holiday. People can go to church and have a special family meal. They also organise egg-hunts and give gifts of coloured eggs.</p>
                    <p>In Russia, Easter is one of the most important holidays. People celebrate it with an Easter breakfast or meal. They also create very beautiful Easter eggs.</p>
                </div>
                <button class="btn-translate" onclick="toggleTrans('trans-easter')">üáªüá≥ B·∫•m ƒë·ªÉ xem b·∫£n d·ªãch</button>
                <div id="trans-easter" class="translation-box">
                    <strong>B·∫£n d·ªãch:</strong><br>
                    L·ªÖ Ph·ª•c sinh l√† m·ªôt l·ªÖ h·ªôi v√† ng√†y l·ªÖ quan tr·ªçng c·ªßa Kit√¥ gi√°o. N√≥ ƒë∆∞·ª£c t·ªï ch·ª©c ƒë·ªÉ k·ª∑ ni·ªám s·ª± ph·ª•c sinh c·ªßa Ch√∫a Gi√™su Kit√¥. L·ªÖ Ph·ª•c sinh kh√¥ng ph·∫£i l√† m·ªôt ng√†y l·ªÖ c·ªë ƒë·ªãnh. Ng√†y c·ªßa n√≥ thay ƒë·ªïi trong kho·∫£ng t·ª´ 22/3 ƒë·∫øn 25/4. M·ªçi ng∆∞·ªùi ƒÉn m·ª´ng l·ªÖ Ph·ª•c sinh tr√™n kh·∫Øp th·∫ø gi·ªõi.<br><br>
                    ·ªû Anh, L·ªÖ Ph·ª•c sinh l√† m·ªôt ng√†y l·ªÖ chung. M·ªçi ng∆∞·ªùi t·∫∑ng tr·ª©ng s√¥ c√¥ la Ph·ª•c sinh cho b·∫°n b√® v√† gia ƒë√¨nh. C≈©ng c√≥ nh·ªØng cu·ªôc sƒÉn tr·ª©ng cho tr·∫ª em. ·ªû M·ªπ, L·ªÖ Ph·ª•c sinh l√† ng√†y l·ªÖ qu·ªëc gia. M·ªçi ng∆∞·ªùi c√≥ th·ªÉ ƒëi nh√† th·ªù v√† d√πng b·ªØa c∆°m gia ƒë√¨nh ƒë·∫∑c bi·ªát. H·ªç c≈©ng t·ªï ch·ª©c sƒÉn tr·ª©ng v√† t·∫∑ng qu√† l√† nh·ªØng qu·∫£ tr·ª©ng t√¥ m√†u.<br><br>
                    ·ªû Nga, L·ªÖ Ph·ª•c sinh l√† m·ªôt trong nh·ªØng ng√†y l·ªÖ quan tr·ªçng nh·∫•t. M·ªçi ng∆∞·ªùi ƒÉn m·ª´ng b·∫±ng b·ªØa s√°ng ho·∫∑c b·ªØa ƒÉn Ph·ª•c sinh. H·ªç c≈©ng t·∫°o ra nh·ªØng qu·∫£ tr·ª©ng Ph·ª•c sinh r·∫•t ƒë·∫πp.
                </div>
                <div class="glossary-box">
                    <div class="glossary-title">üìñ Glossary (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</div>
                    <table class="glossary-table">
                        <tr><td><span class="glossary-word">Resurrection</span> <span class="glossary-type">(n)</span></td><td>S·ª± ph·ª•c sinh</td></tr>
                        <tr><td><span class="glossary-word">Varies</span> <span class="glossary-type">(v)</span></td><td>Thay ƒë·ªïi, bi·∫øn ƒë·ªïi</td></tr>
                        <tr><td><span class="glossary-word">Fixed</span> <span class="glossary-type">(adj)</span></td><td>C·ªë ƒë·ªãnh</td></tr>
                        <tr><td><span class="glossary-word">Celebrate</span> <span class="glossary-type">(v)</span></td><td>ƒÇn m·ª´ng, k·ª∑ ni·ªám</td></tr>
                        <tr><td><span class="glossary-word">National holiday</span> <span class="glossary-type">(n)</span></td><td>Ng√†y l·ªÖ qu·ªëc gia</td></tr>
                    </table>
                </div>
            `,
            questions: [
                {
                    q: "1. What is the passage mainly about?",
                    options: ["A. The history and meaning of Easter.", "B. The way Easter is celebrated worldwide.", "C. The reason why Easter is important.", "D. The different types of Easter eggs."],
                    correct: 1, // B (Index start 0)
                    explain: `
                        <strong>Ph√¢n t√≠ch:</strong>
                        <ul>
                            <li>ƒêo·∫°n 1 n√≥i chung v·ªÅ Easter.</li>
                            <li>ƒêo·∫°n 2 n√≥i v·ªÅ UK v√† US.</li>
                            <li>ƒêo·∫°n 3 n√≥i v·ªÅ Russia.</li>
                        </ul>
                        => B√†i vi·∫øt li·ªát k√™ c√°ch ƒÉn m·ª´ng ·ªü c√°c n∆∞·ªõc kh√°c nhau. <br>
                        <strong>Ch·ªçn B.</strong> (C√°ch l·ªÖ Ph·ª•c sinh ƒë∆∞·ª£c t·ªï ch·ª©c tr√™n to√†n th·∫ø gi·ªõi).
                    `
                },
                {
                    q: "2. Which of the following is NOT true about Easter?",
                    options: ["A. Christian festival.", "B. Celebrated on same date every year.", "C. UK people give chocolate eggs.", "D. Egg hunts for children."],
                    correct: 1,
                    explain: `
                        <strong>D·∫´n ch·ª©ng:</strong> "Easter is not a fixed holiday." (L·ªÖ Ph·ª•c sinh kh√¥ng ph·∫£i ng√†y l·ªÖ c·ªë ƒë·ªãnh).<br>
                        <strong>Ch·ªçn B</strong> (ƒê∆∞·ª£c t·ªï ch·ª©c v√†o c√πng m·ªôt ng√†y h√†ng nƒÉm) l√† SAI.
                    `
                },
                {
                    q: "3. What does the word ‚Äúvaries‚Äù mean?",
                    options: ["A. stays the same", "B. changes over time", "C. happens once a year", "D. is celebrated early"],
                    correct: 1,
                    explain: `
                        <strong>T·ª´ v·ª±ng:</strong> Varies = Change (Thay ƒë·ªïi/Bi·∫øn thi√™n).<br>
                        "Its date varies between..." (Ng√†y thay ƒë·ªïi trong kho·∫£ng...).<br>
                        <strong>Ch·ªçn B.</strong>
                    `
                },
                {
                    q: "4. What is the opposite of ‚Äúbeautiful‚Äù?",
                    options: ["A. ugly", "B. colourful", "C. lovely", "D. pretty"],
                    correct: 0,
                    explain: `
                        Beautiful (ƒê·∫πp) >< Ugly (X·∫•u x√≠).<br>
                        C√°c t·ª´ c√≤n l·∫°i: Colorful (s·∫∑c s·ª°), Lovely (ƒë√°ng y√™u), Pretty (xinh) ƒë·ªÅu mang nghƒ©a t√≠ch c·ª±c.
                    `
                },
                {
                    q: "5. How do people in Russia celebrate Easter?",
                    options: ["A. Organize egg hunts.", "B. Give chocolate eggs.", "C. Prepare a special Easter meal.", "D. Go to church."],
                    correct: 2,
                    explain: `
                        <strong>D·∫´n ch·ª©ng (ƒêo·∫°n cu·ªëi):</strong> "People celebrate it with an Easter breakfast or meal."<br>
                        <strong>Ch·ªçn C.</strong>
                    `
                },
                {
                    q: "6. What do people in the US do?",
                    options: ["A. Decorate houses.", "B. Give gifts of coloured eggs.", "C. Street parade.", "D. Homemade chocolate eggs."],
                    correct: 1,
                    explain: `
                        <strong>D·∫´n ch·ª©ng (ƒêo·∫°n 2):</strong> "They also organise egg-hunts and give gifts of coloured eggs."<br>
                        <strong>Ch·ªçn B.</strong>
                    `
                }
            ]
        },
        {
            id: "driving",
            topic: "Safe Driving",
            theme: {
                primary: "#4834d4", // Deep Blue
                secondary: "#eb4d4b", // Red
                accent: "#f0932b",
                bgEmojis: ["üöó", "üö¶", "üõë", "üëÆ"]
            },
            content: `
                <div class="reading-title">Topic: Driving Safety</div>
                <div class="reading-content">
                    <p>Who are the best drivers? Which drivers are the safest on the roads? According to a recent survey, young and inexperienced drivers are the most likely to have an accident. Older drivers are more careful. Young men have the worst accident records of all. They often choose faster cars with bigger engines.</p>
                    <p>One of the most interesting facts in the survey is that passengers have an effect on the driver. When young male drivers have their friends in the car, their driving becomes worse. When their wife or girlfriend is in the car, however, their driving is better.</p>
                    <p>But this is not true for women. Their driving is more dangerous when their husband or boyfriend is in the car. However, if their small children are in the car, they drive more slowly and safely.</p>
                </div>
                <button class="btn-translate" onclick="toggleTrans('trans-drive')">üáªüá≥ B·∫•m ƒë·ªÉ xem b·∫£n d·ªãch</button>
                <div id="trans-drive" class="translation-box">
                    <strong>B·∫£n d·ªãch:</strong><br>
                    Ai l√† nh·ªØng ng∆∞·ªùi l√°i xe gi·ªèi nh·∫•t? Theo m·ªôt kh·∫£o s√°t g·∫ßn ƒë√¢y, nh·ªØng ng∆∞·ªùi l√°i xe tr·∫ª v√† thi·∫øu kinh nghi·ªám c√≥ kh·∫£ nƒÉng g·∫∑p tai n·∫°n cao nh·∫•t. Ng∆∞·ªùi l√°i xe l·ªõn tu·ªïi c·∫©n th·∫≠n h∆°n. Nam thanh ni√™n c√≥ h·ªì s∆° tai n·∫°n t·ªìi t·ªá nh·∫•t. H·ªç th∆∞·ªùng ch·ªçn xe nhanh h∆°n v·ªõi ƒë·ªông c∆° l·ªõn h∆°n.<br><br>
                    M·ªôt trong nh·ªØng s·ª± th·∫≠t th√∫ v·ªã nh·∫•t l√† h√†nh kh√°ch c√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn ng∆∞·ªùi l√°i. Khi nam thanh ni√™n ch·ªü b·∫°n b√®, h·ªç l√°i xe t·ªá h∆°n. Tuy nhi√™n, khi c√≥ v·ª£ ho·∫∑c b·∫°n g√°i, h·ªç l√°i t·ªët h∆°n.<br><br>
                    Nh∆∞ng ƒëi·ªÅu n√†y kh√¥ng ƒë√∫ng v·ªõi ph·ª• n·ªØ. H·ªç l√°i nguy hi·ªÉm h∆°n khi c√≥ ch·ªìng/b·∫°n trai ƒëi c√πng. Tuy nhi√™n, n·∫øu c√≥ con nh·ªè tr√™n xe, h·ªç l√°i ch·∫≠m v√† an to√†n h∆°n.
                </div>
                <div class="glossary-box">
                    <div class="glossary-title">üìñ Glossary (T·ª´ v·ª±ng h·ªçc thu·∫≠t)</div>
                    <table class="glossary-table">
                        <tr><td><span class="glossary-word">Inexperienced</span> <span class="glossary-type">(adj)</span></td><td>Thi·∫øu kinh nghi·ªám</td></tr>
                        <tr><td><span class="glossary-word">Survey</span> <span class="glossary-type">(n)</span></td><td>Cu·ªôc kh·∫£o s√°t</td></tr>
                        <tr><td><span class="glossary-word">Passenger</span> <span class="glossary-type">(n)</span></td><td>H√†nh kh√°ch</td></tr>
                        <tr><td><span class="glossary-word">Records</span> <span class="glossary-type">(n)</span></td><td>H·ªì s∆°/Ghi ch√©p</td></tr>
                    </table>
                </div>
            `,
            questions: [
                {
                    q: "1. What is the main idea of the passage?",
                    options: ["A. How different factors affect driving safety.", "B. Types of cars young people drive.", "C. Why accidents happen in cities.", "D. How to improve driving."],
                    correct: 0,
                    explain: `
                        <strong>Ph√¢n t√≠ch:</strong> B√†i vi·∫øt n√≥i v·ªÅ tu·ªïi t√°c (gi·ªõi tr·∫ª vs ng∆∞·ªùi gi√†), gi·ªõi t√≠nh (nam vs n·ªØ), v√† ng∆∞·ªùi ƒëi c√πng (h√†nh kh√°ch) ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác l√°i xe.<br>
                        <strong>Ch·ªçn A</strong> (C√°c y·∫øu t·ªë kh√°c nhau ·∫£nh h∆∞·ªüng ƒë·∫øn an to√†n l√°i xe).
                    `
                },
                {
                    q: "2. Which is NOT mentioned?",
                    options: ["A. Young drivers have more accidents.", "B. Women drive carefully with children.", "C. Young men always follow traffic rules.", "D. Older drivers are careful."],
                    correct: 2,
                    explain: `
                        <strong>D·∫´n ch·ª©ng:</strong> "Young men have the worst accident records of all." -> H·ªç c√≥ h·ªì s∆° tai n·∫°n t·ªá nh·∫•t, nghƒ©a l√† h·ªç KH√îNG tu√¢n th·ªß lu·∫≠t l·ªá.<br>
                        <strong>Ch·ªçn C</strong> l√† SAI.
                    `
                },
                {
                    q: "3. 'Choose' is closest in meaning to:",
                    options: ["A. select", "B. refuse", "C. change", "D. follow"],
                    correct: 0,
                    explain: "Choose = Select (L·ª±a ch·ªçn)."
                },
                {
                    q: "4. Opposite of 'dangerous':",
                    options: ["A. fast", "B. safe", "C. bad", "D. strict"],
                    correct: 1,
                    explain: "Dangerous (Nguy hi·ªÉm) >< Safe (An to√†n)."
                },
                {
                    q: "5. Why do young male drivers have more accidents?",
                    options: ["A. Drive bigger/faster cars.", "B. No time to practice.", "C. Drive slowly.", "D. Drive alone."],
                    correct: 0,
                    explain: "D·∫´n ch·ª©ng: 'They often choose faster cars with bigger engines.'"
                },
                {
                    q: "6. How do passengers affect male drivers?",
                    options: ["A. Better with friends.", "B. More dangerously with friends.", "C. Faster with parents.", "D. Carelessly when alone."],
                    correct: 1,
                    explain: `
                        <strong>D·∫´n ch·ª©ng:</strong> "When young male drivers have their friends in the car, their driving becomes worse." (T·ªá h∆°n = nguy hi·ªÉm h∆°n).<br>
                        <strong>Ch·ªçn B.</strong>
                    `
                }
            ]
        }
    ];

    // --- LOGIC ---
    let currentPassageIndex = 0;
    let scores = [0, 0]; // Score for part 1, part 2
    let answersStatus = [[], []]; // Track if answered

    // Initialize
    function init() {
        startTimer();
        switchPassage(0);
    }

    // Switch Tab
    function switchPassage(index) {
        currentPassageIndex = index;
        const data = db[index];
        
        // Update Tabs UI
        document.querySelectorAll('.tab-btn').forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });

        // Set Theme CSS Variables
        const r = document.querySelector(':root');
        r.style.setProperty('--primary', data.theme.primary);
        r.style.setProperty('--secondary', data.theme.secondary);
        r.style.setProperty('--accent', data.theme.accent);
        
        // Generate SVG Background
        const svgString = generateSVG(data.theme.bgEmojis, data.theme.primary);
        r.style.setProperty('--bg-pattern', `url('${svgString}'), radial-gradient(circle, #ffffff 0%, ${data.theme.secondary}22 100%)`);

        // Render Content
        document.getElementById('readingPanel').innerHTML = data.content;
        
        // Render Questions
        renderQuestions(index);
    }

    // Generate Dynamic SVG Background
    function generateSVG(emojis, color) {
        let svgContent = '';
        for(let i=0; i<6; i++) {
            const x = Math.random() * 100;
            const y = Math.random() * 100;
            const emoji = emojis[Math.floor(Math.random() * emojis.length)];
            svgContent += `<text x='${x}%' y='${y}%' font-size='40' opacity='0.15'>${emoji}</text>`;
        }
        const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%'>${svgContent}</svg>`;
        return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
    }

    // Render Questions
    function renderQuestions(pIndex) {
        const container = document.getElementById('exercisePanel');
        const qData = db[pIndex].questions;
        let html = '';

        qData.forEach((item, qIndex) => {
            let optionsHtml = '';
            item.options.forEach((opt, oIndex) => {
                optionsHtml += `<button class="option-btn" id="btn_${pIndex}_${qIndex}_${oIndex}" onclick="checkAnswer(${pIndex}, ${qIndex}, ${oIndex})">${opt}</button>`;
            });

            html += `
                <div class="question-card" id="card_${pIndex}_${qIndex}">
                    <div class="question-text">${item.q}</div>
                    <div class="options-grid">
                        ${optionsHtml}
                    </div>
                    <div class="explanation" id="exp_${pIndex}_${qIndex}">
                        <div class="exp-header">
                            <div class="exp-avatar">üë©‚Äçüè´</div>
                            <div>Ms Mai An gi·∫£i th√≠ch:</div>
                        </div>
                        <div class="exp-content">${item.explain}</div>
                    </div>
                </div>
            `;
        });
        
        // Add Submit Button at bottom
        html += `<div class="submit-section"><button class="btn-submit" onclick="finishTest()">N·ªòP B√ÄI & XEM ƒêI·ªÇM</button></div>`;

        container.innerHTML = html;
    }

    // Audio Context for Sounds
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Confetti Effect
    function fireConfetti(x, y) {
        // Simple canvas confetti logic placeholder
        // For single file simplicity, we'll just trigger the main confetti on finish
    }

    // Check Answer
    function checkAnswer(pIndex, qIndex, oIndex) {
        // Prevent re-answering
        if (answersStatus[pIndex][qIndex]) return;
        
        const correctIndex = db[pIndex].questions[qIndex].correct;
        const btn = document.getElementById(`btn_${pIndex}_${qIndex}_${oIndex}`);
        const correctBtn = document.getElementById(`btn_${pIndex}_${qIndex}_${correctIndex}`);
        const exp = document.getElementById(`exp_${pIndex}_${qIndex}`);

        answersStatus[pIndex][qIndex] = true; // Mark as answered

        if (oIndex === correctIndex) {
            // Correct
            btn.classList.add('correct');
            playSound('correct');
            scores[pIndex]++;
            fireConfetti();
        } else {
            // Wrong
            btn.classList.add('wrong');
            correctBtn.classList.add('correct');
            playSound('wrong');
        }

        // Disable all buttons in this question
        const allBtns = document.querySelectorAll(`#card_${pIndex}_${qIndex} .option-btn`);
        allBtns.forEach(b => b.classList.add('disabled'));

        // Show explanation
        exp.classList.add('show');
    }

    // Timer Logic
    let time = 600; // 10 minutes
    let timerInterval;
    let isPaused = false;

    function startTimer() {
        timerInterval = setInterval(() => {
            if(!isPaused) {
                time--;
                const m = Math.floor(time / 60);
                const s = time % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if (time <= 0) {
                    clearInterval(timerInterval);
                    alert("ƒê√£ h·∫øt gi·ªù l√†m b√†i! H√£y n·ªôp b√†i nh√©.");
                }
            }
        }, 1000);
    }

    function toggleTimer() {
        isPaused = !isPaused;
        document.getElementById('btnPause').innerText = isPaused ? "‚ñ∂" : "‚è∏";
    }

    function toggleTrans(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    // Finish & Calculate
    function finishTest() {
        const totalScore = scores[0] + scores[1];
        const maxScore = db[0].questions.length + db[1].questions.length;
        
        document.getElementById('finalScore').innerText = `${totalScore}/${maxScore}`;
        
        let msg = "";
        const percentage = totalScore / maxScore;
        if (percentage === 1) msg = "OMG! THI√äN T√ÄI! üèÜ Xu·∫•t s·∫Øc qu√° con ∆°i!";
        else if (percentage >= 0.8) msg = "Gi·ªèi l·∫Øm! L√†m r·∫•t t·ªët! üåü";
        else if (percentage >= 0.5) msg = "Kh√° t·ªët, nh∆∞ng c·∫ßn c·ªë g·∫Øng th√™m x√≠u nha! üí™";
        else msg = "C·∫ßn √¥n t·∫≠p l·∫°i t·ª´ v·ª±ng nh√©! C√¥ tin con l√†m ƒë∆∞·ª£c! ‚ù§Ô∏è";
        
        document.getElementById('finalFeedback').innerText = msg;
        document.getElementById('resultModal').style.display = 'flex';
        
        playSound('correct');
        startConfetti();
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
    }

    // Lightweight Confetti Implementation
    function startConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const pieces = [];
        for(let i=0; i<100; i++) {
            pieces.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random()*360}, 100%, 50%)`,
                size: Math.random() * 10 + 5,
                speed: Math.random() * 5 + 2
            });
        }

        function draw() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            pieces.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                p.y += p.speed;
                if(p.y > canvas.height) p.y = -20;
            });
            requestAnimationFrame(draw);
        }
        draw();
        setTimeout(() => ctx.clearRect(0,0,canvas.width,canvas.height), 5000); // Stop after 5s
    }

    // Start
    window.onload = init;

</script>

</body>
</html>
