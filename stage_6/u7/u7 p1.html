<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√†i Ki·ªÉm Tra Li√™n T·ª´ Th·ªùi Gian - Ms Mai An ULIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #8854C0;
            --primary-teal: #00C9A7;
            --correct-green: #00D26A;
            --wrong-red: #FF4757;
            --bg-color: #f0f3f5;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #e9e9e9;
            background-image: radial-gradient(#d1d1d1 15%, transparent 16%), radial-gradient(#d1d1d1 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            color: var(--text-color);
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            position: relative;
            overflow: hidden;
            border: 4px solid var(--primary-pink);
        }

        h1 {
            text-align: center;
            font-family: 'Quicksand', sans-serif;
            color: var(--primary-pink);
            font-size: 1.5rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0px #eee;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        /* Quiz Interface */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .question-number {
            font-weight: 800;
            color: var(--primary-teal);
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: #555;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 0 #e0e0e0;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            transform: scale(1.02);
            border-color: var(--primary-teal);
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* States */
        .option-btn.correct {
            background-color: var(--correct-green);
            color: white;
            border-color: #00b359;
            box-shadow: 0 4px 0 #00b359;
            animation: pulse 0.5s;
        }

        .option-btn.wrong {
            background-color: var(--wrong-red);
            color: white;
            border-color: #d63030;
            box-shadow: 0 4px 0 #d63030;
            animation: shake 0.5s;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Explanation Box */
        .explanation-box {
            margin-top: 15px;
            background: #f0f9ff;
            border: 2px solid #b3e0ff;
            border-radius: 15px;
            padding: 20px;
            display: none; /* Hidden by default */
            animation: slideDown 0.4s ease-out;
        }

        .explanation-box.show {
            display: block;
        }

        .exp-title {
            font-weight: 800;
            color: var(--primary-pink);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exp-content p {
            margin: 5px 0;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .exp-step {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #ccc;
        }

        .exp-step:last-child {
            border-bottom: none;
        }

        .exp-label {
            font-weight: 700;
            color: var(--primary-teal);
            display: block;
            margin-bottom: 3px;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .submit-btn {
            background: var(--primary-pink);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 800;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 6px 0 #6a3da1;
            transition: all 0.2s;
            font-family: 'Quicksand', sans-serif;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #6a3da1;
        }

        .submit-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #6a3da1;
        }

        /* Result Popup */
        #result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .result-card {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .score-display {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-teal);
            margin: 20px 0;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="container">
        <h1>B√†i Test: Li√™n T·ª´ Ch·ªâ Th·ªùi Gian</h1>
        <div class="subtitle">Gi√°o vi√™n t·∫°o: Ms Mai An ULIS</div>
        <hr style="border: 0; border-top: 2px dashed #ddd; margin-bottom: 20px;">

        <div id="quiz-container">
            </div>

        <div class="controls">
            <button class="submit-btn" onclick="submitQuiz()">N·ªôp B√†i & Xem ƒêi·ªÉm</button>
        </div>
    </div>

    <div id="result-overlay">
        <div class="result-card">
            <h2 style="color: var(--primary-pink);">K·∫æT QU·∫¢ C·ª¶A CON</h2>
            <div class="score-display" id="final-score">0/30</div>
            <p id="feedback-msg" style="font-size: 1.1rem; line-height: 1.4; color: #555;">...</p>
            <button class="submit-btn" onclick="location.reload()" style="margin-top: 20px; font-size: 1rem; padding: 10px 30px;">L√†m l·∫°i</button>
        </div>
    </div>

<script>
    // DATA SOURCE
    const questionData = [
        // --- DEFINITIONS & MEANING (1-5) ---
        {
            question: "T·ª´ n·ªëi n√†o di·ªÖn t·∫£ hai h√†nh ƒë·ªông x·∫£y ra <b>c√πng m·ªôt l√∫c</b>?",
            options: ["A. While", "B. After", "C. Before", "D. Until"],
            correct: 0,
            explanation: {
                translate: "T·ª´ n·ªëi n√†o di·ªÖn t·∫£ hai h√†nh ƒë·ªông x·∫£y ra c√πng m·ªôt l√∫c?",
                vocab: [
                    "A. While (Trong khi)",
                    "B. After (Sau khi)",
                    "C. Before (Tr∆∞·ªõc khi)",
                    "D. Until (Cho ƒë·∫øn khi)"
                ],
                whyRight: "<b>While</b> d√πng ƒë·ªÉ di·ªÖn t·∫£ h√†nh ƒë·ªông ƒëang x·∫£y ra song song (At the same time).",
                whyWrong: "C√°c t·ª´ c√≤n l·∫°i ch·ªâ tr√¨nh t·ª± tr∆∞·ªõc sau ho·∫∑c ƒëi·ªÉm d·ª´ng, kh√¥ng ch·ªâ s·ª± song song."
            }
        },
        {
            question: "T·ª´ n√†o mang nghƒ©a 'Ngay khi', d√πng cho t√¨nh hu·ªëng kh·∫©n c·∫•p ho·∫∑c ph·∫£n x·∫° nhanh?",
            options: ["A. Until", "B. As soon as", "C. While", "D. Before"],
            correct: 1,
            explanation: {
                translate: "T·ª´ n√†o mang nghƒ©a 'Ngay khi'...",
                vocab: [
                    "A. Until (Cho ƒë·∫øn khi)",
                    "B. As soon as (Ngay khi - Ngay l·∫≠p t·ª©c)",
                    "C. While (Trong khi)",
                    "D. Before (Tr∆∞·ªõc khi)"
                ],
                whyRight: "<b>As soon as</b> nh·∫•n m·∫°nh s·ª± t·ª©c th√¨ (Immediately), th∆∞·ªùng d√πng cho c·∫£nh b√°o ho·∫∑c ph·∫£n x·∫°.",
                whyWrong: "Until ch·ªâ gi·ªõi h·∫°n th·ªùi gian. While ch·ªâ s·ª± k√©o d√†i. Before ch·ªâ th·ª© t·ª±."
            }
        },
        {
            question: "T·ª´ n√†o di·ªÖn t·∫£ m·ªôt h√†nh ƒë·ªông k√©o d√†i m√£i v√† d·ª´ng l·∫°i t·∫°i m·ªôt th·ªùi ƒëi·ªÉm c·ª• th·ªÉ (ƒêi·ªÉm d·ª´ng)?",
            options: ["A. As soon as", "B. While", "C. Until", "D. After"],
            correct: 2,
            explanation: {
                translate: "T·ª´ n√†o di·ªÖn t·∫£ m·ªôt h√†nh ƒë·ªông k√©o d√†i m√£i v√† d·ª´ng l·∫°i...",
                vocab: [
                    "A. As soon as (Ngay khi)",
                    "B. While (Trong khi)",
                    "C. Until (Cho ƒë·∫øn khi)",
                    "D. After (Sau khi)"
                ],
                whyRight: "<b>Until</b> ƒë·∫∑t ra gi·ªõi h·∫°n th·ªùi gian (deadline) cho m·ªôt h√†nh ƒë·ªông.",
                whyWrong: "C√°c t·ª´ kh√°c kh√¥ng mang √Ω nghƒ©a 'gi·ªõi h·∫°n ƒëi·ªÉm d·ª´ng'."
            }
        },
        {
            question: "C·∫∑p t·ª´ n√†o d√πng ƒë·ªÉ s·∫Øp x·∫øp th·ª© t·ª± <b>Tr∆∞·ªõc - Sau</b> c·ªßa c√°c s·ª± vi·ªác?",
            options: ["A. While & When", "B. Before & After", "C. Until & As soon as", "D. While & After"],
            correct: 1,
            explanation: {
                translate: "C·∫∑p t·ª´ n√†o d√πng ƒë·ªÉ s·∫Øp x·∫øp th·ª© t·ª± Tr∆∞·ªõc - Sau?",
                vocab: [
                    "A. Trong khi & Khi",
                    "B. Tr∆∞·ªõc khi & Sau khi",
                    "C. Cho ƒë·∫øn khi & Ngay khi",
                    "D. Trong khi & Sau khi"
                ],
                whyRight: "<b>Before (Tr∆∞·ªõc)</b> v√† <b>After (Sau)</b> l√† c·∫∑p b√†i tr√πng ƒë·ªÉ ƒë·ªãnh v·ªã th·ªùi gian.",
                whyWrong: "C√°c c·∫∑p kh√°c kh√¥ng ƒë·ªëi l·∫≠p v·ªÅ th·ª© t·ª± th·ªùi gian r√µ r√†ng nh∆∞ Before/After."
            }
        },
        {
            question: "Ch·ªçn nghƒ©a ƒë√∫ng cho t·ª´: <b>Earthquake</b>",
            options: ["A. B√£o l≈©", "B. ƒê·ªông ƒë·∫•t", "C. S√≥ng th·∫ßn", "D. N√∫i l·ª≠a"],
            correct: 1,
            explanation: {
                translate: "Ch·ªçn nghƒ©a ƒë√∫ng cho t·ª´ Earthquake.",
                vocab: [
                    "A. Flood/Storm",
                    "B. Earthquake",
                    "C. Tsunami",
                    "D. Volcano"
                ],
                whyRight: "Trong b√†i h·ªçc, <b>Earthquake</b> ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn v·ªõi v√≠ d·ª• 'Don‚Äôt move... while the earthquake is happening'.",
                whyWrong: "ƒê√¢y l√† c√¢u ki·ªÉm tra t·ª´ v·ª±ng c∆° b·∫£n trong ch·ªß ƒë·ªÅ thi√™n tai."
            }
        },
        // --- USAGE & GAP FILL (6-20) ---
        {
            question: "Don‚Äôt move from where you are ______ the earthquake is happening.",
            options: ["A. before", "B. as soon as", "C. while", "D. until"],
            correct: 2,
            explanation: {
                translate: "ƒê·ª´ng di chuy·ªÉn kh·ªèi ch·ªó c·ªßa b·∫°n trong khi tr·∫≠n ƒë·ªông ƒë·∫•t ƒëang x·∫£y ra.",
                vocab: [
                    "A. before (li√™n t·ª´): tr∆∞·ªõc khi",
                    "B. as soon as (li√™n t·ª´): ngay khi",
                    "C. while (li√™n t·ª´): trong khi",
                    "D. until (li√™n t·ª´): cho ƒë·∫øn khi"
                ],
                whyRight: "D√πng <b>While</b> v√¨ h√†nh ƒë·ªông 'ƒë·ªông ƒë·∫•t x·∫£y ra' (is happening) ƒëang di·ªÖn ra k√©o d√†i. Ta kh√¥ng n√™n di chuy·ªÉn TRONG SU·ªêT qu√° tr√¨nh ƒë√≥.",
                whyWrong: "As soon as/Before kh√¥ng h·ª£p l√Ω v·ªÅ l·ªùi khuy√™n an to√†n. Until sai nghƒ©a (kh√¥ng ai n√≥i 'ƒë·ª´ng di chuy·ªÉn cho ƒë·∫øn khi ƒë·ªông ƒë·∫•t ƒëang x·∫£y ra')."
            }
        },
        {
            question: "______ the shaking starts, get down on your hands and knees.",
            options: ["A. While", "B. As soon as", "C. Until", "D. After"],
            correct: 1,
            explanation: {
                translate: "Ngay khi s·ª± rung l·∫Øc b·∫Øt ƒë·∫ßu, h√£y qu·ª≥ xu·ªëng b·∫±ng tay v√† ƒë·∫ßu g·ªëi.",
                vocab: [
                    "A. While (Trong khi)",
                    "B. As soon as (Ngay khi)",
                    "C. Until (Cho ƒë·∫øn khi)",
                    "D. After (Sau khi)"
                ],
                whyRight: "ƒê√¢y l√† ph·∫£n x·∫° kh·∫©n c·∫•p. V·ª´a th·∫•y rung l·∫Øc l√† ph·∫£i qu·ª≥ ngay -> D√πng <b>As soon as</b>.",
                whyWrong: "While sai v√¨ 'starts' l√† h√†nh ƒë·ªông t·ª©c th·ªùi. Until/After qu√° ch·∫≠m tr·ªÖ cho t√¨nh hu·ªëng nguy hi·ªÉm."
            }
        },
        {
            question: "Stay inside ______ the shaking stops.",
            options: ["A. as soon as", "B. before", "C. while", "D. until"],
            correct: 3,
            explanation: {
                translate: "H√£y ·ªü y√™n trong nh√† cho ƒë·∫øn khi s·ª± rung l·∫Øc d·ª´ng l·∫°i.",
                vocab: [
                    "A. ngay khi",
                    "B. tr∆∞·ªõc khi",
                    "C. trong khi",
                    "D. cho ƒë·∫øn khi"
                ],
                whyRight: "<b>Until</b> ƒë·∫∑t ra ƒëi·ªÉm d·ª´ng. B·∫°n ·ªü trong nh√† m√£i, v√† ch·ªâ ƒë∆∞·ª£c ra ngo√†i KHI (cho ƒë·∫øn khi) n√≥ d·ª´ng.",
                whyWrong: "Stay inside while the shaking stops (·ªû trong nh√† trong khi rung l·∫Øc d·ª´ng) -> Sai logic v√¨ 'stops' l√† kho·∫£nh kh·∫Øc, kh√¥ng k√©o d√†i."
            }
        },
        {
            question: "Make sure you know what to do ______ an earthquake happens.",
            options: ["A. before", "B. while", "C. until", "D. as soon as"],
            correct: 0,
            explanation: {
                translate: "H√£y ch·∫Øc ch·∫Øn b·∫°n bi·∫øt ph·∫£i l√†m g√¨ tr∆∞·ªõc khi m·ªôt tr·∫≠n ƒë·ªông ƒë·∫•t x·∫£y ra.",
                vocab: [
                    "A. before (tr∆∞·ªõc khi)",
                    "B. while (trong khi)",
                    "C. until (cho ƒë·∫øn khi)",
                    "D. as soon as (ngay khi)"
                ],
                whyRight: "Vi·ªác chu·∫©n b·ªã ki·∫øn th·ª©c c·∫ßn ph·∫£i l√†m <b>Before</b> (tr∆∞·ªõc) khi s·ª± vi·ªác x·∫£y ra.",
                whyWrong: "L√∫c ƒë·ªông ƒë·∫•t ƒëang x·∫£y ra (While) m·ªõi t√¨m hi·ªÉu th√¨ ƒë√£ qu√° mu·ªôn."
            }
        },
        {
            question: "______ an earthquake happens, there is usually a lot of damage.",
            options: ["A. Before", "B. Until", "C. After", "D. While"],
            correct: 2,
            explanation: {
                translate: "Sau khi tr·∫≠n ƒë·ªông ƒë·∫•t x·∫£y ra, th∆∞·ªùng c√≥ r·∫•t nhi·ªÅu thi·ªát h·∫°i.",
                vocab: [
                    "A. Tr∆∞·ªõc khi",
                    "B. Cho ƒë·∫øn khi",
                    "C. Sau khi",
                    "D. Trong khi"
                ],
                whyRight: "Thi·ªát h·∫°i (damage) l√† k·∫øt qu·∫£ ƒë·ªÉ l·∫°i <b>After</b> (sau) thi√™n tai.",
                whyWrong: "Before (tr∆∞·ªõc khi) th√¨ ch∆∞a c√≥ thi·ªát h·∫°i. While (trong khi) th√¨ thi·ªát h·∫°i ƒëang h√¨nh th√†nh, nh∆∞ng c√¢u vƒÉn n√≥i v·ªÅ h·∫≠u qu·∫£ chung."
            }
        },
        {
            question: "I often listen to music ______ I am doing my homework.",
            options: ["A. as soon as", "B. until", "C. before", "D. while"],
            correct: 3,
            explanation: {
                translate: "T√¥i th∆∞·ªùng nghe nh·∫°c trong khi t√¥i ƒëang l√†m b√†i t·∫≠p v·ªÅ nh√†.",
                vocab: [
                    "A. ngay khi",
                    "B. cho ƒë·∫øn khi",
                    "C. tr∆∞·ªõc khi",
                    "D. trong khi"
                ],
                whyRight: "Hai h√†nh ƒë·ªông 'nghe nh·∫°c' v√† 'l√†m b√†i' di·ªÖn ra song song c√πng l√∫c -> D√πng <b>While</b>.",
                whyWrong: "As soon as/Before kh√¥ng di·ªÖn t·∫£ ƒë∆∞·ª£c t√≠nh ch·∫•t 'v·ª´a l√†m c√°i n√†y v·ª´a l√†m c√°i kia'."
            }
        },
        {
            question: "We will wait here ______ the rain stops.",
            options: ["A. until", "B. while", "C. as soon as", "D. before"],
            correct: 0,
            explanation: {
                translate: "Ch√∫ng t√¥i s·∫Ω ƒë·ª£i ·ªü ƒë√¢y cho ƒë·∫øn khi m∆∞a t·∫°nh.",
                vocab: [
                    "A. until (cho ƒë·∫øn khi)",
                    "B. while (trong khi)",
                    "C. as soon as (ngay khi)",
                    "D. before (tr∆∞·ªõc khi)"
                ],
                whyRight: "H√†nh ƒë·ªông 'ƒë·ª£i' s·∫Ω k√©o d√†i v√† k·∫øt th√∫c t·∫°i th·ªùi ƒëi·ªÉm m∆∞a t·∫°nh -> D√πng <b>Until</b>.",
                whyWrong: "While sai ng·ªØ c·∫£nh. As soon as c√≥ th·ªÉ ƒë√∫ng ng·ªØ ph√°p nh∆∞ng 'Wait... until' (ƒê·ª£i ƒë·∫øn khi) l√† c·∫•u tr√∫c t·ª± nhi√™n h∆°n ƒë·ªÉ ch·ªâ s·ª± ch·ªù ƒë·ª£i."
            }
        },
        {
            question: "Please call me ______ you arrive at the station.",
            options: ["A. while", "B. until", "C. as soon as", "D. before"],
            correct: 2,
            explanation: {
                translate: "L√†m ∆°n h√£y g·ªçi cho t√¥i ngay khi b·∫°n ƒë·∫øn nh√† ga.",
                vocab: [
                    "A. trong khi",
                    "B. cho ƒë·∫øn khi",
                    "C. ngay khi",
                    "D. tr∆∞·ªõc khi (c√≥ th·ªÉ, nh∆∞ng √≠t ph·ªï bi·∫øn h∆°n C)"
                ],
                whyRight: "<b>As soon as</b> (ngay khi) th·ªÉ hi·ªán t√≠nh t·ª©c th√¨, b√°o tin b√¨nh an.",
                whyWrong: "While sai v√¨ 'arrive' l√† h√†nh ƒë·ªông t·ª©c th·ªùi. Until sai nghƒ©a (g·ªçi cho ƒë·∫øn khi ƒë·∫øn? - nghƒ©a l√† g·ªçi li√™n t·ª•c tr√™n ƒë∆∞·ªùng ƒëi)."
            }
        },
        {
            question: "Brush your teeth ______ you go to bed.",
            options: ["A. after", "B. while", "C. until", "D. before"],
            correct: 3,
            explanation: {
                translate: "ƒê√°nh rƒÉng tr∆∞·ªõc khi b·∫°n ƒëi ng·ªß.",
                vocab: [
                    "A. sau khi",
                    "B. trong khi",
                    "C. cho ƒë·∫øn khi",
                    "D. tr∆∞·ªõc khi"
                ],
                whyRight: "Th√≥i quen v·ªá sinh h·ª£p l√Ω l√† ƒë√°nh rƒÉng <b>Before</b> (tr∆∞·ªõc khi) ng·ªß.",
                whyWrong: "ƒê√°nh rƒÉng sau khi ng·ªß (After) l√† v√¥ l√Ω. Trong khi ng·ªß (While) c≈©ng kh√¥ng th·ªÉ l√†m ƒë∆∞·ª£c."
            }
        },
        {
            question: "______ the teacher entered the class, everyone stood up.",
            options: ["A. While", "B. As soon as", "C. Until", "D. Before"],
            correct: 1,
            explanation: {
                translate: "Ngay khi gi√°o vi√™n b∆∞·ªõc v√†o l·ªõp, m·ªçi ng∆∞·ªùi ƒë·ªÅu ƒë·ª©ng d·∫≠y.",
                vocab: [
                    "A. Trong khi",
                    "B. Ngay khi",
                    "C. Cho ƒë·∫øn khi",
                    "D. Tr∆∞·ªõc khi"
                ],
                whyRight: "H√†nh ƒë·ªông ƒë·ª©ng d·∫≠y l√† ph·∫£n x·∫° t·ª©c th√¨ ƒë·ªÉ ch√†o h·ªèi -> D√πng <b>As soon as</b>.",
                whyWrong: "While d√πng cho h√†nh ƒë·ªông k√©o d√†i (gi√°o vi√™n ƒëang ƒëi v√†o t·ª´ t·ª´). Until sai nghƒ©a."
            }
        },
        // --- COMMA RULES & STRUCTURE (16-25) ---
        {
            question: "Ch·ªçn c√¢u vi·∫øt ƒê√öNG ch√≠nh t·∫£ v√† d·∫•u c√¢u:",
            options: [
                "A. While it is raining you should stay inside.",
                "B. While, it is raining you should stay inside.",
                "C. While it is raining, you should stay inside.",
                "D. While it is raining; you should stay inside."
            ],
            correct: 2,
            explanation: {
                translate: "Trong khi tr·ªùi ƒëang m∆∞a, b·∫°n n√™n ·ªü trong nh√†.",
                vocab: ["Ki·ªÉm tra quy t·∫Øc d·∫•u ph·∫©y v·ªõi t·ª´ n·ªëi ƒë·∫ßu c√¢u."],
                whyRight: "Quy t·∫Øc: Khi t·ª´ n·ªëi (While) ƒë·ª©ng ƒê·∫¶U c√¢u, ph·∫£i c√≥ d·∫•u ph·∫©y (,) ngƒÉn c√°ch hai v·∫ø: [While S+V], [S+V].",
                whyWrong: "A thi·∫øu d·∫•u ph·∫©y. B ƒë·∫∑t d·∫•u ph·∫©y sai ch·ªó. D d√πng d·∫•u ch·∫•m ph·∫©y sai."
            }
        },
        {
            question: "Ch·ªçn c√¢u vi·∫øt ƒê√öNG ch√≠nh t·∫£ v√† d·∫•u c√¢u:",
            options: [
                "A. You can go outside as soon as the storm stops.",
                "B. You can go outside, as soon as the storm stops.",
                "C. As soon as the storm stops you can go outside.",
                "D. You can go outside; as soon as the storm stops."
            ],
            correct: 0,
            explanation: {
                translate: "B·∫°n c√≥ th·ªÉ ra ngo√†i ngay khi c∆°n b√£o d·ª´ng l·∫°i.",
                vocab: ["Ki·ªÉm tra quy t·∫Øc d·∫•u ph·∫©y v·ªõi t·ª´ n·ªëi gi·ªØa c√¢u."],
                whyRight: "Quy t·∫Øc: Khi t·ª´ n·ªëi (as soon as) ƒë·ª©ng GI·ªÆA c√¢u, KH√îNG c·∫ßn d·∫•u ph·∫©y.",
                whyWrong: "B th·ª´a d·∫•u ph·∫©y (l·ªói ph·ªï bi·∫øn). C thi·∫øu d·∫•u ph·∫©y (v√¨ As soon as ƒë·ª©ng ƒë·∫ßu). D sai d·∫•u."
            }
        },
        {
            question: "______ the shaking stops, stay inside.",
            options: ["A. Until", "B. After", "C. Before", "D. While"],
            correct: 0,
            explanation: {
                translate: "Cho ƒë·∫øn khi rung l·∫Øc d·ª´ng l·∫°i, h√£y ·ªü trong nh√†.",
                vocab: ["A. Until", "B. After", "C. Before", "D. While"],
                whyRight: "C·∫•u tr√∫c ƒë·∫£o ng·ªØ ƒë·∫ßu c√¢u. Nghƒ©a ph√π h·ª£p nh·∫•t l√† ·ªü y√™n 'cho ƒë·∫øn l√∫c' n√≥ d·ª´ng. (Until).",
                whyWrong: "After (Sau khi rung l·∫Øc d·ª´ng th√¨ ·ªü trong nh√†? -> Sai, h·∫øt rung th√¨ ch·∫°y ra ch·ª©). While sai logic."
            }
        },
        {
            question: "You should wash your hands ______ eating.",
            options: ["A. while", "B. until", "C. before", "D. as soon as"],
            correct: 2,
            explanation: {
                translate: "B·∫°n n√™n r·ª≠a tay tr∆∞·ªõc khi ƒÉn.",
                vocab: ["A. trong khi", "B. cho ƒë·∫øn khi", "C. tr∆∞·ªõc khi", "D. ngay khi"],
                whyRight: "V·ªá sinh an to√†n: R·ª≠a tay <b>Before</b> (tr∆∞·ªõc khi) ƒÉn.",
                whyWrong: "V·ª´a ƒÉn v·ª´a r·ª≠a (While) l√† kh√¥ng th·ªÉ. R·ª≠a xong m·ªõi ƒë∆∞·ª£c ƒÉn n√™n Until/As soon as kh√¥ng h·ª£p ng·ªØ c·∫£nh t·ª± nhi√™n b·∫±ng Before."
            }
        },
        {
            question: "He fell asleep ______ he was watching TV.",
            options: ["A. until", "B. as soon as", "C. before", "D. while"],
            correct: 3,
            explanation: {
                translate: "Anh ·∫•y ng·ªß g·∫≠t trong khi ƒëang xem TV.",
                vocab: ["A. cho ƒë·∫øn khi", "B. ngay khi", "C. tr∆∞·ªõc khi", "D. trong khi"],
                whyRight: "H√†nh ƒë·ªông xem TV ƒëang di·ªÖn ra (was watching - qu√° kh·ª© ti·∫øp di·ªÖn) th√¨ ng·ªß g·∫≠t xen v√†o -> D√πng <b>While</b>.",
                whyWrong: "Until/Before kh√¥ng ƒëi v·ªõi th√¨ ti·∫øp di·ªÖn trong ng·ªØ c·∫£nh n√†y."
            }
        },
        // --- MIXED & ADVANCED LOGIC (21-30) ---
        {
            question: "She learnt to speak English ______ she was in London.",
            options: ["A. while", "B. until", "C. as soon as", "D. before"],
            correct: 0,
            explanation: {
                translate: "C√¥ ·∫•y h·ªçc n√≥i ti·∫øng Anh trong khi c√¥ ·∫•y ·ªü London.",
                vocab: ["A. trong khi", "B. cho ƒë·∫øn khi", "C. ngay khi", "D. tr∆∞·ªõc khi"],
                whyRight: "Qu√£ng th·ªùi gian ·ªü London l√† m·ªôt kho·∫£ng k√©o d√†i -> D√πng <b>While</b>.",
                whyWrong: "D√πng Before/Until kh√¥ng sai ng·ªØ ph√°p nh∆∞ng While l√† t·ª± nhi√™n nh·∫•t ƒë·ªÉ ch·ªâ b·ªëi c·∫£nh n·ªÅn."
            }
        },
        {
            question: "I will not leave ______ you tell me the truth.",
            options: ["A. while", "B. as soon as", "C. before", "D. until"],
            correct: 3,
            explanation: {
                translate: "T√¥i s·∫Ω kh√¥ng r·ªùi ƒëi cho ƒë·∫øn khi b·∫°n n√≥i cho t√¥i s·ª± th·∫≠t.",
                vocab: ["A. trong khi", "B. ngay khi", "C. tr∆∞·ªõc khi", "D. cho ƒë·∫øn khi"],
                whyRight: "ƒê·∫∑t ƒëi·ªÅu ki·ªán/gi·ªõi h·∫°n th·ªùi gian: T√¥i ·ªü l√¨ ƒë√¢y, ƒëi·ªÉm d·ª´ng l√† l√∫c b·∫°n n√≥i th·∫≠t -> D√πng <b>Until</b>.",
                whyWrong: "As soon as kh√¥ng h·ª£p v·ªõi 'will not leave'. Before sai nghƒ©a."
            }
        },
        {
            question: "The baby started crying ______ the mother left the room.",
            options: ["A. while", "B. as soon as", "C. until", "D. before"],
            correct: 1,
            explanation: {
                translate: "Em b√© b·∫Øt ƒë·∫ßu kh√≥c ngay khi m·∫π r·ªùi kh·ªèi ph√≤ng.",
                vocab: ["A. trong khi", "B. ngay khi", "C. cho ƒë·∫øn khi", "D. tr∆∞·ªõc khi"],
                whyRight: "Ph·∫£n ·ª©ng t·ª©c th√¨ c·ªßa em b√© -> D√πng <b>As soon as</b>.",
                whyWrong: "While (trong khi m·∫π r·ªùi ƒëi) -> m·∫π ch∆∞a ƒëi h·∫≥n. Before (kh√≥c tr∆∞·ªõc khi m·∫π ƒëi) -> v√¥ l√Ω."
            }
        },
        {
            question: "______ you cross the street, look both ways.",
            options: ["A. After", "B. While", "C. Before", "D. Until"],
            correct: 2,
            explanation: {
                translate: "Tr∆∞·ªõc khi b·∫°n sang ƒë∆∞·ªùng, h√£y nh√¨n hai ph√≠a.",
                vocab: ["A. Sau khi", "B. Trong khi", "C. Tr∆∞·ªõc khi", "D. Cho ƒë·∫øn khi"],
                whyRight: "Quy t·∫Øc an to√†n giao th√¥ng: Nh√¨n <b>Before</b> (tr∆∞·ªõc khi) ƒëi.",
                whyWrong: "After (sang r·ªìi m·ªõi nh√¨n) th√¨ qu√° mu·ªôn. While (v·ª´a ƒëi v·ª´a nh√¨n) c≈©ng ƒë∆∞·ª£c nh∆∞ng Before l√† l·ªùi khuy√™n chu·∫©n m·ª±c h∆°n."
            }
        },
        {
            question: "Please turn off the lights ______ you leave the room.",
            options: ["A. before", "B. while", "C. until", "D. as soon as"],
            correct: 0,
            explanation: {
                translate: "L√†m ∆°n t·∫Øt ƒë√®n tr∆∞·ªõc khi b·∫°n r·ªùi ph√≤ng.",
                vocab: ["A. tr∆∞·ªõc khi", "B. trong khi", "C. cho ƒë·∫øn khi", "D. ngay khi"],
                whyRight: "H√†nh ƒë·ªông t·∫Øt ƒë√®n ph·∫£i x·∫£y ra <b>Before</b> (tr∆∞·ªõc) h√†nh ƒë·ªông ƒëi ra.",
                whyWrong: "As soon as you leave (Ngay khi b·∫°n ƒëi ra) -> l√∫c ƒë√≥ b·∫°n ·ªü ngo√†i r·ªìi, sao v·ªõi tay t·∫Øt ƒë√®n trong ph√≤ng ƒë∆∞·ª£c?"
            }
        },
        {
            question: "We stayed in the cafe ______ it stopped raining.",
            options: ["A. while", "B. as soon as", "C. until", "D. before"],
            correct: 2,
            explanation: {
                translate: "Ch√∫ng t√¥i ·ªü l·∫°i qu√°n c√† ph√™ cho ƒë·∫øn khi tr·ªùi t·∫°nh m∆∞a.",
                vocab: ["A. trong khi", "B. ngay khi", "C. cho ƒë·∫øn khi", "D. tr∆∞·ªõc khi"],
                whyRight: "H√†nh ƒë·ªông '·ªü l·∫°i' k√©o d√†i t·ªõi ƒëi·ªÉm d·ª´ng l√† 't·∫°nh m∆∞a' -> D√πng <b>Until</b>.",
                whyWrong: "While it stopped raining (Trong khi tr·ªùi t·∫°nh) -> sai v√¨ 'stop' l√† kho·∫£nh kh·∫Øc."
            }
        },
        {
            question: "______ the exam started, the room was very quiet.",
            options: ["A. Until", "B. While", "C. Before", "D. After"],
            correct: 3,
            explanation: {
                translate: "Sau khi b√†i thi b·∫Øt ƒë·∫ßu, cƒÉn ph√≤ng r·∫•t y√™n tƒ©nh.",
                vocab: ["A. Cho ƒë·∫øn khi", "B. Trong khi", "C. Tr∆∞·ªõc khi", "D. Sau khi"],
                whyRight: "Ng·ªØ c·∫£nh: Khi b·∫Øt ƒë·∫ßu l√†m b√†i r·ªìi th√¨ m·ªçi ng∆∞·ªùi m·ªõi tr·∫≠t t·ª± -> D√πng <b>After</b> ho·∫∑c <b>When</b> (nh∆∞ng ·ªü ƒë√¢y ch·ªçn After h·ª£p l√Ω nh·∫•t).",
                whyWrong: "Before (tr∆∞·ªõc khi thi) th∆∞·ªùng ·ªìn √†o ·ªïn ƒë·ªãnh ch·ªó ng·ªìi. While (trong khi b·∫Øt ƒë·∫ßu) -> 'start' l√† kho·∫£nh kh·∫Øc."
            }
        },
        {
            question: "Do your homework ______ you watch TV.",
            options: ["A. while", "B. before", "C. until", "D. after"],
            correct: 1,
            explanation: {
                translate: "L√†m b√†i t·∫≠p tr∆∞·ªõc khi xem TV.",
                vocab: ["A. trong khi", "B. tr∆∞·ªõc khi", "C. cho ƒë·∫øn khi", "D. sau khi"],
                whyRight: "L·ªùi khuy√™n c·ªßa ph·ª• huynh/gi√°o vi√™n: Vi·ªác h·ªçc (∆∞u ti√™n) l√†m <b>Before</b> vi·ªác ch∆°i.",
                whyWrong: "After (l√†m b√†i sau khi xem TV) -> l·ªùi khuy√™n kh√¥ng t·ªët. While (v·ª´a h·ªçc v·ª´a xem) -> m·∫•t t·∫≠p trung."
            }
        },
        {
            question: "Cook the pasta ______ it is soft.",
            options: ["A. while", "B. before", "C. as soon as", "D. until"],
            correct: 3,
            explanation: {
                translate: "N·∫•u m√¨ ·ªëng cho ƒë·∫øn khi n√≥ m·ªÅm.",
                vocab: ["A. trong khi", "B. tr∆∞·ªõc khi", "C. ngay khi", "D. cho ƒë·∫øn khi"],
                whyRight: "N·∫•u ƒÉn l√† qu√° tr√¨nh k√©o d√†i, 'm·ªÅm' l√† ƒëi·ªÉm ƒë·∫°t y√™u c·∫ßu ƒë·ªÉ d·ª´ng l·∫°i -> D√πng <b>Until</b>.",
                whyWrong: "Before (n·∫•u tr∆∞·ªõc khi m·ªÅm) -> hi·ªÉn nhi√™n. As soon as (ngay khi m·ªÅm th√¨ n·∫•u) -> sai quy tr√¨nh."
            }
        },
        {
            question: "______ I saw the accident, I called the police.",
            options: ["A. While", "B. Until", "C. Before", "D. As soon as"],
            correct: 3,
            explanation: {
                translate: "Ngay khi t√¥i nh√¨n th·∫•y tai n·∫°n, t√¥i g·ªçi c·∫£nh s√°t.",
                vocab: ["A. Trong khi", "B. Cho ƒë·∫øn khi", "C. Tr∆∞·ªõc khi", "D. Ngay khi"],
                whyRight: "H√†nh ƒë·ªông kh·∫©n c·∫•p, ph·∫£n x·∫° t·ª©c th·ªùi -> D√πng <b>As soon as</b>.",
                whyWrong: "While (v·ª´a th·∫•y v·ª´a g·ªçi) -> c≈©ng ƒë∆∞·ª£c nh∆∞ng As soon as nh·∫•n m·∫°nh t√≠nh c·∫•p b√°ch h∆°n."
            }
        }
    ];

    // LOGIC
    let shuffledQuestions = [];
    let score = 0;
    const quizContainer = document.getElementById('quiz-container');
    const resultOverlay = document.getElementById('result-overlay');
    
    // Sound Effects Synthesis
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        if (type === 'correct') {
            // Ding sound (High pitch sine wave)
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        } else {
            // Buzz sound (Low pitch saw wave)
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    // Shuffle Array
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    // Initialize Quiz
    function initQuiz() {
        shuffledQuestions = shuffle([...questionData]); // Shuffle copy of data
        renderQuiz();
    }

    // Render Quiz
    function renderQuiz() {
        quizContainer.innerHTML = '';
        shuffledQuestions.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'question-card';
            questionEl.id = `q-${index}`;

            let optionsHTML = '';
            q.options.forEach((opt, i) => {
                optionsHTML += `<button class="option-btn" onclick="checkAnswer(${index}, ${i}, this)">${opt}</button>`;
            });

            questionEl.innerHTML = `
                <div class="question-number">Question ${index + 1}</div>
                <div class="question-text">${q.question}</div>
                <div class="options-grid">
                    ${optionsHTML}
                </div>
                <div class="explanation-box" id="exp-${index}">
                    <div class="exp-title">üìù C√¥ Mai An gi·∫£i th√≠ch chi ti·∫øt:</div>
                    <div class="exp-content">
                        <div class="exp-step">
                            <span class="exp-label">1. D·ªãch c√¢u h·ªèi:</span>
                            <p>${q.explanation.translate}</p>
                        </div>
                        <div class="exp-step">
                            <span class="exp-label">2. Ph√¢n t√≠ch ƒë√°p √°n:</span>
                            ${q.explanation.vocab.map(v => `<p>‚Ä¢ ${v}</p>`).join('')}
                        </div>
                        <div class="exp-step">
                            <span class="exp-label">3. T·∫°i sao ƒê√öNG? ‚úÖ</span>
                            <p>${q.explanation.whyRight}</p>
                        </div>
                        <div class="exp-step">
                            <span class="exp-label">4. T·∫°i sao SAI? ‚ùå</span>
                            <p>${q.explanation.whyWrong}</p>
                        </div>
                    </div>
                </div>
            `;
            quizContainer.appendChild(questionEl);
        });
    }

    // Check Answer
    function checkAnswer(qIndex, optIndex, btnElement) {
        const questionObj = shuffledQuestions[qIndex];
        const parent = document.getElementById(`q-${qIndex}`);
        const allBtns = parent.querySelectorAll('.option-btn');
        const expBox = document.getElementById(`exp-${qIndex}`);

        // Prevent re-answering
        if (btnElement.classList.contains('disabled') || btnElement.parentElement.classList.contains('answered')) return;

        // Mark as answered
        btnElement.parentElement.classList.add('answered');
        allBtns.forEach(btn => btn.classList.add('disabled'));

        if (optIndex === questionObj.correct) {
            // Correct
            btnElement.classList.add('correct');
            score++;
            playSound('correct');
            triggerConfetti();
        } else {
            // Wrong
            btnElement.classList.add('wrong');
            // Highlight correct answer
            allBtns[questionObj.correct].classList.add('correct');
            playSound('wrong');
        }

        // Show Explanation immediately
        expBox.classList.add('show');
    }

    // Confetti Effect (Minimalist)
    function triggerConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];

        for (let i = 0; i < 100; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                w: Math.random() * 10 + 5,
                h: Math.random() * 5 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                vy: Math.random() * 2 + 2,
                vx: Math.random() * 2 - 1
            });
        }

        let animationId;
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            particles.forEach(p => {
                p.y += p.vy;
                p.x += p.vx;
                if (p.y < canvas.height) active = true;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.w, p.h);
            });

            if (active) {
                animationId = requestAnimationFrame(update);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }
        update();
    }

    // Submit Quiz
    function submitQuiz() {
        resultOverlay.style.display = 'flex';
        const finalScoreEl = document.getElementById('final-score');
        const feedbackMsg = document.getElementById('feedback-msg');
        
        finalScoreEl.innerText = `${score}/30`;
        
        const percentage = (score / 30) * 100;
        
        if (percentage === 100) {
            feedbackMsg.innerText = "üåü XU·∫§T S·∫ÆC! Con l√† thi√™n t√†i ti·∫øng Anh! C√¥ Mai An r·∫•t t·ª± h√†o!";
            playSound('correct');
            triggerConfetti();
        } else if (percentage >= 80) {
            feedbackMsg.innerText = "üéâ R·∫•t gi·ªèi! Con n·∫Øm b√†i r·∫•t ch·∫Øc. C·ªë g·∫Øng th√™m ch√∫t n·ªØa l√† ho√†n h·∫£o!";
        } else if (percentage >= 50) {
            feedbackMsg.innerText = "üëç Kh√° t·ªët! Con ƒë√£ hi·ªÉu b√†i nh∆∞ng c·∫ßn c·∫©n th·∫≠n h∆°n v·ªõi c√°c b·∫´y nh√©.";
        } else {
            feedbackMsg.innerText = "üí™ C·ªë l√™n! Con h√£y ƒë·ªçc k·ªπ l·∫°i ph·∫ßn gi·∫£i th√≠ch chi ti·∫øt b√™n d∆∞·ªõi ƒë·ªÉ l√†m l·∫°i t·ªët h∆°n nh√©!";
        }
    }

    // Start
    initQuiz();

</script>
</body>
</html>